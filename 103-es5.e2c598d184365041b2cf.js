!function(){function t(t){return function(t){if(Array.isArray(t))return n(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||e(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(t,e){if(t){if("string"==typeof t)return n(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?n(t,e):void 0}}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}(window.webpackJsonp=window.webpackJsonp||[]).push([[103],{"q/tE":function(n,i,a){"use strict";a.r(i),a.d(i,"EmsGroupwiseEnergyCostModule",(function(){return H}));var s=a("ofXK"),c=a("3Pt+"),l=a("tyNb"),u=a("6n/F"),h=a("KHMF"),p=a("zSPf"),d=a("JX19"),g=a("sXtk"),f=a("fXoL"),b=a("b6Qw"),m=a("xBcV"),y=a("rvYj"),v=a("XiUz"),C=a("jaxi"),S=a("kmnG"),k=a("d3UM"),x=a("qFsG"),T=a("f0Cb"),M=a("FKr1"),G=a("Wp6s"),w=["allMeterGroupsSelected"];function E(t,e){if(1&t&&(f.Tb(0,"mat-button-toggle",27),f.Rc(1),f.Sb()),2&t){var n=e.$implicit,o=e.index;f.nc("id",n),f.nc("value",n),f.mc("checked",0===o),f.Cb(1),f.Sc(n)}}function L(t,e){if(1&t&&(f.Tb(0,"mat-button-toggle",28),f.Rc(1),f.Sb()),2&t){var n=e.$implicit,o=e.index;f.nc("id",n),f.nc("value",n),f.mc("checked",0===o),f.Cb(1),f.Sc(n)}}function O(t,e){if(1&t){var n=f.Ub();f.Tb(0,"mat-option",15),f.bc("click",(function(){f.Ec(n);var t=f.fc(),e=f.Ac(21);return t.toggleMeterGroupPerOne(e.viewValue)})),f.Rc(1),f.Sb()}if(2&t){var o=e.$implicit;f.mc("value",o.id),f.Cb(1),f.Tc(" ",o.description," ")}}var F,I,P,D=[{path:"",component:(F=function(){function n(t,e,r,i,a){var s;o(this,n),this.cookieService=t,this.fb=e,this.masterService=r,this.emsDashboardService=i,this.envService=a,this.showSpinner=!1,this.frequency=["Daily","Weekly","Monthly","Yearly"],this.buttons=["Today","Yesterday"],this.selectedValue="Daily",this.reportType="Today",this.previousLabel="",this.currentLabel="",this.forecastLabel="",this.estimatedSavingsLabel="Estimated Savings",this.previousEnergyCost=0,this.currentEnergyCost=0,this.forecastEnergyCost=0,this.estimatedSavings=0,this.clientId="0",this.meterTypes=[],this.energyCostComparison=[],this.costComparisonChart=[],this.energyCost=[],this.isCurrent=!0,this.currency="",this.donutChartOptions={},this.meterGroup=[],this.lstMeterGroup=[],this.lstFilterMeterGroup=[],this.currency=null!==(s=Object(h.e)("Currency"))&&void 0!==s?s:a.currencyFormat}var i,a,s;return i=n,(a=[{key:"ngOnInit",value:function(){this.form=this.fb.group({meterGroup:[""]});var t=this.cookieService.get("filterData");if(t){var e=JSON.parse(t);this.clientId=""==e.strClientId?this.cookieService.get("globalClientId"):e.strClientId}this.setConsumptionLables(),this.getDeviceGroups(),this.getGroupwiseEnergyCost()}},{key:"getUtilities",value:function(){var t=this;this.emsDashboardService.getUtilities(this.clientId).subscribe((function(e){e&&(t.meterTypes=[],e.forEach((function(e){t.meterTypes.push(e.description)})))}))}},{key:"getDeviceGroups",value:function(){var t=this;this.lstMeterGroup=[],this.masterService.getUserMasterdata(71,0).subscribe((function(e){t.lstMeterGroup=t.lstFilterMeterGroup=e,t.lstMeterGroup.forEach((function(e){t.meterGroup.push(e.id)})),t.getGroupwiseEnergyCost()}))}},{key:"onValChange",value:function(t){this.selectedValue=null!=t?t.value:this.frequency[0],this.reportType=this.buttons[0],this.isCurrent=!0,this.setConsumptionLables(t.value),this.getGroupwiseEnergyCost()}},{key:"ngAfterViewChecked",value:function(){var t=document.getElementById(this.reportType);this.buttons.forEach((function(t){document.getElementById(t).className="mat-raised-button"})),t.className="mat-raised-button-checked"}},{key:"onButtonChange",value:function(t){this.reportType=null!=t?t.value:this.buttons[0];var e=document.getElementById(this.reportType);this.buttons.forEach((function(t){document.getElementById(t).className="mat-raised-button"})),e.className="mat-raised-button-checked",this.isCurrent=this.buttons[0]==this.reportType,this.getGroupwiseEnergyCost()}},{key:"setConsumptionLables",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Daily";this.previousLabel="",this.currentLabel="",this.forecastLabel="";var e=new Date;"Daily"===t?(this.currentLabel="So far Today",this.previousLabel="Yesterday",this.forecastLabel="Predicted Today",this.buttons=["Today","Yesterday"],this.reportType=this.buttons[0]):"Weekly"===t?(this.currentLabel="So far This Week",this.previousLabel="Last Week",this.forecastLabel="Predicted This Week",this.buttons=["This Week","Last Week"],this.reportType=this.buttons[0]):"Monthly"===t?(e.setDate(1),e.setMonth(e.getMonth()-1),this.currentLabel="So far This Month",this.previousLabel=e.toLocaleString("en-us",{month:"long"}),this.forecastLabel="Predicted This Month",this.buttons=["This Month","Last Month"],this.reportType=this.buttons[0]):(this.currentLabel="So far This Year",this.previousLabel="Last Year",this.forecastLabel="Predicted This Year",this.buttons=["This Year","Last Year"],this.reportType=this.buttons[0])}},{key:"toggleMeterGroupsAllSelection",value:function(){this.allMeterGroupsSelected.selected?(this.form.controls.meterGroup.patchValue([].concat(t(this.lstMeterGroup.map((function(t){return t.id}))),[0])),this.getGroupwiseEnergyCost()):(this.form.controls.meterGroup.patchValue([]),this.getGroupwiseEnergyCost())}},{key:"toggleMeterGroupPerOne",value:function(){this.allMeterGroupsSelected.selected&&this.allMeterGroupsSelected.deselect(),this.form.controls.meterGroup.value.length==this.lstMeterGroup.length&&this.allMeterGroupsSelected.select(),this.getGroupwiseEnergyCost()}},{key:"search",value:function(t){var e=this.select(t);this.lstMeterGroup=e}},{key:"select",value:function(t){var n=[];if(t){var o,r=function(t,n){var o;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(o=e(t))||n&&t&&"number"==typeof t.length){o&&(t=o);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,c=!1;return{s:function(){o=t[Symbol.iterator]()},n:function(){var t=o.next();return s=t.done,t},e:function(t){c=!0,a=t},f:function(){try{s||null==o.return||o.return()}finally{if(c)throw a}}}}(this.lstMeterGroup);try{for(r.s();!(o=r.n()).done;){var i=o.value;i.description.toLowerCase().indexOf(t)>-1&&n.push(i)}}catch(a){r.e(a)}finally{r.f()}}else n=this.lstFilterMeterGroup;return n}},{key:"getGroupwiseEnergyCost",value:function(){var t=this;this.showSpinner=!1;var e,n={};this.costComparisonChart=[];var o=[];n.chartValues=[],this.currentEnergyCost=0,this.stackedBarChartOptions=this.setStackedCostComparisonChart(this.costComparisonChart,o);var r=document.getElementById("egecontainer1");r&&u.chart("egecontainer1",this.stackedBarChartOptions),this.donutChartOptions=this.setDonutChart(n);var i=document.getElementById("egecontainer2");if(i&&u.chart("egecontainer2",this.donutChartOptions),this.meterGroup&&this.meterGroup.length>0){var a=this.meterGroup.findIndex((function(t){return 0==t}));a>=0&&this.meterGroup.splice(a,1);var s=this.meterGroup.join(",");this.emsDashboardService.getOverallGroupWiseEnergyCost(this.clientId,s,this.selectedValue,this.isCurrent).subscribe({next:function(a){a?(t.showSpinner=!1,t.groupWiseEnergyCost=a,e=a.energyCostStacks,o=a.categories,t.stackedBarChartOptions=t.setStackedCostComparisonChart(e,o),(r=document.getElementById("egecontainer1"))&&u.chart("egecontainer1",t.stackedBarChartOptions),t.currentEnergyCost=t.groupWiseEnergyCost.totalCost,n.chartValues=[],t.groupWiseEnergyCost.energyCost.forEach((function(t){n.chartValues.push([t.utilityType,t.currentCost])})),t.donutChartOptions=t.setDonutChart(n),(i=document.getElementById("egecontainer2"))&&u.chart("egecontainer2",t.donutChartOptions)):t.showSpinner=!1},error:function(e){t.showSpinner=!1}})}else this.showSpinner=!1}},{key:"setDonutChart",value:function(t){return{chart:{marginTop:0,marginBottom:0,marginLeft:0,marginRight:0,backgroundColor:"#fafafa",height:350,type:"pie",options3d:{enabled:!1,alpha:45}},title:{text:"",align:"left",style:{fontFamily:"Roboto",fontWeight:"bolder"}},credits:{enabled:!1},exporting:{enabled:!1},noData:{style:{fontWeight:"bold",fontSize:"15px"}},legend:{floating:!1,align:"left",verticalAlign:"bottom",layout:"horizontal",fontFamily:"Roboto"},plotOptions:{series:{shadow:!1},marginLeft:0,pointPadding:.25,pie:{startAngle:-90,endAngle:90,innerSize:100,depth:25,colors:["#1fd286","#1e5eff","#ffda44","#d80027","#808080","#0d233a","#8bbc21","#910000","#1aadce","#492970","#f28f43","#77a1e5","#c42525","#a6c96a"]}},series:[{name:"Amount in "+this.currency,type:"pie",allowPointSelect:!0,dataLabels:{connectorWidth:0,crookDistance:"10%",enabled:!0},keys:["name","y","selected","sliced"],data:t.chartValues}]}}},{key:"setStackedCostComparisonChart",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n="",o="",r=new Date,i=new Date,a="Today's Energy Cost",s="";return"Monthly"==this.selectedValue?(s="Day",i.setDate(1),i.setMonth(i.getMonth()-1),n=r.toLocaleString("en-us",{month:"long"}),o=i.toLocaleString("en-us",{month:"long"}),a=1==this.isCurrent?n+" Energy Cost":o+" Energy Cost"):"Daily"==this.selectedValue?(s="Hour",a=1==this.isCurrent?"Today's Energy Cost":"Yesterday's Energy Cost"):"Weekly"==this.selectedValue?(s="Date",a=1==this.isCurrent?"This Week Energy Cost":"Last Week Energy Cost"):"Yearly"==this.selectedValue&&(s="Month",a=1==this.isCurrent?"This Year Energy Cost":"Last Year Energy Cost"),{chart:{type:"spline",marginLeft:90},title:{text:a,style:{fontWeight:"bolder",fontFamily:"Roboto"}},credits:{enabled:!1},colors:["#1fd286","#1e5eff","#ffda44","#d80027","#808080","#0d233a","#8bbc21","#910000","#1aadce","#492970","#f28f43","#77a1e5","#c42525","#a6c96a"],xAxis:{categories:e,visible:!0,title:{text:s}},yAxis:{title:{text:"Total Cost"}},legend:{align:"center",x:30,verticalAlign:"bottom",y:20,floating:!1,backgroundColor:u.defaultOptions.legend.backgroundColor||"white",shadow:!1},tooltip:{headerFormat:"<b>{point.x}</b><br/>",pointFormat:"{series.name}: "+this.currency+" {point.y}<br/>Total: "+this.currency+" {point.stackTotal}"},plotOptions:{series:{pointWidth:50},column:{pointWidth:20,stacking:"normal",dataLabels:{enabled:!1}}},series:t}}}])&&r(i.prototype,a),s&&r(i,s),n}(),F.\u0275fac=function(t){return new(t||F)(f.Nb(b.a),f.Nb(c.f),f.Nb(p.a),f.Nb(d.a),f.Nb(g.a))},F.\u0275cmp=f.Hb({type:F,selectors:[["fury-ems-groupwise-energycost"]],viewQuery:function(t,e){var n;1&t&&f.Vc(w,!0),2&t&&f.zc(n=f.cc())&&(e.allMeterGroupsSelected=n.first)},decls:35,vars:10,consts:[["mode","card"],["fxLayout","column",1,"content"],[1,"toolBar"],[1,"example-spacer"],["name","fontStyle","aria-label","Font Style",1,"buttons",2,"font-size","small","float","right",3,"value","change"],["mat-raised-button","","style","padding: 0px;",3,"id","checked","value",4,"ngFor","ngForOf"],["name","fontStyle","aria-label","Font Style",2,"font-size","small","border","0px",3,"value","change"],["style","padding: 0px;margin-right: 8px;",3,"id","checked","value",4,"ngFor","ngForOf"],["fxLayout","row","fxLayout.xs","column","fxLayout.sm","column","fxLayoutGap","30px","fxFlex","100%",1,"content",2,"padding","0% 0% 1% 0%"],["fxLayout","column","fxFlex","30%"],[1,"tileHeading",2,"clear","both","padding-top","50px"],["fxFlex","",2,"padding-top","5px"],["multiple","","placeholder","Select a Meter Group",1,"multiSelectCustom",3,"ngModel","formControl","ngModelChange"],["matInput","","focused","'true'","type","text","autocomplete","off","placeholder","search",1,"myInput",3,"keyup"],["myInput",""],[3,"value","click"],["allMeterGroupsSelected",""],[3,"value","click",4,"ngFor","ngForOf"],["fxFlex","22%",1,"mat-elevation-z4",2,"height","175px","text-align","center"],["fxFlex","",2,"padding-top","30px"],[1,"topPadding"],[1,"tileHeading"],[1,"energyCost"],["id","egecontainer2",2,"height","200px","background-color","transparent","width","400px"],["fxLayout","row","fxLayout.xs","column","fxLayout.sm","column",1,"content",2,"padding","0% 0% 0.25% 0.20%"],["fxFlex","100%",1,"mat-elevation-z4"],["id","egecontainer1"],["mat-raised-button","",2,"padding","0px",3,"id","checked","value"],[2,"padding","0px","margin-right","8px",3,"id","checked","value"]],template:function(t,e){1&t&&(f.Tb(0,"fury-page-layout",0),f.Tb(1,"fury-page-layout-content",1),f.Tb(2,"div"),f.Tb(3,"span",2),f.Rc(4,"Group-wise Energy Cost"),f.Sb(),f.Ob(5,"span",3),f.Tb(6,"mat-button-toggle-group",4),f.bc("change",(function(t){return e.onValChange(t)})),f.Pc(7,E,2,4,"mat-button-toggle",5),f.Sb(),f.Sb(),f.Tb(8,"div"),f.Tb(9,"mat-button-toggle-group",6),f.bc("change",(function(t){return e.onButtonChange(t)})),f.Pc(10,L,2,4,"mat-button-toggle",7),f.Sb(),f.Sb(),f.Tb(11,"div",8),f.Tb(12,"div",9),f.Tb(13,"div",10),f.Rc(14,"Group By"),f.Sb(),f.Tb(15,"mat-form-field",11),f.Tb(16,"mat-select",12),f.bc("ngModelChange",(function(t){return e.meterGroup=t})),f.Tb(17,"input",13,14),f.bc("keyup",(function(t){return e.search(t.target.value)})),f.Sb(),f.Ob(19,"mat-divider"),f.Tb(20,"mat-option",15,16),f.bc("click",(function(){return e.toggleMeterGroupsAllSelection()})),f.Rc(22,"Select All"),f.Sb(),f.Pc(23,O,2,2,"mat-option",17),f.Sb(),f.Sb(),f.Sb(),f.Tb(24,"mat-card",18),f.Tb(25,"div",19),f.Ob(26,"span",20),f.Tb(27,"span",21),f.Rc(28,"Total Energy Cost"),f.Sb(),f.Tb(29,"p",22),f.Rc(30),f.Sb(),f.Sb(),f.Sb(),f.Ob(31,"div",23),f.Sb(),f.Tb(32,"div",24),f.Tb(33,"mat-card",25),f.Ob(34,"div",26),f.Sb(),f.Sb(),f.Sb(),f.Sb()),2&t&&(f.Cb(6),f.mc("value",e.selectedValue),f.Cb(1),f.mc("ngForOf",e.frequency),f.Cb(2),f.mc("value",e.reportType),f.Cb(1),f.mc("ngForOf",e.buttons),f.Cb(6),f.mc("ngModel",e.meterGroup)("formControl",e.form.controls.meterGroup),f.Cb(4),f.mc("value",0),f.Cb(3),f.mc("ngForOf",e.lstMeterGroup),f.Cb(7),f.Uc("",e.currency," ",e.currentEnergyCost," "))},directives:[m.a,y.a,v.d,C.b,s.n,v.e,v.b,S.d,k.a,c.q,c.h,x.b,T.a,M.n,G.a,C.a],styles:[".mat-button-toggle-checked[_ngcontent-%COMP%]{background-color:#0051b4;color:#fff!important}.content[_ngcontent-%COMP%]{margin-top:1%}.toolBar[_ngcontent-%COMP%]{font-size:x-large;font-weight:700;line-height:50px}.common-buttons[_ngcontent-%COMP%]{height:50%}.topPadding[_ngcontent-%COMP%]{padding-top:20px}.tileHeading[_ngcontent-%COMP%]{font-weight:700}.myInput[_ngcontent-%COMP%]{height:50px!important;padding:10px!important}.energyCost[_ngcontent-%COMP%]{font-size:x-large;vertical-align:middle;margin:0;padding:25px 0 10px;font-weight:700}.mat-button-toggle-group-checked[_ngcontent-%COMP%]   .group1[_ngcontent-%COMP%]{background-color:#1fd286;color:#fff!important}.mat-raised-button[_ngcontent-%COMP%]{color:#000}.mat-raised-button-checked[_ngcontent-%COMP%]{background-color:#1fd286!important;color:#fff!important}"]}),F)}],W=((I=function t(){o(this,t)}).\u0275mod=f.Lb({type:I}),I.\u0275inj=f.Kb({factory:function(t){return new(t||I)},imports:[[l.j.forChild(D)],l.j]}),I),A=a("NFeN"),V=a("/t3+"),B=a("VE2z"),j=a("KthW"),Y=a("WCGO"),z=a("QMK6"),N=a("q8Jb"),R=a("0jmt"),_=a("0IaG"),U=a("Qu3c"),q=a("STbY"),K=a("jJIU"),H=((P=function t(){o(this,t)}).\u0275mod=f.Lb({type:P}),P.\u0275inj=f.Kb({factory:function(t){return new(t||P)},providers:[s.f,s.g],imports:[[s.c,W,c.l,j.a,Y.a,c.w,z.a,B.a,R.a,N.a,S.f,x.c,C.c,A.b,q.c,V.b,U.b,_.g,K.a]]}),P)}}])}();