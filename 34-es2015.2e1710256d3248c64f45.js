(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{"6GKC":function(t,e,i){"use strict";i.d(e,"a",(function(){return a}));var l=i("KHMF"),n=i("fXoL");let a=(()=>{class t{constructor(t){this.el=t,this.roundOffFormat="",this.decimalPlaces=0,this.keyString="Decimal",this.regex=new RegExp(/^\d*\.?\d{0,2}$/g),this.specialKeys=["Backspace","Tab","End","Home","-","ArrowLeft","ArrowRight","Del","Delete"],this.roundOffFormat=Object(l.e)("RoundOff"),this.decimalPlaces=parseInt(this.roundOffFormat.substring(this.roundOffFormat.indexOf("-")+1,this.roundOffFormat.length))}onKeyDown(t){if(this.regex=new RegExp("^\\d*\\.?\\d{0,"+this.decimalPlaces+"}$"),-1!==this.specialKeys.indexOf(t.key))return;let e=this.el.nativeElement.value;const i=this.el.nativeElement.selectionStart,l=[e.slice(0,i),t.key===this.keyString||t.key===this.keyString.toLowerCase()?".":t.key,e.slice(i)].join("");l&&!String(l).match(this.regex)&&t.preventDefault()}}return t.\u0275fac=function(e){return new(e||t)(n.Nb(n.l))},t.\u0275dir=n.Ib({type:t,selectors:[["","furyValidateDecimalPlacesDirective",""]],hostBindings:function(t,e){1&t&&n.bc("keydown",(function(t){return e.onKeyDown(t)}))}}),t})()},YaQ2:function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));var l=i("fXoL"),n=i("ofXK");function a(t,e){if(1&t&&(l.Tb(0,"small"),l.Rc(1),l.Ob(2,"br"),l.Sb()),2&t){const t=e.$implicit;l.Cb(1),l.Tc(" ",t," ")}}function o(t,e){if(1&t&&(l.Tb(0,"div"),l.Pc(1,a,3,1,"small",1),l.Sb()),2&t){const t=l.fc();l.Cb(1),l.mc("ngForOf",t.listOfErrors())}}let r=(()=>{class t{constructor(){this.PATTERN_ERROR_MESSAGE={"/^[a-zA-Z ]*$/":"Accepts only alphabets with spaces","/^[a-zA-Z0-9]*$/":"Accepts only alphanumeric values with no spaces","/^[a-zA-Z0-9 ]*$/":"Accepts only alphanumeric values with spaces","/^[0-9]*$/":"Accepts only numbers","^[a-z0-9._%+-]+@[a-z0-9.-]+\\.[a-z]{3,4}$":"Enter valid email address of format test@mail.com"},this.ERROR_MESSAGE={required:()=>"This field is required",minlength:t=>`Min ${t.requiredLength} chars is required but got only ${t.actualLength}`,maxlength:t=>`Max chars allowed is ${t.requiredLength} but got ${t.actualLength}`,pattern:t=>""+this.PATTERN_ERROR_MESSAGE[t.requiredPattern],email:()=>"Enter valid email address of format test@mail.com"}}ngOnInit(){}shouldShowErrors(){return this.ctrl&&this.ctrl.errors&&this.ctrl.touched}listOfErrors(){return Object.keys(this.ctrl.errors).map(t=>this.ERROR_MESSAGE[t](this.ctrl.getError(t)))}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=l.Hb({type:t,selectors:[["app-show-errors"]],inputs:{ctrl:"ctrl"},decls:1,vars:1,consts:[[4,"ngIf"],[4,"ngFor","ngForOf"]],template:function(t,e){1&t&&l.Pc(0,o,2,1,"div",0),2&t&&l.mc("ngIf",e.shouldShowErrors())},directives:[n.o,n.n],styles:["small[_ngcontent-%COMP%]{color:red}"]}),t})()},"a+RD":function(t,e,i){"use strict";i.d(e,"a",(function(){return C}));var l=i("fXoL"),n=i("xgIS"),a=i("/uUt"),o=i("Kj3r"),r=i("ofXK"),s=i("STbY"),c=i("XiUz"),u=i("NFeN"),d=i("bTqV"),h=i("bSwM"),m=i("3Pt+");const b=["filter"];function f(t,e){if(1&t&&(l.Tb(0,"button",12),l.Tb(1,"mat-icon"),l.Rc(2,"filter_list"),l.Sb(),l.Sb()),2&t){l.fc(2);const t=l.Ac(3);l.mc("matMenuTriggerFor",t)}}function p(t,e){if(1&t&&(l.Tb(0,"div",5),l.Tb(1,"div",6),l.Rc(2),l.Sb(),l.Tb(3,"div",7),l.Tb(4,"mat-icon",8),l.Rc(5,"search"),l.Sb(),l.Ob(6,"input",9,10),l.Sb(),l.Pc(8,f,3,1,"button",11),l.kc(9,1),l.Sb()),2&t){const t=l.fc();l.Cb(2),l.Sc(t.name),l.Cb(6),l.mc("ngIf",!t.hideFilter)}}function g(t,e){if(1&t){const t=l.Ub();l.Tb(0,"button",13),l.bc("click",(function(i){l.Ec(t);const n=e.$implicit;return l.fc().toggleColumnVisibility(n,i)})),l.Tb(1,"mat-checkbox",14,15),l.bc("ngModelChange",(function(i){return l.Ec(t),e.$implicit.visible=i}))("click",(function(e){return l.Ec(t),e.stopPropagation()})),l.Rc(3),l.Sb(),l.Sb()}if(2&t){const t=e.$implicit;l.Cb(1),l.mc("ngModel",t.visible),l.Cb(2),l.Tc(" ",t.name," ")}}const y=["*",[["",8,"actions"]]],v=["*",".actions"];let C=(()=>{class t{constructor(){this.filterChange=new l.o}ngAfterViewInit(){this.hideHeader||Object(n.a)(this.filter.nativeElement,"keyup").pipe(Object(a.a)(),Object(o.a)(150)).subscribe(()=>{this.filterChange.emit(this.filter.nativeElement.value)})}toggleColumnVisibility(t,e){e.stopPropagation(),e.stopImmediatePropagation(),t.visible=!t.visible}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=l.Hb({type:t,selectors:[["fury-list"]],viewQuery:function(t,e){var i;1&t&&l.Vc(b,!0),2&t&&l.zc(i=l.cc())&&(e.filter=i.first)},inputs:{name:"name",columns:"columns",hideHeader:"hideHeader",hideFilter:"hideFilter"},outputs:{filterChange:"filterChange"},ngContentSelectors:v,decls:6,vars:2,consts:[[1,"fury-list-table"],["class","fury-list-header","fxLayout","row","fxLayoutAlign","start center","fxLayoutGap","8px","fxLayoutGap.gt-xs","24px",4,"ngIf"],["yPosition","below","xPosition","before"],["columnFilter","matMenu"],["class","checkbox-item mat-menu-item",3,"click",4,"ngFor","ngForOf"],["fxLayout","row","fxLayoutAlign","start center","fxLayoutGap","8px","fxLayoutGap.gt-xs","24px",1,"fury-list-header"],[1,"fury-list-name"],["fxLayout","row","fxLayoutAlign","start center","fxFlex",""],[1,"fury-filter-input-icon"],["fxFlex","","placeholder","Search\u2026",1,"fury-filter-input"],["filter",""],["class","fury-column-filter","type","button","mat-icon-button","",3,"matMenuTriggerFor",4,"ngIf"],["type","button","mat-icon-button","",1,"fury-column-filter",3,"matMenuTriggerFor"],[1,"checkbox-item","mat-menu-item",3,"click"],[1,"checkbox",3,"ngModel","ngModelChange","click"],["checkbox",""]],template:function(t,e){1&t&&(l.lc(y),l.Tb(0,"div",0),l.Pc(1,p,10,2,"div",1),l.Tb(2,"mat-menu",2,3),l.Pc(4,g,4,2,"button",4),l.Sb(),l.kc(5),l.Sb()),2&t&&(l.Cb(1),l.mc("ngIf",!e.hideHeader),l.Cb(3),l.mc("ngForOf",e.columns))},directives:[r.o,s.e,r.n,c.d,c.c,c.e,c.b,u.a,d.a,s.d,h.a,m.q,m.t],styles:[".fury-list-table{display:flex;flex-direction:column}.fury-list-table .fury-list-header{padding-left:24px;padding-right:24px;height:64px;border-top-left-radius:8px;border-top-right-radius:8px}@media screen and (max-width:599px){.fury-list-table .fury-list-header{height:auto;padding-top:24px;padding-bottom:24px}}.fury-list-table .fury-list-header .fury-list-name{font-size:20px;line-height:32px;font-weight:500;padding-right:24px}@media screen and (max-width:599px){.fury-list-table .fury-list-header .fury-list-name{border-right:none}}.fury-list-table .fury-list-header .fury-filter-input{font-size:16px;line-height:1.125;border:none;height:32px}.fury-list-table .fury-list-header .fury-filter-input:focus{outline:none}.fury-list-table .fury-list-header .fury-filter-input-icon{width:1.2em;vertical-align:bottom;height:22px;font-size:22px;margin-right:8px}.fury-list-table table{width:100%}.fury-list-table .mat-header-row .mat-header-cell .mat-sort-header-button{text-transform:uppercase}.fury-list-table .mat-cell.image-cell,.fury-list-table .mat-header-cell.image-cell{flex:0;width:59px}.fury-list-table .mat-cell.image-cell img,.fury-list-table .mat-header-cell.image-cell img{border-radius:50%;height:35px;width:35px;margin-right:24px;vertical-align:middle}.fury-list-table .mat-cell,.fury-list-table .mat-header-cell{white-space:nowrap;padding-left:12px;padding-right:12px}.fury-list-table .mat-cell.actions-cell,.fury-list-table .mat-header-cell.actions-cell{flex:0;width:40px;overflow:visible}.fury-list-table .paginator{display:block}"],encapsulation:2}),t})()},pf8y:function(t,e,i){"use strict";i.r(e),i.d(e,"CreateContractModule",(function(){return Pe}));var l=i("ofXK"),n=i("3Pt+"),a=i("q8Jb"),o=i("0jmt"),r=i("KthW"),s=i("tyNb"),c=i("mrSG"),u=i("M9IT"),d=i("Dh3D"),h=i("+0xr"),m=i("jtHE"),b=i("pLZG"),f=i("Ku73"),p=i("nStZ"),g=i("3R10");class y{constructor(t){this.id=t.id||0,this.contractId=t.contractId||0,this.ownerId=t.ownerId||0,this.utilityTypeId=t.utilityTypeId||"",this.utilityType=t.utilityType||"",this.groupId=t.groupId||"",this.meterNumber=t.meterNumber||"",this.meterId=t.meterId||0,this.isDifferenciateConsumption=t.isDifferenciateConsumption||!1}}class v{constructor(t){this.id=t.id||0,this.clientId=t.clientId||0,this.contractNumber=t.contractNumber||"",this.contractDate=t.contractDate||"",this.tenantId=t.tenantId||0,this.tenantName=t.tenantName||"",this.unitId=t.unitId||0,this.unitNumber=t.unitNumber||"",this.utilityTypeId=t.utilityTypeId||0,this.utilityType=t.utilityType||"",this.contractTypeId=t.contractTypeId||0,this.contractType=t.contractType||"",this.contractEndDate=t.contractEndDate||null,this.contractSuspendDate=t.contractSuspendDate||null,this.reasonForContractEnd=t.reasonForContractEnd||"",this.accountNumber=t.accountNumber||"",this.type=t.type||"",this.mode=t.mode||"create",this.securityDeposit=t.securityDeposit||0,this.receivedAmount=t.receivedAmount||0,this.remainingAmount=t.remainingAmount||0,this.refundAmount=t.refundAmount||0,this.previousDueAmount=t.previousDueAmount||0,this.isSecurityDepositPaid=t.isSecurityDepositPaid||!1,this.isGroupBill=t.isGroupBill||!1,this.status=t.status||"",this.isSuspended=t.isSuspended||!1,this.isAssignToOwner=t.isAssignToOwner||!1,this.isDeleted=t.isDeleted||!1,this.contractReActivatedDate=t.contractReActivatedDate||null,this.billMasters=t.billMasters||[],this.ownerBillGroups=(t.ownerBillGroups||[]).map(t=>new y(t)),this.contractTransactions=t.contractTransactions||[],this.checkDues=!0}}var C=i("0IaG"),S=i("ERz2"),T=i("m6b6"),D=i("zSPf"),P=i("tB66"),w=i("xXXn"),x=i("KHMF"),R=i("fXoL"),A=i("b6Qw"),F=i("/t3+"),I=i("bTqV"),N=i("NFeN"),M=i("MutI"),k=i("4FRi"),O=i("XiUz"),W=i("kmnG"),U=i("qFsG"),E=i("iadO"),L=i("YaQ2"),z=i("/1cH"),B=i("bSwM"),j=i("6GKC"),G=i("d3UM"),Y=i("FKr1"),H=i("dUAH");const $=["allSelected"];function V(t,e){if(1&t&&(R.Tb(0,"mat-option",58),R.Rc(1),R.Sb()),2&t){const t=e.$implicit;R.mc("value",t.description),R.Cb(1),R.Tc(" ",t.description," ")}}function _(t,e){if(1&t&&(R.Tb(0,"mat-option",58),R.Rc(1),R.Sb()),2&t){const t=e.$implicit;R.mc("value",t.description),R.Cb(1),R.Tc(" ",t.description," ")}}function X(t,e){if(1&t&&(R.Tb(0,"small"),R.Rc(1),R.Sb()),2&t){const t=R.fc();R.Cb(1),R.Tc("Contract ",t.type," date should be greater than Contract date.")}}function q(t,e){if(1&t&&(R.Tb(0,"mat-option",58),R.Rc(1),R.Sb()),2&t){const t=e.$implicit;R.mc("value",t.description),R.Cb(1),R.Tc(" ",t.description," ")}}function K(t,e){if(1&t){const t=R.Ub();R.Tb(0,"div",59),R.Tb(1,"mat-checkbox",60),R.bc("change",(function(e){return R.Ec(t),R.fc().enableAssignToOwnerCheckChanged(e)})),R.Rc(2," Assign To Owner "),R.Sb(),R.Sb()}}function Q(t,e){if(1&t){const t=R.Ub();R.Tb(0,"mat-option",37),R.bc("click",(function(){R.Ec(t);const e=R.fc(),i=R.Ac(110);return e.togglePerOne(i.viewValue)})),R.Rc(1),R.Sb()}if(2&t){const t=e.$implicit;R.mc("value",t.id),R.Cb(1),R.Tc(" ",t.utilityType," ")}}function Z(t,e){1&t&&(R.Tb(0,"small"),R.Rc(1,"UtilityType already added"),R.Sb())}function J(t,e){1&t&&(R.Tb(0,"mat-hint",61),R.Rc(1,"Bill Group Number should be same for all Utilities since Group Bill with other units check box is checked."),R.Sb())}function tt(t,e){1&t&&(R.Tb(0,"mat-hint",61),R.Rc(1,"Either Map all Utilities with Bill Group or leave all Unmapped."),R.Sb())}function et(t,e){if(1&t&&(R.Tb(0,"th",66),R.Rc(1),R.Sb()),2&t){const t=R.fc(2).$implicit;R.Cb(1),R.Tc(" ",t.name," ")}}function it(t,e){if(1&t&&(R.Tb(0,"td",67),R.Rc(1),R.Sb()),2&t){const t=e.$implicit,i=R.fc(2).$implicit;R.Cb(1),R.Tc(" ",t[i.property]," ")}}function lt(t,e){if(1&t&&(R.Rb(0,63),R.Pc(1,et,2,1,"th",64),R.Pc(2,it,2,1,"td",65),R.Qb()),2&t){const t=R.fc().$implicit;R.mc("matColumnDef",t.property)}}function nt(t,e){if(1&t&&(R.Rb(0),R.Pc(1,lt,3,1,"ng-container",62),R.Qb()),2&t){const t=e.$implicit;R.Cb(1),R.mc("ngIf",t.isModelProperty)}}function at(t,e){1&t&&R.Ob(0,"th",68)}function ot(t,e){1&t&&(R.Tb(0,"mat-icon",71),R.Rc(1,"delete"),R.Sb())}function rt(t,e){if(1&t){const t=R.Ub();R.Tb(0,"td",69),R.bc("click",(function(){R.Ec(t);const i=e.$implicit;return R.fc().deleteOwnerBillGroup(i)})),R.Pc(1,ot,2,0,"mat-icon",70),R.Sb()}if(2&t){const t=R.fc();R.Cb(1),R.mc("ngIf","delete"!=t.mode)}}function st(t,e){1&t&&R.Ob(0,"tr",72)}function ct(t,e){1&t&&R.Ob(0,"tr",73)}function ut(t,e){1&t&&(R.Tb(0,"mat-label"),R.Rc(1,"Reason for Contract Suspend"),R.Sb())}function dt(t,e){1&t&&R.Ob(0,"textarea",75)}function ht(t,e){if(1&t&&(R.Tb(0,"mat-form-field",35),R.Pc(1,ut,2,0,"mat-label",23),R.Pc(2,dt,1,0,"textarea",74),R.Sb()),2&t){const t=R.fc();R.Cb(1),R.mc("ngIf",t.isDeleteMode()),R.Cb(1),R.mc("ngIf",t.isDeleteMode())}}function mt(t,e){if(1&t&&(R.Tb(0,"button",76),R.Rc(1,"CREATE CONTRACT"),R.Sb()),2&t){const t=R.fc();R.mc("disabled",!t.form.valid||1==t.billGroupMsg||(null==t.selectedUserUtilities?null:t.selectedUserUtilities.length)>0&&(null==t.selectedUserUtilities?null:t.selectedUserUtilities.length)!=(null==t.metadataUtilityTypes?null:t.metadataUtilityTypes.length))}}function bt(t,e){if(1&t&&(R.Tb(0,"button",77),R.Rc(1,"UPDATE CONTRACT"),R.Sb()),2&t){const t=R.fc();R.mc("disabled",!t.form.valid||1==t.billGroupMsg||(null==t.selectedUserUtilities?null:t.selectedUserUtilities.length)>0&&(null==t.selectedUserUtilities?null:t.selectedUserUtilities.length)!=(null==t.metadataUtilityTypes?null:t.metadataUtilityTypes.length))}}function ft(t,e){if(1&t&&(R.Tb(0,"button",76),R.Rc(1,"RENEW CONTRACT"),R.Sb()),2&t){const t=R.fc();R.mc("disabled",!t.form.valid||1==t.billGroupMsg||(null==t.selectedUserUtilities?null:t.selectedUserUtilities.length)>0&&(null==t.selectedUserUtilities?null:t.selectedUserUtilities.length)!=(null==t.metadataUtilityTypes?null:t.metadataUtilityTypes.length))}}function pt(t,e){if(1&t&&(R.Tb(0,"button",76),R.Rc(1,"SUSPEND CONTRACT"),R.Sb()),2&t){const t=R.fc();R.mc("disabled",!t.form.valid)}}let gt=(()=>{class t{constructor(t,e,i,l,n,a,o,r){this.defaults=t,this.fb=e,this.datePipe=i,this.dialog=l,this.contractService=n,this.masterService=a,this.dialogRef=o,this.cookieService=r,this.securityDepositExist=!1,this.selectedUtilities=[],this.selectedUserUtilities=[],this.selectedDBUtilities=[],this.selectedData=[],this.groupId=1,this.isDuplicate=!1,this.isCancel=!1,this.isAssignToOwner=!1,this.isUtilitiesMapped=!1,this.type="End",this.error={isError:!1,errorMessage:""},this.mode="create",this.isDisabled=!0,this.show=!1,this.subject$=new m.a(1),this.data$=this.subject$.asObservable(),this.billGroupMsg=!1,this.securityDeposit=0,this.receivedAmount=0,this.refundAmount=0,this.currency=Object(x.e)("Currency",0),this.roundFormat=Object(x.e)("RoundOff"),this.displayedColumns=[{name:"Bill Group",property:"groupId",visible:!0,isModelProperty:!0},{name:"Utility TypeId",property:"utilityTypeId",visible:!1,isModelProperty:!0},{name:"Utility Type",property:"utilityType",visible:!0,isModelProperty:!0},{name:"Differentiate Consumption",property:"isDifferenciateConsumption",visible:!0,isModelProperty:!0},{name:"Modify",property:"actions",visible:!0}],this.billGroupSelected=!1,this.defaults&&this.defaults.type&&(this.type=this.defaults.type),o.disableClose=!0}get visibleColumns(){return this.displayedColumns.filter(t=>t.visible).map(t=>t.property)}ngOnInit(){this.clientId=parseInt(this.cookieService.get("globalClientId")),this.defaults?(this.isDisabled=!0,this.selectedUserUtilities=this.selectedDBUtilities=this.defaults.ownerBillGroups):(this.defaults=new v({}),this.isDisabled=!1),this.securityDeposit=this.defaults.securityDeposit,this.receivedAmount=this.defaults.receivedAmount,this.refundAmount=this.defaults.refundAmount,this.clientId=parseInt(this.cookieService.get("globalClientId")),this.contractService.getTenants(this.clientId).subscribe(t=>{this.filteredTenants=this.metadataTenant=t.map(t=>new S.a(t))}),this.defaults&&this.defaults.unitId&&this.getUtilitiDetails(this.defaults.unitId),this.contractService.getUnits(this.clientId).subscribe(t=>{this.metadataUnit=this.filteredUnits=t.map(t=>new T.a(t)),this.metadataUnit=this.filteredUnits}),this.masterService.getSystemMasterdata(4,0).subscribe(t=>{this.metadataContractType=this.filteredContractTypes=t}),this.form=this.fb.group({id:[this.defaults.id||t.id++],contractDate:[this.defaults.contractDate||"",n.y.required],tenantId:[this.defaults.tenantId||"",n.y.required],tenantName:[this.defaults.tenantName||"",n.y.required],unitId:[this.defaults.unitId||"",n.y.required],unitNumber:[this.defaults.unitNumber||"",n.y.required],utilityType:[""],contractTypeId:[this.defaults.contractTypeId||"",n.y.required],contractType:[this.defaults.contractType||"",n.y.required],contractEndDate:[(this.defaults.contractSuspendDate&&"Suspend"===this.defaults.type?this.defaults.contractSuspendDate:this.defaults.contractEndDate)||"",n.y.required],reasonForContractSuspend:[this.defaults.reasonForContractSuspend||""],accountNumber:[this.defaults.accountNumber||""],isSecurityDepositPaid:[this.defaults.isSecurityDepositPaid||!1],securityDeposit:[this.defaults.securityDeposit||"",n.y.pattern(/^\d*.?\d{0,1}$/g)],receivedAmount:[this.defaults.receivedAmount||0],refundAmount:[this.defaults.refundAmount||0],isAssignToOwner:[this.defaults.isAssignToOwner||!1],isGroupBill:[this.defaults.isGroupBill||!1],isDifferenciateConsumption:[!1],ownerBillGroups:[this.defaults.ownerBillGroups],billGroup:[""]}),this.defaults&&this.defaults.isSecurityDepositPaid&&(this.securityDepositExist=this.defaults.isSecurityDepositPaid),this.selectedData&&0==this.selectedData.length&&this.form.controls.isDifferenciateConsumption.disable(),this.validateSecurityDeposit(this.securityDepositExist),this.defaults&&(this.billGroupSelected=this.form.controls.isGroupBill.value,"update"===this.defaults.mode?(this.form.get("contractDate").disable(),this.form.get("contractEndDate").disable(),this.form.get("receivedAmount").disable(),this.form.get("refundAmount").disable(),this.mode="update",this.securityDepositExist=this.defaults.isSecurityDepositPaid):"renew"===this.defaults.mode?(this.form.get("tenantName").disable(),this.form.get("unitNumber").disable(),this.form.get("contractType").disable(),this.form.get("accountNumber").disable(),this.form.get("receivedAmount").disable(),this.form.get("refundAmount").disable(),this.securityDepositExist=this.defaults.isSecurityDepositPaid,this.mode="renew"):"delete"===this.defaults.mode&&(this.isAssignToOwner=this.defaults.isAssignToOwner,this.form.get("contractEndDate").setValue(new Date),this.form.get("contractEndDate").disable(),this.form.get("contractDate").disable(),this.form.get("tenantName").disable(),this.form.get("unitNumber").disable(),this.form.get("utilityType").disable(),this.form.get("contractType").disable(),this.form.get("receivedAmount").disable(),this.form.get("refundAmount").disable(),this.form.get("accountNumber").disable(),this.form.get("isSecurityDepositPaid").disable(),this.form.get("securityDeposit").disable(),this.form.get("isGroupBill").disable(),this.form.get("billGroup").disable(),this.form.get("isDifferenciateConsumption").disable(),this.securityDepositExist=this.defaults.isSecurityDepositPaid,this.mode="delete",this.fb.group({reasonForContractSuspend:[this.defaults.reasonForContractSuspend||""]}))),this.show=!1,this.subject$.next(this.selectedUserUtilities),this.dataSource=new h.k(this.selectedUserUtilities),this.data$.pipe(Object(b.a)(t=>!!t)).subscribe(t=>{this.selectedUtilities=t,this.dataSource.data=t}),this.form.controls.tenantName.valueChanges.subscribe(t=>{this.filteredTenants=this.filterTenant(t)}),this.form.controls.unitNumber.valueChanges.subscribe(t=>{this.filteredUnits=this.filterUnit(t)}),this.form.controls.contractType.valueChanges.subscribe(t=>{this.filteredContractTypes=this.filterContractType(t)})}getTenants(){this.filteredTenants=this.filterTenant("")}filterTenant(t){return this.form.controls.tenantName.pristine&&"create"!=this.mode?[]:this.metadataTenant.filter(e=>0===e.description.toLowerCase().indexOf(t.toLowerCase()))}filterUnit(t){return this.metadataUnit.filter(e=>0===e.description.toLowerCase().indexOf(t.toLowerCase()))}filterContractType(t){return this.metadataContractType.filter(e=>0===e.description.toLowerCase().indexOf(t.toLowerCase()))}getUtilitiDetails(t){this.contractService.getUtilityDetails(this.clientId,t).subscribe(t=>{this.metadataUtilityTypes=this.filteredUtilityTypes=t})}amountInputChanged(t){let e=t.replace(",","");return Number(e)}save(){this.isCancel?(this.isCancel=!1,this.dialog.open(w.a,{data:{label:"Are you sure you want to Cancel?",selected:!1}}).afterClosed().subscribe(t=>{t&&this.dialogRef.close()})):"create"===this.mode?this.createContract():"update"!==this.mode&&"renew"!==this.mode&&"delete"!==this.mode||this.updateContract()}createContract(){Object.assign(this.defaults,this.form.value),this.defaults.contractDate=this.datePipe.transform(this.defaults.contractDate,"yyyy-MM-dd"),this.defaults.contractEndDate=this.datePipe.transform(this.defaults.contractEndDate,"yyyy-MM-dd"),this.defaults.securityDeposit=1==this.securityDepositExist?this.form.get("securityDeposit").value:0,this.defaults.ownerBillGroups=this.selectedDBUtilities,this.defaults.clientId=this.clientId,this.defaults.securityDeposit=parseFloat(""==this.form.controls.securityDeposit.value?"0":this.form.controls.securityDeposit.value),this.defaults.receivedAmount=parseFloat(""==this.form.controls.receivedAmount.value?"0":this.form.controls.receivedAmount.value),this.defaults.refundAmount=parseFloat(""==this.form.controls.refundAmount.value?"0":this.form.controls.refundAmount.value),this.dialogRef.close(new v(this.defaults))}updateContract(){Object.assign(this.defaults,this.form.value),this.defaults.contractDate=this.datePipe.transform(this.defaults.contractDate,"yyyy-MM-dd"),this.defaults.contractSuspendDate&&(this.defaults.contractSuspendDate=this.datePipe.transform(this.defaults.contractSuspendDate,"yyyy-MM-dd")),this.defaults.contractEndDate&&(this.defaults.contractDate=this.datePipe.transform(this.defaults.contractDate,"yyyy-MM-dd")),this.defaults.mode=this.mode,this.defaults.securityDeposit=1==this.securityDepositExist?parseFloat(this.form.get("securityDeposit").value.replace(",","")):0,this.defaults.ownerBillGroups=this.selectedDBUtilities,this.defaults.clientId=this.clientId,this.defaults.securityDeposit=parseFloat(""==this.form.controls.securityDeposit.value?"0":this.form.controls.securityDeposit.value),this.defaults.receivedAmount=parseFloat(""==this.form.controls.receivedAmount.value?"0":this.form.controls.receivedAmount.value),this.defaults.refundAmount=parseFloat(""==this.form.controls.refundAmount.value?"0":this.form.controls.refundAmount.value),this.dialogRef.close(this.defaults)}isCreateMode(){return"create"===this.mode}isUpdateMode(){return"update"===this.mode}isRenewMode(){return"renew"===this.mode}isDeleteMode(){return"delete"===this.mode}selectTenant(t){this.metadataTenant.forEach(e=>{t.option.value==e.description&&this.form.controls.tenantId.setValue(e.id)})}selectUnit(t){this.metadataUnit.forEach(e=>{t.option.value==e.description&&(this.form.controls.unitId.setValue(e.id),this.onUnitSelect(e.id))})}selectUtilityType(t){this.metadataUtilityTypes.forEach(e=>{t.option.value==e.utilityType&&this.form.controls.utilityTypeId.setValue(e.id)})}selectContractType(t){this.metadataContractType.forEach(e=>{t.option.value==e.description&&this.form.controls.contractTypeId.setValue(e.id)})}onUnitSelect(t){this.contractService.getSecurityDeposit(t).subscribe(t=>{0!=t&&this.form.controls.securityDeposit.setValue(t),0==this.form.controls.isSecurityDepositPaid.value&&this.form.get("securityDeposit").disable()}),this.getUtilitiDetails(t)}toggleSecurityDeposit(t){this.securityDepositExist=!t,this.validateSecurityDeposit(this.securityDepositExist)}validateSecurityDeposit(t){t?(this.form.get("securityDeposit").enable(),this.form.get("securityDeposit").setValidators([n.y.required]),this.form.get("securityDeposit").updateValueAndValidity()):(this.form.get("securityDeposit").setValue(""),this.form.get("securityDeposit").clearValidators(),this.form.get("securityDeposit").updateValueAndValidity(),this.form.get("securityDeposit").disable())}validateDates(){this.startDate=this.datePipe.transform(this.form.get("contractDate").value,"MM-dd-yyyy"),this.endDate=this.datePipe.transform(this.form.get("contractEndDate").value,"MM-dd-yyyy"),this.isValidDate=!0;var t=new Date(this.startDate).getFullYear(),e=new Date(this.endDate).getFullYear();return 1970==t||1970==e||t<e?this.isValidDate:t>e?(this.isValidDate=!1,this.isValidDate):null==this.startDate&&""==this.startDate||null==this.endDate&&""==this.endDate?void 0:(this.endDate<=this.startDate&&(this.isValidDate=!1),this.isValidDate)}deleteOwnerBillGroup(t){this.dialog.open(P.a).afterClosed().subscribe(e=>{if(e){if(1==t.isDifferenciateConsumption){let e=this.selectedUserUtilities.findIndex(e=>e.isDifferenciateConsumption===t.isDifferenciateConsumption&&e.groupId==t.groupId);e>-1&&this.selectedUserUtilities.splice(e,2)}else this.selectedUserUtilities.splice(this.selectedUserUtilities.findIndex("create"==this.mode?e=>e.meterId===t.meterId:e=>e.utilityType===t.utilityType),1);this.isDuplicate=!1,this.subject$.next(this.selectedUserUtilities),this.enableorDisableBillGroup(),this.checkUtilityMapping()}})}enableorDisableBillGroup(){this.selectedUserUtilities&&this.selectedUserUtilities.forEach(t=>{let e=this.selectedUserUtilities.filter(e=>e.groupId!=t.groupId);e&&e.length>0?this.form.controls.isGroupBill.disable():this.form.controls.isGroupBill.enable()})}toggleAllSelection(){this.form.controls.utilityType.patchValue(this.allSelected.selected?[...this.metadataUtilityTypes.map(t=>t.id),0]:[])}togglePerOne(){this.allSelected.selected&&this.allSelected.deselect();let t=this.selectedData.text.replace(/\s/g,"").split(",");if("Select All"==t[0]&&(t=t.splice(1)),this.form.controls.isDifferenciateConsumption.enable(),t&&1==t.length)this.form.controls.isDifferenciateConsumption.setValue(!1),this.form.controls.isDifferenciateConsumption.disable();else if(t&&t.length>2)this.form.controls.isDifferenciateConsumption.setValue(!1),this.form.controls.isDifferenciateConsumption.disable();else if(t&&2==t.length){let e=t.filter(e=>e.substring(0,e.indexOf("-"))!=t[0].substring(0,t[0].indexOf("-")));e&&e.length>0&&(this.form.controls.isDifferenciateConsumption.setValue(!1),this.form.controls.isDifferenciateConsumption.disable())}this.form.controls.utilityType.value.length==this.metadataUtilityTypes.length&&this.allSelected.select()}validateDifferenciateConsumption(){this.validateBillGroup();let t=this.selectedData.text.replace(/\s/g,"").split(",");"Select All"==t[0]&&(t=t.splice(1));let e=t.filter(e=>e.substring(0,e.indexOf("-"))==t[0].substring(0,t[0].indexOf("-"))),i=this.selectedUserUtilities.filter(t=>1==t.isDifferenciateConsumption&&this.billGroupId==t.groupId);i&&i.length>0?(this.form.controls.isDifferenciateConsumption.setValue(!1),this.form.controls.isDifferenciateConsumption.disable()):2==e.length&&2==t.length&&(this.form.controls.isDifferenciateConsumption.setValue(!1),this.form.controls.isDifferenciateConsumption.enable())}selectedValue(t){this.selectedData={value:t.value,text:t.source.triggerValue}}checkDuplication(){this.isDuplicate=!1;for(let t=0;t<this.selectedDBUtilities.length;t++)if(this.selectedUtilities.indexOf(this.selectedDBUtilities[t].meterId)>=0)return this.isDuplicate=!0,this.isDuplicate;return this.isDuplicate}addBillGroup(){var t,e,i,l,n;if(this.selectedUtilities.length>0&&this.billGroupId>0&&null!=this.billGroupId&&null!=this.billGroupId&&!this.checkDuplication()){null===(t=this.selectedData)||void 0===t||t.text.split(",");for(let t=0;t<this.selectedUtilities.length;++t)0!=this.selectedUtilities[t]&&this.selectedDBUtilities.push({meterId:this.selectedUtilities[t],utilityTypeId:null===(i=null===(e=this.filteredUtilityTypes)||void 0===e?void 0:e.find(e=>e.id===this.selectedUtilities[t]))||void 0===i?void 0:i.utilityTypeId,utilityType:null===(n=null===(l=this.filteredUtilityTypes)||void 0===l?void 0:l.find(e=>e.id===this.selectedUtilities[t]))||void 0===n?void 0:n.utilityType,ownerId:this.form.controls.tenantId.value,groupId:this.billGroupId,isDifferenciateConsumption:1==this.form.controls.isDifferenciateConsumption.value});let a=this.form.controls.utilityType.value,o=a.findIndex(t=>0===t);o>=0&&a.splice(o,1);let r="";this.selectedData.text.indexOf("Select All")>=0?(this.metadataUtilityTypes.forEach(t=>{r+=t.utilityType+","}),r=r.substr(0,r.length-1)):r=this.selectedData.text,this.selectedUserUtilities=this.selectedDBUtilities,this.enableorDisableBillGroup(),this.subject$.next(this.selectedUserUtilities),this.form.controls.utilityType.reset(),this.form.controls.billGroup.reset(),this.form.controls.isDifferenciateConsumption.reset(),this.selectedUtilities=null,this.checkUtilityMapping()}}checkUtilityMapping(){var t,e,i;this.isUtilitiesMapped=(null===(t=this.selectedUserUtilities)||void 0===t?void 0:t.length)>0&&(null===(e=this.selectedUserUtilities)||void 0===e?void 0:e.length)!=(null===(i=this.metadataUtilityTypes)||void 0===i?void 0:i.length)}enableAssignToOwnerCheckChanged(t){this.isAssignToOwner=t.checked}validateBillGroup(){if(1==this.billGroupSelected&&this.selectedUserUtilities&&null!=this.billGroupId){let t=this.selectedUserUtilities.filter(t=>t.groupId!=this.billGroupId);t&&t.length>0&&(this.billGroupMsg=!0)}else this.billGroupMsg=!1}checkValue(){this.billGroupSelected=this.form.controls.isGroupBill.value,this.validateBillGroup()}close(){this.dialogRef.close()}closeDialog(){this.isCancel=!0}searchContractType(t){let e=this.selectFilteredContractType(t.toLowerCase());this.filteredContractTypes=e}selectFilteredContractType(t){let e=[];if(!t)return this.metadataContractType;for(let i of this.metadataContractType)i.description.toLowerCase().indexOf(t)>-1&&e.push(i);return e}}return t.id=100,t.\u0275fac=function(e){return new(e||t)(R.Nb(C.a),R.Nb(n.f),R.Nb(l.f),R.Nb(C.b),R.Nb(g.a),R.Nb(D.a),R.Nb(C.h),R.Nb(A.a))},t.\u0275cmp=R.Hb({type:t,selectors:[["contract-create-update"]],viewQuery:function(t,e){var i;1&t&&R.Vc($,!0),2&t&&R.zc(i=R.cc())&&(e.allSelected=i.first)},inputs:{displayedColumns:"displayedColumns"},decls:146,vars:56,consts:[["mat-dialog-title",""],["role","toolbar",1,"task-header"],[1,"fx-spacer"],["mat-icon-button","",3,"click"],["title","Close","mat-list-icon",""],[3,"formGroup","ngSubmit"],[1,"mat-dlg-content"],[1,"person"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","20px"],["fxFlex","33%"],["id","txtContractDate","formControlName","contractDate","matInput","",3,"matDatepicker","disabled","click"],["matSuffix","",3,"for"],["formDatepickerRef",""],[3,"ctrl"],["matInput","","formControlName","tenantName",3,"matAutocomplete","click"],[3,"optionSelected"],["tenant","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["matInput","","formControlName","unitNumber",3,"matAutocomplete"],["unit","matAutocomplete"],[1,"person","padding-top"],["formControlName","contractEndDate","matInput","",3,"matDatepicker","click"],["formDatepickerRef1",""],[4,"ngIf"],["matInput","","formControlName","contractType",3,"matAutocomplete","keydown"],["contractType","matAutocomplete"],["type","text","formControlName","accountNumber","maxlength","48","matInput","","id","accountNumber","oninput","javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"],["fxFlex","33%",1,"formulaLabel"],["color","primary","formControlName","isSecurityDepositPaid",1,"formulaLabel",3,"change"],["fxFlex","31%"],["type","textbox","formControlName","securityDeposit","matInput","","furyValidateDecimalPlacesDirective","",3,"ngModel"],["type","number","formControlName","receivedAmount","readonly","","matInput","","maxlength","7",3,"ngModel"],["type","number","formControlName","refundAmount","readonly","","matInput","","maxlength","7",3,"ngModel"],["class","formulaLabel","fxFlex","25%",4,"ngIf"],["color","primary","formControlName","isGroupBill",1,"isGroupBill",3,"change"],["fxFlex",""],["multiple","","formControlName","utilityType",3,"ngModel","ngModelChange","selectionChange"],[3,"value","click"],["allSelected",""],[3,"value","click",4,"ngFor","ngForOf"],["fxFlex","28%"],["type","number","formControlName","billGroup","matInput","","maxlength","5","placeholder","Bill Group Number",3,"ngModel","ngModelChange","keyup"],["fxLayout","column","fxLayoutGap.gt-sm","20px",2,"padding-top","15px"],["color","primary","formControlName","isDifferenciateConsumption",1,"isDifferenciateConsumption"],["type","button","mat-mini-fab","","color","primary",3,"disabled","click"],["style","color: red;font-size: smaller;",4,"ngIf"],["mat-table","","matSort","","align","center",1,"padding-top",3,"dataSource"],[4,"ngFor","ngForOf"],["matColumnDef","actions"],["class","actions-cell","mat-header-cell","",4,"matHeaderCellDef"],["class","actions-cell","mat-cell","",3,"click",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["class","clickable route-animations-elements","mat-row","",4,"matRowDef","matRowDefColumns"],["fxFlex","",4,"ngIf"],["fxLayout","row","fxLayoutAlign","end center"],["mat-button","",3,"click"],["mat-button","",3,"disabled",4,"ngIf"],["id","button","mat-button","",3,"disabled",4,"ngIf"],[3,"value"],["fxFlex","25%",1,"formulaLabel"],["color","primary","formControlName","isAssignToOwner",1,"formulaLabel",3,"change"],[2,"color","red","font-size","smaller"],[3,"matColumnDef",4,"ngIf"],[3,"matColumnDef"],["mat-header-cell","","mat-sort-header","","style","padding-left: 20px;",4,"matHeaderCellDef"],["mat-cell","","style","padding-left: 20px;",4,"matCellDef"],["mat-header-cell","","mat-sort-header","",2,"padding-left","20px"],["mat-cell","",2,"padding-left","20px"],["mat-header-cell","",1,"actions-cell"],["mat-cell","",1,"actions-cell",3,"click"],["style","margin-left: 20px;","class","deleteIcon",4,"ngIf"],[1,"deleteIcon",2,"margin-left","20px"],["mat-header-row",""],["mat-row","",1,"clickable","route-animations-elements"],["type","text","formControlName","reasonForContractSuspend","matInput","",4,"ngIf"],["type","text","formControlName","reasonForContractSuspend","matInput",""],["mat-button","",3,"disabled"],["id","button","mat-button","",3,"disabled"]],template:function(t,e){if(1&t){const t=R.Ub();R.Tb(0,"div",0),R.Tb(1,"mat-toolbar",1),R.Tb(2,"span"),R.Rc(3,"Contract"),R.Sb(),R.Ob(4,"span",2),R.Tb(5,"button",3),R.bc("click",(function(){return e.close()})),R.Tb(6,"mat-icon",4),R.Rc(7,"close"),R.Sb(),R.Sb(),R.Sb(),R.Sb(),R.Tb(8,"form",5),R.bc("ngSubmit",(function(){return e.save()})),R.Tb(9,"mat-dialog-content",6),R.Tb(10,"fury-card"),R.Tb(11,"fury-card-content"),R.Tb(12,"div",7),R.Tb(13,"div",8),R.Tb(14,"mat-form-field",9),R.Tb(15,"mat-label"),R.Rc(16,"Contract Date"),R.Sb(),R.Tb(17,"input",10),R.bc("click",(function(){return R.Ec(t),R.Ac(20).open()})),R.Sb(),R.Ob(18,"mat-datepicker-toggle",11),R.Ob(19,"mat-datepicker",null,12),R.Ob(21,"app-show-errors",13),R.Tb(22,"mat-hint"),R.Rc(23,"Please select Contract Date"),R.Sb(),R.Sb(),R.Tb(24,"mat-form-field",9),R.Tb(25,"mat-label"),R.Rc(26,"Tenant"),R.Sb(),R.Tb(27,"input",14),R.bc("click",(function(){return e.getTenants()})),R.Sb(),R.Tb(28,"mat-autocomplete",15,16),R.bc("optionSelected",(function(t){return e.selectTenant(t)})),R.Pc(30,V,2,2,"mat-option",17),R.Sb(),R.Ob(31,"app-show-errors",13),R.Tb(32,"mat-hint"),R.Rc(33,"Please select a Tenant"),R.Sb(),R.Sb(),R.Tb(34,"mat-form-field",9),R.Tb(35,"mat-label"),R.Rc(36,"Unit"),R.Sb(),R.Ob(37,"input",18),R.Tb(38,"mat-autocomplete",15,19),R.bc("optionSelected",(function(t){return e.selectUnit(t)})),R.Pc(40,_,2,2,"mat-option",17),R.Sb(),R.Ob(41,"app-show-errors",13),R.Tb(42,"mat-hint"),R.Rc(43,"Please select a Unit"),R.Sb(),R.Sb(),R.Sb(),R.Sb(),R.Tb(44,"div",7),R.Ob(45,"div",8),R.Sb(),R.Tb(46,"div",20),R.Tb(47,"div",8),R.Tb(48,"mat-form-field",9),R.Tb(49,"mat-label"),R.Rc(50),R.Sb(),R.Tb(51,"input",21),R.bc("click",(function(){return R.Ec(t),R.Ac(54).open()})),R.Sb(),R.Ob(52,"mat-datepicker-toggle",11),R.Ob(53,"mat-datepicker",null,22),R.Ob(55,"app-show-errors",13),R.Tb(56,"mat-hint"),R.Rc(57),R.Sb(),R.Pc(58,X,2,1,"small",23),R.Sb(),R.Tb(59,"mat-form-field",9),R.Tb(60,"mat-label"),R.Rc(61,"Contract Type"),R.Sb(),R.Tb(62,"input",24),R.bc("keydown",(function(t){return e.searchContractType(t.target.value)})),R.Sb(),R.Tb(63,"mat-autocomplete",15,25),R.bc("optionSelected",(function(t){return e.selectContractType(t)})),R.Pc(65,q,2,2,"mat-option",17),R.Sb(),R.Ob(66,"app-show-errors",13),R.Tb(67,"mat-hint"),R.Rc(68,"Please select a Contract Type"),R.Sb(),R.Sb(),R.Tb(69,"mat-form-field",9),R.Tb(70,"mat-label"),R.Rc(71,"Reference Number"),R.Sb(),R.Ob(72,"input",26),R.Sb(),R.Sb(),R.Tb(73,"div",20),R.Tb(74,"div",8),R.Tb(75,"div",27),R.Tb(76,"mat-checkbox",28),R.bc("change",(function(){return e.toggleSecurityDeposit(e.securityDepositExist)})),R.Rc(77," Security Deposit "),R.Sb(),R.Sb(),R.Tb(78,"mat-form-field",29),R.Tb(79,"mat-label"),R.Rc(80,"Security Deposit Amount"),R.Sb(),R.Ob(81,"input",30),R.gc(82,"noComma"),R.gc(83,"number"),R.Sb(),R.Tb(84,"mat-form-field",29),R.Tb(85,"mat-label"),R.Rc(86,"Received Amount"),R.Sb(),R.Ob(87,"input",31),R.gc(88,"noComma"),R.gc(89,"number"),R.Sb(),R.Tb(90,"mat-form-field",29),R.Tb(91,"mat-label"),R.Rc(92,"Refunded Amount"),R.Sb(),R.Ob(93,"input",32),R.gc(94,"noComma"),R.gc(95,"number"),R.Sb(),R.Pc(96,K,3,0,"div",33),R.Sb(),R.Sb(),R.Tb(97,"div",20),R.Tb(98,"div",8),R.Rc(99," Bill Grouping "),R.Sb(),R.Tb(100,"div",8),R.Tb(101,"mat-checkbox",34),R.bc("change",(function(){return e.checkValue()})),R.Rc(102," Group bill with other units"),R.Sb(),R.Sb(),R.Sb(),R.Tb(103,"div",20),R.Tb(104,"div",8),R.Tb(105,"mat-form-field",35),R.Tb(106,"mat-label"),R.Rc(107,"Utility Type"),R.Sb(),R.Tb(108,"mat-select",36),R.bc("ngModelChange",(function(t){return e.selectedUtilities=t}))("selectionChange",(function(t){return e.selectedValue(t)})),R.Tb(109,"mat-option",37,38),R.bc("click",(function(){return e.toggleAllSelection()})),R.Rc(111,"Select All"),R.Sb(),R.Pc(112,Q,2,2,"mat-option",39),R.Sb(),R.Tb(113,"mat-hint"),R.Rc(114,"Please select a Utility Type"),R.Sb(),R.Pc(115,Z,2,0,"small",23),R.Sb(),R.Tb(116,"mat-form-field",40),R.Tb(117,"input",41),R.bc("ngModelChange",(function(t){return e.billGroupId=t}))("keyup",(function(){return e.validateDifferenciateConsumption()})),R.Sb(),R.Tb(118,"mat-hint"),R.Rc(119,"Please enter Bill Group Number"),R.Sb(),R.Sb(),R.Tb(120,"div",42),R.Tb(121,"mat-checkbox",43),R.Rc(122,"Differenciate Consumption"),R.Sb(),R.Sb(),R.Tb(123,"button",44),R.bc("click",(function(){return e.addBillGroup()})),R.Tb(124,"mat-icon"),R.Rc(125,"add"),R.Sb(),R.Sb(),R.Sb(),R.Sb(),R.Pc(126,J,2,0,"mat-hint",45),R.Ob(127,"br"),R.Pc(128,tt,2,0,"mat-hint",45),R.Tb(129,"table",46),R.Pc(130,nt,2,1,"ng-container",47),R.Rb(131,48),R.Pc(132,at,1,0,"th",49),R.Pc(133,rt,2,1,"td",50),R.Qb(),R.Pc(134,st,1,0,"tr",51),R.Pc(135,ct,1,0,"tr",52),R.Sb(),R.Sb(),R.Tb(136,"div",20),R.Tb(137,"div",8),R.Pc(138,ht,3,2,"mat-form-field",53),R.Sb(),R.Sb(),R.Sb(),R.Sb(),R.Sb(),R.Tb(139,"mat-dialog-actions",54),R.Tb(140,"button",55),R.bc("click",(function(){return e.closeDialog()})),R.Rc(141,"CANCEL"),R.Sb(),R.Pc(142,mt,2,1,"button",56),R.Pc(143,bt,2,1,"button",57),R.Pc(144,ft,2,1,"button",56),R.Pc(145,pt,2,1,"button",56),R.Sb(),R.Sb()}if(2&t){const t=R.Ac(20),i=R.Ac(29),l=R.Ac(39),n=R.Ac(54),a=R.Ac(64);R.Cb(8),R.mc("formGroup",e.form),R.Cb(9),R.mc("matDatepicker",t)("disabled",e.isDisabled),R.Cb(1),R.mc("for",t),R.Cb(3),R.mc("ctrl",null==e.form?null:e.form.get("contractDate")),R.Cb(6),R.mc("matAutocomplete",i),R.Cb(3),R.mc("ngForOf",e.filteredTenants),R.Cb(1),R.mc("ctrl",null==e.form?null:e.form.get("tenantId")),R.Cb(6),R.mc("matAutocomplete",l),R.Cb(3),R.mc("ngForOf",e.filteredUnits),R.Cb(1),R.mc("ctrl",null==e.form?null:e.form.get("unitId")),R.Cb(9),R.Tc("Contract ",e.type," Date"),R.Cb(1),R.mc("matDatepicker",n),R.Cb(1),R.mc("for",n),R.Cb(3),R.mc("ctrl",e.form.get("contractEndDate")),R.Cb(2),R.Tc("Please select ",e.type," Date"),R.Cb(1),R.mc("ngIf",!e.validateDates()),R.Cb(4),R.mc("matAutocomplete",a),R.Cb(3),R.mc("ngForOf",e.filteredContractTypes),R.Cb(1),R.mc("ctrl",null==e.form?null:e.form.get("contractTypeId")),R.Cb(15),R.mc("ngModel",R.hc(82,41,R.ic(83,43,e.securityDeposit,e.roundFormat))),R.Cb(6),R.mc("ngModel",R.hc(88,46,R.ic(89,48,e.receivedAmount,e.roundFormat))),R.Cb(6),R.mc("ngModel",R.hc(94,51,R.ic(95,53,e.refundAmount,e.roundFormat))),R.Cb(3),R.mc("ngIf",e.isAssignToOwner),R.Cb(12),R.mc("ngModel",e.selectedUtilities),R.Cb(1),R.mc("value",0),R.Cb(3),R.mc("ngForOf",e.metadataUtilityTypes),R.Cb(3),R.mc("ngIf",e.isDuplicate),R.Cb(2),R.mc("ngModel",e.billGroupId),R.Cb(6),R.mc("disabled",1==e.billGroupMsg||"delete"==e.mode||0==(null==e.selectedUtilities?null:e.selectedUtilities.length)||null==e.billGroupId||null==e.billGroupId||e.billGroupId<=0),R.Cb(3),R.mc("ngIf",1==e.billGroupMsg),R.Cb(2),R.mc("ngIf",1==e.isUtilitiesMapped),R.Cb(1),R.mc("dataSource",e.dataSource),R.Cb(1),R.mc("ngForOf",e.displayedColumns),R.Cb(4),R.mc("matHeaderRowDef",e.visibleColumns),R.Cb(1),R.mc("matRowDefColumns",e.visibleColumns),R.Cb(3),R.mc("ngIf",e.isDeleteMode()),R.Cb(4),R.mc("ngIf",e.isCreateMode()),R.Cb(1),R.mc("ngIf",e.isUpdateMode()),R.Cb(1),R.mc("ngIf",e.isRenewMode()),R.Cb(1),R.mc("ngIf",e.isDeleteMode())}},directives:[C.i,F.a,I.a,N.a,M.c,n.z,n.r,n.k,C.f,k.a,k.c,O.d,O.e,W.d,O.b,W.h,n.c,U.b,E.b,n.q,n.i,E.d,W.j,E.a,L.a,W.g,z.c,z.a,l.n,l.o,n.m,B.a,j.a,n.u,G.a,Y.n,h.j,d.a,h.c,h.e,h.b,h.g,h.i,C.c,O.c,h.d,d.b,h.a,h.f,h.h],pipes:[H.a,l.g],styles:[".mat-dlg-content[_ngcontent-%COMP%]{margin-left:1px;width:95%;height:fit-to-content}small[_ngcontent-%COMP%]{color:red}.hidden[_ngcontent-%COMP%]{display:none}.contractControls[_ngcontent-%COMP%]{cursor:pointer}.contractControlsDisabled[_ngcontent-%COMP%]{color:rgba(0,0,0,.26)}.formulaLabel[_ngcontent-%COMP%]{clear:both;padding-top:10px}.marginRight[_ngcontent-%COMP%]{margin-right:8%}.reasonForContractEndShow[_ngcontent-%COMP%]{display:block}.reasonForContractEndHide[_ngcontent-%COMP%]{display:none}.securityDeposit[_ngcontent-%COMP%]{align-self:center;margin-left:10px}.securityDepositAmount[_ngcontent-%COMP%]{margin-left:85px;width:400px}.deleteIcon[_ngcontent-%COMP%]{cursor:pointer}.task-header[_ngcontent-%COMP%]{background-color:transparent;padding:0 5px;height:20px}.fx-spacer[_ngcontent-%COMP%]{flex:1 1 auto}"]}),t})();var yt=i("7d4Y"),vt=i("i680"),Ct=(i("DaQG"),i("dNgK"));function St(t,e){if(1&t&&(R.Tb(0,"mat-option",21),R.Rc(1),R.Sb()),2&t){const t=e.$implicit;R.mc("value",t.value),R.Cb(1),R.Tc("",t.label," ")}}const Tt=function(){return{standalone:!0}};let Dt=(()=>{class t{constructor(t,e,i,l,n,a,o){this.data=t,this.dialogRef=e,this.billSettlementService=i,this.snackbar=l,this.fb=n,this.cookieService=a,this.date=o,this.refundDate=new Date,this.amount=0,this.remarks="",this.paymentModeId=0,this.clientId="",this.paymentModes=[{label:"Select",value:0}],this.refundAmount=0,this.errorMessage="",this.refundableAmount=0,this.title="Refund",this.maxDate=new Date,this.currency=Object(x.e)("Currency"),this.roundFormat=Object(x.e)("RoundOff"),this.title=this.data.type,this.dialogRef.disableClose=!0}ngOnInit(){this.clientId=this.cookieService.get("globalClientId"),this.onGetPaymentModes(),this.form=this.fb.group({amount:[""]}),this.data&&"Refund"===this.data.type?(this.refundAmount=this.data.refundAmount,this.refundableAmount=this.data.receivedAmount-this.data.refundAmount,this.amount=this.refundableAmount):this.amount=this.data.remainingAmount}calculateRefundableAmount(t){"Refund"===this.title&&(this.errorMessage="",this.refundableAmount<parseInt(t)&&(this.errorMessage="Refund Amount should not be greater than "+this.refundableAmount),this.amount=t)}onGetPaymentModes(){this.paymentModes=[{label:"Select",value:0}],this.billSettlementService.getPaymentModes().subscribe(t=>{t.forEach(t=>{this.paymentModes.push({label:t.description,value:t.id})})})}onSave(){if(this.amount&&this.paymentModeId&&this.remarks)if("Refund"===this.title){let t=Number(0==this.amount?0:this.amount);const e={ownerId:this.data.tenantId,billType:3,modeOfPayment:this.paymentModeId,clientId:Number(this.clientId),refundDate:this.refundDate,refundAmount:t,remarks:this.remarks};let i=[];if(this.data.billMasters&&this.data.billMasters.length){let e=0;const l=this.data.billMasters.filter(t=>null==t.billNumber);l&&l.length&&l.sort((t,e)=>e.paymentId-t.paymentId).forEach(l=>{if(l.billAmount!=l.previousDueAmount&&t>0){const n=Number(t)-Number(l.paid);n>=0?(e=l.paid,t=n):(e=t,t=0),e>0&&(i.push({paymentId:l.paymentId,refundAmount:e}),e=0)}})}i&&i.length&&(e.refundTransactions=i),this.dialogRef.close(e)}else if(this.amount&&this.paymentModeId&&this.remarks){const t={paymentDate:this.date.transform(this.refundDate,"yyyy-MM-dd"),paymentAmount:Number(this.amount),clientId:Number(this.cookieService.get("globalClientId")),billType:3,ownerId:this.data.tenantId,modeofPayment:this.paymentModeId,remarks:this.remarks,paymentTransactions:[{billId:0,paidAmount:Number(this.amount),advanceAmount:0,isAdvanceAmount:!1}]};this.dialogRef.close(t)}}onChangePaymentMode(t){this.paymentModeId=t}notificationMessage(t,e){this.snackbar.open(t,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[e]})}close(){this.dialogRef.close()}}return t.\u0275fac=function(e){return new(e||t)(R.Nb(C.a),R.Nb(C.h),R.Nb(yt.a),R.Nb(Ct.b),R.Nb(n.f),R.Nb(A.a),R.Nb(l.f))},t.\u0275cmp=R.Hb({type:t,selectors:[["fury-bill-refund"]],decls:42,vars:23,consts:[["mat-dialog-title",""],["role","toolbar",1,"task-header"],[1,"fx-spacer"],["mat-icon-button","",3,"click"],["mat-list-icon",""],[1,"person","padding-top"],[3,"formGroup"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","10px"],["color","primary","fxFlex","",1,"result","columnWidth"],["type","textbox","id","amount","name","amount","formControlName","amount","furyValidateDecimalPlacesDirective","","matInput","",3,"readonly","ngModel","keyup"],[1,"errorMessage"],["id","refundDate","name","refundDate","matInput","","readonly","",3,"ngModelOptions","max","ngModel","matDatepicker","click","ngModelChange","focus"],["matSuffix","",3,"for"],["formDatepickerRef",""],["fxLayout","column padding-top","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","10px"],["id","PaymentMode","name","PaymentMode",3,"value","selectionChange","valueChange"],[3,"value",4,"ngFor","ngForOf"],["type","text","id","remarks","name","remarks","matInput","",3,"ngModelOptions","ngModel","ngModelChange"],[1,"rightAlign"],["mat-button","",3,"click"],["mat-button","",3,"disabled","click"],[3,"value"]],template:function(t,e){if(1&t){const t=R.Ub();R.Tb(0,"h4",0),R.Tb(1,"mat-toolbar",1),R.Tb(2,"span"),R.Rc(3),R.Sb(),R.Ob(4,"span",2),R.Tb(5,"button",3),R.bc("click",(function(){return e.close()})),R.Tb(6,"mat-icon",4),R.Rc(7,"close"),R.Sb(),R.Sb(),R.Sb(),R.Sb(),R.Tb(8,"mat-dialog-content"),R.Tb(9,"div",5),R.Tb(10,"form",6),R.Tb(11,"div",7),R.Tb(12,"mat-form-field",8),R.Tb(13,"mat-label"),R.Rc(14,"Amount"),R.Sb(),R.Tb(15,"input",9),R.bc("keyup",(function(t){return e.calculateRefundableAmount(t.target.value)})),R.gc(16,"noComma"),R.gc(17,"number"),R.Sb(),R.Tb(18,"mat-hint",10),R.Rc(19),R.Sb(),R.Sb(),R.Tb(20,"mat-form-field",8),R.Tb(21,"mat-label"),R.Rc(22),R.Sb(),R.Tb(23,"input",11),R.bc("click",(function(){return R.Ec(t),R.Ac(26).open()}))("ngModelChange",(function(t){return e.refundDate=t}))("focus",(function(){return R.Ec(t),R.Ac(26).open()})),R.Sb(),R.Ob(24,"mat-datepicker-toggle",12),R.Ob(25,"mat-datepicker",null,13),R.Sb(),R.Sb(),R.Tb(27,"div",14),R.Tb(28,"mat-form-field",8),R.Tb(29,"mat-label"),R.Rc(30,"Payment Mode"),R.Sb(),R.Tb(31,"mat-select",15),R.bc("selectionChange",(function(t){return e.onChangePaymentMode(t.value)}))("valueChange",(function(t){return e.paymentModeId=t})),R.Pc(32,St,2,2,"mat-option",16),R.Sb(),R.Sb(),R.Tb(33,"mat-form-field",8),R.Tb(34,"mat-label"),R.Rc(35,"Remarks"),R.Sb(),R.Tb(36,"input",17),R.bc("ngModelChange",(function(t){return e.remarks=t})),R.Sb(),R.Sb(),R.Sb(),R.Tb(37,"div",18),R.Tb(38,"button",19),R.bc("click",(function(){return e.close()})),R.Rc(39,"CANCEL"),R.Sb(),R.Tb(40,"button",20),R.bc("click",(function(){return e.onSave()})),R.Rc(41,"SAVE"),R.Sb(),R.Sb(),R.Sb(),R.Sb(),R.Sb()}if(2&t){const t=R.Ac(26);R.Cb(3),R.Sc(e.title),R.Cb(7),R.mc("formGroup",e.form),R.Cb(5),R.mc("readonly","Refund"!==e.title)("ngModel",R.hc(16,16,R.ic(17,18,e.amount,e.roundFormat))),R.Cb(4),R.Sc(e.errorMessage),R.Cb(3),R.Tc("",e.title," Date"),R.Cb(1),R.mc("ngModelOptions",R.qc(21,Tt))("max",e.maxDate)("ngModel",e.refundDate)("matDatepicker",t),R.Cb(1),R.mc("for",t),R.Cb(7),R.mc("value",e.paymentModeId),R.Cb(1),R.mc("ngForOf",e.paymentModes),R.Cb(4),R.mc("ngModelOptions",R.qc(22,Tt))("ngModel",e.remarks),R.Cb(4),R.mc("disabled",""!=e.errorMessage||e.amount<=0||null==e.refundDate||0==e.paymentModeId||""==e.remarks)}},directives:[C.i,F.a,I.a,N.a,M.c,C.f,n.z,n.r,n.k,O.d,O.e,W.d,O.b,W.h,n.c,U.b,n.q,n.i,j.a,W.g,E.b,n.t,E.d,W.j,E.a,G.a,l.n,Y.n],pipes:[H.a,l.g],styles:[".task-header[_ngcontent-%COMP%]{background-color:transparent;padding:0 5px;height:20px}.fx-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.columnWidth[_ngcontent-%COMP%]{width:270px}.errorMessage[_ngcontent-%COMP%]{color:red}.rightAlign[_ngcontent-%COMP%]{float:right}"]}),t})();var Pt=i("K+kB"),wt=i("lW2b"),xt=i("wd/R");function Rt(t,e){1&t&&(R.Tb(0,"small"),R.Rc(1,"Contract end date should be greater than Contract date."),R.Sb())}let At=(()=>{class t{constructor(t,e,i,l,n,a,o,r){this.data=t,this.dialogRef=e,this.snackbar=i,this.fb=l,this.cookieService=n,this.datePipe=a,this.dialog=o,this.router=r,this.clientId="",this.totalOutstandingAmount=0,this.totalSecurityDepositAmount=0,this.dateFormat=Object(x.e)("DateFormat"),this.currencyFormat=Object(x.e)("Currency"),this.roundFormat=Object(x.e)("RoundOff"),this.checkDues=!0,this.dialogRef.disableClose=!0}ngOnInit(){this.clientId=this.cookieService.get("globalClientId"),this.form=this.fb.group({totalOutstandingAmount:[this.data.previousDueAmount||0],totalSecurityDepositAmount:[this.data.securityDepositInHand||0],contractEndDate:[this.data.contractEndDate||""],reasonForContractEnd:[this.data.reasonForContractEnd||""]}),this.form.get("contractEndDate").setValue(new Date),this.totalOutstandingAmount=this.data.previousDueAmount,this.totalSecurityDepositAmount=this.data.securityDepositInHand,this.checkDues=this.data.checkDues}onEndContract(){let t=!0;const e=this.form.get("contractEndDate").value;if(!this.checkDues)if(this.data&&this.data.billMasters&&this.data.billMasters.length){let i=this.data.billMasters.filter(t=>null!=t.billNumber&&t.billAmount!=t.paid&&this.data.id==t.contractId);if(i&&i.length){let i=this.data.billMasters.filter(t=>null!=t.billNumber).map((function(t){return new Date(t.toDate)}));const l=Math.max.apply(Math,i),n=xt(l).startOf("day");(e?xt(e).startOf("day"):xt().startOf("day"))<=n||(t=!1,this.redirectToFinalBill(e))}}else(xt(e)<=xt()||xt(e).diff(xt(this.data.contractDate),"days")>0)&&(t=!1,this.redirectToFinalBill(e));t&&(Object.assign(this.data,this.form.value),this.data.contractEndDate=this.datePipe.transform(this.data.contractEndDate,"yyyy-MM-dd"),this.data.contractSuspendDate||(this.data.contractSuspendDate=null),this.dialogRef.close(this.data))}redirectToFinalBill(t){this.dialog.open(w.a,{data:{label:"There are unbilled consumptions for this contract. Kindly generate bills for the same.Do you want to redirect to generate page?",selected:!1}}).afterClosed().subscribe(e=>{e?(this.dialogRef.close(),this.dialog.closeAll(),this.router.navigate(["bills/final-bill-settlement"],{queryParams:{id:this.data.tenantId,unit:this.data.unitNumber,settlement_date:this.datePipe.transform(t,"yyyy-MM-dd")}})):(this.dialogRef.close(),this.dialog.closeAll())})}notificationMessage(t,e){this.snackbar.open(t,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[e]})}close(){this.dialogRef.close()}validateDates(){const t=this.datePipe.transform(this.data.contractDate,"MM-dd-yyyy"),e=this.datePipe.transform(this.form.get("contractEndDate").value,"MM-dd-yyyy");let i=!0;var l=new Date(t).getFullYear(),n=new Date(e).getFullYear();return 1970==l||1970==n||l<n?i:l>n?(i=!1,i):null==t&&""==t||null==e&&""==e?void 0:(e<=t&&(i=!1),i)}}return t.\u0275fac=function(e){return new(e||t)(R.Nb(C.a),R.Nb(C.h),R.Nb(Ct.b),R.Nb(n.f),R.Nb(A.a),R.Nb(l.f),R.Nb(C.b),R.Nb(s.f))},t.\u0275cmp=R.Hb({type:t,selectors:[["fury-contract-end-details"]],decls:44,vars:17,consts:[["mat-dialog-title",""],["role","toolbar",1,"task-header"],[1,"fx-spacer"],["mat-icon-button","",3,"click"],["mat-list-icon",""],[1,"person","padding-top"],[3,"formGroup"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","10px"],["color","primary","fxFlex","",1,"result","columnWidth"],["type","number","readonly","","formControlName","totalOutstandingAmount","matInput","",3,"ngModel"],["type","number","readonly","","formControlName","totalSecurityDepositAmount","matInput","",3,"ngModel"],["formControlName","contractEndDate","matInput","",3,"matDatepicker","click"],["matSuffix","",3,"for"],["formDatepickerRef1",""],[4,"ngIf"],["fxLayout","column padding-top","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","10px"],["type","text","formControlName","reasonForContractEnd","matInput",""],[1,"rightAlign"],["mat-button","",3,"click"],["mat-button","",3,"disabled","click"]],template:function(t,e){if(1&t){const t=R.Ub();R.Tb(0,"h4",0),R.Tb(1,"mat-toolbar",1),R.Tb(2,"span"),R.Rc(3,"End Contract"),R.Sb(),R.Ob(4,"span",2),R.Tb(5,"button",3),R.bc("click",(function(){return e.close()})),R.Tb(6,"mat-icon",4),R.Rc(7,"close"),R.Sb(),R.Sb(),R.Sb(),R.Sb(),R.Tb(8,"mat-dialog-content"),R.Tb(9,"div",5),R.Tb(10,"form",6),R.Tb(11,"div",7),R.Tb(12,"mat-form-field",8),R.Tb(13,"mat-label"),R.Rc(14,"Total Outstanding Amount"),R.Sb(),R.Ob(15,"input",9),R.gc(16,"noComma"),R.gc(17,"number"),R.Sb(),R.Tb(18,"mat-form-field",8),R.Tb(19,"mat-label"),R.Rc(20,"Security Deposit in hand"),R.Sb(),R.Ob(21,"input",10),R.gc(22,"noComma"),R.gc(23,"number"),R.Sb(),R.Tb(24,"mat-form-field",8),R.Tb(25,"mat-label"),R.Rc(26,"Contract End Date"),R.Sb(),R.Tb(27,"input",11),R.bc("click",(function(){return R.Ec(t),R.Ac(30).open()})),R.Sb(),R.Ob(28,"mat-datepicker-toggle",12),R.Ob(29,"mat-datepicker",null,13),R.Tb(31,"mat-hint"),R.Rc(32,"Please select End Date"),R.Sb(),R.Pc(33,Rt,2,0,"small",14),R.Sb(),R.Sb(),R.Tb(34,"div",15),R.Tb(35,"mat-form-field",8),R.Tb(36,"mat-label"),R.Rc(37,"Reason for Contract End"),R.Sb(),R.Ob(38,"input",16),R.Sb(),R.Sb(),R.Tb(39,"div",17),R.Tb(40,"button",18),R.bc("click",(function(){return e.close()})),R.Rc(41,"CANCEL"),R.Sb(),R.Tb(42,"button",19),R.bc("click",(function(){return e.onEndContract()})),R.Rc(43,"END CONTRACT"),R.Sb(),R.Sb(),R.Sb(),R.Sb(),R.Sb()}if(2&t){const t=R.Ac(30);R.Cb(10),R.mc("formGroup",e.form),R.Cb(5),R.mc("ngModel",R.hc(16,7,R.ic(17,9,e.totalOutstandingAmount,e.roundFormat))),R.Cb(6),R.mc("ngModel",R.hc(22,12,R.ic(23,14,e.totalSecurityDepositAmount,e.roundFormat))),R.Cb(6),R.mc("matDatepicker",t),R.Cb(1),R.mc("for",t),R.Cb(5),R.mc("ngIf",!e.validateDates()),R.Cb(9),R.mc("disabled",!e.checkDues&&e.form.controls.totalOutstandingAmount.value>0)}},directives:[C.i,F.a,I.a,N.a,M.c,C.f,n.z,n.r,n.k,O.d,O.e,W.d,O.b,W.h,n.u,n.c,U.b,n.q,n.i,E.b,E.d,W.j,E.a,W.g,l.o],pipes:[H.a,l.g],styles:[".task-header[_ngcontent-%COMP%]{background-color:transparent;padding:0 5px;height:20px}.fx-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.columnWidth[_ngcontent-%COMP%]{width:270px}.errorMessage[_ngcontent-%COMP%]{color:red}.rightAlign[_ngcontent-%COMP%]{float:right}"]}),t})();var Ft=i("4Zil"),It=i("a8hA"),Nt=i("EUZL"),Mt=i("sXtk"),kt=i("wh6T"),Ot=i("xBcV"),Wt=i("Hbgg"),Ut=i("rnAf"),Et=i("rvYj"),Lt=i("a+RD"),zt=i("Qu3c"),Bt=i("STbY");const jt=["allSelected"];function Gt(t,e){if(1&t&&(R.Tb(0,"mat-option",20),R.Rc(1),R.Sb()),2&t){const t=e.$implicit;R.mc("value",t.value),R.Cb(1),R.Tc(" ",t.label,"")}}function Yt(t,e){if(1&t&&(R.Tb(0,"th",25),R.Rc(1),R.Sb()),2&t){const t=R.fc(2).$implicit;R.Cb(1),R.Tc(" ",t.name,"")}}function Ht(t,e){if(1&t&&(R.Tb(0,"td",26),R.Rc(1),R.Sb()),2&t){const t=e.$implicit,i=R.fc(2).$implicit;R.Cb(1),R.Tc(" ",t[i.property]," ")}}function $t(t,e){if(1&t&&(R.Rb(0,22),R.Pc(1,Yt,2,1,"th",23),R.Pc(2,Ht,2,1,"td",24),R.Qb()),2&t){const t=R.fc().$implicit;R.mc("matColumnDef",t.property)}}function Vt(t,e){if(1&t&&(R.Rb(0),R.Pc(1,$t,3,1,"ng-container",21),R.Qb()),2&t){const t=e.$implicit;R.Cb(1),R.mc("ngIf",t.isModelProperty)}}function _t(t,e){1&t&&(R.Tb(0,"th",27),R.Rc(1,"SECURITY DEPOSIT IN HAND"),R.Sb())}function Xt(t,e){if(1&t&&(R.Tb(0,"td",28),R.Rc(1),R.Sb()),2&t){const t=e.$implicit;R.Cb(1),R.Tc(" ",t.securityDepositInHandLocal," ")}}function qt(t,e){1&t&&(R.Tb(0,"th",27),R.Rc(1,"REMAINING AMOUNT"),R.Sb())}function Kt(t,e){if(1&t&&(R.Tb(0,"td",28),R.Rc(1),R.Sb()),2&t){const t=e.$implicit;R.Cb(1),R.Tc(" ",t.remainingAmountLocal," ")}}function Qt(t,e){1&t&&R.Ob(0,"th",29)}function Zt(t,e){if(1&t){const t=R.Ub();R.Tb(0,"button",38),R.bc("click",(function(e){return R.Ec(t),e.stopPropagation()})),R.Tb(1,"mat-icon"),R.Rc(2,"more_horiz"),R.Sb(),R.Sb()}if(2&t){R.fc();const t=R.Ac(3);R.mc("matMenuTriggerFor",t)}}function Jt(t,e){if(1&t){const t=R.Ub();R.Tb(0,"button",37),R.bc("click",(function(){R.Ec(t);const e=R.fc().$implicit;return R.fc().updateContract(e)})),R.Tb(1,"span"),R.Rc(2,"Modify"),R.Sb(),R.Sb()}}function te(t,e){if(1&t){const t=R.Ub();R.Tb(0,"button",37),R.bc("click",(function(){R.Ec(t);const e=R.fc().$implicit;return R.fc().renewContract(e)})),R.Tb(1,"span"),R.Rc(2,"Renew"),R.Sb(),R.Sb()}}function ee(t,e){if(1&t){const t=R.Ub();R.Tb(0,"button",37),R.bc("click",(function(){R.Ec(t);const e=R.fc().$implicit;return R.fc().deleteContract(e)})),R.Tb(1,"span"),R.Rc(2,"End Contract"),R.Sb(),R.Sb()}}function ie(t,e){if(1&t){const t=R.Ub();R.Tb(0,"button",37),R.bc("click",(function(){R.Ec(t);const e=R.fc().$implicit;return R.fc().activateContract(e)})),R.Tb(1,"span"),R.Rc(2,"Activate Contract"),R.Sb(),R.Sb()}}function le(t,e){if(1&t){const t=R.Ub();R.Tb(0,"button",36),R.bc("click",(function(){R.Ec(t);const e=R.fc().$implicit;return R.fc().onReceivePayment(e)})),R.Tb(1,"span"),R.Rc(2,"Receive SD Payment"),R.Sb(),R.Sb()}if(2&t){const t=R.fc().$implicit;R.mc("disabled",t&&0==t.remainingAmount)}}function ne(t,e){if(1&t){const t=R.Ub();R.Tb(0,"button",36),R.bc("click",(function(){R.Ec(t);const e=R.fc().$implicit;return R.fc().onSuspendContract(e)})),R.Tb(1,"span"),R.Rc(2,"Suspend Contract"),R.Sb(),R.Sb()}if(2&t){const t=R.fc().$implicit;R.mc("disabled",t&&t.isSuspended)}}function ae(t,e){if(1&t){const t=R.Ub();R.Tb(0,"button",36),R.bc("click",(function(){R.Ec(t);const e=R.fc().$implicit;return R.fc().onRefund(e)})),R.Tb(1,"span"),R.Rc(2,"Refund"),R.Sb(),R.Sb()}if(2&t){const t=R.fc().$implicit;R.mc("disabled",!(t&&0===t.remainingAmount&&t.previousDueAmount<=0))}}function oe(t,e){if(1&t){const t=R.Ub();R.Tb(0,"button",36),R.bc("click",(function(){R.Ec(t);const e=R.fc().$implicit;return R.fc().onRefundHistory(e)})),R.Tb(1,"span"),R.Rc(2,"Refund History"),R.Sb(),R.Sb()}if(2&t){const t=R.fc().$implicit;R.mc("disabled",!(t&&t.refundAmount>0))}}function re(t,e){if(1&t){const t=R.Ub();R.Tb(0,"td",30),R.Pc(1,Zt,3,1,"button",31),R.Tb(2,"mat-menu",32,33),R.Pc(4,Jt,3,0,"button",34),R.Pc(5,te,3,0,"button",34),R.Pc(6,ee,3,0,"button",34),R.Pc(7,ie,3,0,"button",34),R.Pc(8,le,3,1,"button",35),R.Tb(9,"button",36),R.bc("click",(function(){R.Ec(t);const i=e.$implicit;return R.fc().onPrintReceipt(i)})),R.Tb(10,"span"),R.Rc(11,"Print Receipt"),R.Sb(),R.Sb(),R.Pc(12,ne,3,1,"button",35),R.Tb(13,"button",37),R.bc("click",(function(){R.Ec(t);const i=e.$implicit;return R.fc().onPrintAccountStatement(i)})),R.Tb(14,"span"),R.Rc(15," Export Account Statement"),R.Sb(),R.Sb(),R.Pc(16,ae,3,1,"button",35),R.Pc(17,oe,3,1,"button",35),R.Sb(),R.Sb()}if(2&t){const t=e.$implicit,i=R.fc();R.Cb(1),R.mc("ngIf",!i.movedOut),R.Cb(3),R.mc("ngIf",2!=i.filterId&&3!=i.filterId),R.Cb(1),R.mc("ngIf",2!=i.filterId&&3!=i.filterId),R.Cb(1),R.mc("ngIf",2!=i.filterId),R.Cb(1),R.mc("ngIf",t&&t.isSuspended),R.Cb(1),R.mc("ngIf",2!=i.filterId&&3!=i.filterId&&!(t&&t.isSuspended)),R.Cb(1),R.mc("disabled",!(t&&t.receivedAmount>0)),R.Cb(3),R.mc("ngIf",2!=i.filterId&&3!=i.filterId),R.Cb(4),R.mc("ngIf",3!=i.filterId),R.Cb(1),R.mc("ngIf",3!=i.filterId)}}function se(t,e){1&t&&R.Ob(0,"tr",39)}function ce(t,e){1&t&&R.Ob(0,"tr",40)}const ue=function(){return[]},de=function(){return{standalone:!0}},he=[{path:"",component:(()=>{class t{constructor(t,e,i,l,n,a,o,r,s,c,u,d,h,b){var f;this.dialog=t,this.snackbar=e,this.date=i,this.router=l,this.currencyPipe=n,this.dataService=a,this.decimalPipe=o,this.contractService=r,this.billSettlementService=s,this.cookieService=c,this.clientSelectionService=u,this.billService=d,this.envService=h,this.workflowRuleService=b,this.subject$=new m.a(1),this.data$=this.subject$.asObservable(),this.workflowRules=[],this.dateFormat="",this.billMaster={},this.currency=Object(x.e)("Currency"),this.roundFormat=Object(x.e)("RoundOff"),this.consumptionRoundOffFormat=Object(x.e)("ConsumptionRoundOff"),this.filePath="",this.movedOut=!1,this.reminder=!1,this.message="",this.checkDues=!0,this.filterId=0,this.pdfsToMerge=[],this.filterModes=[{label:"Current Contracts",value:0},{label:"Expiration Reminder",value:1},{label:"Closed Contracts",value:2},{label:"Suspended Contracts",value:3},{label:"Unpaid SD Contracts",value:4}],this.selectFilterModes=[],this.displayedColumns=[{name:"Contract Number",property:"contractNumber",visible:!0,isModelProperty:!0},{name:"Contract Date",property:"contractDateLocal",visible:!0,isModelProperty:!0},{name:"Contract End Date",property:"contractEndDateLocal",visible:!0,isModelProperty:!0},{name:"Tenant Name",property:"tenantName",visible:!0,isModelProperty:!0},{name:"Unit Number",property:"unitNumber",visible:!0,isModelProperty:!0},{name:"Contract Type",property:"contractType",visible:!0,isModelProperty:!0},{name:"Security Deposit In Hand",property:"securityDepositInHandLocal",visible:!0,isModelProperty:!1},{name:"Remaining Amount",property:"remainingAmountLocal",visible:!0,isModelProperty:!1},{name:"Status",property:"status",visible:!0,isModelProperty:!0},{name:"Actions",property:"actions",visible:!0}],this.pageSize=8,this.columnsProps=this.displayedColumns.map(t=>t.property),this.filePath=h.backendForFiles,this.dateFormat=null!==(f=Object(x.e)("DateFormat"))&&void 0!==f?f:h.dateFormat,this.clientId=Number(this.cookieService.get("globalClientId"))}set content(t){this.sort=t,this.sort&&this.listData&&(this.listData.sort=this.sort)}get visibleColumns(){return this.displayedColumns.filter(t=>t.visible).map(t=>t.property)}ngOnInit(){this.clientSelectionService.setIsClientVisible(!0),this.expiryReminder=this.dataService.getMessage(),this.expiryReminder&&(this.reminder=this.expiryReminder),this.getWorkflowRules()}getReminder(t){this.reminder=t}getContractDetails(){1==this.movedOut?this.getMovedOutTenants():this.reminder?this.getContractsAboutToExpire():this.getContracts()}ngAfterViewInit(){this.listData&&(this.listData.paginator=this.paginator,this.listData.sort=this.sort)}notificationMessage(t,e){this.snackbar.open(t,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[e]})}createContract(){this.dialog.open(gt).afterClosed().subscribe(t=>{t&&(t.mode="create",this.contractService.createContract(t).subscribe(()=>{this.snackbar.open("Contract created successfully",null,{duration:5e3,verticalPosition:"top",horizontalPosition:"center",panelClass:["green-snackbar"]}),this.onFilterData()}))})}updateContract(t){t.mode="update",t.type="",this.dialog.open(gt,{data:t}).afterClosed().subscribe(e=>{e&&this.contractService.updateContractById(t.id,e).subscribe({next:()=>{this.snackbar.open("Contract updated successfully",null,{duration:5e3,verticalPosition:"top",horizontalPosition:"center",panelClass:["green-snackbar"]}),this.onFilterData()},error:()=>{this.notificationMessage("Contract updation failed","red-snackbar")}}),this.onFilterData()})}renewContract(t){t.mode="renew",this.dialog.open(gt,{data:t}).afterClosed().subscribe(t=>{t&&this.contractService.renewContract(t.id,t).subscribe({next:()=>{this.snackbar.open("Contract renewed successfully",null,{duration:5e3,verticalPosition:"top",horizontalPosition:"center",panelClass:["green-snackbar"]}),this.onFilterData()},error:()=>{this.notificationMessage("Contract renewal failed","red-snackbar")}})})}deleteContract(t){t.checkDues=this.checkDues,this.dialog.open(At,{data:t}).afterClosed().subscribe(t=>{t&&(t.clientId=this.clientId,this.contractService.deleteContractById(t.id,t).subscribe({next:()=>{this.snackbar.open("Contract End Successfull.",null,{duration:5e3,verticalPosition:"top",horizontalPosition:"center",panelClass:["green-snackbar"]}),this.onFilterData()},error:()=>{this.notificationMessage("Contract End failed","red-snackbar")}}))})}onSuspendContract(t){t.mode="delete",t.type="Suspend",this.dialog.open(gt,{data:t}).afterClosed().subscribe(t=>{t&&this.contractService.suspendContractById(t.id,t).subscribe({next:()=>{this.snackbar.open("Contract Suspend Successfull.",null,{duration:5e3,verticalPosition:"top",horizontalPosition:"center",panelClass:["green-snackbar"]}),this.onFilterData()},error:()=>{this.notificationMessage("Contract Suspend failed","red-snackbar")}})})}getContracts(t=!1,e=!1){this.clientId=parseInt(this.cookieService.get("globalClientId")),this.contractService.getContracts(this.clientId).subscribe(i=>{i=i.map(t=>new v(t)),t&&(i=i.filter(e=>e.isSuspended==t)),e&&(i=i.filter(t=>0==t.receivedAmount&&t.securityDeposit>0)),this.dateFormat=Object(x.e)("DateFormat"),this.roundFormat=Object(x.e)("RoundOff"),this.currency=Object(x.e)("Currency"),i.forEach(t=>{t.securityDepositLocal=this.currencyPipe.transform(t.securityDeposit,this.currency.toString(),!0,this.roundFormat),t.contractDateLocal=this.date.transform(t.contractDate.toString(),this.dateFormat.toString()),t.contractEndDateLocal=this.date.transform(t.contractEndDate.toString(),this.dateFormat.toString()),t.securityDepositInHand=t.receivedAmount-t.refundAmount,t.securityDepositInHandLocal=this.currencyPipe.transform(t.securityDepositInHand,this.currency.toString(),!0,this.roundFormat),t.receivedAmountLocal=this.currencyPipe.transform(t.receivedAmount,this.currency.toString(),!0,this.roundFormat),t.refundAmountLocal=this.currencyPipe.transform(t.refundAmount,this.currency.toString(),!0,this.roundFormat),t.remainingAmountLocal=this.currencyPipe.transform(t.remainingAmount,this.currency.toString(),!0,this.roundFormat)}),this.subject$.next(i)}),this.listData=new h.k(this.contracts),this.data$.pipe(Object(b.a)(t=>!!t)).subscribe(t=>{this.contracts=t,this.listData.data=t}),this.ngAfterViewInit()}onFilterChange(t){this.listData&&(t=(t=t.trim()).toLowerCase(),this.listData.filter=t)}ngOnDestroy(){}onGenerateInoice(t,e){this.clientId=parseInt(this.cookieService.get("globalClientId")),this.billSettlementService.generateOtherTypeInvoiceDetail(this.clientId,t.id).subscribe({next:t=>{t?e&&(this.updatePaymentDetails(e,t.id),this.onSavePayment(e)):this.notificationMessage("Security deposit payment save failed","red-snackbar")},error:()=>{this.notificationMessage("Security deposit payment save failed","red-snackbar")}})}onPrintInvoice(t){t&&t.billMasters&&(t.billMasters[0].billDateLocal=this.date.transform(t.billMasters[0].billDate.toString(),this.dateFormat.toString()),t.billMasters[0].fromDateLocal=this.date.transform(t.billMasters[0].fromDate.toString(),this.dateFormat.toString()),t.billMasters[0].toDateLocal=this.date.transform(t.billMasters[0].toDate.toString(),this.dateFormat.toString()),t.billMasters[0].dueDateLocal=this.date.transform(t.billMasters[0].dueDate.toString(),this.dateFormat.toString()),t.billMasters[0].billAmountLocal=this.currencyPipe.transform(t.billMasters[0].billAmount,this.currency.toString(),!0,this.roundFormat),"Bill Format 1"===t.billMasters[0].billFormat?this.downloadBillReport(t.billMasters[0]):"Bill Format 2"===t.billMasters[0].billFormat?t.billMasters[0].bills&&t.billMasters[0].bills.length>3?this.downloadLargeBillNewReport(t.billMasters[0]):this.downloadBillNewReport(t.billMasters[0]):"Bill Format 3"===t.billMasters[0].billFormat&&this.downloadBillNewFormatReport(t.billMasters[0]))}downloadLargeBillNewReport(t){var e,i,l,n,a,o,r,s,c,u,d,h,m,b,f,p,g,y;let v=[],C=[],S=[],T=[],D=[],P=[],w=[],R=[],A=[],F=[];for(let M=0;M<t.bills.length;M++)this.consumptionRoundOffFormat=null!==(e=Object(x.e)("ConsumptionRoundOff",t.bills[M].utilityTypeId))&&void 0!==e?e:this.envService.consumptionRoundOffFormat,v.push(t.bills[M].unitNumber),v.push(t.bills[M].deviceName),v.push(this.decimalPipe.transform(t.bills[M].previousReading,this.consumptionRoundOffFormat)+" "+t.bills[M].measuringUnit),v.push(this.decimalPipe.transform(t.bills[M].presentReading,this.consumptionRoundOffFormat)+" "+t.bills[M].measuringUnit),v.push(t.bills[M].isDifferentiateBill?this.decimalPipe.transform(t.bills[M].presentReading-t.bills[M].previousReading,this.consumptionRoundOffFormat)+" "+t.bills[M].measuringUnit:this.decimalPipe.transform(t.bills[M].consumption,this.consumptionRoundOffFormat)+" "+t.bills[M].measuringUnit),"BTU"===t.bills[M].utilityType&&t.bills[M].billTransactions&&t.bills[M].billTransactions.length&&t.bills[M].billTransactions.findIndex(t=>t.measuringUnitId&&2===t.measuringUnitId)>-1?v.push(this.decimalPipe.transform(.284345*t.bills[M].consumption,this.consumptionRoundOffFormat)):v.push(0),C.push(v),v=[];let I=0;for(let M=0;M<t.bills.length;M++){const e=t.bills[M];this.consumptionRoundOffFormat=null!==(i=Object(x.e)("ConsumptionRoundOff",t.bills[M].utilityTypeId))&&void 0!==i?i:this.envService.consumptionRoundOffFormat;for(let t=0;t<e.billTransactions.length;t++)e.billTransactions[t].headAmount&&(v.push(e.billNumber),v.push(e.billTransactions[t].headDisplay),"BTU"===e.utilityType&&e.billTransactions&&e.billTransactions.length&&e.billTransactions[t]&&e.billTransactions[t].measuringUnitId&&2===e.billTransactions[t].measuringUnitId?(v.push(this.decimalPipe.transform(.284345*e.consumption,this.consumptionRoundOffFormat)),v.push("TR-HR"),v.push(e.consumptionRate)):(v.push(this.decimalPipe.transform(e.consumption,this.consumptionRoundOffFormat)),v.push(e.measuringUnit),v.push(e.consumptionRate)),v.push(this.decimalPipe.transform(e.billTransactions[t].headAmount,this.roundFormat)),R.push(v),v=[],I+=e.billTransactions[t].headAmount)}v.push(t.accountNumber),v.push(t.fromDateLocal+"-"+t.toDateLocal),v.push(this.currencyPipe.transform(t.previousDueAmount,this.currency.toString(),!0,this.roundFormat)),v.push(t.billAmountLocal),T.push(v),t.billCharges.forEach(t=>{if("VAT"!==t.headDisplay){const e=S.find(e=>e.label===t.headDisplay);e?e.value+=t.headAmount:S.push({label:t.headDisplay,value:t.headAmount})}}),S.forEach(t=>{A.push({label:t.label,value:this.currencyPipe.transform(t.value,this.currency.toString(),!0,this.roundFormat)}),I+=t.value}),A.push({label:"Total Charges for Current Period",value:this.currencyPipe.transform(I,this.currency.toString(),!0,this.roundFormat)}),t.billTaxDetails.forEach(t=>{const e=A.find(e=>e.label===t.taxDisplayName);if(e){const i=Number(e.value.replace(this.currency,"").trim())+Number(t.taxAmount);e.value=this.currencyPipe.transform(i,this.currency.toString(),!0,this.roundFormat)}else A.push({label:t.taxDisplayName,value:this.currencyPipe.transform(t.taxAmount,this.currency.toString(),!0,this.roundFormat)})}),A.push({label:"Previous Outstanding Amount",value:this.currencyPipe.transform(t.previousDueAmount,this.currency.toString(),!0,this.roundFormat)},{label:"Total Amount Due",value:this.currencyPipe.transform(t.billAmount+t.previousDueAmount,this.currency.toString(),!0,this.roundFormat)}),D.push({label:"Date of issue",value:null!==(l=null==t?void 0:t.billDateLocal)&&void 0!==l?l:""},{label:"Due Date",value:null!==(n=null==t?void 0:t.dueDateLocal)&&void 0!==n?n:""}),P.push({label:"Customer Name",value:null!==(a=null==t?void 0:t.ownerName)&&void 0!==a?a:""},{label:"Customer AccountNumber",value:null!==(o=null==t?void 0:t.accountNumber)&&void 0!==o?o:""},{label:"Address",value:null!==(s=null===(r=null==t?void 0:t.receiverDetails[0])||void 0===r?void 0:r.address1)&&void 0!==s?s:""},{label:"City",value:null!==(u=null===(c=null==t?void 0:t.receiverDetails[0])||void 0===c?void 0:c.city)&&void 0!==u?u:""},{label:"P.O Box",value:null!==(h=null===(d=null==t?void 0:t.receiverDetails[0])||void 0===d?void 0:d.zipPostalCode)&&void 0!==h?h:""},{label:"Phone number",value:null!==(b=null===(m=null==t?void 0:t.receiverDetails[0])||void 0===m?void 0:m.phoneNumber)&&void 0!==b?b:""},{label:"Fax Number",value:""},{label:"Client",value:null!==(p=null===(f=null==t?void 0:t.client)||void 0===f?void 0:f.clientName)&&void 0!==p?p:""},{label:"Client TRN",value:null!==(y=null===(g=null==t?void 0:t.client)||void 0===g?void 0:g.trnNo)&&void 0!==y?y:""}),w.push({firstItem:"Billing period",secondItem:"From:",thirdItem:t.fromDateLocal,fourthItem:"To:",fifthItem:t.toDateLocal});let N=[];v=[],t&&t.bills&&t.bills.length&&t.bills.forEach(t=>{if(t.billTariffDetails&&t.billTariffDetails.length)for(let e=0;e<t.billTariffDetails.length;e++)t.billTariffDetails[e].slabSettingsId&&t.billTariffDetails[e].slabSettingsId>0&&0==e?N=["Slab","Min Consumption","Max Consumption","Consumption","Rate","Amount"]:0==t.billTariffDetails[e].slabSettingsId&&0==e&&(N=["Season","Week Type","Peak Type","Consumption","Rate","Amount"]),v.push(t.billTariffDetails[e].season),v.push(t.billTariffDetails[e].weekType),v.push(t.billTariffDetails[e].peakType),v.push(t.billTariffDetails[e].consumption),v.push(t.billTariffDetails[e].rate),v.push(t.billTariffDetails[e].amount),F.push(v),v=[]}),this.getNewLargeBillReport(["Unit No","Meter No","Previous Reading","Present Reading","Consumption","Consumption TR-HR"],C,["Customer AccountNumber","Billing Period","Previous Due","Total for current period"],T,D,P,w,["Bill No","Charges","Consumption","Measuring Unit","Tariff","Total"],R,t,A,N,F)}getNewLargeBillReport(t,e,i,l,n,a,o,r,s,c,u,d,h){var m,b,f,p,g;(new Image).src=this.filePath+"/uploads/"+(null===(m=null==c?void 0:c.client)||void 0===m?void 0:m.photo);let y=new vt.default({orientation:"portrait",unit:"pt",format:"letter"});const v=null!==(f=null===(b=null==c?void 0:c.client)||void 0===b?void 0:b.clientName)&&void 0!==f?f:"",C=y.getTextWidth(v.trim())+4;y.setTextColor(0,0,0),y.setFontSize(17),y.setFont("Cambria"),y.text(v,Number(y.internal.pageSize.width/2)-Number(0!=C?C/2:0),23),y.setDrawColor(0,0,0),y.line(Number(y.internal.pageSize.width/2)-Number(0!=C?C/2:0),26,Number(y.internal.pageSize.width/2)-Number(0!=C?C/2:0)+C,26),y.setFont("Cambria","normal"),y.setFontSize(14),y.text("Billing Statement",35,46),this.addImage(y,c),y.autoTable("",n,{startX:10,startY:55,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:35},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:150,halign:"left"},1:{cellWidth:190,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"},didParseCell:function(t){t.cell.styles.cellPadding=1}});const S=Math.round(y.autoTable.previous.finalY);y.autoTable("",o,{startX:10,startY:S,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:35},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:150,halign:"left"},1:{cellWidth:95,halign:"center"},2:{cellWidth:95,halign:"center"},3:{cellWidth:95,halign:"center"},4:{cellWidth:95,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0]},didParseCell:function(t){t.cell.styles.cellPadding=1}});const T=Math.round(y.autoTable.previous.finalY);y.autoTable("",a,{startX:10,startY:T,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:35},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:150,halign:"left"},1:{cellWidth:380,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0]},didParseCell:function(t){t.cell.styles.cellPadding=1}});var D=function(t){var e="Page "+t.pageCount;"function"==typeof y.putTotalPages&&(e=e),y.setFontSize(9)};const P=Math.round(y.autoTable.previous.finalY);y.setFont("Cambria"),y.setFontSize(10),y.text("Meter Read-Outs".toUpperCase(),35,P+20),y.autoTable(t,e,{startX:10,startY:P+40,showHead:"everyPage",didDrawPage:D,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:35},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"center"},1:{cellWidth:95,halign:"center"},2:{cellWidth:95,halign:"center"},3:{cellWidth:95,halign:"center"},4:{cellWidth:74,halign:"center"},5:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(t){t.cell.styles.cellPadding=1}});const w=Number(this.decimalPipe.transform(y.autoTable.previous.finalY,"1.0-0"));y.setFontSize(10),y.text("Charges Breakdown".toUpperCase(),35,w+20),y.autoTable(r,s,{startX:10,startY:w+40,showHead:"everyPage",didDrawPage:D,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:35},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:60,halign:"center"},1:{cellWidth:155,halign:"center"},2:{cellWidth:85,halign:"center"},3:{cellWidth:85,halign:"center"},4:{cellWidth:74,halign:"center"},5:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(t){t.cell.styles.cellPadding=1}});const x=Number(this.decimalPipe.transform(y.autoTable.previous.finalY,"1.0-0"));y.autoTable(d,h,{startX:10,startY:x+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:130,halign:"center"},1:{cellWidth:85,halign:"center"},2:{cellWidth:85,halign:"center"},3:{cellWidth:85,halign:"center"},4:{cellWidth:74,halign:"center"},5:{cellWidth:75,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(t){t.cell.styles.cellPadding=1}});let R=Number(this.decimalPipe.transform(y.autoTable.previous.finalY,"1.0-0")),A=y.internal.pageSize.height;A-R<200&&(y.addPage(),R=S,A=370+S),y.autoTable("",u,{startX:10,startY:R+20,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{bottom:40,left:250},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:244,fontStyle:"italic"},1:{cellWidth:75}},didParseCell:function(t){1==t.column.index&&(t.cell.styles.halign="right"),t.cell.styles.cellPadding=1},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});let F=Number(this.decimalPipe.transform(y.autoTable.previous.finalY,"1.0-0"));y.setFillColor(241,241,244),y.rect(35,F+20,535,80,"FD"),y.setFillColor(0,0,0),y.setFontSize(9),y.text(null===(g=null===(p=null==c?void 0:c.client)||void 0===p?void 0:p.termsConditions[0])||void 0===g?void 0:g.termsAndCondition.replace("{{ClientName}}",c.client.clientName).replace("{{TRNNumber}}",c.client.trnNo).replace("{{Currency}}",this.currency),65,F+30),y.setTextColor(0,0,0),y.line(5,F+110,607,F+110),y.text("Notice :- Please tear and attach the slip  along with your payment",35,A-80),y.autoTable(i,l,{startX:10,startY:A-70,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:35},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:120,halign:"center"},1:{cellWidth:200,halign:"center"},2:{cellWidth:100,halign:"right"},3:{cellWidth:120,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(t){t.cell.styles.cellPadding=1}});var I=y.output("blob");window.open(URL.createObjectURL(I))}downloadBillReport(t){let e=[],i=[],l=[],n=[],a=[];t.bills.forEach(l=>{l.billTransactions&&l.billTransactions.length&&l.billTransactions.forEach(n=>{e.push(n.headDisplay),e.push(t.fromDateLocal),e.push(t.toDateLocal),e.push(l.previousReading),e.push(l.presentReading),e.push(l.consumption+" "+l.measuringUnit),e.push(l.consumptionRate),e.push(this.decimalPipe.transform(n.headAmount,this.roundFormat)),i.push(e),e=[]})}),t.billCharges.forEach(t=>{if("VAT"!==t.headDisplay){const e=l.find(e=>e.label===t.headDisplay);e?e.value+=t.headAmount:l.push({label:t.headDisplay,value:t.headAmount})}});for(let s=0;s<l.length;s++)e.push(l[s].label),e.push(""),e.push(""),e.push(""),e.push(""),e.push(""),e.push(""),e.push(this.decimalPipe.transform(l[s].value,this.roundFormat)),i.push(e),e=[];let o="";t.bills.forEach(t=>{o+=t.deviceName+","}),n.push({label:"Account Number:",value:t.accountNumber},{label:"Meter Number:",value:o.slice(0,-1)},{label:"Unit Number:",value:t.unitNumber},{label:"Billing Date:",value:t.billDateLocal},{label:"Due Date:",value:t.dueDateLocal});let r=0;i.forEach(t=>{r+=Number(t[7].replace(",",""))}),a.push({label:"Current Month Total:",value:this.currencyPipe.transform(r,this.currency.toString(),!0,this.roundFormat)}),t.billTaxDetails&&t.billTaxDetails.length?t.billTaxDetails.forEach(t=>{a.push({label:t.taxDisplayName,value:this.currencyPipe.transform(t.taxAmount,this.currency.toString(),!0,this.roundFormat)})}):a.push({label:"TAX:",value:this.currencyPipe.transform(0,this.currency.toString(),!0,this.roundFormat)}),a.push({label:"Current Month + TAX:",value:t.billAmountLocal},{label:"Previous Bill Outstanding Balance:",value:this.currencyPipe.transform(t.previousDueAmount,this.currency.toString(),!0,this.roundFormat)},{label:"Total Due incl TAX:",value:this.currencyPipe.transform(t.billAmount+t.previousDueAmount,this.currency.toString(),!0,this.roundFormat)}),this.getBillReport(t,["Services Description","From","To","Previous","Current","Consumption","Rate ","Charges"],i,[{value:"",value1:"Bill Period",value2:"Meter Reading",value3:"",value4:""}],n,a)}getBillReport(t,e,i,l,n,a){var o,r,s,c,u,d,h,m,b,f,p,g,y,v,C,S,T,D,P,w,R,A,F,I,N;let M=new vt.default({orientation:"portrait",unit:"pt",format:"letter"});M.rect(5,5,M.internal.pageSize.width-10,M.internal.pageSize.height-10,"S"),M.setFontSize(30),M=this.addImage(M,t),M.setTextColor(0,0,0),M.setFontSize(16),M.setFont("Cambria","bold"),M.text("Tax Invoice",260,30),M.setFontSize(13),M.setFont("Cambria","normal"),M.text(t.client.clientName.toUpperCase(),10,60),M.setFontSize(10),M.setFont("Cambria"),M.text("TRN: "+t.client.trnNo,10,70),M.text("PO Box "+t.client.addresses[0].zipPostalCode,10,80),M.text(t.client.addresses[0].address1+","+t.client.addresses[0].country,10,90),M.text("Phone: "+t.client.phoneNo,10,100),M.text("Email: "+t.client.email+", Web: "+t.client.website,10,110),M.setFillColor(241,241,244),M.setDrawColor(206,203,203),M.rect(10,120,350,90,"FD"),M.setTextColor(0,0,0),M.setFontSize(12),M.text(null==t?void 0:t.ownerName.toUpperCase(),20,135),M.text("CUSTOMER TRN: "+t.trn,20,155),M.text("unit #"+t.unitNumber,20,170),M.setFontSize(10),M.text(t.clientName,20,185),M.text(Object(x.f)(null===(o=null==t?void 0:t.client)||void 0===o?void 0:o.buildingName,",")+Object(x.f)(null===(s=null===(r=null==t?void 0:t.client)||void 0===r?void 0:r.addresses[0])||void 0===s?void 0:s.location,",")+Object(x.f)(null===(u=null===(c=null==t?void 0:t.client)||void 0===c?void 0:c.addresses[0])||void 0===u?void 0:u.city,",")+Object(x.f)(null===(h=null===(d=null==t?void 0:t.client)||void 0===d?void 0:d.addresses[0])||void 0===h?void 0:h.country,","),20,200),M.setFontSize(9),M.setLineWidth(.1),M.line(5,265,607,265),M.setFontSize(10),M.setFont("bold"),M.text("Invoice#: ".toUpperCase(),400,110),M.setTextColor(25,118,210);const k=M.getTextWidth("Invoice#: ");let O="";(null==t?void 0:t.billNumber)&&(O=null===(m=t.billNumber)||void 0===m?void 0:m.toUpperCase()),M.text(O,410+k,110),M.setFont("none"),M.setTextColor(0,0,0),M.setFontSize(9),M.autoTable("",n,{startX:210,startY:120,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:400},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:100,halign:"right"}},didParseCell:function(t){const e=t.column.index;0!=e&&1!=e||(t.cell.styles.rowHeight=1)},headStyles:{lineWidth:.1,lineColor:[0,0,0]}}),M.autoTable("",l,{startX:10,startY:220,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:220,left:10},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,fontStyle:"bold",halign:"center"},1:{cellWidth:160,fontStyle:"bold",halign:"center"},2:{cellWidth:120,fontStyle:"bold",halign:"center"},3:{cellWidth:75,fontStyle:"bold",halign:"center"},4:{cellWidth:135,fontStyle:"bold",halign:"center"}},didParseCell:function(t){const e=t.column.index;0!=e&&1!=e||(t.cell.styles.rowHeight=1)},headStyles:{lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]}});const W=Number(this.decimalPipe.transform(M.autoTable.previous.finalY,"1.0-0"));M.autoTable(e,i,{startX:10,startY:W,didDrawPage:function(t){var e="Page "+t.pageCount;"function"==typeof M.putTotalPages&&(e+=" of 1",M.rect(5,5,M.internal.pageSize.width-10,M.internal.pageSize.height-10,"S")),M.setFontSize(9);var i=M.internal.pageSize.height||M.internal.pageSize.getHeight();M.text(e,t.settings.margin.left,i-10)},styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:W,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:80,halign:"center"},2:{cellWidth:80,halign:"center"},3:{cellWidth:60,halign:"center"},4:{cellWidth:60,halign:"center"},5:{cellWidth:75,halign:"center"},6:{cellWidth:60,halign:"right"},7:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(t){t.cell.styles.cellPadding=n.length>12?1.5:2}}),M.setTextColor(0,0,0);const U=Number(this.decimalPipe.transform(M.autoTable.previous.finalY,"1.0-0"));M.setTextColor(25,118,210),M.setFontSize(12),M.text("Bank Payment Account Details",10,U+20),M.setTextColor(0,0,0),M.setFontSize(9),M.text("Account Title: "+Object(x.f)(null===(f=null===(b=null==t?void 0:t.client)||void 0===b?void 0:b.bankDetails[0])||void 0===f?void 0:f.accountName),10,U+40),M.text("Account #: "+Object(x.f)(null===(g=null===(p=null==t?void 0:t.client)||void 0===p?void 0:p.bankDetails[0])||void 0===g?void 0:g.accountNo),10,U+50),M.text("IBAN #: "+Object(x.f)(null===(v=null===(y=null==t?void 0:t.client)||void 0===y?void 0:y.bankDetails[0])||void 0===v?void 0:v.ibanNumber),10,U+60),M.text("Bank Name: "+Object(x.f)(null===(S=null===(C=null==t?void 0:t.client)||void 0===C?void 0:C.bankDetails[0])||void 0===S?void 0:S.bankName),10,U+70),M.text("Swift Code: "+ +Object(x.f)(null===(D=null===(T=null==t?void 0:t.client)||void 0===T?void 0:T.bankDetails[0])||void 0===D?void 0:D.swiftCode),10,U+80),M.setFontSize(9),M.autoTable("",a,{startX:300,startY:U+20,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:320},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:180,halign:"left"},1:{cellWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"}});const E=Number(this.decimalPipe.transform(M.autoTable.previous.finalY,"1.0-0"));M.setTextColor(255,0,0),M.text(`Note: A Late Fee will be applied after the due date. A Default Payment \nPenalty will be added to any unit that is ${Object(x.f)(null===(P=null==t?void 0:t.penaltyAfter)||void 0===P?void 0:P.toString())} days or more in arrears.`,320,E+10),M.setTextColor(25,118,210),M.setFontSize(12),M.text("USAGE TIPS to reduce consumption:",10,E+10),M.text("Please Try to:",10,E+30),M.setTextColor(0,0,0),M.setFontSize(9),M.text("- Keep filters clean",30,E+40),M.text("- Set thermostats between 23C and 25C",30,E+50),M.text("- Keep vents unblocked",30,E+60),M.text("- Keep doors and windows closed",30,E+70),M.text("- Undertake regular maintenance of the system",30,E+80),M.setTextColor(25,118,210),M.setFontSize(12),M.text("Please Do Not:",10,E+100),M.setTextColor(0,0,0),M.setFontSize(9),M.text("- Set thermostats to 20C or lower",30,E+110),M.text("- Block vents",30,E+120),M.text("- Leave doors and windows open",30,E+130),M.text("- Leave heat producing appliances near thermostats",30,E+140),M.setFillColor(119,183,11);var L=M.internal.pageSize.height||M.internal.pageSize.getHeight();M.rect(320,E+30,280,L-80-(E+30),"FD"),M.setFont("Comic Sans"),M.setTextColor(255,255,255),M.setFontSize(16),M.text("ADVERTISE WITH US",360,E+50);const z=M.getTextWidth("ADVERTISE WITH US");M.setLineWidth(.1),M.line(360,E+55,360+z,E+55),M.setFontSize(9),M.text("For advertisement, contact at",390,E+65),M.text(Object(x.f)(null===(w=null==t?void 0:t.client)||void 0===w?void 0:w.phoneNo),390,E+75),M.text(Object(x.f)(null===(R=null==t?void 0:t.client)||void 0===R?void 0:R.email),390,E+85),M.text(Object(x.f)(null===(A=null==t?void 0:t.client)||void 0===A?void 0:A.website),390,E+95),M.setTextColor(0,0,0),M.setLineWidth(.1),M.line(5,L-70,607,L-70),M.text(`For any enquiries, write to us ${Object(x.f)(null===(F=null==t?void 0:t.client)||void 0===F?void 0:F.email)} \nor Logon to ${Object(x.f)(null===(I=null==t?void 0:t.client)||void 0===I?void 0:I.website)}`,10,L-60),M.setTextColor(255,0,0),M.setFont("bold");const B=M.getTextWidth("Notice:");M.text("Notice:",310,L-60),M.setFont("none"),M.setTextColor(0,0,0),M.text("Pay your bills before due date to avoid late payment surcharge",310+B,L-60),M.text("and disconnection.",310,L-50),M.text(`You can log onto ${Object(x.f)(null===(N=null==t?void 0:t.client)||void 0===N?void 0:N.website)} to pay your invoices \nTerms & Conditions for Supply of Utility Services`,310,L-40),"function"==typeof M.putTotalPages&&M.putTotalPages("1");var j=M.output("blob");window.open(URL.createObjectURL(j))}downloadBillNewReport(t){var e,i,l,n,a,o,r,s,c,u,d,h,m,b,f,p,g,y,v,C;let S=[],T=[],D=[],P=[],w=[],R=[],A=[],F=[],I=[],N=[];for(let O=0;O<t.bills.length;O++)this.consumptionRoundOffFormat=null!==(e=Object(x.e)("ConsumptionRoundOff",t.bills[O].utilityTypeId))&&void 0!==e?e:this.envService.consumptionRoundOffFormat,S.push(t.unitNumber),S.push(t.bills[O].deviceName),S.push(this.decimalPipe.transform(t.bills[O].previousReading,this.consumptionRoundOffFormat)),S.push(this.decimalPipe.transform(t.bills[O].presentReading,this.consumptionRoundOffFormat)),S.push(t.bills[O].isDifferentiateBill?this.decimalPipe.transform(t.bills[O].presentReading-t.bills[O].previousReading,this.consumptionRoundOffFormat)+" "+t.bills[O].measuringUnit:this.decimalPipe.transform(t.bills[O].consumption,this.consumptionRoundOffFormat)+" "+t.bills[O].measuringUnit),"BTU"===t.bills[O].utilityType&&t.bills[O].billTransactions&&t.bills[O].billTransactions.length&&t.bills[O].billTransactions.findIndex(t=>t.measuringUnitId&&2===t.measuringUnitId)>-1?S.push(this.decimalPipe.transform(.2843*t.bills[O].consumption,this.roundFormat)):S.push(0),T.push(S),S=[];let M=0;for(let O=0;O<t.bills.length;O++){this.consumptionRoundOffFormat=null!==(i=Object(x.e)("ConsumptionRoundOff",t.bills[O].utilityTypeId))&&void 0!==i?i:this.envService.consumptionRoundOffFormat;const e=t.bills[O];for(let t=0;t<e.billTransactions.length;t++)e.billTransactions[t].headAmount&&(S.push(e.billNumber),S.push(e.billTransactions[t].headDisplay),"BTU"===e.utilityType&&e.billTransactions&&e.billTransactions.length&&e.billTransactions[t]&&e.billTransactions[t].measuringUnitId&&2===e.billTransactions[t].measuringUnitId?(S.push(this.decimalPipe.transform(.2843*e.consumption,this.roundFormat)),S.push("TR-HR"),S.push(e.consumptionRate)):(S.push(this.decimalPipe.transform(e.consumption,this.consumptionRoundOffFormat)),S.push(e.measuringUnit),S.push(e.consumptionRate)),S.push(this.decimalPipe.transform(e.billTransactions[t].headAmount,this.roundFormat)),F.push(S),S=[],M+=e.billTransactions[t].headAmount)}S.push(t.accountNumber),S.push(t.fromDateLocal+"-"+t.toDateLocal),S.push(this.currencyPipe.transform(t.previousDueAmount,this.currency.toString(),!0,this.roundFormat)),S.push(t.billAmountLocal),P.push(S),t.billCharges.forEach(t=>{if("VAT"!==t.headDisplay){const e=D.find(e=>e.label===t.headDisplay);e?e.value+=t.headAmount:D.push({label:t.headDisplay,value:t.headAmount})}}),D.forEach(t=>{I.push({label:t.label,value:this.currencyPipe.transform(t.value,this.currency.toString(),!0,this.roundFormat)}),M+=t.value}),I.push({label:"Total Charges for Current Period",value:this.currencyPipe.transform(M,this.currency.toString(),!0,this.roundFormat)}),t.billTaxDetails.forEach(t=>{const e=I.find(e=>e.label===t.taxDisplayName);if(e){const i=Number(e.value.replace(this.currency,"").trim())+Number(t.taxAmount);e.value=this.currencyPipe.transform(i,this.currency.toString(),!0,this.roundFormat)}else I.push({label:t.taxDisplayName,value:this.currencyPipe.transform(t.taxAmount,this.currency.toString(),!0,this.roundFormat)})}),I.push({label:"Previous Outstanding Amount",value:this.currencyPipe.transform(t.previousDueAmount,this.currency.toString(),!0,this.roundFormat)},{label:"Total Amount Due",value:this.currencyPipe.transform(t.billAmount+t.previousDueAmount,this.currency.toString(),!0,this.roundFormat)}),w.push({label:"Bill No",value:null!==(l=null==t?void 0:t.billNumber)&&void 0!==l?l:""},{label:"Date of issue",value:null!==(n=null==t?void 0:t.billDateLocal)&&void 0!==n?n:""},{label:"Due Date",value:null!==(a=null==t?void 0:t.dueDateLocal)&&void 0!==a?a:""}),R.push({label:"Customer Name",value:null!==(o=null==t?void 0:t.ownerName)&&void 0!==o?o:""},{label:"Customer AccountNumber",value:null!==(r=null==t?void 0:t.accountNumber)&&void 0!==r?r:""},{label:"Unit No",value:null!==(s=null==t?void 0:t.unitNumber)&&void 0!==s?s:""},{label:"Address",value:null!==(u=null===(c=null==t?void 0:t.receiverDetails[0])||void 0===c?void 0:c.address1)&&void 0!==u?u:""},{label:"City",value:null!==(h=null===(d=null==t?void 0:t.receiverDetails[0])||void 0===d?void 0:d.city)&&void 0!==h?h:""},{label:"P.O Box",value:null!==(b=null===(m=null==t?void 0:t.receiverDetails[0])||void 0===m?void 0:m.zipPostalCode)&&void 0!==b?b:""},{label:"Phone number",value:null!==(p=null===(f=null==t?void 0:t.receiverDetails[0])||void 0===f?void 0:f.phoneNumber)&&void 0!==p?p:""},{label:"Fax Number",value:""},{label:"Client",value:null!==(y=null===(g=null==t?void 0:t.client)||void 0===g?void 0:g.clientName)&&void 0!==y?y:""},{label:"Client TRN",value:null!==(C=null===(v=null==t?void 0:t.client)||void 0===v?void 0:v.trnNo)&&void 0!==C?C:""}),A.push({firstItem:"Billing period",secondItem:"From:",thirdItem:t.fromDateLocal,fourthItem:"To:",fifthItem:t.toDateLocal});let k=[];S=[],t&&t.bills&&t.bills.length&&t.bills.forEach(t=>{if(t.billTariffDetails&&t.billTariffDetails.length)for(let e=0;e<t.billTariffDetails.length;e++)t.billTariffDetails[e].slabSettingsId&&t.billTariffDetails[e].slabSettingsId>0&&0==e?k=["Slab","Min Consumption","Max Consumption","Consumption","Rate","Amount"]:0==t.billTariffDetails[e].slabSettingsId&&0==e&&(k=["Season","Week Type","Peak Type","Consumption","Rate","Amount"]),S.push(t.billTariffDetails[e].season),S.push(t.billTariffDetails[e].weekType),S.push(t.billTariffDetails[e].peakType),S.push(t.billTariffDetails[e].consumption),S.push(t.billTariffDetails[e].rate),S.push(t.billTariffDetails[e].amount),N.push(S),S=[]}),this.getNewBillReport(["Unit No","Meter No","Previous Reading","Present Reading","Consumption","Consumption TR-HR"],T,["Customer AccountNumber","Billing Period","Previous Due","Total for current period"],P,w,R,A,["Charges","Consumption","Measuring Unit","Tariff","Total"],F,t,I,k,N)}getNewBillReport(t,e,i,l,n,a,o,r,s,c,u,d,h){var m,b,f,p,g,y,v,C;let S=new vt.default({orientation:"portrait",unit:"pt",format:"letter"});const T=null!==(b=null===(m=null==c?void 0:c.client)||void 0===m?void 0:m.clientName)&&void 0!==b?b:"",D=S.getTextWidth(T.trim());S.setTextColor(0,0,0),S.setFontSize(17),S.setFont("Cambria"),S.text(T,Number(S.internal.pageSize.width/2)-Number(0!=D?D/2:0),18),this.addImage(S,c),S.setLineWidth(.1),S.line(Number(S.internal.pageSize.width/2)-Number(0!=D?D/2:0),21,Number(S.internal.pageSize.width/2)-Number(0!=D?D/2:0)+D,21),S.setFontSize(13);let P="";c&&c.client&&c.client.addresses[0]&&(P=null!==(y=null!==(p=null===(f=c.client.addresses[0].address1)||void 0===f?void 0:f.toLowerCase())&&void 0!==p?p:","+(null===(g=c.client.addresses[0].city)||void 0===g?void 0:g.toLowerCase()))&&void 0!==y?y:"",","==P.trim()&&(P="")),S.text(P,Number(S.internal.pageSize.width/2)-Number(0!=D?D/2:0)+5,30),S.setLineWidth(.1),S.setFontSize(14),S.text("Billing Statement",30,41),S.autoTable("",n,{startX:10,startY:50,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:150,halign:"left"},1:{cellWidth:190,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"},didParseCell:function(t){t.cell.styles.cellPadding=1}});const w=Number(this.decimalPipe.transform(S.autoTable.previous.finalY,"1.0-0"));S.autoTable("",o,{startX:10,startY:w,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:150,halign:"left"},1:{cellWidth:95,halign:"center"},2:{cellWidth:95,halign:"center"},3:{cellWidth:95,halign:"center"},4:{cellWidth:95,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0]},didParseCell:function(t){t.cell.styles.cellPadding=1}});const x=Number(this.decimalPipe.transform(S.autoTable.previous.finalY,"1.0-0"));S.autoTable("",a,{startX:10,startY:x,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:150,halign:"left"},1:{cellWidth:380,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0]},didParseCell:function(t){t.cell.styles.cellPadding=1}});const R=Number(this.decimalPipe.transform(S.autoTable.previous.finalY,"1.0-0"));S.setFont("Cambria"),S.setFontSize(10),S.text("Meter Read-Outs".toUpperCase(),30,R+15),S.autoTable(t,e,{startX:10,startY:R+30,didDrawPage:function(t){var e="Page "+t.pageCount;S.setFontSize(10);var i=S.internal.pageSize.height||S.internal.pageSize.getHeight();S.text(e,t.settings.margin.left,i-10)},styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"center"},1:{cellWidth:95,halign:"center"},2:{cellWidth:95,halign:"center"},3:{cellWidth:95,halign:"center"},4:{cellWidth:74,halign:"center"},5:{cellWidth:75,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(t){t.cell.styles.cellPadding=1}});const A=Number(this.decimalPipe.transform(S.autoTable.previous.finalY,"1.0-0"));S.setFontSize(10),S.text("Charges Breakdown".toUpperCase(),30,A+15),S.autoTable(r,s,{startX:10,startY:A+30,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:60,halign:"center"},1:{cellWidth:155,halign:"center"},2:{cellWidth:85,halign:"center"},3:{cellWidth:85,halign:"center"},4:{cellWidth:74,halign:"center"},5:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(t){t.cell.styles.cellPadding=1}});const F=Number(this.decimalPipe.transform(S.autoTable.previous.finalY,"1.0-0"));S.autoTable(d,h,{startX:10,startY:F+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:130,halign:"center"},1:{cellWidth:85,halign:"center"},2:{cellWidth:85,halign:"center"},3:{cellWidth:85,halign:"center"},4:{cellWidth:74,halign:"center"},5:{cellWidth:75,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(t){t.cell.styles.cellPadding=1}});const I=Number(this.decimalPipe.transform(S.autoTable.previous.finalY,"1.0-0"));S.autoTable("",u,{startX:10,startY:I+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{bottom:35,left:230},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:235,fontStyle:"italic"},1:{cellWidth:100}},didParseCell:function(t){1==t.column.index&&(t.cell.styles.halign="right"),t.cell.styles.cellPadding=1},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});const N=Number(this.decimalPipe.transform(S.autoTable.previous.finalY,"1.0-0"));S.setFillColor(241,241,244),S.rect(30,N+20,535,80,"FD"),S.setFillColor(0,0,0),S.setFontSize(9),S.text(null===(C=null===(v=null==c?void 0:c.client)||void 0===v?void 0:v.termsConditions[0])||void 0===C?void 0:C.termsAndCondition.replace("{{ClientName}}",c.client.clientName).replace("{{TRNNumber}}",c.client.trnNo).replace("{{Currency}}",this.currency),60,N+30),S.setTextColor(0,0,0),S.line(5,N+110,607,N+110);const M=S.internal.pageSize.height;S.text("Notice :- Please tear and attach the slip  along with your payment",30,M-90),S.autoTable(i,l,{startX:10,startY:M-80,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:120,halign:"center"},1:{cellWidth:200,halign:"center"},2:{cellWidth:100,halign:"right"},3:{cellWidth:120,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(t){t.cell.styles.cellPadding=1}}),"function"==typeof S.putTotalPages&&S.putTotalPages("1");var k=S.output("blob");window.open(URL.createObjectURL(k))}downloadBillNewFormatReport(t){var e,i,l,n,a,o,r,s,c,u,d,h;let m=[],b=[],f=[],p=[],g=[],y=[],v=[],C=[],S=["Meter No","Tarif","Previous Reading KWH","Present Reading KWH","Consumption","Consumption TR-HR","Unit Rate "+this.currency+"/TR-HR","Amount"];for(let D=0;D<t.bills.length;D++)this.consumptionRoundOffFormat=null!==(e=Object(x.e)("ConsumptionRoundOff",t.bills[D].utilityTypeId))&&void 0!==e?e:this.envService.consumptionRoundOffFormat,m.push(t.bills[D].deviceName),m.push(t.bills[D].utilityType),m.push(this.decimalPipe.transform(t.bills[D].previousReading,this.consumptionRoundOffFormat)),m.push(this.decimalPipe.transform(t.bills[D].presentReading,this.consumptionRoundOffFormat)),m.push(this.decimalPipe.transform(t.bills[D].consumption,this.consumptionRoundOffFormat)),"BTU"===t.bills[D].utilityType&&t.bills[D].billTransactions&&t.bills[D].billTransactions.length&&t.bills[D].billTransactions.findIndex(t=>t.measuringUnitId&&2===t.measuringUnitId)>-1?m.push(this.decimalPipe.transform(.2843*t.bills[D].consumption,this.roundFormat)):m.push(0),m.push(t.bills[D].consumptionRate),m.push(t.bills[D].billAmountLocal),b.push(m),m=[];for(let D=0;D<t.bills.length;D++){this.consumptionRoundOffFormat=null!==(i=Object(x.e)("ConsumptionRoundOff",t.bills[D].utilityTypeId))&&void 0!==i?i:this.envService.consumptionRoundOffFormat;const e=t.bills[D];for(let t=0;t<e.billTransactions.length;t++)m.push(e.utilityType+"-"+e.billTransactions[t].headDisplay),m.push(this.decimalPipe.transform(e.consumption,this.consumptionRoundOffFormat)),m.push(e.consumptionUnit),m.push(e.consumptionRate),m.push(this.decimalPipe.transform(e.billTransactions[t].headAmount,this.roundFormat)),v.push(m),m=[]}m.push(t.accountNumber),m.push(t.fromDateLocal+"-"+t.toDateLocal),m.push(t.billAmountLocal),p.push(m);let T=[];t.bills.forEach(t=>{if(t.billTransactions&&t.billTransactions.length){const e=["consumption","consumptioncharge"];t.billTransactions.forEach(t=>{if(!e.includes(t.headDisplay.toLowerCase())){const e=T.find(e=>e.label===t.headDisplay);e?e.value+=t.headAmount:T.push({label:t.headDisplay,value:t.headAmount})}})}}),t.billCharges.forEach(t=>{if("VAT"!==t.headDisplay){const e=T.find(e=>e.label===t.headDisplay);e?e.value+=t.headAmount:T.push({label:t.headDisplay,value:t.headAmount})}}),T.forEach(t=>{f.push({label:t.label,value:this.currencyPipe.transform(t.value,this.currency.toString(),!0,this.roundFormat)})}),t.billTaxDetails&&t.billTaxDetails.length&&t.billTaxDetails.forEach(t=>{f.push({label:t.taxDisplayName,value:this.currencyPipe.transform(t.taxAmount,this.currency.toString(),!0,this.roundFormat)})}),C.push({label:"Total for Current Period",value:this.currencyPipe.transform(t.billAmount+t.previousDueAmount,this.currency.toString(),!0,this.roundFormat)}),g.push({label:"Bill No",value:": "+t.billNumber},{label:"Date of issue",value:": "+t.billDateLocal},{label:"Due Date",value:": "+t.dueDateLocal}),y.push({label:"Billing period",value:`:  From: ${t.fromDateLocal} To: ${t.toDateLocal} `},{label:"Customer Account",value:": "+t.accountNumber},{label:"Customer Name",value:": "+t.ownerName},{label:"Unit No",value:": "+t.unitNumber},{label:"Address",value:": "+(null===(n=null===(l=null==t?void 0:t.client)||void 0===l?void 0:l.addresses[0])||void 0===n?void 0:n.address1)},{label:"City",value:": "+(null===(o=null===(a=null==t?void 0:t.client)||void 0===a?void 0:a.addresses[0])||void 0===o?void 0:o.city)},{label:"P.O Box",value:": "+(null===(s=null===(r=null==t?void 0:t.client)||void 0===r?void 0:r.addresses[0])||void 0===s?void 0:s.zipPostalCode)},{label:"Phone number",value:null!==(u=": "+(null===(c=null==t?void 0:t.receiverDetails[0])||void 0===c?void 0:c.phoneNumber))&&void 0!==u?u:""},{label:"Fax Number",value:": "},{label:"Client",value:": "+(null===(d=null==t?void 0:t.client)||void 0===d?void 0:d.clientName)},{label:"Client TRN",value:": "+(null===(h=null==t?void 0:t.client)||void 0===h?void 0:h.trnNo)}),this.getNewBillFormatReport(S,b,f,["Customer Number","Billing Period","Total for current period"],p,g,y,t,C)}getNewBillFormatReport(t,e,i,l,n,a,o,r,s){var c,u,d=new Image;d.src=this.filePath+"/uploads/"+r.client.photo;let h=new vt.default({orientation:"portrait",unit:"pt",format:"letter"});h.rect(5,5,h.internal.pageSize.width-10,h.internal.pageSize.height-10,"S"),h.setTextColor(0,0,0),h.setFontSize(11),h.setFont("Cambria"),h.text("Billing Statement".toUpperCase(),10,20),d.height&&h.addImage(d,"png",450,35,80,55),h.setLineWidth(.1),h.autoTable("",a,{startX:10,startY:35,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:15},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:190,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"},didParseCell:function(t){t.cell.styles.cellPadding=1.5}});const m=Number(this.decimalPipe.transform(h.autoTable.previous.finalY,"1.0-0"));h.autoTable("",o,{startX:10,startY:m,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:15},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:380,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0]},didParseCell:function(t){t.cell.styles.cellPadding=1.5}});const b=Number(this.decimalPipe.transform(h.autoTable.previous.finalY,"1.0-0"));h.setFont("Cambria"),h.text("Meter Read-Out".toUpperCase(),10,b+15),h.autoTable(t,e,{startX:10,startY:b+30,didDrawPage:function(t){var e="Page "+t.pageCount;h.setFontSize(10);var i=h.internal.pageSize.height||h.internal.pageSize.getHeight();h.text(e,t.settings.margin.left,i-10)},styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:15},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:65,halign:"center"},1:{cellWidth:72,halign:"center"},2:{cellWidth:80,halign:"center"},3:{cellWidth:80,halign:"center"},4:{cellWidth:72,halign:"center"},5:{cellWidth:72,halign:"center"},6:{cellWidth:72,halign:"center"},7:{cellWidth:72,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(t){t.cell.styles.cellPadding=1.5}});const f=Number(this.decimalPipe.transform(h.autoTable.previous.finalY,"1.0-0"));h.autoTable("",i,{startX:10,startY:f+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{bottom:35,left:250},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:250,fontStyle:"italic"},1:{cellWidth:100}},didParseCell:function(t){1==t.column.index&&(t.cell.styles.halign="right"),t.cell.styles.cellPadding=1.5},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});const p=Number(this.decimalPipe.transform(h.autoTable.previous.finalY,"1.0-0"));h.line(5,p+10,607,p+10),h.autoTable("",s,{startX:10,startY:p+20,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{bottom:35,left:250},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:250,fontStyle:"italic"},1:{cellWidth:100}},didParseCell:function(t){1==t.column.index&&(t.cell.styles.halign="right"),t.cell.styles.cellPadding=1.5},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});const g=Number(this.decimalPipe.transform(h.autoTable.previous.finalY,"1.0-0"));h.line(5,g+10,607,g+10),h.text(null===(u=null===(c=null==r?void 0:r.client)||void 0===c?void 0:c.termsConditions[0])||void 0===u?void 0:u.termsAndCondition.replace("{{ClientName}}",r.client.clientName).replace("{{TRNNumber}}",r.client.trnNo).replace("{{Currency}}",this.currency),10,g+30);var y=h.internal.pageSize.height||h.internal.pageSize.getHeight();h.text("Notice :- Please tear and attach the slip  along with your payment",10,y-90),h.autoTable(l,n,{startX:10,startY:y-70,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:15},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"center"},1:{cellWidth:340,halign:"center"},2:{cellWidth:150,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(t){t.cell.styles.cellPadding=1.5}}),"function"==typeof h.putTotalPages&&h.putTotalPages("1");var v=h.output("blob");window.open(URL.createObjectURL(v))}onRefund(t){t.type="Refund",this.dialog.open(Dt,{data:t}).afterClosed().subscribe(t=>{t&&this.billSettlementService.saveRefund(t).subscribe({next:t=>{this.notificationMessage("Refund saved successfully","green-snackbar"),this.onFilterData()},error:t=>{this.notificationMessage(t,"red-snackbar")}})})}getMovedOutTenants(){this.contracts=null,this.clientId=parseInt(this.cookieService.get("globalClientId")),this.contractService.getMovedOutTenants(this.clientId).subscribe(t=>{(t=t.map(t=>new v(t))).forEach(t=>{t.securityDepositLocal=this.currencyPipe.transform(t.securityDeposit,this.currency.toString(),!0,this.roundFormat),t.contractDateLocal=this.date.transform(t.contractDate.toString(),this.dateFormat.toString()),t.contractEndDateLocal=this.date.transform(t.contractEndDate.toString(),this.dateFormat.toString()),t.securityDepositInHand=t.receivedAmount-t.refundAmount,t.securityDepositInHandLocal=this.currencyPipe.transform(t.securityDepositInHand,this.currency.toString(),!0,this.roundFormat),t.receivedAmountLocal=this.currencyPipe.transform(t.receivedAmount,this.currency.toString(),!0,this.roundFormat),t.refundAmountLocal=this.currencyPipe.transform(t.refundAmount,this.currency.toString(),!0,this.roundFormat),t.remainingAmountLocal=this.currencyPipe.transform(t.remainingAmount,this.currency.toString(),!0,this.roundFormat)}),this.subject$.next(t)}),this.listData=new h.k(this.contracts),this.data$.pipe(Object(b.a)(t=>!!t)).subscribe(t=>{this.contracts=t,this.listData.data=t}),this.ngAfterViewInit()}getContractsAboutToExpire(){this.contracts=[],this.clientId=parseInt(this.cookieService.get("globalClientId")),this.contractService.getContractsAboutToExpire(this.clientId).subscribe(t=>{(t=t.map(t=>new v(t))).forEach(t=>{t.securityDepositLocal=this.currencyPipe.transform(t.securityDeposit,this.currency.toString(),!0,this.roundFormat),t.contractDateLocal=this.date.transform(t.contractDate.toString(),this.dateFormat.toString()),t.contractEndDateLocal=this.date.transform(t.contractEndDate.toString(),this.dateFormat.toString()),t.securityDepositInHand=t.receivedAmount-t.refundAmount,t.securityDepositInHandLocal=this.currencyPipe.transform(t.securityDepositInHand,this.currency.toString(),!0,this.roundFormat),t.receivedAmountLocal=this.currencyPipe.transform(t.receivedAmount,this.currency.toString(),!0,this.roundFormat),t.refundAmountLocal=this.currencyPipe.transform(t.refundAmount,this.currency.toString(),!0,this.roundFormat),t.remainingAmountLocal=this.currencyPipe.transform(t.remainingAmount,this.currency.toString(),!0,this.roundFormat)}),this.subject$.next(t)}),this.listData=new h.k(this.contracts),this.data$.pipe(Object(b.a)(t=>!!t)).subscribe(t=>{this.contracts=t,this.listData.data=t}),this.ngAfterViewInit()}toggleMovedOutTenant(t){this.movedOut=!t,this.movedOut&&(this.reminder=t),this.getContractDetails()}toggleContractsReminder(t){this.reminder=!t,this.reminder&&(this.movedOut=t),this.getContractDetails()}onRefundHistory(t){this.router.navigate(["bills/create-refund"],{queryParams:{id:t.tenantId}})}toggleAllSelection(){this.selectFilterModes=this.allSelected.selected?[this.filterModes.map(t=>t.value),0]:[]}togglePerOne(){this.allSelected.selected&&this.allSelected.deselect(),this.selectFilterModes.length>=this.filterModes.length&&this.allSelected.select()}onReceivePayment(t){t&&(t.type="Receive SD Payment",this.dialog.open(Dt,{data:t}).afterClosed().subscribe(e=>{e&&this.onGenerateInoice(t,e)}))}onSavePayment(t){this.billSettlementService.saveBillPayments(t).subscribe({next:t=>{t?(this.notificationMessage("Security deposit payment save successfully","green-snackbar"),this.getContractDetails()):this.notificationMessage("Security deposit payment save failed","red-snackbar")},error:t=>{this.notificationMessage("Security deposit payment save failed","red-snackbar")}})}updatePaymentDetails(t,e){t.paymentTransactions.forEach(t=>t.billId=e)}onPrintReceipt(t){this.pdfsToMerge=[],t.billMasters&&t.billMasters.length&&t.billMasters.filter(t=>t.paymentId&&t.paymentId>0&&5==t.billTypeId).forEach(t=>{this.onGetPaymentDetail(t.paymentId)})}receiptView(t){this.billService.sdReceiptView(t).subscribe({next:t=>{t?this.downloadSDFile(t):this.notificationMessage("No data to print","red-snackbar")},error:t=>{this.notificationMessage("No data to print","red-snackbar")}})}downloadSDFile(t){return Object(c.a)(this,void 0,void 0,(function*(){const e=yield Ft.PDFDocument.create();for(const a of t){const t=yield Ft.PDFDocument.load(a);(yield e.copyPages(t,t.getPageIndices())).forEach(t=>{e.addPage(t)})}const i=yield e.save(),l=new Blob([i],{type:"application/pdf"}),n=window.URL.createObjectURL(l);window.open(n)}))}onGetPaymentDetail(t,e=0){this.payments=[];const i=Number(this.cookieService.get("globalClientId"));this.billService.getPaymentDetail(t,i).subscribe({next:t=>{t.forEach(t=>{t.paymentDateLocal=this.date.transform(t.paymentDate.toString(),this.dateFormat.toString()),t.referenceDateLocal=this.date.transform(t.referenceDate.toString(),this.dateFormat.toString()),t.paymentAmountLocal=this.currencyPipe.transform(t.paymentAmount,this.currency.toString(),!0,this.roundFormat),t.advanceAmountLocal=this.currencyPipe.transform(t.advanceAmount,this.currency.toString(),!0,this.roundFormat),t.billMasters&&t.billMasters.length&&t.billMasters.forEach(t=>{var e,i,l,n,a;t.billDateLocal=this.date.transform(null===(e=null==t?void 0:t.billDate)||void 0===e?void 0:e.toString(),this.dateFormat.toString()),t.billAmountLocal=this.currencyPipe.transform(null==t?void 0:t.billAmount,this.currency.toString(),!0,this.roundFormat),t.fromDateLocal=this.date.transform(null===(i=null==t?void 0:t.fromDate)||void 0===i?void 0:i.toString(),this.dateFormat.toString()),t.toDateLocal=this.date.transform(null===(l=null==t?void 0:t.toDate)||void 0===l?void 0:l.toString(),this.dateFormat.toString()),t.dueDateLocal=this.date.transform(null===(n=null==t?void 0:t.dueDate)||void 0===n?void 0:n.toString(),this.dateFormat.toString()),t.paidLocal=this.currencyPipe.transform(null===(a=null==t?void 0:t.paid)||void 0===a?void 0:a.toString(),this.currency.toString(),!0,this.roundFormat)})}),this.payments=t,this.receiptView(this.payments)},error:()=>{this.notificationMessage("Payment details not found","red-snackbar")}})}downloadFile(){return Object(c.a)(this,void 0,void 0,(function*(){const t=yield Ft.PDFDocument.create();for(const n of this.pdfsToMerge){const e=yield fetch(n).then(t=>t.arrayBuffer()),i=yield Ft.PDFDocument.load(e);(yield t.copyPages(i,i.getPageIndices())).forEach(e=>{t.addPage(e)})}const e=yield t.save(),i=new Blob([e],{type:"application/pdf"}),l=window.URL.createObjectURL(i);window.open(l)}))}downloadReport(t){let e=[],i=[],l="",n="";const a=Array.from(new Set(t.billMasters.map(t=>t.billNumber))),o=Array.from(new Set(t.billMasters.map(t=>t.unitNumber)));a&&a.length&&a.forEach(t=>{l+=t+","}),o&&o.length&&o.forEach(t=>{n+=t+","}),i.push({label:"Receipt Number:",value:t.paymentNumber},{label:"Receipt Date:",value:t.paymentDateLocal},{label:"Account Number:",value:t.accountNumber},{label:"Unit Number:",value:0===n.trim().indexOf(",")?n.trim().slice(1).slice(0,-1):n.trim().slice(0,-1)},{label:"Mode of payment:",value:t.paymentMode});let r=0;t.billMasters.forEach(t=>{r+=t.paid});const s=t.outStandingAmount-r;e.push({label:"Total Outstanding Amount :",value:this.currencyPipe.transform(t.outStandingAmount,this.currency.toString(),!0,this.roundFormat)},{label:"Received Payments :",value:t.paymentAmountLocal},{label:"",value:""},{label:"Balance Outstanding :",value:this.currencyPipe.transform(s,this.currency.toString(),!0,this.roundFormat)}),this.getReport(t,e,i)}addImage(t,e){var i;try{if(e&&e.billMasters&&e.billMasters.length&&e.billMasters[0]&&e.billMasters[0].client&&e.billMasters[0].client.imageProperties&&e.billMasters[0].client.imageProperties.length){const n=e.billMasters[0].client.imageProperties.find(t=>"receipt"===t.imageType.trim().toLowerCase());if(n){var l=new Image;l.src=this.filePath+"/uploads/"+(null===(i=null==e?void 0:e.billMasters[0].client)||void 0===i?void 0:i.photo),l.onload=function(){t.addImage(l,n.imgX,n.imgY,n.imgW,n.imgH)}}else this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar")}else this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar")}catch(n){this.notificationMessage("Image not found.","red-snackbar")}return t}getReport(t,e,i){var l,n,a,o,r,s,c,u,d,h,m,b,f,p,g,y,v,C,S,T,D,P,w,R,A,F,I,N,M,k,O,W,U,E,L,z,B,j,G,Y,H,$,V,_,X;let q=new vt.default({orientation:"portrait",unit:"pt",format:"letter"});q.rect(5,5,q.internal.pageSize.width-10,q.internal.pageSize.height-10,"S"),q.setFontSize(30),this.addImage(q,t),q.setTextColor(0,0,0),q.setFontSize(14),q.setFont("Cambria","bold"),q.text("SECURITY DEPOSIT PAYMENT RECEIPT",180,30),q.setFont("Cambria","normal"),q.setFontSize(14),q.text(Object(x.f)(null===(n=null===(l=null==t?void 0:t.billMasters[0])||void 0===l?void 0:l.client)||void 0===n?void 0:n.clientName).toUpperCase(),10,50),q.setFontSize(10),q.text("TRN: "+Object(x.f)(null===(o=null===(a=null==t?void 0:t.billMasters[0])||void 0===a?void 0:a.client)||void 0===o?void 0:o.trnNo),10,60),q.text("PO Box "+Object(x.f)(null===(c=null===(s=null===(r=null==t?void 0:t.billMasters[0])||void 0===r?void 0:r.client)||void 0===s?void 0:s.addresses[0])||void 0===c?void 0:c.zipPostalCode),10,70),q.text(Object(x.f)(null===(h=null===(d=null===(u=null==t?void 0:t.billMasters[0])||void 0===u?void 0:u.client)||void 0===d?void 0:d.addresses[0])||void 0===h?void 0:h.location,",")+Object(x.f)(null===(f=null===(b=null===(m=null==t?void 0:t.billMasters[0])||void 0===m?void 0:m.client)||void 0===b?void 0:b.addresses[0])||void 0===f?void 0:f.city,",")+Object(x.f)(null===(y=null===(g=null===(p=null==t?void 0:t.billMasters[0])||void 0===p?void 0:p.client)||void 0===g?void 0:g.addresses[0])||void 0===y?void 0:y.country,","),10,80),q.text("Phone: "+Object(x.f)(null===(C=null===(v=null==t?void 0:t.billMasters[0])||void 0===v?void 0:v.client)||void 0===C?void 0:C.phoneNo),10,90),q.text("Email: "+Object(x.f)(null===(T=null===(S=null==t?void 0:t.billMasters[0])||void 0===S?void 0:S.client)||void 0===T?void 0:T.email),10,100),q.text("Web: "+Object(x.f)(null===(P=null===(D=null==t?void 0:t.billMasters[0])||void 0===D?void 0:D.client)||void 0===P?void 0:P.website),10,110),q.setFillColor(241,241,244),q.setDrawColor(206,203,203),q.rect(10,120,250,90,"FD"),q.setTextColor(0,0,0),q.setFontSize(12),q.text(Object(x.f)(null==t?void 0:t.tenantName).toUpperCase(),20,135),q.text("CUSTOMER TRN: "+Object(x.f)(null==t?void 0:t.trn),20,155),q.text("unit #"+Object(x.f)(null===(w=null==t?void 0:t.billMasters[0])||void 0===w?void 0:w.unitNumber),20,170),q.setFontSize(10),q.text(Object(x.f)(null===(R=null==t?void 0:t.billMasters[0])||void 0===R?void 0:R.clientName),20,185),q.text(Object(x.f)(null===(F=null===(A=null==t?void 0:t.billMasters[0].client)||void 0===A?void 0:A.addresses[0])||void 0===F?void 0:F.city,",")+Object(x.f)(null===(M=null===(N=null===(I=null==t?void 0:t.billMasters[0])||void 0===I?void 0:I.client)||void 0===N?void 0:N.addresses[0])||void 0===M?void 0:M.country,","),20,200),q.setFontSize(9),q.autoTable("",i,{startX:210,startY:120,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:400},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:100,halign:"right"}},didParseCell:function(t){const e=t.column.index;0!=e&&1!=e||(t.cell.styles.rowHeight=1)},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});const K=Number(this.decimalPipe.transform(q.autoTable.previous.finalY,"1.0-0"));q.setLineWidth(.1),q.line(5,K+10,607,K+10),q.setTextColor(0,0,0),q.setFontSize(11),q.text("Management here by acknowledges the receipt of a security deposit on behalf of "+t.tenantName,20,K+30),q.text("tenant/owner in the amount of "+t.paymentAmountLocal+" for unit #"+(null===(k=null==t?void 0:t.billMasters[0])||void 0===k?void 0:k.unitNumber),20,K+45),q.text("Authorised signatory",20,K+100),q.setTextColor(0,0,0);const Q=K+120;q.setTextColor(255,0,0),q.setFontSize(9),q.text(`Note: A Late Fee will be applied after the due date. A Default Payment \nPenalty will be added to any unit that is ${null===(O=null==t?void 0:t.billMasters[0])||void 0===O?void 0:O.penaltyAfter} days or more in arrears.`,320,Q+20),q.setTextColor(25,118,210),q.setFontSize(12),q.text("USAGE TIPS to reduce consumption:",10,Q+80),q.text("Please Try to:",10,Q+100),q.setTextColor(0,0,0),q.setFontSize(9),q.text("- Keep filters clean",30,Q+110),q.text("- Set thermostats between 23C and 25C",30,Q+120),q.text("- Keep vents unblocked",30,Q+130),q.text("- Keep doors and windows closed",30,Q+140),q.text("- Undertake regular maintenance of the system",30,Q+150),q.setTextColor(25,118,210),q.setFontSize(12),q.text("Please Do Not:",10,Q+170),q.setTextColor(0,0,0),q.setFontSize(9),q.text("- Set thermostats to 20C or lower",30,Q+180),q.text("- Block vents",30,Q+190),q.text("- Leave doors and windows open",30,Q+200),q.text("- Leave heat producing appliances near thermostats",30,Q+210),q.setFillColor(119,183,11);var Z=q.internal.pageSize.height||q.internal.pageSize.getHeight();q.rect(320,Q+60,280,Z-80-(Q+60),"FD"),q.setFont("Comic Sans"),q.setTextColor(255,255,255),q.setFontSize(16),q.text("ADVERTISE WITH US",360,Q+80);const J=q.getTextWidth("ADVERTISE WITH US");q.setLineWidth(.1),q.line(360,Q+85,360+J,Q+85),q.setFontSize(9),q.text("For advertisement, contact at",390,Q+95),q.text(Object(x.f)(null===(U=null===(W=null==t?void 0:t.billMasters[0])||void 0===W?void 0:W.client)||void 0===U?void 0:U.phoneNo),390,Q+105),q.text(Object(x.f)(null===(L=null===(E=null==t?void 0:t.billMasters[0])||void 0===E?void 0:E.client)||void 0===L?void 0:L.email),390,Q+115),q.text(Object(x.f)(null===(B=null===(z=null==t?void 0:t.billMasters[0])||void 0===z?void 0:z.client)||void 0===B?void 0:B.website),390,Q+125),q.setTextColor(0,0,0),q.setLineWidth(.1),q.line(5,Z-70,607,Z-70),q.text(null!==(V=null!==(Y="For any enquiries, write to us "+(null===(G=null===(j=null==t?void 0:t.billMasters[0])||void 0===j?void 0:j.client)||void 0===G?void 0:G.email))&&void 0!==Y?Y:"\n or Logon to "+(null===($=null===(H=t.billMasters[0])||void 0===H?void 0:H.client)||void 0===$?void 0:$.website))&&void 0!==V?V:"",10,Z-60),q.setTextColor(255,0,0),q.setFont("bold");const tt=q.getTextWidth("Notice:");q.text("Notice:",340,Z-60),q.setFont("none"),q.setTextColor(0,0,0),q.text("Pay your bills before due date to avoid late payment surcharge",340+tt,Z-60),q.text("and disconnection.",340,Z-50),q.text("You can log onto "+(null===(X=null===(_=null==t?void 0:t.billMasters[0])||void 0===_?void 0:_.client)||void 0===X?void 0:X.website)+" to pay your invoices \nTerms & Conditions for Supply of Utility Services",340,Z-40),"function"==typeof q.putTotalPages&&q.putTotalPages("1");var et=q.output("datauristring");this.pdfsToMerge.push(et)}selectFilter(t){this.filterId=t.value,this.onFilterData()}onFilterData(){1==this.filterId?this.getContractsAboutToExpire():2==this.filterId?this.getMovedOutTenants():3==this.filterId?this.getContracts(!0):4==this.filterId?this.getContracts(!1,!0):this.getContracts()}onPrintAccountStatement(t){var e;const i={fromDate:xt(t.contractDate).format("YYYY-MM-DD"),toDate:xt(t.contractEndDate).format("YYYY-MM-DD"),tenantId:""+(null!==(e=t.tenantId)&&void 0!==e?e:0),clientId:this.clientId};this.billService.getAccountStatement(i).subscribe({next:e=>{e=e.filter(t=>!1===t.isBillFailed);let l=null;e.forEach(t=>{t.billDateLocal=this.date.transform(t.billDate.toString(),this.dateFormat.toString()),t.billAmountLocal=this.currencyPipe.transform(t.billAmount,this.currency.toString(),!0,this.roundFormat),t.creditNoteAmountLocal=this.currencyPipe.transform(t.creditNoteAmount,this.currency.toString(),!0,this.roundFormat),t.paidLocal=this.currencyPipe.transform(Number(t.paid),this.currency.toString(),!0,this.roundFormat),null!=l&&"Invoice"===t.entityType||"CreditNote"===t.entityType?t.previousDueAmount=Number(l)+Number(t.billAmount)-Number(t.paid)-Number(t.creditNoteAmount):null!=l&&"Payment"===t.entityType&&(t.previousDueAmount=Number(l)-Number(t.billAmount)-Number(t.paid)-Number(t.creditNoteAmount)),t.previousDueAmountLocal=this.currencyPipe.transform(t.previousDueAmount,this.currency.toString(),!0,this.roundFormat),l=Number(t.previousDueAmount)}),this.downloadAccountStatementReport(e,i,t)},error:t=>{this.notificationMessage("Account statement not found.","red-snackbar")}})}downloadAccountStatementReport(t,e,i){let l=[],n=[],a=[],o=0,r=0;t.forEach(t=>{"Opening Due"!==t.entityType&&(o+=Number(t.billAmount),r+=Number(t.paid))});for(let s=0;s<t.length;s++)l.push(t[s].billDateLocal),l.push(t[s].entityType),l.push(t[s].status),l.push(t[s].billAmountLocal),l.push(t[s].paidLocal),l.push(t[s].previousDueAmountLocal),a.push(l),l=[];l.push(""),l.push(""),l.push(""),l.push(""),l.push("Balance Due"),l.push(t[t.length-1].previousDueAmountLocal),a.push(l),n.push({label:"Opening Balance",value:t[0].previousDueAmountLocal},{label:"Invoiced Amount",value:this.currencyPipe.transform(o,this.currency.toString(),!0,this.roundFormat)},{label:"Amount Paid",value:this.currencyPipe.transform(r,this.currency.toString(),!0,this.roundFormat)},{label:"Balance Due",value:t[t.length-1].previousDueAmountLocal},{label:"Security Deposit Paid",value:i.receivedAmountLocal},{label:"Security Deposit Refunded",value:i.refundAmountLocal}),this.onExport(t,n,["Date","Transactions","Details","Amount","Payments","Balance"],a)}getAccountStatementReport(t,e,i,l,n,a,o){var r,s,c;let u=new vt.default({orientation:"portrait",unit:"pt",format:"letter"});u.rect(5,5,u.internal.pageSize.width-10,u.internal.pageSize.height-10,"S"),this.addAccountStatementImage(u,t,"Account Statement"),u.setFontSize(30),u.setTextColor(0,0,0),u.setFontSize(14),u.setFont("Cambria"),u.text(Object(x.f)(t[0].client.clientName).toUpperCase(),u.internal.pageSize.width-600,50),u.setFontSize(10),u.text("TRN: "+t[0].client.trnNo,u.internal.pageSize.width-600,60),u.text("PO Box "+t[0].client.addresses[0].zipPostalCode,u.internal.pageSize.width-600,70),u.text(t[0].client.addresses[0].address1+","+t[0].client.addresses[0].country,u.internal.pageSize.width-600,80),u.text("Phone: "+t[0].client.phoneNo,u.internal.pageSize.width-600,90),u.text("Email: "+t[0].client.email+", Web: "+t[0].client.website,u.internal.pageSize.width-600,100),u.setTextColor(0,0,0),u.setFontSize(11),u.setFont("Cambria","bold"),u.text("Statement of Accounts".toUpperCase(),u.internal.pageSize.width-250,70),u.setFont("Cambria","normal"),u.setTextColor(0,0,0),u.setFontSize(9),u.line(u.internal.pageSize.width-250,80,607,80);let d=this.date.transform(a.fromDate.toString(),this.dateFormat.toString()),h=this.date.transform(a.toDate.toString(),this.dateFormat.toString());u.text((d+" - "+h).toString(),u.internal.pageSize.width-250,90),u.line(u.internal.pageSize.width-250,100,607,100),u.setFontSize(10),u.text("Account Summary",u.internal.pageSize.width-250,120),u.setFontSize(9),u.autoTable("",e,{startX:u.internal.pageSize.width-250,startY:130,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:u.internal.pageSize.width-250},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:135,halign:"left"},1:{cellWidth:100,halign:"right"}},didParseCell:function(t){t.cell.styles.cellPadding=1.8},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});const m=Number(this.decimalPipe.transform(u.autoTable.previous.finalY,"1.0-0"));u.setFontSize(10),u.text("Customer Details",10,120),u.setFillColor(241,241,244),u.setDrawColor(206,203,203),u.rect(10,130,250,m-30-100,"FD"),u.setTextColor(0,0,0),u.setFontSize(10),u.text(null===(r=t[0])||void 0===r?void 0:r.ownerName.toUpperCase(),20,145),u.text("CUSTOMER TRN: "+(null===(s=t[0])||void 0===s?void 0:s.trn),20,160),u.text("unit #"+(null==o?void 0:o.unitNumber),20,175),u.text("Account Number: "+(null===(c=t[0])||void 0===c?void 0:c.accountNumber),20,190),u.setFontSize(9),u.setLineWidth(.1),u.line(5,m+10,607,m+10),u.autoTable(i,l,{startX:10,startY:m+20,didDrawPage:function(t){var e="Page "+t.pageCount;"function"==typeof u.putTotalPages&&(e+=" of 1",u.rect(5,5,u.internal.pageSize.width-10,u.internal.pageSize.height-10,"S")),u.setFontSize(9);var i=u.internal.pageSize.height||u.internal.pageSize.getHeight();u.text(e,t.settings.margin.left,i-10)},styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:m+20,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:70,halign:"center"},1:{cellWidth:100,halign:"center"},2:{cellWidth:180,halign:"center"},3:{cellWidth:80,halign:"right"},4:{cellWidth:80,halign:"right"},5:{cellWidth:80,halign:"right"}},didParseCell:function(t){"Balance Due"===t.cell.raw&&(t.cell.styles.fontStyle="bold")},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]}}),u.setTextColor(0,0,0),Number(this.decimalPipe.transform(u.autoTable.previous.finalY,"1.0-0")),"function"==typeof u.putTotalPages&&u.putTotalPages("1");var b=u.output("blob");window.open(URL.createObjectURL(b))}addAccountStatementImage(t,e,i){var l;try{if(e&&e.length&&e[0]&&e[0].client&&e[0].client.imageProperties&&e[0].client.imageProperties.length){const a=e[0].client.imageProperties.find(t=>t.imageType.trim().toLowerCase()===i.toLowerCase());if(a){var n=new Image;n.src=this.filePath+"/uploads/"+(null===(l=e[0].client)||void 0===l?void 0:l.photo),n.onload=function(){t.addImage(n,a.imgX,a.imgY,a.imgW,a.imgH)}}else this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar")}else this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar")}catch(a){this.notificationMessage("Image not found.","red-snackbar")}return t}activateContract(t){this.contracts.findIndex(e=>e.unitId===t.unitId&&e.id!==t.id&&0==e.isDeleted)>-1?this.notificationMessage("Already a contract active on this unit","red-snackbar"):this.dialog.open(w.a,{data:{label:"Do you want to activate contract?",selected:!1}}).afterClosed().subscribe(e=>{e&&this.contractService.activateContractById(t.id).subscribe({next:()=>{this.snackbar.open("Contract activated successfully",null,{duration:5e3,verticalPosition:"top",horizontalPosition:"center",panelClass:["green-snackbar"]}),this.getContractDetails()},error:()=>{this.notificationMessage("Contract activation failed","red-snackbar")}})})}onExport(t,e,i,l){if(t&&t.length>0){if(this.getJsonData(t,e,i,l),null!=this.tableData&&this.tableData.length>0){const t=Nt.utils.aoa_to_sheet(this.tableData),e=Nt.utils.book_new();Nt.utils.book_append_sheet(e,t,"Sheet1"),Nt.writeFile(e,"Statement of Accounts.xlsx")}}else this.notificationMessage("No Data to Export","yellow-snackbar")}getJsonData(t,e,i,l){this.tableData=[];let n=[];n.push("Account Summary"),this.tableData.push(n),n=[],e.forEach(t=>{n.push(t.label),n.push(t.value),this.tableData.push(n),n=[]}),i.forEach(t=>{n.push(t)}),this.tableData.push(n),l.forEach(t=>{this.tableData.push(t)})}getWorkflowRules(){this.workflowRuleService.getWorkflowRules(Number(this.clientId)).subscribe({next:t=>{if(t&&t.length&&(this.workflowRules=t,this.workflowRules&&this.workflowRules.length)){const t=this.workflowRules.find(t=>"Check Dues"===t.constraint);t&&(this.checkDues=t.value)}this.getContractDetails()},error:t=>{this.workflowRules=[],this.getContractDetails()}})}}return t.\u0275fac=function(e){return new(e||t)(R.Nb(C.b),R.Nb(Ct.b),R.Nb(l.f),R.Nb(s.f),R.Nb(l.d),R.Nb(Pt.a),R.Nb(l.g),R.Nb(g.a),R.Nb(yt.a),R.Nb(A.a),R.Nb(It.a),R.Nb(wt.a),R.Nb(Mt.a),R.Nb(kt.a))},t.\u0275cmp=R.Hb({type:t,selectors:[["create-contract"]],viewQuery:function(t,e){var i;1&t&&(R.Jc(u.a,!0),R.Vc(d.a,!0),R.Vc(jt,!0)),2&t&&(R.zc(i=R.cc())&&(e.paginator=i.first),R.zc(i=R.cc())&&(e.content=i.first),R.zc(i=R.cc())&&(e.allSelected=i.first))},inputs:{expiryReminder:"expiryReminder",displayedColumns:"displayedColumns"},decls:28,vars:14,consts:[["mode","card"],["current","Create Contracts",3,"crumbs"],["name","Create Contracts",3,"columns","filterChange"],[1,"actions","right","margin"],[1,"result"],[3,"ngModel","ngModelOptions","selectionChange","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["matTooltip","Create Contract","type","button","mat-mini-fab","","color","primary",1,"create","left","margin",3,"click"],["mat-table","","matSort","",3,"dataSource"],[4,"ngFor","ngForOf"],["matColumnDef","securityDepositInHandLocal"],["mat-header-cell","","class","header-align-right",4,"matHeaderCellDef"],["mat-cell","","class","header-align-right",4,"matCellDef"],["matColumnDef","remainingAmountLocal"],["matColumnDef","actions"],["class","actions-cell","mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["class","actions-cell","mat-cell","",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["class","clickable route-animations-elements","mat-row","",4,"matRowDef","matRowDefColumns"],[1,"paginator",3,"pageSize"],[3,"value"],[3,"matColumnDef",4,"ngIf"],[3,"matColumnDef"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell","",1,"header-align-right"],["mat-cell","",1,"header-align-right"],["mat-header-cell","","mat-sort-header","",1,"actions-cell"],["mat-cell","",1,"actions-cell"],["type","button","mat-icon-button","",3,"matMenuTriggerFor","click",4,"ngIf"],["yPosition","below","xPosition","before"],["actionsMenu","matMenu"],["mat-menu-item","",3,"click",4,"ngIf"],["mat-menu-item","",3,"disabled","click",4,"ngIf"],["mat-menu-item","",3,"disabled","click"],["mat-menu-item","",3,"click"],["type","button","mat-icon-button","",3,"matMenuTriggerFor","click"],["mat-header-row",""],["mat-row","",1,"clickable","route-animations-elements"]],template:function(t,e){1&t&&(R.Tb(0,"fury-page-layout",0),R.Tb(1,"fury-page-layout-header"),R.Ob(2,"fury-breadcrumbs",1),R.Sb(),R.Tb(3,"fury-page-layout-content"),R.Tb(4,"fury-list",2),R.bc("filterChange",(function(t){return e.onFilterChange(t)})),R.Tb(5,"div",3),R.Tb(6,"mat-form-field",4),R.Tb(7,"mat-label"),R.Rc(8,"Filter contracts"),R.Sb(),R.Tb(9,"mat-select",5),R.bc("selectionChange",(function(t){return e.selectFilter(t)}))("ngModelChange",(function(t){return e.filterId=t})),R.Pc(10,Gt,2,2,"mat-option",6),R.Sb(),R.Sb(),R.Tb(11,"button",7),R.bc("click",(function(){return e.createContract()})),R.Tb(12,"mat-icon"),R.Rc(13,"add"),R.Sb(),R.Sb(),R.Sb(),R.Tb(14,"table",8),R.Pc(15,Vt,2,1,"ng-container",9),R.Rb(16,10),R.Pc(17,_t,2,0,"th",11),R.Pc(18,Xt,2,1,"td",12),R.Qb(),R.Rb(19,13),R.Pc(20,qt,2,0,"th",11),R.Pc(21,Kt,2,1,"td",12),R.Qb(),R.Rb(22,14),R.Pc(23,Qt,1,0,"th",15),R.Pc(24,re,18,10,"td",16),R.Qb(),R.Pc(25,se,1,0,"tr",17),R.Pc(26,ce,1,0,"tr",18),R.Sb(),R.Ob(27,"mat-paginator",19),R.Sb(),R.Sb(),R.Sb()),2&t&&(R.Cb(2),R.mc("@fadeInRight",void 0)("crumbs",R.qc(12,ue)),R.Cb(1),R.mc("@fadeInUp",void 0),R.Cb(1),R.mc("columns",e.displayedColumns),R.Cb(5),R.mc("ngModel",e.filterId)("ngModelOptions",R.qc(13,de)),R.Cb(1),R.mc("ngForOf",e.filterModes),R.Cb(4),R.mc("dataSource",e.listData),R.Cb(1),R.mc("ngForOf",e.displayedColumns),R.Cb(10),R.mc("matHeaderRowDef",e.visibleColumns),R.Cb(1),R.mc("matRowDefColumns",e.visibleColumns),R.Cb(1),R.mc("pageSize",e.pageSize))},directives:[Ot.a,Wt.a,Ut.a,Et.a,Lt.a,W.d,W.h,G.a,n.q,n.t,l.n,I.a,zt.a,N.a,h.j,d.a,h.c,h.e,h.b,h.g,h.i,u.a,Y.n,l.o,h.d,d.b,h.a,Bt.e,Bt.b,Bt.d,h.f,h.h],styles:[".mat-dialog-container[_ngcontent-%COMP%]{margin-left:150px;margin-top:50px;width:60%;height:60%}.left-margin[_ngcontent-%COMP%]{margin-left:5px}.right-margin[_ngcontent-%COMP%]{margin-right:5px}.header-align-right[_ngcontent-%COMP%]{text-align:right}"],data:{animation:[f.a,p.a]}}),t})()}];let me=(()=>{class t{}return t.\u0275mod=R.Lb({type:t}),t.\u0275inj=R.Kb({factory:function(e){return new(e||t)},imports:[[s.j.forChild(he)],s.j]}),t})();var be=i("WCGO"),fe=i("YUcS"),pe=i("GiUZ"),ge=i("6NWb"),ye=i("Rlsg"),ve=i("wqNl"),Ce=i("VE2z"),Se=i("zWnM"),Te=i("zeEN");let De=(()=>{class t{}return t.\u0275mod=R.Lb({type:t}),t.\u0275inj=R.Kb({factory:function(e){return new(e||t)},providers:[l.f],imports:[[l.c,Bt.c,ge.b,ye.a,me,ve.a,Ce.a,n.l,r.a,n.w,fe.a,U.c,I.b,C.g,N.b,be.a,pe.a,o.a,a.a,Se.a,Te.a]]}),t})(),Pe=(()=>{class t{}return t.\u0275mod=R.Lb({type:t}),t.\u0275inj=R.Kb({factory:function(e){return new(e||t)},providers:[l.f,l.g],imports:[[l.c,me,n.l,r.a,n.w,r.a,be.a,De,o.a,a.a,Se.a,Te.a]]}),t})()},tB66:function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));var l=i("fXoL"),n=i("0IaG"),a=i("XiUz"),o=i("bTqV");let r=(()=>{class t{constructor(t){this.dialogRef=t,this.confirmMessage="Are you sure you want to Delete?",t.disableClose=!0}getConfirmation(t){this.dialogRef.close(t)}}return t.\u0275fac=function(e){return new(e||t)(l.Nb(n.h))},t.\u0275cmp=l.Hb({type:t,selectors:[["fury-user-confirmation-popup"]],decls:9,vars:1,consts:[[1,"heading"],[1,"mat-dlg-content","contentStyle"],["fxLayout","row","fxLayoutAlign","end center",1,"bottomPadding"],["mat-button","",3,"click"],["mat-button","",1,"buttonStyle",3,"click"]],template:function(t,e){1&t&&(l.Tb(0,"div",0),l.Rc(1," Confirm Action "),l.Sb(),l.Tb(2,"div",1),l.Rc(3),l.Sb(),l.Tb(4,"mat-dialog-actions",2),l.Tb(5,"button",3),l.bc("click",(function(){return e.getConfirmation(!1)})),l.Rc(6,"NO"),l.Sb(),l.Tb(7,"button",4),l.bc("click",(function(){return e.getConfirmation(!0)})),l.Rc(8,"YES"),l.Sb(),l.Sb()),2&t&&(l.Cb(3),l.Sc(e.confirmMessage))},directives:[n.c,a.d,a.c,o.a],styles:[".buttonStyle[_ngcontent-%COMP%]{background:#1976d2;color:#fff;padding-right:10px}.headingStyle[_ngcontent-%COMP%]{text-align:center;color:red;background-color:silver;border-radius:50%;width:100px;height:100px}.heading[_ngcontent-%COMP%]{font-size:large;font-weight:700;margin-top:10px}mat-icon[_ngcontent-%COMP%]{font-size:56px;height:56px;width:56px;line-height:56px;justify-content:center}.contentStyle[_ngcontent-%COMP%]{padding-top:40px;padding-bottom:30px;padding-right:30px}.rightAlign[_ngcontent-%COMP%]{text-align:right}.bottomPadding[_ngcontent-%COMP%]{padding-bottom:20px}"]}),t})()},zWnM:function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));var l=i("fXoL");let n=(()=>{class t{}return t.\u0275mod=l.Lb({type:t}),t.\u0275inj=l.Kb({factory:function(e){return new(e||t)},imports:[[]]}),t})()},zeEN:function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));var l=i("fXoL");let n=(()=>{class t{}return t.\u0275mod=l.Lb({type:t}),t.\u0275inj=l.Kb({factory:function(e){return new(e||t)},imports:[[]]}),t})()}}]);