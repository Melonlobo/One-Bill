(window.webpackJsonp=window.webpackJsonp||[]).push([[60],{"XL0+":function(e,t,i){"use strict";i.r(t),i.d(t,"LoginModule",(function(){return U}));var s=i("ofXK"),r=i("3Pt+"),o=i("KthW"),a=i("tyNb"),n=i("nStZ"),c=i("seMb"),l=i("+Kgr"),u=i("cIyM"),h=i("zSPf"),d=i("0E0g"),g=i("Y0L5"),b=i("hKI3"),m=i("KHMF"),p=i("sXtk"),f=i("fXoL"),y=i("dNgK"),v=i("Nm8O"),S=i("0IaG"),k=i("b6Qw"),w=i("XiUz"),C=i("kmnG"),I=i("qFsG"),x=i("YaQ2"),L=i("bTqV"),P=i("Qu3c"),A=i("NFeN");function R(e,t){1&e&&(f.Tb(0,"mat-icon"),f.Rc(1,"visibility"),f.Sb())}function F(e,t){1&e&&(f.Tb(0,"mat-icon"),f.Rc(1,"visibility_off"),f.Sb())}const T=function(){return["/forgot-password"]};function N(e,t){1&e&&(f.Tb(0,"a",16),f.Rc(1,"Forgot Password?"),f.Sb()),2&e&&f.mc("routerLink",f.qc(1,T))}function O(e,t){if(1&e){const e=f.Ub();f.Tb(0,"a",17),f.bc("click",(function(){return f.Ec(e),f.fc().goRegister(0)})),f.Rc(1,"New User Registration"),f.Sb()}}const M=[{path:"",component:(()=>{class e{constructor(e,t,i,s,r,o,a,n,c,l,u,h,d){this.router=e,this.fb=t,this.cd=i,this.snackbar=s,this.fv=r,this.authenticationService=o,this.jwtHelperService=a,this.menuItemService=n,this.masterService=c,this.dialog=l,this.loginReportService=u,this.cookieService=h,this.envService=d,this.menuItems=[],this.inputType="password",this.visible=!1,this.userAcceptanceFiles=[],this.userAcceptanceLog=[],this.loginButtonClicked=!1,this.parameterValue=!0,this.parameterValueForgotPassword=!0}ngOnInit(){this.unauthorizedSubcription=this.menuItemService.isUnauthorizedHandler.subscribe(e=>{this.loginButtonClicked=!1}),this.masterService.getParameterValue("Register").subscribe(e=>{e||(this.parameterValue=e)}),this.masterService.getParameterValue("ForgotPassword").subscribe(e=>{e||(this.parameterValueForgotPassword=e)}),this.getDefaultRoutePages(),this.form=this.fb.group({username:["",this.fv.requiredAlphanumericNoSpaces],password:["",this.fv.passwordValidators]}),this.defaults=new b.a({})}removeSessionStorageItems(){Object(m.d)(this.cookieService,this.envService)}send(){this.loginButtonClicked=!0,this.authenticationService.login({userName:this.form.value.username||"",password:this.form.value.password||""}).subscribe({next:e=>{e?"Failed"==e.status?(this.notificationMessage("Please confirm your email to continue login","red-snackbar"),this.loginButtonClicked=!1):e.token?(this.cookieService.set("access_token",e.token),localStorage.setItem("logged_in","true"),this.loginUserDetails(e.token),this.defaults.userId=this.cookieService.get("userId"),this.defaults.accountNumber=this.form.value.username,this.loginReportService.getIPAddress().subscribe(e=>{e&&(this.defaults.ipAddress=e.ip,this.captureWhoLoggedInDetails(this.defaults))},()=>{console.log("No response fron ipify"),this.loginButtonClicked=!1})):(this.notificationMessage("login failed due to no access token","red-snackbar"),this.loginButtonClicked=!1):(this.notificationMessage("login failed due to no access token","red-snackbar"),this.loginButtonClicked=!1)},error:()=>{this.notificationMessage("Invalid Username and Password","red-snackbar"),this.loginButtonClicked=!1}})}captureWhoLoggedInDetails(e){this.loginReportService.createLoginDetails(e).subscribe(e=>{e?(this.cookieService.set("userLoginId",e),this.loginButtonClicked=!1):(this.cookieService.set("userLoginId",""),this.loginButtonClicked=!1)})}notificationMessage(e,t){this.snackbar.open(e,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[t]})}showCredentials(e=0){this.userAcceptanceFiles=[],this.menuItemService.getUserAcceptanceFiles(e).subscribe({next:e=>{this.userAcceptanceFiles=e,this.userAcceptanceFiles&&this.userAcceptanceFiles.length&&this.userAcceptanceFiles.forEach(e=>{if(this.userAcceptanceLog&&this.userAcceptanceLog.length){const t=this.userAcceptanceLog.find(t=>t.userAcceptanceFileId===e.id);(!t||t&&!t.isAccepted)&&this.dialog.open(d.a,{autoFocus:!0,height:"610px",data:e}).afterClosed().subscribe()}else this.dialog.open(d.a,{autoFocus:!0,height:"610px",data:e}).afterClosed().subscribe()})},error:()=>{this.userAcceptanceFiles=[]}})}userFileAcceptance(e,t=0){this.userAcceptanceLog=[],this.menuItemService.getUserFileAcceptanceLog(e).subscribe({next:e=>{e&&e.length?(this.userAcceptanceLog=e,this.showCredentials(t)):(this.userAcceptanceLog=[],this.showCredentials(t))},error:()=>{this.userAcceptanceLog=[],this.showCredentials(t)}})}loginUserDetails(e){const t=this.jwtHelperService.decodeToken(e);if(t){const e=t["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"];if("External"===e){const i=t["http://schemas.xmlsoap.org/ws/2005/05/identity/claims/sid"];this.cookieService.set("userId",i),this.authenticationService.getExternalUserDetails(i).subscribe({next:t=>{if(t){let s=0;s="Owner"===t.entityType?this.envService.externalRoles.ownerExternal:this.envService.externalRoles.tenantExternal,this.setInitialSessionStorageForUser(t.userDetails,t.photo);let r=this.cookieService.get("globalClientId");if(this.getClientDataFormats(0==s?0:r),this.menuItemService.setIsExteranlUser(s),this.cookieService.set("ownerId",t.id.toString()),this.cookieService.set("external_role",s.toString()),!this.defaultPageRoutes||!this.defaultPageRoutes.length)return this.notificationMessage(`Default page is missing for ${e} role. Please contact administrator.`,"red-snackbar"),void(this.loginButtonClicked=!1);{const t=this.defaultPageRoutes.find(e=>e.roleId===s&&!1===e.isInternalUser);if(!t)return this.notificationMessage(`Default page is missing for ${e} role. Please contact administrator.`,"red-snackbar"),void(this.loginButtonClicked=!1);this.router.navigate([t.route]),this.userFileAcceptance(i,s),this.loginButtonClicked=!1}}},error:()=>{this.notificationMessage("Invalid user details","red-snackbar"),this.loginButtonClicked=!1}})}else{this.menuItemService.setIsAuthenticatedUser(!0);const i=t["http://schemas.xmlsoap.org/ws/2005/05/identity/claims/sid"];this.cookieService.set("userId",i),this.authenticationService.getUserDetailsById(i).subscribe({next:s=>{if(s){if(this.setInitialSessionStorageForUser(s,t["http://schemas.microsoft.com/ws/2008/06/identity/claims/userdata"]),!this.defaultPageRoutes||!this.defaultPageRoutes.length)return this.notificationMessage(`Default page is missing for ${e} role. Please contact administrator.`,"red-snackbar"),void(this.loginButtonClicked=!1);{const t=this.defaultPageRoutes.find(t=>t.role===e&&!0===t.isInternalUser);if(!t)return this.notificationMessage(`Default page is missing for ${e} role. Please contact administrator.`,"red-snackbar"),void(this.loginButtonClicked=!1);this.router.navigate([t.route]),this.userFileAcceptance(i),this.loginButtonClicked=!1}}},error:()=>{this.notificationMessage("Invalid user details","red-snackbar"),this.loginButtonClicked=!1}})}}}setInitialSessionStorageForUser(e,t){this.appUserFirstClientId=e.userClients.length>0?e.userClients[0].clientId:0,this.cookieService.set("access_profile",t),this.cookieService.set("globalClientId",this.appUserFirstClientId),localStorage.setItem("userClients",JSON.stringify(e.userClients))}getClientDataFormats(e){e?this.masterService.getClientDataFormats(parseInt(e)).subscribe(e=>{e&&localStorage.setItem("data_formats",JSON.stringify(e))}):this.masterService.getDefaultDataFormats().subscribe(e=>{e&&localStorage.setItem("data_formats",JSON.stringify(e))})}getDefaultRoutePages(){this.menuItemService.getDefaultRouterDetails().subscribe({next:e=>{this.defaultPageRoutes=e},error:()=>{this.defaultPageRoutes=[]}})}toggleVisibility(){this.visible?(this.inputType="password",this.visible=!1,this.cd.markForCheck()):(this.inputType="text",this.visible=!0,this.cd.markForCheck())}goRegister(e){const t=this.router.serializeUrl(this.router.createUrlTree(["/register"],{queryParams:{clientId:e}}));window.open(t,"_blank")}}return e.\u0275fac=function(t){return new(t||e)(f.Nb(a.f),f.Nb(r.f),f.Nb(f.h),f.Nb(y.b),f.Nb(c.a),f.Nb(l.a),f.Nb(v.a),f.Nb(u.a),f.Nb(h.a),f.Nb(S.b),f.Nb(g.a),f.Nb(k.a),f.Nb(p.a))},e.\u0275cmp=f.Hb({type:e,selectors:[["fury-login"]],decls:27,vars:10,consts:[["fxLayout","column","fxLayoutAlign","center center",1,"page"],[1,"card"],["fxLayout","column","fxLayoutAlign","center center",1,"header","padding"],["src","assets/img/smartBill.png","width","290px","height","90px"],["fxLayout","column","fxLayoutGap","16px",1,"padding",3,"formGroup"],["fxFlex","auto","fxLayout","column"],["fxFlex","grow"],["matInput","","required","","formControlName","username"],[3,"ctrl"],["matInput","","formControlName","password","required","",3,"type"],["type","button","mat-icon-button","","matSuffix","","matTooltip","Toggle Visibility",3,"click"],[4,"ngIf"],["fxLayout","row","fxLayoutAlign","space-between center"],["class","caption disable-anchor-link",3,"routerLink",4,"ngIf"],["class","caption disable-anchor-link",3,"routerLink","click",4,"ngIf"],["type","button","color","primary","mat-raised-button","",3,"disabled","click"],[1,"caption","disable-anchor-link",3,"routerLink"],[1,"caption","disable-anchor-link",3,"routerLink","click"]],template:function(e,t){1&e&&(f.Tb(0,"div",0),f.Tb(1,"div",1),f.Tb(2,"div",2),f.Tb(3,"div"),f.Ob(4,"img",3),f.Sb(),f.Sb(),f.Tb(5,"div",4),f.Tb(6,"div",5),f.Tb(7,"mat-form-field",6),f.Tb(8,"mat-label"),f.Rc(9,"Username"),f.Sb(),f.Ob(10,"input",7),f.Ob(11,"app-show-errors",8),f.Sb(),f.Tb(12,"mat-form-field",6),f.Tb(13,"mat-label"),f.Rc(14,"Password"),f.Sb(),f.Ob(15,"input",9),f.Tb(16,"button",10),f.bc("click",(function(){return t.toggleVisibility()})),f.Pc(17,R,2,0,"mat-icon",11),f.Pc(18,F,2,0,"mat-icon",11),f.Sb(),f.Tb(19,"mat-hint"),f.Rc(20,"Click the eye to toggle visibility"),f.Sb(),f.Ob(21,"app-show-errors",8),f.Sb(),f.Sb(),f.Tb(22,"div",12),f.Pc(23,N,2,2,"a",13),f.Pc(24,O,2,0,"a",14),f.Sb(),f.Tb(25,"button",15),f.bc("click",(function(){return t.send()})),f.Rc(26," SIGN IN "),f.Sb(),f.Sb(),f.Sb(),f.Sb()),2&e&&(f.Cb(1),f.mc("@fadeInUp",void 0),f.Cb(4),f.mc("formGroup",t.form),f.Cb(6),f.mc("ctrl",t.form.get("username")),f.Cb(4),f.mc("type",t.inputType),f.Cb(2),f.mc("ngIf",t.visible),f.Cb(1),f.mc("ngIf",!t.visible),f.Cb(3),f.mc("ctrl",t.form.get("password")),f.Cb(2),f.mc("ngIf",t.parameterValueForgotPassword),f.Cb(1),f.mc("ngIf",t.parameterValue),f.Cb(1),f.mc("disabled",t.loginButtonClicked))},directives:[w.d,w.c,w.e,r.r,r.k,w.b,C.d,C.h,I.b,r.c,r.x,r.q,r.i,x.a,L.a,C.j,P.a,s.o,C.g,A.a,a.i],styles:[".page[_ngcontent-%COMP%]{display:block;height:100%;width:100%;background-color:#fff;background-image:url(bg2.244996fb1d2175aa7b80.jpeg);background-position:50%;background-repeat:no-repeat;background-size:100% 100%}.card[_ngcontent-%COMP%]{width:380px;box-shadow:0 1px 3px rgba(0,0,0,.3),0 1px 3px rgba(0,0,0,.3);transition:all .3s cubic-bezier(.35,.8,.35,1)}@media screen and (max-width:599px){.card[_ngcontent-%COMP%]{width:300px}}.card[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{border-top-left-radius:8px;border-top-right-radius:8px}.center[_ngcontent-%COMP%]{display:block;margin-left:auto;margin-right:auto;width:50%}a[_ngcontent-%COMP%]:link{font-weight:700}a[_ngcontent-%COMP%]:hover{color:#1976d2}.disable-anchor-link[_ngcontent-%COMP%]{text-decoration:none}"],data:{animation:[n.a]}}),e})()}];let E=(()=>{class e{}return e.\u0275mod=f.Lb({type:e}),e.\u0275inj=f.Kb({factory:function(t){return new(t||e)},imports:[[a.j.forChild(M)],a.j]}),e})();var _=i("GiUZ");let U=(()=>{class e{}return e.\u0275mod=f.Lb({type:e}),e.\u0275inj=f.Kb({factory:function(t){return new(t||e)},imports:[[s.c,E,o.a,r.w,_.a]]}),e})()},YaQ2:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var s=i("fXoL"),r=i("ofXK");function o(e,t){if(1&e&&(s.Tb(0,"small"),s.Rc(1),s.Ob(2,"br"),s.Sb()),2&e){const e=t.$implicit;s.Cb(1),s.Tc(" ",e," ")}}function a(e,t){if(1&e&&(s.Tb(0,"div"),s.Pc(1,o,3,1,"small",1),s.Sb()),2&e){const e=s.fc();s.Cb(1),s.mc("ngForOf",e.listOfErrors())}}let n=(()=>{class e{constructor(){this.PATTERN_ERROR_MESSAGE={"/^[a-zA-Z ]*$/":"Accepts only alphabets with spaces","/^[a-zA-Z0-9]*$/":"Accepts only alphanumeric values with no spaces","/^[a-zA-Z0-9 ]*$/":"Accepts only alphanumeric values with spaces","/^[0-9]*$/":"Accepts only numbers","^[a-z0-9._%+-]+@[a-z0-9.-]+\\.[a-z]{3,4}$":"Enter valid email address of format test@mail.com"},this.ERROR_MESSAGE={required:()=>"This field is required",minlength:e=>`Min ${e.requiredLength} chars is required but got only ${e.actualLength}`,maxlength:e=>`Max chars allowed is ${e.requiredLength} but got ${e.actualLength}`,pattern:e=>""+this.PATTERN_ERROR_MESSAGE[e.requiredPattern],email:()=>"Enter valid email address of format test@mail.com"}}ngOnInit(){}shouldShowErrors(){return this.ctrl&&this.ctrl.errors&&this.ctrl.touched}listOfErrors(){return Object.keys(this.ctrl.errors).map(e=>this.ERROR_MESSAGE[e](this.ctrl.getError(e)))}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=s.Hb({type:e,selectors:[["app-show-errors"]],inputs:{ctrl:"ctrl"},decls:1,vars:1,consts:[[4,"ngIf"],[4,"ngFor","ngForOf"]],template:function(e,t){1&e&&s.Pc(0,a,2,1,"div",0),2&e&&s.mc("ngIf",t.shouldShowErrors())},directives:[r.o,r.n],styles:["small[_ngcontent-%COMP%]{color:red}"]}),e})()},seMb:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var s=i("3Pt+"),r=i("fXoL");let o=(()=>{class e{constructor(){this.emailPattern="^[a-z0-9._%+-]+@[a-z0-9.-]+\\.[a-z]{3,4}$",this.nameValidators=s.y.compose([s.y.required,s.y.minLength(1),s.y.maxLength(256)]),this.optionalNameValidators=s.y.compose([s.y.minLength(1),s.y.maxLength(256),s.y.pattern(/^[a-zA-Z ]*$/)]),this.emailValidators=s.y.compose([s.y.required,s.y.pattern(this.emailPattern)]),this.mobileNumberValidators=s.y.compose([s.y.required,s.y.pattern(/^[0-9]*$/)]),this.addressValidators=s.y.compose([s.y.required,s.y.minLength(1),s.y.maxLength(256),s.y.pattern(/^[a-zA-Z0-9 ]*$/)]),this.subjectValidator=s.y.compose([s.y.required,s.y.minLength(1),s.y.maxLength(1e3),s.y.pattern(/^[a-zA-Z0-9 ]*$/)]),this.optionsAddressValidators=s.y.compose([s.y.minLength(1),s.y.maxLength(256),s.y.pattern(/^[a-zA-Z0-9 ]*$/)]),this.postalCodeValidators=s.y.compose([s.y.pattern(/^[a-zA-Z0-9]*$/)]),this.requiredAlphanumericNoSpaces=s.y.compose([s.y.required,s.y.minLength(1),s.y.maxLength(256),s.y.pattern(/^[a-zA-Z0-9]*$/)]),this.passwordValidators=s.y.compose([s.y.required,s.y.minLength(8)])}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=r.Jb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()}}]);