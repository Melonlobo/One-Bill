!function(){function e(e){return function(e){if(Array.isArray(e))return n(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||i(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=i(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var l=0,a=function(){};return{s:a,n:function(){return l>=e.length?{done:!0}:{done:!1,value:e[l++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,r=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return r=e.done,e},e:function(e){s=!0,o=e},f:function(){try{r||null==n.return||n.return()}finally{if(s)throw o}}}}function i(e,t){if(e){if("string"==typeof e)return n(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?n(e,t):void 0}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,i){return t&&a(e.prototype,t),i&&a(e,i),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[52],{AJS6:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var n=i("tk/3"),a=i("sXtk"),r=i("fXoL"),s=function(){var e=function(){function e(t,i){l(this,e),this.httpClient=t,this.envService=i,this.baseUrl="",this.baseUrl=i.backend}return o(e,[{key:"getTemplateByTemplateTypeId",value:function(e,t,i){var l=new n.f;return(e||t)&&(l=(l=(l=l.append("templateTypeId",""+e)).append("clientId",""+t)).append("notificationType",""+i)),this.httpClient.get(this.baseUrl+"/notifications/templates/email/content",{params:l})}},{key:"CheckForTemplateType",value:function(e,t,i){var l=new n.f;return l=(l=(l=l.append("templateTypeId",""+e)).append("notificationType",""+t)).append("clientId",""+i),this.httpClient.get(this.baseUrl+"/notifications/templates/GetNotificationTemplateId",{params:l})}},{key:"updateTemplateById",value:function(e,t){return this.httpClient.put(this.baseUrl+"/notifications/templates/"+e,t)}},{key:"insertTemplate",value:function(e){return this.httpClient.post(this.baseUrl+"/notifications/templates",e)}},{key:"getTemplateTypes",value:function(){return this.httpClient.get(this.baseUrl+"/notifications/templates/GetTemplateTypes")}},{key:"getSmsTemplates",value:function(e){return this.httpClient.get(this.baseUrl+"/notifications/templates/sms/clientId/"+e)}},{key:"getEmailTemplates",value:function(e){return this.httpClient.get(this.baseUrl+"/notifications/templates/email/clientId/"+e)}},{key:"getNotificationTemplates",value:function(e){var t=new n.f;return t=t.append("notificationCategoryId",""+e),this.httpClient.get(this.baseUrl+"/notifications/templates/getNotificationTemplates",{params:t})}},{key:"getKeywords",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=new n.f;return t=t.append("id",""+e),this.httpClient.get(this.baseUrl+"/notifications/templates/Keywords",{params:t})}},{key:"getConditions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=new n.f;return t=t.append("id",""+e),this.httpClient.get(this.baseUrl+"/notifications/templates/conditions",{params:t})}},{key:"getNotificationModes",value:function(e){var t=new n.f;return t=t.append("clientId",""+e),this.httpClient.get(this.baseUrl+"/notifications/templates/notificationModes",{params:t})}},{key:"createAlertSettings",value:function(e,t){return this.httpClient.post(this.baseUrl+"/notifications/alert/settings/"+t,e)}},{key:"getAlertSettings",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",a=new n.f;return e&&(a=(a=(a=(a=a.append("clientId",""+e)).append("notificationCategorId",""+t)).append("templateTypeId",""+i)).append("notificationModes",""+l)),this.httpClient.get(this.baseUrl+"/notifications/alert/settings",{params:a})}},{key:"copyNotificationTemplates",value:function(e){return this.httpClient.post(this.baseUrl+"/notifications/templates/copy/contents",e)}},{key:"getNotificationLogs",value:function(e){var t=new n.f;return t=(t=(t=(t=(t=t.append("fromDate",""+e.fromDate)).append("toDate",""+e.toDate)).append("status",""+e.statusId)).append("mode",""+e.modeId)).append("clientId",""+e.clientId),this.httpClient.get(this.baseUrl+"/notifications/logs",{params:t})}},{key:"createSLDMaster",value:function(e){return this.httpClient.post(this.baseUrl+"/notifications/sld/master",e)}},{key:"updateSLDMaster",value:function(e){return this.httpClient.put(this.baseUrl+"/notifications/sld/master",e)}},{key:"getSLDMaster",value:function(e,t){var i=new n.f;return i=(i=i.append("masterId",""+e)).append("clientId",""+t),this.httpClient.get(this.baseUrl+"/notifications/sld/master",{params:i})}},{key:"getClientAlertSettings",value:function(e){var t=new n.f;return e&&(t=t.append("clientId",""+e)),this.httpClient.get(this.baseUrl+"/notifications/client/alert/settings",{params:t})}}]),e}();return e.\u0275fac=function(t){return new(t||e)(r.Xb(n.c),r.Xb(a.a))},e.\u0275prov=r.Jb({token:e,factory:e.\u0275fac,providedIn:"root"}),e}()},"RNk+":function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var n=i("sXtk"),a=i("fXoL"),r=i("tk/3"),s=function(){var e=function(){function e(t,i){l(this,e),this.http=t,this.envService=i,this.baseUrl="",this.baseUrl=i.backend}return o(e,[{key:"emailInvoiceTemplate",value:function(e){return this.http.post(this.baseUrl+"/template/invoice",e.billMasterDetails)}},{key:"emailReceiptTemplate",value:function(e){return this.http.post(this.baseUrl+"/template/receipt",e)}},{key:"emailCustomTemplate",value:function(e){return this.http.post(this.baseUrl+"/template/customized",e)}}]),e}();return e.\u0275fac=function(t){return new(t||e)(a.Xb(r.c),a.Xb(n.a))},e.\u0275prov=a.Jb({token:e,factory:e.\u0275fac,providedIn:"root"}),e}()},Vvus:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var n=i("tk/3"),a=i("sXtk"),r=i("fXoL"),s=function(){var e=function(){function e(t,i){l(this,e),this.http=t,this.envService=i,this.baseUrl="",this.baseUrl=i.backend}return o(e,[{key:"getOwners",value:function(){return this.http.get(this.baseUrl+"/owners")}},{key:"getclientOwners",value:function(e){return this.http.get(this.baseUrl+"/owners/GetAllClientOwners/"+e)}},{key:"getNewlyRegisteredUsers",value:function(e){return this.http.get(this.baseUrl+"/owners/newlyRegisteredOwners/"+e)}},{key:"getUnits",value:function(e){return this.http.get(this.baseUrl+"/owners/"+e+"/GetUnits")}},{key:"createOwner",value:function(e){return this.http.post(this.baseUrl+"/owners",e)}},{key:"updateOwnerById",value:function(e,t){return this.http.put(this.baseUrl+"/owners/"+e,t)}},{key:"deleteOwnerById",value:function(e){return this.http.delete(this.baseUrl+"/owners/"+e)}},{key:"uploadLogo",value:function(e){var t=new FormData;t.append("file",e);var i={headers:new n.e({"Content-Type":"application/json"}),body:t};return this.http.post(this.baseUrl+"/upload",i)}},{key:"getMovedOutTenants",value:function(e){return this.http.get(this.baseUrl+"/owners/movedOutTenants/clientId/"+e)}},{key:"registerOwner",value:function(e){return this.http.post(this.baseUrl+"/owners/register",e)}},{key:"getUserDeatils",value:function(e){var t=new n.f;return e&&(t=t.append("userId",e)),this.http.get(this.baseUrl+"/owners/user/details",{params:t})}},{key:"checkTRNDuplication",value:function(e,t,i){var l=new n.f;return l=(l=(l=l.append("queryType",e)).append("tRNNumber",t)).append("id",i),this.http.get(this.baseUrl+"/owners/TRNNumber",{params:l})}}]),e}();return e.\u0275fac=function(t){return new(t||e)(r.Xb(n.c),r.Xb(a.a))},e.\u0275prov=r.Jb({token:e,factory:e.\u0275fac,providedIn:"root"}),e}()},xPwF:function(i,n,a){"use strict";a.r(n),a.d(n,"BillsModule",(function(){return Wa}));var r,s=a("3Pt+"),c=a("9xt4"),u=a("y/v/"),d=a("ofXK"),m=a("tyNb"),h=a("mrSG"),b=a("lW2b"),f=a("Ku73"),p=a("nStZ"),g=a("fXoL"),v=a("0IaG"),y=a("KHMF"),C=a("sXtk"),S=a("4FRi"),T=a("+WJP"),P=((r=function(){function e(t,i,n,a){var o,r,s;l(this,e),this.data=t,this.dialogRef=i,this.currencyPipe=n,this.envService=a,this.accountHeadData=[],this.columns=[],this.identifierColumnName="#",this.accountHeadColumnName="Account Head",this.amountColumnName="Amount",this.discountAmountColumnName="Discount Amount",this.format="",this.currency="",this.roundFormat="",this.format=null!==(o=Object(y.e)("DateFormat"))&&void 0!==o?o:a.dateFormat,this.currency=null!==(r=Object(y.e)("Currency"))&&void 0!==r?r:a.currencyFormat,this.roundFormat=null!==(s=Object(y.e)("RoundOff"))&&void 0!==s?s:a.roundOffFormat}return o(e,[{key:"ngOnInit",value:function(){this.createGridColumns(),this.onGetAccountHeads(this.data)}},{key:"createGridColumns",value:function(){this.columns=[{name:this.identifierColumnName,property:"rowNumber",visible:!0,isModelProperty:!0},{name:this.accountHeadColumnName,property:"accountHeadName",visible:!0,isModelProperty:!0},{name:this.amountColumnName,property:"fixedAmountLocal",visible:!0,isModelProperty:!0,columnAlign:{"text-align":"right"}},{name:this.discountAmountColumnName,property:"discountAmountLocal",visible:!0,isModelProperty:!0,columnAlign:{"text-align":"right"}}]}},{key:"onGetAccountHeads",value:function(e){var t=this;if(this.accountHeadData=[],e&&(e.bills&&e.bills.length&&e.bills.forEach((function(e){e.billTransactions&&e.billTransactions.length&&e.billTransactions.forEach((function(e){var i=null;if(t.accountHeadData&&t.accountHeadData.length&&(i=t.accountHeadData.find((function(t){return t.accountHeadName.trim().toLowerCase()===e.headDisplay.trim().toLowerCase()}))),i)i.fixedAmount+=e.headAmount,i.fixedAmountLocal=t.currencyPipe.transform(i.fixedAmount,t.currency.toString(),!0,t.roundFormat);else{var n={rowNumber:t.accountHeadData.length+1,accountHeadName:e.headDisplay,billHeadId:e.billHeadId,fixedAmount:e.headAmount,position:e.position,fixedAmountLocal:t.currencyPipe.transform(e.headAmount,t.currency.toString(),!0,t.roundFormat)};t.accountHeadData.push(n)}}))})),e.billCharges&&e.billCharges.length&&e.billCharges.forEach((function(e){var i=null;if(t.accountHeadData&&t.accountHeadData.length&&(i=t.accountHeadData.find((function(t){return t.accountHeadName.trim().toLowerCase()===e.headDisplay.trim().toLowerCase()}))),i)i.fixedAmount+=e.headAmount,i.fixedAmountLocal=t.currencyPipe.transform(i.fixedAmount,t.currency.toString(),!0,t.roundFormat);else{var n={rowNumber:t.accountHeadData.length+1,accountHeadName:e.headDisplay,fixedAmount:e.headAmount,billHeadId:e.billHeadId,position:e.position,fixedAmountLocal:t.currencyPipe.transform(e.headAmount,t.currency.toString(),!0,t.roundFormat)};t.accountHeadData.push(n)}})),e.billTaxDetails&&e.billTaxDetails.length&&e.billTaxDetails.forEach((function(e){var i,n,l=null,a=0;if(t.accountHeadData&&t.accountHeadData.length&&(a=null!==(n=null===(i=t.accountHeadData.sort((function(e,t){return e.position-t.position}))[t.accountHeadData.length-1])||void 0===i?void 0:i.position)&&void 0!==n?n:0),t.accountHeadData&&t.accountHeadData.length&&(l=t.accountHeadData.find((function(t){return t.accountHeadName.trim().toLowerCase()===e.taxDisplayName.trim().toLowerCase()}))),l)l.fixedAmount+=e.taxAmount,l.fixedAmountLocal=t.currencyPipe.transform(l.fixedAmount,t.currency.toString(),!0,t.roundFormat);else{var o={rowNumber:t.accountHeadData.length+1,accountHeadName:e.taxDisplayName,fixedAmount:e.taxAmount,position:a+1,fixedAmountLocal:t.currencyPipe.transform(e.taxAmount,t.currency.toString(),!0,t.roundFormat)};t.accountHeadData.push(o)}})),e.billDiscounts&&e.billDiscounts.length&&e.billDiscounts.forEach((function(e){var i,n=null;t.accountHeadData&&t.accountHeadData.length&&(n=t.accountHeadData.find((function(t){return t.billHeadId===e.billHeadId}))),n&&(n.discountAmount=(null!==(i=null==n?void 0:n.discountAmount)&&void 0!==i?i:0)+e.headAmount,n.discountAmountLocal=t.currencyPipe.transform(n.discountAmount,t.currency.toString(),!0,t.roundFormat))})),this.accountHeadData&&this.accountHeadData.length)){this.accountHeadData=this.accountHeadData.sort((function(e,t){return e.position-t.position}));for(var i=0;i<this.accountHeadData.length;++i)this.accountHeadData[i].rowNumber=i+1}}}]),e}()).\u0275fac=function(e){return new(e||r)(g.Nb(v.a),g.Nb(v.h),g.Nb(d.d),g.Nb(C.a))},r.\u0275cmp=g.Hb({type:r,selectors:[["app-account-head-details"]],decls:6,vars:2,consts:[[1,"person"],[3,"tableData","columns"]],template:function(e,t){1&e&&(g.Tb(0,"fury-card-header"),g.Tb(1,"fury-card-header-heading"),g.Rc(2,"Account Heads"),g.Sb(),g.Sb(),g.Tb(3,"mat-dialog-content"),g.Tb(4,"div",0),g.Ob(5,"app-table-structure",1),g.Sb(),g.Sb()),2&e&&(g.Cb(5),g.mc("tableData",t.accountHeadData)("columns",t.columns))},directives:[S.d,S.g,v.f,T.a],styles:[""]}),r),D=a("Nm8O"),w=a("b6Qw"),N=a("XiUz"),x=a("uxLP"),k=a("bTqV"),A=a("Qu3c"),F=a("NFeN");function R(e,t){if(1&e){var i=g.Ub();g.Tb(0,"div",6),g.Tb(1,"button",7),g.bc("click",(function(){return g.Ec(i),g.fc().onSave()})),g.Tb(2,"mat-icon"),g.Rc(3,"launch"),g.Sb(),g.Sb(),g.Sb()}}function I(e,t){if(1&e&&(g.Tb(0,"div",8),g.Tb(1,"ul"),g.Tb(2,"li"),g.Tb(3,"div",9),g.Tb(4,"label"),g.Rc(5,"Succeed"),g.Sb(),g.Ob(6,"div",10),g.Tb(7,"label"),g.Rc(8),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Tb(9,"ul"),g.Tb(10,"li"),g.Tb(11,"div",9),g.Tb(12,"label"),g.Rc(13,"Failed"),g.Sb(),g.Ob(14,"div",11),g.Tb(15,"label"),g.Rc(16),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb()),2&e){var i=g.fc();g.Cb(8),g.Sc(i.succeedCount),g.Cb(8),g.Sc(i.failedCount)}}var O,W=((O=function(){function e(t,i,n,a,o,r,s){var c,u,d,m;l(this,e),this.date=t,this.currencyPipe=i,this.dialog=n,this.jwtHelperService=a,this.cookieService=o,this.decimalPipe=r,this.envService=s,this.columns=[],this.innerColumns=[],this.columnNames=[],this.unBilledConsumptions=[],this.selectedRows=[],this.innerTableName="bills",this.banks=[],this.paymentModes=[],this.isHide=!0,this.hideHeader=!0,this.format="",this.currency="",this.roundFormat="",this.consumptionRoundOffFormat="",this.saveClicked=new g.o,this.printDataRows=new g.o,this.role="",this.succeedCount="",this.failedCount="",this.cssStyledColumn="status",this.billNumberCoulmnName="Bill Number",this.accountNumberColumnName="Account Number",this.billDateCoulmnName="BillDate",this.tenantNameColumnName="Tenant Name",this.unitColumnName="Unit",this.fromDateColumnName="From Date",this.toDateColumnName="To Date",this.dueDateColumnName="Due Date",this.billAmountColumnName="Bill Amount",this.utilityTypeCoulmnNmae="Utility Type",this.meterNumberCoulmnNmae="Meter Number",this.previousReadingColumnName="Previous",this.presentReadingColumnName="Present",this.currentConsumptionColumnName="Cur-Consumption",this.consumptionChargeColumnName="Consumption Charge",this.format=null!==(c=Object(y.e)("DateFormat"))&&void 0!==c?c:s.dateFormat,this.currency=null!==(u=Object(y.e)("Currency"))&&void 0!==u?u:s.currencyFormat,this.roundFormat=null!==(d=Object(y.e)("RoundOff"))&&void 0!==d?d:s.roundOffFormat,this.consumptionRoundOffFormat=null!==(m=Object(y.e)("ConsumptionRoundOff"))&&void 0!==m?m:s.consumptionRoundOffFormat}return o(e,[{key:"ngOnInit",value:function(){var e=this.cookieService.get("access_token"),t=this.jwtHelperService.decodeToken(e);t&&(this.role=t["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"]),this.createColumnNames(),this.createGridColumns(),this.createInnerGridColumns(),this.isHide&&this.updateTableColumns()}},{key:"createGridColumns",value:function(){this.columns=["select","accountNumber","ownerName","unitNumber","fromDateLocal","toDateLocal","dueDateLocal","billAmountLocal","button","print"]}},{key:"createInnerGridColumns",value:function(){this.innerColumns=["utilityType","deviceName","previousReadingLocal","presentReadingLocal","consumptionLocal","consumptionCharge"]}},{key:"createColumnNames",value:function(){this.columnNames=[{name:this.billNumberCoulmnName,property:"billNumber"},{name:this.accountNumberColumnName,property:"accountNumber"},{name:this.billDateCoulmnName,property:"billDate"},{name:this.tenantNameColumnName,property:"ownerName"},{name:this.unitColumnName,property:"unitNumber"},{name:this.fromDateColumnName,property:"fromDateLocal"},{name:this.toDateColumnName,property:"toDateLocal"},{name:this.dueDateColumnName,property:"dueDateLocal"},{name:this.billAmountColumnName,property:"billAmountLocal",columnAlign:{"text-align":"right"}},{name:this.utilityTypeCoulmnNmae,property:"utilityType"},{name:this.meterNumberCoulmnNmae,property:"deviceName"},{name:this.previousReadingColumnName,property:"previousReadingLocal"},{name:this.presentReadingColumnName,property:"presentReadingLocal"},{name:this.currentConsumptionColumnName,property:"consumptionLocal"},{name:this.consumptionChargeColumnName,property:"consumptionCharge",columnAlign:{"text-align":"right"}}]}},{key:"updateTableColumns",value:function(){this.columns.splice(0,1)}},{key:"onSave",value:function(){this.saveClicked.emit(!0)}},{key:"onSelectedRows",value:function(e){this.selectedRows=[],this.selectedRows=e}},{key:"onViewDataRow",value:function(e){this.dialog.open(P,{data:e}).afterClosed().subscribe()}},{key:"onPrintRows",value:function(e){this.printDataRows.emit(e)}},{key:"updateDataFormats",value:function(e){var t=this;return e&&(this.format=Object(y.e)("DateFormat"),this.roundFormat=Object(y.e)("RoundOff"),this.currency=Object(y.e)("Currency"),e.forEach((function(e){e.fromDateLocal=t.date.transform(e.fromDate.toString(),t.format.toString()),e.toDateLocal=t.date.transform(e.toDate.toString(),t.format.toString()),e.dueDateLocal=t.date.transform(e.dueDate.toString(),t.format.toString()),e.billAmountLocal=t.currencyPipe.transform(e.billAmount,t.currency.toString(),!0,t.roundFormat),e.bills.forEach((function(e){var i;t.consumptionRoundOffFormat=null!==(i=Object(y.e)("ConsumptionRoundOff",e.utilityTypeId))&&void 0!==i?i:t.envService.consumptionRoundOffFormat,e.previousReadingLocal=t.decimalPipe.transform(e.previousReading,t.consumptionRoundOffFormat),e.presentReadingLocal=t.decimalPipe.transform(e.presentReading,t.consumptionRoundOffFormat),e.consumptionLocal=t.decimalPipe.transform(e.consumption,t.consumptionRoundOffFormat),e.billAmountLocal=e.consumptionCharge=t.currencyPipe.transform(e.billAmount,t.currency.toString(),!0,t.roundFormat)}))}))),e}},{key:"dataSource",set:function(e){var t,i;if(e&&e.unbBilledConsumptions){this.unBilledConsumptions=this.updateDataFormats(e.unbBilledConsumptions);var n=null!==(t=this.unBilledConsumptions.filter((function(e){return"Succeed"===e.status})).length)&&void 0!==t?t:0,l=null!==(i=this.unBilledConsumptions.filter((function(e){return"Failed"===e.status})).length)&&void 0!==i?i:0;n>0||l>0?(this.succeedCount=" - "+n.toString(),this.failedCount=" - "+l.toString()):(this.succeedCount="",this.failedCount="")}}}]),e}()).\u0275fac=function(e){return new(e||O)(g.Nb(d.f),g.Nb(d.d),g.Nb(v.b),g.Nb(D.a),g.Nb(w.a),g.Nb(d.g),g.Nb(C.a))},O.\u0275cmp=g.Hb({type:O,selectors:[["app-unbilled-consumption"]],inputs:{banks:"banks",paymentModes:"paymentModes",isHide:"isHide",hideHeader:"hideHeader",dataSource:"dataSource"},outputs:{saveClicked:"saveClicked",printDataRows:"printDataRows"},decls:7,vars:10,consts:[[1,"person"],["fxLayout","column","fxLayout","row","fxLayoutGap.gt-sm","24px"],[1,"mat-table"],[3,"tableData","columnsToDisplay","innerDisplayedColumns","columnNames","innerTableName","hideHeader","cssStyledColumn","role","selectedRows","viewDataRow","printDataRow"],["class","fury-flex-form-field",4,"ngIf"],["class","result","fxLayout.gt-sm","row","fxLayout","column","fxLayoutAlign","end end","fxLayoutGap.gt-sm","12px",4,"ngIf"],[1,"fury-flex-form-field"],["matTooltip","Generate & Save Bill","mat-icon-button","","aria-label","Example icon-button with menu icon",1,"example-icon",3,"click"],["fxLayout.gt-sm","row","fxLayout","column","fxLayoutAlign","end end","fxLayoutGap.gt-sm","12px",1,"result"],[1,"label-color"],[1,"color-box",2,"background-color","rgb(152, 197, 171)"],[1,"color-box",2,"background-color","rgb(206, 120, 152)"]],template:function(e,t){1&e&&(g.Tb(0,"mat-dialog-content"),g.Tb(1,"div",0),g.Tb(2,"div",1),g.Tb(3,"div",2),g.Tb(4,"fury-expandable-table-structure",3),g.bc("selectedRows",(function(e){return t.onSelectedRows(e)}))("viewDataRow",(function(e){return t.onViewDataRow(e)}))("printDataRow",(function(e){return t.onPrintRows(e)})),g.Sb(),g.Sb(),g.Pc(5,R,4,0,"div",4),g.Sb(),g.Pc(6,I,17,2,"div",5),g.Sb(),g.Sb()),2&e&&(g.Cb(4),g.mc("tableData",t.unBilledConsumptions)("columnsToDisplay",t.columns)("innerDisplayedColumns",t.innerColumns)("columnNames",t.columnNames)("innerTableName",t.innerTableName)("hideHeader",t.hideHeader)("cssStyledColumn",t.cssStyledColumn)("role",t.role),g.Cb(1),g.mc("ngIf",t.isHide),g.Cb(1),g.mc("ngIf","External"!=t.role))},directives:[v.f,N.d,N.e,x.a,d.o,k.a,A.a,F.a,N.c],styles:[".form-control[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .form-control[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-control[_ngcontent-%COMP%]   label[_ngcontent-%COMP%], .form-control[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{display:block;display:inline}ul[_ngcontent-%COMP%]{margin:20px}.label-color[_ngcontent-%COMP%]{position:relative}.label-color[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{padding-left:20px}.label-color[_ngcontent-%COMP%]   .color-box[_ngcontent-%COMP%]{width:10px;height:10px;display:inline-block;background-color:#ccc;position:absolute;left:5px;top:5px}.mat-table[_ngcontent-%COMP%]{width:100%;overflow-x:scroll}"]}),O),M=a("7d4Y"),L=a("wd/R"),B=a("dNgK"),z=a("kmnG"),U=a("d3UM"),E=a("qFsG"),j=a("f0Cb"),H=a("FKr1"),Y=a("iadO"),V=["allTenantsSelected"],_=["tenantSelect"];function G(e,t){if(1&e&&(g.Tb(0,"mat-option",19),g.Rc(1),g.Sb()),2&e){var i=t.$implicit;g.mc("value",i.value),g.Cb(1),g.Tc("",i.label," ")}}function X(e,t){if(1&e){var i=g.Ub();g.Tb(0,"mat-option",9),g.bc("click",(function(){g.Ec(i);var e=g.fc(),t=g.Ac(18);return e.toggleTenantsPerOne(t.viewValue)})),g.Rc(1),g.Sb()}if(2&e){var n=t.$implicit;g.mc("value",n.id),g.Cb(1),g.Tc(" ",n.ownerName," ")}}function q(e,t){if(1&e){var i=g.Ub();g.Tb(0,"mat-form-field",20),g.Tb(1,"mat-label"),g.Rc(2,"From Date"),g.Sb(),g.Tb(3,"input",21),g.bc("click",(function(){return g.Ec(i),g.Ac(6).open()}))("ngModelChange",(function(e){return g.Ec(i),g.fc().fromDate=e}))("focus",(function(){return g.Ec(i),g.Ac(6).open()})),g.Sb(),g.Ob(4,"mat-datepicker-toggle",14),g.Ob(5,"mat-datepicker",22,23),g.Sb()}if(2&e){var n=g.Ac(6),l=g.fc();g.Cb(3),g.mc("ngModel",l.fromDate)("matDatepicker",n),g.Cb(1),g.mc("for",n)}}function $(e,t){if(1&e){var i=g.Ub();g.Tb(0,"mat-form-field",20),g.Tb(1,"mat-label"),g.Rc(2,"To Date"),g.Sb(),g.Tb(3,"input",24),g.bc("click",(function(){return g.Ec(i),g.Ac(6).open()}))("ngModelChange",(function(e){return g.Ec(i),g.fc().toDate=e}))("focus",(function(){return g.Ec(i),g.Ac(6).open()})),g.Sb(),g.Ob(4,"mat-datepicker-toggle",14),g.Ob(5,"mat-datepicker",22,25),g.Sb()}if(2&e){var n=g.Ac(6),l=g.fc();g.Cb(3),g.mc("ngModel",l.toDate)("matDatepicker",n),g.Cb(1),g.mc("for",n)}}var J,Q,K=((J=function(){function e(t,i){l(this,e),this.snackbar=t,this.cookieService=i,this.utilityTypeId=0,this.billPeriodId=0,this.fromDate=Date.UTC.toString(),this.toDate=Date.UTC.toString(),this.billDate="",this.isHide=!0,this.selectedTenants=[],this.maxDate=new Date,this.manageParams={},this.utilityTypes=[],this.billPeriods=[],this.filteredTenants=[],this.data=[],this.filterClicked=new g.o,this.saveClicked=new g.o}return o(e,[{key:"ngOnInit",value:function(){this.clientId=parseInt(this.cookieService.get("globalClientId"))}},{key:"onChangeUtilityType",value:function(e){this.utilityTypeId=e}},{key:"onChangeBillPeriod",value:function(e){var t=this;if(this.isHide=!0,this.billPeriodId=e,this.billPeriodId){var i=this.billPeriods.find((function(e){return e.value===t.billPeriodId}));i&&(this.isHide=!1,this.fromDate=""===i.fromDate?"":L(i.fromDate).format("YYYY-MM-DD"),this.toDate=""===i.toDate?"":L(i.toDate).format("YYYY-MM-DD"))}}},{key:"onGenerate",value:function(){0!==this.utilityTypeId||0!==this.billPeriodId?(this.manageParams={utilityTypeId:""+this.utilityTypeId,billPeriodId:""+this.billPeriodId,clientId:this.clientId,processDate:this.billDate?""+L(this.billDate).format("YYYY-MM-DD"):null},this.selectedTenants&&this.selectedTenants.length&&(this.manageParams.tenantIds=this.selectedTenants.filter((function(e){return 0!=e}))),this.filterClicked.emit(this.manageParams)):this.snackbar.open("Invalid search parameters",null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:["yellow-snackbar"]})}},{key:"toggleTenantsAllSelection",value:function(){this.selectedTenants=[],this.allTenantsSelected.selected?(this.selectedTenants=this.filteredTenants.map((function(e){return e.id})),this.select.options.forEach((function(e){return e.select()}))):(this.select.options.forEach((function(e){return e.deselect()})),this.selectedTenants=[])}},{key:"toggleTenantsPerOne",value:function(){if(this.allTenantsSelected.selected)return this.allTenantsSelected.deselect(),!1;this.data.length<=this.selectedTenants.length&&this.allTenantsSelected.select()}},{key:"searchTenants",value:function(e){var t=this.selectTenants(e.toLowerCase());this.filteredTenants=t}},{key:"selectTenants",value:function(e){var i=[];if(e){var n,l=t(this.data);try{for(l.s();!(n=l.n()).done;){var a=n.value;a.ownerName.toLowerCase().indexOf(e)>-1&&i.push(a)}}catch(o){l.e(o)}finally{l.f()}}else i=this.filteredTenants=this.data;return i}},{key:"handleInput",value:function(e){e.stopPropagation()}},{key:"tenants",get:function(){return this.data},set:function(e){this.filteredTenants=this.data=e}}]),e}()).\u0275fac=function(e){return new(e||J)(g.Nb(B.b),g.Nb(w.a))},J.\u0275cmp=g.Hb({type:J,selectors:[["app-create-bill-toolbar"]],viewQuery:function(e,t){var i;1&e&&(g.Vc(V,!0),g.Vc(_,!0)),2&e&&(g.zc(i=g.cc())&&(t.allTenantsSelected=i.first),g.zc(i=g.cc())&&(t.select=i.first))},inputs:{utilityTypes:"utilityTypes",billPeriods:"billPeriods",tenants:"tenants"},outputs:{filterClicked:"filterClicked",saveClicked:"saveClicked"},decls:34,vars:11,consts:[[1,"person"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","6px"],["color","primary",1,"result"],["id","BillPeriod","name","BillPeriod",3,"value","selectionChange","valueChange"],[3,"value",4,"ngFor","ngForOf"],["multiple","","placeholder","Select a tenant","id","tenant","name","tenant",1,"multiSelectCustom",3,"ngModel","ngModelChange"],["tenantSelect",""],["matInput","","focused","'true'","type","text","autocomplete","off","placeholder","search",1,"myInput",3,"keydown","keyup"],["myInput",""],[3,"value","click"],["allTenantsSelected",""],[3,"value","click",4,"ngFor","ngForOf"],["color","primary",1,"result",2,"width","180px"],["id","BillDate","name","BillDate","matInput","",3,"ngModel","matDatepicker","max","click","ngModelChange","focus"],["matSuffix","",3,"for"],["formDatepickerRef3",""],[1,"fury-flex-form-field"],["matTooltip","Generate Bills","color","primary","mat-icon-button","",3,"click"],["class","result","color","primary","style","width: 150px;",4,"ngIf"],[3,"value"],["color","primary",1,"result",2,"width","150px"],["id","FromDate","name","FromDate","matInput","","readonly","",3,"ngModel","matDatepicker","click","ngModelChange","focus"],["disabled","true"],["formDatepickerRef1",""],["id","ToDate","name","ToDate","matInput","","readonly","",3,"ngModel","matDatepicker","click","ngModelChange","focus"],["formDatepickerRef2",""]],template:function(e,t){if(1&e){var i=g.Ub();g.Tb(0,"mat-dialog-content"),g.Tb(1,"div",0),g.Tb(2,"form"),g.Tb(3,"div",1),g.Tb(4,"mat-form-field",2),g.Tb(5,"mat-label"),g.Rc(6,"Bill Period"),g.Sb(),g.Tb(7,"mat-select",3),g.bc("selectionChange",(function(e){return t.onChangeBillPeriod(e.value)}))("valueChange",(function(e){return t.billPeriodId=e})),g.Pc(8,G,2,2,"mat-option",4),g.Sb(),g.Sb(),g.Tb(9,"mat-form-field",2),g.Tb(10,"mat-label"),g.Rc(11,"Tenant Name"),g.Sb(),g.Tb(12,"mat-select",5,6),g.bc("ngModelChange",(function(e){return t.selectedTenants=e})),g.Tb(14,"input",7,8),g.bc("keydown",(function(e){return t.handleInput(e)}))("keyup",(function(e){return t.searchTenants(e.target.value)})),g.Sb(),g.Ob(16,"mat-divider"),g.Tb(17,"mat-option",9,10),g.bc("click",(function(){return t.toggleTenantsAllSelection()})),g.Rc(19,"Select All"),g.Sb(),g.Pc(20,X,2,2,"mat-option",11),g.Sb(),g.Sb(),g.Tb(21,"mat-form-field",12),g.Tb(22,"mat-label"),g.Rc(23,"Bill Date"),g.Sb(),g.Tb(24,"input",13),g.bc("click",(function(){return g.Ec(i),g.Ac(27).open()}))("ngModelChange",(function(e){return t.billDate=e}))("focus",(function(){return g.Ec(i),g.Ac(27).open()})),g.Sb(),g.Ob(25,"mat-datepicker-toggle",14),g.Ob(26,"mat-datepicker",null,15),g.Sb(),g.Tb(28,"div",16),g.Tb(29,"button",17),g.bc("click",(function(){return t.onGenerate()})),g.Tb(30,"mat-icon"),g.Rc(31,"launch"),g.Sb(),g.Sb(),g.Sb(),g.Pc(32,q,7,3,"mat-form-field",18),g.Pc(33,$,7,3,"mat-form-field",18),g.Sb(),g.Sb(),g.Sb(),g.Sb()}if(2&e){var n=g.Ac(27);g.Cb(7),g.mc("value",t.billPeriodId),g.Cb(1),g.mc("ngForOf",t.billPeriods),g.Cb(4),g.mc("ngModel",t.selectedTenants),g.Cb(5),g.mc("value",0),g.Cb(3),g.mc("ngForOf",t.filteredTenants),g.Cb(4),g.mc("ngModel",t.billDate)("matDatepicker",n)("max",t.maxDate),g.Cb(1),g.mc("for",n),g.Cb(7),g.mc("ngIf",!t.isHide),g.Cb(1),g.mc("ngIf",!t.isHide)}},directives:[v.f,s.z,s.r,s.s,N.d,N.e,z.d,z.h,U.a,d.n,s.q,s.t,E.b,j.a,H.n,s.c,Y.b,Y.d,z.j,Y.a,k.a,A.a,F.a,d.o],styles:[".myInput[_ngcontent-%COMP%]{height:50px!important;padding:10px!important}"]}),J),Z=a("a8hA"),ee=a("4Zil"),te=a("xBcV"),ie=a("rvYj"),ne=a("/t3+"),le=((Q=function(){function e(){l(this,e)}return o(e,[{key:"ngOnInit",value:function(){}},{key:"onExport",value:function(){}},{key:"onPrint",value:function(){}}]),e}()).\u0275fac=function(e){return new(e||Q)},Q.\u0275cmp=g.Hb({type:Q,selectors:[["app-create-bill-footer-toolbar"]],decls:4,vars:0,consts:[[1,"person"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutAlign","end end","fxLayoutGap.gt-sm","24px"]],template:function(e,t){1&e&&(g.Tb(0,"mat-dialog-content"),g.Tb(1,"div",0),g.Tb(2,"form"),g.Ob(3,"div",1),g.Sb(),g.Sb(),g.Sb())},directives:[v.f,s.z,s.r,s.s,N.d,N.c,N.e],styles:[""]}),Q),ae=a("Xa2L");function oe(e,t){1&e&&(g.Tb(0,"div",13),g.Ob(1,"mat-progress-spinner",14),g.Sb())}var re,se=((re=function(){function e(t,i,n,a,o){l(this,e),this.billService=t,this.billSettlementService=i,this.snackbar=n,this.clientSelectionService=a,this.cookieService=o,this._gap=16,this.gap=this._gap+"px",this.col2="1 1 calc(50% - ".concat(this._gap/2,"px)"),this.col3="1 1 calc(33.3333% - ".concat(this._gap/1.5,"px)"),this.utilityTypes=[{label:"Select",value:0}],this.billPeriods=[{label:"Select",value:0}],this.tenants=[],this.showSpinner=!1,this.billSettlement={unbBilledConsumptions:[]}}return o(e,[{key:"ngOnInit",value:function(){this.clientSelectionService.setIsClientVisible(!0),this.clientId=parseInt(this.cookieService.get("globalClientId")),this.getTenants(),this.getUtilityTypes(),this.getBillPeriods()}},{key:"getTenants",value:function(){var e=this;this.tenants=[],this.billSettlementService.getTenantsDetails(this.clientId).subscribe((function(t){e.tenants=t}))}},{key:"onSaveBills",value:function(e){var t,i=this;this.showSpinner=!0,null!=(t=this.unbilledConsumptionComponent.selectedRows)&&t.length?this.billSettlementService.saveUnBilledConsumptions(t).subscribe({next:function(e){e?(i.showSpinner=!1,i.notificationMessage("Bill saved successfully","green-snackbar"),i.reset(!1,t)):(i.showSpinner=!1,i.notificationMessage("Bill save failed","red-snackbar"))},error:function(e){i.showSpinner=!1}}):(this.showSpinner=!1,this.notificationMessage("Please select bills","red-snackbar"))}},{key:"reset",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=this.unbilledConsumptionComponent.unBilledConsumptions;!e&&i&&i.length?(t.forEach((function(e){i=i.filter((function(t){return t.unitId!=e.unitId}))})),this.unbilledConsumptionComponent.unBilledConsumptions=i):(e||i&&t&&i.length==t.length)&&(this.unbilledConsumptionComponent.unBilledConsumptions=[],this.createBillToolbarComponent.billPeriodId=0,this.createBillToolbarComponent.utilityTypeId=0,this.unbilledConsumptionComponent.failedCount="",this.unbilledConsumptionComponent.succeedCount="",this.createBillToolbarComponent.isHide=!0)}},{key:"getUtilityTypes",value:function(){var e=this;this.utilityTypes=[{label:"Select",value:0}],this.billService.getUtilityTypes().subscribe((function(t){t.forEach((function(t){e.utilityTypes.push({label:t.description,value:t.id})}))}))}},{key:"getBillPeriods",value:function(){var e=this;this.billPeriods=[{label:"Select",value:0,fromDate:Date.now.toString(),ToDate:Date.now.toString()}],this.billService.getBillPeriods(this.clientId).subscribe((function(t){t.forEach((function(t){e.billPeriods.push({label:t.periodDescription,value:t.id,fromDate:t.periodStart,toDate:t.periodEnd})}))}))}},{key:"onGenerate",value:function(e){var t=this,i={billPeriodId:Number(e.billPeriodId),unitNumber:e.unitNumber,settlementDate:e.settlementDate,billDate:e.processDate,billType:e.billType?e.billType:y.a.NormalBill,clientId:e.clientId,tenantIds:e.tenantIds};this.showSpinner=!0,this.billSettlementService.generateBillDetails(i).subscribe({next:function(e){t.showSpinner=!1,t.billSettlement={},t.billSettlement.unbBilledConsumptions=e},error:function(e){t.showSpinner=!1,t.notificationMessage(e,"red-snackbar")}})}},{key:"notificationMessage",value:function(e,t){this.snackbar.open(e,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[t]})}},{key:"invoiceView",value:function(e){var t=this;this.billService.invoicePreview(e).subscribe({next:function(e){e?t.downloadFile(e):t.notificationMessage("No data to print","red-snackbar")},error:function(e){t.notificationMessage("No data to print","red-snackbar")}})}},{key:"downloadFile",value:function(e){return Object(h.a)(this,void 0,void 0,regeneratorRuntime.mark((function i(){var n,l,a,o,r,s,c,u;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,ee.PDFDocument.create();case 2:n=i.sent,l=t(e),i.prev=4,l.s();case 6:if((a=l.n()).done){i.next=16;break}return o=a.value,i.next=10,ee.PDFDocument.load(o);case 10:return r=i.sent,i.next=13,n.copyPages(r,r.getPageIndices());case 13:i.sent.forEach((function(e){n.addPage(e)}));case 14:i.next=6;break;case 16:i.next=21;break;case 18:i.prev=18,i.t0=i.catch(4),l.e(i.t0);case 21:return i.prev=21,l.f(),i.finish(21);case 24:return i.next=26,n.save();case 26:s=i.sent,c=new Blob([s],{type:"application/pdf"}),u=window.URL.createObjectURL(c),window.open(u);case 30:case"end":return i.stop()}}),i,null,[[4,18,21,24]])})))}}]),e}()).\u0275fac=function(e){return new(e||re)(g.Nb(b.a),g.Nb(M.a),g.Nb(B.b),g.Nb(Z.a),g.Nb(w.a))},re.\u0275cmp=g.Hb({type:re,selectors:[["app-create-bill"]],viewQuery:function(e,t){var i;1&e&&(g.Jc(W,!0),g.Jc(K,!0)),2&e&&(g.zc(i=g.cc())&&(t.unbilledConsumptionComponent=i.first),g.zc(i=g.cc())&&(t.createBillToolbarComponent=i.first))},decls:30,vars:16,consts:[["mode","card",2,"margin-top","20px"],["class","loading-indicator",4,"ngIf"],["fxLayout","column"],["color","primary",1,"position-fixed"],["src","assets/img/fav-icon.png",1,"img-style"],[1,"toolbar-spacer"],["matTooltip","Reset","mat-icon-button","","aria-label","Example icon-button with menu icon",1,"example-icon",3,"click"],["matTooltip","Save","mat-icon-button","","aria-label","Example icon-button with menu icon",1,"example-icon",3,"click"],["fxFlex","noshrink","fxLayout","column","fxLayout.gt-sm","row","fxLayoutAlign.gt-sm","start stretch",3,"fxLayoutGap"],["fxFlex","grow",1,"basic-forms","route-animations-elements",3,"fxFlex.gt-sm"],["fxLayout","column",1,"result"],[3,"tenants","utilityTypes","billPeriods","filterClicked"],[3,"dataSource","isHide","hideHeader","printDataRows"],[1,"loading-indicator"],["mode","indeterminate","color","accent"]],template:function(e,t){1&e&&(g.Tb(0,"fury-page-layout",0),g.Pc(1,oe,2,0,"div",1),g.Tb(2,"fury-page-layout-content",2),g.Tb(3,"mat-toolbar",3),g.Ob(4,"img",4),g.Tb(5,"span"),g.Rc(6,"Generate Bills"),g.Sb(),g.Ob(7,"span",5),g.Tb(8,"button",6),g.bc("click",(function(){return t.reset()})),g.Tb(9,"mat-icon"),g.Rc(10,"refresh"),g.Sb(),g.Sb(),g.Tb(11,"button",7),g.bc("click",(function(e){return t.onSaveBills(e)})),g.Tb(12,"mat-icon"),g.Rc(13,"save"),g.Sb(),g.Sb(),g.Sb(),g.Tb(14,"div",8),g.Tb(15,"fury-card",9),g.Ob(16,"fury-card-header"),g.Tb(17,"fury-card-content",2),g.Tb(18,"div",10),g.Tb(19,"app-create-bill-toolbar",11),g.bc("filterClicked",(function(e){return t.onGenerate(e)})),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Tb(20,"div",8),g.Tb(21,"fury-card",9),g.Tb(22,"fury-card-content",2),g.Tb(23,"div",10),g.Tb(24,"app-unbilled-consumption",12),g.bc("printDataRows",(function(e){return t.invoiceView(e)})),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Tb(25,"div",8),g.Tb(26,"fury-card",9),g.Tb(27,"fury-card-content",2),g.Tb(28,"div",10),g.Ob(29,"app-create-bill-footer-toolbar"),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb()),2&e&&(g.Cb(1),g.mc("ngIf",t.showSpinner),g.Cb(13),g.mc("fxLayoutGap",t.gap),g.Cb(1),g.mc("fxFlex.gt-sm",t.col2)("@fadeInUp",void 0),g.Cb(4),g.mc("tenants",t.tenants)("utilityTypes",t.utilityTypes)("billPeriods",t.billPeriods),g.Cb(1),g.mc("fxLayoutGap",t.gap),g.Cb(1),g.mc("fxFlex.gt-sm",t.col2)("@fadeInUp",void 0),g.Cb(3),g.mc("dataSource",t.billSettlement)("isHide",!1)("hideHeader",!1),g.Cb(1),g.mc("fxLayoutGap",t.gap),g.Cb(1),g.mc("fxFlex.gt-sm",t.col2)("@fadeInUp",void 0))},directives:[te.a,d.o,ie.a,N.d,ne.a,k.a,A.a,F.a,N.b,N.c,N.e,S.a,S.d,S.c,K,W,le,ae.a],styles:['.toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.img-style[_ngcontent-%COMP%]{width:32px}.loading-indicator[_ngcontent-%COMP%]{position:fixed;z-index:999;height:2em;width:2em;overflow:show;margin:auto;top:0;left:0;bottom:0;right:0}.loading-indicator[_ngcontent-%COMP%]:before{content:"";display:block;position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.3)}.position-fixed[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;top:0;z-index:5}'],data:{animation:[p.a,f.a]}}),re);function ce(e,t){if(1&e&&(g.Tb(0,"mat-option",13),g.Rc(1),g.Sb()),2&e){var i=t.$implicit;g.mc("value",i.value),g.Cb(1),g.Tc("",i.label," ")}}function ue(e,t){1&e&&(g.Tb(0,"mat-hint",14),g.Rc(1,"Select payment mode"),g.Sb())}function de(e,t){if(1&e&&(g.Tb(0,"mat-option",13),g.Rc(1),g.Sb()),2&e){var i=t.$implicit;g.mc("value",i.value),g.Cb(1),g.Tc("",i.label," ")}}function me(e,t){1&e&&(g.Tb(0,"mat-hint",14),g.Rc(1,"Select bank"),g.Sb())}function he(e,t){1&e&&(g.Tb(0,"mat-hint",14),g.Rc(1,"Select payment date"),g.Sb())}var be,fe=((be=function(){function e(t){l(this,e),this.datePipe=t,this.banks=[],this.paymentModes=[],this.isShowValidation=!1,this.paymentModeId=0,this.bankId=0,this.paymentDate=this.datePipe.transform(new Date,"yyyy-MM-dd"),this.refNumber="",this.remarks="",this.disableBank=!1,this.validate=new g.o}return o(e,[{key:"ngOnInit",value:function(){}},{key:"onChangeBank",value:function(e){this.bankId=e,this.validateControls()}},{key:"onChangePaymentMode",value:function(e){this.paymentModeId=e;var t=this.paymentModes.find((function(t){return t.value==e}));t&&(this.disableBank="Cash- Billing Collection"===t.label,this.bankId=0),this.validateControls()}},{key:"validateControls",value:function(){var e=!0;(this.disableBank||this.bankId)&&this.paymentModeId&&this.paymentDate||(e=!1),this.validate.emit(e)}},{key:"onDateChange",value:function(e){this.validateControls()}}]),e}()).\u0275fac=function(e){return new(e||be)(g.Nb(d.f))},be.\u0275cmp=g.Hb({type:be,selectors:[["app-payment-details"]],inputs:{banks:"banks",paymentModes:"paymentModes",isShowValidation:"isShowValidation"},outputs:{validate:"validate"},decls:33,vars:13,consts:[[1,"person"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","24px"],[1,"result",2,"width","50%"],["id","PaymentMode","name","PaymentMode",3,"value","selectionChange","valueChange"],[3,"value",4,"ngFor","ngForOf"],["class","small",4,"ngIf"],["id","Bank","name","Bank",3,"disabled","value","selectionChange","valueChange"],["type","text","id","ReferenceNumber","name","ReferenceNumber","matInput","",3,"ngModel","ngModelChange"],["id","PaymentDate","name","PaymentDate","matInput","","readonly","",3,"ngModel","matDatepicker","click","ngModelChange","focus","dateInput"],["matSuffix","",3,"for"],["formDatepickerRef",""],["fxFlex","grow"],["type","text","id","Remarks","name","Remarks","matInput","",3,"ngModel","ngModelChange"],[3,"value"],[1,"small"]],template:function(e,t){if(1&e){var i=g.Ub();g.Tb(0,"mat-dialog-content"),g.Tb(1,"div",0),g.Tb(2,"div",1),g.Tb(3,"mat-form-field",2),g.Tb(4,"mat-label"),g.Rc(5,"Payment Mode"),g.Sb(),g.Tb(6,"mat-select",3),g.bc("selectionChange",(function(e){return t.onChangePaymentMode(e.value)}))("valueChange",(function(e){return t.paymentModeId=e})),g.Pc(7,ce,2,2,"mat-option",4),g.Sb(),g.Pc(8,ue,2,0,"mat-hint",5),g.Sb(),g.Tb(9,"mat-form-field",2),g.Tb(10,"mat-label"),g.Rc(11,"Bank"),g.Sb(),g.Tb(12,"mat-select",6),g.bc("selectionChange",(function(e){return t.onChangeBank(e.value)}))("valueChange",(function(e){return t.bankId=e})),g.Pc(13,de,2,2,"mat-option",4),g.Sb(),g.Pc(14,me,2,0,"mat-hint",5),g.Sb(),g.Sb(),g.Tb(15,"div",1),g.Tb(16,"mat-form-field",2),g.Tb(17,"mat-label"),g.Rc(18,"Ref Number"),g.Sb(),g.Tb(19,"input",7),g.bc("ngModelChange",(function(e){return t.refNumber=e})),g.Sb(),g.Sb(),g.Tb(20,"mat-form-field",2),g.Tb(21,"mat-label"),g.Rc(22,"Payment Date"),g.Sb(),g.Tb(23,"input",8),g.bc("click",(function(){return g.Ec(i),g.Ac(26).open()}))("ngModelChange",(function(e){return t.paymentDate=e}))("focus",(function(){return g.Ec(i),g.Ac(26).open()}))("dateInput",(function(e){return t.onDateChange(e)})),g.Sb(),g.Ob(24,"mat-datepicker-toggle",9),g.Ob(25,"mat-datepicker",null,10),g.Pc(27,he,2,0,"mat-hint",5),g.Sb(),g.Sb(),g.Tb(28,"div",1),g.Tb(29,"mat-form-field",11),g.Tb(30,"mat-label"),g.Rc(31,"Remarks"),g.Sb(),g.Tb(32,"textarea",12),g.bc("ngModelChange",(function(e){return t.remarks=e})),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb()}if(2&e){var n=g.Ac(26);g.Cb(6),g.mc("value",t.paymentModeId),g.Cb(1),g.mc("ngForOf",t.paymentModes),g.Cb(1),g.mc("ngIf",t.isShowValidation&&!t.paymentModeId),g.Cb(4),g.mc("disabled",t.disableBank)("value",t.bankId),g.Cb(1),g.mc("ngForOf",t.banks),g.Cb(1),g.mc("ngIf",t.isShowValidation&&!t.disableBank&&!t.bankId),g.Cb(5),g.mc("ngModel",t.refNumber),g.Cb(4),g.mc("ngModel",t.paymentDate)("matDatepicker",n),g.Cb(1),g.mc("for",n),g.Cb(3),g.mc("ngIf",t.isShowValidation&&!t.paymentDate),g.Cb(5),g.mc("ngModel",t.remarks)}},directives:[v.f,N.d,N.e,z.d,z.h,U.a,d.n,d.o,E.b,s.c,s.q,s.t,Y.b,Y.d,z.j,Y.a,N.b,H.n,z.g],styles:[".small[_ngcontent-%COMP%]{color:red}"]}),be);function pe(e,t){if(1&e&&(g.Tb(0,"mat-option",9),g.Rc(1),g.Sb()),2&e){var i=t.$implicit;g.mc("value",i.value),g.Cb(1),g.Tc(" ",i.label," ")}}var ge,ve=((ge=function(){function e(t,i){l(this,e),this.data=t,this.dialogRef=i,this.accountHeadItems=[],this.accountHeadName="",this.accountHeadId=0,this.amount=0}return o(e,[{key:"ngOnInit",value:function(){this.onGetAccountHeads(this.data)}},{key:"onGetAccountHeads",value:function(e){var t=this;this.accountHeadItems=[{label:"Select",value:0}],e.forEach((function(e){t.accountHeadItems.push({label:e.accountHeadName,value:e.id})}))}},{key:"onChangeAccountHeads",value:function(e){var t=this;this.accountHeadId=e;var i=this.data.find((function(e){return e.id===t.accountHeadId}));i&&(this.accountHeadName=i.accountHeadName,this.amount=i.fixedAmount)}},{key:"onAddNewItem",value:function(){this.dialogRef.close({id:this.accountHeadId,accountHeadName:this.accountHeadName,fixedAmount:this.amount})}}]),e}()).\u0275fac=function(e){return new(e||ge)(g.Nb(v.a),g.Nb(v.h))},ge.\u0275cmp=g.Hb({type:ge,selectors:[["app-add-new-account-head"]],decls:19,vars:3,consts:[[1,"person"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","24px"],[1,"result"],["id","AccountHeads","name","AccountHeads",3,"value","selectionChange","valueChange"],[3,"value",4,"ngFor","ngForOf"],["color","primary",1,"result"],["type","text","id","Amount","name","Amount","matInput","",3,"ngModel","ngModelChange"],[1,"fury-flex-form-field"],["color","primary","mat-raised-button","",3,"click"],[3,"value"]],template:function(e,t){1&e&&(g.Tb(0,"fury-card-header"),g.Tb(1,"fury-card-header-heading"),g.Rc(2,"Add Account Heads"),g.Sb(),g.Sb(),g.Tb(3,"mat-dialog-content"),g.Tb(4,"div",0),g.Tb(5,"div",1),g.Tb(6,"mat-form-field",2),g.Tb(7,"mat-label"),g.Rc(8,"Account Head"),g.Sb(),g.Tb(9,"mat-select",3),g.bc("selectionChange",(function(e){return t.onChangeAccountHeads(e.value)}))("valueChange",(function(e){return t.accountHeadId=e})),g.Pc(10,pe,2,2,"mat-option",4),g.Sb(),g.Sb(),g.Tb(11,"mat-form-field",5),g.Tb(12,"mat-label"),g.Rc(13,"Amount"),g.Sb(),g.Tb(14,"input",6),g.bc("ngModelChange",(function(e){return t.amount=e})),g.Sb(),g.Sb(),g.Tb(15,"div",7),g.Tb(16,"button",8),g.bc("click",(function(){return t.onAddNewItem()})),g.Tb(17,"span"),g.Rc(18,"ADD"),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb()),2&e&&(g.Cb(9),g.mc("value",t.accountHeadId),g.Cb(1),g.mc("ngForOf",t.accountHeadItems),g.Cb(4),g.mc("ngModel",t.amount))},directives:[S.d,S.g,v.f,N.d,N.e,z.d,z.h,U.a,d.n,E.b,s.c,s.q,s.t,k.a,H.n],styles:[""]}),ge),ye=a("+0xr"),Ce=a("6GKC"),Se=a("dUAH");function Te(e,t){if(1&e&&(g.Tb(0,"div",1),g.Tb(1,"mat-form-field",2),g.Tb(2,"mat-label"),g.Rc(3),g.Sb(),g.Ob(4,"input",9),g.gc(5,"noComma"),g.gc(6,"number"),g.Sb(),g.Sb()),2&e){var i=g.fc();g.Cb(3),g.Sc(i.labelName),g.Cb(1),g.mc("ngModel",g.hc(5,2,g.ic(6,4,i.excessAmount,i.roundFormat)))}}var Pe,De,we,Ne=((De=function(){function e(t,i){l(this,e),this.dialog=t,this.decimalPipe=i,this.accountHeads=[],this.accountHeadData=[],this.dateFormat=Object(y.e)("DateFormat"),this.currencyFormat=Object(y.e)("Currency",0),this.roundFormat=Object(y.e)("RoundOff"),this.amountdecimalPlaces=parseInt(this.roundFormat.substring(this.roundFormat.indexOf("-")+1,this.roundFormat.length)),this.isAdjustWithAdvance=!0,this.labelName="Excess Amount",this.isDisable=!1,this.isHide=!1,this.isValidPayment=new g.o,this.billAmount=0,this.total=0,this.roundOff=0,this.toPay="0",this.vatAmount=0,this.excessAmount=0,this.previousAdvanceAmount=0,this.advanceAdjusted=0,this.columns=[],this.identifierColumnNmae="#",this.accountHeadColumnName="Account Head",this.amountColumnName="Amount"}return o(e,[{key:"ngOnInit",value:function(){this.createGridColumns()}},{key:"createGridColumns",value:function(){this.columns=[{name:this.accountHeadColumnName,property:"accountHeadName",visible:!0,isModelProperty:!0},{name:this.amountColumnName,property:"fixedAmount",visible:!0,isModelProperty:!0}]}},{key:"addNewItem",value:function(){var e=this;this.dialog.open(ve,{data:this.accountHeadData}).afterClosed().subscribe((function(t){t&&(t.rowNumber=e.accountHeads.length+1,e.accountHeads.push(t),e.accountHeads&&(e.tableStructureComponent.dataSource=new ye.k,e.tableStructureComponent.dataSource.data=e.accountHeads,e.accountHeads.forEach((function(t){return e.total+=t.fixedAmount})),e.roundOff=e.total,e.toPay=e.decimalPipe.transform(e.total,e.roundFormat.toString()).replace(/,/g,"")))}))}},{key:"onAdvanceAdjustedChange",value:function(e){Number(this.toPay)>this.total?(this.labelName="Excess Amount",this.excessAmount=Number(this.decimalPipe.transform(Number(this.toPay)-this.total,this.roundFormat.toString()).replace(/,/g,""))):(this.labelName="Balance Amount",this.excessAmount=Number(this.decimalPipe.transform(this.total-Number(this.toPay),this.roundFormat.toString()).replace(/,/g,"")))}},{key:"onToPayAmountChange",value:function(e){this.advanceAdjusted>0&&Number(this.toPay)>=0||Number(this.toPay)>0?this.isValidPayment.emit(!0):this.isValidPayment.emit(!1),Object(y.c)(this.toPay)+Object(y.c)(this.advanceAdjusted)>Object(y.c)(this.total)?(this.labelName="Excess Amount",this.excessAmount=Number(this.decimalPipe.transform(Object(y.c)(this.toPay)+Object(y.c)(this.advanceAdjusted)-Object(y.c)(this.total),this.roundFormat.toString()).replace(/,/g,""))):(this.labelName="Balance Amount",this.excessAmount=Number(this.decimalPipe.transform(Object(y.c)(this.total)-Object(y.c)(this.toPay)-Object(y.c)(this.advanceAdjusted),this.roundFormat.toString()).replace(/,/g,"")))}},{key:"onRoundOffAmountChange",value:function(e){e>0?this.toPay=this.decimalPipe.transform(Number(this.total)+Number(e),this.roundFormat.toString()).replace(/,/g,""):(this.roundOff=0,this.toPay=this.decimalPipe.transform(this.total,this.roundFormat.toString()).replace(/,/g,""))}},{key:"onCalculateVAT",value:function(e){if(e&&e.length){var t=e.find((function(e){return"VAT"===e.accountHeadName}));t&&("GrandTotal"===t.formulaDescription&&"Percentage"===t.operatorDescription?this.vatAmount=Number(this.decimalPipe.transform(Number(this.toPay)*Number(t.fixedAmount)/100,this.roundFormat)):"GrandTotal"===t.formulaDescription&&"Add"===t.operatorDescription&&(this.vatAmount=Number(this.decimalPipe.transform(Number(this.toPay)+Number(t.fixedAmount),this.roundFormat))),"GrandTotal"===t.formulaDescription&&"Multiply"===t.operatorDescription&&(this.vatAmount=Number(this.decimalPipe.transform(Number(this.toPay)*Number(t.fixedAmount),this.roundFormat))),"GrandTotal"===t.formulaDescription&&"Subtract"===t.operatorDescription&&(this.vatAmount=Number(this.decimalPipe.transform(Number(this.toPay)-Number(t.fixedAmount),this.roundFormat))),"GrandTotal"===t.formulaDescription&&"Divide"===t.operatorDescription&&(this.vatAmount=Number(this.decimalPipe.transform(Number(this.toPay)/Number(t.fixedAmount),this.roundFormat))))}this.toPay=this.decimalPipe.transform(Number(this.toPay)+this.vatAmount,this.roundFormat)}},{key:"onChangeAdjustWithAdvance",value:function(e){if(this.isAdjustWithAdvance=e.checked,this.isAdjustWithAdvance)if(this.total>=this.previousAdvanceAmount){var t=Number(this.total),i=Number(this.previousAdvanceAmount);this.toPay=this.decimalPipe.transform(Number(t-i),this.roundFormat.toString()).replace(/,/g,"")}else this.toPay="0";else this.toPay=this.decimalPipe.transform(Number(this.total),this.roundFormat.toString()).replace(/,/g,"")}},{key:"dataSource",set:function(e){var t=this;this.dateFormat=Object(y.e)("DateFormat"),this.roundFormat=Object(y.e)("RoundOff"),this.currencyFormat=Object(y.e)("Currency",0),e&&!this.isHide?(e.accountHeads&&e.accountHeads.length&&(this.accountHeads=e.accountHeads,this.accountHeadData=e.accountHeads.filter((function(e){return"VAT"!==e.accountHeadName}))),e.outstandingBills&&e.outstandingBills.length?(this.billAmount=0,e.outstandingBills.forEach((function(e){return t.billAmount+=Number(e.toPay)})),this.toPay=this.decimalPipe.transform(this.billAmount,this.roundFormat.toString()).replace(/,/g,""),this.roundOff=this.total=this.billAmount=Number(this.decimalPipe.transform(this.billAmount,this.roundFormat.toString()).replace(/,/g,""))):(this.toPay="0",this.advanceAdjusted=this.excessAmount=this.roundOff=this.total=this.billAmount=0)):(this.toPay="0",this.advanceAdjusted=this.excessAmount=this.roundOff=this.total=this.billAmount=0),this.previousAdvanceAmount=e&&e.advance?e.advance.advanceAmount:0,e&&e.openingBalance?(this.billAmount=e.openingBalance.amount,this.total+=this.billAmount,this.total>this.previousAdvanceAmount?(this.advanceAdjusted=this.previousAdvanceAmount,this.toPay=this.decimalPipe.transform(this.total-this.previousAdvanceAmount,this.roundFormat.toString()).replace(/,/g,"")):this.total<this.previousAdvanceAmount&&(this.advanceAdjusted=this.total,this.toPay="0")):this.billAmount=0,this.advanceAdjusted>0&&Number(this.toPay)>=0||Number(this.toPay)>0?this.isValidPayment.emit(!0):this.isValidPayment.emit(!1),this.toPay=this.decimalPipe.transform(this.toPay,this.roundFormat.toString()).replace(/,/g,"")}},{key:"selectedRows",set:function(e){var t=this;e&&e.length?(this.total=this.excessAmount=0,this.dateFormat=Object(y.e)("DateFormat"),this.roundFormat=Object(y.e)("RoundOff"),this.currencyFormat=Object(y.e)("Currency",0),e.forEach((function(e){return t.total+=Number(e.toPay)})),this.total&&(this.previousAdvanceAmount>0?(this.roundOff=this.total=Number(this.decimalPipe.transform(this.total+this.billAmount,this.roundFormat.toString()).replace(/,/g,"")),this.total>this.previousAdvanceAmount?(this.advanceAdjusted=this.previousAdvanceAmount,this.toPay=this.decimalPipe.transform(this.total-this.previousAdvanceAmount,this.roundFormat.toString()).replace(/,/g,"")):(this.advanceAdjusted=this.total,this.toPay="0")):(this.toPay=this.decimalPipe.transform(this.total+this.billAmount,this.roundFormat.toString()).replace(/,/g,""),this.roundOff=this.total=Number(this.decimalPipe.transform(this.total+this.billAmount,this.roundFormat.toString()).replace(/,/g,"")),this.advanceAdjusted=0))):(this.total=this.excessAmount=0,this.total+=this.billAmount,this.total>this.previousAdvanceAmount?(this.advanceAdjusted=this.previousAdvanceAmount,this.toPay=this.decimalPipe.transform(this.total-this.previousAdvanceAmount,this.roundFormat.toString()).replace(/,/g,"")):this.total<this.previousAdvanceAmount?(this.advanceAdjusted=this.total,this.toPay="0"):(this.advanceAdjusted=0,this.toPay=this.decimalPipe.transform(this.billAmount,this.roundFormat.toString()).replace(/,/g,""),this.roundOff=this.total=this.billAmount)),this.advanceAdjusted>0&&Number(this.toPay)>=0||Number(this.toPay)>0?this.isValidPayment.emit(!0):this.isValidPayment.emit(!1)}}]),e}()).\u0275fac=function(e){return new(e||De)(g.Nb(v.b),g.Nb(d.g))},De.\u0275cmp=g.Hb({type:De,selectors:[["app-bill-amount-details"]],viewQuery:function(e,t){var i;1&e&&g.Vc(T.a,!0),2&e&&g.zc(i=g.cc())&&(t.tableStructureComponent=i.first)},inputs:{isDisable:"isDisable",isHide:"isHide",dataSource:"dataSource",selectedRows:"selectedRows"},outputs:{isValidPayment:"isValidPayment"},decls:36,vars:27,consts:[[1,"person"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","8px"],["color","primary",2,"width","100%"],["type","text","id","OutstandingBillAmount","name","OutstandingBillAmount","readonly","","matInput","",2,"text-align","right",3,"ngModel"],["id","Total","name","Total","matInput","","readonly","",2,"text-align","right",3,"ngModel"],["id","PreviousAdvance","name","PreviousAdvance","matInput","","readonly","",2,"text-align","right",3,"ngModel"],["id","ToPay","name","ToPay","matInput","","autofocus","","furyValidateDecimalPlacesDirective","",2,"text-align","right",3,"ngModel","disabled","ngModelChange","input"],["id","advanceAdjusted","name","advanceAdjusted","matInput","","readonly","",2,"text-align","right",3,"ngModel","input"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","8px",4,"ngIf"],["id","ExcessAmount","name","ExcessAmount","matInput","","furyValidateDecimalPlacesDirective","",2,"text-align","right",3,"ngModel"]],template:function(e,t){1&e&&(g.Tb(0,"mat-dialog-content"),g.Tb(1,"div",0),g.Tb(2,"div",1),g.Tb(3,"mat-form-field",2),g.Tb(4,"mat-label"),g.Rc(5,"Opening Due Amount"),g.Sb(),g.Ob(6,"input",3),g.gc(7,"noComma"),g.gc(8,"number"),g.Sb(),g.Sb(),g.Tb(9,"div",1),g.Tb(10,"mat-form-field",2),g.Tb(11,"mat-label"),g.Rc(12,"Total"),g.Sb(),g.Ob(13,"input",4),g.gc(14,"noComma"),g.gc(15,"number"),g.Sb(),g.Sb(),g.Tb(16,"div",1),g.Tb(17,"mat-form-field",2),g.Tb(18,"mat-label"),g.Rc(19,"Previous Advance"),g.Sb(),g.Ob(20,"input",5),g.gc(21,"noComma"),g.gc(22,"number"),g.Sb(),g.Sb(),g.Tb(23,"div",1),g.Tb(24,"mat-form-field",2),g.Tb(25,"mat-label"),g.Rc(26,"To Pay"),g.Sb(),g.Tb(27,"input",6),g.bc("ngModelChange",(function(e){return t.toPay=e}))("input",(function(e){return t.onToPayAmountChange(e.target.value)})),g.Sb(),g.Sb(),g.Sb(),g.Tb(28,"div",1),g.Tb(29,"mat-form-field",2),g.Tb(30,"mat-label"),g.Rc(31,"Advance Adjusted"),g.Sb(),g.Tb(32,"input",7),g.bc("input",(function(e){return t.onAdvanceAdjustedChange(e.target.value)})),g.gc(33,"noComma"),g.gc(34,"number"),g.Sb(),g.Sb(),g.Sb(),g.Pc(35,Te,7,7,"div",8),g.Sb(),g.Sb()),2&e&&(g.Cb(6),g.mc("ngModel",g.hc(7,7,g.ic(8,9,t.billAmount,t.roundFormat))),g.Cb(7),g.mc("ngModel",g.hc(14,12,g.ic(15,14,t.total,t.roundFormat))),g.Cb(7),g.mc("ngModel",g.hc(21,17,g.ic(22,19,t.previousAdvanceAmount,t.roundFormat))),g.Cb(7),g.mc("ngModel",t.toPay)("disabled",t.isDisable),g.Cb(5),g.mc("ngModel",g.hc(33,22,g.ic(34,24,t.advanceAdjusted,t.roundFormat))),g.Cb(3),g.mc("ngIf",t.isHide))},directives:[v.f,N.d,N.e,z.d,z.h,E.b,s.c,s.q,s.t,Ce.a,d.o],pipes:[Se.a,d.g],styles:[".small[_ngcontent-%COMP%]{color:red}"]}),De),xe=((Pe=function(){function e(t,i,n){var a,o,r;l(this,e),this.date=t,this.currencyPipe=i,this.envService=n,this.outStandingBills=[],this.selectedRows=[],this.columns=[],this.dateColumnName="Date",this.billNumberConsumptionColumnName="Bill No",this.unitColumnName="Unit",this.consumptionColumnName="Consumption",this.amountColumnName="Net Amount",this.creditNoteAmount="Credit Note Amount",this.paidColumnName="Paid",this.toPayColumnName="To Pay",this.format="",this.currency="",this.roundFormat="",this.isHide=!0,this.isAutoSelect=!1,this.disableCheckBox=!1,this.rowsSelected=new g.o,this.format=null!==(a=Object(y.e)("DateFormat"))&&void 0!==a?a:n.dateFormat,this.currency=null!==(o=Object(y.e)("Currency"))&&void 0!==o?o:n.currencyFormat,this.roundFormat=null!==(r=Object(y.e)("RoundOff"))&&void 0!==r?r:n.roundOffFormat}return o(e,[{key:"ngOnInit",value:function(){this.createGridColumns(),this.isHide&&this.updateTableColumns()}},{key:"createGridColumns",value:function(){this.columns=[{name:"Checkbox",property:"checkbox",visible:!0},{name:this.dateColumnName,property:"billDateLocal",visible:!0,isModelProperty:!0},{name:this.billNumberConsumptionColumnName,property:"billNumber",visible:!0,isModelProperty:!0},{name:this.unitColumnName,property:"unitNumber",visible:!0,isModelProperty:!0},{name:this.amountColumnName,property:"netAmountLocal",visible:!0,isModelProperty:!0,columnAlign:{"text-align":"right"}},{name:this.paidColumnName,property:"paidLocal",visible:!0,isModelProperty:!0,columnAlign:{"text-align":"right"}},{name:this.toPayColumnName,property:"toPayLocal",visible:!0,isModelProperty:!0,columnAlign:{"text-align":"right"}}]}},{key:"updateTableColumns",value:function(){this.columns.splice(0,1)}},{key:"onSelectedRows",value:function(e){this.selectedRows=[],this.selectedRows=e,this.rowsSelected.emit(this.selectedRows)}},{key:"updateDataFormats",value:function(e){var t=this;return e&&(this.format=Object(y.e)("DateFormat"),this.roundFormat=Object(y.e)("RoundOff"),this.currency=Object(y.e)("Currency"),e.forEach((function(e){e.billDateLocal=t.date.transform(e.billDate.toString(),t.format.toString()),e.billAmountLocal=t.currencyPipe.transform(e.billAmount,t.currency.toString(),!0,t.roundFormat),e.netAmountLocal=t.currencyPipe.transform(e.billAmount-e.creditNoteAmount,t.currency.toString(),!0,t.roundFormat),e.creditNoteAmountLocal=t.currencyPipe.transform(e.creditNoteAmount,t.currency.toString(),!0,t.roundFormat),e.toPayLocal=t.currencyPipe.transform(e.toPay,t.currency.toString(),!0,t.roundFormat),e.paidLocal=t.currencyPipe.transform(e.paid,t.currency.toString(),!0,t.roundFormat)}))),e}},{key:"dataSource",set:function(e){e&&(this.outStandingBills=e.outstandingBills&&e.outstandingBills.length?this.updateDataFormats(e.outstandingBills):[])}}]),e}()).\u0275fac=function(e){return new(e||Pe)(g.Nb(d.f),g.Nb(d.d),g.Nb(C.a))},Pe.\u0275cmp=g.Hb({type:Pe,selectors:[["app-outstanding-bills"]],inputs:{isHide:"isHide",isAutoSelect:"isAutoSelect",disableCheckBox:"disableCheckBox",dataSource:"dataSource"},outputs:{rowsSelected:"rowsSelected"},decls:5,vars:4,consts:[[1,"person"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","1px"],[1,"fury-flex-form-field"],[3,"isAutoSelect","tableData","columns","disableCheckBox","selectedRows"]],template:function(e,t){1&e&&(g.Tb(0,"mat-dialog-content"),g.Tb(1,"div",0),g.Tb(2,"div",1),g.Tb(3,"div",2),g.Tb(4,"app-table-structure",3),g.bc("selectedRows",(function(e){return t.onSelectedRows(e)})),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb()),2&e&&(g.Cb(4),g.mc("isAutoSelect",t.isAutoSelect)("tableData",t.outStandingBills)("columns",t.columns)("disableCheckBox",t.disableCheckBox))},directives:[v.f,N.d,N.e,T.a],styles:[""]}),Pe),ke=a("AJS6"),Ae=a("RNk+"),Fe=a("i680"),Re=((we=function(){function e(){l(this,e),this.saveClicked=new g.o,this.printClicked=new g.o,this.isDisabled=!1,this.isPrintDisable=!0}return o(e,[{key:"ngOnInit",value:function(){}},{key:"onSave",value:function(){this.saveClicked.emit(!0)}},{key:"onPrint",value:function(){this.printClicked.emit(!0)}}]),e}()).\u0275fac=function(e){return new(e||we)},we.\u0275cmp=g.Hb({type:we,selectors:[["app-final-bill-settlement-footer-toolbar"]],inputs:{isDisabled:"isDisabled",isPrintDisable:"isPrintDisable"},outputs:{saveClicked:"saveClicked",printClicked:"printClicked"},decls:9,vars:2,consts:[[1,"person"],["matTooltip","Save","mat-icon-button","","aria-label","Example icon-button with menu icon",1,"example-icon",3,"disabled","click"],["matTooltip","Print","mat-icon-button","","aria-label","Example icon-button with menu icon",1,"example-icon",3,"disabled","click"]],template:function(e,t){1&e&&(g.Tb(0,"mat-dialog-content"),g.Tb(1,"div",0),g.Tb(2,"form"),g.Tb(3,"button",1),g.bc("click",(function(){return t.onSave()})),g.Tb(4,"mat-icon"),g.Rc(5,"save"),g.Sb(),g.Sb(),g.Tb(6,"button",2),g.bc("click",(function(){return t.onPrint()})),g.Tb(7,"mat-icon"),g.Rc(8,"print"),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb()),2&e&&(g.Cb(3),g.mc("disabled",t.isDisabled),g.Cb(3),g.mc("disabled",t.isPrintDisable))},directives:[v.f,s.z,s.r,s.s,k.a,A.a,F.a],styles:[""]}),we),Ie=a("znSr"),Oe=a("/1cH"),We=a("QibW");function Me(e,t){if(1&e){var i=g.Ub();g.Tb(0,"mat-radio-button",19),g.bc("change",(function(e){return g.Ec(i),g.fc(2).radioChange(e)})),g.Tb(1,"div",20),g.Rc(2),g.Sb(),g.Sb()}if(2&e){var n=t.$implicit;g.mc("value",n),g.Cb(2),g.Tc(" ",n.label," ")}}function Le(e,t){if(1&e){var i=g.Ub();g.Tb(0,"div",16),g.Tb(1,"mat-radio-group",17),g.bc("ngModelChange",(function(e){return g.Ec(i),g.fc().selectedOption=e})),g.Pc(2,Me,3,2,"mat-radio-button",18),g.Sb(),g.Sb()}if(2&e){var n=g.fc();g.Cb(1),g.mc("ngModel",n.selectedOption),g.Cb(1),g.mc("ngForOf",n.options)}}function Be(e,t){if(1&e&&(g.Tb(0,"mat-option",21),g.Rc(1),g.Sb()),2&e){var i=t.$implicit;g.mc("value",i.ownerName),g.Cb(1),g.Tc(" ",i.ownerName," ")}}function ze(e,t){1&e&&(g.Tb(0,"mat-hint"),g.Rc(1,"Please select Tenant"),g.Sb())}function Ue(e,t){if(1&e&&(g.Tb(0,"mat-option",21),g.Rc(1),g.Sb()),2&e){var i=t.$implicit;g.mc("value",i.unitNumber),g.Cb(1),g.Tc(" ",i.unitNumber," ")}}function Ee(e,t){1&e&&(g.Tb(0,"mat-hint"),g.Rc(1,"Please select Unit"),g.Sb())}function je(e,t){if(1&e&&(g.Tb(0,"mat-option",21),g.Rc(1),g.Sb()),2&e){var i=t.$implicit;g.mc("value",i.description),g.Cb(1),g.Tc(" ",i.description," ")}}function He(e,t){1&e&&(g.Tb(0,"mat-hint"),g.Rc(1,"Please select Account Number"),g.Sb())}var Ye=function(e){return{width:e}};function Ve(e,t){if(1&e){var i=g.Ub();g.Tb(0,"mat-form-field",4),g.Tb(1,"mat-label"),g.Rc(2,"Account Number"),g.Sb(),g.Tb(3,"input",22),g.bc("input",(function(e){return g.Ec(i),g.fc().filterAccountNumber(e.target.value)})),g.Sb(),g.Tb(4,"mat-autocomplete",6,23),g.bc("optionSelected",(function(e){return g.Ec(i),g.fc().selectAccountNumber(e)})),g.Pc(6,je,2,2,"mat-option",8),g.Sb(),g.Pc(7,He,2,0,"mat-hint",9),g.Sb()}if(2&e){var n=g.Ac(5),l=g.fc();g.mc("ngStyle",g.rc(4,Ye,l.isHide?"220px":"180px")),g.Cb(3),g.mc("matAutocomplete",n),g.Cb(3),g.mc("ngForOf",l.filteredAccountNumbers),g.Cb(1),g.mc("ngIf",3==(null==l.selectedOption?null:l.selectedOption.value))}}function _e(e,t){if(1&e&&(g.Tb(0,"mat-option",21),g.Rc(1),g.Sb()),2&e){var i=t.$implicit;g.mc("value",i.value),g.Cb(1),g.Tc("",i.label," ")}}function Ge(e,t){if(1&e){var i=g.Ub();g.Tb(0,"mat-form-field",24),g.Tb(1,"mat-label"),g.Rc(2,"Bill Period"),g.Sb(),g.Tb(3,"mat-select",25),g.bc("selectionChange",(function(e){return g.Ec(i),g.fc().onChangeBillPeriod(e.value)}))("valueChange",(function(e){return g.Ec(i),g.fc().billPeriodId=e})),g.Pc(4,_e,2,2,"mat-option",8),g.Sb(),g.Sb()}if(2&e){var n=g.fc();g.Cb(3),g.mc("value",n.billPeriodId),g.Cb(1),g.mc("ngForOf",n.billPeriods)}}var Xe=function(){return{standalone:!0}};function qe(e,t){if(1&e){var i=g.Ub();g.Tb(0,"mat-form-field",24),g.Tb(1,"mat-label"),g.Rc(2,"settlement Date"),g.Sb(),g.Tb(3,"input",26),g.bc("click",(function(){return g.Ec(i),g.Ac(6).open()}))("ngModelChange",(function(e){return g.Ec(i),g.fc().settlementDate=e}))("focus",(function(){return g.Ec(i),g.Ac(6).open()})),g.Sb(),g.Ob(4,"mat-datepicker-toggle",27),g.Ob(5,"mat-datepicker",null,28),g.Sb()}if(2&e){var n=g.Ac(6),l=g.fc();g.Cb(3),g.mc("ngModel",l.settlementDate)("matDatepicker",n)("ngModelOptions",g.qc(4,Xe)),g.Cb(1),g.mc("for",n)}}var $e,Je=(($e=function(){function e(t,i,n,a,o){l(this,e),this.fb=t,this.snackbar=i,this.billSettlementService=n,this.datePipe=a,this.cookieService=o,this.unitId=0,this.unitNumber="",this.tenantId=0,this.accountNumber="",this.billPeriodId=0,this.settlementDate=L(new Date).format("YYYY-MM-DD"),this.filteredTenants=[],this.filteredUnits=[],this.filteredAccountNumbers=[],this.data=[],this.selectedOption=null,this.manageParams={},this.options=[],this.billPeriods=[],this.isHide=!0,this.isVisible=!0,this.searchClicked=new g.o}return o(e,[{key:"ngOnInit",value:function(){var e=this;this.clientId=parseInt(this.cookieService.get("globalClientId")),this.filteredTenants=this.tenants,this.billSettlementService.getUnits(this.clientId).subscribe((function(t){e.units=t,e.filteredUnits=t})),this.billSettlementService.getAccountNumbers(this.clientId).subscribe((function(t){e.accountNumbers=t,e.filteredAccountNumbers=t})),null==this.selectedOption&&(this.selectedOption=this.options[0]),this.form=this.fb.group({option:[null],tenantName:[""],unitNumber:[""],accountNumber:[""]}),this.radioChange(null),this.form.controls.unitNumber.valueChanges.subscribe((function(t){e.filteredUnits=e.filterUnit(t)})),this.form.controls.accountNumber.valueChanges.subscribe((function(t){e.filteredAccountNumbers=e.filterAccountNumber(t)}))}},{key:"onSearch",value:function(){this.unitNumber||this.tenantId||this.billPeriodId?(this.manageParams={unitNumber:this.unitNumber,tenantId:""+(this.tenantId?this.tenantId:"0"),billPeriodId:""+(this.billPeriodId?this.billPeriodId:"0"),settlementDate:""==this.settlementDate?"":L(this.settlementDate).format("YYYY-MM-DD"),billType:2,clientId:this.clientId},this.searchClicked.emit(this.manageParams)):this.snackbar.open("Invalid search parameters",null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:["yellow-snackbar"]})}},{key:"selectTenant",value:function(e){var t=this;this.tenants.forEach((function(i){i.ownerName===e.option.value&&(t.tenantId=i.id)}))}},{key:"selectUnit",value:function(e){var t=this;this.units.forEach((function(i){i.unitNumber===e.option.value&&(t.unitId=i.id,t.unitNumber=i.unitNumber,t.tenantId=i.tenantId)}))}},{key:"selectAccountNumber",value:function(e){var t=this;this.accountNumbers.forEach((function(i){i.description===e.option.value&&(t.tenantId=i.id,t.accountNumber=i.description)}))}},{key:"onChangeBillPeriod",value:function(e){this.billPeriodId=e}},{key:"filterTenant",value:function(e){this.filteredTenants=this.data.filter((function(t){return 0===t.ownerName.toLowerCase().indexOf(e.toLowerCase())}))}},{key:"filterUnit",value:function(e){return this.filteredUnits=e&&""!=e?this.units.filter((function(t){return 0===t.unitNumber.toLowerCase().indexOf(e.toLowerCase())})):this.units,this.filteredUnits}},{key:"filterAccountNumber",value:function(e){return this.filteredAccountNumbers=e&&""!=e?this.accountNumbers.filter((function(t){return 0===t.description.toLowerCase().indexOf(e.toLowerCase())})):this.accountNumbers,this.filteredAccountNumbers}},{key:"radioChange",value:function(e){null!=e&&(this.selectedOption=e.value),1==this.selectedOption.value?(this.form.controls.tenantName.enable(),this.form.controls.unitNumber.setValue(""),this.form.controls.unitNumber.disable(),this.unitId=0,this.unitNumber="",this.form.controls.accountNumber.setValue(""),this.form.controls.accountNumber.disable()):2==this.selectedOption.value?(this.tenantId=0,this.form.controls.tenantName.setValue(""),this.form.controls.tenantName.disable(),this.form.controls.unitNumber.enable(),this.form.controls.accountNumber.setValue(""),this.form.controls.accountNumber.disable()):(this.form.controls.tenantName.setValue(""),this.form.controls.tenantName.disable(),this.unitId=0,this.unitNumber="",this.form.controls.unitNumber.setValue(""),this.form.controls.unitNumber.disable(),this.form.controls.accountNumber.enable())}},{key:"setTenantNameValue",value:function(e){var t=this.data.find((function(t){return t.id===e}));t&&this.form.controls.tenantName.setValue(t.ownerName)}},{key:"searchTenant",value:function(e){var t=this.selectOwnerTenant(e.toLowerCase());this.filteredTenants=t}},{key:"selectOwnerTenant",value:function(e){var i=[];if(!e)return this.data;var n,l=t(this.data);try{for(l.s();!(n=l.n()).done;){var a=n.value;a.ownerName.toLowerCase().indexOf(e)>-1&&i.push(a)}}catch(o){l.e(o)}finally{l.f()}return i}},{key:"handleInput",value:function(e){e.stopPropagation()}},{key:"tenants",get:function(){return this.data},set:function(e){this.filteredTenants=this.data=e}},{key:"selectedTenant",get:function(){return this.tenantId},set:function(e){this.tenantId=e,this.setTenantNameValue(e)}}]),e}()).\u0275fac=function(e){return new(e||$e)(g.Nb(s.f),g.Nb(B.b),g.Nb(M.a),g.Nb(d.f),g.Nb(w.a))},$e.\u0275cmp=g.Hb({type:$e,selectors:[["app-final-bill-settlement-toolbar"]],inputs:{settlementDate:"settlementDate",tenants:"tenants",selectedTenant:"selectedTenant",options:"options",billPeriods:"billPeriods",isHide:"isHide",isVisible:"isVisible"},outputs:{searchClicked:"searchClicked"},decls:28,vars:18,consts:[[1,"person"],[3,"formGroup"],["fxLayout","row",4,"ngIf"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","20px",1,"padding-top"],["color","primary",1,"result",3,"ngStyle"],["type","text","formControlName","tenantName","id","TenantName","name","TenantName","matInput","",3,"matAutocomplete","keyup","keydown"],[3,"optionSelected"],["tenant","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["type","text","id","unitNumber","matInput","","formControlName","unitNumber",3,"matAutocomplete","input"],["unit","matAutocomplete"],["class","result","color","primary",3,"ngStyle",4,"ngIf"],["class","result","color","primary","style","width: 150px;",4,"ngIf"],[1,"fury-flex-form-field"],["mat-icon-button","","aria-label","Example icon-button with menu icon",1,"example-icon",3,"disabled","click"],["fxLayout","row"],["aria-labelledby","example-radio-group-label","formControlName","option",1,"example-radio-group",3,"ngModel","ngModelChange"],["class","example-radio-button marginRadioButton",3,"value","change",4,"ngFor","ngForOf"],[1,"example-radio-button","marginRadioButton",3,"value","change"],["fxLayout","row",2,"margin-right","30px"],[3,"value"],["type","text","matInput","","formControlName","accountNumber",3,"matAutocomplete","input"],["accountNumber","matAutocomplete"],["color","primary",1,"result",2,"width","150px"],["id","BillPeriod","name","BillPeriod",3,"value","selectionChange","valueChange"],["id","settlementDate","name","settlementDate","matInput","","readonly","",3,"ngModel","matDatepicker","ngModelOptions","click","ngModelChange","focus"],["matSuffix","",3,"for"],["formDatepickerRef",""]],template:function(e,t){if(1&e&&(g.Tb(0,"mat-dialog-content"),g.Tb(1,"div",0),g.Tb(2,"form",1),g.Pc(3,Le,3,2,"div",2),g.Tb(4,"div",3),g.Tb(5,"mat-form-field",4),g.Tb(6,"mat-label"),g.Rc(7,"Tenant Name"),g.Sb(),g.Tb(8,"input",5),g.bc("keyup",(function(e){return t.searchTenant(e.target.value)}))("keydown",(function(e){return t.handleInput(e)})),g.Sb(),g.Tb(9,"mat-autocomplete",6,7),g.bc("optionSelected",(function(e){return t.selectTenant(e)})),g.Pc(11,Be,2,2,"mat-option",8),g.Sb(),g.Pc(12,ze,2,0,"mat-hint",9),g.Sb(),g.Tb(13,"mat-form-field",4),g.Tb(14,"mat-label"),g.Rc(15,"Unit Number"),g.Sb(),g.Tb(16,"input",10),g.bc("input",(function(e){return t.filterUnit(e.target.value)})),g.Sb(),g.Tb(17,"mat-autocomplete",6,11),g.bc("optionSelected",(function(e){return t.selectUnit(e)})),g.Pc(19,Ue,2,2,"mat-option",8),g.Sb(),g.Pc(20,Ee,2,0,"mat-hint",9),g.Sb(),g.Pc(21,Ve,8,6,"mat-form-field",12),g.Pc(22,Ge,5,2,"mat-form-field",13),g.Pc(23,qe,7,5,"mat-form-field",13),g.Tb(24,"div",14),g.Tb(25,"button",15),g.bc("click",(function(){return t.onSearch()})),g.Tb(26,"mat-icon"),g.Rc(27,"search"),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb()),2&e){var i=g.Ac(10),n=g.Ac(18);g.Cb(2),g.mc("formGroup",t.form),g.Cb(1),g.mc("ngIf",!t.isVisible),g.Cb(2),g.mc("ngStyle",g.rc(14,Ye,t.isHide?"400px":"320px")),g.Cb(3),g.mc("matAutocomplete",i),g.Cb(3),g.mc("ngForOf",t.filteredTenants),g.Cb(1),g.mc("ngIf",1==(null==t.selectedOption?null:t.selectedOption.value)),g.Cb(1),g.mc("ngStyle",g.rc(16,Ye,t.isHide?"220px":"180px")),g.Cb(3),g.mc("matAutocomplete",n),g.Cb(3),g.mc("ngForOf",t.filteredUnits),g.Cb(1),g.mc("ngIf",2==(null==t.selectedOption?null:t.selectedOption.value)),g.Cb(1),g.mc("ngIf",!t.isVisible&&t.options&&t.options.length>2),g.Cb(1),g.mc("ngIf",!t.isHide),g.Cb(1),g.mc("ngIf",!t.isHide),g.Cb(2),g.mc("disabled",t.options&&t.options.length>0&&!t.selectedOption)}},directives:[v.f,s.z,s.r,s.k,d.o,N.d,N.e,z.d,d.p,Ie.c,z.h,s.c,E.b,Oe.c,s.q,s.i,Oe.a,d.n,k.a,F.a,We.b,We.a,H.n,z.g,U.a,Y.b,s.t,Y.d,z.j,Y.a],styles:[""]}),$e);function Qe(e,t){1&e&&(g.Tb(0,"div",17),g.Ob(1,"mat-progress-spinner",18),g.Sb())}var Ke,Ze=((Ke=function(){function e(t,i,n,a,o,r,s,c,u,d,m,h){var b,f,p;l(this,e),this.billSettlementService=t,this.snackbar=i,this.billService=n,this.date=a,this.cookieService=o,this.currency=r,this.templatesService=s,this.templateService=c,this.decimalPipe=u,this.clientSelectionService=d,this.route=m,this.envService=h,this._gap=16,this.gap=this._gap+"px",this.col2="1 1 calc(50% - ".concat(this._gap/2,"px)"),this.col3="1 1 calc(33.3333% - ".concat(this._gap/1.5,"px)"),this.billPeriods=[{label:"Select",value:0}],this.paymentModes=[{label:"Select",value:0}],this.banks=[{label:"Select",value:0}],this.tenants=[],this.billSettlement={},this.finalBill={},this.billPayment={},this.manageParams={},this.selectedRows=[],this.advanceAmount=0,this.openingBalanceAmount=0,this.outStandingAmount=0,this.advanceAdjusted=0,this.isAdjustWithAdvance=!1,this.bankId=0,this.remarks="",this.paymentModeId=0,this.payments=[],this.refNumber="",this.paymentAmount=0,this.tenantId=0,this.showSpinner=!1,this.isPrintDisable=!0,this.searchByTenant={label:"Search By Tenant",value:1},this.searchByUnit={label:"Search By Unit",value:2},this.searchByAccountNumber={label:"Search By Account Number",value:3},this.options=[this.searchByTenant,this.searchByUnit,this.searchByAccountNumber],this.isData=!1,this.settlementDate="",this.dateFormat="",this.currencyFormat="",this.roundOffFormat="",this.filePath="",this.filePath=h.backendForFiles,this.dateFormat=null!==(b=Object(y.e)("DateFormat"))&&void 0!==b?b:h.dateFormat,this.currencyFormat=null!==(f=Object(y.e)("Currency"))&&void 0!==f?f:h.currencyFormat,this.roundOffFormat=null!==(p=Object(y.e)("RoundOff"))&&void 0!==p?p:h.roundOffFormat}return o(e,[{key:"ngOnInit",value:function(){var e=this;this.clientSelectionService.setIsClientVisible(!0),this.clientId=parseInt(this.cookieService.get("globalClientId")),this.getBillPeriods();var t="";this.route.queryParams.subscribe((function(i){if(i.id&&i.unit&&i.settlement_date){t=i.id;var n=i.unit;e.settlementDate=i.settlement_date,e.manageParams={unitNumber:n,tenantId:i.id,billPeriodId:"0",settlementDate:i.settlement_date,billType:y.a.FinalBill,clientId:e.clientId},e.onGetBillSettlementDetails(e.manageParams)}})),this.onGetTenants(t)}},{key:"onGetTenants",value:function(e){var t=this;this.billSettlementService.getTenantsDetails(this.clientId).subscribe((function(i){t.tenants=i,t.tenants&&e&&(t.tenantId=parseInt(e))}))}},{key:"onGetPaymentModes",value:function(){var e=this;this.paymentModes=[{label:"Select",value:0}],this.billSettlementService.getPaymentModes().subscribe((function(t){t.forEach((function(t){e.paymentModes.push({label:t.description,value:t.id})}))}))}},{key:"onGetBanks",value:function(e){var t=this;this.banks=[{label:"Select",value:0}],this.billSettlementService.getBanks(e).subscribe((function(e){e.forEach((function(e){t.banks.push({label:e.description,value:e.id})}))}))}},{key:"getBillPeriods",value:function(){var e=this;this.billPeriods=[{label:"Select",value:0,fromDate:Date.now.toString(),ToDate:Date.now.toString()}],this.billService.getBillPeriods(this.clientId).subscribe((function(t){t.forEach((function(t){e.billPeriods.push({label:t.periodDescription,value:t.id,fromDate:t.periodStart,toDate:t.periodEnd})}))}))}},{key:"onGetBillSettlementDetails",value:function(e){var t=this;this.showSpinner=!0,this.manageParams=e,this.isPrintDisable=!0,this.onGetPaymentModes(),this.onGetBanks(e),this.billSettlementService.getBillSettlementDetails(e).subscribe({next:function(e){t.showSpinner=!1,t.billSettlement=e,t.isData=!(!e.outstandingBills||!e.outstandingBills.length)},error:function(e){t.showSpinner=!1}})}},{key:"onGetOutStandingBillDetails",value:function(e){var t=this;this.isData=!1,this.manageParams=e,this.billSettlementService.getOutStandingBillDetails(e).subscribe((function(e){t.billSettlement=e,t.isData=!(!e.outstandingBills||!e.outstandingBills.length)}))}},{key:"onSaveUnbilledConsumption",value:function(e){var t=this,i=this.billSettlement.unbBilledConsumptions;i&&i.length&&i.forEach((function(e){return e.isApproved=!0})),this.billSettlementService.saveUnBilledConsumptions(i).subscribe({next:function(e){e?(t.notificationMessage("Bill saved successfully","green-snackbar"),t.unbilledConsumptionComponent.unBilledConsumptions=[],t.onGetOutStandingBillDetails(t.manageParams)):t.notificationMessage("Bill save failed","red-snackbar")},error:function(e){t.notificationMessage("Bill save failed","red-snackbar")}})}},{key:"onSaveBillPayment",value:function(e){var t=this,i=this.billSettlement.outstandingBills;i&&i.length&&(this.onGetValues(),this.updateBillPayments(),this.updatePaymentTransactions(),this.billSettlementService.saveBillPayments(this.billPayment).subscribe({next:function(e){e?(t.reset(),t.onGetPaymentDetail(e),t.notificationMessage("Bill payment saved successfully","green-snackbar")):t.notificationMessage("Bill payment save failed","red-snackbar")},error:function(e){t.notificationMessage("Bill payment save failed","red-snackbar")}}))}},{key:"onGetPaymentDetail",value:function(e){var t=this;this.payments=[],this.isPrintDisable=!0;var i=Number(this.cookieService.get("globalClientId"));this.dateFormat=Object(y.e)("DateFormat"),this.roundOffFormat=Object(y.e)("RoundOff"),this.currencyFormat=Object(y.e)("Currency"),this.billService.getPaymentDetail(e,i).subscribe((function(i){i.forEach((function(e){e.paymentDateLocal=t.date.transform(e.paymentDate.toString(),t.dateFormat.toString()),e.referenceDateLocal=t.date.transform(e.referenceDate.toString(),t.dateFormat.toString()),e.paymentAmountLocal=t.currency.transform(e.paymentAmount,t.currencyFormat.toString(),!0,t.roundOffFormat),e.advanceAmountLocal=t.currency.transform(e.advanceAmount,t.currencyFormat.toString(),!0,t.roundOffFormat),e.billMasters.forEach((function(e){e.billDateLocal=t.date.transform(e.billDate.toString(),t.dateFormat.toString()),e.billAmountLocal=t.currency.transform(e.billAmount,t.currencyFormat.toString(),!0,t.roundOffFormat),e.fromDateLocal=t.date.transform(e.fromDate.toString(),t.dateFormat.toString()),e.toDateLocal=t.date.transform(e.toDate.toString(),t.dateFormat.toString()),e.dueDateLocal=t.date.transform(e.dueDate.toString(),t.dateFormat.toString()),e.paidLocal=t.currency.transform(e.paid.toString(),t.currencyFormat.toString(),!0,t.roundOffFormat)}))})),t.payments=i,t.isPrintDisable=!1,t.getClientAlertSettings(e)}))}},{key:"getClientAlertSettings",value:function(e){var t=this;this.templatesService.getClientAlertSettings(this.clientId).subscribe({next:function(e){if(e){var i=e.filter((function(e){return e.notificationCategory&&e.notificationCategory.toLowerCase()==="Payments".toLowerCase()&&e.condition&&e.condition.toLowerCase()=="After Payment Made".toLowerCase()&&1==e.isEnableAutoSend}));i&&(t.reset(),t.notificationMessage("Bill payment saved successfully","green-snackbar"),i.forEach((function(e){t.onSendReceipt(e.notificationType)})))}else t.reset(),t.notificationMessage("Bill payment saved successfully","green-snackbar"),t.notificationMessage("No notification found to send.","red-snackbar")},error:function(e){t.notificationMessage("Notifications send failed","red-snackbar")}})}},{key:"onSendReceipt",value:function(e){var t=this;this.billPayment?this.templateService.emailCustomTemplate({clientId:this.clientId,templateName:e,notificationType:e,payments:this.payments}).subscribe({next:function(e){e&&e.status?t.notificationMessage("Notifications send failed."+e.status,"red-snackbar"):e&&e.isSuccess?t.notificationMessage("Notifications send successfully.\nTotal Requests : "+(null==e?void 0:e.totalRequests)+"\nSuccessfull Requests : "+(null==e?void 0:e.successFullRequests)+"\nFailed Requests : "+(null==e?void 0:e.failedRequests),"green-snackbar"):t.notificationMessage("Notifications send failed.\nTotal Requests : "+(e?e.totalRequests:"0")+"\nSuccessfull Requests : "+(e?e.successFullRequests:"0")+"\nFailed Requests : "+(e?e.failedRequests:"0"),"red-snackbar")},error:function(e){t.notificationMessage("Notifications send failed.","red-snackbar")}}):this.notificationMessage("Notifications send failed.","red-snackbar")}},{key:"updatePaymentTransactions",value:function(){var e=this,t=[],i=[];t=this.billSettlement.outstandingBills;var n=0,l=0;if(this.openingBalanceAmount>0){if(this.isAdjustWithAdvance&&this.advanceAmount){var a=Number(this.advanceAmount)-Number(this.openingBalanceAmount);a>=0?(l=this.openingBalanceAmount,n=0,this.advanceAmount=a):(l=this.advanceAmount,n=this.openingBalanceAmount-this.advanceAmount,this.advanceAmount=0)}else{var o=Number(this.paymentAmount)-Number(this.openingBalanceAmount);o>=0?(n=this.openingBalanceAmount,l=0,this.paymentAmount=o):(n=this.paymentAmount,l=0,this.paymentAmount=0)}var r={billId:0,paidAmount:Number(n),advanceAmount:Number(l)};i.push(r)}t&&t.length&&t.forEach((function(t){if(e.isAdjustWithAdvance&&e.advanceAmount){var a=Number(e.advanceAmount)-Number(t.toPay);a>=0?(l=t.toPay,n=0,e.advanceAmount=a):(l=e.advanceAmount,n=Number(t.toPay)-Number(e.advanceAmount),e.advanceAmount=0)}else{var o=Number(e.paymentAmount)-Number(t.toPay);o>=0?(n=t.toPay,l=0,e.paymentAmount=o):(n=e.paymentAmount,l=0,e.paymentAmount=0)}var r={billId:t.id,paidAmount:Number(n),advanceAmount:Number(l)};i.push(r)})),this.billPayment.paymentTransactions=i}},{key:"onGetValues",value:function(){this.bankId=this.paymentDetailsComponent.bankId,this.remarks=this.paymentDetailsComponent.remarks,this.paymentModeId=this.paymentDetailsComponent.paymentModeId,this.paymentDate=new Date(this.paymentDetailsComponent.paymentDate),this.refNumber=this.paymentDetailsComponent.refNumber,this.paymentAmount=Number(this.billAmountDetailsComponent.toPay),this.isAdjustWithAdvance=this.billAmountDetailsComponent.isAdjustWithAdvance,this.advanceAmount=this.billAmountDetailsComponent.previousAdvanceAmount,this.openingBalanceAmount=this.billAmountDetailsComponent.billAmount,this.outStandingAmount=this.billAmountDetailsComponent.total,this.advanceAdjusted=this.billAmountDetailsComponent.advanceAdjusted}},{key:"updateBillPayments",value:function(){var e;this.billPayment={paymentDate:this.date.transform(this.paymentDate,"yyyy-MM-dd"),paymentAmount:Number(this.paymentAmount),billType:2,modeofPayment:this.paymentModeId,paymentReference:this.refNumber,bankId:this.bankId,remarks:this.remarks,outStandingAmount:Number(this.outStandingAmount)-Number(this.advanceAdjusted),clientId:Number(this.cookieService.get("globalClientId")),ownerId:null===(e=this.outstandingBillsComponent.outStandingBills[0])||void 0===e?void 0:e.ownerId}}},{key:"notificationMessage",value:function(e,t){this.snackbar.open(e,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[t]})}},{key:"reset",value:function(){this.bankId=this.paymentDetailsComponent.bankId=0,this.remarks=this.paymentDetailsComponent.remarks="",this.paymentModeId=this.paymentDetailsComponent.paymentModeId=0,this.paymentDate=new Date(Date.now.toString()),this.refNumber=this.paymentDetailsComponent.refNumber="",this.billAmountDetailsComponent.billAmount=0,this.billAmountDetailsComponent.total=0,this.paymentAmount=0,this.billAmountDetailsComponent.toPay="0",this.billSettlement={unbBilledConsumptions:[],outstandingBills:[]},this.isData=!1}},{key:"updateOutstandingBills",value:function(){var e=this;this.billSettlement.outstandingBills&&(this.finalBill={ownerId:this.billSettlement.outstandingBills[0].ownerId,unitId:this.billSettlement.outstandingBills[0].unitId,bankId:this.bankId,billDate:new Date,paymentDate:this.paymentDate,paymentAmount:this.paymentAmount,remarks:this.remarks,modeofPayment:this.paymentModeId,paymentReference:this.refNumber,finalBillTransactions:[]}),this.billAmountDetailsComponent.accountHeads&&this.billAmountDetailsComponent.accountHeads.forEach((function(t){e.finalBill.finalBillTransactions.push({billHeadId:t.id,headDisplay:t.accountHeadName,headAmount:t.fixedAmount})}))}},{key:"onSelectedRows",value:function(e){this.selectedRows=[],this.selectedRows=e}},{key:"downloadReport",value:function(e){var t=[],i=[],n="",l="",a=Array.from(new Set(e.billMasters.map((function(e){return e.billNumber})))),o=Array.from(new Set(e.billMasters.map((function(e){return e.unitNumber}))));a&&a.length&&a.forEach((function(e){n+=e+","})),o&&o.length&&o.forEach((function(e){l+=e+","})),i.push({label:"Receipt Number:",value:e.paymentNumber},{label:"Receipt Date:",value:e.paymentDateLocal},{label:"Account Number:",value:e.accountNumber},{label:"Invoice Number:",value:0===n.trim().indexOf(",")?n.trim().slice(1).slice(0,-1):n.trim().slice(0,-1)},{label:"Unit Number:",value:0===l.trim().indexOf(",")?l.trim().slice(1).slice(0,-1):l.trim().slice(0,-1)},{label:"Mode of payment:",value:e.paymentMode});var r=0;e.billMasters.forEach((function(e){r+=e.paid}));var s=r>e.outStandingAmount?0:e.outStandingAmount-r;t.push({label:"Total Outstanding Amount :",value:this.currency.transform(e.outStandingAmount,this.currencyFormat.toString(),!0,this.roundOffFormat)},{label:"Received Payments :",value:e.paymentAmountLocal},{label:"",value:""},{label:"Balance Outstanding :",value:this.currency.transform(s,this.currencyFormat.toString(),!0,this.roundOffFormat)}),this.getReport(e,t,i)}},{key:"addImage",value:function(e,t){var i;try{if(t&&t.billMasters&&t.billMasters.length&&t.billMasters[0]&&t.billMasters[0].client&&t.billMasters[0].client.imageProperties&&t.billMasters[0].client.imageProperties.length){var n=t.billMasters[0].client.imageProperties.find((function(e){return"receipt"===e.imageType.trim().toLowerCase()}));if(n){var l=new Image;l.src=this.filePath+"/uploads/"+(null===(i=null==t?void 0:t.billMasters[0].client)||void 0===i?void 0:i.photo),l.onload=function(){e.addImage(l,n.imgX,n.imgY,n.imgW,n.imgH)}}else this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar")}else this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar")}catch(a){this.notificationMessage("Image not found.","red-snackbar")}return e}},{key:"onPrintBillPayment",value:function(e){this.payments&&this.payments.length?this.receiptView(this.payments):this.notificationMessage("No data to print.","yellow-snackbar")}},{key:"receiptView",value:function(e){var t=this;this.billService.receiptView(e).subscribe({next:function(e){e?t.downloadFile(e):t.notificationMessage("No data to print","red-snackbar")},error:function(e){t.notificationMessage("No data to print","red-snackbar")}})}},{key:"downloadFile",value:function(e){return Object(h.a)(this,void 0,void 0,regeneratorRuntime.mark((function i(){var n,l,a,o,r,s,c,u;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,ee.PDFDocument.create();case 2:n=i.sent,l=t(e),i.prev=4,l.s();case 6:if((a=l.n()).done){i.next=16;break}return o=a.value,i.next=10,ee.PDFDocument.load(o);case 10:return r=i.sent,i.next=13,n.copyPages(r,r.getPageIndices());case 13:i.sent.forEach((function(e){n.addPage(e)}));case 14:i.next=6;break;case 16:i.next=21;break;case 18:i.prev=18,i.t0=i.catch(4),l.e(i.t0);case 21:return i.prev=21,l.f(),i.finish(21);case 24:return i.next=26,n.save();case 26:s=i.sent,c=new Blob([s],{type:"application/pdf"}),u=window.URL.createObjectURL(c),window.open(u);case 30:case"end":return i.stop()}}),i,null,[[4,18,21,24]])})))}},{key:"getReport",value:function(e,t,i){var n,l,a,o,r,s,c,u,d,m,h,b,f,p,g,v,C,S,T,P,D,w,N,x,k,A,F,R,I,O,W,M,L,B,z,U,E,j,H,Y,V,_,G,X,q,$,J=new Fe.default({orientation:"portrait",unit:"pt",format:"letter"}),Q=Object(y.f)(null===(l=null===(n=null==e?void 0:e.billMasters[0])||void 0===n?void 0:n.client)||void 0===l?void 0:l.website).split(".")[1];J.rect(5,5,J.internal.pageSize.width-10,J.internal.pageSize.height-10,"S"),J.setFontSize(30),this.addImage(J,e),J.setTextColor(0,0,0),J.setFontSize(14),J.setFont("Cambria","bold"),J.text("PAYMENT RECEIPT",260,30),J.setFont("Cambria","normal"),J.setFontSize(14),J.text(Object(y.f)(null===(o=null===(a=null==e?void 0:e.billMasters[0])||void 0===a?void 0:a.client)||void 0===o?void 0:o.clientName).toUpperCase(),10,50),J.setFontSize(10),J.text("TRN: "+Object(y.f)(null===(s=null===(r=null==e?void 0:e.billMasters[0])||void 0===r?void 0:r.client)||void 0===s?void 0:s.trnNo),10,60),J.text("PO Box "+Object(y.f)(null===(d=null===(u=null===(c=null==e?void 0:e.billMasters[0])||void 0===c?void 0:c.client)||void 0===u?void 0:u.addresses[0])||void 0===d?void 0:d.zipPostalCode),10,70),J.text(Object(y.f)(null===(b=null===(h=null===(m=null==e?void 0:e.billMasters[0])||void 0===m?void 0:m.client)||void 0===h?void 0:h.addresses[0])||void 0===b?void 0:b.location,",")+Object(y.f)(null===(g=null===(p=null===(f=null==e?void 0:e.billMasters[0])||void 0===f?void 0:f.client)||void 0===p?void 0:p.addresses[0])||void 0===g?void 0:g.city,",")+Object(y.f)(null===(S=null===(C=null===(v=null==e?void 0:e.billMasters[0])||void 0===v?void 0:v.client)||void 0===C?void 0:C.addresses[0])||void 0===S?void 0:S.country,","),10,80),J.text("Phone: "+Object(y.f)(null===(P=null===(T=null==e?void 0:e.billMasters[0])||void 0===T?void 0:T.client)||void 0===P?void 0:P.phoneNo),10,90),J.text("Email: "+Object(y.f)(null===(w=null===(D=null==e?void 0:e.billMasters[0])||void 0===D?void 0:D.client)||void 0===w?void 0:w.email),10,100),J.text("Web: "+Object(y.f)(null===(x=null===(N=null==e?void 0:e.billMasters[0])||void 0===N?void 0:N.client)||void 0===x?void 0:x.website),10,110),J.setFillColor(241,241,244),J.setDrawColor(206,203,203),J.rect(10,120,250,90,"FD"),J.setTextColor(0,0,0),J.setFontSize(12),J.text(Object(y.f)(null==e?void 0:e.tenantName).toUpperCase(),20,135),J.text("CUSTOMER TRN: "+Object(y.f)(null==e?void 0:e.trn),20,155),J.text("unit #"+Object(y.f)(null===(k=null==e?void 0:e.billMasters[0])||void 0===k?void 0:k.unitNumber),20,170),J.setFontSize(10),J.text(Object(y.f)(null===(A=null==e?void 0:e.billMasters[0])||void 0===A?void 0:A.clientName),20,185),J.text(Object(y.f)(null===(R=null===(F=null==e?void 0:e.billMasters[0].client)||void 0===F?void 0:F.addresses[0])||void 0===R?void 0:R.city,",")+Object(y.f)(null===(W=null===(O=null===(I=null==e?void 0:e.billMasters[0])||void 0===I?void 0:I.client)||void 0===O?void 0:O.addresses[0])||void 0===W?void 0:W.country,","),20,200),J.setFontSize(9),J.autoTable("",i,{startX:210,startY:120,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:400},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:100,halign:"right"}},didParseCell:function(e){var t=e.column.index;0!=t&&1!=t||(e.cell.styles.rowHeight=1)},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});var K=Number(this.decimalPipe.transform(J.autoTable.previous.finalY,"1.0-0"));J.setLineWidth(.1),J.line(5,K+10,607,K+10),J.setTextColor(0,0,0),J.setFontSize(10),J.text("Thank you for using "+Q+" payment services.",20,K+30),J.text("We confirm receipt of your payment.",20,K+40),J.text("Please see the below details for your reference.",20,K+50),J.setTextColor(0,0,0),J.autoTable("",t,{startX:300,startY:K+60,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:110},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:180,halign:"left"},1:{cellWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"}}),J.setTextColor(0,0,0);var Z=Number(this.decimalPipe.transform(J.autoTable.previous.finalY,"1.0-0"));J.setTextColor(255,0,0),J.setFontSize(9),J.text("Note: A Late Fee will be applied after the due date. A Default Payment \nPenalty will be added to any unit that is ".concat(null===(M=null==e?void 0:e.billMasters[0])||void 0===M?void 0:M.penaltyAfter," days or more in arrears."),320,Z+20),J.setTextColor(25,118,210),J.setFontSize(12),J.text("USAGE TIPS to reduce consumption:",10,Z+80),J.text("Please Try to:",10,Z+100),J.setTextColor(0,0,0),J.setFontSize(9),J.text("- Keep filters clean",30,Z+110),J.text("- Set thermostats between 23C and 25C",30,Z+120),J.text("- Keep vents unblocked",30,Z+130),J.text("- Keep doors and windows closed",30,Z+140),J.text("- Undertake regular maintenance of the system",30,Z+150),J.setTextColor(25,118,210),J.setFontSize(12),J.text("Please Do Not:",10,Z+170),J.setTextColor(0,0,0),J.setFontSize(9),J.text("- Set thermostats to 20C or lower",30,Z+180),J.text("- Block vents",30,Z+190),J.text("- Leave doors and windows open",30,Z+200),J.text("- Leave heat producing appliances near thermostats",30,Z+210),J.setFillColor(119,183,11);var ee=J.internal.pageSize.height||J.internal.pageSize.getHeight();J.rect(320,Z+60,280,ee-80-(Z+60),"FD"),J.setFont("Comic Sans"),J.setTextColor(255,255,255),J.setFontSize(16),J.text("ADVERTISE WITH US",360,Z+80);var te=J.getTextWidth("ADVERTISE WITH US");J.setLineWidth(.1),J.line(360,Z+85,360+te,Z+85),J.setFontSize(9),J.text("For advertisement, contact at",390,Z+95),J.text(Object(y.f)(null===(B=null===(L=null==e?void 0:e.billMasters[0])||void 0===L?void 0:L.client)||void 0===B?void 0:B.phoneNo),390,Z+105),J.text(Object(y.f)(null===(U=null===(z=null==e?void 0:e.billMasters[0])||void 0===z?void 0:z.client)||void 0===U?void 0:U.email),390,Z+115),J.text(Object(y.f)(null===(j=null===(E=null==e?void 0:e.billMasters[0])||void 0===E?void 0:E.client)||void 0===j?void 0:j.website),390,Z+125),J.setTextColor(0,0,0),J.setLineWidth(.1),J.line(5,ee-70,607,ee-70),J.text(null!==(X=null!==(V="For any enquiries, write to us "+(null===(Y=null===(H=null==e?void 0:e.billMasters[0])||void 0===H?void 0:H.client)||void 0===Y?void 0:Y.email))&&void 0!==V?V:"\n or Logon to "+(null===(G=null===(_=e.billMasters[0])||void 0===_?void 0:_.client)||void 0===G?void 0:G.website))&&void 0!==X?X:"",10,ee-60),J.setTextColor(255,0,0),J.setFont("bold");var ie=J.getTextWidth("Notice:");J.text("Notice:",340,ee-60),J.setFont("none"),J.setTextColor(0,0,0),J.text("Pay your bills before due date to avoid late payment surcharge",340+ie,ee-60),J.text("and disconnection.",340,ee-50),J.text("You can log onto "+(null===($=null===(q=null==e?void 0:e.billMasters[0])||void 0===q?void 0:q.client)||void 0===$?void 0:$.website)+" to pay your invoices \nTerms & Conditions for Supply of Utility Services",340,ee-40),"function"==typeof J.putTotalPages&&J.putTotalPages("1");var ne=J.output("blob");window.open(URL.createObjectURL(ne))}},{key:"invoiceView",value:function(e){var t=this;this.billService.invoicePreview(e).subscribe({next:function(e){e?t.downloadFile(e):t.notificationMessage("No data to print","red-snackbar")},error:function(e){t.notificationMessage("No data to print","red-snackbar")}})}}]),e}()).\u0275fac=function(e){return new(e||Ke)(g.Nb(M.a),g.Nb(B.b),g.Nb(b.a),g.Nb(d.f),g.Nb(w.a),g.Nb(d.d),g.Nb(ke.a),g.Nb(Ae.a),g.Nb(d.g),g.Nb(Z.a),g.Nb(m.a),g.Nb(C.a))},Ke.\u0275cmp=g.Hb({type:Ke,selectors:[["final-bill-settlement"]],viewQuery:function(e,t){var i;1&e&&(g.Jc(fe,!0),g.Jc(Ne,!0),g.Jc(W,!0),g.Jc(xe,!0)),2&e&&(g.zc(i=g.cc())&&(t.paymentDetailsComponent=i.first),g.zc(i=g.cc())&&(t.billAmountDetailsComponent=i.first),g.zc(i=g.cc())&&(t.unbilledConsumptionComponent=i.first),g.zc(i=g.cc())&&(t.outstandingBillsComponent=i.first))},decls:39,vars:31,consts:[["mode","card",2,"margin-top","20px"],["class","loading-indicator",4,"ngIf"],["fxLayout","column"],["color","primary",1,"position-fixed"],["src","assets/img/fav-icon.png",1,"img-style"],[1,"toolbar-spacer"],[3,"isPrintDisable","isDisabled","printClicked","saveClicked"],["fxFlex","noshrink","fxLayout","column","fxLayout.gt-sm","row","fxLayoutAlign.gt-sm","start stretch",3,"fxLayoutGap"],["fxFlex","grow",1,"basic-forms","route-animations-elements",3,"fxFlex.gt-sm"],["fxLayout","column",1,"result","padding-top"],[3,"tenants","billPeriods","settlementDate","selectedTenant","options","isHide","isVisible","searchClicked"],[1,"header"],["fxLayout","column",1,"result"],[3,"dataSource","printDataRows","saveClicked"],[3,"dataSource","rowsSelected"],[3,"banks","paymentModes"],[3,"dataSource","selectedRows","isDisable"],[1,"loading-indicator"],["mode","indeterminate","color","accent"]],template:function(e,t){1&e&&(g.Tb(0,"fury-page-layout",0),g.Pc(1,Qe,2,0,"div",1),g.Tb(2,"fury-page-layout-content",2),g.Tb(3,"mat-toolbar",3),g.Ob(4,"img",4),g.Tb(5,"span"),g.Rc(6,"Final Bill Settlement"),g.Sb(),g.Ob(7,"span",5),g.Tb(8,"app-final-bill-settlement-footer-toolbar",6),g.bc("printClicked",(function(e){return t.onPrintBillPayment(e)}))("saveClicked",(function(e){return t.onSaveBillPayment(e)})),g.Sb(),g.Sb(),g.Tb(9,"div",7),g.Tb(10,"fury-card",8),g.Tb(11,"fury-card-content",2),g.Tb(12,"div",9),g.Tb(13,"app-final-bill-settlement-toolbar",10),g.bc("searchClicked",(function(e){return t.onGetBillSettlementDetails(e)})),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Tb(14,"div",7),g.Tb(15,"fury-card",8),g.Tb(16,"fury-card-header",11),g.Tb(17,"fury-card-header-heading"),g.Rc(18,"Unbilled consumption"),g.Sb(),g.Sb(),g.Tb(19,"fury-card-content",2),g.Tb(20,"div",12),g.Tb(21,"app-unbilled-consumption",13),g.bc("printDataRows",(function(e){return t.invoiceView(e)}))("saveClicked",(function(e){return t.onSaveUnbilledConsumption(e)})),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Tb(22,"div",7),g.Tb(23,"fury-card",8),g.Tb(24,"fury-card-header",11),g.Tb(25,"fury-card-header-heading"),g.Rc(26,"Outstanding bills"),g.Sb(),g.Sb(),g.Tb(27,"fury-card-content",2),g.Tb(28,"div",12),g.Tb(29,"app-outstanding-bills",14),g.bc("rowsSelected",(function(e){return t.onSelectedRows(e)})),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Tb(30,"div",7),g.Tb(31,"fury-card",8),g.Tb(32,"fury-card-content",2),g.Tb(33,"div",12),g.Ob(34,"app-payment-details",15),g.Sb(),g.Sb(),g.Sb(),g.Tb(35,"fury-card",8),g.Tb(36,"fury-card-content",2),g.Tb(37,"div",12),g.Ob(38,"app-bill-amount-details",16),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb()),2&e&&(g.Cb(1),g.mc("ngIf",t.showSpinner),g.Cb(7),g.mc("isPrintDisable",t.isPrintDisable)("isDisabled",!t.isData),g.Cb(1),g.mc("fxLayoutGap",t.gap),g.Cb(1),g.mc("fxFlex.gt-sm",t.col2)("@fadeInUp",void 0),g.Cb(3),g.mc("tenants",t.tenants)("billPeriods",t.billPeriods)("settlementDate",t.settlementDate)("selectedTenant",t.tenantId)("options",t.options)("isHide",!1)("isVisible",!1),g.Cb(1),g.mc("fxLayoutGap",t.gap),g.Cb(1),g.mc("fxFlex.gt-sm",t.col2)("@fadeInUp",void 0),g.Cb(6),g.mc("dataSource",t.billSettlement),g.Cb(1),g.mc("fxLayoutGap",t.gap),g.Cb(1),g.mc("fxFlex.gt-sm",t.col2)("@fadeInUp",void 0),g.Cb(6),g.mc("dataSource",t.billSettlement),g.Cb(1),g.mc("fxLayoutGap",t.gap),g.Cb(1),g.mc("fxFlex.gt-sm",t.col2)("@fadeInUp",void 0),g.Cb(3),g.mc("banks",t.banks)("paymentModes",t.paymentModes),g.Cb(1),g.mc("fxFlex.gt-sm",t.col2)("@fadeInUp",void 0),g.Cb(3),g.mc("dataSource",t.billSettlement)("selectedRows",t.selectedRows)("isDisable",!0))},directives:[te.a,d.o,ie.a,N.d,ne.a,Re,N.b,N.c,N.e,S.a,S.c,Je,S.d,S.g,W,xe,fe,Ne,ae.a],styles:['.toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.header[_ngcontent-%COMP%]{color:#1976d2}.img-style[_ngcontent-%COMP%]{width:32px}.position-fixed[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;top:0;z-index:5}.loading-indicator[_ngcontent-%COMP%]{position:fixed;z-index:999;height:2em;width:2em;overflow:show;margin:auto;top:0;left:0;bottom:0;right:0}.loading-indicator[_ngcontent-%COMP%]:before{content:"";display:block;position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.3)}'],data:{animation:[p.a,f.a]}}),Ke);a("DaQG");var et,tt,it=((et=function(){function e(t,i,n,a,o,r,s,c,u,d,m){l(this,e),this.billSettlementService=t,this.billService=i,this.snackbar=n,this.decimalPipe=a,this.date=o,this.currency=r,this.cookieService=s,this.templateService=c,this.clientSelectionService=u,this.templatesService=d,this.envService=m,this._gap=12,this.gap=this._gap+"px",this.col2="1 1 calc(76% - ".concat(this._gap/2,"px)"),this.col3="1 1 calc(24% - ".concat(this._gap/1,"px)"),this.billPeriods=[{label:"Select",value:0}],this.billSettlement={outstandingBills:[]},this.paymentModes=[{label:"Select",value:0}],this.banks=[{label:"Select",value:0}],this.tenants=[],this.manageParams={},this.billPayment={},this.selectedRows=[],this.paymentId=0,this.bankId=0,this.remarks="",this.paymentModeId=0,this.paymentDate=new Date,this.refNumber="",this.paymentAmount=0,this.excessAmount=0,this.advanceAmount=0,this.openingBalanceAmount=0,this.outStandingAmount=0,this.advanceAdjusted=0,this.isAdjustWithAdvance=!1,this.payments=[],this.dateFormat=Object(y.e)("DateFormat"),this.currencyFormat=Object(y.e)("Currency"),this.roundOffFormat=Object(y.e)("RoundOff"),this.filePath="",this.labelName="",this.isData=!1,this.isValid=!1,this.isValidPayment=!1,this.isPrintDisable=!0,this.isAutoSelect=!1,this.disableCheckBox=!0,this.searchByTenant={label:"Search By Tenant",value:1},this.searchByUnit={label:"Search By Unit",value:2},this.searchByAccountNumber={label:"Search By Account Number",value:3},this.options=[this.searchByTenant,this.searchByUnit,this.searchByAccountNumber],this.filePath=m.backendForFiles}return o(e,[{key:"ngOnInit",value:function(){this.clientSelectionService.setIsClientVisible(!0),this.clientId=parseInt(this.cookieService.get("globalClientId")),this.onGetTenants()}},{key:"onGetTenants",value:function(){var e=this;this.billSettlementService.getTenantsDetails(this.clientId).subscribe((function(t){e.tenants=t}))}},{key:"onGetPaymentModes",value:function(){var e=this;this.paymentModes=[{label:"Select",value:0}],this.billSettlementService.getPaymentModes().subscribe((function(t){t.forEach((function(t){e.paymentModes.push({label:t.description,value:t.id})}))}))}},{key:"getBillPeriods",value:function(){var e=this;this.billPeriods=[{label:"Select",value:0,fromDate:Date.now.toString(),ToDate:Date.now.toString()}],this.billService.getBillPeriods(this.clientId).subscribe((function(t){t.forEach((function(t){e.billPeriods.push({label:t.periodDescription,value:t.id,fromDate:t.periodStart,toDate:t.periodEnd})}))}))}},{key:"onGetBanks",value:function(e){var t=this;this.banks=[{label:"Select",value:0}],this.billSettlementService.getBanks(e).subscribe((function(e){e.forEach((function(e){t.banks.push({label:e.description,value:e.id})}))}))}},{key:"onGetBillDetails",value:function(e){var t=this;this.isAutoSelect=!1,this.disableCheckBox=!1,this.manageParams=e,this.manageParams.billType=1,this.onGetPaymentModes(),this.onGetBanks(e),this.billSettlement={},this.isPrintDisable=!0,e.clientId=this.clientId,this.billSettlementService.getOutStandingBillDetails(e).subscribe((function(e){t.billSettlement=e,t.isAutoSelect=!0,t.disableCheckBox=!0}))}},{key:"onSaveBillPayment",value:function(e){var t=this;this.onGetValues(),this.updateBillPayments(),this.updatePaymentTransactions(),this.billSettlementService.saveBillPayments(this.billPayment).subscribe({next:function(e){e?"Excess Amount"===t.labelName&&t.excessAmount>0&&0!==e?t.saveAdvancePaymentDetails(e):t.onGetPaymentDetail(e):t.notificationMessage("Bill payment save failed","red-snackbar")},error:function(e){t.notificationMessage("Bill payment save failed","red-snackbar")}})}},{key:"getClientAlertSettings",value:function(e){var t=this;this.templatesService.getClientAlertSettings(this.clientId).subscribe({next:function(e){if(e){var i=e.filter((function(e){return e.notificationCategory&&e.notificationCategory.toLowerCase()==="Payments".toLowerCase()&&e.condition&&e.condition.toLowerCase()=="After Payment Made".toLowerCase()&&1==e.isEnableAutoSend}));i&&(t.reset(),t.notificationMessage("Bill payment saved successfully","green-snackbar"),i.forEach((function(e){t.onSendReceipt(e.notificationType)})))}else t.reset(),t.notificationMessage("Bill payment saved successfully","green-snackbar"),t.notificationMessage("No notification found to send.","red-snackbar")},error:function(e){t.notificationMessage("Notifications send failed","red-snackbar")}})}},{key:"onSendReceipt",value:function(e){var t=this;this.billPayment?this.templateService.emailCustomTemplate({clientId:this.clientId,templateName:e,notificationType:e,payments:this.payments}).subscribe({next:function(e){e&&e.status?t.notificationMessage("Notifications send failed."+e.status,"red-snackbar"):e&&e.isSuccess?t.notificationMessage("Notifications send successfully.\nTotal Requests : "+(null==e?void 0:e.totalRequests)+"\nSuccessfull Requests : "+(null==e?void 0:e.successFullRequests)+"\nFailed Requests : "+(null==e?void 0:e.failedRequests),"green-snackbar"):t.notificationMessage("Notifications send failed.\nTotal Requests : "+(e?e.totalRequests:"0")+"\nSuccessfull Requests : "+(e?e.successFullRequests:"0")+"\nFailed Requests : "+(e?e.failedRequests:"0"),"red-snackbar")},error:function(e){t.notificationMessage("Notifications send failed.","red-snackbar")}}):this.notificationMessage("Notifications send failed.","red-snackbar")}},{key:"updatePaymentTransactions",value:function(){var e=this,t=[],i=[];if(t=this.outstandingBillsComponent.selectedRows,this.openingBalanceAmount>0){var n=0,l=0;if(this.advanceAdjusted>0&&0==this.paymentAmount){var a=Number(this.advanceAdjusted)-Number(this.openingBalanceAmount);a>=0?(l=this.openingBalanceAmount,n=0,this.advanceAdjusted=a):(l=this.advanceAdjusted,n=0,this.advanceAmount=0)}else if(this.advanceAdjusted>0&&this.paymentAmount>0){var o=Number(this.advanceAdjusted)-Number(this.openingBalanceAmount);o>=0?(l=this.openingBalanceAmount,n=0,this.advanceAdjusted=o):Number(this.advanceAdjusted)+Number(this.paymentAmount)-Number(this.openingBalanceAmount)>=0?(l=this.advanceAdjusted,n=Number(this.openingBalanceAmount)-Number(this.advanceAdjusted),this.advanceAdjusted=0,this.paymentAmount=Number(this.paymentAmount)-Number(n)):(l=this.advanceAdjusted,n=this.paymentAmount,this.advanceAmount=0,this.paymentAmount=0)}else if(0==this.advanceAdjusted&&this.paymentAmount>0){var r=Number(this.paymentAmount)-Number(this.openingBalanceAmount);r>=0?(n=this.openingBalanceAmount,l=0,this.paymentAmount=r):(n=this.paymentAmount,l=0,this.paymentAmount=0)}if(n>0||l>0){var s={billId:0,paidAmount:Number(n),advanceAmount:Number(l)};i.push(s),n=0,l=0}}if(t&&t.length>0){var c=0,u=0;t.forEach((function(t){if(e.advanceAdjusted>0&&0==e.paymentAmount){var n=Number(e.advanceAdjusted)-Number(t.toPay);n>=0?(u=t.toPay,c=0,e.advanceAdjusted=n):(u=e.advanceAdjusted,c=0,e.advanceAmount=0)}else if(e.advanceAdjusted>0&&e.paymentAmount>0){var l=Number(e.advanceAdjusted)-Number(t.toPay);l>=0?(u=t.toPay,c=0,e.advanceAdjusted=l):Number(e.advanceAdjusted)+Number(e.paymentAmount)-Number(t.toPay)>=0?(u=e.advanceAdjusted,c=Number(t.toPay)-Number(e.advanceAdjusted),e.advanceAdjusted=0,e.paymentAmount=Number(e.paymentAmount)-Number(c)):(u=e.advanceAdjusted,c=e.paymentAmount,e.advanceAmount=0,e.paymentAmount=0)}else if(0==e.advanceAdjusted&&e.paymentAmount>0){var a=Number(e.paymentAmount)-Number(t.toPay);a>=0?(c=t.toPay,u=0,e.paymentAmount=a):(c=e.paymentAmount,u=0,e.paymentAmount=0)}if(c>0||u>0){var o={billId:t.id,paidAmount:Number(c),advanceAmount:Number(u)};i.push(o),c=0,u=0}}))}if("Excess Amount"===this.labelName&&this.excessAmount>0){var d={billId:0,paidAmount:Number(this.excessAmount),advanceAmount:0,isAdvanceAmount:!0};i.push(d)}this.billPayment.paymentTransactions=i}},{key:"onGetValues",value:function(){this.bankId=this.paymentDetailsComponent.bankId,this.remarks=this.paymentDetailsComponent.remarks,this.paymentModeId=this.paymentDetailsComponent.paymentModeId,this.paymentDate=new Date(this.paymentDetailsComponent.paymentDate),this.refNumber=this.paymentDetailsComponent.refNumber,this.paymentAmount=Number(this.billAmountDetailsComponent.toPay),this.excessAmount=Number(0==this.billAmountDetailsComponent.excessAmount?0:this.billAmountDetailsComponent.excessAmount),this.labelName=this.billAmountDetailsComponent.labelName,this.isAdjustWithAdvance=this.billAmountDetailsComponent.isAdjustWithAdvance,this.advanceAmount=this.billAmountDetailsComponent.previousAdvanceAmount,this.openingBalanceAmount=this.billAmountDetailsComponent.billAmount,this.outStandingAmount=this.billAmountDetailsComponent.total,this.advanceAdjusted=this.billAmountDetailsComponent.advanceAdjusted}},{key:"updateBillPayments",value:function(){var e;e=this.outstandingBillsComponent&&this.outstandingBillsComponent.selectedRows&&this.outstandingBillsComponent.selectedRows.length?this.outstandingBillsComponent.selectedRows[0].ownerId:Number(this.manageParams.tenantId),this.billPayment={paymentDate:this.date.transform(this.paymentDate,"yyyy-MM-dd"),paymentAmount:Number(this.paymentAmount),clientId:Number(this.cookieService.get("globalClientId")),billType:1,ownerId:e,modeofPayment:this.paymentModeId,paymentReference:this.refNumber,bankId:this.bankId,remarks:this.remarks,outStandingAmount:Number(this.outStandingAmount)-Number(this.advanceAdjusted)}}},{key:"notificationMessage",value:function(e,t){this.snackbar.open(e,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[t]})}},{key:"onSelectedRows",value:function(e){this.isData=!1,this.selectedRows=[],this.selectedRows=e,this.selectedRows&&this.selectedRows.length&&(this.isData=!0)}},{key:"saveAdvancePaymentDetails",value:function(e){var t,i=this;t=this.outstandingBillsComponent&&this.outstandingBillsComponent.selectedRows&&this.outstandingBillsComponent.selectedRows.length?this.outstandingBillsComponent.selectedRows[0].ownerId:Number(this.manageParams.tenantId);var n={advanceDate:this.paymentDate,paymentId:e,ownerId:t,advanceAmount:Number(this.excessAmount)};this.billService.saveAdvancePayment(n).subscribe({next:function(t){t?i.onGetPaymentDetail(e):i.notificationMessage("Bill payment save failed","red-snackbar")},error:function(e){i.notificationMessage("Bill payment save failed","red-snackbar")}})}},{key:"reset",value:function(){this.bankId=this.paymentDetailsComponent.bankId=0,this.remarks=this.paymentDetailsComponent.remarks="",this.paymentModeId=this.paymentDetailsComponent.paymentModeId=0,this.paymentDate=new Date(Date.now.toString()),this.refNumber=this.paymentDetailsComponent.refNumber="",this.billAmountDetailsComponent.billAmount=0,this.billAmountDetailsComponent.total=0,this.paymentAmount=0,this.billAmountDetailsComponent.toPay="0",this.excessAmount=this.billAmountDetailsComponent.excessAmount=0,this.advanceAdjusted=this.billAmountDetailsComponent.advanceAdjusted=0,this.billSettlement={outstandingBills:[]},this.outstandingBillsComponent.selectedRows=[],this.isData=!1,this.isValid=!1}},{key:"onPrintBillPayment",value:function(e){this.payments&&this.payments.length?this.receiptView(this.payments):this.notificationMessage("No data to print","yellow-snackbar")}},{key:"receiptView",value:function(e){var t=this;this.billService.receiptView(e).subscribe({next:function(e){e?t.downloadPdfFile(e):t.notificationMessage("No data to print","red-snackbar")},error:function(e){t.notificationMessage("No data to print","red-snackbar")}})}},{key:"downloadPdfFile",value:function(e){var t=this;e&&e.forEach((function(i){var n=t.base64ToArrayBuffer(e),l=new Blob([n],{type:"application/pdf"}),a=window.URL.createObjectURL(l);window.open(a)}))}},{key:"base64ToArrayBuffer",value:function(e){for(var t=window.atob(e),i=t.length,n=new Uint8Array(i),l=0;l<i;l++)n[l]=t.charCodeAt(l);return n.buffer}},{key:"onGetPaymentDetail",value:function(e){var t=this;this.payments=[],this.isPrintDisable=!0;var i=Number(this.cookieService.get("globalClientId"));this.billService.getPaymentDetail(e,i).subscribe({next:function(i){i.forEach((function(e){e.paymentDateLocal=t.date.transform(e.paymentDate.toString(),t.dateFormat.toString()),e.referenceDateLocal=t.date.transform(e.referenceDate.toString(),t.dateFormat.toString()),e.paymentAmountLocal=t.currency.transform(e.paymentAmount,t.currencyFormat.toString(),!0,t.roundOffFormat),e.advanceAmountLocal=t.currency.transform(e.advanceAmount,t.currencyFormat.toString(),!0,t.roundOffFormat),e.billMasters&&e.billMasters.length&&e.billMasters.forEach((function(e){var i,n,l,a,o;e.billDateLocal=t.date.transform(null===(i=null==e?void 0:e.billDate)||void 0===i?void 0:i.toString(),t.dateFormat.toString()),e.billAmountLocal=t.currency.transform(null==e?void 0:e.billAmount,t.currencyFormat.toString(),!0,t.roundOffFormat),e.fromDateLocal=t.date.transform(null===(n=null==e?void 0:e.fromDate)||void 0===n?void 0:n.toString(),t.dateFormat.toString()),e.toDateLocal=t.date.transform(null===(l=null==e?void 0:e.toDate)||void 0===l?void 0:l.toString(),t.dateFormat.toString()),e.dueDateLocal=t.date.transform(null===(a=null==e?void 0:e.dueDate)||void 0===a?void 0:a.toString(),t.dateFormat.toString()),e.paidLocal=t.currency.transform(null===(o=null==e?void 0:e.paid)||void 0===o?void 0:o.toString(),t.currencyFormat.toString(),!0,t.roundOffFormat)}))})),t.payments=i,t.isPrintDisable=!1,t.getClientAlertSettings(e)},error:function(){t.isPrintDisable=!0}})}},{key:"downloadReport",value:function(e){var t=[],i=[],n="",l="",a=Array.from(new Set(e.billMasters.map((function(e){return e.billNumber})))),o=Array.from(new Set(e.billMasters.map((function(e){return e.unitNumber}))));a&&a.length&&a.forEach((function(e){n+=e+","})),o&&o.length&&o.forEach((function(e){l+=e+","})),i.push({label:"Receipt Number:",value:e.paymentNumber},{label:"Receipt Date:",value:e.paymentDateLocal},{label:"Account Number:",value:e.accountNumber},{label:"Invoice Number:",value:0===n.trim().indexOf(",")?n.trim().slice(1).slice(0,-1):n.trim().slice(0,-1)},{label:"Unit Number:",value:0===l.trim().indexOf(",")?l.trim().slice(1).slice(0,-1):l.trim().slice(0,-1)},{label:"Mode of payment:",value:e.paymentMode});var r=0;e.billMasters.forEach((function(e){r+=e.paid}));var s=e.outStandingAmount-r;t.push({label:"Total Outstanding Amount :",value:this.currency.transform(e.outStandingAmount,this.currencyFormat.toString(),!0,this.roundOffFormat)},{label:"Received Payments :",value:e.paymentAmountLocal},{label:"",value:""},{label:"Balance Outstanding :",value:this.currency.transform(s,this.currencyFormat.toString(),!0,this.roundOffFormat)}),this.getReport(e,t,i)}},{key:"addImage",value:function(e,t){var i;try{if(t&&t.billMasters&&t.billMasters.length&&t.billMasters[0]&&t.billMasters[0].client&&t.billMasters[0].client.imageProperties&&t.billMasters[0].client.imageProperties.length){var n=t.billMasters[0].client.imageProperties.find((function(e){return"receipt"===e.imageType.trim().toLowerCase()}));if(n){var l=new Image;l.src=this.filePath+"/uploads/"+(null===(i=null==t?void 0:t.billMasters[0].client)||void 0===i?void 0:i.photo),l.onload=function(){e.addImage(l,n.imgX,n.imgY,n.imgW,n.imgH)}}else this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar")}else this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar")}catch(a){this.notificationMessage("Image not found.","red-snackbar")}return e}},{key:"getReport",value:function(e,t,i){var n,l,a,o,r,s,c,u,d,m,h,b,f,p,g,v,C,S,T,P,D,w,N,x,k,A,F,R,I,O,W,M,L,B,z,U,E,j,H,Y,V,_,G,X,q,$,J=new Fe.default({orientation:"portrait",unit:"pt",format:"letter"}),Q=Object(y.f)(null===(l=null===(n=null==e?void 0:e.billMasters[0])||void 0===n?void 0:n.client)||void 0===l?void 0:l.website).split(".")[1];J.rect(5,5,J.internal.pageSize.width-10,J.internal.pageSize.height-10,"S"),J.setFontSize(30),this.addImage(J,e),J.setTextColor(0,0,0),J.setFontSize(14),J.setFont("Cambria","bold"),J.text("PAYMENT RECEIPT",260,30),J.setFont("Cambria","normal"),J.setFontSize(14),J.text(Object(y.f)(null===(o=null===(a=null==e?void 0:e.billMasters[0])||void 0===a?void 0:a.client)||void 0===o?void 0:o.clientName).toUpperCase(),10,50),J.setFontSize(10),J.text("TRN: "+Object(y.f)(null===(s=null===(r=null==e?void 0:e.billMasters[0])||void 0===r?void 0:r.client)||void 0===s?void 0:s.trnNo),10,60),J.text("PO Box "+Object(y.f)(null===(d=null===(u=null===(c=null==e?void 0:e.billMasters[0])||void 0===c?void 0:c.client)||void 0===u?void 0:u.addresses[0])||void 0===d?void 0:d.zipPostalCode),10,70),J.text(Object(y.f)(null===(b=null===(h=null===(m=null==e?void 0:e.billMasters[0])||void 0===m?void 0:m.client)||void 0===h?void 0:h.addresses[0])||void 0===b?void 0:b.location,",")+Object(y.f)(null===(g=null===(p=null===(f=null==e?void 0:e.billMasters[0])||void 0===f?void 0:f.client)||void 0===p?void 0:p.addresses[0])||void 0===g?void 0:g.city,",")+Object(y.f)(null===(S=null===(C=null===(v=null==e?void 0:e.billMasters[0])||void 0===v?void 0:v.client)||void 0===C?void 0:C.addresses[0])||void 0===S?void 0:S.country,","),10,80),J.text("Phone: "+Object(y.f)(null===(P=null===(T=null==e?void 0:e.billMasters[0])||void 0===T?void 0:T.client)||void 0===P?void 0:P.phoneNo),10,90),J.text("Email: "+Object(y.f)(null===(w=null===(D=null==e?void 0:e.billMasters[0])||void 0===D?void 0:D.client)||void 0===w?void 0:w.email),10,100),J.text("Web: "+Object(y.f)(null===(x=null===(N=null==e?void 0:e.billMasters[0])||void 0===N?void 0:N.client)||void 0===x?void 0:x.website),10,110),J.setFillColor(241,241,244),J.setDrawColor(206,203,203),J.rect(10,120,250,90,"FD"),J.setTextColor(0,0,0),J.setFontSize(12),J.text(Object(y.f)(null==e?void 0:e.tenantName).toUpperCase(),20,135),J.text("CUSTOMER TRN: "+Object(y.f)(null==e?void 0:e.trn),20,155),J.text("unit #"+Object(y.f)(null===(k=null==e?void 0:e.billMasters[0])||void 0===k?void 0:k.unitNumber),20,170),J.setFontSize(10),J.text(Object(y.f)(null===(A=null==e?void 0:e.billMasters[0])||void 0===A?void 0:A.clientName),20,185),J.text(Object(y.f)(null===(R=null===(F=null==e?void 0:e.billMasters[0].client)||void 0===F?void 0:F.addresses[0])||void 0===R?void 0:R.city,",")+Object(y.f)(null===(W=null===(O=null===(I=null==e?void 0:e.billMasters[0])||void 0===I?void 0:I.client)||void 0===O?void 0:O.addresses[0])||void 0===W?void 0:W.country,","),20,200),J.setFontSize(9),J.autoTable("",i,{startX:210,startY:120,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:400},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:100,halign:"right"}},didParseCell:function(e){var t=e.column.index;0!=t&&1!=t||(e.cell.styles.rowHeight=1)},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});var K=Number(this.decimalPipe.transform(J.autoTable.previous.finalY,"1.0-0"));J.setLineWidth(.1),J.line(5,K+10,607,K+10),J.setTextColor(0,0,0),J.setFontSize(10),J.text("Thank you for using "+Q+" payment services.",20,K+30),J.text("We confirm receipt of your payment.",20,K+40),J.text("Please see the below details for your reference.",20,K+50),J.setTextColor(0,0,0),J.autoTable("",t,{startX:300,startY:K+60,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:110},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:180,halign:"left"},1:{cellWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"}}),J.setTextColor(0,0,0);var Z=Number(this.decimalPipe.transform(J.autoTable.previous.finalY,"1.0-0"));J.setTextColor(255,0,0),J.setFontSize(9),J.text("Note: A Late Fee will be applied after the due date. A Default Payment \nPenalty will be added to any unit that is ".concat(null===(M=null==e?void 0:e.billMasters[0])||void 0===M?void 0:M.penaltyAfter," days or more in arrears."),320,Z+20),J.setTextColor(25,118,210),J.setFontSize(12),J.text("USAGE TIPS to reduce consumption:",10,Z+80),J.text("Please Try to:",10,Z+100),J.setTextColor(0,0,0),J.setFontSize(9),J.text("- Keep filters clean",30,Z+110),J.text("- Set thermostats between 23C and 25C",30,Z+120),J.text("- Keep vents unblocked",30,Z+130),J.text("- Keep doors and windows closed",30,Z+140),J.text("- Undertake regular maintenance of the system",30,Z+150),J.setTextColor(25,118,210),J.setFontSize(12),J.text("Please Do Not:",10,Z+170),J.setTextColor(0,0,0),J.setFontSize(9),J.text("- Set thermostats to 20C or lower",30,Z+180),J.text("- Block vents",30,Z+190),J.text("- Leave doors and windows open",30,Z+200),J.text("- Leave heat producing appliances near thermostats",30,Z+210),J.setFillColor(119,183,11);var ee=J.internal.pageSize.height||J.internal.pageSize.getHeight();J.rect(320,Z+60,280,ee-80-(Z+60),"FD"),J.setFont("Comic Sans"),J.setTextColor(255,255,255),J.setFontSize(16),J.text("ADVERTISE WITH US",360,Z+80);var te=J.getTextWidth("ADVERTISE WITH US");J.setLineWidth(.1),J.line(360,Z+85,360+te,Z+85),J.setFontSize(9),J.text("For advertisement, contact at",390,Z+95),J.text(Object(y.f)(null===(B=null===(L=null==e?void 0:e.billMasters[0])||void 0===L?void 0:L.client)||void 0===B?void 0:B.phoneNo),390,Z+105),J.text(Object(y.f)(null===(U=null===(z=null==e?void 0:e.billMasters[0])||void 0===z?void 0:z.client)||void 0===U?void 0:U.email),390,Z+115),J.text(Object(y.f)(null===(j=null===(E=null==e?void 0:e.billMasters[0])||void 0===E?void 0:E.client)||void 0===j?void 0:j.website),390,Z+125),J.setTextColor(0,0,0),J.setLineWidth(.1),J.line(5,ee-70,607,ee-70),J.text(null!==(X=null!==(V="For any enquiries, write to us "+(null===(Y=null===(H=null==e?void 0:e.billMasters[0])||void 0===H?void 0:H.client)||void 0===Y?void 0:Y.email))&&void 0!==V?V:"\n or Logon to "+(null===(G=null===(_=e.billMasters[0])||void 0===_?void 0:_.client)||void 0===G?void 0:G.website))&&void 0!==X?X:"",10,ee-60),J.setTextColor(255,0,0),J.setFont("bold");var ie=J.getTextWidth("Notice:");J.text("Notice:",340,ee-60),J.setFont("none"),J.setTextColor(0,0,0),J.text("Pay your bills before due date to avoid late payment surcharge",340+ie,ee-60),J.text("and disconnection.",340,ee-50),J.text("You can log onto "+(null===($=null===(q=null==e?void 0:e.billMasters[0])||void 0===q?void 0:q.client)||void 0===$?void 0:$.website)+" to pay your invoices \nTerms & Conditions for Supply of Utility Services",340,ee-40),"function"==typeof J.putTotalPages&&J.putTotalPages("1");var ne=J.output("blob");window.open(URL.createObjectURL(ne))}},{key:"onValidation",value:function(e){this.isValid=e}},{key:"onValidatePayment",value:function(e){this.isValidPayment=e}}]),e}()).\u0275fac=function(e){return new(e||et)(g.Nb(M.a),g.Nb(b.a),g.Nb(B.b),g.Nb(d.g),g.Nb(d.f),g.Nb(d.d),g.Nb(w.a),g.Nb(Ae.a),g.Nb(Z.a),g.Nb(ke.a),g.Nb(C.a))},et.\u0275cmp=g.Hb({type:et,selectors:[["app-create-bill-payment"]],viewQuery:function(e,t){var i;1&e&&(g.Jc(fe,!0),g.Jc(xe,!0),g.Jc(Ne,!0)),2&e&&(g.zc(i=g.cc())&&(t.paymentDetailsComponent=i.first),g.zc(i=g.cc())&&(t.outstandingBillsComponent=i.first),g.zc(i=g.cc())&&(t.billAmountDetailsComponent=i.first))},decls:35,vars:25,consts:[["mode","card",2,"margin-top","20px"],["fxLayout","column"],["color","primary",1,"position-fixed"],["src","assets/img/fav-icon.png",1,"img-style"],[1,"toolbar-spacer"],[3,"isDisabled","isPrintDisable","saveClicked","printClicked"],["fxFlex","noshrink","fxLayout","column","fxLayout.gt-sm","row","fxLayoutAlign.gt-sm","start stretch",3,"fxLayoutGap"],["fxFlex","grow",1,"basic-forms","route-animations-elements",3,"fxFlex.gt-sm"],["fxLayout","column",1,"result","padding-top"],[3,"tenants","options","isHide","isVisible","saveClicked","searchClicked"],["fxFlex","noshrink","fxLayout","column","fxLayout.gt-sm","row","fxLayoutAlign.gt-sm","start stretch",1,"padding-top",3,"fxLayoutGap"],["fxLayout","column",1,"result"],[3,"isAutoSelect","dataSource","disableCheckBox","isHide","rowsSelected"],[3,"banks","paymentModes","isShowValidation","validate"],[3,"dataSource","selectedRows","isHide","isValidPayment"]],template:function(e,t){1&e&&(g.Tb(0,"fury-page-layout",0),g.Tb(1,"fury-page-layout-content",1),g.Tb(2,"mat-toolbar",2),g.Ob(3,"img",3),g.Tb(4,"span"),g.Rc(5,"Bill Payment"),g.Sb(),g.Ob(6,"span",4),g.Tb(7,"app-final-bill-settlement-footer-toolbar",5),g.bc("saveClicked",(function(e){return t.onSaveBillPayment(e)}))("printClicked",(function(e){return t.onPrintBillPayment(e)})),g.Sb(),g.Sb(),g.Tb(8,"div",6),g.Tb(9,"fury-card",7),g.Tb(10,"fury-card-content",1),g.Tb(11,"div",8),g.Tb(12,"app-final-bill-settlement-toolbar",9),g.bc("saveClicked",(function(e){return t.onSaveBillPayment(e)}))("searchClicked",(function(e){return t.onGetBillDetails(e)})),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Tb(13,"div",10),g.Tb(14,"fury-card",7),g.Tb(15,"fury-card-header"),g.Tb(16,"fury-card-header-heading"),g.Rc(17,"Outstanding Bills"),g.Sb(),g.Sb(),g.Tb(18,"fury-card-content",1),g.Tb(19,"div",11),g.Tb(20,"app-outstanding-bills",12),g.bc("rowsSelected",(function(e){return t.onSelectedRows(e)})),g.Sb(),g.Sb(),g.Sb(),g.Tb(21,"fury-card-header"),g.Tb(22,"fury-card-header-heading"),g.Rc(23,"Payment Details"),g.Sb(),g.Sb(),g.Tb(24,"fury-card-content",1),g.Tb(25,"div",11),g.Tb(26,"app-payment-details",13),g.bc("validate",(function(e){return t.onValidation(e)})),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Tb(27,"fury-card",7),g.Tb(28,"fury-card-header"),g.Tb(29,"fury-card-header-heading"),g.Rc(30,"Bill Amount Details"),g.Sb(),g.Sb(),g.Tb(31,"fury-card-content",1),g.Tb(32,"div",11),g.Tb(33,"app-bill-amount-details",14),g.bc("isValidPayment",(function(e){return t.onValidatePayment(e)})),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Ob(34,"div",10),g.Sb(),g.Sb()),2&e&&(g.Cb(7),g.mc("isDisabled",!(t.isValid&&t.isData&&t.isValidPayment||t.isValid&&t.isValidPayment))("isPrintDisable",t.isPrintDisable),g.Cb(1),g.mc("fxLayoutGap",t.gap),g.Cb(1),g.mc("fxFlex.gt-sm",t.col2)("@fadeInUp",void 0),g.Cb(3),g.mc("tenants",t.tenants)("options",t.options)("isHide",!0)("isVisible",!1),g.Cb(1),g.mc("fxLayoutGap",t.gap),g.Cb(1),g.mc("fxFlex.gt-sm",t.col2)("@fadeInUp",void 0),g.Cb(6),g.mc("isAutoSelect",t.isAutoSelect)("dataSource",t.billSettlement)("disableCheckBox",t.disableCheckBox)("isHide",!1),g.Cb(6),g.mc("banks",t.banks)("paymentModes",t.paymentModes)("isShowValidation",t.isData),g.Cb(1),g.mc("fxFlex.gt-sm",t.col3)("@fadeInUp",void 0),g.Cb(6),g.mc("dataSource",t.billSettlement)("selectedRows",t.selectedRows)("isHide",!0),g.Cb(1),g.mc("fxLayoutGap",t.gap))},directives:[te.a,ie.a,N.d,ne.a,Re,N.b,N.c,N.e,S.a,S.c,Je,S.d,S.g,xe,fe,Ne],styles:[".toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.img-style[_ngcontent-%COMP%]{width:32px}.position-fixed[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;top:0;z-index:5}"],data:{animation:[p.a,f.a]}}),et),nt=a("MutI"),lt=((tt=function(){function e(t,i,n,a,o,r){l(this,e),this.data=t,this.dialogRef=i,this.billService=n,this.billSettlementService=a,this.fb=o,this.snackbar=r,this.formHeading="",this.buttonName="CANCEL BILL",this.buttonName="Cancel"===this.data.type?"CANCEL BILL":"REJECT BILL"}return o(e,[{key:"ngOnInit",value:function(){this.formHeading=this.data.type+" Bill",this.form=this.fb.group({remarks:[this.data.remarks||""]})}},{key:"cancelBillHistory",value:function(e){var t=this;this.data.cancelRemarks=this.form.get("remarks").value,this.data&&this.data.paid>0?this.notificationMessage("Already payment has done against this invoice.So cancel the payment first before continue","yellow-snackbar"):(this.billService.cancelBillHistory(e).subscribe({next:function(e){e?t.notificationMessage("Invoice cancelled successfully","green-snackbar"):t.notificationMessage("Invoice cancel failed","red-snackbar")},error:function(e){t.notificationMessage("Invoice cancel failed","red-snackbar")}}),this.dialogRef.close())}},{key:"rejectBillMaster",value:function(e){var t=this;e.rejectedRemarks=this.form.get("remarks").value,this.billSettlementService.updatBillMasterRejectedStatus([e]).subscribe({next:function(e){e?t.notificationMessage("Invoice rejected successfully","green-snackbar"):t.notificationMessage("Invoice reject failed","red-snackbar")},error:function(e){t.notificationMessage("Invoice reject failed","red-snackbar")}}),this.dialogRef.close()}},{key:"notificationMessage",value:function(e,t){this.snackbar.open(e,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[t]})}},{key:"save",value:function(){"Cancel"===this.data.type?this.cancelBillHistory(this.data):this.rejectBillMaster(this.data)}},{key:"close",value:function(){this.dialogRef.close()}}]),e}()).\u0275fac=function(e){return new(e||tt)(g.Nb(v.a),g.Nb(v.h),g.Nb(b.a),g.Nb(M.a),g.Nb(s.f),g.Nb(B.b))},tt.\u0275cmp=g.Hb({type:tt,selectors:[["fury-bill-cancel"]],decls:20,vars:8,consts:[["mat-dialog-title",""],["role","toolbar",1,"task-header"],[1,"fx-spacer"],["mat-icon-button","",3,"click"],["mat-list-icon",""],[3,"formGroup","ngSubmit"],[1,"person"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","12px"],["fxFlex",""],["formControlName","remarks","matInput",""],[3,"ctrl"],["fxLayout","row","fxLayoutAlign","end center"],["mat-button",""]],template:function(e,t){1&e&&(g.Tb(0,"h4",0),g.Tb(1,"mat-toolbar",1),g.Tb(2,"span"),g.Rc(3),g.Sb(),g.Ob(4,"span",2),g.Tb(5,"button",3),g.bc("click",(function(){return t.close()})),g.Tb(6,"mat-icon",4),g.Rc(7,"close"),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Tb(8,"form",5),g.bc("ngSubmit",(function(){return t.save()})),g.Tb(9,"mat-dialog-content"),g.Tb(10,"div",6),g.Tb(11,"div",7),g.Tb(12,"mat-form-field",8),g.Tb(13,"mat-label"),g.Rc(14,"Remarks"),g.Sb(),g.Ob(15,"textarea",9),g.Ob(16,"app-show-errors",10),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Tb(17,"mat-dialog-actions",11),g.Tb(18,"button",12),g.Rc(19),g.Sb(),g.Sb(),g.Sb()),2&e&&(g.Cb(3),g.Sc(t.formHeading),g.Cb(5),g.mc("formGroup",t.form),g.Cb(4),g.Mc("width",327,"px")("height",100,"px"),g.Cb(4),g.mc("ctrl",t.form.get("remarks")),g.Cb(3),g.Sc(t.buttonName))},directives:[v.i,ne.a,k.a,F.a,nt.c,s.z,s.r,s.k,v.f,N.d,N.e,z.d,N.b,z.h,s.c,E.b,s.q,s.i,v.c,N.c],styles:[".task-header[_ngcontent-%COMP%]{background-color:transparent;padding:0 5px;height:20px}.fx-spacer[_ngcontent-%COMP%]{flex:1 1 auto}"]}),tt),at=a("zSPf"),ot=["allTenantsSelected"],rt=["tenantSelect"];function st(e,t){1&e&&(g.Tb(0,"small"),g.Rc(1,"To date should be greater than or equal to From date."),g.Sb())}function ct(e,t){if(1&e){var i=g.Ub();g.Tb(0,"mat-form-field",15),g.Tb(1,"mat-label"),g.Rc(2,"Unit Number"),g.Sb(),g.Tb(3,"input",16),g.bc("ngModelChange",(function(e){return g.Ec(i),g.fc(2).unitNumber=e})),g.Sb(),g.Sb()}if(2&e){var n=g.fc(2);g.Cb(3),g.mc("ngModel",n.unitNumber)}}function ut(e,t){if(1&e&&(g.Tb(0,"mat-option",19),g.Rc(1),g.Sb()),2&e){var i=t.$implicit;g.mc("value",i.value),g.Cb(1),g.Tc("",i.label," ")}}function dt(e,t){if(1&e){var i=g.Ub();g.Tb(0,"mat-form-field",15),g.Tb(1,"mat-label"),g.Rc(2,"Bill Period"),g.Sb(),g.Tb(3,"mat-select",17),g.bc("selectionChange",(function(e){return g.Ec(i),g.fc(2).onChangeBillPeriod(e.value)}))("valueChange",(function(e){return g.Ec(i),g.fc(2).billPeriodId=e})),g.Pc(4,ut,2,2,"mat-option",18),g.Sb(),g.Tb(5,"mat-hint"),g.Rc(6,"Please select a Bill period"),g.Sb(),g.Sb()}if(2&e){var n=g.fc(2);g.Cb(3),g.mc("value",n.billPeriodId),g.Cb(1),g.mc("ngForOf",n.billPeriods)}}function mt(e,t){if(1&e){var i=g.Ub();g.Tb(0,"mat-option",24),g.bc("click",(function(){g.Ec(i),g.fc();var e=g.Ac(9);return g.fc(2).toggleTenantsPerOne(e.viewValue)})),g.Rc(1),g.Sb()}if(2&e){var n=t.$implicit;g.mc("value",n.id),g.Cb(1),g.Tc(" ",n.ownerName," ")}}function ht(e,t){if(1&e){var i=g.Ub();g.Tb(0,"mat-form-field",15),g.Tb(1,"mat-label"),g.Rc(2,"Tenant Name"),g.Sb(),g.Tb(3,"mat-select",20,21),g.bc("ngModelChange",(function(e){return g.Ec(i),g.fc(2).selectedTenants=e})),g.Tb(5,"input",22,23),g.bc("keydown",(function(e){return g.Ec(i),g.fc(2).handleInput(e)}))("keyup",(function(e){return g.Ec(i),g.fc(2).searchTenants(e.target.value)})),g.Sb(),g.Ob(7,"mat-divider"),g.Tb(8,"mat-option",24,25),g.bc("click",(function(){return g.Ec(i),g.fc(2).toggleTenantsAllSelection()})),g.Rc(10,"Select All"),g.Sb(),g.Pc(11,mt,2,2,"mat-option",26),g.Sb(),g.Sb()}if(2&e){var n=g.fc(2);g.Cb(3),g.mc("ngModel",n.selectedTenants),g.Cb(5),g.mc("value",0),g.Cb(3),g.mc("ngForOf",n.filteredTenants)}}function bt(e,t){if(1&e&&(g.Tb(0,"mat-option",19),g.Rc(1),g.Sb()),2&e){var i=t.$implicit;g.mc("value",i.value),g.Cb(1),g.Tc("",i.label," ")}}function ft(e,t){if(1&e){var i=g.Ub();g.Tb(0,"mat-form-field",4),g.Tb(1,"mat-label"),g.Rc(2,"Bill Type"),g.Sb(),g.Tb(3,"mat-select",27),g.bc("selectionChange",(function(e){return g.Ec(i),g.fc(2).onChangeBillType(e.value)}))("valueChange",(function(e){return g.Ec(i),g.fc(2).billTypeId=e})),g.Pc(4,bt,2,2,"mat-option",18),g.Sb(),g.Tb(5,"mat-hint"),g.Rc(6,"Please select a Bill Type"),g.Sb(),g.Sb()}if(2&e){var n=g.fc(2);g.Cb(3),g.mc("value",n.billTypeId),g.Cb(1),g.mc("ngForOf",n.billTypes)}}function pt(e,t){if(1&e&&(g.Tb(0,"mat-option",19),g.Rc(1),g.Sb()),2&e){var i=t.$implicit;g.mc("value",i.value),g.Cb(1),g.Tc("",i.label," ")}}function gt(e,t){if(1&e){var i=g.Ub();g.Tb(0,"mat-form-field",4),g.Tb(1,"mat-label"),g.Rc(2,"Bill Status Type"),g.Sb(),g.Tb(3,"mat-select",28),g.bc("selectionChange",(function(e){return g.Ec(i),g.fc(2).onChangeBillFeeType(e.value)}))("valueChange",(function(e){return g.Ec(i),g.fc(2).billFeeTypeId=e})),g.Pc(4,pt,2,2,"mat-option",18),g.Sb(),g.Tb(5,"mat-hint"),g.Rc(6,"Please select a Bill Status Type"),g.Sb(),g.Sb()}if(2&e){var n=g.fc(2);g.Cb(3),g.mc("value",n.billFeeTypeId),g.Cb(1),g.mc("ngForOf",n.billFeeTypes)}}function vt(e,t){if(1&e){var i=g.Ub();g.Tb(0,"div",1),g.Tb(1,"mat-form-field",4),g.Tb(2,"mat-label"),g.Rc(3,"From Date"),g.Sb(),g.Tb(4,"input",5),g.bc("click",(function(){return g.Ec(i),g.Ac(7).open()}))("ngModelChange",(function(e){return g.Ec(i),g.fc().fromDate=e}))("ngModelChange",(function(){return g.Ec(i),g.fc().validateFromDateAndToDate()}))("focus",(function(){return g.Ec(i),g.Ac(7).open()})),g.Sb(),g.Ob(5,"mat-datepicker-toggle",6),g.Ob(6,"mat-datepicker",null,7),g.Sb(),g.Tb(8,"mat-form-field",4),g.Tb(9,"mat-label"),g.Rc(10,"To Date"),g.Sb(),g.Tb(11,"input",8),g.bc("click",(function(){return g.Ec(i),g.Ac(14).open()}))("ngModelChange",(function(e){return g.Ec(i),g.fc().toDate=e}))("ngModelChange",(function(){return g.Ec(i),g.fc().validateFromDateAndToDate()}))("focus",(function(){return g.Ec(i),g.Ac(14).open()})),g.Sb(),g.Ob(12,"mat-datepicker-toggle",6),g.Ob(13,"mat-datepicker",null,9),g.Pc(15,st,2,0,"small",10),g.Sb(),g.Pc(16,ct,4,1,"mat-form-field",11),g.Pc(17,dt,7,2,"mat-form-field",11),g.Pc(18,ht,12,3,"mat-form-field",11),g.Pc(19,ft,7,2,"mat-form-field",12),g.Pc(20,gt,7,2,"mat-form-field",12),g.Tb(21,"div",13),g.Tb(22,"button",14),g.bc("click",(function(){return g.Ec(i),g.fc().onSearch()})),g.Tb(23,"mat-icon"),g.Rc(24,"search"),g.Sb(),g.Sb(),g.Sb(),g.Sb()}if(2&e){var n=g.Ac(7),l=g.Ac(14),a=g.fc();g.Cb(4),g.mc("ngModel",a.fromDate)("matDatepicker",n),g.Cb(1),g.mc("for",n),g.Cb(6),g.mc("ngModel",a.toDate)("matDatepicker",l),g.Cb(1),g.mc("for",l),g.Cb(3),g.mc("ngIf",!a.isValidDate),g.Cb(1),g.mc("ngIf",a.isHide),g.Cb(1),g.mc("ngIf","External"!=a.role),g.Cb(1),g.mc("ngIf","External"!=a.role&&1==a.isTenantVisible),g.Cb(1),g.mc("ngIf","External"!=a.role&&!a.isRejectedBills),g.Cb(1),g.mc("ngIf","External"!=a.role&&!a.isApproveBills&&!a.isRejectedBills)}}function yt(e,t){if(1&e&&(g.Tb(0,"mat-option",19),g.Rc(1),g.Sb()),2&e){var i=t.$implicit;g.mc("value",i.description),g.Cb(1),g.Tc("",i.description," ")}}function Ct(e,t){if(1&e){var i=g.Ub();g.Tb(0,"mat-form-field",4),g.Tb(1,"mat-label"),g.Rc(2,"Months"),g.Sb(),g.Tb(3,"mat-select",31),g.bc("selectionChange",(function(e){return g.Ec(i),g.fc(2).onChangeMonths(e.value)}))("valueChange",(function(e){return g.Ec(i),g.fc(2).monthSelected=e})),g.Pc(4,yt,2,2,"mat-option",18),g.Sb(),g.Tb(5,"mat-hint"),g.Rc(6,"Please select Months"),g.Sb(),g.Sb()}if(2&e){var n=g.fc(2);g.Cb(3),g.mc("value",n.monthSelected),g.Cb(1),g.mc("ngForOf",n.lstMonths)}}function St(e,t){if(1&e){var i=g.Ub();g.Tb(0,"div",29),g.Pc(1,Ct,7,2,"mat-form-field",12),g.Tb(2,"div",13),g.Tb(3,"button",30),g.bc("click",(function(){return g.Ec(i),g.fc().onSearch()})),g.Rc(4,"Search"),g.Sb(),g.Sb(),g.Sb()}if(2&e){var n=g.fc();g.Cb(1),g.mc("ngIf",n.ownerId>0&&!n.isApproveBills&&!n.isRejectedBills)}}var Tt,Pt=((Tt=function(){function e(t,i,n,a,o){l(this,e),this.snackbar=t,this.date=i,this.masterService=n,this.jwtHelperService=a,this.cookieService=o,this.isValidDate=!0,this.billPeriods=[],this.billFeeTypes=[],this.billTypes=[],this.isHide=!0,this.isApproveBills=!1,this.isRejectedBills=!1,this.isTenantVisible=!1,this.selectedTenants=[],this.filteredTenants=[],this.data=[],this.searchClicked=new g.o,this.billFeeTypeChanged=new g.o,this.manageParams={},this.tenantId=0,this.fromDate="",this.toDate="",this.unitNumber="",this.billPeriodId=0,this.billFeeTypeId=0,this.billFeeType="",this.billTypeId=0,this.billType="",this.role="",this.ownerId=0,this.lstMonths=[],this.monthSelected="3 Months"}return o(e,[{key:"ngOnInit",value:function(){var e=this,t=this.cookieService.get("access_token"),i=this.jwtHelperService.decodeToken(t);i&&(this.role=i["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"]);var n=this.cookieService.get("ownerId");this.ownerId=parseInt(n||"0"),this.ownerId>0&&this.masterService.getSystemMasterdata(81,0).subscribe((function(t){t&&t.length>0&&(e.lstMonths=t,e.monthSelected=e.lstMonths[0].description),e.onSearch()}))}},{key:"getDates",value:function(){if(""!=this.monthSelected){var e=this.monthSelected.substr(0,this.monthSelected.indexOf(" ")),t=new Date,i=new Date;i.setMonth(i.getMonth()-parseInt(e)+1),i.setDate(1),this.fromDate=i.toString(),this.toDate=t.toString()}}},{key:"onSearch",value:function(){this.ownerId>0&&this.getDates(),this.fromDate&&this.toDate||this.billPeriodId||this.ownerId>0?(this.manageParams={fromDate:""+(""==this.fromDate?"":L(this.fromDate).format("YYYY-MM-DD")),toDate:""+(""==this.toDate?"":L(this.toDate).format("YYYY-MM-DD")),billPeriodId:""+this.billPeriodId,billFeeType:this.billFeeType,billType:this.billTypeId,tenantId:"External"!=this.role&&this.selectedTenants&&this.selectedTenants.length>0?this.selectedTenants.join(","):this.ownerId.toString()},this.searchClicked.emit(this.manageParams)):this.snackbar.open("Invalid search parameters",null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:["yellow-snackbar"]})}},{key:"onChangeBillPeriod",value:function(e){this.billPeriodId=e}},{key:"onChangeBillFeeType",value:function(e){this.billFeeTypeId=e;var t=this.billFeeTypes.find((function(t){return t.value===e}));t&&(this.billFeeType=t.label),this.billFeeTypeChanged.emit(this.billFeeType)}},{key:"onChangeBillType",value:function(e){this.billTypeId=e;var t=this.billTypes.find((function(t){return t.value===e}));t&&(this.billType=t.label)}},{key:"selectTenant",value:function(e){var t=this;this.tenants.forEach((function(i){i.ownerName===e.option.value&&(t.tenantId=i.id)}))}},{key:"validateFromDateAndToDate",value:function(){if(this.fromDate&&this.toDate){var e=new Date(this.fromDate),t=new Date(this.toDate);this.isValidDate=Object(y.g)(e,t)}}},{key:"onChangeMonths",value:function(e){this.monthSelected=e}},{key:"toggleTenantsAllSelection",value:function(){this.selectedTenants=[],this.allTenantsSelected.selected?(this.selectedTenants=this.filteredTenants.map((function(e){return e.id})),this.select.options.forEach((function(e){return e.select()}))):(this.select.options.forEach((function(e){return e.deselect()})),this.selectedTenants=[])}},{key:"toggleTenantsPerOne",value:function(){if(this.allTenantsSelected.selected)return this.allTenantsSelected.deselect(),!1;this.data.length<=this.selectedTenants.length&&this.allTenantsSelected.select()}},{key:"searchTenants",value:function(e){var t=this.selectTenants(e.toLowerCase());this.filteredTenants=t}},{key:"selectTenants",value:function(e){var i=[];if(e){var n,l=t(this.data);try{for(l.s();!(n=l.n()).done;){var a=n.value;a.ownerName.toLowerCase().indexOf(e)>-1&&i.push(a)}}catch(o){l.e(o)}finally{l.f()}}else i=this.filteredTenants=this.data;return i}},{key:"handleInput",value:function(e){e.stopPropagation()}},{key:"tenants",get:function(){return this.data},set:function(e){this.filteredTenants=this.data=e}}]),e}()).\u0275fac=function(e){return new(e||Tt)(g.Nb(B.b),g.Nb(d.f),g.Nb(at.a),g.Nb(D.a),g.Nb(w.a))},Tt.\u0275cmp=g.Hb({type:Tt,selectors:[["app-bill-history-toolbar"]],viewQuery:function(e,t){var i;1&e&&(g.Vc(ot,!0),g.Vc(rt,!0)),2&e&&(g.zc(i=g.cc())&&(t.allTenantsSelected=i.first),g.zc(i=g.cc())&&(t.select=i.first))},inputs:{billPeriods:"billPeriods",billFeeTypes:"billFeeTypes",billTypes:"billTypes",isHide:"isHide",isApproveBills:"isApproveBills",isRejectedBills:"isRejectedBills",isTenantVisible:"isTenantVisible",tenants:"tenants"},outputs:{searchClicked:"searchClicked",billFeeTypeChanged:"billFeeTypeChanged"},decls:6,vars:2,consts:[[1,"person","padding-bottom"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","8px"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","8px",4,"ngIf"],["fxLayout","row","fxLayoutGap","15px","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","15px",4,"ngIf"],["color","primary",1,"result",2,"width","160px"],["id","fromDate","name","fromDate","matInput","","readonly","",3,"ngModel","matDatepicker","click","ngModelChange","focus"],["matSuffix","",3,"for"],["formDatepickerRef1",""],["id","toDate","name","toDate","matInput","","readonly","",3,"ngModel","matDatepicker","click","ngModelChange","focus"],["formDatepickerRef2",""],[4,"ngIf"],["class","result","color","primary",4,"ngIf"],["class","result","color","primary","style","width: 160px;",4,"ngIf"],[1,"fury-flex-form-field"],["mat-icon-button","",3,"click"],["color","primary",1,"result"],["type","text","id","unitNumber","name","unitNumber","matInput","",3,"ngModel","ngModelChange"],["id","billPeriod","name","billPeriod",3,"value","selectionChange","valueChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["multiple","","placeholder","Select a tenant","id","tenant","name","tenant",1,"multiSelectCustom",3,"ngModel","ngModelChange"],["tenantSelect",""],["matInput","","focused","'true'","type","text","autocomplete","off","placeholder","search",1,"myInput",3,"keydown","keyup"],["myInput",""],[3,"value","click"],["allTenantsSelected",""],[3,"value","click",4,"ngFor","ngForOf"],["id","billType","name","billType",3,"value","selectionChange","valueChange"],["id","billFeeType","name","billFeeType",3,"value","selectionChange","valueChange"],["fxLayout","row","fxLayoutGap","15px","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","15px"],["mat-button","",1,"buttonStyle",3,"click"],["id","months","name","months",3,"value","selectionChange","valueChange"]],template:function(e,t){1&e&&(g.Tb(0,"mat-dialog-content"),g.Tb(1,"div",0),g.Tb(2,"form"),g.Tb(3,"div",1),g.Pc(4,vt,25,12,"div",2),g.Sb(),g.Pc(5,St,5,1,"div",3),g.Sb(),g.Sb(),g.Sb()),2&e&&(g.Cb(4),g.mc("ngIf",0==t.ownerId),g.Cb(1),g.mc("ngIf",t.ownerId>0))},directives:[v.f,s.z,s.r,s.s,N.d,N.e,d.o,z.d,z.h,E.b,s.c,Y.b,s.q,s.t,Y.d,z.j,Y.a,k.a,F.a,U.a,d.n,z.g,H.n,j.a],styles:[".button[_ngcontent-%COMP%]{line-height:50px}small[_ngcontent-%COMP%]{color:red}.buttonStyle[_ngcontent-%COMP%]{background:#f5f5f5;margin-top:15px}.myInput[_ngcontent-%COMP%]{height:50px!important;padding:10px!important}"]}),Tt),Dt=a("Ytuj");function wt(e,t){if(1&e){var i=g.Ub();g.Tb(0,"div",3),g.Tb(1,"button",5),g.bc("click",(function(){return g.Ec(i),g.fc().onSendNotifications()})),g.Tb(2,"mat-icon"),g.Rc(3,"textsms"),g.Sb(),g.Sb(),g.Sb()}}function Nt(e,t){if(1&e){var i=g.Ub();g.Tb(0,"button",6),g.bc("click",(function(){return g.Ec(i),g.fc().onPrint()})),g.Tb(1,"mat-icon"),g.Rc(2,"print"),g.Sb(),g.Sb()}}function xt(e,t){if(1&e){var i=g.Ub();g.Tb(0,"div",3),g.Tb(1,"button",7),g.bc("click",(function(){return g.Ec(i),g.fc().onPrintSummary("Normal")})),g.Tb(2,"mat-icon"),g.Rc(3,"assignment"),g.Sb(),g.Sb(),g.Sb()}}function kt(e,t){if(1&e){var i=g.Ub();g.Tb(0,"div",3),g.Tb(1,"button",8),g.bc("click",(function(){return g.Ec(i),g.fc().onApprove()})),g.Tb(2,"mat-icon"),g.Rc(3,"verified_user"),g.Sb(),g.Sb(),g.Sb()}if(2&e){var n=g.fc();g.Cb(1),g.mc("disabled",!n.showAprrovedButton)}}function At(e,t){if(1&e){var i=g.Ub();g.Tb(0,"div",3),g.Tb(1,"button",9),g.bc("click",(function(){return g.Ec(i),g.fc().onRegenerate()})),g.Tb(2,"mat-icon"),g.Rc(3,"build"),g.Sb(),g.Sb(),g.Sb()}if(2&e){var n=g.fc();g.Cb(1),g.mc("disabled",n.disable)}}function Ft(e,t){if(1&e){var i=g.Ub();g.Tb(0,"div",3),g.Tb(1,"button",10),g.bc("click",(function(){return g.Ec(i),g.fc().onExcelExport()})),g.Tb(2,"mat-icon"),g.Rc(3,"import_export"),g.Sb(),g.Sb(),g.Sb()}}function Rt(e,t){if(1&e){var i=g.Ub();g.Tb(0,"div",3),g.Tb(1,"button",11),g.bc("click",(function(){return g.Ec(i),g.fc().onBillConsumptionExcelExport()})),g.Tb(2,"mat-icon"),g.Rc(3,"table_chart"),g.Sb(),g.Sb(),g.Sb()}}var It,Ot,Wt,Mt=((Wt=function(){function e(t,i){l(this,e),this.jwtHelperService=t,this.cookieService=i,this.role="",this.showAprrovedButton=!1,this.actions=[],this.ownerId=0,this.billFeeType="",this.isApproveBills=!1,this.isRejectedBills=!1,this.parameterValue=!1,this.sendInvoiceClicked=new g.o,this.printClicked=new g.o,this.sendNotificationsClicked=new g.o,this.printSummaryClicked=new g.o,this.approveClickedClicked=new g.o,this.regenerateClicked=new g.o,this.excelExportClicked=new g.o,this.billConsumptionExcelExportClicked=new g.o}return o(e,[{key:"ngOnInit",value:function(){var e=this.cookieService.get("access_token"),t=this.jwtHelperService.decodeToken(e);t&&(this.role=t["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"]),this.ownerId=parseInt(this.cookieService.get("ownerId"))}},{key:"onSendInvoice",value:function(e){this.sendInvoiceClicked.emit(e)}},{key:"onPrint",value:function(){this.printClicked.emit()}},{key:"onPrintSummary",value:function(e){this.printSummaryClicked.emit(e)}},{key:"onApprove",value:function(){this.approveClickedClicked.emit()}},{key:"onRegenerate",value:function(){this.regenerateClicked.emit()}},{key:"onSendNotifications",value:function(){this.sendNotificationsClicked.emit()}},{key:"onExcelExport",value:function(){this.excelExportClicked.emit()}},{key:"onBillConsumptionExcelExport",value:function(){this.billConsumptionExcelExportClicked.emit()}},{key:"userActions",get:function(){return this.actions},set:function(e){if(this.actions=e,this.actions&&this.actions.length){var t=this.actions.find((function(e){return"Bill Approval"===e.actionName}));this.showAprrovedButton=!!t}}}]),e}()).\u0275fac=function(e){return new(e||Wt)(g.Nb(D.a),g.Nb(w.a))},Wt.\u0275cmp=g.Hb({type:Wt,selectors:[["fury-bill-history-footer-toolbar"]],inputs:{disable:"disable",userActions:"userActions",isApproveBills:"isApproveBills",isRejectedBills:"isRejectedBills",parameterValue:"parameterValue"},outputs:{sendInvoiceClicked:"sendInvoiceClicked",printClicked:"printClicked",sendNotificationsClicked:"sendNotificationsClicked",printSummaryClicked:"printSummaryClicked",approveClickedClicked:"approveClickedClicked",regenerateClicked:"regenerateClicked",excelExportClicked:"excelExportClicked",billConsumptionExcelExportClicked:"billConsumptionExcelExportClicked"},decls:12,vars:7,consts:[[1,"person"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutAlign","end end","fxLayoutGap.gt-sm","24px"],["class","fury-flex-form-field",4,"ngIf"],[1,"fury-flex-form-field"],["matTooltip","Print","mat-icon-button","","class","example-icon",3,"click",4,"ngIf"],["matTooltip","Notifications","mat-icon-button","",1,"material-icons",3,"click"],["matTooltip","Print","mat-icon-button","",1,"example-icon",3,"click"],["matTooltip","Summary","mat-icon-button","",1,"material-icons",3,"click"],["matTooltip","Approve","mat-icon-button","",1,"material-icons",3,"disabled","click"],["matTooltip","Regenerate","mat-icon-button","",1,"material-icons",3,"disabled","click"],["matTooltip","Export","mat-icon-button","","aria-label","Example icon-button with menu icon",1,"example-icon",3,"click"],["matTooltip","Detailed Bill Summary","mat-icon-button","","aria-label","Example icon-button with menu icon",1,"example-icon",3,"click"]],template:function(e,t){1&e&&(g.Tb(0,"mat-dialog-content"),g.Tb(1,"div",0),g.Tb(2,"form"),g.Tb(3,"div",1),g.Pc(4,wt,4,0,"div",2),g.Tb(5,"div",3),g.Pc(6,Nt,3,0,"button",4),g.Sb(),g.Pc(7,xt,4,0,"div",2),g.Pc(8,kt,4,1,"div",2),g.Pc(9,At,4,1,"div",2),g.Pc(10,Ft,4,0,"div",2),g.Pc(11,Rt,4,0,"div",2),g.Sb(),g.Sb(),g.Sb(),g.Sb()),2&e&&(g.Cb(4),g.mc("ngIf",t.parameterValue&&0==t.ownerId&&!t.isApproveBills&&!t.isRejectedBills),g.Cb(2),g.mc("ngIf",0==t.ownerId),g.Cb(1),g.mc("ngIf",0==t.ownerId&&!t.isApproveBills&&!t.isRejectedBills),g.Cb(1),g.mc("ngIf",0==t.ownerId&&t.isApproveBills&&!t.isRejectedBills),g.Cb(1),g.mc("ngIf",0==t.ownerId&&!t.isApproveBills&&t.isRejectedBills),g.Cb(1),g.mc("ngIf",0==t.ownerId&&!t.isRejectedBills),g.Cb(1),g.mc("ngIf",0==t.ownerId&&!t.isRejectedBills))},directives:[v.f,s.z,s.r,s.s,N.d,N.c,N.e,d.o,k.a,A.a,F.a],styles:[".button[_ngcontent-%COMP%]{line-height:50px}"]}),Wt),Lt=((Ot=function(){function e(t,i,n,a,o,r,s,c){var u,d;l(this,e),this.data=t,this.dialogRef=i,this.currencyPipe=n,this.billSettlementService=a,this.snackbar=o,this.cookieService=r,this.decimalPipe=s,this.envService=c,this._gap=16,this.gap=this._gap+"px",this.col2="1 1 calc(50% - ".concat(this._gap/2,"px)"),this.col3="1 1 calc(33.3333% - ".concat(this._gap/1.5,"px)"),this.creditNoteTransactions=[],this.columns=[],this.identifierColumnName="#",this.accountHeadColumnName="Account Head",this.amountColumnName="Amount",this.creditNoteAmountColumnName="Credit Note Amount",this.accountHeadAmount="",this.creditNoteAmount="",this.viewMode="Edit",this.format="",this.currency="",this.roundFormat=Object(y.e)("RoundOff"),this.clientId=0,this.disableSave=!1,this.format=null!==(u=Object(y.e)("DateFormat"))&&void 0!==u?u:c.dateFormat,this.currency=null!==(d=Object(y.e)("Currency"))&&void 0!==d?d:c.currencyFormat}return o(e,[{key:"ngOnInit",value:function(){this.clientId=parseInt(this.cookieService.get("globalClientId")),this.createGridColumns(),this.onGetAccountHeads(this.data)}},{key:"createGridColumns",value:function(){this.columns=[{name:this.identifierColumnName,property:"rowNumber",visible:!0,isModelProperty:!0},{name:this.accountHeadColumnName,property:"headDisplay",visible:!0,isModelProperty:!0},{name:this.amountColumnName,property:"fixedAmountLocal",visible:!0,isModelProperty:!0,columnAlign:{"text-align":"right"}},{name:this.creditNoteAmountColumnName,property:"creditNoteAmountLocal",visible:!0,isModelProperty:!1,columnAlign:{"text-align":"right"}}],"View"===this.data.transactionMode&&(this.viewMode=this.data.transactionMode,this.columns.splice(-1,1),this.columns.push({name:this.creditNoteAmountColumnName,property:"creditNoteAmountLocal",visible:!0,isModelProperty:!0}))}},{key:"onGetAccountHeads",value:function(e){var t=this;this.creditNoteTransactions=e.creditNoteTransactions;var i=0,n=0;this.creditNoteTransactions.forEach((function(e){i+=Number(e.fixedAmount),n+=Number(e.creditNoteAmount),e.creditNoteAmountLocal=t.decimalPipe.transform(e.creditNoteAmount,t.roundFormat.toString()).replace(/,/g,""),e.fixedAmountLocal=t.currencyPipe.transform(e.fixedAmount,t.currency.toString(),!0,t.roundFormat.toString())})),this.accountHeadAmount=this.currencyPipe.transform(i,this.currency.toString(),!0,this.roundFormat),this.creditNoteAmount=this.currencyPipe.transform(n,this.currency.toString(),!0,this.roundFormat)}},{key:"onSave",value:function(){var e=this,t=this.tableStructureComponent.dataSource,i=0,n=[];if(t&&t.filteredData&&t.filteredData.length&&t.filteredData.forEach((function(e){if(Number(e.creditNoteAmountLocal.replace(/,/g,""))>0){var t={billHeadId:Number(e.billHeadId),headDisplay:e.headDisplay,creditNoteAmount:Number(e.creditNoteAmountLocal.replace(/,/g,"")),taxId:Number(e.taxId)};n.push(t)}i+=Number(e.creditNoteAmountLocal.replace(/,/g,""))})),!n||n.length){var l={clientId:this.clientId,ownerId:this.data.ownerId,billMasterId:Number(this.data.billMasterId),creditNoteAmount:Number(i),creditNoteTransactions:n};this.billSettlementService.saveCreditNote(l).subscribe({next:function(t){t?(e.dialogRef.close(!0),e.notificationMessage("Credit note saved successfully","green-snackbar")):e.notificationMessage("Credit note save failed","red-snackbar")},error:function(t){e.notificationMessage("Credit note save failed","red-snackbar")}})}else this.notificationMessage("Credit note save failed","red-snackbar")}},{key:"notificationMessage",value:function(e,t){this.snackbar.open(e,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[t]})}},{key:"onChangedRow",value:function(){var e=this;this.disableSave=!1;var t=0,i=this.tableStructureComponent.dataSource;if(i&&(i.filteredData.forEach((function(t){if(t.creditNoteAmountLocal&&t.fixedAmount&&Number(t.creditNoteAmountLocal)>t.fixedAmount)return e.notificationMessage("Credit note amount should be less than Head amount","yellow-snackbar"),void(e.disableSave=!0);""!==t.creditNoteAmountLocal&&""!==t.fixedAmount||(e.disableSave=!0)})),!this.disableSave)){var n=i.filteredData.filter((function(e){return e.disabled&&e.value>0}));n&&n.length&&n.forEach((function(t){t.creditNoteAmountLocal=e.decimalPipe.transform(0,e.roundFormat)})),i.filteredData.forEach((function(i){t+=Number(e.decimalPipe.transform(i.creditNoteAmountLocal.replace(",",""),e.roundFormat).replace(",","")),i.isVAT&&n&&n.length&&n.forEach((function(t){if("Percentage"===t.formulaFieldName){var n=Number(e.decimalPipe.transform(i.creditNoteAmountLocal.replace(",",""),e.roundFormat).replace(",",""))*Number(e.decimalPipe.transform(t.value,e.roundFormat).replace(",",""))/100;t.creditNoteAmount+=Number(e.decimalPipe.transform(n,e.roundFormat).replace(",",""))}t.creditNoteAmountLocal=e.decimalPipe.transform(t.creditNoteAmount,e.roundFormat)}))})),this.creditNoteAmount=this.currencyPipe.transform(t,this.currency.toString(),!0,this.roundFormat)}}}]),e}()).\u0275fac=function(e){return new(e||Ot)(g.Nb(v.a),g.Nb(v.h),g.Nb(d.d),g.Nb(M.a),g.Nb(B.b),g.Nb(w.a),g.Nb(d.g),g.Nb(C.a))},Ot.\u0275cmp=g.Hb({type:Ot,selectors:[["app-credit-note-details"]],viewQuery:function(e,t){var i;1&e&&g.Jc(T.a,!0),2&e&&g.zc(i=g.cc())&&(t.tableStructureComponent=i.first)},decls:26,vars:9,consts:[[1,"removePadding"],["color","primary"],["src","assets/img/fav-icon.png",1,"img-style"],[1,"toolbar-spacer"],[1,"fury-flex-form-field"],["matTooltip","Save","mat-icon-button","","aria-label","Example icon-button with menu icon",1,"example-icon",3,"disabled","click"],[1,"topPadding"],["fxLayout","column",1,"removePadding",3,"fxLayoutGap"],["fxFlex","noshrink","fxLayout","column","fxLayout.gt-sm","row","fxLayoutAlign.gt-sm","start stretch",3,"fxLayoutGap"],["fxFlex","grow",1,"basic-forms","route-animations-elements",3,"fxFlex.gt-sm"],["fxLayout","column",1,"removePadding"],["fxLayout","column",1,"result","divScroll"],[3,"tableData","columns","changedRow"],["fxLayout.gt-sm","row","fxLayout","column","fxLayoutAlign","end center","fxLayoutGap.gt-sm","12px",1,"person","padding-top"],["color","primary",1,"result"],["type","text","id","accountHeadAmount","name","accountHeadAmount","readonly","","matInput","",2,"text-align","right",3,"ngModel","ngModelChange"],["color","primary",1,"result",2,"padding-top","10px"],["type","text","id","creditNoteAmount","name","creditNoteAmount","readonly","","matInput","",2,"text-align","right",3,"ngModel","ngModelChange"]],template:function(e,t){1&e&&(g.Tb(0,"fury-card-header",0),g.Tb(1,"mat-toolbar",1),g.Ob(2,"img",2),g.Tb(3,"span"),g.Rc(4,"Credit Note"),g.Sb(),g.Ob(5,"span",3),g.Tb(6,"div",4),g.Tb(7,"button",5),g.bc("click",(function(){return t.onSave()})),g.Tb(8,"mat-icon"),g.Rc(9,"save"),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Ob(10,"div",6),g.Tb(11,"fury-page-layout-content",7),g.Tb(12,"div",8),g.Tb(13,"fury-card",9),g.Tb(14,"fury-card-content",10),g.Tb(15,"div",11),g.Tb(16,"app-table-structure",12),g.bc("changedRow",(function(){return t.onChangedRow()})),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Tb(17,"div",13),g.Tb(18,"mat-form-field",14),g.Tb(19,"mat-label"),g.Rc(20,"Account Head Amount"),g.Sb(),g.Tb(21,"input",15),g.bc("ngModelChange",(function(e){return t.accountHeadAmount=e})),g.Sb(),g.Sb(),g.Tb(22,"mat-form-field",16),g.Tb(23,"mat-label"),g.Rc(24,"Credit Note Amount"),g.Sb(),g.Tb(25,"input",17),g.bc("ngModelChange",(function(e){return t.creditNoteAmount=e})),g.Sb(),g.Sb(),g.Sb()),2&e&&(g.Cb(7),g.mc("disabled",t.disableSave||"View"===t.viewMode),g.Cb(4),g.mc("fxLayoutGap",t.gap),g.Cb(1),g.mc("fxLayoutGap",t.gap),g.Cb(1),g.mc("fxFlex.gt-sm",t.col2)("@fadeInUp",void 0),g.Cb(3),g.mc("tableData",t.creditNoteTransactions)("columns",t.columns),g.Cb(5),g.mc("ngModel",t.accountHeadAmount),g.Cb(4),g.mc("ngModel",t.creditNoteAmount))},directives:[S.d,ne.a,k.a,A.a,F.a,ie.a,N.d,N.e,N.b,N.c,S.a,S.c,T.a,z.d,z.h,E.b,s.c,s.q,s.t],styles:[".button[_ngcontent-%COMP%]{line-height:50px}.toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.img-style[_ngcontent-%COMP%]{width:32px}.removePadding[_ngcontent-%COMP%]{padding:0}.topPadding[_ngcontent-%COMP%]{padding-top:25px}.divScroll[_ngcontent-%COMP%]{height:310px;overflow-y:auto}"],data:{animation:[p.a,f.a]}}),Ot),Bt=((It=function(){function e(t,i){l(this,e),this.dialogRef=t,this.item=i,this.data={},this.data=i}return o(e,[{key:"ngOnInit",value:function(){}},{key:"close",value:function(){this.dialogRef.close()}},{key:"save",value:function(){}}]),e}()).\u0275fac=function(e){return new(e||It)(g.Nb(v.h),g.Nb(v.a))},It.\u0275cmp=g.Hb({type:It,selectors:[["fury-view-remarks-dialog"]],decls:4,vars:2,consts:[[1,"heading"],[1,"mat-dlg-content","contentStyle"]],template:function(e,t){1&e&&(g.Tb(0,"div",0),g.Rc(1),g.Sb(),g.Tb(2,"div",1),g.Rc(3),g.Sb()),2&e&&(g.Cb(1),g.Tc(" ",t.data.label," "),g.Cb(2),g.Sc(t.data.value))},styles:[".buttonStyle[_ngcontent-%COMP%]{background:#1976d2;color:#fff;padding-right:10px}.heading[_ngcontent-%COMP%]{font-size:large;font-weight:700;margin-top:10px}.contentStyle[_ngcontent-%COMP%]{padding-top:40px;padding-bottom:30px;padding-right:30px}.rightAlign[_ngcontent-%COMP%]{text-align:right}.bottomPadding[_ngcontent-%COMP%]{padding-bottom:20px}"]}),It);function zt(e,t){if(1&e&&(g.Tb(0,"mat-option",12),g.Rc(1),g.Sb()),2&e){var i=t.$implicit;g.mc("value",i.notificationType),g.Cb(1),g.Tc(" ",i.notificationType," ")}}var Ut,Et=((Ut=function(){function e(t,i,n){l(this,e),this.fb=t,this.dialogRef=i,this.data=n,this.notificationType="",this.options=[],this.billMasters=[],this.notificationLabel="",i.disableClose=!0}return o(e,[{key:"ngOnInit",value:function(){this.options=this.data.alertSettings,this.billMasters=this.data.billMasters}},{key:"close",value:function(){this.notificationType="",this.dialogRef.close()}},{key:"send",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.dialogRef.close({notificationType:this.notificationType,isSkipExisting:e})}},{key:"onChangeTemplate",value:function(e){var t=this;this.notificationType=e;var i=[];if(this.billMasters&&this.billMasters.length){var n=this.billMasters.filter((function(e){return e.notificationLogs&&e.notificationLogs.length>0}));n&&n.length&&n.forEach((function(e){var n=e.notificationLogs.find((function(e){return e.notificationType===t.notificationType}));n&&i.push(n)}))}this.notificationLabel="Total requests :".concat(this.billMasters.length," \n New requests: ").concat(this.billMasters.length-i.length," \n Already send requests : ").concat(i.length)}}]),e}()).\u0275fac=function(e){return new(e||Ut)(g.Nb(s.f),g.Nb(v.h),g.Nb(v.a))},Ut.\u0275cmp=g.Hb({type:Ut,selectors:[["fury-notifications-send-dialog"]],decls:24,vars:3,consts:[["mat-dialog-title",""],["role","toolbar",1,"task-header"],[1,"fx-spacer"],["mat-icon-button","",3,"click"],["title","Close","mat-list-icon",""],[1,"mat-dlg-content"],["fxLayout","column",1,"content"],["color","primary",1,"result"],["id","template","name","template",3,"value","selectionChange","valueChange"],[3,"value",4,"ngFor","ngForOf"],["fxLayout","row","fxLayoutAlign","end center"],["mat-button","",3,"click"],[3,"value"]],template:function(e,t){1&e&&(g.Tb(0,"h4",0),g.Tb(1,"mat-toolbar",1),g.Tb(2,"span"),g.Rc(3,"Send Notifications"),g.Sb(),g.Ob(4,"span",2),g.Tb(5,"button",3),g.bc("click",(function(){return t.close()})),g.Tb(6,"mat-icon",4),g.Rc(7,"close"),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Tb(8,"mat-dialog-content",5),g.Tb(9,"div",6),g.Tb(10,"mat-form-field",7),g.Tb(11,"mat-label"),g.Rc(12,"Select Template"),g.Sb(),g.Tb(13,"mat-select",8),g.bc("selectionChange",(function(e){return t.onChangeTemplate(e.value)}))("valueChange",(function(e){return t.notificationType=e})),g.Pc(14,zt,2,2,"mat-option",9),g.Sb(),g.Tb(15,"mat-hint"),g.Rc(16,"Please select a template"),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Rc(17),g.Ob(18,"mat-dialog-content"),g.Tb(19,"mat-dialog-actions",10),g.Tb(20,"button",11),g.bc("click",(function(){return t.send(!1)})),g.Rc(21,"Resend"),g.Sb(),g.Tb(22,"button",11),g.bc("click",(function(){return t.send(!0)})),g.Rc(23,"Send"),g.Sb(),g.Sb()),2&e&&(g.Cb(13),g.mc("value",t.notificationType),g.Cb(1),g.mc("ngForOf",t.options),g.Cb(3),g.Tc("\n",t.notificationLabel,"\n"))},directives:[v.i,ne.a,k.a,F.a,nt.c,v.f,N.d,z.d,z.h,U.a,d.n,z.g,v.c,N.c,H.n],styles:[".myInput[_ngcontent-%COMP%]{height:50px!important;padding:10px!important}.task-header[_ngcontent-%COMP%]{background-color:transparent;padding:0 5px;height:20px}.fx-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.content[_ngcontent-%COMP%]{width:480px;height:150px;padding-top:20px}.buttonStyle[_ngcontent-%COMP%]{background:#1976d2;color:#fff;padding-right:10px}.marginRadioButton[_ngcontent-%COMP%]{margin-left:10px;margin-bottom:15px}"]}),Ut),jt=a("EUZL"),Ht=a("M9IT"),Yt=a("Dh3D"),Vt=a("a+RD"),_t=["htmlData"];function Gt(e,t){1&e&&(g.Tb(0,"span"),g.Rc(1,"Approve Bills"),g.Sb())}function Xt(e,t){1&e&&(g.Tb(0,"span"),g.Rc(1,"Bill History"),g.Sb())}function qt(e,t){1&e&&(g.Tb(0,"span"),g.Rc(1,"Rejected Bills"),g.Sb())}function $t(e,t){if(1&e){var i=g.Ub();g.Tb(0,"div",14),g.Tb(1,"fury-expandable-table-structure",15),g.bc("selectedRows",(function(e){return g.Ec(i),g.fc().onSelectedRows(e)}))("viewDataRow",(function(e){return g.Ec(i),g.fc().onViewDataRow(e)}))("printDataRow",(function(e){return g.Ec(i),g.fc().downloadReport(e)}))("deleteDataRow",(function(e){return g.Ec(i),g.fc().onDeleteDataRow(e)}))("rejectDataRow",(function(e){return g.Ec(i),g.fc().onRejectDataRow(e)}))("failDataRow",(function(e){return g.Ec(i),g.fc().onFailDataRow(e)}))("updateRow",(function(e){return g.Ec(i),g.fc().onUpdateRow(e)}))("remarksDataRow",(function(e){return g.Ec(i),g.fc().onRemarksDataRow(e)}))("filterDataRow",(function(e){return g.Ec(i),g.fc().onFilterDataRow(e)})),g.Sb(),g.Sb()}if(2&e){var n=g.fc();g.Cb(1),g.mc("tableData",n.billMasterDetails)("columnsToDisplay",n.columns)("innerDisplayedColumns",n.innerColumns)("columnNames",n.columnNames)("hideHeader",!1)("cssStyledColumn",n.cssStyledColumn)("visibleButtons",n.visibleButtons)("role",n.role)("buttonName",n.buttonName)("disableColumn",n.disableColumn)("buttonDisableColumn",n.buttonDisableColumn)}}function Jt(e,t){if(1&e&&(g.Tb(0,"th",32),g.Rc(1),g.Sb()),2&e){var i=g.fc(2).$implicit;g.Cb(1),g.Tc(" ",i.name,"")}}function Qt(e,t){if(1&e&&(g.Tb(0,"td",33),g.Rc(1),g.Sb()),2&e){var i=t.$implicit,n=g.fc(2).$implicit;g.Cb(1),g.Tc(" ",i[n.property]," ")}}function Kt(e,t){if(1&e&&(g.Rb(0,29),g.Pc(1,Jt,2,1,"th",30),g.Pc(2,Qt,2,1,"td",31),g.Qb()),2&e){var i=g.fc().$implicit;g.mc("matColumnDef",i.property)}}function Zt(e,t){if(1&e&&(g.Rb(0),g.Pc(1,Kt,3,1,"ng-container",28),g.Qb()),2&e){var i=t.$implicit;g.Cb(1),g.mc("ngIf",i.isModelProperty)}}function ei(e,t){1&e&&(g.Tb(0,"th",34),g.Rc(1,"NET AMOUNT"),g.Sb())}function ti(e,t){if(1&e&&(g.Tb(0,"td",35),g.Rc(1),g.Sb()),2&e){var i=t.$implicit;g.Cb(1),g.Tc(" ",i.netAmountLocal," ")}}function ii(e,t){1&e&&g.Ob(0,"th",36)}function ni(e,t){if(1&e){var i=g.Ub();g.Tb(0,"td",37),g.Tb(1,"button",38),g.bc("click",(function(){g.Ec(i);var e=t.$implicit;return g.fc(2).downloadReport(e)})),g.Tb(2,"mat-icon"),g.Rc(3,"print"),g.Sb(),g.Sb(),g.Sb()}}function li(e,t){1&e&&g.Ob(0,"tr",39)}function ai(e,t){1&e&&g.Ob(0,"tr",40)}function oi(e,t){if(1&e){var i=g.Ub();g.Tb(0,"div",14),g.Tb(1,"fury-list",16),g.bc("filterChange",(function(e){return g.Ec(i),g.fc().onFilterChange(e)})),g.Tb(2,"table",17),g.Pc(3,Zt,2,1,"ng-container",18),g.Rb(4,19),g.Pc(5,ei,2,0,"th",20),g.Pc(6,ti,2,1,"td",21),g.Qb(),g.Rb(7,22),g.Pc(8,ii,1,0,"th",23),g.Pc(9,ni,4,0,"td",24),g.Qb(),g.Pc(10,li,1,0,"tr",25),g.Pc(11,ai,1,0,"tr",26),g.Sb(),g.Ob(12,"mat-paginator",27),g.Sb(),g.Sb()}if(2&e){var n=g.fc();g.Cb(1),g.mc("columns",n.displayedColumns),g.Cb(1),g.mc("dataSource",n.dataSource),g.Cb(1),g.mc("ngForOf",n.displayedColumns),g.Cb(7),g.mc("matHeaderRowDef",n.visibleColumns),g.Cb(1),g.mc("matRowDefColumns",n.visibleColumns),g.Cb(1),g.mc("pageSize",n.pageSize)}}function ri(e,t){if(1&e&&(g.Tb(0,"ul"),g.Tb(1,"li"),g.Tb(2,"div",45),g.Tb(3,"label"),g.Rc(4,"Approved"),g.Sb(),g.Ob(5,"div",46),g.Tb(6,"label"),g.Rc(7),g.Sb(),g.Sb(),g.Sb(),g.Tb(8,"li"),g.Tb(9,"div",45),g.Tb(10,"label"),g.Rc(11,"Rejected"),g.Sb(),g.Ob(12,"div",47),g.Tb(13,"label"),g.Rc(14),g.Sb(),g.Sb(),g.Sb(),g.Sb()),2&e){var i=g.fc(2);g.Cb(7),g.Sc(i.approvedCount),g.Cb(7),g.Sc(i.rejectedCount)}}function si(e,t){if(1&e){var i=g.Ub();g.Tb(0,"mat-form-field",42),g.Tb(1,"mat-label"),g.Rc(2,"Credit Note Amount"),g.Sb(),g.Tb(3,"input",48),g.bc("ngModelChange",(function(e){return g.Ec(i),g.fc(2).creditNoteAmount=e})),g.Sb(),g.Sb()}if(2&e){var n=g.fc(2);g.Cb(3),g.mc("ngModel",n.creditNoteAmount)}}function ci(e,t){if(1&e){var i=g.Ub();g.Tb(0,"mat-form-field",42),g.Tb(1,"mat-label"),g.Rc(2,"Net Bill Amount"),g.Sb(),g.Tb(3,"input",49),g.bc("ngModelChange",(function(e){return g.Ec(i),g.fc(2).netAmount=e})),g.Sb(),g.Sb()}if(2&e){var n=g.fc(2);g.Cb(3),g.mc("ngModel",n.netAmount)}}function ui(e,t){if(1&e){var i=g.Ub();g.Tb(0,"mat-form-field",42),g.Tb(1,"mat-label"),g.Rc(2,"Paid Amount"),g.Sb(),g.Tb(3,"input",50),g.bc("ngModelChange",(function(e){return g.Ec(i),g.fc(2).receivedAmount=e})),g.Sb(),g.Sb()}if(2&e){var n=g.fc(2);g.Cb(3),g.mc("ngModel",n.receivedAmount)}}function di(e,t){if(1&e){var i=g.Ub();g.Tb(0,"mat-form-field",42),g.Tb(1,"mat-label"),g.Rc(2,"Balance Amount"),g.Sb(),g.Tb(3,"input",51),g.bc("ngModelChange",(function(e){return g.Ec(i),g.fc(2).balanceAmount=e})),g.Sb(),g.Sb()}if(2&e){var n=g.fc(2);g.Cb(3),g.mc("ngModel",n.balanceAmount)}}function mi(e,t){if(1&e){var i=g.Ub();g.Tb(0,"div",41),g.Pc(1,ri,15,2,"ul",4),g.Tb(2,"mat-form-field",42),g.Tb(3,"mat-label"),g.Rc(4,"Bill Amount"),g.Sb(),g.Tb(5,"input",43),g.bc("ngModelChange",(function(e){return g.Ec(i),g.fc().billAmount=e})),g.Sb(),g.Sb(),g.Pc(6,si,4,1,"mat-form-field",44),g.Pc(7,ci,4,1,"mat-form-field",44),g.Pc(8,ui,4,1,"mat-form-field",44),g.Pc(9,di,4,1,"mat-form-field",44),g.Sb()}if(2&e){var n=g.fc();g.Cb(1),g.mc("ngIf",n.isRejectedBills&&n.isApproveBills),g.Cb(4),g.mc("ngModel",n.billAmount),g.Cb(1),g.mc("ngIf",!n.isRejectedBills&&!n.isApproveBills),g.Cb(1),g.mc("ngIf",!n.isRejectedBills&&!n.isApproveBills),g.Cb(1),g.mc("ngIf",!n.isRejectedBills&&!n.isApproveBills),g.Cb(1),g.mc("ngIf",!n.isRejectedBills&&!n.isApproveBills)}}var hi,bi,fi=((bi=function(){function e(t,i,n,a,o,r,s,c,u,d,m,h,b,f,p,g,v){var C,S,T,P;l(this,e),this.billService=t,this.billSettlementService=i,this.date=n,this.currencyPipe=a,this.decimalPipe=o,this.dialog=r,this.templateService=s,this.jwtHelperService=c,this.snackbar=u,this.masterService=d,this.registerService=m,this.cookieService=h,this.router=b,this.clientSelectionService=f,this.templatesService=p,this.ref=g,this.envService=v,this.role="",this._gap=16,this.gap=this._gap+"px",this.col2="1 1 calc(50% - ".concat(this._gap/2,"px)"),this.col3="1 1 calc(33.3333% - ".concat(this._gap/1.5,"px)"),this.tenants=[],this.billPeriods=[],this.billFeeTypes=[],this.billTypes=[],this.selectedRows=[],this.visibleButtons=[],this.columns=[],this.innerColumns=[],this.columnNames=[],this.billMasterDetails=[],this.billMasterToUpdateIsBillFailed=[],this.manageParams={},this.userActions=[],this.billFeeType="",this.billAmount="",this.receivedAmount="",this.creditNoteAmount="",this.netAmount="",this.balanceAmount="",this.parameterValue=!1,this.filePath="",this.userId="",this.disable=!1,this.disableColumn="paid",this.billNumberConsumptionColumnName="Bill No",this.buildingColumnName="Building",this.unitNumberColumnName="Unit Number",this.smsColumnName="SMS",this.emailColumnName="Email",this.watsappColumnName="Watsapp",this.dateFormat="",this.currency="",this.roundFormat="",this.consumptionRoundOffFormat="",this.billNumberColumnName="Bill Number",this.accountNumberColumnName="Account Number",this.tenantNameColumnName="Tenant Name",this.entityTypeColumnName="Owner/Tenant",this.unitColumnName="Unit",this.billDateColumnName="Bill Date",this.fromDateColumnName="From Date",this.toDateColumnName="To Date",this.dueDateColumnName="Due Date",this.billAmountColumnName="Bill Amount",this.creditNoteAmountColumnName="Credit Note Amount",this.netAmountColumnName="Net Bill Amount",this.paidColumnName="Paid",this.balanceAmountColumnName="Balance Amount",this.cancelColumnName="Cancel",this.utilityTypeCoulmnNmae="Utility Type",this.meterNumberCoulmnNmae="Meter Number",this.previousReadingColumnName="Previous",this.presentReadingColumnName="Present",this.currentConsumptionColumnName="Cur-Consumption",this.consumptionChargeColumnName="Consumption Charge",this.cssStyledColumn="status",this.buttonDisableColumn="isLatestBill",this.buttonName="Credit Note",this.approvedCount="",this.rejectedCount="",this.fineCount="",this.penalityCount="",this.pdfsToMerge=[],this.isApproveBills=!1,this.isRejectedBills=!1,this.pageSize=10,this.dataSource=new ye.k([]),this.displayedColumns=[{name:this.billDateColumnName,property:"billDateLocal",visible:!0,isModelProperty:!0},{name:this.billNumberColumnName,property:"billNumber",visible:!0,isModelProperty:!0},{name:this.unitNumberColumnName,property:"unitNumber",visible:!0,isModelProperty:!0},{name:this.netAmountColumnName,property:"netAmountLocal",visible:!0,isModelProperty:!1},{name:"Actions",property:"actions",visible:!0}],this.filePath=v.backendForFiles,this.dateFormat=null!==(C=Object(y.e)("DateFormat"))&&void 0!==C?C:v.dateFormat,this.currency=null!==(S=Object(y.e)("Currency"))&&void 0!==S?S:v.currencyFormat,this.roundFormat=null!==(T=Object(y.e)("RoundOff"))&&void 0!==T?T:v.roundOffFormat,this.consumptionRoundOffFormat=null!==(P=Object(y.e)("ConsumptionRoundOff"))&&void 0!==P?P:v.consumptionRoundOffFormat}return o(e,[{key:"ngOnInit",value:function(){var e=this;this.columnsProps=this.displayedColumns.map((function(e){return e.property})),this.clientId=parseInt(this.cookieService.get("globalClientId")),this.router.snapshot.url.toString().includes("approve-bills")?this.isApproveBills=!0:this.router.snapshot.url.toString().includes("rejected-bills")&&(this.isRejectedBills=!0);var t=this.cookieService.get("access_token"),i=this.jwtHelperService.decodeToken(t);i&&(this.role=i["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"],this.userId=i["http://schemas.xmlsoap.org/ws/2005/05/identity/claims/sid"],this.getUserEnabledActions()),this.masterService.getParameterValue("BillHistoryNotifications").subscribe((function(t){e.parameterValue=t})),this.ownerId=parseInt(this.cookieService.get("ownerId")),this.ownerId>0?(this.clientSelectionService.setIsClientVisible(!1),this.onGetBillsHistory(this.manageParams)):this.clientSelectionService.setIsClientVisible(!0),this.getTenants(),this.getBillPeriods(),this.getBillFeeTypes(),this.getBillTypes(),this.createColumnNames(),this.createGridColumns(),this.createInnerGridColumns(),this.addVisibleButtons()}},{key:"createGridColumns",value:function(){this.columns=0!=this.ownerId||this.isRejectedBills||this.isApproveBills?0==this.ownerId&&(this.isRejectedBills||this.isApproveBills)?["select","billDateLocal","billNumber","accountNumber","ownerName","unitNumber","fromDateLocal","toDateLocal","dueDateLocal","billAmountLocal","button","action"]:["select","billDateLocal","billNumber","unitNumber","netAmountLocal","action"]:["select","billDateLocal","billNumber","accountNumber","ownerName","unitNumber","fromDateLocal","toDateLocal","dueDateLocal","billAmountLocal","creditNoteAmountLocal","netAmountLocal","paidLocal","balanceAmountLocal","button","action"]}},{key:"createInnerGridColumns",value:function(){this.innerColumns=["utilityType","deviceName","previousReadingLocal","presentReadingLocal","consumptionLocal","consumptionCharge"]}},{key:"createColumnNames",value:function(){this.columnNames=[{name:this.billNumberColumnName,property:"billNumber",visible:!0,isModelProperty:!0},{name:this.accountNumberColumnName,property:"accountNumber",visible:!0,isModelProperty:!0},{name:this.tenantNameColumnName,property:"ownerName",visible:!0,isModelProperty:!0},{name:this.entityTypeColumnName,property:"entityType",visible:!0,isModelProperty:!0},{name:this.unitColumnName,property:"unitNumber",visible:!0,isModelProperty:!0},{name:this.fromDateColumnName,property:"fromDateLocal",visible:!0,isModelProperty:!0},{name:this.toDateColumnName,property:"toDateLocal",visible:!0,isModelProperty:!0},{name:this.dueDateColumnName,property:"dueDateLocal",visible:!0,isModelProperty:!0},{name:this.billDateColumnName,property:"billDateLocal",visible:!0,isModelProperty:!0},{name:this.billAmountColumnName,property:"billAmountLocal",visible:!0,isModelProperty:!0,columnAlign:{"text-align":"right"}},{name:this.paidColumnName,property:"paidLocal",visible:!0,isModelProperty:!0,columnAlign:{"text-align":"right"}},{name:this.utilityTypeCoulmnNmae,property:"utilityType",visible:!0,isModelProperty:!1},{name:this.meterNumberCoulmnNmae,property:"deviceName",visible:!0,isModelProperty:!1},{name:this.previousReadingColumnName,property:"previousReadingLocal",visible:!0,isModelProperty:!1},{name:this.presentReadingColumnName,property:"presentReadingLocal",visible:!0,isModelProperty:!1},{name:this.currentConsumptionColumnName,property:"consumptionLocal",visible:!0,isModelProperty:!1,columnAlign:{"text-align":"right"}},{name:this.billAmountColumnName,property:"amountLocal",visible:!0,isModelProperty:!1,columnAlign:{"text-align":"right"}},{name:this.creditNoteAmountColumnName,property:"creditNoteAmountLocal",visible:!0,isModelProperty:!1,columnAlign:{"text-align":"right"}},{name:this.netAmountColumnName,property:"netAmountLocal",visible:!0,isModelProperty:!1,columnAlign:{"text-align":"right"}},{name:this.consumptionChargeColumnName,property:"consumptionCharge",visible:!0,isModelProperty:!1,columnAlign:{"text-align":"right"}},{name:this.balanceAmountColumnName,property:"balanceAmountLocal",visible:!0,isModelProperty:!1,columnAlign:{"text-align":"right"}}]}},{key:"addVisibleButtons",value:function(){this.visibleButtons=[],this.visibleButtons=this.isApproveBills?[{property:"print"},{property:"reject"},{property:"fail"}]:this.isRejectedBills?[{property:"print"},{property:"remarks"}]:[{property:"modify"},{property:"print"},{property:"cancel"}]}},{key:"getUserEnabledActions",value:function(){var e=this;this.userActions=[],this.registerService.getUserEnabledActions(this.userId).subscribe({next:function(t){e.userActions=t},error:function(t){e.notificationMessage("User Actions not found","red-snackbar")}})}},{key:"onGetBillsHistory",value:function(e){var t=this;this.manageParams=e,this.billMasterDetails=[],this.billAmount="",this.receivedAmount="",this.rejectedCount="",this.approvedCount="",this.fineCount="",this.penalityCount="";var i=0,n=0,l=0,a=0,o=0;e.fromDate=""==e.fromDate?"":L(e.fromDate).format("YYYY-MM-DD"),e.toDate=""==e.toDate?"":L(e.toDate).format("YYYY-MM-DD"),e.tenantId="External"==this.role?this.ownerId.toString():e.tenantId,e.clientId=this.clientId,this.billService.getBillHistory(e).subscribe((function(e){var r,s,c,u;if(e=e.filter((function(e){return null!=e.billNumber&&""!=e.billNumber})),t.isApproveBills&&!t.isRejectedBills?e=e.filter((function(e){return!1===e.isApproved&&!1===e.isRejected})):t.isApproveBills||t.isRejectedBills?t.isRejectedBills&&(e=e.filter((function(e){return!0===e.isRejected}))):e=e.filter((function(e){return!0===e.isApproved&&!1===e.isRejected})),e=e.filter((function(e){return!1===e.isBillFailed})),t.dateFormat=Object(y.e)("DateFormat"),t.roundFormat=Object(y.e)("RoundOff"),t.currency=Object(y.e)("Currency"),e.forEach((function(e){e.billDateLocal=t.date.transform(e.billDate.toString(),t.dateFormat.toString()),e.fromDateLocal=t.date.transform(e.fromDate.toString(),t.dateFormat.toString()),e.toDateLocal=t.date.transform(e.toDate.toString(),t.dateFormat.toString()),e.dueDateLocal=t.date.transform(e.dueDate.toString(),t.dateFormat.toString()),e.billAmountLocal=t.currencyPipe.transform(e.billAmount,t.currency.toString(),!0,t.roundFormat),e.paidLocal=t.currencyPipe.transform(e.paid,t.currency.toString(),!0,t.roundFormat),e.creditNoteAmountLocal=t.currencyPipe.transform(e.creditNoteAmount,t.currency.toString(),!0,t.roundFormat),e.netAmountLocal=t.currencyPipe.transform(e.netAmount,t.currency.toString(),!0,t.roundFormat),e.balanceAmountLocal=t.currencyPipe.transform(e.balanceAmount,t.currency.toString(),!0,t.roundFormat),e.bills.forEach((function(e){t.consumptionRoundOffFormat=Object(y.e)("ConsumptionRoundOff",e.utilityTypeId),e.previousReadingLocal=t.decimalPipe.transform(e.previousReading,t.consumptionRoundOffFormat),e.presentReadingLocal=t.decimalPipe.transform(e.presentReading,t.consumptionRoundOffFormat),e.consumptionLocal=t.decimalPipe.transform(e.consumption,t.consumptionRoundOffFormat),e.billAmountLocal=e.consumptionCharge=t.currencyPipe.transform(e.billAmount,t.currency.toString(),!0,t.roundFormat)})),(t.isApproveBills||t.isRejectedBills)&&(e.status="Normal"),i+=e.billAmount,l+=e.creditNoteAmount,a+=e.netAmount,n+=e.paid,o+=e.balanceAmount})),t.billMasterDetails=e,t.dataSource=new ye.k(t.billMasterDetails),t.ref.detectChanges(),t.dataSource&&(t.dataSource.paginator=t.paginator,t.dataSource.sort=t.sort),t.billAmount=t.currencyPipe.transform(i,t.currency.toString(),!0,t.roundFormat),t.creditNoteAmount=t.currencyPipe.transform(l,t.currency.toString(),!0,t.roundFormat),t.netAmount=t.currencyPipe.transform(a,t.currency.toString(),!0,t.roundFormat),t.receivedAmount=t.currencyPipe.transform(n,t.currency.toString(),!0,t.roundFormat),t.balanceAmount=t.currencyPipe.transform(o,t.currency.toString(),!0,t.roundFormat),t.billMasterDetails&&t.billMasterDetails.length){var d=null!==(r=t.billMasterDetails.filter((function(e){return"Approved"===e.status})).length)&&void 0!==r?r:0;t.approvedCount="- "+d.toString();var m=null!==(s=t.billMasterDetails.filter((function(e){return"Rejected"===e.status})).length)&&void 0!==s?s:0;t.rejectedCount="- "+m.toString();var h=null!==(c=t.billMasterDetails.filter((function(e){return"Fine"===e.status})).length)&&void 0!==c?c:0;t.fineCount="- "+h.toString();var b=null!==(u=t.billMasterDetails.filter((function(e){return"Penalty"===e.status})).length)&&void 0!==u?u:0;t.penalityCount="- "+b.toString()}}))}},{key:"onSelectedRows",value:function(e){this.selectedRows=[],this.selectedRows=e,this.disable=!1,this.selectedRows&&this.selectedRows.length&&this.selectedRows.find((function(e){return 1==e.isApproved}))&&(this.disable=!0)}},{key:"getBillPeriods",value:function(){var e=this;this.billPeriods=[{label:"Select",value:0}],this.billService.getBillPeriods(this.clientId).subscribe((function(t){t.forEach((function(t){e.billPeriods.push({label:t.periodDescription,value:t.id})}))}))}},{key:"getTenants",value:function(){var e=this;this.billSettlementService.getTenantsDetails(this.clientId).subscribe((function(t){e.tenants=t}))}},{key:"getBillFeeTypes",value:function(){var e=this;this.billFeeTypes=[{label:"Select",value:0}],this.masterService.getSystemMasterdata(64,0).subscribe((function(t){t.forEach((function(t){e.billFeeTypes.push({label:t.description,value:t.id})}))}))}},{key:"getBillTypes",value:function(){var e=this;this.billTypes=[{label:"Select",value:0}],this.masterService.getSystemMasterdata(29,0).subscribe((function(t){t.forEach((function(t){e.billTypes.push({label:t.description,value:Number(t.defaultValue)})}))}))}},{key:"onBillFeeTypeChange",value:function(e){this.billHistoryFooterToolbarComponent&&(this.billHistoryFooterToolbarComponent.billFeeType=e)}},{key:"onViewDataRow",value:function(e){this.dialog.open(P,{data:e}).afterClosed().subscribe()}},{key:"onDeleteDataRow",value:function(e){var t=this;e.type="Cancel",e.contractNotExist?this.notificationMessage("Can't cancel this Bill due to corresponding contract is suspended or closed","red-snackbar"):e.creditNoteAmount>0?this.notificationMessage("Can't cancel this Bill due to credit note exist","red-snackbar"):this.dialog.open(lt,{data:e}).afterClosed().subscribe((function(){e&&t.onGetBillsHistory(t.manageParams)}))}},{key:"onSendNotifications",value:function(){this.getClientAlertSettings()}},{key:"onPrintPdf",value:function(){return Object(h.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.selectedRows&&this.selectedRows.length?this.invoiceView(this.selectedRows):this.notificationMessage("Please select Bills.","red-snackbar");case 1:case"end":return e.stop()}}),e,this)})))}},{key:"invoiceView",value:function(e){var t=this;this.billService.invoiceView(e).subscribe({next:function(e){e?t.downloadFile(e):t.notificationMessage("No data to print","red-snackbar")},error:function(e){t.notificationMessage("No data to print","red-snackbar")}})}},{key:"base64ToArrayBuffer",value:function(e){for(var t=window.atob(e),i=t.length,n=new Uint8Array(i),l=0;l<i;l++)n[l]=t.charCodeAt(l);return n.buffer}},{key:"downloadReport",value:function(e){return Object(h.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.invoiceView([e]);case 1:case"end":return t.stop()}}),t,this)})))}},{key:"downloadFile",value:function(e){return Object(h.a)(this,void 0,void 0,regeneratorRuntime.mark((function i(){var n,l,a,o,r,s,c,u;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,ee.PDFDocument.create();case 2:n=i.sent,l=t(e),i.prev=4,l.s();case 6:if((a=l.n()).done){i.next=16;break}return o=a.value,i.next=10,ee.PDFDocument.load(o);case 10:return r=i.sent,i.next=13,n.copyPages(r,r.getPageIndices());case 13:i.sent.forEach((function(e){n.addPage(e)}));case 14:i.next=6;break;case 16:i.next=21;break;case 18:i.prev=18,i.t0=i.catch(4),l.e(i.t0);case 21:return i.prev=21,l.f(),i.finish(21);case 24:return i.next=26,n.save();case 26:s=i.sent,c=new Blob([s],{type:"application/pdf"}),u=window.URL.createObjectURL(c),window.open(u);case 30:case"end":return i.stop()}}),i,null,[[4,18,21,24]])})))}},{key:"downloadBillReport",value:function(e){var t=this,i=[],n=[],l=[],a=[],o=[];if(e.bills.forEach((function(l){l.billTransactions&&l.billTransactions.length&&l.billTransactions.forEach((function(a){i.push(a.headDisplay),i.push(e.fromDateLocal),i.push(e.toDateLocal),"BTU"===l.utilityType&&a.measuringUnitId&&2===a.measuringUnitId?(i.push(t.decimalPipe.transform(.284345*l.previousReading,t.roundFormat)+" TR-HR"),i.push(t.decimalPipe.transform(.284345*l.presentReading,t.roundFormat)+" TR-HR"),i.push(t.decimalPipe.transform(.284345*l.consumption,t.roundFormat)+" TR-HR")):(i.push(l.previousReading+" "+l.measuringUnit),i.push(l.presentReading+" "+l.measuringUnit),i.push(l.consumption+" "+l.measuringUnit)),i.push(a.rate),i.push(t.decimalPipe.transform(a.headAmount,t.roundFormat)),n.push(i),i=[]}))})),e.billCharges&&e.billCharges.length){e.billCharges.sort((function(e,t){return e.position-t.position})).forEach((function(e){if("VAT"!==e.headDisplay){var t=l.find((function(t){return t.label===e.headDisplay}));t?t.value+=e.headAmount:l.push({label:e.headDisplay,value:e.headAmount})}}));for(var r=0;r<l.length;r++)i.push(l[r].label),i.push(""),i.push(""),i.push(""),i.push(""),i.push(""),i.push(""),i.push(this.decimalPipe.transform(l[r].value,this.roundFormat)),n.push(i),i=[]}var s="";e.bills.forEach((function(e){s+=e.deviceName+","})),a.push({label:"Account Number:",value:e.accountNumber},{label:"Meter Number:",value:s.slice(0,-1)},{label:"Unit Number:",value:e.unitNumber},{label:"Billing Date:",value:e.billDateLocal},{label:"Due Date:",value:e.dueDateLocal},{label:"Bill Period",value:"".concat(Object(y.f)(e.fromDateLocal)," - ").concat(Object(y.f)(e.toDateLocal)," ")});var c=0;if(n.forEach((function(e){c+=Number(e[7].replace(",",""))})),o.push({label:"Current Month Total:",value:this.currencyPipe.transform(c,this.currency.toString(),!0,this.roundFormat)}),e.billDiscounts&&e.billDiscounts.length){var u=0;e.billDiscounts.forEach((function(e){u+=e.headAmount})),o.push({label:"Total Discount",value:this.currencyPipe.transform(u,this.currency.toString(),!0,this.roundFormat)})}e.billTaxDetails&&e.billTaxDetails.length?e.billTaxDetails.forEach((function(e){o.push({label:e.taxDisplayName,value:t.currencyPipe.transform(e.taxAmount,t.currency.toString(),!0,t.roundFormat)})})):o.push({label:"TAX:",value:this.currencyPipe.transform(0,this.currency.toString(),!0,this.roundFormat)}),o.push({label:"Current Month + TAX:",value:e.billAmountLocal},{label:"Previous Bill Outstanding Balance:",value:this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)},{label:"Total Due incl TAX:",value:this.currencyPipe.transform(e.billAmount+e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)}),this.getBillReport(e,["Services Description","From","To","Previous","Current","Consumption","Rate ","Charges"],n,l,["Customer Id","Billing Period","Total for current period"],[],[{value:"",value1:"Bill Period",value2:"Meter Reading",value3:"",value4:""}],a,o,"Invoice")}},{key:"addImage",value:function(e,t){var i;try{if(t&&t.client&&t.client.imageProperties&&t.client.imageProperties.length){var n=t.client.imageProperties.find((function(e){return"invoice"===e.imageType.trim().toLowerCase()}));if(n){var l=new Image;l.src=this.filePath+"/uploads/"+(null===(i=null==t?void 0:t.client)||void 0===i?void 0:i.photo),l.onload=function(){e.addImage(l,n.imgX,n.imgY,n.imgW,n.imgH)}}else this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar")}else this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar")}catch(a){this.notificationMessage("Image not found.","red-snackbar")}return e}},{key:"getBillReport",value:function(e,t,i,n,l,a,o,r,s,c){var u,d,m,h,b,f,p,g,v,C,S,T,P,D,w,N,x,k,A,F,R,I,O,W,M,L=new Fe.default({orientation:"portrait",unit:"pt",format:"letter"});L.rect(5,5,L.internal.pageSize.width-10,L.internal.pageSize.height-10,"S"),L.setFontSize(30),(L=this.addImage(L,e)).setTextColor(0,0,0),L.setFontSize(16),L.setFont("Cambria","bold"),L.text("Tax Invoice",260,30),L.setFontSize(13),L.setFont("Cambria","normal"),L.text(e.client.clientName.toUpperCase(),10,60),L.setFontSize(10),L.setFont("Cambria"),L.text("TRN: "+e.client.trnNo,10,70),L.text("PO Box "+e.client.addresses[0].zipPostalCode,10,80),L.text(e.client.addresses[0].address1+","+e.client.addresses[0].country,10,90),L.text("Phone: "+e.client.phoneNo,10,100),L.text("Email: "+e.client.email+", Web: "+e.client.website,10,110),L.setFillColor(241,241,244),L.setDrawColor(206,203,203),L.rect(10,120,350,90,"FD"),L.setTextColor(0,0,0),L.setFontSize(12),L.text(null==e?void 0:e.ownerName.toUpperCase(),20,135),L.text("CUSTOMER TRN: "+e.trn,20,155),L.text("unit #"+e.unitNumber,20,170),L.setFontSize(10),L.text(e.clientName,20,185),L.text(Object(y.f)(null===(u=null==e?void 0:e.client)||void 0===u?void 0:u.buildingName,",")+Object(y.f)(null===(m=null===(d=null==e?void 0:e.client)||void 0===d?void 0:d.addresses[0])||void 0===m?void 0:m.location,",")+Object(y.f)(null===(b=null===(h=null==e?void 0:e.client)||void 0===h?void 0:h.addresses[0])||void 0===b?void 0:b.city,",")+Object(y.f)(null===(p=null===(f=null==e?void 0:e.client)||void 0===f?void 0:f.addresses[0])||void 0===p?void 0:p.country,","),20,200),L.setFontSize(9),L.setLineWidth(.1),L.line(5,265,607,265),L.setFontSize(10),L.setFont("bold"),L.text("Invoice#: ".toUpperCase(),390,110),L.setTextColor(25,118,210);var B=L.getTextWidth("Invoice#: "),z="";(null==e?void 0:e.billNumber)&&(z=null===(g=e.billNumber)||void 0===g?void 0:g.toUpperCase()),L.text(z,410+B,110),L.setFont("none"),L.setTextColor(0,0,0),L.setFontSize(9),L.autoTable("",r,{startX:210,startY:120,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:390},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:80,halign:"left"},1:{cellWidth:130,halign:"right"}},didParseCell:function(e){var t=e.column.index;0!=t&&1!=t||(e.cell.styles.rowHeight=1)},headStyles:{lineWidth:.1,lineColor:[0,0,0]}}),L.autoTable("",o,{startX:10,startY:220,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:220,left:10},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,fontStyle:"bold",halign:"center"},1:{cellWidth:160,fontStyle:"bold",halign:"center"},2:{cellWidth:120,fontStyle:"bold",halign:"center"},3:{cellWidth:75,fontStyle:"bold",halign:"center"},4:{cellWidth:135,fontStyle:"bold",halign:"center"}},didParseCell:function(e){var t=e.column.index;0!=t&&1!=t||(e.cell.styles.rowHeight=1)},headStyles:{lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]}});var U=Number(this.decimalPipe.transform(L.autoTable.previous.finalY,"1.0-0"));L.autoTable(t,i,{startX:10,startY:U,didDrawPage:function(e){var t="Page "+e.pageCount;"function"==typeof L.putTotalPages&&(t+=" of 1",L.rect(5,5,L.internal.pageSize.width-10,L.internal.pageSize.height-10,"S")),L.setFontSize(9);var i=L.internal.pageSize.height||L.internal.pageSize.getHeight();L.text(t,e.settings.margin.left,i-10)},styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:U,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:80,halign:"center"},2:{cellWidth:80,halign:"center"},3:{cellWidth:60,halign:"center"},4:{cellWidth:60,halign:"center"},5:{cellWidth:75,halign:"center"},6:{cellWidth:60,halign:"right"},7:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=r.length>12?1.5:2}}),L.setTextColor(0,0,0);var E=Number(this.decimalPipe.transform(L.autoTable.previous.finalY,"1.0-0"));L.setTextColor(25,118,210),L.setFontSize(12),L.text("Bank Payment Account Details",10,E+20),L.setTextColor(0,0,0),L.setFontSize(9),L.text("Account Title: "+Object(y.f)(null===(C=null===(v=null==e?void 0:e.client)||void 0===v?void 0:v.bankDetails[0])||void 0===C?void 0:C.accountName),10,E+40),L.text("Account #: "+Object(y.f)(null===(T=null===(S=null==e?void 0:e.client)||void 0===S?void 0:S.bankDetails[0])||void 0===T?void 0:T.accountNo),10,E+50),L.text("IBAN #: "+Object(y.f)(null===(D=null===(P=null==e?void 0:e.client)||void 0===P?void 0:P.bankDetails[0])||void 0===D?void 0:D.ibanNumber),10,E+60),L.text("Bank Name: "+Object(y.f)(null===(N=null===(w=null==e?void 0:e.client)||void 0===w?void 0:w.bankDetails[0])||void 0===N?void 0:N.bankName),10,E+70),L.text("Swift Code: "+ +Object(y.f)(null===(k=null===(x=null==e?void 0:e.client)||void 0===x?void 0:x.bankDetails[0])||void 0===k?void 0:k.swiftCode),10,E+80),L.setFontSize(9),L.autoTable("",s,{startX:300,startY:E+20,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:320},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:180,halign:"left"},1:{cellWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"}});var j=Number(this.decimalPipe.transform(L.autoTable.previous.finalY,"1.0-0"));L.setTextColor(255,0,0),L.text("Note: A Late Fee will be applied after the due date. A Default Payment \nPenalty will be added to any unit that is ".concat(Object(y.f)(null===(A=null==e?void 0:e.penaltyAfter)||void 0===A?void 0:A.toString())," days or more in arrears."),320,j+10),L.setTextColor(25,118,210),L.setFontSize(12),L.text("USAGE TIPS to reduce consumption:",10,j+10),L.text("Please Try to:",10,j+30),L.setTextColor(0,0,0),L.setFontSize(9),L.text("- Keep filters clean",30,j+40),L.text("- Set thermostats between 23C and 25C",30,j+50),L.text("- Keep vents unblocked",30,j+60),L.text("- Keep doors and windows closed",30,j+70),L.text("- Undertake regular maintenance of the system",30,j+80),L.setTextColor(25,118,210),L.setFontSize(12),L.text("Please Do Not:",10,j+100),L.setTextColor(0,0,0),L.setFontSize(9),L.text("- Set thermostats to 20C or lower",30,j+110),L.text("- Block vents",30,j+120),L.text("- Leave doors and windows open",30,j+130),L.text("- Leave heat producing appliances near thermostats",30,j+140),L.setFillColor(119,183,11);var H=L.internal.pageSize.height||L.internal.pageSize.getHeight();L.rect(320,j+30,280,H-80-(j+30),"FD"),L.setFont("Comic Sans"),L.setTextColor(255,255,255),L.setFontSize(16),L.text("ADVERTISE WITH US",360,j+50);var Y=L.getTextWidth("ADVERTISE WITH US");L.setLineWidth(.1),L.line(360,j+55,360+Y,j+55),L.setFontSize(9),L.text("For advertisement, contact at",390,j+65),L.text(Object(y.f)(null===(F=null==e?void 0:e.client)||void 0===F?void 0:F.phoneNo),390,j+75),L.text(Object(y.f)(null===(R=null==e?void 0:e.client)||void 0===R?void 0:R.email),390,j+85),L.text(Object(y.f)(null===(I=null==e?void 0:e.client)||void 0===I?void 0:I.website),390,j+95),L.setTextColor(0,0,0),L.setLineWidth(.1),L.line(5,H-70,607,H-70),L.text("For any enquiries, write to us ".concat(Object(y.f)(null===(O=null==e?void 0:e.client)||void 0===O?void 0:O.email)," \nor Logon to ").concat(Object(y.f)(null===(W=null==e?void 0:e.client)||void 0===W?void 0:W.website)),10,H-60),L.setTextColor(255,0,0),L.setFont("bold");var V=L.getTextWidth("Notice:");L.text("Notice:",340,H-60),L.setFont("none"),L.setTextColor(0,0,0),L.text("Pay your bills before due date to avoid late payment surcharge",340+V,H-60),L.text("and disconnection.",340,H-50),L.text("You can log onto ".concat(Object(y.f)(null===(M=null==e?void 0:e.client)||void 0===M?void 0:M.website)," to pay your invoices \nTerms & Conditions for Supply of Utility Services"),340,H-40);var _=L.output("datauristring");this.pdfsToMerge.push(_)}},{key:"downloadBillTaiffDetailsReport",value:function(e){for(var t,i,n,l,a,o,r=[],s=[],c=[],u=[],d=[],m=[],h=0;h<e.bills.length;h++)if(this.consumptionRoundOffFormat=null!==(t=Object(y.e)("ConsumptionRoundOff",e.bills[h].utilityTypeId))&&void 0!==t?t:this.envService.consumptionRoundOffFormat,r.push(e.bills[h].utilityType+"-"+e.bills[h].deviceName),r.push(e.fromDateLocal+" - "+e.toDateLocal),r.push(this.decimalPipe.transform(e.bills[h].previousReading,this.consumptionRoundOffFormat)),r.push(this.decimalPipe.transform(e.bills[h].presentReading,this.consumptionRoundOffFormat)),r.push(e.bills[h].billAmount),s.push(r),r=[],e.bills[h].billTariffDetails&&e.bills[h].billTariffDetails.length){r.push("Week Type"),r.push("Peak Type"),r.push("Consumption (KWH)"),r.push("Rate"),r.push("Amount"),s.push(r),r=[];for(var b=e.bills[h].billTariffDetails,f=0;f<b.length;f++)r.push(null===(i=b[f])||void 0===i?void 0:i.weekType),r.push(null===(n=b[f])||void 0===n?void 0:n.peakType),r.push(null===(l=b[f])||void 0===l?void 0:l.consumption),r.push(null===(a=b[f])||void 0===a?void 0:a.rate),r.push(null===(o=b[f])||void 0===o?void 0:o.amount),s.push(r),r=[]}if(e.bills.forEach((function(e){if(e.billTransactions&&e.billTransactions.length){var t=["consumption","consumptioncharge"];e.billTransactions.forEach((function(e){if(!t.includes(e.headDisplay.toLowerCase())){var i=c.find((function(t){return t.label===e.headDisplay}));i?i.value+=e.headAmount:c.push({label:e.headDisplay,value:e.headAmount})}}))}})),e.billCharges&&e.billCharges.length){e.billCharges.sort((function(e,t){return e.position-t.position})).forEach((function(e){if("VAT"!==e.headDisplay){var t=c.find((function(t){return t.label===e.headDisplay}));t?t.value+=e.headAmount:c.push({label:e.headDisplay,value:e.headAmount})}}));for(var p=0;p<c.length;p++)r.push(c[p].label),r.push(""),r.push(""),r.push(""),r.push(this.decimalPipe.transform(c[p].value,this.roundFormat)),s.push(r),r=[]}u.push({label:"Billing Period",value:"Meter Reading"});var g="";e.bills.forEach((function(e){g+=e.deviceName+","})),d.push({label:"Account Number:",value:e.accountNumber},{label:"Meter Number:",value:g.slice(0,-1)},{label:"Unit Number:",value:e.unitNumber},{label:"Billing Date:",value:e.billDateLocal},{label:"Due Date:",value:e.dueDateLocal},{label:"Bill Period",value:"".concat(Object(y.f)(e.fromDateLocal)," - ").concat(Object(y.f)(e.toDateLocal)," ")});var v=e.billCharges.find((function(e){return"VAT"===e.headDisplay})),C=0;s.forEach((function(e){C+=Number(e[7].replace(",",""))})),m.push({label:"Current Month Total:",value:this.currencyPipe.transform(C,this.currency.toString(),!0,this.roundFormat)},{label:"VAT 5%:",value:this.currencyPipe.transform(null==v?void 0:v.headAmount,this.currency.toString(),!0,this.roundFormat)},{label:"Current Month + VAT:",value:e.billAmountLocal},{label:"Previous Bill Outstanding Balance:",value:this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)},{label:"Total Due incl VAT:",value:this.currencyPipe.transform(e.billAmount+e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)}),this.getBillTaiffDetailsReport(e,["Services Description","From - To","Previous","Current","Charges"],s,c,["Customer Id","Billing Period","Total for current period"],[],u,d,m,"Invoice")}},{key:"getBillTaiffDetailsReport",value:function(e,t,i,n,l,a,o,r,s,c){var u,d=new Image;d.src=this.filePath+"/uploads/"+e.client.photo;var m=new Image;m.src="assets/img/lu.JPG";var h=new Fe.default({orientation:"portrait",unit:"pt",format:"letter"});h.rect(5,5,h.internal.pageSize.width-10,h.internal.pageSize.height-10,"S"),h.setFontSize(30),h.addImage(d,"png",5,5,190,d.height),h.addImage(m,"png",547,10,56,56),h.setTextColor(0,0,0),h.setFontSize(14),h.setFont("Cambria"),h.text("Tax Invoice",260,30),h.setFontSize(9),h.setTextColor(25,118,210),h.setFont("Cambria","bold"),h.text(e.client.clientName,10,60),h.setFont("Cambria","normal"),h.text("TRN: "+e.client.trnNo,10,70),h.text("PO Box "+e.client.addresses[0].zipPostalCode,10,80),h.text(e.client.addresses[0].address1+","+e.client.addresses[0].country,10,90),h.text("Phone: "+e.client.phoneNo,10,100),h.text("Email: "+e.client.email+", Web: "+e.client.website,10,110),h.setFillColor(241,241,244),h.setDrawColor(206,203,203),h.rect(10,120,300,90,"FD"),h.setTextColor(0,0,0),h.setFontSize(12),h.text(null==e?void 0:e.ownerName.toUpperCase(),20,135),h.text("CUSTOMER TRN: "+e.trn,20,155),h.text("unit #"+e.unitNumber,20,170),h.setFontSize(10),h.text(e.clientName,20,185),h.text("Al Barsha 1, Dubai, UAE",20,200),h.setFontSize(9),h.setLineWidth(.1),h.line(5,265,607,265),h.setFontSize(10),h.setFont("bold"),h.text("Invoice#: ".toUpperCase(),390,110),h.setTextColor(25,118,210);var b=h.getTextWidth("Invoice#: "),f="";(null==e?void 0:e.billNumber)&&(f=null===(u=e.billNumber)||void 0===u?void 0:u.toUpperCase()),h.text(f,410+b,110),h.setFont("none"),h.setTextColor(0,0,0),h.setFontSize(9),h.autoTable("",r,{startX:210,startY:120,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:390},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:80,halign:"left"},1:{cellWidth:130,halign:"right"}},didParseCell:function(e){var t=e.column.index;0!=t&&1!=t||(e.cell.styles.rowHeight=1)},headStyles:{lineWidth:.1,lineColor:[0,0,0]}}),h.autoTable("",o,{startX:10,startY:220,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:220,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:500,fontStyle:"bold"},1:{cellWidth:90,fontStyle:"bold",halign:"right"}},didParseCell:function(e){var t=e.column.index;0!=t&&1!=t||(e.cell.styles.rowHeight=1)},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});var p=Number(this.decimalPipe.transform(h.autoTable.previous.finalY,"1.0-0"));h.autoTable(t,i,{startX:10,startY:p,didDrawPage:function(e){var t="Page "+e.pageCount;"function"==typeof h.putTotalPages&&(t+=" of 1",h.rect(5,5,h.internal.pageSize.width-10,h.internal.pageSize.height-10,"S")),h.setFontSize(9);var i=h.internal.pageSize.height||h.internal.pageSize.getHeight();h.text(t,e.settings.margin.left,i-10)},styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:p,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:150,halign:"center"},1:{cellWidth:150,halign:"center"},2:{cellWidth:100,halign:"right"},3:{cellWidth:100,halign:"right"},4:{cellWidth:90,halign:"right"}},didParseCell:function(e){var t=e.cell.raw;"Week Type"!==t&&"Peak Type"!==t&&"Consumption (KWH)"!==t&&"Rate"!==t&&"Amount"!==t||(e.cell.styles.fontStyle="bold",e.cell.styles.textColor=[255,255,255],e.cell.styles.fillColor=[25,118,210])},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]}}),h.setTextColor(0,0,0);var g=Number(this.decimalPipe.transform(h.autoTable.previous.finalY,"1.0-0"));h.setTextColor(25,118,210),h.setFontSize(12),h.text("Bank Payment Account Details",10,g+20),h.setTextColor(0,0,0),h.setFontSize(9),h.text("Account Title: LOGIC UTILITIES DISTRICT COOLING SERVICES L.L.C",10,g+40),h.text("Account #: 019100074892",10,g+50),h.text("IBAN #: AE54 0330 0000 1910 0074 892",10,g+60),h.text("Bank Name: MASHREQ BANK - DUBAI MALL BRANCH",10,g+70),h.text("Swift Code: BOMLAEAD",10,g+80),h.setFontSize(9),h.autoTable("",s,{startX:300,startY:g+20,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:320},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:180,halign:"left"},1:{cellWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"}});var v=Number(this.decimalPipe.transform(h.autoTable.previous.finalY,"1.0-0"));h.setTextColor(255,0,0),h.text("Note: A Late Fee will be applied after the due date. A Default Payment \nPenalty will be added to any unit that is ".concat(e.penaltyAfter," days or more in arrears."),320,v+10),h.setTextColor(25,118,210),h.setFontSize(12),h.text("USAGE TIPS to reduce consumption:",10,v+10),h.text("Please Try to:",10,v+30),h.setTextColor(0,0,0),h.setFontSize(9),h.text("- Keep filters clean",30,v+40),h.text("- Set thermostats between 23C and 25C",30,v+50),h.text("- Keep vents unblocked",30,v+60),h.text("- Keep doors and windows closed",30,v+70),h.text("- Undertake regular maintenance of the system",30,v+80),h.setTextColor(25,118,210),h.setFontSize(12),h.text("Please Do Not:",10,v+100),h.setTextColor(0,0,0),h.setFontSize(9),h.text("- Set thermostats to 20C or lower",30,v+110),h.text("- Block vents",30,v+120),h.text("- Leave doors and windows open",30,v+130),h.text("- Leave heat producing appliances near thermostats",30,v+140),h.setFillColor(119,183,11);var y=h.internal.pageSize.height||h.internal.pageSize.getHeight();h.rect(320,v+30,280,y-80-(v+30),"FD"),h.setFont("Comic Sans"),h.setTextColor(255,255,255),h.setFontSize(16),h.text("ADVERTISE WITH US",360,v+50);var C=h.getTextWidth("ADVERTISE WITH US");h.setLineWidth(.1),h.line(360,v+55,360+C,v+55),h.setFontSize(9),h.text("For advertisement, contact at",390,v+65),h.text("800 Logic (56442)",390,v+75),h.text("enquiry@logicutilities.com",390,v+85),h.text("www.logicutilities.com",390,v+95),h.setTextColor(0,0,0),h.setLineWidth(.1),h.line(5,y-70,607,y-70),h.text("For any enquiries, write to us enquiry@logicutilities.com \nor Logon to www.logicutilites.com",10,y-60),h.setTextColor(255,0,0),h.setFont("bold");var S=h.getTextWidth("Notice:");h.text("Notice:",340,y-60),h.setFont("none"),h.setTextColor(0,0,0),h.text("Pay your bills before due date to avoid late payment surcharge",340+S,y-60),h.text("and disconnection.",340,y-50),h.text("You can log onto www.logicutilites.com to pay your invoices \nTerms & Conditions for Supply of Utility Services",340,y-40);var T=h.output("datauristring");this.pdfsToMerge.push(T)}},{key:"onPrintSummary",value:function(e){this.selectedRows&&this.selectedRows.length?"Normal"===e?this.billSummaryView(this.selectedRows):this.downloadDetailsSummary(this.selectedRows):this.notificationMessage("Please select Bills.","red-snackbar")}},{key:"billSummaryView",value:function(e){var t=this;this.billService.billSummaryView(e).subscribe({next:function(e){e?t.downloadSingelFile(e):t.notificationMessage("No data to print","red-snackbar")},error:function(e){t.notificationMessage("No data to print","red-snackbar")}})}},{key:"downloadSingelFile",value:function(e){return Object(h.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var i,n,l,a,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ee.PDFDocument.create();case 2:return i=t.sent,t.next=5,ee.PDFDocument.load(e);case 5:return n=t.sent,t.next=8,i.copyPages(n,n.getPageIndices());case 8:return t.sent.forEach((function(e){i.addPage(e)})),t.next=11,i.save();case 11:l=t.sent,a=new Blob([l],{type:"application/pdf"}),o=window.URL.createObjectURL(a),window.open(o);case 15:case"end":return t.stop()}}),t)})))}},{key:"downloadSummary",value:function(e){for(var t=[],i=[],n=[],l=0,a=0,o=0;o<e.length;o++)t.push(e[o].billNumber),t.push(e[o].accountNumber),t.push(e[o].ownerName),t.push(e[o].entityType),t.push(e[o].unitNumber),t.push(e[o].fromDateLocal),t.push(e[o].toDateLocal),t.push(e[o].dueDateLocal),t.push(e[o].billAmountLocal),t.push(e[o].paidLocal),i.push(t),l+=e[o].billAmount,a+=e[o].paid,t=[];n.push({label:"Total Amount",value1:l,value2:a});for(var r=0;r<n.length;r++)t.push(""),t.push(""),t.push(""),t.push(""),t.push(""),t.push(""),t.push(""),t.push(n[r].label),t.push(this.currencyPipe.transform(n[r].value1,this.currency.toString(),!0,this.roundFormat)),t.push(this.currencyPipe.transform(n[r].value2,this.currency.toString(),!0,this.roundFormat)),i.push(t),t=[];this.getSummaryReport(this.billMasterDetails,["Bill Number","Account Number","Tenant Name","Owner/Tenant","Unit","From Date","To Date ","Due Date ","Bill Amount","Paid"],i,"Bill History")}},{key:"getSummaryReport",value:function(e,t,i,n){var l,a,o=e.length%15,r=new Image;r.src=this.filePath+"/uploads/"+(null===(a=null===(l=e[0])||void 0===l?void 0:l.client)||void 0===a?void 0:a.photo);var s=new Fe.default({orientation:"landscape",unit:"pt",format:"letter"}),c=L().format("M/D/YYYY hh:mm:ss a");Number(this.decimalPipe.transform(s.autoTable.previous.finalY,"1.0-0")),s.autoTable(t,i,{startX:10,startY:110,didDrawPage:function(t){var i,n,l,a;if(s.setFontSize(30),s.setFontSize(30),r&&e[0]&&e[0].client&&e[0].client.imageProperties&&e[0].client.imageProperties.length){var u=null===(n=null===(i=e[0])||void 0===i?void 0:i.client)||void 0===n?void 0:n.imageProperties.find((function(e){return"landscape"===e.imageType.trim().toLowerCase()}));u&&(r.onload=function(){s.addImage(r,u.imgX,u.imgY,u.imgW,u.imgH)})}s.setTextColor(25,118,210),s.setFontSize(9),s.setFont("Cambria"),s.setTextColor(0,0,0),s.text("Print Date: "+c,s.internal.pageSize.width-150,20),s.setFontSize(14),s.text("Summary Report From "+Object(y.f)(null===(l=e[0])||void 0===l?void 0:l.fromDateLocal)+" To "+Object(y.f)(null===(a=e[0])||void 0===a?void 0:a.toDateLocal),s.internal.pageSize.width/2-140,90),s.setFontSize(9);var d="Page "+t.pageCount;"function"==typeof s.putTotalPages&&(s.setTextColor(0,0,0),s.rect(5,5,s.internal.pageSize.width-10,s.internal.pageSize.height-10,"S"),d=d+" of "+o),s.setFontSize(9);var m=s.internal.pageSize.height||s.internal.pageSize.getHeight();s.text(d,t.settings.margin.left,m-10)},styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:100,left:20},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:70,halign:"left"},1:{cellWidth:80,halign:"center"},2:{cellWidth:160,halign:"left"},3:{cellWidth:45,halign:"center"},4:{cellWidth:60,halign:"center"},5:{cellWidth:65,halign:"center"},6:{cellWidth:65,halign:"center"},7:{cellWidth:65,halign:"center"},8:{cellWidth:75,halign:"right"},9:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]}});var u=s.output("blob");window.open(URL.createObjectURL(u))}},{key:"downloadDetailsSummary",value:function(e){var t=this,i=[],n=[],l=["Bill Number","Bill Date","Account Number","Tenant Name"],a=[],o=[];e.forEach((function(e){e.bills&&e.bills.length&&e.bills.forEach((function(e){e.billTransactions&&e.billTransactions.length&&e.billTransactions.forEach((function(e){a.includes(e.headDisplay)||a.push(e.headDisplay)}))})),e.billCharges&&e.billCharges.length&&e.billCharges.forEach((function(e){o.includes(e.headDisplay)||o.push(e.headDisplay)}))})),a.forEach((function(e){l.push(e)})),o.forEach((function(e){l.push(e)})),l.push("Bill Amount ","Paid ");for(var r=0,s=0,c=function(l){i.push(e[l].billNumber),i.push(e[l].billDateLocal),i.push(e[l].accountNumber),i.push(e[l].ownerName),a.forEach((function(n){if(e[l].bills&&e[l].bills.length){var a=e[l].bills.filter((function(e){return 1==e.isDifferentiateBill}));if(a&&a.length&&e[l].bills.length==a.length)if(a[a.length-1].billTransactions&&a[a.length-1].billTransactions.length){var o=a[a.length-1].billTransactions.find((function(e){return e.headDisplay.toLowerCase()===n.toLowerCase()}));i.push(t.currencyPipe.transform(o?o.headAmount:0,t.currency.toString(),!0,t.roundFormat))}else i.push(t.currencyPipe.transform(0,t.currency.toString(),!0,t.roundFormat));else if(e[l].isGroupBill){var r=0;e[l].bills.forEach((function(e){if(e.billTransactions&&e.billTransactions.length){var t=e.billTransactions.find((function(e){return e.headDisplay.toLowerCase()===n.toLowerCase()}));t&&(r+=t.headAmount)}})),i.push(t.currencyPipe.transform(r>0?r:0,t.currency.toString(),!0,t.roundFormat))}else e[l].bills.forEach((function(e){if(e.billTransactions&&e.billTransactions.length){var l=e.billTransactions.find((function(e){return e.headDisplay.toLowerCase()===n.toLowerCase()}));i.push(t.currencyPipe.transform(l?l.headAmount:0,t.currency.toString(),!0,t.roundFormat))}else i.push(t.currencyPipe.transform(0,t.currency.toString(),!0,t.roundFormat))}))}else i.push(t.currencyPipe.transform(0,t.currency.toString(),!0,t.roundFormat))})),o.forEach((function(n){if(e[l].isGroupBill){var a=0;if(e[l].billCharges&&e[l].billCharges.length){var o=e[l].billCharges.filter((function(e){return e.headDisplay.toLowerCase()===n.toLowerCase()}));o&&o.length&&o.forEach((function(e){a+=Number(e.headAmount)}))}i.push(t.currencyPipe.transform(a>0?a:0,t.currency.toString(),!0,t.roundFormat))}else if(e[l].billCharges&&e[l].billCharges.length){var r=e[l].billCharges.find((function(e){return e.headDisplay.toLowerCase()===n.toLowerCase()}));i.push(t.currencyPipe.transform(r?r.headAmount:0,t.currency.toString(),!0,t.roundFormat))}else i.push(t.currencyPipe.transform(0,t.currency.toString(),!0,t.roundFormat))})),i.push(t.currencyPipe.transform(e[l].billAmount,t.currency.toString(),!0,t.roundFormat)),i.push(t.currencyPipe.transform(e[l].paid,t.currency.toString(),!0,t.roundFormat)),n.push(i),r+=e[l].billAmount,s+=e[l].paid,i=[]},u=0;u<e.length;u++)c(u);i=[];for(var d=0;d<l.length-2;d++)i.push("");i.push(this.currencyPipe.transform(r,this.currency.toString(),!0,this.roundFormat)),i.push(this.currencyPipe.transform(s,this.currency.toString(),!0,this.roundFormat)),n.push(i),this.getSummaryDetailsReport(this.billMasterDetails,l,n,"Bill History")}},{key:"getSummaryDetailsReport",value:function(e,t,i,n){var l,a,o=new Image;o.src=this.filePath+"/uploads/"+(null===(a=null===(l=e[0])||void 0===l?void 0:l.client)||void 0===a?void 0:a.photo);var r=new Fe.default({orientation:"landscape",unit:"pt",format:"letter"}),s=L().format("M/D/YYYY hh:mm:ss a");Number(this.decimalPipe.transform(r.autoTable.previous.finalY,"1.0-0")),r.autoTable(t,i,{startX:10,startY:110,didDrawPage:function(t){var i,n,l,a;if(r.setFontSize(30),o&&e[0]&&e[0].client&&e[0].client.imageProperties&&e[0].client.imageProperties.length){var c=null===(n=null===(i=e[0])||void 0===i?void 0:i.client)||void 0===n?void 0:n.imageProperties.find((function(e){return"landscape"===e.imageType.trim().toLowerCase()}));c&&(o.onload=function(){r.addImage(o,c.imgX,c.imgY,c.imgW,c.imgH)})}r.setTextColor(25,118,210),r.setFontSize(9),r.setFont("Cambria"),r.setTextColor(0,0,0),r.text("Print Date: "+s,r.internal.pageSize.width-150,20),r.setFontSize(14),r.text("Bill History From "+Object(y.f)(null===(l=e[0])||void 0===l?void 0:l.fromDateLocal)+" To "+Object(y.f)(null===(a=e[0])||void 0===a?void 0:a.toDateLocal),r.internal.pageSize.width/2-140,90),r.setFontSize(9);var u="Page "+t.pageCount;"function"==typeof r.putTotalPages&&(r.setTextColor(0,0,0),r.rect(5,5,r.internal.pageSize.width-10,r.internal.pageSize.height-10,"S"),u=u),r.setFontSize(9);var d=r.internal.pageSize.height||r.internal.pageSize.getHeight();r.text(u,t.settings.margin.left,d-10)},styles:{overflow:"linebreak",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:100,left:20},theme:"grid",tableWidth:"auto",columnStyles:{0:{cellWidth:t.length>10?"40":"wrap",halign:"center"},1:{cellWidth:t.length>10?"40":"wrap",halign:"center"},2:{cellWidth:t.length>10?"40":"wrap",halign:"center"},3:{cellWidth:t.length>10?"60":"wrap",halign:"center"},4:{cellWidth:"wrap",halign:"right"},5:{cellWidth:"wrap",halign:"right"},6:{cellWidth:"wrap",halign:"right"},7:{cellWidth:"wrap",halign:"right"},8:{cellWidth:"wrap",halign:"right"},9:{cellWidth:"wrap",halign:"right"},10:{cellWidth:"wrap",halign:"right"},11:{cellWidth:"wrap",halign:"right"},12:{cellWidth:"wrap",halign:"right"},13:{cellWidth:"wrap",halign:"right"},14:{cellWidth:"wrap",halign:"right"},15:{cellWidth:"wrap",halign:"right"},16:{cellWidth:"wrap",halign:"right"},17:{cellWidth:"wrap",halign:"right"},18:{cellWidth:"wrap",halign:"right"},19:{cellWidth:"wrap",halign:"right"},20:{cellWidth:"wrap",halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){var t=e.column.index;if(0==t){var i=!1;if(e.table&&e.table.body&&e.table.body.length)for(var n=0;n<e.table.body.length;n++){var l=e.table.body[n].raw[t];if(l&&(i=l.length>30),i)break}i&&(e.cell.styles.cellWidth="5")}}});var c=r.output("blob");window.open(URL.createObjectURL(c))}},{key:"onSendInvoice",value:function(e){var t=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.selectedRows&&this.selectedRows.length?this.templateService.emailCustomTemplate({clientId:this.clientId,templateName:e.notificationType,notificationType:e.notificationType,billMasterDetails:this.selectedRows,isManual:i,isSkipExisting:e.isSkipExisting}).subscribe({next:function(e){e&&e.status?t.notificationMessage("Notifications send failed."+e.status,"red-snackbar"):e&&e.isSuccess&&t.notificationMessage("Notifications initiated,Please check notification logs.","green-snackbar"),n&&(t.reset(),t.onGetBillsHistory(t.manageParams))},error:function(e){t.notificationMessage("Notifications send failed.","red-snackbar")}}):this.notificationMessage("Please select Bills.","red-snackbar")}},{key:"onApprove",value:function(){var e=this;this.selectedRows&&this.selectedRows.length?this.billSettlementService.updateBillMasterApprovedStatus(this.selectedRows).subscribe({next:function(t){t?(e.notificationMessage("Invoice approved successfully","green-snackbar"),e.generateInvoice()):e.notificationMessage("Invoice approve failed","red-snackbar")},error:function(t){e.notificationMessage("Invoice approve failed","red-snackbar")}}):this.notificationMessage("Please select Bills","red-snackbar")}},{key:"getClientAlertSettings",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.templatesService.getClientAlertSettings(this.clientId).subscribe({next:function(i){if(i)if("Approval"===t){var n=i.filter((function(e){return e.notificationCategory&&e.notificationCategory.toLowerCase()==="bills".toLowerCase()&&e.condition&&e.condition.toLowerCase()=="After Invoice Approval".toLowerCase()&&1==e.isEnableAutoSend}));if(n&&n.length){var l=0;n.forEach((function(t){e.onSendInvoice({notificationType:t.notificationType,isSkipExisting:!1},!1,l==n.length-1),l+=1}))}else e.reset(),e.onGetBillsHistory(e.manageParams)}else{var a=i.filter((function(e){return e.notificationCategory&&e.notificationCategory.toLowerCase()==="bills".toLowerCase()})),o={alertSettings:a,billMasters:e.selectedRows};a?e.dialog.open(Et,{data:o}).afterClosed().subscribe((function(t){t&&e.onSendInvoice(t)})):(e.reset(),e.onGetBillsHistory(e.manageParams))}else e.notificationMessage("Invoice approved successfully.","green-snackbar"),e.reset(),e.onGetBillsHistory(e.manageParams),e.notificationMessage("No notification found to send.","red-snackbar")},error:function(t){e.notificationMessage("Invoice approved successfully.","green-snackbar"),e.reset(),e.onGetBillsHistory(e.manageParams),e.notificationMessage("Notifications send failed","red-snackbar")}})}},{key:"generateInvoice",value:function(){var e=this;this.billSettlementService.invoiceGeneration(this.selectedRows).subscribe({next:function(t){t&&t.isSuccess&&(e.notificationMessage("Invoice generation started successfully.","green-snackbar"),e.getClientAlertSettings("Approval"))},error:function(t){e.notificationMessage("Invoice generation failed.","red-snackbar")}})}},{key:"reset",value:function(){this.rejectedCount="",this.approvedCount="",this.fineCount="",this.penalityCount=""}},{key:"notificationMessage",value:function(e,t){this.snackbar.open(e,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[t]})}},{key:"onRejectDataRow",value:function(e){var t=this;e.type="Reject",this.dialog.open(lt,{data:e}).afterClosed().subscribe((function(){e&&t.onGetBillsHistory(t.manageParams)}))}},{key:"onFailDataRow",value:function(e){var t=this;e.isBillFailed=!0,this.billService.updateIsFailedStatusInBills(e.bills).subscribe({next:function(i){i?t.billService.UpdateIsBillFailedStatusInBillMaster(e).subscribe({next:function(e){e?(t.onGetBillsHistory(t.manageParams),t.notificationMessage("Moved to Failed Bills successfully","green-snackbar")):t.notificationMessage("Unable to fail the bill","red-snackbar")},error:function(e){t.notificationMessage("Unable to fail the bill","red-snackbar")}}):t.notificationMessage("Unable to fail the bill","red-snackbar")},error:function(e){t.notificationMessage("Unable to fail the bill","red-snackbar")}})}},{key:"onRegenerate",value:function(){var e=this;this.selectedRows&&this.selectedRows.length?this.billSettlementService.regenerateRejectedBillMasters(this.selectedRows).subscribe({next:function(t){t?(e.notificationMessage("Invoice regenerated successfully","green-snackbar"),e.reset(),e.onGetBillsHistory(e.manageParams)):e.notificationMessage("Invoice regeneration failed","red-snackbar")},error:function(t){e.notificationMessage("Invoice regeneration failed","red-snackbar")}}):this.notificationMessage("Please select Bills","red-snackbar")}},{key:"onUpdateRow",value:function(e){var t=this;if(e.billAmount!=e.creditNoteAmount){var i={billMasterId:e.id,vat:e.vat,vatAccountHeadId:e.vatAccountHeadId,ownerId:e.ownerId},n=[];if(e&&(e.bills.forEach((function(i){i.billTransactions&&i.billTransactions.length&&i.billTransactions.forEach((function(l){if(i.isDifferentiateBill){var a=null;if(n&&n.length){if((a=n.find((function(e){return e.headDisplay.trim().toLowerCase()===l.headDisplay.toLowerCase()})))&&0==a.fixedAmount){var o=n.indexOf(a);o>-1&&n.splice(o,1);var r={rowNumber:n.length+1,billHeadId:l.billHeadId,taxId:0,headDisplay:l.headDisplay,fixedAmount:l.headAmount,fixedAmountLocal:t.currencyPipe.transform(l.headAmount,t.currency.toString(),!0,t.roundFormat),creditNoteAmount:0,isVAT:l.isVAT,position:l.position};n.push(r)}}else if(l.isDiscount){var s=null;e.billDiscounts&&e.billDiscounts.length&&(s=e.billDiscounts.find((function(e){return e.billHeadId===l.billHeadId})));var c=n.find((function(e){return e.billHeadId===l.billHeadId}));if(c&&s)c.fixedAmount=l.headAmount-s.headAmount,c.fixedAmountLocal=t.currencyPipe.transform(c.fixedAmount,t.currency.toString(),!0,t.roundFormat);else if(s){var u=l.headAmount-s.headAmount,d={rowNumber:n.length+1,billHeadId:l.billHeadId,taxId:0,headDisplay:l.headDisplay,fixedAmount:u,fixedAmountLocal:t.currencyPipe.transform(u,t.currency.toString(),!0,t.roundFormat),creditNoteAmount:0,isVAT:l.isVAT,position:l.position};n.push(d)}}else{var m={rowNumber:n.length+1,billHeadId:l.billHeadId,taxId:0,headDisplay:l.headDisplay,fixedAmount:l.headAmount,fixedAmountLocal:t.currencyPipe.transform(l.headAmount,t.currency.toString(),!0,t.roundFormat),creditNoteAmount:0,isVAT:l.isVAT,position:l.position};n.push(m)}}else if(l.isDiscount){var h=null;e.billDiscounts&&e.billDiscounts.length&&(h=e.billDiscounts.find((function(e){return e.billHeadId===l.billHeadId})));var b=n.find((function(e){return e.billHeadId===l.billHeadId}));if(b&&h)b.fixedAmount=b.fixedAmount-h.headAmount,b.fixedAmountLocal=t.currencyPipe.transform(b.fixedAmount,t.currency.toString(),!0,t.roundFormat);else if(h){var f=l.headAmount-h.headAmount,p={rowNumber:n.length+1,billHeadId:l.billHeadId,taxId:0,headDisplay:l.headDisplay,fixedAmount:f,fixedAmountLocal:t.currencyPipe.transform(f,t.currency.toString(),!0,t.roundFormat),creditNoteAmount:0,isVAT:l.isVAT,position:l.position};n.push(p)}}else{var g={rowNumber:n.length+1,billHeadId:l.billHeadId,taxId:0,headDisplay:l.headDisplay,fixedAmount:l.headAmount,fixedAmountLocal:t.currencyPipe.transform(l.headAmount,t.currency.toString(),!0,t.roundFormat),creditNoteAmount:0,isVAT:l.isVAT,position:l.position};n.push(g)}}))})),e.billCharges.forEach((function(i){if(i.isDiscount){var l=null;e.billDiscounts&&e.billDiscounts.length&&(l=e.billDiscounts.find((function(e){return e.billHeadId===i.billHeadId})));var a=n.find((function(e){return e.billHeadId===i.billHeadId}));if(a&&l)a.fixedAmount=a.fixedAmount-l.headAmount,a.fixedAmountLocal=t.currencyPipe.transform(a.fixedAmount,t.currency.toString(),!0,t.roundFormat);else if(l){var o=i.headAmount-l.headAmount,r={rowNumber:n.length+1,billHeadId:i.billHeadId,taxId:0,headDisplay:i.headDisplay,fixedAmount:o,fixedAmountLocal:t.currencyPipe.transform(o,t.currency.toString(),!0,t.roundFormat),creditNoteAmount:0,isVAT:i.isVAT,position:i.position};n.push(r)}}else{var s={rowNumber:n.length+1,billHeadId:i.billHeadId,taxId:0,headDisplay:i.headDisplay,fixedAmount:i.headAmount,fixedAmountLocal:t.currencyPipe.transform(i.headAmount,t.currency.toString(),!0,t.roundFormat),creditNoteAmount:0,isVAT:i.isVAT,position:i.position};n.push(s)}})),e.billTaxDetails&&e.billTaxDetails.length&&e.billTaxDetails.forEach((function(e){var i,l,a=0;n&&n.length&&(a=null!==(l=null===(i=n.sort((function(e,t){return e.position-t.position}))[n.length-1])||void 0===i?void 0:i.position)&&void 0!==l?l:0);var o={rowNumber:n.length+1,billHeadId:0,taxId:e.taxId,headDisplay:e.taxDisplayName,fixedAmount:e.taxAmount,fixedAmountLocal:t.currencyPipe.transform(e.taxAmount,t.currency.toString(),!0,t.roundFormat),creditNoteAmount:0,isVAT:!1,formulaFieldName:e.computationTypeName,position:a,disabled:!0,value:e.taxValue};n.push(o)}))),n&&n.length){n=n.sort((function(e,t){return e.position-t.position}));for(var l=0;l<n.length;++l)n[l].rowNumber=l+1}i.creditNoteTransactions=n,e.creditNotes&&e.creditNotes.length&&e.creditNotes.forEach((function(e){e.creditNoteTransactions.forEach((function(e){var n=i.creditNoteTransactions.find((function(t){return t.billHeadId===e.billHeadId}));n&&(n.fixedAmount=n.fixedAmount-e.creditNoteAmount,n.fixedAmountLocal=t.currencyPipe.transform(n.fixedAmount,t.currency.toString(),!0,t.roundFormat))}))})),this.dialog.open(Lt,{height:"550px",data:i}).afterClosed().subscribe((function(e){e&&t.onGetBillsHistory(t.manageParams)}))}else this.notificationMessage("Credit note amount can not be more than Bill amount","red-snackbar")}},{key:"downloadBillFormat2LargeReport",value:function(e){var t,i,n,l,a,o,r,s,c,u,d,m,h,b,f,p,g,v,C,S,T=this,P=[],D=[],w=[],N=[],x=[],k=[],A=[],F=[],R=[],I=[],O=["Unit No","Meter No","Previous Reading","Present Reading","Consumption"],W=["Bill No","Meter No","Charges","Consumption","Measuring Unit","Tariff","Total"];x.push({label:"Bill No",value:null!==(t=null==e?void 0:e.billNumber)&&void 0!==t?t:""},{label:"Date of issue",value:null!==(i=null==e?void 0:e.billDateLocal)&&void 0!==i?i:""},{label:"Due Date",value:null!==(n=null==e?void 0:e.dueDateLocal)&&void 0!==n?n:""}),k.push({label:"Customer Name",value:null!==(l=null==e?void 0:e.ownerName)&&void 0!==l?l:""},{label:"Customer AccountNumber",value:null!==(a=null==e?void 0:e.accountNumber)&&void 0!==a?a:""},{label:"Unit No",value:null!==(o=null==e?void 0:e.unitNumber)&&void 0!==o?o:""},{label:"Address",value:null!==(s=null===(r=null==e?void 0:e.receiverDetails[0])||void 0===r?void 0:r.address1)&&void 0!==s?s:""},{label:"City",value:null!==(u=null===(c=null==e?void 0:e.receiverDetails[0])||void 0===c?void 0:c.city)&&void 0!==u?u:""},{label:"P.O Box",value:null!==(m=null===(d=null==e?void 0:e.receiverDetails[0])||void 0===d?void 0:d.zipPostalCode)&&void 0!==m?m:""},{label:"Phone number",value:null!==(b=null===(h=null==e?void 0:e.receiverDetails[0])||void 0===h?void 0:h.phoneNumber)&&void 0!==b?b:""},{label:"Fax Number",value:""},{label:"Client",value:null!==(p=null===(f=null==e?void 0:e.client)||void 0===f?void 0:f.clientName)&&void 0!==p?p:""},{label:"Client TRN",value:null!==(v=null===(g=null==e?void 0:e.client)||void 0===g?void 0:g.trnNo)&&void 0!==v?v:""});var M=!1,L=!1,B=!1,z=!1;if(e&&e.bills&&e.bills.length){var U=Array.from(new Set(e.bills.map((function(e){return e.billNumber})))),E=Array.from(new Set(e.bills.map((function(e){return e.unitNumber})))),j=Array.from(new Set(e.bills.map((function(e){return e.deviceName}))));if(M=!!(U&&U.length>1),L=!!(E&&E.length>1),!(z=!!(j&&j.length>1))){var H=W.findIndex((function(e){return"Meter No"===e}));H>-1&&W.splice(H,1)}if(M?x.splice(0,1):W.splice(0,1),L){var Y=k.findIndex((function(e){return"Unit No"===e.label}));k.splice(Y,1)}else O.splice(0,1);var V=Array.from(new Set(e.bills.filter((function(e){return e.billTariffDetails&&e.billTariffDetails.length})))),_=Array.from(new Set(e.bills.filter((function(e){return!e.billTariffDetails||0===e.billTariffDetails.length}))));if(_&&_.length&&_&&_.length&&(B=!0),_&&_.length&&!V&&(B=!0),V&&V.length&&(!_||0==_.length))for(var G=0;G<V.length;G++)if(V[G].billTransactions.find((function(e){return!e.tariffId}))){B=!0;break}}if(!B){var X=W.findIndex((function(e){return"Tariff"===e}));X&&W.splice(X,1)}for(var q=0;q<e.bills.length;q++){if(this.consumptionRoundOffFormat=null!==(C=Object(y.e)("ConsumptionRoundOff",e.bills[q].utilityTypeId))&&void 0!==C?C:this.envService.consumptionRoundOffFormat,L&&P.push(e.bills[q].unitNumber),P.push(e.bills[q].deviceName),P.push(this.decimalPipe.transform(e.bills[q].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[q].measuringUnit),P.push(this.decimalPipe.transform(e.bills[q].presentReading,this.consumptionRoundOffFormat)+" "+e.bills[q].measuringUnit),e.bills[q].isDifferentiateBill){if(z){z=!1;var $=W.findIndex((function(e){return"Meter No"===e}));$>-1&&W.splice($,1)}P.push(this.decimalPipe.transform(e.bills[q].presentReading-e.bills[q].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[q].measuringUnit)}else P.push(this.decimalPipe.transform(e.bills[q].consumption,this.consumptionRoundOffFormat)+" "+e.bills[q].measuringUnit);"BTU"===e.bills[q].utilityType&&e.bills[q].billTransactions&&e.bills[q].billTransactions.length&&e.bills[q].billTransactions.findIndex((function(e){return e.measuringUnitId&&2===e.measuringUnitId}))>-1&&(0==q&&O.push("Consumption TR-HR"),P.push(this.decimalPipe.transform(.284345*e.bills[q].consumption,this.consumptionRoundOffFormat))),D.push(P),P=[]}for(var J=0,Q=0;Q<e.bills.length;Q++){var K=e.bills[Q];this.consumptionRoundOffFormat=null!==(S=Object(y.e)("ConsumptionRoundOff",e.bills[Q].utilityTypeId))&&void 0!==S?S:this.envService.consumptionRoundOffFormat;for(var Z=0;Z<K.billTransactions.length;Z++)M&&P.push(K.billNumber),z&&P.push(K.deviceName),P.push(K.billTransactions[Z].headDisplay),"BTU"===K.utilityType&&K.billTransactions&&K.billTransactions.length&&K.billTransactions[Z]&&K.billTransactions[Z].measuringUnitId&&2===K.billTransactions[Z].measuringUnitId?(P.push(this.decimalPipe.transform(.284345*K.consumption,this.consumptionRoundOffFormat)),P.push("TR-HR"),B&&K.billTariffDetails&&K.billTariffDetails.length&&K.billTransactions[Z].tariffId?P.push("-"):B&&P.push(K.billTransactions[Z].rate)):(P.push(this.decimalPipe.transform(K.consumption,this.consumptionRoundOffFormat)),P.push(K.measuringUnit),B&&K.billTariffDetails&&K.billTariffDetails.length&&K.billTransactions[Z].tariffId?P.push("-"):B&&P.push(K.billTransactions[Z].rate)),P.push(this.currencyPipe.transform(K.billTransactions[Z].headAmount,this.currency.toString(),!0,this.roundFormat)),F.push(P),P=[],J+=K.billTransactions[Z].headAmount}if(P.push(e.accountNumber),P.push(e.fromDateLocal+"-"+e.toDateLocal),P.push(this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)),P.push(e.billAmountLocal),N.push(P),e.billCharges&&e.billCharges.length&&(e.billCharges.sort((function(e,t){return e.position-t.position})).forEach((function(e){if("VAT"!==e.headDisplay){var t=w.find((function(t){return t.label===e.headDisplay}));t?t.value+=e.headAmount:w.push({label:e.headDisplay,value:e.headAmount})}})),w.forEach((function(e){R.push({label:e.label,value:T.currencyPipe.transform(e.value,T.currency.toString(),!0,T.roundFormat)}),J+=e.value}))),R.push({label:"Total Charges for Current Period",value:this.currencyPipe.transform(J,this.currency.toString(),!0,this.roundFormat)}),e.billDiscounts&&e.billDiscounts.length){var ee=0;e.billDiscounts.forEach((function(e){ee+=e.headAmount})),R.push({label:"Total Discount",value:this.currencyPipe.transform(ee,this.currency.toString(),!0,this.roundFormat)})}e.billTaxDetails.forEach((function(e){var t=R.find((function(t){return t.label===e.taxDisplayName}));if(t){var i=Number(t.value.replace(T.currency,"").trim())+Number(e.taxAmount);t.value=T.currencyPipe.transform(i,T.currency.toString(),!0,T.roundFormat)}else R.push({label:e.taxDisplayName,value:T.currencyPipe.transform(e.taxAmount,T.currency.toString(),!0,T.roundFormat)})})),R.push({label:"Previous Outstanding Amount",value:this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)},{label:"Total Amount Due",value:this.currencyPipe.transform(e.billAmount+e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)}),A.push({firstItem:"Billing period",secondItem:"From:",thirdItem:e.fromDateLocal,fourthItem:"To:",fifthItem:e.toDateLocal}),Array.from(new Set(e.bills.map((function(e){return e.billTariffDetails}))));var te=[],ie=[],ne=!1;P=[],e&&e.bills&&e.bills.length&&e.bills.forEach((function(e){T.consumptionRoundOffFormat=Object(y.e)("ConsumptionRoundOff",e.utilityTypeId),ie=[];var t="Unit Number : "+e.unitNumber+" - Meter Number : "+e.deviceName;if(e.billTariffDetails&&e.billTariffDetails.length)for(var i=0;i<e.billTariffDetails.length;i++){if(e.billTariffDetails[i].slabSettingsId&&e.billTariffDetails[i].slabSettingsId>0){var n=e.billTariffDetails[i].season;Number(e.billTariffDetails[i].peakType)<Number(e.billTariffDetails[i].consumption)&&(n=e.billTariffDetails[i].peakType+" - "+e.billTariffDetails[i].consumption),0==i&&(ne=!0,te=["Slab","Consumption","Rate","Amount "]),ie&&ie.length?ie.find((function(e){return e===t}))||T.createUnitMeterNumberRow(t,te.length,I):(ie.push(t),T.createUnitMeterNumberRow(t,te.length,I)),P.push(n),P.push(T.decimalPipe.transform(e.billTariffDetails[i].consumption,T.consumptionRoundOffFormat)),P.push(e.billTariffDetails[i].rate),P.push(T.currencyPipe.transform(e.billTariffDetails[i].amount,T.currency.toString(),!0,T.roundFormat))}else 0==e.billTariffDetails[i].slabSettingsId&&(0==i&&(te=["Season","Week Type","Peak Type","Consumption","Rate","Amount "]),ie&&ie.length?ie.find((function(e){return e===t}))||T.createUnitMeterNumberRow(t,te.length,I):(ie.push(t),T.createUnitMeterNumberRow(t,te.length,I)),P.push(e.billTariffDetails[i].season),P.push(e.billTariffDetails[i].weekType),P.push(e.billTariffDetails[i].peakType),P.push(T.decimalPipe.transform(e.billTariffDetails[i].consumption,T.consumptionRoundOffFormat)),P.push(e.billTariffDetails[i].rate),P.push(T.currencyPipe.transform(e.billTariffDetails[i].amount,T.currency.toString(),!0,T.roundFormat)));I.push(P),P=[]}})),this.getBillFormat2LargeReport(O,D,w,["Customer AccountNumber","Billing Period","Previous Due","Total for current period"],N,x,k,A,"Bill History",W,F,e,R,te,I,ne)}},{key:"getBillFormat2LargeReport",value:function(e,t,i,n,l,a,o,r,s,c,u,d,m,h,b){var f,p,g,v,y,C,S,T=arguments.length>15&&void 0!==arguments[15]&&arguments[15];(new Image).src=this.filePath+"/uploads/"+(null===(f=null==d?void 0:d.client)||void 0===f?void 0:f.photo);var P=new Fe.default({orientation:"portrait",unit:"pt",format:"letter"}),D=null!==(g=null===(p=null==d?void 0:d.client)||void 0===p?void 0:p.clientName)&&void 0!==g?g:"",w=P.getTextWidth(D.trim())+4;P.setTextColor(0,0,0),P.setFontSize(17),P.setFont("Cambria"),P.text(D,Number(P.internal.pageSize.width/2)-Number(0!=w?w/2:0),23),P.setDrawColor(0,0,0),P.line(Number(P.internal.pageSize.width/2)-Number(0!=w?w/2:0),26,Number(P.internal.pageSize.width/2)-Number(0!=w?w/2:0)+w,26),P.setFont("Cambria","normal"),P.setFontSize(14),P.text("Billing Statement",35,46),this.addImage(P,d),P.autoTable("",a,{startX:10,startY:55,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:35},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:150,halign:"left"},1:{cellWidth:190,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"},didParseCell:function(e){e.cell.styles.cellPadding=1}});var N=Math.round(P.autoTable.previous.finalY);P.autoTable("",r,{startX:10,startY:N,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:35},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:150,halign:"left"},1:{cellWidth:95,halign:"center"},2:{cellWidth:95,halign:"center"},3:{cellWidth:97,halign:"center"},4:{cellWidth:97,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0]},didParseCell:function(e){e.cell.styles.cellPadding=1}});var x=Math.round(P.autoTable.previous.finalY);P.autoTable("",o,{startX:10,startY:x,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:35},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:150,halign:"left"},1:{cellWidth:384,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0]},didParseCell:function(e){e.cell.styles.cellPadding=1}});var k=function(e){var t="Page "+e.pageCount;"function"==typeof P.putTotalPages&&(t=t),P.setFontSize(9)},A=Math.round(P.autoTable.previous.finalY);P.setFont("Cambria"),P.setFontSize(10),P.text("Meter Read-Outs".toUpperCase(),35,A+20),P.autoTable(e,t,{startX:10,startY:A+40,showHead:"everyPage",didDrawPage:k,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:35},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:6==e.length?100:4==e.length?182:150,halign:"center"},1:{cellWidth:6==e.length?95:4==e.length?142:120,halign:"center"},2:{cellWidth:4==e.length?105:95,halign:"center"},3:{cellWidth:4==e.length?105:95,halign:"center"},4:{cellWidth:74,halign:"center"},5:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}});var F=Number(this.decimalPipe.transform(P.autoTable.previous.finalY,"1.0-0"));u&&u.length&&(P.setFontSize(10),P.text("Charges Breakdown".toUpperCase(),35,F+20),P.autoTable(c,u,{startX:10,startY:F+40,showHead:"everyPage",didDrawPage:k,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:35},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{columnWidth:6==c.length?80:4==c.length?214:7==c.length?75:215,halign:"center"},1:{columnWidth:6==c.length?145:4==c.length?160:7==c.length?75:85,halign:"center"},2:{cellWidth:85,halign:"center"},3:{cellWidth:75,halign:4==c.length?"right":"center"},4:{cellWidth:74,halign:6==c.length||7==c.length?"center":"right"},5:{cellWidth:75,halign:"center"},6:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}));var R=Number(this.decimalPipe.transform(P.autoTable.previous.finalY,"1.0-0")),I=R;T?(P.autoTable(h,b,{startX:40,startY:R+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{columnWidth:4===h.length?200:110,halign:"center"},1:{columnWidth:4===h.length?117:140,halign:"center"},2:{columnWidth:4===h.length?117:97,halign:"center"},3:{columnWidth:4===h.length?100:97,halign:4===h.length?"right":"center"},4:{columnWidth:90,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}),I=Number(this.decimalPipe.transform(P.autoTable.previous.finalY,"1.0-0"))):(P.autoTable(h,b,{startX:40,startY:R+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{columnWidth:6===h.length?130:85,halign:"center"},1:{columnWidth:6===h.length?85:75,halign:"center"},2:{columnWidth:6===h.length?85:75,halign:"center"},3:{columnWidth:6===h.length?85:75,halign:"center"},4:{columnWidth:74,halign:"center"},5:{columnWidth:75,halign:6===h.length?"right":"center"},6:{columnWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1;var t=e.cell.raw;t&&"string"==typeof t&&t.startsWith("Unit")&&(e.cell.styles.fontStyle="bold",e.cell.colSpan=h.length,e.cell.styles.halign="left")}}),I=Number(this.decimalPipe.transform(P.autoTable.previous.finalY,"1.0-0")));var O=P.internal.pageSize.height;O-I<200&&(P.addPage(),I=N,O=370+N),P.autoTable("",m,{startX:10,startY:I+20,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{bottom:40,left:250},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:244,fontStyle:"italic"},1:{cellWidth:75}},didParseCell:function(e){1==e.column.index&&(e.cell.styles.halign="right"),e.cell.styles.cellPadding=1},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});var W=Number(this.decimalPipe.transform(P.autoTable.previous.finalY,"1.0-0"));if((null===(y=null===(v=null==d?void 0:d.client)||void 0===v?void 0:v.termsConditions[0])||void 0===y?void 0:y.termsAndCondition)&&(P.setFillColor(241,241,244),P.rect(35,W+20,535,80,"FD"),P.setFillColor(0,0,0),P.setFontSize(9),P.text(null===(S=null===(C=null==d?void 0:d.client)||void 0===C?void 0:C.termsConditions[0])||void 0===S?void 0:S.termsAndCondition.replace("{{ClientName}}",d.client.clientName).replace("{{TRNNumber}}",d.client.trnNo).replace("{{Currency}}",this.currency),65,W+30)),P.setTextColor(0,0,0),P.line(5,W+105,607,W+105),W>O-190){P.addPage();var M="Page "+P.getNumberOfPages();P.setFontSize(10),P.text(M,10,O-10),O=150}P.text("Notice :- Please tear and attach the slip  along with your payment",35,O-80),P.autoTable(n,l,{startX:10,startY:O-70,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:35},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:120,halign:"center"},1:{cellWidth:200,halign:"center"},2:{cellWidth:100,halign:"right"},3:{cellWidth:120,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}});var L=P.output("datauristring");this.pdfsToMerge.push(L)}},{key:"downloadBillFormat2Report",value:function(e){var t,i,n,l,a,o,r,s,c,u,d,m,h,b,f,p,g,v,C,S,T=this,P=[],D=[],w=[],N=[],x=[],k=[],A=[],F=[],R=[],I=[],O=["Unit No","Meter No","Previous Reading","Present Reading","Consumption"],W=["Bill No","Meter No","Charges","Consumption","Measuring Unit","Tariff","Total"];x.push({label:"Bill No",value:null!==(t=null==e?void 0:e.billNumber)&&void 0!==t?t:""},{label:"Date of issue",value:null!==(i=null==e?void 0:e.billDateLocal)&&void 0!==i?i:""},{label:"Due Date",value:null!==(n=null==e?void 0:e.dueDateLocal)&&void 0!==n?n:""}),k.push({label:"Customer Name",value:null!==(l=null==e?void 0:e.ownerName)&&void 0!==l?l:""},{label:"Customer AccountNumber",value:null!==(a=null==e?void 0:e.accountNumber)&&void 0!==a?a:""},{label:"Unit No",value:null!==(o=null==e?void 0:e.unitNumber)&&void 0!==o?o:""},{label:"Address",value:null!==(s=null===(r=null==e?void 0:e.receiverDetails[0])||void 0===r?void 0:r.address1)&&void 0!==s?s:""},{label:"City",value:null!==(u=null===(c=null==e?void 0:e.receiverDetails[0])||void 0===c?void 0:c.city)&&void 0!==u?u:""},{label:"P.O Box",value:null!==(m=null===(d=null==e?void 0:e.receiverDetails[0])||void 0===d?void 0:d.zipPostalCode)&&void 0!==m?m:""},{label:"Phone number",value:null!==(b=null===(h=null==e?void 0:e.receiverDetails[0])||void 0===h?void 0:h.phoneNumber)&&void 0!==b?b:""},{label:"Fax Number",value:""},{label:"Client",value:null!==(p=null===(f=null==e?void 0:e.client)||void 0===f?void 0:f.clientName)&&void 0!==p?p:""},{label:"Client TRN",value:null!==(v=null===(g=null==e?void 0:e.client)||void 0===g?void 0:g.trnNo)&&void 0!==v?v:""});var M=!1,L=!1,B=!1,z=!1;if(e&&e.bills&&e.bills.length){var U=Array.from(new Set(e.bills.map((function(e){return e.billNumber})))),E=Array.from(new Set(e.bills.map((function(e){return e.unitNumber})))),j=Array.from(new Set(e.bills.map((function(e){return e.deviceName}))));if(M=!!(U&&U.length>1),L=!!(E&&E.length>1),!(z=!!(j&&j.length>1))){var H=W.findIndex((function(e){return"Meter No"===e}));H>-1&&W.splice(H,1)}if(M?x.splice(0,1):W.splice(0,1),L){var Y=k.findIndex((function(e){return"Unit No"===e.label}));k.splice(Y,1)}else O.splice(0,1);var V=Array.from(new Set(e.bills.filter((function(e){return e.billTariffDetails&&e.billTariffDetails.length})))),_=Array.from(new Set(e.bills.filter((function(e){return!e.billTariffDetails||0===e.billTariffDetails.length}))));if(_&&_.length&&_&&_.length&&(B=!0),_&&_.length&&!V&&(B=!0),V&&V.length&&(!_||0==_.length))for(var G=0;G<V.length;G++)if(V[G].billTransactions.find((function(e){return!e.tariffId}))){B=!0;break}}if(!B){var X=W.findIndex((function(e){return"Tariff"===e}));X&&W.splice(X,1)}for(var q=0;q<e.bills.length;q++){if(this.consumptionRoundOffFormat=null!==(C=Object(y.e)("ConsumptionRoundOff",e.bills[q].utilityTypeId))&&void 0!==C?C:this.envService.consumptionRoundOffFormat,L&&P.push(e.unitNumber),P.push(e.bills[q].deviceName),P.push(this.decimalPipe.transform(e.bills[q].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[q].measuringUnit),P.push(this.decimalPipe.transform(e.bills[q].presentReading,this.consumptionRoundOffFormat)+" "+e.bills[q].measuringUnit),e.bills[q].isDifferentiateBill){if(z){z=!1;var $=W.findIndex((function(e){return"Meter No"===e}));$>-1&&W.splice($,1)}P.push(this.decimalPipe.transform(e.bills[q].presentReading-e.bills[q].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[q].measuringUnit)}else P.push(this.decimalPipe.transform(e.bills[q].consumption,this.consumptionRoundOffFormat)+" "+e.bills[q].measuringUnit);"BTU"===e.bills[q].utilityType&&e.bills[q].billTransactions&&e.bills[q].billTransactions.length&&e.bills[q].billTransactions.findIndex((function(e){return e.measuringUnitId&&2===e.measuringUnitId}))>-1&&(0==q&&O.push("Consumption TR-HR"),P.push(this.decimalPipe.transform(.284345*e.bills[q].consumption,this.consumptionRoundOffFormat))),D.push(P),P=[]}for(var J=0,Q=0;Q<e.bills.length;Q++){var K=e.bills[Q];this.consumptionRoundOffFormat=null!==(S=Object(y.e)("ConsumptionRoundOff",e.bills[Q].utilityTypeId))&&void 0!==S?S:this.envService.consumptionRoundOffFormat;for(var Z=0;Z<K.billTransactions.length;Z++)M&&P.push(K.billNumber),z&&P.push(K.deviceName),P.push(K.billTransactions[Z].headDisplay),"BTU"===K.utilityType&&K.billTransactions&&K.billTransactions.length&&K.billTransactions[Z]&&K.billTransactions[Z].measuringUnitId&&2===K.billTransactions[Z].measuringUnitId?(P.push(this.decimalPipe.transform(.284345*K.consumption,this.consumptionRoundOffFormat)),P.push("TR-HR"),B&&K.billTariffDetails&&K.billTariffDetails.length&&K.billTransactions[Z].tariffId?P.push("-"):B&&P.push(K.billTransactions[Z].rate)):(P.push(this.decimalPipe.transform(K.consumption,this.consumptionRoundOffFormat)),P.push(K.measuringUnit),B&&K.billTariffDetails&&K.billTariffDetails.length&&K.billTransactions[Z].tariffId?P.push("-"):B&&P.push(K.billTransactions[Z].rate)),P.push(this.currencyPipe.transform(K.billTransactions[Z].headAmount,this.currency.toString(),!0,this.roundFormat)),F.push(P),P=[],J+=K.billTransactions[Z].headAmount}if(P.push(e.accountNumber),P.push(e.fromDateLocal+"-"+e.toDateLocal),P.push(this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)),P.push(e.billAmountLocal),N.push(P),e.billCharges&&e.billCharges.length&&(e.billCharges.sort((function(e,t){return e.position-t.position})).forEach((function(e){if("VAT"!==e.headDisplay){var t=w.find((function(t){return t.label===e.headDisplay}));t?t.value+=e.headAmount:w.push({label:e.headDisplay,value:e.headAmount})}})),w.forEach((function(e){R.push({label:e.label,value:T.currencyPipe.transform(e.value,T.currency.toString(),!0,T.roundFormat)})}))),e.billCharges.find((function(e){return"VAT"===e.headDisplay})),R.push({label:"Total consumption charge for Current Period",value:this.currencyPipe.transform(J,this.currency.toString(),!0,this.roundFormat)}),e.billDiscounts&&e.billDiscounts.length){var ee=0;e.billDiscounts.forEach((function(e){ee+=e.headAmount})),R.push({label:"Total Discount",value:this.currencyPipe.transform(ee,this.currency.toString(),!0,this.roundFormat)})}e.billTaxDetails.forEach((function(e){var t=R.find((function(t){return t.label===e.taxDisplayName}));if(t){var i=Number(t.value.replace(T.currency,"").trim())+Number(e.taxAmount);t.value=T.currencyPipe.transform(i,T.currency.toString(),!0,T.roundFormat)}else R.push({label:e.taxDisplayName,value:T.currencyPipe.transform(e.taxAmount,T.currency.toString(),!0,T.roundFormat)})})),R.push({label:"Previous Outstanding Amount",value:this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)},{label:"Total Amount Due",value:this.currencyPipe.transform(e.billAmount+e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)}),A.push({firstItem:"Billing period",secondItem:"From:",thirdItem:e.fromDateLocal,fourthItem:"To:",fifthItem:e.toDateLocal}),Array.from(new Set(e.bills.map((function(e){return e.billTariffDetails}))));var te=[],ie=!1,ne=[];P=[],e&&e.bills&&e.bills.length&&e.bills.forEach((function(e){var t;T.consumptionRoundOffFormat=null!==(t=Object(y.e)("ConsumptionRoundOff",e.utilityTypeId))&&void 0!==t?t:T.envService.consumptionRoundOffFormat,ne=[];var i="Unit Number : "+e.unitNumber+" - Meter Number : "+e.deviceName;if(e.billTariffDetails&&e.billTariffDetails.length)for(var n=0;n<e.billTariffDetails.length;n++){if(e.billTariffDetails[n].slabSettingsId&&e.billTariffDetails[n].slabSettingsId>0){var l=e.billTariffDetails[n].season;Number(e.billTariffDetails[n].peakType)<Number(e.billTariffDetails[n].consumption)&&(l=e.billTariffDetails[n].peakType+" - "+e.billTariffDetails[n].consumption),0==n&&(ie=!0,te=["Slab","Consumption","Rate","Amount "]),ne&&ne.length?ne.find((function(e){return e===i}))||T.createUnitMeterNumberRow(i,te.length,I):(ne.push(i),T.createUnitMeterNumberRow(i,te.length,I)),P.push(l),P.push(T.decimalPipe.transform(e.billTariffDetails[n].consumption,T.consumptionRoundOffFormat)),P.push(e.billTariffDetails[n].rate),P.push(T.currencyPipe.transform(e.billTariffDetails[n].amount,T.currency.toString(),!0,T.roundFormat))}else 0==e.billTariffDetails[n].slabSettingsId&&(0==n&&(te=["Season","Week Type","Peak Type","Consumption","Rate","Amount "]),ne&&ne.length?ne.find((function(e){return e===i}))||T.createUnitMeterNumberRow(i,te.length,I):(ne.push(i),T.createUnitMeterNumberRow(i,te.length,I)),P.push(e.billTariffDetails[n].season),P.push(e.billTariffDetails[n].weekType),P.push(e.billTariffDetails[n].peakType),P.push(T.decimalPipe.transform(e.billTariffDetails[n].consumption,T.consumptionRoundOffFormat)),P.push(e.billTariffDetails[n].rate),P.push(T.currencyPipe.transform(e.billTariffDetails[n].amount,T.currency.toString(),!0,T.roundFormat)));I.push(P),P=[]}})),this.getBillFormat2Report(O,D,w,["Customer AccountNumber","Billing Period","Previous Due","Total for current period"],N,x,k,A,"Sample Report",W,F,e,R,te,I,ie)}},{key:"getBillFormat2Report",value:function(e,t,i,n,l,a,o,r,s,c,u,d,m,h,b){var f,p,g,v,y,C,S=arguments.length>15&&void 0!==arguments[15]&&arguments[15],T=new Fe.default({orientation:"portrait",unit:"pt",format:"letter"}),P=null!==(p=null===(f=null==d?void 0:d.client)||void 0===f?void 0:f.clientName)&&void 0!==p?p:"",D=T.getTextWidth(P.trim());T.setTextColor(0,0,0),T.setFontSize(17),T.setFont("Cambria"),T.text(P,Number(T.internal.pageSize.width/2)-Number(0!=D?D/2:0),18),this.addImage(T,d),T.setLineWidth(.1),T.line(Number(T.internal.pageSize.width/2)-Number(0!=D?D/2:0),21,Number(T.internal.pageSize.width/2)-Number(0!=D?D/2:0)+D,21),T.setFontSize(13),T.setLineWidth(.1),T.setFontSize(14),T.text("Billing Statement",30,41),T.autoTable("",a,{startX:10,startY:50,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:150,halign:"left"},1:{cellWidth:190,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"},didParseCell:function(e){e.cell.styles.cellPadding=1}});var w=Number(this.decimalPipe.transform(T.autoTable.previous.finalY,"1.0-0"));T.autoTable("",r,{startX:10,startY:w,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:150,halign:"left"},1:{cellWidth:95,halign:"center"},2:{cellWidth:95,halign:"center"},3:{cellWidth:97,halign:"center"},4:{cellWidth:97,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0]},didParseCell:function(e){e.cell.styles.cellPadding=1}});var N=Number(this.decimalPipe.transform(T.autoTable.previous.finalY,"1.0-0"));T.autoTable("",o,{startX:10,startY:N,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:150,halign:"left"},1:{cellWidth:384,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0]},didParseCell:function(e){e.cell.styles.cellPadding=1}});var x=Number(this.decimalPipe.transform(T.autoTable.previous.finalY,"1.0-0"));T.setFont("Cambria"),T.setFontSize(10),T.text("Meter Read-Outs".toUpperCase(),30,x+15),T.autoTable(e,t,{startX:10,startY:x+30,didDrawPage:function(e){var t="Page "+e.pageCount;T.setFontSize(10);var i=T.internal.pageSize.height||T.internal.pageSize.getHeight();T.text(t,e.settings.margin.left,i-10)},styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:6==e.length?100:4==e.length?182:150,halign:"center"},1:{cellWidth:6==e.length?95:4==e.length?142:120,halign:"center"},2:{cellWidth:4==e.length?105:95,halign:"center"},3:{cellWidth:4==e.length?105:95,halign:"center"},4:{cellWidth:74,halign:"center"},5:{cellWidth:75,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}});var k=Number(this.decimalPipe.transform(T.autoTable.previous.finalY,"1.0-0"));u&&u.length&&(T.setFontSize(10),T.text("Charges Breakdown".toUpperCase(),30,k+15),T.autoTable(c,u,{startX:10,startY:k+30,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{columnWidth:6==c.length?80:4==c.length?214:7==c.length?75:215,halign:"center"},1:{columnWidth:6==c.length?145:4==c.length?160:7==c.length?75:85,halign:"center"},2:{cellWidth:85,halign:"center"},3:{cellWidth:75,halign:4==c.length?"right":"center"},4:{cellWidth:74,halign:6==c.length||7==c.length?"center":"right"},5:{cellWidth:75,halign:"right"},6:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}));var A=Number(this.decimalPipe.transform(T.autoTable.previous.finalY,"1.0-0")),F=A;S?(T.autoTable(h,b,{startX:10,startY:A+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{columnWidth:4===h.length?200:110,halign:"center"},1:{columnWidth:4===h.length?117:140,halign:"center"},2:{columnWidth:4===h.length?117:97,halign:"center"},3:{columnWidth:4===h.length?100:97,halign:4===h.length?"right":"center"},4:{columnWidth:90,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1;var t=e.cell.raw;t&&"string"==typeof t&&t.startsWith("Unit")&&(e.cell.styles.fontStyle="bold",e.cell.colSpan=h.length,e.cell.styles.halign="left")}}),F=Number(this.decimalPipe.transform(T.autoTable.previous.finalY,"1.0-0"))):(T.autoTable(h,b,{startX:10,startY:A+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{columnWidth:6===h.length?130:85,halign:"center"},1:{columnWidth:6===h.length?85:75,halign:"center"},2:{columnWidth:6===h.length?85:75,halign:"center"},3:{columnWidth:6===h.length?85:75,halign:"center"},4:{columnWidth:74,halign:"center"},5:{columnWidth:75,halign:6===h.length?"right":"center"},6:{columnWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1;var t=e.cell.raw;t&&"string"==typeof t&&t.startsWith("Unit")&&(e.cell.styles.fontStyle="bold",e.cell.colSpan=h.length,e.cell.styles.halign="left")}}),F=Number(this.decimalPipe.transform(T.autoTable.previous.finalY,"1.0-0"))),T.autoTable("",m,{startX:10,startY:F+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{bottom:35,left:230},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:235,fontStyle:"italic"},1:{cellWidth:100}},didParseCell:function(e){1==e.column.index&&(e.cell.styles.halign="right"),e.cell.styles.cellPadding=1},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});var R=Number(this.decimalPipe.transform(T.autoTable.previous.finalY,"1.0-0"));(null===(v=null===(g=null==d?void 0:d.client)||void 0===g?void 0:g.termsConditions[0])||void 0===v?void 0:v.termsAndCondition)&&(T.setFillColor(241,241,244),T.rect(30,R+20,535,80,"FD"),T.setFillColor(0,0,0),T.setFontSize(9),T.text(null===(C=null===(y=null==d?void 0:d.client)||void 0===y?void 0:y.termsConditions[0])||void 0===C?void 0:C.termsAndCondition.replace("{{ClientName}}",d.client.clientName).replace("{{TRNNumber}}",d.client.trnNo).replace("{{Currency}}",this.currency),60,R+30)),T.setTextColor(0,0,0),T.line(5,R+110,607,R+110);var I=T.internal.pageSize.height;if(R>I-190){T.addPage();var O="Page "+T.getNumberOfPages();T.setFontSize(10),T.text(O,10,I-10),I=150}T.text("Notice :- Please tear and attach the slip  along with your payment",30,I-90),T.autoTable(n,l,{startX:10,startY:I-80,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:120,halign:"center"},1:{cellWidth:200,halign:"center"},2:{cellWidth:100,halign:"right"},3:{cellWidth:120,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}});var W=T.output("datauristring");this.pdfsToMerge.push(W)}},{key:"downloadBillNewFormatReport",value:function(e){for(var t,i,n,l,a,o,r,s,c,u,d,m=this,h=[],b=[],f=[],p=[],g=[],v=[],C=[],S=[],T=["Meter No","Tarif","Previous Reading","Present Reading","Consumption","Unit Rate "+this.currency+"/TR-HR","Amount "],P=0;P<e.bills.length;P++)this.consumptionRoundOffFormat=null!==(t=Object(y.e)("ConsumptionRoundOff",e.bills[P].utilityTypeId))&&void 0!==t?t:this.envService.consumptionRoundOffFormat,h.push(e.bills[P].deviceName),h.push(e.bills[P].utilityType),"BTU"===e.bills[P].utilityType&&e.bills[P].billTransactions&&e.bills[P].billTransactions.length&&e.bills[P].billTransactions.findIndex((function(e){return e.measuringUnitId&&2===e.measuringUnitId}))>-1?(h.push(this.decimalPipe.transform(.284345*e.bills[P].previousReading,this.roundFormat)+" TR-HR"),h.push(this.decimalPipe.transform(.284345*e.bills[P].presentReading,this.roundFormat)+" TR-HR"),h.push(this.decimalPipe.transform(.284345*e.bills[P].consumption,this.roundFormat)+" TR-HR")):(h.push(this.decimalPipe.transform(e.bills[P].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[P].measuringUnit),h.push(this.decimalPipe.transform(e.bills[P].presentReading,this.consumptionRoundOffFormat)+" "+e.bills[P].measuringUnit),h.push(this.decimalPipe.transform(e.bills[P].consumption,this.consumptionRoundOffFormat)+" "+e.bills[P].measuringUnit)),h.push(e.bills[P].consumptionRate),h.push(e.bills[P].billAmountLocal),b.push(h),h=[];for(var D=0;D<e.bills.length;D++){var w=e.bills[D];this.consumptionRoundOffFormat=null!==(i=Object(y.e)("ConsumptionRoundOff",e.bills[D].utilityTypeId))&&void 0!==i?i:this.envService.consumptionRoundOffFormat;for(var N=0;N<w.billTransactions.length;N++)h.push(w.utilityType+"-"+w.billTransactions[N].headDisplay),h.push(this.decimalPipe.transform(w.consumption,this.consumptionRoundOffFormat)),h.push(w.consumptionUnit),h.push(w.billTransactions[N].rate),h.push(this.currencyPipe.transform(w.billTransactions[N].headAmount,this.currency.toString(),!0,this.roundFormat)),C.push(h),h=[]}h.push(e.accountNumber),h.push(e.fromDateLocal+"-"+e.toDateLocal),h.push(e.billAmountLocal),p.push(h);var x=[];if(e.bills.forEach((function(e){if(e.billTransactions&&e.billTransactions.length){var t=["consumption","consumptioncharge"];e.billTransactions.forEach((function(e){if(!t.includes(e.headDisplay.toLowerCase())){var i=x.find((function(t){return t.label===e.headDisplay}));i?i.value+=e.headAmount:x.push({label:e.headDisplay,value:e.headAmount})}}))}})),e.billCharges&&e.billCharges.length&&e.billCharges.sort((function(e,t){return e.position-t.position})).forEach((function(e){if("VAT"!==e.headDisplay){var t=x.find((function(t){return t.label===e.headDisplay}));t?t.value+=e.headAmount:x.push({label:e.headDisplay,value:e.headAmount})}})),x.forEach((function(e){f.push({label:e.label,value:m.currencyPipe.transform(e.value,m.currency.toString(),!0,m.roundFormat)}),Number(e.value)})),e.billTaxDetails&&e.billTaxDetails.length&&(e.billTaxDetails.forEach((function(e){f.push({label:e.taxDisplayName,value:m.currencyPipe.transform(e.taxAmount,m.currency.toString(),!0,m.roundFormat)}),Number(e.taxAmount)})),e.billDiscounts&&e.billDiscounts.length)){var k=0;e.billDiscounts.forEach((function(e){k+=e.headAmount})),S.push({label:"Total Discount",value:this.currencyPipe.transform(k,this.currency.toString(),!0,this.roundFormat)})}S.push({label:"Total for Current Period",value:this.currencyPipe.transform(e.billAmount+e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)}),g.push({label:"Bill No",value:": "+Object(y.f)(e.billNumber)},{label:"Date of issue",value:": "+Object(y.f)(e.billDateLocal)},{label:"Due Date",value:": "+Object(y.f)(e.dueDateLocal)}),v.push({label:"Billing period",value:":  From: ".concat(Object(y.f)(e.fromDateLocal)," To: ").concat(Object(y.f)(e.toDateLocal)," ")},{label:"Customer Account",value:": "+Object(y.f)(e.accountNumber)},{label:"Customer Name",value:": "+Object(y.f)(e.ownerName)},{label:"Unit No",value:": "+Object(y.f)(e.unitNumber)},{label:"Address",value:": "+Object(y.f)(null===(l=null===(n=null==e?void 0:e.client)||void 0===n?void 0:n.addresses[0])||void 0===l?void 0:l.address1)},{label:"City",value:": "+Object(y.f)(null===(o=null===(a=null==e?void 0:e.client)||void 0===a?void 0:a.addresses[0])||void 0===o?void 0:o.city)},{label:"P.O Box",value:": "+Object(y.f)(null===(s=null===(r=null==e?void 0:e.client)||void 0===r?void 0:r.addresses[0])||void 0===s?void 0:s.zipPostalCode)},{label:"Phone number",value:": "+Object(y.f)(null===(c=null==e?void 0:e.receiverDetails[0])||void 0===c?void 0:c.phoneNumber)},{label:"Fax Number",value:": "},{label:"Client",value:": "+Object(y.f)(null===(u=null==e?void 0:e.client)||void 0===u?void 0:u.clientName)},{label:"Client TRN",value:": "+Object(y.f)(null===(d=null==e?void 0:e.client)||void 0===d?void 0:d.trnNo)}),this.getNewBillFormatReport(T,b,f,["Customer Number","Billing Period","Total for current period"],p,g,v,[],"Sample Report",["Charges","Consumption","Measuring Unit","Tariff","Total"],C,e,S)}},{key:"getNewBillFormatReport",value:function(e,t,i,n,l,a,o,r,s,c,u,d,m){var h,b,f,p,g=new Fe.default({orientation:"portrait",unit:"pt",format:"letter"});g.rect(5,5,g.internal.pageSize.width-10,g.internal.pageSize.height-10,"S"),g.setTextColor(0,0,0),g.setFontSize(11),g.setFont("Cambria"),g.text("Billing Statement".toUpperCase(),10,20),this.addImage(g,d),g.setLineWidth(.1),g.autoTable("",a,{startX:10,startY:35,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:15},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:190,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"},didParseCell:function(e){e.cell.styles.cellPadding=1.5}});var v=Number(this.decimalPipe.transform(g.autoTable.previous.finalY,"1.0-0"));g.autoTable("",o,{startX:10,startY:v,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:15},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:380,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0]},didParseCell:function(e){e.cell.styles.cellPadding=1.5}});var y=Number(this.decimalPipe.transform(g.autoTable.previous.finalY,"1.0-0"));g.setFont("Cambria"),g.text("Meter Read-Out".toUpperCase(),10,y+15),g.autoTable(e,t,{startX:10,startY:y+30,didDrawPage:function(e){var t="Page "+e.pageCount;g.setFontSize(10);var i=g.internal.pageSize.height||g.internal.pageSize.getHeight();g.text(t,e.settings.margin.left,i-10)},styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:15},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:70,halign:"center"},1:{cellWidth:100,halign:"center"},2:{cellWidth:90,halign:"center"},3:{cellWidth:90,halign:"center"},4:{cellWidth:80,halign:"center"},5:{cellWidth:73,halign:"center"},6:{cellWidth:73,halign:"center"},7:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1.5}});var C=Number(this.decimalPipe.transform(g.autoTable.previous.finalY,"1.0-0"));g.autoTable("",i,{startX:10,startY:C+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{bottom:35,left:250},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:250,fontStyle:"italic"},1:{cellWidth:90}},didParseCell:function(e){1==e.column.index&&(e.cell.styles.halign="right"),e.cell.styles.cellPadding=1.5},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});var S=Number(this.decimalPipe.transform(g.autoTable.previous.finalY,"1.0-0"));g.line(5,S+10,607,S+10),g.autoTable("",m,{startX:10,startY:S+20,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{bottom:35,left:250},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:250,fontStyle:"italic"},1:{cellWidth:90}},didParseCell:function(e){1==e.column.index&&(e.cell.styles.halign="right"),e.cell.styles.cellPadding=1.5},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});var T=Number(this.decimalPipe.transform(g.autoTable.previous.finalY,"1.0-0"));g.line(5,T+10,607,T+10),(null===(b=null===(h=null==d?void 0:d.client)||void 0===h?void 0:h.termsConditions[0])||void 0===b?void 0:b.termsAndCondition)&&g.text(null===(p=null===(f=null==d?void 0:d.client)||void 0===f?void 0:f.termsConditions[0])||void 0===p?void 0:p.termsAndCondition.replace("{{ClientName}}",d.client.clientName).replace("{{TRNNumber}}",d.client.trnNo).replace("{{Currency}}",this.currency),10,T+30);var P=g.internal.pageSize.height||g.internal.pageSize.getHeight();g.text("Notice :- Please tear and attach the slip  along with your payment",10,P-60),g.autoTable(n,l,{startX:10,startY:P-40,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:15},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"center"},1:{cellWidth:340,halign:"center"},2:{cellWidth:140,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1.5}});var D=g.output("datauristring");this.pdfsToMerge.push(D)}},{key:"onRemarksDataRow",value:function(e){var t=this;this.dialog.open(Bt,{data:{label:"Rejected Remarks",value:e.rejectedRemarks}}).afterClosed().subscribe((function(){e&&t.onGetBillsHistory(t.manageParams)}))}},{key:"onFilterDataRow",value:function(e){var t=0,i=0,n=0,l=0,a=0;e&&e.length&&e.forEach((function(e){t+=e.billAmount,n+=e.creditNoteAmount,l+=e.netAmount,i+=e.paid,a+=e.balanceAmount})),this.billAmount=this.currencyPipe.transform(t,this.currency.toString(),!0,this.roundFormat),this.creditNoteAmount=this.currencyPipe.transform(n,this.currency.toString(),!0,this.roundFormat),this.netAmount=this.currencyPipe.transform(l,this.currency.toString(),!0,this.roundFormat),this.receivedAmount=this.currencyPipe.transform(i,this.currency.toString(),!0,this.roundFormat),this.balanceAmount=this.currencyPipe.transform(a,this.currency.toString(),!0,this.roundFormat)}},{key:"onExcelExport",value:function(){if(this.billMasterDetails&&this.billMasterDetails.length>0){var e=this.getData(this.billMasterDetails);if(e&&e.length){var t=jt.utils.aoa_to_sheet(e),i=jt.utils.book_new();jt.utils.book_append_sheet(i,t,"Sheet1"),jt.writeFile(i,this.isApproveBills&&!this.isRejectedBills?"ApproveBills.xlsx":"BillHistory.xlsx")}}else this.notificationMessage("No Data to Export","yellow-snackbar")}},{key:"getData",value:function(e){var t=this,i=[],n=[],l=[],a=["Bill Number","Bill Date","Account Number","Tenant Name"],o=[],r=[];e.forEach((function(e){e.bills&&e.bills.length&&e.bills.forEach((function(e){e.billTransactions&&e.billTransactions.length&&e.billTransactions.forEach((function(e){o.includes(e.headDisplay)||o.push(e.headDisplay)}))})),e.billCharges&&e.billCharges.length&&e.billCharges.forEach((function(e){r.includes(e.headDisplay)||r.push(e.headDisplay)}))})),o.forEach((function(e){a.push(e)})),r.forEach((function(e){a.push(e)})),a.push("Bill Amount ","Paid ");for(var s=0,c=0,u=function(i){n.push(e[i].billNumber),n.push(e[i].billDateLocal),n.push(e[i].accountNumber),n.push(e[i].ownerName),o.forEach((function(l){if(e[i].bills&&e[i].bills.length){var a=e[i].bills.filter((function(e){return 1==e.isDifferentiateBill}));if(a&&a.length&&e[i].bills.length==a.length)if(a[a.length-1].billTransactions&&a[a.length-1].billTransactions.length){var o=a[a.length-1].billTransactions.find((function(e){return e.headDisplay.toLowerCase()===l.toLowerCase()}));n.push(t.currencyPipe.transform(o?o.headAmount:0,t.currency.toString(),!0,t.roundFormat))}else n.push(t.currencyPipe.transform(0,t.currency.toString(),!0,t.roundFormat));else if(e[i].isGroupBill){var r=0;e[i].bills.forEach((function(e){if(e.billTransactions&&e.billTransactions.length){var t=e.billTransactions.find((function(e){return e.headDisplay.toLowerCase()===l.toLowerCase()}));t&&(r+=t.headAmount)}})),n.push(t.currencyPipe.transform(r>0?r:0,t.currency.toString(),!0,t.roundFormat))}else{var s=0;e[i].bills.forEach((function(e){if(e.billTransactions&&e.billTransactions.length){var t=e.billTransactions.find((function(e){return e.headDisplay.toLowerCase()===l.toLowerCase()}));t&&(s+=t.headAmount)}})),n.push(t.currencyPipe.transform(s>0?s:0,t.currency.toString(),!0,t.roundFormat))}}else n.push(t.currencyPipe.transform(0,t.currency.toString(),!0,t.roundFormat))})),r.forEach((function(l){if(e[i].isGroupBill){var a=0;if(e[i].billCharges&&e[i].billCharges.length){var o=e[i].billCharges.filter((function(e){return e.headDisplay.toLowerCase()===l.toLowerCase()}));o&&o.length&&o.forEach((function(e){a+=Number(e.headAmount)}))}n.push(t.currencyPipe.transform(a>0?a:0,t.currency.toString(),!0,t.roundFormat))}else if(e[i].billCharges&&e[i].billCharges.length){var r=e[i].billCharges.find((function(e){return e.headDisplay.toLowerCase()===l.toLowerCase()}));n.push(t.currencyPipe.transform(r?r.headAmount:0,t.currency.toString(),!0,t.roundFormat))}else n.push(t.currencyPipe.transform(0,t.currency.toString(),!0,t.roundFormat))})),n.push(t.currencyPipe.transform(e[i].billAmount,t.currency.toString(),!0,t.roundFormat)),n.push(t.currencyPipe.transform(e[i].paid,t.currency.toString(),!0,t.roundFormat)),l.push(n),s+=e[i].billAmount,c+=e[i].paid,n=[]},d=0;d<e.length;d++)u(d);for(var m=0;m<a.length-2;m++)n.push("");return n.push(this.currencyPipe.transform(s,this.currency.toString(),!0,this.roundFormat)),n.push(this.currencyPipe.transform(c,this.currency.toString(),!0,this.roundFormat)),l.push(n),n=[],a.forEach((function(e){n.push(e)})),i.push(n),l.forEach((function(e){i.push(e)})),i}},{key:"downloadBillFormat1Report",value:function(e){var t,i,n=this,l=[],a=[],o=[],r=[],s=[],c=[],u=[],d=[],m=["Unit No","Meter No","Previous Reading","Present Reading","Consumption"],h=["Bill No","Meter No","Charges","Consumption","Measuring Unit","Tariff","Total"],b="";e.bills.forEach((function(e){b+=e.deviceName+","})),s.push({label:"Account Number:",value:e.accountNumber},{label:"Meter Number:",value:b.slice(0,-1)},{label:"Unit Number:",value:e.unitNumber},{label:"Billing Date:",value:e.billDateLocal},{label:"Due Date:",value:e.dueDateLocal},{label:"Bill Period",value:"".concat(Object(y.f)(e.fromDateLocal)," - ").concat(Object(y.f)(e.toDateLocal)," ")});var f=!1,p=!1,g=!1,v=!1;if(e&&e.bills&&e.bills.length){var C=Array.from(new Set(e.bills.map((function(e){return e.billNumber})))),S=Array.from(new Set(e.bills.map((function(e){return e.unitNumber})))),T=Array.from(new Set(e.bills.map((function(e){return e.deviceName}))));if(f=!!(C&&C.length>1),p=!!(S&&S.length>1),!(g=!!(T&&T.length>1))){var P=h.findIndex((function(e){return"Meter No"===e}));P>-1&&h.splice(P,1)}if(f||h.splice(0,1),p){var D=s.findIndex((function(e){return"Unit Number:"===e.label}));s.splice(D,1)}else m.splice(0,1);var w=Array.from(new Set(e.bills.filter((function(e){return e.billTariffDetails&&e.billTariffDetails.length})))),N=Array.from(new Set(e.bills.filter((function(e){return!e.billTariffDetails||0===e.billTariffDetails.length}))));if(N&&N.length&&N&&N.length&&(v=!0),N&&N.length&&!w&&(v=!0),w&&w.length&&(!N||0==N.length))for(var x=0;x<w.length;x++)if(w[x].billTransactions.find((function(e){return!e.tariffId}))){v=!0;break}}if(!v){var k=h.findIndex((function(e){return"Tariff"===e}));k&&h.splice(k,1)}for(var A=0;A<e.bills.length;A++){if(this.consumptionRoundOffFormat=null!==(t=Object(y.e)("ConsumptionRoundOff",e.bills[A].utilityTypeId))&&void 0!==t?t:this.envService.consumptionRoundOffFormat,p&&l.push(e.unitNumber),l.push(e.bills[A].deviceName),l.push(this.decimalPipe.transform(e.bills[A].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[A].measuringUnit),l.push(this.decimalPipe.transform(e.bills[A].presentReading,this.consumptionRoundOffFormat)+" "+e.bills[A].measuringUnit),e.bills[A].isDifferentiateBill){if(g){g=!1;var F=h.findIndex((function(e){return"Meter No"===e}));F>-1&&h.splice(F,1)}l.push(this.decimalPipe.transform(e.bills[A].presentReading-e.bills[A].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[A].measuringUnit)}else l.push(this.decimalPipe.transform(e.bills[A].consumption,this.consumptionRoundOffFormat)+" "+e.bills[A].measuringUnit);"BTU"===e.bills[A].utilityType&&e.bills[A].billTransactions&&e.bills[A].billTransactions.length&&e.bills[A].billTransactions.findIndex((function(e){return e.measuringUnitId&&2===e.measuringUnitId}))>-1&&(0==A&&m.push("Consumption TR-HR"),l.push(this.decimalPipe.transform(.284345*e.bills[A].consumption,this.consumptionRoundOffFormat))),a.push(l),l=[]}for(var R=0,I=0;I<e.bills.length;I++){var O=e.bills[I];this.consumptionRoundOffFormat=null!==(i=Object(y.e)("ConsumptionRoundOff",e.bills[I].utilityTypeId))&&void 0!==i?i:this.envService.consumptionRoundOffFormat;for(var W=0;W<O.billTransactions.length;W++)f&&l.push(O.billNumber),l.push(O.deviceName),l.push(O.billTransactions[W].headDisplay),"BTU"===O.utilityType&&O.billTransactions&&O.billTransactions.length&&O.billTransactions[W]&&O.billTransactions[W].measuringUnitId&&2===O.billTransactions[W].measuringUnitId?(l.push(this.decimalPipe.transform(.284345*O.consumption,this.consumptionRoundOffFormat)),l.push("TR-HR"),v&&O.billTariffDetails&&O.billTariffDetails.length&&O.billTransactions[W].tariffId?l.push("-"):v&&l.push(O.billTransactions[W].rate)):(l.push(this.decimalPipe.transform(O.consumption,this.consumptionRoundOffFormat)),l.push(O.measuringUnit),v&&O.billTariffDetails&&O.billTariffDetails.length&&O.billTransactions[W].tariffId?l.push("-"):v&&l.push(O.billTransactions[W].rate)),l.push(this.currencyPipe.transform(O.billTransactions[W].headAmount,this.currency.toString(),!0,this.roundFormat)),u.push(l),l=[],R+=O.billTransactions[W].headAmount}if(l.push(e.accountNumber),l.push(e.fromDateLocal+"-"+e.toDateLocal),l.push(this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)),l.push(e.billAmountLocal),r.push(l),e.billCharges&&e.billCharges.length&&(e.billCharges.sort((function(e,t){return e.position-t.position})).forEach((function(e){if("VAT"!==e.headDisplay){var t=o.find((function(t){return t.label===e.headDisplay}));t?t.value+=e.headAmount:o.push({label:e.headDisplay,value:e.headAmount})}})),o.forEach((function(e){c.push({label:e.label,value:n.currencyPipe.transform(e.value,n.currency.toString(),!0,n.roundFormat)})}))),c.push({label:"Current Month Total Consumption Charge:",value:this.currencyPipe.transform(R,this.currency.toString(),!0,this.roundFormat)}),e.billDiscounts&&e.billDiscounts.length){var M=0;e.billDiscounts.forEach((function(e){M+=e.headAmount})),c.push({label:"Total Discount",value:this.currencyPipe.transform(M,this.currency.toString(),!0,this.roundFormat)})}e.billTaxDetails&&e.billTaxDetails.length?e.billTaxDetails.forEach((function(e){c.push({label:e.taxDisplayName,value:n.currencyPipe.transform(e.taxAmount,n.currency.toString(),!0,n.roundFormat)})})):c.push({label:"TAX:",value:this.currencyPipe.transform(0,this.currency.toString(),!0,this.roundFormat)}),c.push({label:"Current Month + TAX:",value:e.billAmountLocal},{label:"Previous Bill Outstanding Balance:",value:this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)},{label:"Total Due incl TAX:",value:this.currencyPipe.transform(e.billAmount+e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)}),Array.from(new Set(e.bills.map((function(e){return e.billTariffDetails}))));var L=[],B=!1,z=[];l=[],e&&e.bills&&e.bills.length&&e.bills.forEach((function(e){var t;n.consumptionRoundOffFormat=null!==(t=Object(y.e)("ConsumptionRoundOff",e.utilityTypeId))&&void 0!==t?t:n.envService.consumptionRoundOffFormat,z=[];var i="Unit Number : "+e.unitNumber+" - Meter Number : "+e.deviceName;if(e.billTariffDetails&&e.billTariffDetails.length)for(var a=0;a<e.billTariffDetails.length;a++){if(e.billTariffDetails[a].slabSettingsId&&e.billTariffDetails[a].slabSettingsId>0){var o=e.billTariffDetails[a].season;Number(e.billTariffDetails[a].peakType)<Number(e.billTariffDetails[a].consumption)&&(o=e.billTariffDetails[a].peakType+" - "+e.billTariffDetails[a].consumption),0==a&&(B=!0,L=["Slab","Consumption","Rate","Amount "]),z&&z.length?z.find((function(e){return e===i}))||n.createUnitMeterNumberRow(i,L.length,d):(z.push(i),n.createUnitMeterNumberRow(i,L.length,d)),l.push(o),l.push(n.decimalPipe.transform(e.billTariffDetails[a].consumption,n.consumptionRoundOffFormat)),l.push(e.billTariffDetails[a].rate),l.push(n.currencyPipe.transform(e.billTariffDetails[a].amount,n.currency.toString(),!0,n.roundFormat))}else 0==e.billTariffDetails[a].slabSettingsId&&(0==a&&(L=["Season","Week Type","Peak Type","Consumption","Rate","Amount "]),z&&z.length?z.find((function(e){return e===i}))||n.createUnitMeterNumberRow(i,L.length,d):(z.push(i),n.createUnitMeterNumberRow(i,L.length,d)),l.push(e.billTariffDetails[a].season),l.push(e.billTariffDetails[a].weekType),l.push(e.billTariffDetails[a].peakType),l.push(n.decimalPipe.transform(e.billTariffDetails[a].consumption,n.consumptionRoundOffFormat)),l.push(e.billTariffDetails[a].rate),l.push(n.currencyPipe.transform(e.billTariffDetails[a].amount,n.currency.toString(),!0,n.roundFormat)));d.push(l),l=[]}})),this.getNewBillFormat1Report(m,a,o,["Customer AccountNumber","Billing Period","Previous Due","Total for current period"],r,[],s,c,"Invoice",h,u,e,[],L,d,B)}},{key:"getNewBillFormat1Report",value:function(e,t,i,n,l,a,o,r,s,c,u,d,m,h,b){var f,p,g,v,C,S,T,P,D,w,N,x,k,A,F,R,I,O,W,M,L,B,z=arguments.length>15&&void 0!==arguments[15]&&arguments[15],U=new Fe.default({orientation:"portrait",unit:"pt",format:"letter"});U.rect(5,5,U.internal.pageSize.width-10,U.internal.pageSize.height-10,"S"),U.setFontSize(30),(U=this.addImage(U,d)).setTextColor(0,0,0),U.setFontSize(16),U.setFont("Cambria","bold"),U.text("Tax Invoice",260,30),U.setFontSize(13),U.setFont("Cambria","normal"),U.text(d.client.clientName.toUpperCase(),10,60),U.setFontSize(10),U.setFont("Cambria"),U.text("TRN: "+d.client.trnNo,10,70),U.text("PO Box "+d.client.addresses[0].zipPostalCode,10,80),U.text(d.client.addresses[0].address1+","+d.client.addresses[0].country,10,90),U.text("Phone: "+d.client.phoneNo,10,100),U.text("Email: "+d.client.email+", Web: "+d.client.website,10,110),U.setFontSize(10),U.setFont("bold"),U.text("Invoice#: ".toUpperCase(),370,110),U.setTextColor(25,118,210);var E=U.getTextWidth("Invoice#: "),j="";(null==d?void 0:d.billNumber)&&(j=null===(f=d.billNumber)||void 0===f?void 0:f.toUpperCase()),U.text(j,380+E,110),U.setFont("none"),U.setTextColor(0,0,0),U.setFontSize(9),U.autoTable("",o,{startY:120,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:370},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:80,halign:"left"},1:{cellWidth:150,halign:"right"}},didParseCell:function(e){e.cell.styles.cellPadding=6===e.length?1.8:2.7},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});var H=Number(this.decimalPipe.transform(U.autoTable.previous.finalY,"1.0-0"));if(U.setLineWidth(.1),U.line(5,H+5,607,H+5),U.setFont("Cambria"),U.setFillColor(241,241,244),U.setDrawColor(206,203,203),U.rect(10,120,340,H-120,"FD"),U.setTextColor(0,0,0),U.setFontSize(12),U.text(null==d?void 0:d.ownerName.toUpperCase(),20,135),U.text("CUSTOMER TRN: "+d.trn,20,150),U.text("unit #"+d.unitNumber,20,165),U.setFontSize(10),U.text(d.clientName,20,180),U.text(Object(y.f)(null===(p=null==d?void 0:d.client)||void 0===p?void 0:p.buildingName,",")+Object(y.f)(null===(v=null===(g=null==d?void 0:d.client)||void 0===g?void 0:g.addresses[0])||void 0===v?void 0:v.location,",")+Object(y.f)(null===(S=null===(C=null==d?void 0:d.client)||void 0===C?void 0:C.addresses[0])||void 0===S?void 0:S.city,",")+Object(y.f)(null===(P=null===(T=null==d?void 0:d.client)||void 0===T?void 0:T.addresses[0])||void 0===P?void 0:P.country,","),20,195),U.setFontSize(10),U.text("Meter Read-Outs".toUpperCase(),10,H+20),U.autoTable(e,t,{startX:10,startY:H+35,didDrawPage:function(e){var t="Page "+e.pageCount;U.setFontSize(10);var i=U.internal.pageSize.height||U.internal.pageSize.getHeight();U.text(t,e.settings.margin.left,i-10)},styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:6==e.length?120:4==e.length?200:155,halign:"center"},1:{cellWidth:6==e.length?100:4==e.length?135:125,halign:"center"},2:{cellWidth:6==e.length?100:4==e.length?135:125,halign:"center"},3:{cellWidth:4==e.length?120:100,halign:"center"},4:{cellWidth:85,halign:"center"},5:{cellWidth:85,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}),u&&u.length){var Y=Number(this.decimalPipe.transform(U.autoTable.previous.finalY,"1.0-0"));U.setFontSize(10),U.text("Charges Breakdown".toUpperCase(),10,Y+15),U.autoTable(c,u,{startX:10,startY:Y+30,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{columnWidth:6==c.length?80:4==c.length?230:7==c.length?70:200,halign:"center"},1:{columnWidth:6==c.length?180:4==c.length?130:7==c.length?70:100,halign:"center"},2:{columnWidth:6==c.length?90:4==c.length?130:7==c.length?140:100,halign:"center"},3:{columnWidth:6==c.length||4==c.length?90:7==c.length?70:100,halign:4==c.length?"right":"center"},4:{cellWidth:75,halign:6==c.length||7==c.length?"center":"right"},5:{cellWidth:75,halign:7==c.length?"center":"right"},6:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}})}var V=Number(this.decimalPipe.transform(U.autoTable.previous.finalY,"1.0-0")),_=V;z?(U.autoTable(h,b,{startX:10,startY:V+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{columnWidth:4===h.length?250:120,halign:"center"},1:{columnWidth:4===h.length?120:150,halign:"center"},2:{columnWidth:120,halign:"center"},3:{columnWidth:100,halign:4===h.length?"right":"center"},4:{columnWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1;var t=e.cell.raw;t&&"string"==typeof t&&t.startsWith("Unit")&&(e.cell.styles.fontStyle="bold",e.cell.colSpan=h.length,e.cell.styles.halign="left")}}),_=Number(this.decimalPipe.transform(U.autoTable.previous.finalY,"1.0-0"))):(U.autoTable(h,b,{startX:10,startY:V+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{columnWidth:6===h.length?140:100,halign:"center"},1:{columnWidth:100,halign:"center"},2:{columnWidth:6===h.length?100:80,halign:"center"},3:{columnWidth:6===h.length?100:80,halign:"center"},4:{columnWidth:75,halign:"center"},5:{columnWidth:75,halign:6===h.length?"right":"center"},6:{columnWidth:80,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1;var t=e.cell.raw;t&&"string"==typeof t&&t.startsWith("Unit")&&(e.cell.styles.fontStyle="bold",e.cell.colSpan=h.length,e.cell.styles.halign="left")}}),_=Number(this.decimalPipe.transform(U.autoTable.previous.finalY,"1.0-0"))),U.setTextColor(25,118,210),U.setFontSize(12),U.text("Bank Payment Account Details",10,_+20),U.setTextColor(0,0,0),U.setFontSize(9),U.text("Account Title: "+Object(y.f)(null===(w=null===(D=null==d?void 0:d.client)||void 0===D?void 0:D.bankDetails[0])||void 0===w?void 0:w.accountName),10,_+40),U.text("Account #: "+Object(y.f)(null===(x=null===(N=null==d?void 0:d.client)||void 0===N?void 0:N.bankDetails[0])||void 0===x?void 0:x.accountNo),10,_+50),U.text("IBAN #: "+Object(y.f)(null===(A=null===(k=null==d?void 0:d.client)||void 0===k?void 0:k.bankDetails[0])||void 0===A?void 0:A.ibanNumber),10,_+60),U.text("Bank Name: "+Object(y.f)(null===(R=null===(F=null==d?void 0:d.client)||void 0===F?void 0:F.bankDetails[0])||void 0===R?void 0:R.bankName),10,_+70),U.text("Swift Code: "+ +Object(y.f)(null===(O=null===(I=null==d?void 0:d.client)||void 0===I?void 0:I.bankDetails[0])||void 0===O?void 0:O.swiftCode),10,_+80),U.setFontSize(9),U.autoTable("",r,{startX:300,startY:_+20,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:320},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:180,halign:"left"},1:{cellWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"},didParseCell:function(e){e.cell.styles.cellPadding=1.8}});var G=Number(this.decimalPipe.transform(U.autoTable.previous.finalY,"1.0-0")),X=U.internal.pageSize.height;if(G+110>X-190){U.addPage(),U.rect(5,5,U.internal.pageSize.width-10,U.internal.pageSize.height-10,"S");var q="Page "+U.getNumberOfPages();U.setFontSize(10),U.text(q,10,X-10),X=230}(null===(M=null===(W=null==d?void 0:d.client)||void 0===W?void 0:W.termsConditions[0])||void 0===M?void 0:M.termsAndCondition)&&(U.setFillColor(241,241,244),U.rect(10,X-190,590,90,"FD"),U.setFillColor(0,0,0),U.setFontSize(9),U.text(null===(B=null===(L=null==d?void 0:d.client)||void 0===L?void 0:L.termsConditions[0])||void 0===B?void 0:B.termsAndCondition.replace("{{ClientName}}",d.client.clientName).replace("{{TRNNumber}}",d.client.trnNo).replace("{{Currency}}",this.currency),40,X-175)),U.setTextColor(0,0,0),U.line(5,X-95,607,X-95),U.text("Notice :- Please tear and attach the slip  along with your payment",10,X-60),U.autoTable(n,l,{startX:10,startY:X-65,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:130,halign:"center"},1:{cellWidth:210,halign:"center"},2:{cellWidth:110,halign:"right"},3:{cellWidth:140,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}});var $=U.output("datauristring");this.pdfsToMerge.push($)}},{key:"downloadBillFormat3Report",value:function(e){var t,i,n,l,a,o,r,s,c,u,d,m=this,h=[],b=[],f=[],p=[],g=[],v=[],C=[],S=[],T=[],P=["Unit No","Meter No","Previous Reading","Present Reading","Consumption"],D=["Bill No","Meter No","Charges","Consumption","Measuring Unit","Tariff","Total"];g.push({label:"Bill No",value:": "+Object(y.f)(e.billNumber)},{label:"Date of issue",value:": "+Object(y.f)(e.billDateLocal)},{label:"Due Date",value:": "+Object(y.f)(e.dueDateLocal)}),v.push({label:"Billing period",value:": From: ".concat(Object(y.f)(e.fromDateLocal)," To: ").concat(Object(y.f)(e.toDateLocal)," ")},{label:"Customer Account",value:": "+Object(y.f)(e.accountNumber)},{label:"Customer Name",value:": "+Object(y.f)(e.ownerName)},{label:"Unit No",value:": "+Object(y.f)(e.unitNumber)},{label:"Address",value:": "+Object(y.f)(null===(i=null===(t=null==e?void 0:e.client)||void 0===t?void 0:t.addresses[0])||void 0===i?void 0:i.address1)},{label:"City",value:": "+Object(y.f)(null===(l=null===(n=null==e?void 0:e.client)||void 0===n?void 0:n.addresses[0])||void 0===l?void 0:l.city)},{label:"P.O Box",value:": "+Object(y.f)(null===(o=null===(a=null==e?void 0:e.client)||void 0===a?void 0:a.addresses[0])||void 0===o?void 0:o.zipPostalCode)},{label:"Phone number",value:": "+Object(y.f)(null===(r=null==e?void 0:e.receiverDetails[0])||void 0===r?void 0:r.phoneNumber)},{label:"Fax Number",value:": "},{label:"Client",value:": "+Object(y.f)(null===(s=null==e?void 0:e.client)||void 0===s?void 0:s.clientName)},{label:"Client TRN",value:": "+Object(y.f)(null===(c=null==e?void 0:e.client)||void 0===c?void 0:c.trnNo)});var w=!1,N=!1,x=!1,k=!1;if(e&&e.bills&&e.bills.length){var A=Array.from(new Set(e.bills.map((function(e){return e.billNumber})))),F=Array.from(new Set(e.bills.map((function(e){return e.unitNumber})))),R=Array.from(new Set(e.bills.map((function(e){return e.deviceName}))));if(w=!!(A&&A.length>1),N=!!(F&&F.length>1),!(k=!!(R&&R.length>1))){var I=D.findIndex((function(e){return"Meter No"===e}));I>-1&&D.splice(I,1)}if(w?g.splice(0,1):D.splice(0,1),N){var O=v.findIndex((function(e){return"Unit No"===e.label}));v.splice(O,1)}else P.splice(0,1);var W=Array.from(new Set(e.bills.filter((function(e){return e.billTariffDetails&&e.billTariffDetails.length})))),M=Array.from(new Set(e.bills.filter((function(e){return!e.billTariffDetails||0===e.billTariffDetails.length}))));if(M&&M.length&&M&&M.length&&(x=!0),M&&M.length&&!W&&(x=!0),W&&W.length&&(!M||0==M.length))for(var L=0;L<W.length;L++)if(W[L].billTransactions.find((function(e){return!e.tariffId}))){x=!0;break}}if(!x){var B=D.findIndex((function(e){return"Tariff"===e}));B&&D.splice(B,1)}for(var z=0;z<e.bills.length;z++){if(this.consumptionRoundOffFormat=null!==(u=Object(y.e)("ConsumptionRoundOff",e.bills[z].utilityTypeId))&&void 0!==u?u:this.envService.consumptionRoundOffFormat,N&&h.push(e.unitNumber),h.push(e.bills[z].deviceName),h.push(this.decimalPipe.transform(e.bills[z].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[z].measuringUnit),h.push(this.decimalPipe.transform(e.bills[z].presentReading,this.consumptionRoundOffFormat)+" "+e.bills[z].measuringUnit),e.bills[z].isDifferentiateBill){if(k){k=!1;var U=D.findIndex((function(e){return"Meter No"===e}));U>-1&&D.splice(U,1)}h.push(this.decimalPipe.transform(e.bills[z].presentReading-e.bills[z].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[z].measuringUnit)}else h.push(this.decimalPipe.transform(e.bills[z].consumption,this.consumptionRoundOffFormat)+" "+e.bills[z].measuringUnit);"BTU"===e.bills[z].utilityType&&e.bills[z].billTransactions&&e.bills[z].billTransactions.length&&e.bills[z].billTransactions.findIndex((function(e){return e.measuringUnitId&&2===e.measuringUnitId}))>-1&&(0==z&&P.push("Consumption TR-HR"),h.push(this.decimalPipe.transform(.284345*e.bills[z].consumption,this.consumptionRoundOffFormat))),b.push(h),h=[]}for(var E=0,j=0;j<e.bills.length;j++){var H=e.bills[j];this.consumptionRoundOffFormat=null!==(d=Object(y.e)("ConsumptionRoundOff",e.bills[j].utilityTypeId))&&void 0!==d?d:this.envService.consumptionRoundOffFormat;for(var Y=0;Y<H.billTransactions.length;Y++)w&&h.push(H.billNumber),k&&h.push(H.deviceName),h.push(H.billTransactions[Y].headDisplay),"BTU"===H.utilityType&&H.billTransactions&&H.billTransactions.length&&H.billTransactions[Y]&&H.billTransactions[Y].measuringUnitId&&2===H.billTransactions[Y].measuringUnitId?(h.push(this.decimalPipe.transform(.284345*H.consumption,this.consumptionRoundOffFormat)),h.push("TR-HR"),x&&H.billTariffDetails&&H.billTariffDetails.length&&H.billTransactions[Y].tariffId?h.push("-"):x&&h.push(H.billTransactions[Y].rate)):(h.push(this.decimalPipe.transform(H.consumption,this.consumptionRoundOffFormat)),h.push(H.measuringUnit),x&&H.billTariffDetails&&H.billTariffDetails.length&&H.billTransactions[Y].tariffId?h.push("-"):x&&h.push(H.billTransactions[Y].rate)),h.push(this.currencyPipe.transform(H.billTransactions[Y].headAmount,this.currency.toString(),!0,this.roundFormat)),C.push(h),h=[],E+=H.billTransactions[Y].headAmount}h.push(e.accountNumber),h.push(e.fromDateLocal+"-"+e.toDateLocal),h.push(this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)),h.push(e.billAmountLocal),p.push(h),e.bills.forEach((function(e){e.deviceName})),Array.from(new Set(e.bills.map((function(e){return e.billTariffDetails}))));var V=[],_=!1,G=[];h=[],e&&e.bills&&e.bills.length&&e.bills.forEach((function(e){var t;m.consumptionRoundOffFormat=null!==(t=Object(y.e)("ConsumptionRoundOff",e.utilityTypeId))&&void 0!==t?t:m.envService.consumptionRoundOffFormat,G=[];var i="Unit Number : "+e.unitNumber+" - Meter Number : "+e.deviceName;if(e.billTariffDetails&&e.billTariffDetails.length)for(var n=0;n<e.billTariffDetails.length;n++){if(e.billTariffDetails[n].slabSettingsId&&e.billTariffDetails[n].slabSettingsId>0){var l=e.billTariffDetails[n].season;Number(e.billTariffDetails[n].peakType)<Number(e.billTariffDetails[n].consumption)&&(l=e.billTariffDetails[n].peakType+" - "+e.billTariffDetails[n].consumption),0==n&&(_=!0,V=["Slab","Consumption","Rate","Amount "]),G&&G.length?G.find((function(e){return e===i}))||m.createUnitMeterNumberRow(i,V.length,T):(G.push(i),m.createUnitMeterNumberRow(i,V.length,T)),h.push(l),h.push(m.decimalPipe.transform(e.billTariffDetails[n].consumption,m.consumptionRoundOffFormat)),h.push(e.billTariffDetails[n].rate),h.push(m.currencyPipe.transform(e.billTariffDetails[n].amount,m.currency.toString(),!0,m.roundFormat))}else 0==e.billTariffDetails[n].slabSettingsId&&(0==n&&(V=["Season","Week Type","Peak Type","Consumption","Rate","Amount "]),G&&G.length?G.find((function(e){return e===i}))||m.createUnitMeterNumberRow(i,V.length,T):(G.push(i),m.createUnitMeterNumberRow(i,V.length,T)),h.push(e.billTariffDetails[n].season),h.push(e.billTariffDetails[n].weekType),h.push(e.billTariffDetails[n].peakType),h.push(m.decimalPipe.transform(e.billTariffDetails[n].consumption,m.consumptionRoundOffFormat)),h.push(e.billTariffDetails[n].rate),h.push(m.currencyPipe.transform(e.billTariffDetails[n].amount,m.currency.toString(),!0,m.roundFormat)));T.push(h),h=[]}}));var X=[];if(e.billCharges&&e.billCharges.length&&e.billCharges.sort((function(e,t){return e.position-t.position})).forEach((function(e){if("VAT"!==e.headDisplay){var t=X.find((function(t){return t.label===e.headDisplay}));t?t.value+=e.headAmount:X.push({label:e.headDisplay,value:e.headAmount})}})),X.forEach((function(e){f.push({label:e.label,value:m.currencyPipe.transform(e.value,m.currency.toString(),!0,m.roundFormat)})})),e.billTaxDetails&&e.billTaxDetails.length&&e.billTaxDetails.forEach((function(e){f.push({label:e.taxDisplayName,value:m.currencyPipe.transform(e.taxAmount,m.currency.toString(),!0,m.roundFormat)})})),f.push({label:"Total consumption charge for Current Period",value:this.currencyPipe.transform(E,this.currency.toString(),!0,this.roundFormat)}),e.billDiscounts&&e.billDiscounts.length){var q=0;e.billDiscounts.forEach((function(e){q+=e.headAmount})),f.push({label:"Total Discount",value:this.currencyPipe.transform(q,this.currency.toString(),!0,this.roundFormat)})}f.push({label:"Previous Outstanding Amount",value:this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)}),S.push({label:"Total for Current Period",value:this.currencyPipe.transform(e.billAmount+e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)}),this.getNewBillFormat3Report(P,b,f,["Customer AccountNumber","Billing Period","Previous Due","Total for current period"],p,g,v,[],"Invoice",D,C,e,S,V,T,_)}},{key:"getNewBillFormat3Report",value:function(e,t,i,n,l,a,o,r,s,c,u,d,m,h,b){var f,p,g,v,y=arguments.length>15&&void 0!==arguments[15]&&arguments[15],C=new Fe.default({orientation:"portrait",unit:"pt",format:"letter"});C.rect(5,5,C.internal.pageSize.width-10,C.internal.pageSize.height-10,"S"),C.setTextColor(0,0,0),C.setFontSize(11),C.setFont("Cambria"),C.text("Billing Statement".toUpperCase(),10,20),this.addImage(C,d),C.setLineWidth(.1),C.autoTable("",a,{startX:10,startY:35,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:15},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:190,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"},didParseCell:function(e){e.cell.styles.cellPadding=1.5}});var S=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"));C.autoTable("",o,{startX:10,startY:S,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:15},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:380,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0]},didParseCell:function(e){e.cell.styles.cellPadding=1.5}});var T=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"));C.setFont("Cambria"),C.setFontSize(10),C.text("Meter Read-Outs".toUpperCase(),10,T+15),C.autoTable(e,t,{startX:10,startY:T+30,didDrawPage:function(e){var t="Page "+e.pageCount;"function"==typeof C.putTotalPages&&(t+=" of 1",C.rect(5,5,C.internal.pageSize.width-10,C.internal.pageSize.height-10,"S")),C.setFontSize(9);var i=C.internal.pageSize.height||C.internal.pageSize.getHeight();C.text(t,e.settings.margin.left,i-10)},styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:6==e.length?120:4==e.length?200:155,halign:"center"},1:{cellWidth:6==e.length?100:4==e.length?135:125,halign:"center"},2:{cellWidth:6==e.length?100:4==e.length?135:125,halign:"center"},3:{cellWidth:4==e.length?120:100,halign:"center"},4:{cellWidth:85,halign:"center"},5:{cellWidth:85,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}});var P=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"));u&&u.length&&(C.setFontSize(10),C.text("Charges Breakdown".toUpperCase(),10,P+15),C.autoTable(c,u,{startX:10,startY:P+30,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{columnWidth:6==c.length?80:4==c.length?230:7===c.length?70:200,halign:"center"},1:{columnWidth:6==c.length?180:4==c.length?130:7===c.length?70:100,halign:"center"},2:{columnWidth:6==c.length?90:4==c.length?130:7===c.length?140:100,halign:"center"},3:{columnWidth:6==c.length?90:4==c.length?100:7===c.length?70:100,halign:4==c.length?"right":"center"},4:{cellWidth:5==c.length?90:65,halign:6==c.length||7==c.length?"center":"right"},5:{cellWidth:50,halign:7==c.length?"center":"right"},6:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}));var D=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0")),w=D;y?(C.autoTable(h,b,{startX:10,startY:D+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:20},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{columnWidth:4===h.length?250:120,halign:"center"},1:{columnWidth:4===h.length?120:150,halign:"center"},2:{columnWidth:120,halign:"center"},3:{columnWidth:100,halign:4===h.length?"right":"center"},4:{columnWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1;var t=e.cell.raw;t&&"string"==typeof t&&t.startsWith("Unit")&&(e.cell.styles.fontStyle="bold",e.cell.colSpan=h.length,e.cell.styles.halign="left")}}),w=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"))):(C.autoTable(h,b,{startX:10,startY:D+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{columnWidth:6===h.length?140:100,halign:"center"},1:{columnWidth:100,halign:"center"},2:{columnWidth:6===h.length?100:80,halign:"center"},3:{columnWidth:6===h.length?100:80,halign:"center"},4:{columnWidth:75,halign:"center"},5:{columnWidth:75,halign:6===h.length?"right":"center"},6:{columnWidth:80,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1;var t=e.cell.raw;t&&"string"==typeof t&&t.startsWith("Unit")&&(e.cell.styles.fontStyle="bold",e.cell.colSpan=h.length,e.cell.styles.halign="left")}}),w=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"))),C.autoTable("",i,{startX:10,startY:w+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{bottom:35,left:250},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:250,fontStyle:"italic"},1:{cellWidth:90}},didParseCell:function(e){1==e.column.index&&(e.cell.styles.halign="right"),e.cell.styles.cellPadding=1.5},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});var N=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"));C.line(5,N+10,607,N+10),C.autoTable("",m,{startX:10,startY:N+20,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{bottom:35,left:250},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:250,fontStyle:"italic"},1:{cellWidth:90}},didParseCell:function(e){1==e.column.index&&(e.cell.styles.halign="right"),e.cell.styles.cellPadding=1.5},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});var x=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"));C.line(5,x+10,607,x+10);var k=C.internal.pageSize.height;x+110>k-190&&(C.addPage(),C.rect(5,5,C.internal.pageSize.width-10,C.internal.pageSize.height-10,"S"),k=230),(null===(p=null===(f=null==d?void 0:d.client)||void 0===f?void 0:f.termsConditions[0])||void 0===p?void 0:p.termsAndCondition)&&(C.setFillColor(241,241,244),C.rect(10,k-190,590,90,"FD"),C.setFillColor(0,0,0),C.setFontSize(9),C.text(null===(v=null===(g=null==d?void 0:d.client)||void 0===g?void 0:g.termsConditions[0])||void 0===v?void 0:v.termsAndCondition.replace("{{ClientName}}",d.client.clientName).replace("{{TRNNumber}}",d.client.trnNo).replace("{{Currency}}",this.currency),30,k-175)),C.setTextColor(0,0,0),C.line(5,k-95,607,k-95),C.text("Notice :- Please tear and attach the slip  along with your payment",10,k-80),C.autoTable(n,l,{startX:10,startY:k-65,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:130,halign:"center"},1:{cellWidth:210,halign:"center"},2:{cellWidth:110,halign:"right"},3:{cellWidth:140,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}});var A=C.output("datauristring");this.pdfsToMerge.push(A)}},{key:"downloadBillFormat1LargeReport",value:function(e){var t,i,n=this,l=[],a=[],o=[],r=[],s=[],c=[],u=[],d=[],m=["Unit No","Meter No","Previous Reading","Present Reading","Consumption"],h=["Bill No","Meter No","Charges","Consumption","Measuring Unit","Tariff","Total"],b="";e.bills.forEach((function(e){b+=e.deviceName+","})),s.push({label:"Account Number:",value:e.accountNumber},{label:"Meter Number:",value:b.slice(0,-1)},{label:"Unit Number:",value:e.unitNumber},{label:"Billing Date:",value:e.billDateLocal},{label:"Due Date:",value:e.dueDateLocal},{label:"Bill Period",value:"".concat(Object(y.f)(e.fromDateLocal)," - ").concat(Object(y.f)(e.toDateLocal)," ")});var f=!1,p=!1,g=!1,v=!1;if(e&&e.bills&&e.bills.length){var C=Array.from(new Set(e.bills.map((function(e){return e.billNumber})))),S=Array.from(new Set(e.bills.map((function(e){return e.unitNumber})))),T=Array.from(new Set(e.bills.map((function(e){return e.deviceName}))));if(f=!!(C&&C.length>1),p=!!(S&&S.length>1),!(v=!!(T&&T.length>1))){var P=h.findIndex((function(e){return"Meter No"===e}));P>-1&&h.splice(P,1)}if(f||h.splice(0,1),p){var D=s.findIndex((function(e){return"Unit Number:"===e.label}));s.splice(D,1)}else m.splice(0,1);var w=Array.from(new Set(e.bills.filter((function(e){return e.billTariffDetails&&e.billTariffDetails.length})))),N=Array.from(new Set(e.bills.filter((function(e){return!e.billTariffDetails||0===e.billTariffDetails.length}))));if(N&&N.length&&N&&N.length&&(g=!0),N&&N.length&&!w&&(g=!0),w&&w.length&&(!N||0==N.length))for(var x=0;x<w.length;x++)if(w[x].billTransactions.find((function(e){return!e.tariffId}))){g=!0;break}}if(!g){var k=h.findIndex((function(e){return"Tariff"===e}));k&&h.splice(k,1)}for(var A=0;A<e.bills.length;A++){if(this.consumptionRoundOffFormat=null!==(t=Object(y.e)("ConsumptionRoundOff",e.bills[A].utilityTypeId))&&void 0!==t?t:this.envService.consumptionRoundOffFormat,p&&l.push(e.bills[A].unitNumber),l.push(e.bills[A].deviceName),l.push(this.decimalPipe.transform(e.bills[A].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[A].measuringUnit),l.push(this.decimalPipe.transform(e.bills[A].presentReading,this.consumptionRoundOffFormat)+" "+e.bills[A].measuringUnit),e.bills[A].isDifferentiateBill){if(v){v=!1;var F=h.findIndex((function(e){return"Meter No"===e}));F>-1&&h.splice(F,1)}l.push(this.decimalPipe.transform(e.bills[A].presentReading-e.bills[A].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[A].measuringUnit)}else l.push(this.decimalPipe.transform(e.bills[A].consumption,this.consumptionRoundOffFormat)+" "+e.bills[A].measuringUnit);"BTU"===e.bills[A].utilityType&&e.bills[A].billTransactions&&e.bills[A].billTransactions.length&&e.bills[A].billTransactions.findIndex((function(e){return e.measuringUnitId&&2===e.measuringUnitId}))>-1&&(0==A&&m.push("Consumption TR-HR"),l.push(this.decimalPipe.transform(.284345*e.bills[A].consumption,this.consumptionRoundOffFormat))),a.push(l),l=[]}for(var R=0,I=0;I<e.bills.length;I++){var O=e.bills[I];this.consumptionRoundOffFormat=null!==(i=Object(y.e)("ConsumptionRoundOff",e.bills[I].utilityTypeId))&&void 0!==i?i:this.envService.consumptionRoundOffFormat;for(var W=0;W<O.billTransactions.length;W++)f&&l.push(O.billNumber),v&&l.push(O.deviceName),l.push(O.billTransactions[W].headDisplay),"BTU"===O.utilityType&&O.billTransactions&&O.billTransactions.length&&O.billTransactions[W]&&O.billTransactions[W].measuringUnitId&&2===O.billTransactions[W].measuringUnitId?(l.push(this.decimalPipe.transform(.284345*O.consumption,this.consumptionRoundOffFormat)),l.push("TR-HR"),g&&O.billTariffDetails&&O.billTariffDetails.length&&O.billTransactions[W].tariffId?l.push("-"):g&&l.push(O.billTransactions[W].rate)):(l.push(this.decimalPipe.transform(O.consumption,this.consumptionRoundOffFormat)),l.push(O.measuringUnit),g&&O.billTariffDetails&&O.billTariffDetails.length&&O.billTransactions[W].tariffId?l.push("-"):g&&l.push(O.billTransactions[W].rate)),l.push(this.currencyPipe.transform(O.billTransactions[W].headAmount,this.currency.toString(),!0,this.roundFormat)),u.push(l),l=[],R+=O.billTransactions[W].headAmount}if(l.push(e.accountNumber),l.push(e.fromDateLocal+"-"+e.toDateLocal),l.push(this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)),l.push(e.billAmountLocal),r.push(l),e.billCharges&&e.billCharges.length&&(e.billCharges.sort((function(e,t){return e.position-t.position})).forEach((function(e){if("VAT"!==e.headDisplay){var t=o.find((function(t){return t.label===e.headDisplay}));t?t.value+=e.headAmount:o.push({label:e.headDisplay,value:e.headAmount})}})),o.forEach((function(e){c.push({label:e.label,value:n.currencyPipe.transform(e.value,n.currency.toString(),!0,n.roundFormat)})}))),c.push({label:"Current Month Total Consumption Charge:",value:this.currencyPipe.transform(R,this.currency.toString(),!0,this.roundFormat)}),e.billDiscounts&&e.billDiscounts.length){var M=0;e.billDiscounts.forEach((function(e){M+=e.headAmount})),c.push({label:"Total Discount",value:this.currencyPipe.transform(M,this.currency.toString(),!0,this.roundFormat)})}e.billTaxDetails&&e.billTaxDetails.length?e.billTaxDetails.forEach((function(e){c.push({label:e.taxDisplayName,value:n.currencyPipe.transform(e.taxAmount,n.currency.toString(),!0,n.roundFormat)})})):c.push({label:"TAX:",value:this.currencyPipe.transform(0,this.currency.toString(),!0,this.roundFormat)}),c.push({label:"Current Month + TAX:",value:e.billAmountLocal},{label:"Previous Bill Outstanding Balance:",value:this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)},{label:"Total Due incl TAX:",value:this.currencyPipe.transform(e.billAmount+e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)}),Array.from(new Set(e.bills.map((function(e){return e.billTariffDetails}))));var L=[],B=!1,z=[];l=[],e&&e.bills&&e.bills.length&&e.bills.forEach((function(e){var t;n.consumptionRoundOffFormat=null!==(t=Object(y.e)("ConsumptionRoundOff",e.utilityTypeId))&&void 0!==t?t:n.envService.consumptionRoundOffFormat,z=[];var i="Unit Number : "+e.unitNumber+" - Meter Number : "+e.deviceName;if(e.billTariffDetails&&e.billTariffDetails.length)for(var a=0;a<e.billTariffDetails.length;a++){if(e.billTariffDetails[a].slabSettingsId&&e.billTariffDetails[a].slabSettingsId>0){var o=e.billTariffDetails[a].season;Number(e.billTariffDetails[a].peakType)<Number(e.billTariffDetails[a].consumption)&&(o=e.billTariffDetails[a].peakType+" - "+e.billTariffDetails[a].consumption),0==a&&(B=!0,L=["Slab","Consumption","Rate","Amount "]),z&&z.length?z.find((function(e){return e===i}))||n.createUnitMeterNumberRow(i,L.length,d):(z.push(i),n.createUnitMeterNumberRow(i,L.length,d)),l.push(o),l.push(n.decimalPipe.transform(e.billTariffDetails[a].consumption,n.consumptionRoundOffFormat)),l.push(e.billTariffDetails[a].rate),l.push(n.currencyPipe.transform(e.billTariffDetails[a].amount,n.currency.toString(),!0,n.roundFormat))}else 0==e.billTariffDetails[a].slabSettingsId&&(0==a&&(L=["Season","Week Type","Peak Type","Consumption","Rate","Amount "]),z&&z.length?z.find((function(e){return e===i}))||n.createUnitMeterNumberRow(i,L.length,d):(z.push(i),n.createUnitMeterNumberRow(i,L.length,d)),l.push(e.billTariffDetails[a].season),l.push(e.billTariffDetails[a].weekType),l.push(e.billTariffDetails[a].peakType),l.push(n.decimalPipe.transform(e.billTariffDetails[a].consumption,n.consumptionRoundOffFormat)),l.push(e.billTariffDetails[a].rate),l.push(n.currencyPipe.transform(e.billTariffDetails[a].amount,n.currency.toString(),!0,n.roundFormat)));d.push(l),l=[]}})),this.getNewBillFormat1LargeReport(m,a,o,["Customer AccountNumber","Billing Period","Previous Due","Total for current period"],r,[],s,c,"Invoice",h,u,e,[],L,d,B)}},{key:"getNewBillFormat1LargeReport",value:function(e,t,i,n,l,a,o,r,s,c,u,d,m,h,b){var f,p,g,v,C,S,T,P,D,w,N,x,k,A,F,R,I,O,W,M,L,B,z=arguments.length>15&&void 0!==arguments[15]&&arguments[15],U=new Fe.default({orientation:"portrait",unit:"pt",format:"letter"});U.rect(5,5,U.internal.pageSize.width-10,U.internal.pageSize.height-10,"S"),U.setFontSize(30),(U=this.addImage(U,d)).setTextColor(0,0,0),U.setFontSize(16),U.setFont("Cambria","bold"),U.text("Tax Invoice",260,30),U.setFontSize(13),U.setFont("Cambria","normal"),U.text(d.client.clientName.toUpperCase(),10,60),U.setFontSize(10),U.setFont("Cambria"),U.text("TRN: "+d.client.trnNo,10,70),U.text("PO Box "+d.client.addresses[0].zipPostalCode,10,80),U.text(d.client.addresses[0].address1+","+d.client.addresses[0].country,10,90),U.text("Phone: "+d.client.phoneNo,10,100),U.text("Email: "+d.client.email+", Web: "+d.client.website,10,110),U.setFontSize(10),U.setFont("bold"),U.text("Invoice#: ".toUpperCase(),370,110),U.setTextColor(25,118,210);var E=U.getTextWidth("Invoice#: "),j="";(null==d?void 0:d.billNumber)&&(j=null===(f=d.billNumber)||void 0===f?void 0:f.toUpperCase()),U.text(j,380+E,110),U.setFont("none"),U.setTextColor(0,0,0),U.setFontSize(9),U.autoTable("",o,{startY:120,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:370},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:80,halign:"left"},1:{cellWidth:150,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0]},didParseCell:function(e){e.cell.styles.cellPadding=6===e.length?1.8:2.7}});var H=Number(this.decimalPipe.transform(U.autoTable.previous.finalY,"1.0-0"));U.setLineWidth(.1),U.line(5,H+5,607,H+5),U.setFont("Cambria"),U.setFillColor(241,241,244),U.setDrawColor(206,203,203),U.rect(10,120,340,H-120,"FD"),U.setTextColor(0,0,0),U.setFontSize(12),U.text(null==d?void 0:d.ownerName.toUpperCase(),20,135),U.text("CUSTOMER TRN: "+d.trn,20,150),U.text("unit #"+d.unitNumber,20,165),U.setFontSize(10),U.text(d.clientName,20,180),U.text(Object(y.f)(null===(p=null==d?void 0:d.client)||void 0===p?void 0:p.buildingName,",")+Object(y.f)(null===(v=null===(g=null==d?void 0:d.client)||void 0===g?void 0:g.addresses[0])||void 0===v?void 0:v.location,",")+Object(y.f)(null===(S=null===(C=null==d?void 0:d.client)||void 0===C?void 0:C.addresses[0])||void 0===S?void 0:S.city,",")+Object(y.f)(null===(P=null===(T=null==d?void 0:d.client)||void 0===T?void 0:T.addresses[0])||void 0===P?void 0:P.country,","),20,195),U.setFontSize(10),U.text("Meter Read-Outs".toUpperCase(),10,H+20);var Y=function(e){};if(U.autoTable(e,t,{startX:10,startY:H+35,showHead:"everyPage",didDrawPage:Y,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:6==e.length?120:4==e.length?200:155,halign:"center"},1:{cellWidth:6==e.length?100:4==e.length?135:125,halign:"center"},2:{cellWidth:6==e.length?100:4==e.length?135:125,halign:"center"},3:{cellWidth:4==e.length?120:100,halign:"center"},4:{cellWidth:85,halign:"center"},5:{cellWidth:85,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}),u&&u.length){var V=Number(this.decimalPipe.transform(U.autoTable.previous.finalY,"1.0-0"));U.setFontSize(10),U.text("Charges Breakdown".toUpperCase(),10,V+15),U.autoTable(c,u,{startX:10,startY:V+30,showHead:"everyPage",didDrawPage:Y,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{columnWidth:6==c.length?80:4==c.length?230:7==c.length?70:200,halign:"center"},1:{columnWidth:6==c.length?180:4==c.length?130:7==c.length?70:100,halign:"center"},2:{columnWidth:6==c.length?90:4==c.length?130:7==c.length?140:100,halign:"center"},3:{columnWidth:6==c.length?90:4==c.length?100:7==c.length?70:100,halign:4==c.length?"right":"center"},4:{cellWidth:75,halign:6==c.length||7==c.length?"center":"right"},5:{cellWidth:75,halign:7==c.length?"center":"right"},6:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}})}var _=Number(this.decimalPipe.transform(U.autoTable.previous.finalY,"1.0-0")),G=U.internal.pageSize.height,X=_;z?(U.autoTable(h,b,{startX:10,startY:X+10,showHead:"everyPage",didDrawPage:Y,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{columnWidth:4===h.length?250:120,halign:"center"},1:{columnWidth:4===h.length?120:150,halign:"center"},2:{columnWidth:120,halign:"center"},3:{columnWidth:100,halign:4===h.length?"right":"center"},4:{columnWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1;var t=e.cell.raw;t&&"string"==typeof t&&t.startsWith("Unit")&&(e.cell.styles.fontStyle="bold",e.cell.colSpan=h.length,e.cell.styles.halign="left")}}),X=Number(this.decimalPipe.transform(U.autoTable.previous.finalY,"1.0-0"))):(U.autoTable(h,b,{startX:10,startY:_+10,showHead:"everyPage",didDrawPage:Y,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{columnWidth:6===h.length?140:100,halign:"center"},1:{columnWidth:100,halign:"center"},2:{columnWidth:6===h.length?100:80,halign:"center"},3:{columnWidth:6===h.length?100:80,halign:"center"},4:{columnWidth:75,halign:"center"},5:{columnWidth:75,halign:6===h.length?"right":"center"},6:{columnWidth:80,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1;var t=e.cell.raw;t&&"string"==typeof t&&t.startsWith("Unit")&&(e.cell.styles.fontStyle="bold",e.cell.colSpan=h.length,e.cell.styles.halign="left")}}),X=Number(this.decimalPipe.transform(U.autoTable.previous.finalY,"1.0-0"))),G-X<200&&(U.addPage(),U.setTextColor(25,118,210),U.rect(5,5,U.internal.pageSize.width-10,U.internal.pageSize.height-10,"S"),X=10),U.setTextColor(25,118,210),U.setFontSize(12),U.text("Bank Payment Account Details",10,X+20),U.setTextColor(0,0,0),U.setFontSize(9),U.text("Account Title: "+Object(y.f)(null===(w=null===(D=null==d?void 0:d.client)||void 0===D?void 0:D.bankDetails[0])||void 0===w?void 0:w.accountName),10,X+40),U.text("Account #: "+Object(y.f)(null===(x=null===(N=null==d?void 0:d.client)||void 0===N?void 0:N.bankDetails[0])||void 0===x?void 0:x.accountNo),10,X+50),U.text("IBAN #: "+Object(y.f)(null===(A=null===(k=null==d?void 0:d.client)||void 0===k?void 0:k.bankDetails[0])||void 0===A?void 0:A.ibanNumber),10,X+60),U.text("Bank Name: "+Object(y.f)(null===(R=null===(F=null==d?void 0:d.client)||void 0===F?void 0:F.bankDetails[0])||void 0===R?void 0:R.bankName),10,X+70),U.text("Swift Code: "+ +Object(y.f)(null===(O=null===(I=null==d?void 0:d.client)||void 0===I?void 0:I.bankDetails[0])||void 0===O?void 0:O.swiftCode),10,X+80),U.setFontSize(9),U.autoTable("",r,{startX:300,startY:X+20,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:320},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:180,halign:"left"},1:{cellWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"},didParseCell:function(e){e.cell.styles.cellPadding=1.8}}),Number(this.decimalPipe.transform(U.autoTable.previous.finalY,"1.0-0"))+110>G-190&&(U.addPage(),U.rect(5,5,U.internal.pageSize.width-10,U.internal.pageSize.height-10,"S"),G=230),(null===(M=null===(W=null==d?void 0:d.client)||void 0===W?void 0:W.termsConditions[0])||void 0===M?void 0:M.termsAndCondition)&&(U.setFillColor(241,241,244),U.rect(10,G-190,590,90,"FD"),U.setFillColor(0,0,0),U.setFontSize(9),U.text(null===(B=null===(L=null==d?void 0:d.client)||void 0===L?void 0:L.termsConditions[0])||void 0===B?void 0:B.termsAndCondition.replace("{{ClientName}}",d.client.clientName).replace("{{TRNNumber}}",d.client.trnNo).replace("{{Currency}}",this.currency),40,G-175)),U.setTextColor(0,0,0),U.line(5,G-95,607,G-95),U.text("Notice :- Please tear and attach the slip  along with your payment",10,G-60),U.autoTable(n,l,{startX:10,startY:G-45,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:130,halign:"center"},1:{cellWidth:210,halign:"center"},2:{cellWidth:110,halign:"right"},3:{cellWidth:140,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}});var q=U.output("datauristring");this.pdfsToMerge.push(q)}},{key:"downloadBillFormat3LargeReport",value:function(e){var t,i,n,l,a,o,r,s,c,u,d,m=this,h=[],b=[],f=[],p=[],g=[],v=[],C=[],S=[],T=[],P=["Unit No","Meter No","Previous Reading","Present Reading","Consumption"],D=["Bill No","Meter No","Charges","Consumption","Measuring Unit","Tariff","Total"];g.push({label:"Bill No",value:": "+Object(y.f)(e.billNumber)},{label:"Date of issue",value:": "+Object(y.f)(e.billDateLocal)},{label:"Due Date",value:": "+Object(y.f)(e.dueDateLocal)}),v.push({label:"Billing period",value:": From: ".concat(Object(y.f)(e.fromDateLocal)," To: ").concat(Object(y.f)(e.toDateLocal)," ")},{label:"Customer Account",value:": "+Object(y.f)(e.accountNumber)},{label:"Customer Name",value:": "+Object(y.f)(e.ownerName)},{label:"Address",value:": "+Object(y.f)(null===(i=null===(t=null==e?void 0:e.client)||void 0===t?void 0:t.addresses[0])||void 0===i?void 0:i.address1)},{label:"City",value:": "+Object(y.f)(null===(l=null===(n=null==e?void 0:e.client)||void 0===n?void 0:n.addresses[0])||void 0===l?void 0:l.city)},{label:"P.O Box",value:": "+Object(y.f)(null===(o=null===(a=null==e?void 0:e.client)||void 0===a?void 0:a.addresses[0])||void 0===o?void 0:o.zipPostalCode)},{label:"Phone number",value:": "+Object(y.f)(null===(r=null==e?void 0:e.receiverDetails[0])||void 0===r?void 0:r.phoneNumber)},{label:"Fax Number",value:": "},{label:"Client",value:": "+Object(y.f)(null===(s=null==e?void 0:e.client)||void 0===s?void 0:s.clientName)},{label:"Client TRN",value:": "+Object(y.f)(null===(c=null==e?void 0:e.client)||void 0===c?void 0:c.trnNo)});var w=!1,N=!1,x=!1,k=!1;if(e&&e.bills&&e.bills.length){var A=Array.from(new Set(e.bills.map((function(e){return e.billNumber})))),F=Array.from(new Set(e.bills.map((function(e){return e.unitNumber})))),R=Array.from(new Set(e.bills.map((function(e){return e.deviceName}))));if(w=!!(A&&A.length>1),N=!!(F&&F.length>1),!(k=!!(R&&R.length>1))){var I=D.findIndex((function(e){return"Meter No"===e}));I>-1&&D.splice(I,1)}if(w?g.splice(0,1):D.splice(0,1),N){var O=v.findIndex((function(e){return"Unit No"===e.label}));v.splice(O,1)}else P.splice(0,1);var W=Array.from(new Set(e.bills.filter((function(e){return e.billTariffDetails&&e.billTariffDetails.length})))),M=Array.from(new Set(e.bills.filter((function(e){return!e.billTariffDetails||0===e.billTariffDetails.length}))));if(M&&M.length&&M&&M.length&&(x=!0),M&&M.length&&!W&&(x=!0),W&&W.length&&(!M||0==M.length))for(var L=0;L<W.length;L++)if(W[L].billTransactions.find((function(e){return!e.tariffId}))){x=!0;break}}if(!x){var B=D.findIndex((function(e){return"Tariff"===e}));B&&D.splice(B,1)}for(var z=0;z<e.bills.length;z++){if(this.consumptionRoundOffFormat=null!==(u=Object(y.e)("ConsumptionRoundOff",e.bills[z].utilityTypeId))&&void 0!==u?u:this.envService.consumptionRoundOffFormat,N&&h.push(e.bills[z].unitNumber),h.push(e.bills[z].deviceName),h.push(this.decimalPipe.transform(e.bills[z].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[z].measuringUnit),h.push(this.decimalPipe.transform(e.bills[z].presentReading,this.consumptionRoundOffFormat)+" "+e.bills[z].measuringUnit),e.bills[z].isDifferentiateBill){if(k){k=!1;var U=D.findIndex((function(e){return"Meter No"===e}));U>-1&&D.splice(U,1)}h.push(this.decimalPipe.transform(e.bills[z].presentReading-e.bills[z].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[z].measuringUnit)}else h.push(this.decimalPipe.transform(e.bills[z].consumption,this.consumptionRoundOffFormat)+" "+e.bills[z].measuringUnit);"BTU"===e.bills[z].utilityType&&e.bills[z].billTransactions&&e.bills[z].billTransactions.length&&e.bills[z].billTransactions.findIndex((function(e){return e.measuringUnitId&&2===e.measuringUnitId}))>-1&&(0==z&&P.push("Consumption TR-HR"),h.push(this.decimalPipe.transform(.284345*e.bills[z].consumption,this.consumptionRoundOffFormat))),b.push(h),h=[]}for(var E=0,j=0;j<e.bills.length;j++){var H=e.bills[j];this.consumptionRoundOffFormat=null!==(d=Object(y.e)("ConsumptionRoundOff",e.bills[j].utilityTypeId))&&void 0!==d?d:this.envService.consumptionRoundOffFormat;for(var Y=0;Y<H.billTransactions.length;Y++)w&&h.push(H.billNumber),k&&h.push(H.deviceName),h.push(H.billTransactions[Y].headDisplay),"BTU"===H.utilityType&&H.billTransactions&&H.billTransactions.length&&H.billTransactions[Y]&&H.billTransactions[Y].measuringUnitId&&2===H.billTransactions[Y].measuringUnitId?(h.push(this.decimalPipe.transform(.284345*H.consumption,this.consumptionRoundOffFormat)),h.push("TR-HR"),x&&H.billTariffDetails&&H.billTariffDetails.length&&H.billTransactions[Y].tariffId?h.push("-"):x&&h.push(H.billTransactions[Y].rate)):(h.push(this.decimalPipe.transform(H.consumption,this.consumptionRoundOffFormat)),h.push(H.measuringUnit),x&&H.billTariffDetails&&H.billTariffDetails.length&&H.billTransactions[Y].tariffId?h.push("-"):x&&h.push(H.billTransactions[Y].rate)),h.push(this.currencyPipe.transform(H.billTransactions[Y].headAmount,this.currency.toString(),!0,this.roundFormat)),C.push(h),h=[],E+=H.billTransactions[Y].headAmount}h.push(e.accountNumber),h.push(e.fromDateLocal+"-"+e.toDateLocal),h.push(this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)),h.push(e.billAmountLocal),p.push(h),e.bills.forEach((function(e){e.deviceName})),Array.from(new Set(e.bills.map((function(e){return e.billTariffDetails}))));var V=[],_=!1,G=[];h=[],e&&e.bills&&e.bills.length&&e.bills.forEach((function(e){var t;m.consumptionRoundOffFormat=null!==(t=Object(y.e)("ConsumptionRoundOff",e.utilityTypeId))&&void 0!==t?t:m.envService.consumptionRoundOffFormat,G=[];var i="Unit Number : "+e.unitNumber+" - Meter Number : "+e.deviceName;if(e.billTariffDetails&&e.billTariffDetails.length)for(var n=0;n<e.billTariffDetails.length;n++){if(e.billTariffDetails[n].slabSettingsId&&e.billTariffDetails[n].slabSettingsId>0){var l=e.billTariffDetails[n].season;Number(e.billTariffDetails[n].peakType)<Number(e.billTariffDetails[n].consumption)&&(l=e.billTariffDetails[n].peakType+" - "+e.billTariffDetails[n].consumption),0==n&&(_=!0,V=["Slab","Consumption","Rate","Amount "]),G&&G.length?G.find((function(e){return e===i}))||m.createUnitMeterNumberRow(i,V.length,T):(G.push(i),m.createUnitMeterNumberRow(i,V.length,T)),h.push(l),h.push(m.decimalPipe.transform(e.billTariffDetails[n].consumption,m.consumptionRoundOffFormat)),h.push(e.billTariffDetails[n].rate),h.push(m.currencyPipe.transform(e.billTariffDetails[n].amount,m.currency.toString(),!0,m.roundFormat))}else 0==e.billTariffDetails[n].slabSettingsId&&(0==n&&(V=["Season","Week Type","Peak Type","Consumption","Rate","Amount "]),G&&G.length?G.find((function(e){return e===i}))||m.createUnitMeterNumberRow(i,V.length,T):(G.push(i),m.createUnitMeterNumberRow(i,V.length,T)),h.push(e.billTariffDetails[n].season),h.push(e.billTariffDetails[n].weekType),h.push(e.billTariffDetails[n].peakType),h.push(m.decimalPipe.transform(e.billTariffDetails[n].consumption,m.consumptionRoundOffFormat)),h.push(e.billTariffDetails[n].rate),h.push(m.currencyPipe.transform(e.billTariffDetails[n].amount,m.currency.toString(),!0,m.roundFormat)));T.push(h),h=[]}}));var X=[];if(e.billCharges&&e.billCharges.length&&e.billCharges.sort((function(e,t){return e.position-t.position})).forEach((function(e){if("VAT"!==e.headDisplay){var t=X.find((function(t){return t.label===e.headDisplay}));t?t.value+=e.headAmount:X.push({label:e.headDisplay,value:e.headAmount})}})),X.forEach((function(e){f.push({label:e.label,value:m.currencyPipe.transform(e.value,m.currency.toString(),!0,m.roundFormat)})})),e.billTaxDetails&&e.billTaxDetails.length&&e.billTaxDetails.forEach((function(e){f.push({label:e.taxDisplayName,value:m.currencyPipe.transform(e.taxAmount,m.currency.toString(),!0,m.roundFormat)})})),f.push({label:"Total consumption charge for Current Period",value:this.currencyPipe.transform(E,this.currency.toString(),!0,this.roundFormat)}),e.billDiscounts&&e.billDiscounts.length){var q=0;e.billDiscounts.forEach((function(e){q+=e.headAmount})),f.push({label:"Total Discount",value:this.currencyPipe.transform(q,this.currency.toString(),!0,this.roundFormat)})}f.push({label:"Previous Outstanding Amount",value:this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)}),S.push({label:"Total for Current Period",value:this.currencyPipe.transform(e.billAmount+e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)}),this.getNewBillFormat3LargeReport(P,b,f,["Customer AccountNumber","Billing Period","Previous Due","Total for current period"],p,g,v,[],"Invoice",D,C,e,S,V,T,_)}},{key:"getNewBillFormat3LargeReport",value:function(e,t,i,n,l,a,o,r,s,c,u,d,m,h,b){var f,p,g,v,y=arguments.length>15&&void 0!==arguments[15]&&arguments[15],C=new Fe.default({orientation:"portrait",unit:"pt",format:"letter"});C.rect(5,5,C.internal.pageSize.width-10,C.internal.pageSize.height-10,"S"),C.setTextColor(0,0,0),C.setFontSize(11),C.setFont("Cambria"),C.text("Billing Statement".toUpperCase(),10,20),this.addImage(C,d),C.setLineWidth(.1),C.autoTable("",a,{startX:10,startY:35,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:15},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:190,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"},didParseCell:function(e){e.cell.styles.cellPadding=1.5}});var S=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"));C.autoTable("",o,{startX:10,startY:S,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:15},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:380,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0]},didParseCell:function(e){e.cell.styles.cellPadding=1.5}});var T=function(e){},P=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"));C.setFont("Cambria"),C.setFontSize(10),C.text("Meter Read-Outs".toUpperCase(),10,P+15),C.autoTable(e,t,{startX:10,startY:P+30,didDrawPage:T,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:6==e.length?120:4==e.length?200:155,halign:"center"},1:{cellWidth:6==e.length?100:4==e.length?135:125,halign:"center"},2:{cellWidth:6==e.length?100:4==e.length?135:125,halign:"center"},3:{cellWidth:4==e.length?120:100,halign:"center"},4:{cellWidth:85,halign:"center"},5:{cellWidth:85,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}});var D=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"));u&&u.length&&(C.setFontSize(10),C.text("Charges Breakdown".toUpperCase(),10,D+15),C.autoTable(c,u,{startX:10,startY:D+30,showHead:"everyPage",didDrawPage:T,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:6===c.length?80:4==c.length?230:7===c.length?70:200,halign:"center"},1:{cellWidth:6===c.length?180:4==c.length?130:7===c.length?70:100,halign:"center"},2:{cellWidth:6===c.length?90:4==c.length?130:7===c.length?140:100,halign:6===c.length?"":"center"},3:{cellWidth:6===c.length?90:4==c.length?100:7===c.length?85:100,halign:4==c.length?"right":"center"},4:{cellWidth:75,halign:6==c.length||7==c.length?"center":"right"},5:{cellWidth:75,halign:6==c.length?"right":"center"},6:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}));var w=C.internal.pageSize.height,N=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0")),x=N;y?(C.autoTable(h,b,{startX:10,startY:N+10,showHead:"everyPage",didDrawPage:T,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{columnWidth:4===h.length?250:120,halign:"center"},1:{columnWidth:4===h.length?120:150,halign:"center"},2:{columnWidth:120,halign:"center"},3:{columnWidth:100,halign:4===h.length?"right":"center"},4:{columnWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1;var t=e.cell.raw;t&&"string"==typeof t&&t.startsWith("Unit")&&(e.cell.styles.fontStyle="bold",e.cell.colSpan=h.length,e.cell.styles.halign="left")}}),x=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"))):(C.autoTable(h,b,{startX:10,startY:N+10,showHead:"everyPage",didDrawPage:T,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{columnWidth:6===h.length?140:100,halign:"center"},1:{columnWidth:100,halign:"center"},2:{columnWidth:6===h.length?100:80,halign:"center"},3:{columnWidth:6===h.length?100:80,halign:"center"},4:{columnWidth:75,halign:"center"},5:{columnWidth:75,halign:6===h.length?"right":"center"},6:{columnWidth:80,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1;var t=e.cell.raw;t&&"string"==typeof t&&t.startsWith("Unit")&&(e.cell.styles.fontStyle="bold",e.cell.colSpan=h.length,e.cell.styles.halign="left")}}),x=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"))),w-x<200&&(C.addPage(),C.setTextColor(25,118,210),C.rect(5,5,C.internal.pageSize.width-10,C.internal.pageSize.height-10,"S"),x=10),C.autoTable("",i,{startX:10,startY:x+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{bottom:35,left:250},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:250,fontStyle:"italic"},1:{cellWidth:90}},didParseCell:function(e){1==e.column.index&&(e.cell.styles.halign="right"),e.cell.styles.cellPadding=1.5},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});var k=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"));C.line(5,k+10,607,k+10),C.autoTable("",m,{startX:10,startY:k+20,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{bottom:35,left:250},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:250,fontStyle:"italic"},1:{cellWidth:90}},didParseCell:function(e){1==e.column.index&&(e.cell.styles.halign="right"),e.cell.styles.cellPadding=1.5},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});var A=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"));C.line(5,A+10,607,A+10),A>(w=C.internal.pageSize.height)-180&&(C.addPage(),C.rect(5,5,C.internal.pageSize.width-10,C.internal.pageSize.height-10,"S"),w=230),(null===(p=null===(f=null==d?void 0:d.client)||void 0===f?void 0:f.termsConditions[0])||void 0===p?void 0:p.termsAndCondition)&&(C.setFillColor(241,241,244),C.rect(10,w-190,590,90,"FD"),C.setFillColor(0,0,0),C.setFontSize(9),C.text(null===(v=null===(g=null==d?void 0:d.client)||void 0===g?void 0:g.termsConditions[0])||void 0===v?void 0:v.termsAndCondition.replace("{{ClientName}}",d.client.clientName).replace("{{TRNNumber}}",d.client.trnNo).replace("{{Currency}}",this.currency),30,w-175)),C.setTextColor(0,0,0),C.line(5,w-95,607,w-95),C.text("Notice :- Please tear and attach the slip  along with your payment",10,w-75),C.autoTable(n,l,{startX:10,startY:w-70,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:130,halign:"center"},1:{cellWidth:210,halign:"center"},2:{cellWidth:110,halign:"right"},3:{cellWidth:140,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}});var F=C.output("datauristring");this.pdfsToMerge.push(F)}},{key:"createUnitMeterNumberRow",value:function(e,t,i){for(var n=[],l=0;l<t-1;l++)n.push(0===l?e:"");i.push(n)}},{key:"onFilterChange",value:function(e){this.dataSource&&(e=(e=e.trim()).toLowerCase(),this.dataSource.filter=e)}},{key:"billConsumptionExcelExport",value:function(){var e=this;this.billService.billConsumptionDetails(this.manageParams,!this.isApproveBills).subscribe({next:function(t){t&&t.length?e.excelDynamicExport(t):e.notificationMessage("No data to print","red-snackbar")},error:function(t){e.notificationMessage("No data to print","red-snackbar")}})}},{key:"excelDynamicExport",value:function(e){if(e&&e.length){var t=jt.utils.json_to_sheet(e),i=jt.utils.book_new();jt.utils.book_append_sheet(i,t,"Sheet1"),jt.writeFile(i,"DetailedBillSummary.xlsx")}else this.notificationMessage("No Data to Export","yellow-snackbar")}},{key:"content",set:function(e){this.sort=e,this.dataSource&&this.sort&&(this.dataSource.sort=this.sort)}},{key:"visibleColumns",get:function(){return this.displayedColumns.filter((function(e){return e.visible})).map((function(e){return e.property}))}}]),e}()).\u0275fac=function(e){return new(e||bi)(g.Nb(b.a),g.Nb(M.a),g.Nb(d.f),g.Nb(d.d),g.Nb(d.g),g.Nb(v.b),g.Nb(Ae.a),g.Nb(D.a),g.Nb(B.b),g.Nb(at.a),g.Nb(Dt.a),g.Nb(w.a),g.Nb(m.a),g.Nb(Z.a),g.Nb(ke.a),g.Nb(g.h),g.Nb(C.a))},bi.\u0275cmp=g.Hb({type:bi,selectors:[["app-bill-history"]],viewQuery:function(e,t){var i;1&e&&(g.Vc(Ht.a,!0),g.Vc(Yt.a,!0),g.Vc(_t,!0),g.Jc(Pt,!0),g.Jc(Mt,!0)),2&e&&(g.zc(i=g.cc())&&(t.paginator=i.first),g.zc(i=g.cc())&&(t.content=i.first),g.zc(i=g.cc())&&(t.htmlData=i.first),g.zc(i=g.cc())&&(t.billHistoryToolbarComponent=i.first),g.zc(i=g.cc())&&(t.billHistoryFooterToolbarComponent=i.first))},inputs:{displayedColumns:"displayedColumns"},decls:18,vars:22,consts:[["mode","card"],["fxLayout","column",1,"content"],["color","primary",1,"position-fixed"],["src","assets/img/fav-icon.png",1,"img-style"],[4,"ngIf"],[1,"example-spacer"],[3,"userActions","isApproveBills","isRejectedBills","parameterValue","disable","sendNotificationsClicked","printClicked","printSummaryClicked","approveClickedClicked","excelExportClicked","billConsumptionExcelExportClicked","regenerateClicked"],["fxFlex","noshrink","fxLayout","column","fxLayout.gt-sm","row","fxLayoutAlign.gt-sm","start stretch",3,"fxLayoutGap"],["fxFlex","grow",1,"basic-forms","route-animations-elements",3,"fxFlex.gt-sm"],["fxLayout","column"],["fxLayout","column",1,"result"],[3,"tenants","billPeriods","isHide","billTypes","billFeeTypes","isTenantVisible","isRejectedBills","isApproveBills","billFeeTypeChanged","searchClicked"],["class","padding","fxLayout","column",4,"ngIf"],["class","result","fxLayout.gt-sm","row","fxLayout","column","fxLayoutAlign","end end","fxLayoutGap.gt-sm","12px",4,"ngIf"],["fxLayout","column",1,"padding"],[3,"tableData","columnsToDisplay","innerDisplayedColumns","columnNames","hideHeader","cssStyledColumn","visibleButtons","role","buttonName","disableColumn","buttonDisableColumn","selectedRows","viewDataRow","printDataRow","deleteDataRow","rejectDataRow","failDataRow","updateRow","remarksDataRow","filterDataRow"],[3,"columns","filterChange"],["mat-table","","matSort","",2,"text-align","center",3,"dataSource"],[4,"ngFor","ngForOf"],["matColumnDef","netAmountLocal"],["mat-header-cell","","class","header-align-right",4,"matHeaderCellDef"],["mat-cell","","class","header-align-right",4,"matCellDef"],["matColumnDef","actions"],["class","actions-cell","mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["class","actions-cell","mat-cell","",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["class","clickable route-animations-elements","mat-row","",4,"matRowDef","matRowDefColumns"],[1,"paginator",3,"pageSize"],[3,"matColumnDef",4,"ngIf"],[3,"matColumnDef"],["mat-header-cell","","mat-sort-header","","class","header-align-left",4,"matHeaderCellDef"],["mat-cell","","class","header-align-left",4,"matCellDef"],["mat-header-cell","","mat-sort-header","",1,"header-align-left"],["mat-cell","",1,"header-align-left"],["mat-header-cell","",1,"header-align-right"],["mat-cell","",1,"header-align-right"],["mat-header-cell","","mat-sort-header","",1,"actions-cell"],["mat-cell","",1,"actions-cell"],["matTooltip","Print","mat-icon-button","",1,"example-icon",3,"click"],["mat-header-row",""],["mat-row","",1,"clickable","route-animations-elements"],["fxLayout.gt-sm","row","fxLayout","column","fxLayoutAlign","end end","fxLayoutGap.gt-sm","12px",1,"result"],["color","primary",1,"result",2,"width","150px"],["type","text","id","billAmount","name","billAmount","matInput","",2,"text-align","right",3,"ngModel","ngModelChange"],["class","result","style","width: 150px;","color","primary",4,"ngIf"],[1,"label-color"],[1,"color-box",2,"background-color","rgb(152, 197, 171)"],[1,"color-box",2,"background-color","rgb(206, 120, 152)"],["type","text","id","creditNoteAmount","name","creditNoteAmount","matInput","",2,"text-align","right",3,"ngModel","ngModelChange"],["type","text","id","netAmount","name","netAmount","matInput","",2,"text-align","right",3,"ngModel","ngModelChange"],["type","text","id","receivedAmount","name","receivedAmount","matInput","",2,"text-align","right",3,"ngModel","ngModelChange"],["type","text","id","balanceAmount","name","balanceAmount","matInput","",2,"text-align","right",3,"ngModel","ngModelChange"]],template:function(e,t){1&e&&(g.Tb(0,"fury-page-layout",0),g.Tb(1,"fury-page-layout-content",1),g.Tb(2,"mat-toolbar",2),g.Ob(3,"img",3),g.Pc(4,Gt,2,0,"span",4),g.Pc(5,Xt,2,0,"span",4),g.Pc(6,qt,2,0,"span",4),g.Ob(7,"span",5),g.Tb(8,"fury-bill-history-footer-toolbar",6),g.bc("sendNotificationsClicked",(function(){return t.onSendNotifications()}))("printClicked",(function(){return t.onPrintPdf()}))("printSummaryClicked",(function(e){return t.onPrintSummary(e)}))("approveClickedClicked",(function(){return t.onApprove()}))("excelExportClicked",(function(){return t.onExcelExport()}))("billConsumptionExcelExportClicked",(function(){return t.billConsumptionExcelExport()}))("regenerateClicked",(function(){return t.onRegenerate()})),g.Sb(),g.Sb(),g.Tb(9,"div",7),g.Tb(10,"fury-card",8),g.Ob(11,"fury-card-header"),g.Tb(12,"fury-card-content",9),g.Tb(13,"div",10),g.Tb(14,"app-bill-history-toolbar",11),g.bc("billFeeTypeChanged",(function(e){return t.onBillFeeTypeChange(e)}))("searchClicked",(function(e){return t.onGetBillsHistory(e)})),g.Sb(),g.Sb(),g.Pc(15,$t,2,11,"div",12),g.Pc(16,oi,13,6,"div",12),g.Pc(17,mi,10,6,"div",13),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb()),2&e&&(g.Cb(4),g.mc("ngIf",t.isApproveBills&&!t.isRejectedBills),g.Cb(1),g.mc("ngIf",!t.isApproveBills&&!t.isRejectedBills),g.Cb(1),g.mc("ngIf",t.isRejectedBills),g.Cb(2),g.mc("userActions",t.userActions)("isApproveBills",t.isApproveBills)("isRejectedBills",t.isRejectedBills)("parameterValue",t.parameterValue)("disable",t.disable),g.Cb(1),g.mc("fxLayoutGap",t.gap),g.Cb(1),g.mc("fxFlex.gt-sm",t.col2)("@fadeInUp",void 0),g.Cb(4),g.mc("tenants",t.tenants)("billPeriods",t.billPeriods)("isHide",!1)("billTypes",t.billTypes)("billFeeTypes",t.billFeeTypes)("isTenantVisible",!0)("isRejectedBills",t.isRejectedBills)("isApproveBills",t.isApproveBills),g.Cb(1),g.mc("ngIf",0==t.ownerId),g.Cb(1),g.mc("ngIf",t.ownerId>0),g.Cb(1),g.mc("ngIf",0==t.ownerId))},directives:[te.a,ie.a,N.d,ne.a,d.o,Mt,N.b,N.c,N.e,S.a,S.d,S.c,Pt,x.a,Vt.a,ye.j,Yt.a,d.n,ye.c,ye.e,ye.b,ye.g,ye.i,Ht.a,ye.d,Yt.b,ye.a,k.a,A.a,F.a,ye.f,ye.h,z.d,z.h,E.b,s.c,s.q,s.t],styles:[".padding[_ngcontent-%COMP%]{padding:0 0 24px}.example-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.content[_ngcontent-%COMP%]{margin-top:2%}.img-style[_ngcontent-%COMP%]{width:32px}ul[_ngcontent-%COMP%]{margin:20px}.label-color[_ngcontent-%COMP%]{position:relative}.label-color[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{padding-left:20px}.label-color[_ngcontent-%COMP%]   .color-box[_ngcontent-%COMP%]{width:10px;height:10px;display:inline-block;background-color:#ccc;position:absolute;left:5px;top:5px}.position-fixed[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;top:0;z-index:5}.header-align-right[_ngcontent-%COMP%]{text-align:right}.header-align-left[_ngcontent-%COMP%]{text-align:left}"],data:{animation:[p.a,f.a]}}),bi),pi=((hi=function(){function e(t,i,n,a,o,r){l(this,e),this.data=t,this.dialogRef=i,this.billService=n,this.fb=a,this.cookieService=o,this.snackbar=r}return o(e,[{key:"ngOnInit",value:function(){this.clientId=parseInt(this.cookieService.get("globalClientId")),this.form=this.fb.group({cancelReason:[this.data.cancelReason||""]})}},{key:"notificationMessage",value:function(e,t){this.snackbar.open(e,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[t]})}},{key:"cancelPaymentHistory",value:function(e){var t=this;this.data.cancelReason=this.form.get("cancelReason").value,this.data.clientId=this.clientId,this.billService.cancelPaymentHistory(e).subscribe({next:function(e){e?(t.notificationMessage("Payment cancelled successfully","green-snackbar"),t.dialogRef.close()):t.notificationMessage("Payment cancel failed","red-snackbar")},error:function(e){t.notificationMessage("Payment cancel failed","red-snackbar")}}),this.dialogRef.close()}},{key:"save",value:function(){this.cancelPaymentHistory(this.data)}}]),e}()).\u0275fac=function(e){return new(e||hi)(g.Nb(v.a),g.Nb(v.h),g.Nb(b.a),g.Nb(s.f),g.Nb(w.a),g.Nb(B.b))},hi.\u0275cmp=g.Hb({type:hi,selectors:[["fury-payment-cancel"]],decls:15,vars:2,consts:[["mat-dialog-title",""],[3,"formGroup","ngSubmit"],[1,"person"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","48px"],["fxFlex",""],["type","text","formControlName","cancelReason","matInput",""],[3,"ctrl"],["fxLayout","row","fxLayoutAlign","end center"],["mat-button",""]],template:function(e,t){1&e&&(g.Tb(0,"div",0),g.Rc(1,"Cancel Payment"),g.Sb(),g.Tb(2,"form",1),g.bc("ngSubmit",(function(){return t.save()})),g.Tb(3,"mat-dialog-content"),g.Tb(4,"fury-card"),g.Tb(5,"div",2),g.Tb(6,"div",3),g.Tb(7,"mat-form-field",4),g.Tb(8,"mat-label"),g.Rc(9,"Remarks"),g.Sb(),g.Ob(10,"input",5),g.Ob(11,"app-show-errors",6),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Tb(12,"mat-dialog-actions",7),g.Tb(13,"button",8),g.Rc(14,"CANCEL PAYMENT"),g.Sb(),g.Sb(),g.Sb()),2&e&&(g.Cb(2),g.mc("formGroup",t.form),g.Cb(9),g.mc("ctrl",t.form.get("cancelReason")))},directives:[v.i,s.z,s.r,s.k,v.f,S.a,N.d,N.e,z.d,N.b,z.h,s.c,E.b,s.q,s.i,v.c,N.c,k.a],styles:[""]}),hi),gi=a("bSwM"),vi=["allSelected"];function yi(e,t){if(1&e){var i=g.Ub();g.Tb(0,"div",6),g.Tb(1,"mat-checkbox",7),g.bc("change",(function(e){return g.Ec(i),g.fc().changeViewSecurityDeposit(e)})),g.Rc(2," Fetch Only Security Deposit Transactions"),g.Sb(),g.Sb()}}function Ci(e,t){1&e&&(g.Tb(0,"small"),g.Rc(1,"To date should be greater than or equal to From date."),g.Sb())}function Si(e,t){if(1&e){var i=g.Ub();g.Tb(0,"mat-option",22),g.bc("click",(function(){g.Ec(i),g.fc();var e=g.Ac(21);return g.fc().togglePerOne(e.viewValue)})),g.Rc(1),g.Sb()}if(2&e){var n=t.$implicit;g.mc("value",n.value)("optionSelected",n.selected),g.Cb(1),g.Tc(" ",n.label," ")}}var Ti=function(){return{standalone:!0}};function Pi(e,t){if(1&e){var i=g.Ub();g.Tb(0,"div",3),g.Tb(1,"mat-form-field",8),g.Tb(2,"mat-label"),g.Rc(3,"From Date"),g.Sb(),g.Tb(4,"input",9),g.bc("click",(function(){return g.Ec(i),g.Ac(7).open()}))("ngModelChange",(function(e){return g.Ec(i),g.fc().fromDate=e}))("ngModelChange",(function(){return g.Ec(i),g.fc().validateFromDateAndToDate()}))("focus",(function(){return g.Ec(i),g.Ac(7).open()})),g.Sb(),g.Ob(5,"mat-datepicker-toggle",10),g.Ob(6,"mat-datepicker",null,11),g.Sb(),g.Tb(8,"mat-form-field",8),g.Tb(9,"mat-label"),g.Rc(10,"To Date"),g.Sb(),g.Tb(11,"input",12),g.bc("click",(function(){return g.Ec(i),g.Ac(14).open()}))("ngModelChange",(function(e){return g.Ec(i),g.fc().toDate=e}))("focus",(function(){return g.Ec(i),g.Ac(14).open()}))("ngModelChange",(function(){return g.Ec(i),g.fc().validateFromDateAndToDate()})),g.Sb(),g.Ob(12,"mat-datepicker-toggle",10),g.Ob(13,"mat-datepicker",null,13),g.Pc(15,Ci,2,0,"small",14),g.Sb(),g.Tb(16,"mat-form-field",15),g.Tb(17,"mat-label"),g.Rc(18,"Payment Mode"),g.Sb(),g.Tb(19,"mat-select",16),g.bc("ngModelChange",(function(e){return g.Ec(i),g.fc().paymentMode=e})),g.Tb(20,"mat-option",17,18),g.bc("click",(function(){return g.Ec(i),g.fc().toggleAllSelection()})),g.Rc(22,"Select All"),g.Sb(),g.Pc(23,Si,2,3,"mat-option",19),g.Sb(),g.Sb(),g.Tb(24,"div",20),g.Tb(25,"button",21),g.bc("click",(function(){return g.Ec(i),g.fc().onSearch()})),g.Tb(26,"mat-icon"),g.Rc(27,"search"),g.Sb(),g.Sb(),g.Sb(),g.Sb()}if(2&e){var n=g.Ac(7),l=g.Ac(14),a=g.fc();g.Cb(4),g.mc("ngModelOptions",g.qc(12,Ti))("ngModel",a.fromDate)("matDatepicker",n),g.Cb(1),g.mc("for",n),g.Cb(6),g.mc("ngModelOptions",g.qc(13,Ti))("ngModel",a.toDate)("matDatepicker",l),g.Cb(1),g.mc("for",l),g.Cb(3),g.mc("ngIf",!a.isValidDate),g.Cb(4),g.mc("ngModel",a.paymentMode),g.Cb(1),g.mc("value",0),g.Cb(3),g.mc("ngForOf",a.paymentModes)}}function Di(e,t){if(1&e&&(g.Tb(0,"mat-option",28),g.Rc(1),g.Sb()),2&e){var i=t.$implicit;g.mc("value",i.description),g.Cb(1),g.Tc("",i.description," ")}}function wi(e,t){if(1&e){var i=g.Ub();g.Tb(0,"div",23),g.Tb(1,"mat-form-field",24),g.Tb(2,"mat-label"),g.Rc(3,"Months"),g.Sb(),g.Tb(4,"mat-select",25),g.bc("selectionChange",(function(e){return g.Ec(i),g.fc().onChangeMonths(e.value)}))("valueChange",(function(e){return g.Ec(i),g.fc().monthSelected=e})),g.Pc(5,Di,2,2,"mat-option",26),g.Sb(),g.Tb(6,"mat-hint"),g.Rc(7,"Please select Months"),g.Sb(),g.Sb(),g.Tb(8,"div",20),g.Tb(9,"button",27),g.bc("click",(function(){return g.Ec(i),g.fc().onSearch()})),g.Rc(10,"Search"),g.Sb(),g.Sb(),g.Sb()}if(2&e){var n=g.fc();g.Cb(4),g.mc("value",n.monthSelected),g.Cb(1),g.mc("ngForOf",n.lstMonths)}}var Ni,xi=((Ni=function(){function t(e,i,n,a,o){l(this,t),this.snackbar=e,this.datePipe=i,this.masterService=n,this.fb=a,this.cookieService=o,this.paymentModes=[],this.searchClicked=new g.o,this.manageParams={},this.fromDate="",this.toDate="",this.paymentMode=[],this.isViewSecurityDeposit=!1,this.ownerId=0,this.clientId=0,this.role="",this.isValidDate=!0,this.lstMonths=[],this.monthSelected="3 Months"}return o(t,[{key:"ngOnInit",value:function(){var e=this;this.ownerId=parseInt(this.cookieService.get("ownerId")),this.paymentModes.splice(0,1),this.ownerId>0&&this.masterService.getSystemMasterdata(81,0).subscribe((function(t){t&&t.length>0&&(e.lstMonths=t,e.monthSelected=e.lstMonths[0].description),e.onSearch()})),this.form=this.fb.group({paymentMode:[""]})}},{key:"getDates",value:function(){if(this.lstMonths!=[]&&""!=this.monthSelected){var e=this.monthSelected.substr(0,this.monthSelected.indexOf(" ")),t=new Date,i=new Date;i.setMonth(i.getMonth()-parseInt(e)+1),i.setDate(1),this.fromDate=i.toString(),this.toDate=t.toString()}}},{key:"onSearch",value:function(){if(this.ownerId>0&&this.getDates(),this.ownerId=parseInt(this.cookieService.get("ownerId")),this.clientId=parseInt(this.cookieService.get("globalClientId")),this.fromDate&&this.toDate||this.paymentMode.length>0||this.ownerId>0){var e=this.paymentMode.findIndex((function(e){return 0==e}));e>=0&&this.paymentMode.splice(e,1);var t=this.paymentMode.join(",");this.manageParams={fromDate:this.fromDate?""+this.datePipe.transform(this.fromDate,"yyyy-MM-dd"):"",toDate:this.toDate?""+this.datePipe.transform(this.toDate,"yyyy-MM-dd"):"",paymentMode:""+t,paymentId:0,tenantId:this.ownerId.toString(),clientId:this.clientId,billType:this.isViewSecurityDeposit?3:0},this.searchClicked.emit(this.manageParams)}else this.snackbar.open("Invalid search parameters",null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:["yellow-snackbar"]})}},{key:"onChangePaymentMode",value:function(e){this.paymentMode=e}},{key:"toggleAllSelection",value:function(){this.form.controls.paymentMode.patchValue(this.allSelected.selected?[].concat(e(this.paymentModes.map((function(e){return e.value}))),[0]):[])}},{key:"togglePerOne",value:function(e){if(this.allSelected.selected)return this.allSelected.deselect(),!1;this.form.controls.paymentMode.value.length==this.paymentModes.length&&this.allSelected.select()}},{key:"changeViewSecurityDeposit",value:function(e){this.isViewSecurityDeposit=e.checked}},{key:"validateFromDateAndToDate",value:function(){if(this.fromDate&&this.toDate){var e=new Date(this.fromDate),t=new Date(this.toDate);this.isValidDate=Object(y.g)(e,t)}}},{key:"onChangeMonths",value:function(e){this.monthSelected=e}}]),t}()).\u0275fac=function(e){return new(e||Ni)(g.Nb(B.b),g.Nb(d.f),g.Nb(at.a),g.Nb(s.f),g.Nb(w.a))},Ni.\u0275cmp=g.Hb({type:Ni,selectors:[["app-payment-history-toolbar"]],viewQuery:function(e,t){var i;1&e&&g.Vc(vi,!0),2&e&&g.zc(i=g.cc())&&(t.allSelected=i.first)},inputs:{paymentModes:"paymentModes",role:"role"},outputs:{searchClicked:"searchClicked"},decls:7,vars:4,consts:[[1,"person","bottom-padding"],[3,"formGroup"],["fxLayout","column","fxLayout.gt-sm","column","fxLayoutGap.gt-sm","8px","style","padding-bottom: 20px;",4,"ngIf"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","8px"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","8px",4,"ngIf"],["fxLayout","row","fxLayoutGap","15px","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","15px",4,"ngIf"],["fxLayout","column","fxLayout.gt-sm","column","fxLayoutGap.gt-sm","8px",2,"padding-bottom","20px"],["color","primary",1,"isViewSecurityDeposit",3,"change"],["color","primary",1,"result",2,"width","180px"],["id","fromDate","name","fromDate","matInput","","readonly","",3,"ngModelOptions","ngModel","matDatepicker","click","ngModelChange","focus"],["matSuffix","",3,"for"],["formDatepickerRef1",""],["id","toDate","name","toDate","matInput","","readonly","",3,"ngModelOptions","ngModel","matDatepicker","click","ngModelChange","focus"],["formDatepickerRef2",""],[4,"ngIf"],[1,"result",2,"width","220px"],["id","PaymentMode","name","PaymentMode","multiple","","formControlName","paymentMode",3,"ngModel","ngModelChange"],[3,"value","click"],["allSelected",""],[3,"value","optionSelected","click",4,"ngFor","ngForOf"],[1,"fury-flex-form-field"],["mat-icon-button","","aria-label","Example icon-button with menu icon",1,"example-icon",3,"click"],[3,"value","optionSelected","click"],["fxLayout","row","fxLayoutGap","15px","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","15px"],["color","primary",1,"result",2,"width","160px"],["id","months","name","months",3,"value","selectionChange","valueChange"],[3,"value",4,"ngFor","ngForOf"],["mat-button","",1,"buttonStyle",3,"click"],[3,"value"]],template:function(e,t){1&e&&(g.Tb(0,"mat-dialog-content"),g.Tb(1,"div",0),g.Tb(2,"form",1),g.Pc(3,yi,3,0,"div",2),g.Tb(4,"div",3),g.Pc(5,Pi,28,14,"div",4),g.Pc(6,wi,11,2,"div",5),g.Sb(),g.Sb(),g.Sb(),g.Sb()),2&e&&(g.Cb(2),g.mc("formGroup",t.form),g.Cb(1),g.mc("ngIf",0==t.ownerId),g.Cb(2),g.mc("ngIf",0==t.ownerId),g.Cb(1),g.mc("ngIf",t.ownerId>0))},directives:[v.f,s.z,s.r,s.k,d.o,N.d,N.e,gi.a,z.d,z.h,E.b,s.c,Y.b,s.q,s.t,Y.d,z.j,Y.a,U.a,s.i,H.n,d.n,k.a,F.a,z.g],styles:[".button[_ngcontent-%COMP%]{line-height:50px}small[_ngcontent-%COMP%]{color:red}.buttonStyle[_ngcontent-%COMP%]{background:#f5f5f5;margin-top:15px}"]}),Ni),ki=a("HDyx");function Ai(e,t){if(1&e){var i=g.Ub();g.Tb(0,"fury-payment-history-footer-toolbar",13),g.bc("sendReceiptClicked",(function(){return g.Ec(i),g.fc().onSendReceipt()}))("printClicked",(function(){return g.Ec(i),g.fc().onPrintPdf()}))("exportClicked",(function(){return g.Ec(i),g.fc().onExport()})),g.Sb()}2&e&&g.mc("show",!1)}function Fi(e,t){if(1&e){var i=g.Ub();g.Tb(0,"div",14),g.Tb(1,"fury-expandable-table-structure",15),g.bc("selectedRows",(function(e){return g.Ec(i),g.fc().onSelectedRows(e)}))("printDataRow",(function(e){return g.Ec(i),g.fc().downloadReport(e)}))("viewDataRow",(function(e){return g.Ec(i),g.fc().onViewDataRow(e)}))("deleteDataRow",(function(e){return g.Ec(i),g.fc().onDeleteDataRow(e)}))("filterDataRow",(function(e){return g.Ec(i),g.fc().onFilterDataRow(e)})),g.Sb(),g.Sb()}if(2&e){var n=g.fc();g.Cb(1),g.mc("tableData",n.payments)("columnsToDisplay",n.columns)("innerDisplayedColumns",n.innerColumns)("columnNames",n.columnNames)("innerTableName",n.innerTableName)("visibleButtons",n.visibleButtons)("hideHeader",!1)("viewButtonColumn",n.viewButtonColumn)("cssStyledColumn",n.cssStyledColumn)("role",n.role)("buttonDisableColumn",n.buttonDisableColumn)}}function Ri(e,t){if(1&e&&(g.Tb(0,"th",33),g.Rc(1),g.Sb()),2&e){var i=g.fc(2).$implicit;g.Cb(1),g.Tc(" ",i.name,"")}}function Ii(e,t){if(1&e&&(g.Tb(0,"td",34),g.Rc(1),g.Sb()),2&e){var i=t.$implicit,n=g.fc(2).$implicit;g.Cb(1),g.Tc(" ",i[n.property]," ")}}function Oi(e,t){if(1&e&&(g.Rb(0,30),g.Pc(1,Ri,2,1,"th",31),g.Pc(2,Ii,2,1,"td",32),g.Qb()),2&e){var i=g.fc().$implicit;g.mc("matColumnDef",i.property)}}function Wi(e,t){if(1&e&&(g.Rb(0),g.Pc(1,Oi,3,1,"ng-container",29),g.Qb()),2&e){var i=t.$implicit;g.Cb(1),g.mc("ngIf",i.isModelProperty)}}function Mi(e,t){1&e&&(g.Tb(0,"th",35),g.Rc(1,"RECEIVED AMOUNT"),g.Sb())}function Li(e,t){if(1&e&&(g.Tb(0,"td",36),g.Rc(1),g.Sb()),2&e){var i=t.$implicit;g.Cb(1),g.Tc(" ",i.paymentAmountLocal," ")}}function Bi(e,t){1&e&&g.Ob(0,"th",37)}function zi(e,t){if(1&e){var i=g.Ub();g.Tb(0,"td",38),g.Tb(1,"button",39),g.bc("click",(function(){g.Ec(i);var e=t.$implicit;return g.fc(2).downloadReport(e)})),g.Tb(2,"mat-icon"),g.Rc(3,"print"),g.Sb(),g.Sb(),g.Sb()}}function Ui(e,t){1&e&&g.Ob(0,"tr",40)}function Ei(e,t){1&e&&g.Ob(0,"tr",41)}function ji(e,t){if(1&e){var i=g.Ub();g.Tb(0,"div",16),g.Tb(1,"fury-list",17),g.bc("filterChange",(function(e){return g.Ec(i),g.fc().onFilterChange(e)})),g.Tb(2,"table",18),g.Pc(3,Wi,2,1,"ng-container",19),g.Rb(4,20),g.Pc(5,Mi,2,0,"th",21),g.Pc(6,Li,2,1,"td",22),g.Qb(),g.Rb(7,23),g.Pc(8,Bi,1,0,"th",24),g.Pc(9,zi,4,0,"td",25),g.Qb(),g.Pc(10,Ui,1,0,"tr",26),g.Pc(11,Ei,1,0,"tr",27),g.Sb(),g.Ob(12,"mat-paginator",28),g.Sb(),g.Sb()}if(2&e){var n=g.fc();g.Cb(1),g.mc("columns",n.displayedColumns),g.Cb(1),g.mc("dataSource",n.dataSource),g.Cb(1),g.mc("ngForOf",n.displayedColumns),g.Cb(7),g.mc("matHeaderRowDef",n.visibleColumns),g.Cb(1),g.mc("matRowDefColumns",n.visibleColumns),g.Cb(1),g.mc("pageSize",n.pageSize)}}function Hi(e,t){if(1&e){var i=g.Ub();g.Tb(0,"div",42),g.Tb(1,"mat-form-field",43),g.Tb(2,"mat-label"),g.Rc(3,"Advance Adjusted"),g.Sb(),g.Tb(4,"input",44),g.bc("ngModelChange",(function(e){return g.Ec(i),g.fc().advanceAmount=e})),g.Sb(),g.Sb(),g.Tb(5,"mat-form-field",43),g.Tb(6,"mat-label"),g.Rc(7,"Received Amount"),g.Sb(),g.Tb(8,"input",45),g.bc("ngModelChange",(function(e){return g.Ec(i),g.fc().receivedAmount=e})),g.Sb(),g.Sb(),g.Sb()}if(2&e){var n=g.fc();g.Cb(4),g.mc("ngModel",n.advanceAmount),g.Cb(4),g.mc("ngModel",n.receivedAmount)}}var Yi,Vi,_i,Gi,Xi,qi=((Yi=function(){function e(t,i,n,a,o,r,s,c,u,d,m,h,b){var f,p,g;l(this,e),this.billService=t,this.billSettlementService=i,this.date=n,this.currency=a,this.decimalPipe=o,this.dialog=r,this.templateService=s,this.jwtHelperService=c,this.snackbar=u,this.clientSelectionService=d,this.cookieService=m,this.envService=h,this.ref=b,this._gap=16,this.gap=this._gap+"px",this.col2="1 1 calc(50% - ".concat(this._gap/2,"px)"),this.col3="1 1 calc(33.3333% - ".concat(this._gap/1.5,"px)"),this.columns=[],this.innerColumns=[],this.columnNames=[],this.payments=[],this.paymentModes=[{label:"Select",value:0}],this.selectedRows=[],this.manageParams={},this.innerTableName="billMasters",this.visibleButtons=[],this.viewButtonColumn="billDateLocal",this.buttonDisableColumn="isLatestBill",this.receivedAmount="",this.advanceAmount="",this.cssStyledColumn="status",this.dateFormat="",this.currencyFormat="",this.roundOffFormat="",this.filePath="",this.paymentNumberColumnName="Payment No",this.paymentDateColumnName="Payment Date",this.paymentModeColumnName="Payment Mode",this.refNoColumnName="Ref No",this.accountNumberColumnName="Account Number",this.tenantColumnName="Customer Name",this.receivedAmountColumnName="Received Amount",this.adjustWithAdvanceColumnName="Advance Adjusted",this.billNumberColumnName="Bill No",this.billDateCoulmnName="BillDate",this.tenantNameColumnName="Tenant Name",this.unitColumnName="Unit",this.fromDateColumnName="From Date",this.toDateColumnName="To Date",this.dueDateColumnName="Due Date",this.billAmountColumnName="Net Bill Amount",this.billDateColumnName="BillDate",this.paidAmountColumnName="Received Amount",this.pageSize=10,this.dataSource=new ye.k([]),this.displayedColumns=[{name:this.paymentDateColumnName,property:"paymentDateLocal",visible:!0,isModelProperty:!0},{name:this.paymentNumberColumnName,property:"paymentNumber",visible:!0,isModelProperty:!0},{name:this.paymentModeColumnName,property:"paymentMode",visible:!0,isModelProperty:!0},{name:this.receivedAmountColumnName,property:"paymentAmountLocal",visible:!0,isModelProperty:!1},{name:"Actions",property:"actions",visible:!0}],this.fullyPaidCount="",this.partialyPaidCount="",this.role="",this.pdfsToMerge=[],this.roundFormat=Object(y.e)("RoundOff"),this.filePath=h.backendForFiles,this.dateFormat=null!==(f=Object(y.e)("DateFormat"))&&void 0!==f?f:h.dateFormat,this.currencyFormat=null!==(p=Object(y.e)("Currency"))&&void 0!==p?p:h.currencyFormat,this.roundOffFormat=null!==(g=Object(y.e)("RoundOff"))&&void 0!==g?g:h.roundOffFormat}return o(e,[{key:"ngOnInit",value:function(){var e;this.columnsProps=this.displayedColumns.map((function(e){return e.property})),this.clientSelectionService.setIsClientVisible(!0);var t=this.cookieService.get("access_token");this.clientId=parseInt(this.cookieService.get("globalClientId"));var i=this.jwtHelperService.decodeToken(t);i&&(this.role=i["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"]),this.ownerId=null!==(e=parseInt(this.cookieService.get("ownerId")))&&void 0!==e?e:0,this.onGetPaymentModes(),this.createColumnNames(),this.createGridColumns(),this.createInnerGridColumns(),this.addVisibleButtons(),this.ownerId>0?(this.manageParams.fromDate=""==this.manageParams.fromDate?"":L(this.manageParams.fromDate).format("YYYY-MM-DD"),this.manageParams.toDate=""==this.manageParams.toDate?"":L(this.manageParams.toDate).format("YYYY-MM-DD"),this.manageParams.tenantId=this.ownerId.toString(),this.manageParams.clientId=this.clientId,this.manageParams.paymentMode="",this.manageParams.paymentId=0,this.clientSelectionService.setIsClientVisible(!1),this.onGetPaymentHistory(this.manageParams)):this.clientSelectionService.setIsClientVisible(!0)}},{key:"createGridColumns",value:function(){this.columns=0==this.ownerId?["select","paymentDateLocal","paymentNumber","accountNumber","tenantName","paymentReference","paymentMode","paymentAmountLocal","advanceAmountLocal","action"]:["paymentDateLocal","paymentNumber","paymentMode","paymentAmountLocal","action"]}},{key:"createInnerGridColumns",value:function(){this.innerColumns=["billNumber","billDateLocal","unitNumber","fromDateLocal","toDateLocal","dueDateLocal","billAmountLocal","paidLocal","balanceAmountLocal","button"]}},{key:"createColumnNames",value:function(){this.columnNames=[{name:this.paymentNumberColumnName,property:"paymentNumber"},{name:this.paymentDateColumnName,property:"paymentDateLocal"},{name:this.refNoColumnName,property:"paymentReference"},{name:this.paymentModeColumnName,property:"paymentMode"},{name:this.accountNumberColumnName,property:"accountNumber"},{name:this.tenantColumnName,property:"tenantName"},{name:this.receivedAmountColumnName,property:"paymentAmountLocal",columnAlign:{"text-align":"right"}},{name:this.billNumberColumnName,property:"billNumber"},{name:this.billDateColumnName,property:"billDateLocal"},{name:this.unitColumnName,property:"unitNumber"},{name:this.fromDateColumnName,property:"fromDateLocal"},{name:this.toDateColumnName,property:"toDateLocal"},{name:this.dueDateColumnName,property:"dueDateLocal"},{name:this.billAmountColumnName,property:"billAmountLocal",columnAlign:{"text-align":"right"}},{name:this.paidAmountColumnName,property:"paidLocal",columnAlign:{"text-align":"right"}},{name:this.adjustWithAdvanceColumnName,property:"advanceAmountLocal",columnAlign:{"text-align":"right"}},{name:this.adjustWithAdvanceColumnName,property:"balanceAmountLocal",columnAlign:{"text-align":"right"}}]}},{key:"addVisibleButtons",value:function(){this.visibleButtons=[{property:"cancel"}]}},{key:"onGetPaymentHistory",value:function(e){var t=this;this.manageParams=e,this.payments=[],this.receivedAmount="",this.fullyPaidCount="",this.partialyPaidCount="";var i=0,n=0;new Map,this.billService.getPaymentHistory(e).subscribe((function(l){var a,o;if(t.dateFormat=Object(y.e)("DateFormat"),t.roundOffFormat=Object(y.e)("RoundOff"),t.currencyFormat=Object(y.e)("Currency"),3==e.billType?l=l.filter((function(t){return t.billType==e.billType})):0==t.ownerId&&(l=l.filter((function(e){return 3!=e.billType}))),l&&l.length&&l.forEach((function(e){e.paymentDateLocal=t.date.transform(e.paymentDate.toString(),t.dateFormat.toString()),e.referenceDateLocal=t.date.transform(e.referenceDate.toString(),t.dateFormat.toString()),e.paymentAmountLocal=t.currency.transform(e.paymentAmount,t.currencyFormat.toString(),!0,t.roundOffFormat),e.advanceAmountLocal=t.currency.transform(e.advanceAmount,t.currencyFormat.toString(),!0,t.roundOffFormat),e.billMasters.forEach((function(e){e.billDateLocal=e.billDate?t.date.transform(e.billDate.toString(),t.dateFormat.toString()):"",e.billAmountLocal=t.currency.transform(e.billAmount-e.creditNoteAmount,t.currencyFormat.toString(),!0,t.roundOffFormat),e.fromDateLocal=e.fromDate?t.date.transform(e.fromDate.toString(),t.dateFormat.toString()):"",e.toDateLocal=e.toDate?t.date.transform(e.toDate.toString(),t.dateFormat.toString()):"",e.dueDateLocal=e.dueDate?t.date.transform(e.dueDate.toString(),t.dateFormat.toString()):"",e.paidLocal=t.currency.transform(e.paid.toString(),t.currencyFormat.toString(),!0,t.roundOffFormat),e.creditNoteAmountLocal=t.currency.transform(e.creditNoteAmount.toString(),t.currencyFormat.toString(),!0,t.roundOffFormat),e.balanceAmountLocal=t.currency.transform(e.balanceAmount.toString(),t.currencyFormat.toString(),!0,t.roundOffFormat)})),i+=e.paymentAmount,n+=e.advanceAmount})),t.payments=l,t.dataSource=new ye.k(t.payments),t.ref.detectChanges(),t.dataSource&&(t.dataSource.paginator=t.paginator,t.dataSource.sort=t.sort),t.receivedAmount=t.currency.transform(i,t.currencyFormat.toString(),!0,t.roundOffFormat),t.advanceAmount=t.currency.transform(n,t.currencyFormat.toString(),!0,t.roundOffFormat),t.payments&&t.payments.length){var r=null!==(a=t.payments.filter((function(e){return"Full"===e.status})).length)&&void 0!==a?a:0;t.fullyPaidCount=" - "+r.toString();var s=null!==(o=t.payments.filter((function(e){return"Partial"===e.status})).length)&&void 0!==o?o:0;t.partialyPaidCount=" - "+s.toString()}}))}},{key:"onGetPaymentModes",value:function(){var e=this;this.paymentModes=[{label:"Select",value:0}],this.billSettlementService.getPaymentModes().subscribe((function(t){t.forEach((function(t){e.paymentModes.push({label:t.description,value:t.id})}))}))}},{key:"onPrintPdf",value:function(){return Object(h.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.selectedRows&&this.selectedRows.length?(t=this.selectedRows.filter((function(e){return 3==e.billType})),i=this.selectedRows.filter((function(e){return 3!=e.billType})),t&&t.length&&this.sdReceiptView(t),i&&i.length&&this.receiptView(i)):this.notificationMessage("Please select Bills.","red-snackbar");case 1:case"end":return e.stop()}}),e,this)})))}},{key:"receiptView",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.billService.receiptView(e).subscribe({next:function(e){i&&i.length?t.sdReceiptView(i,e):e?t.downloadFile(e):t.notificationMessage("No data to print","red-snackbar")},error:function(e){t.notificationMessage("No data to print","red-snackbar")}})}},{key:"downloadFile",value:function(e){return Object(h.a)(this,void 0,void 0,regeneratorRuntime.mark((function i(){var n,l,a,o,r,s,c,u;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,ee.PDFDocument.create();case 2:n=i.sent,l=t(e),i.prev=4,l.s();case 6:if((a=l.n()).done){i.next=16;break}return o=a.value,i.next=10,ee.PDFDocument.load(o);case 10:return r=i.sent,i.next=13,n.copyPages(r,r.getPageIndices());case 13:i.sent.forEach((function(e){n.addPage(e)}));case 14:i.next=6;break;case 16:i.next=21;break;case 18:i.prev=18,i.t0=i.catch(4),l.e(i.t0);case 21:return i.prev=21,l.f(),i.finish(21);case 24:return i.next=26,n.save();case 26:s=i.sent,c=new Blob([s],{type:"application/pdf"}),u=window.URL.createObjectURL(c),window.open(u);case 30:case"end":return i.stop()}}),i,null,[[4,18,21,24]])})))}},{key:"base64ToArrayBuffer",value:function(e){for(var t=window.atob(e),i=t.length,n=new Uint8Array(i),l=0;l<i;l++)n[l]=t.charCodeAt(l);return n.buffer}},{key:"downloadReport",value:function(e){var t=[e];3==e.billType?this.sdReceiptView(t):this.receiptView(t)}},{key:"addImage",value:function(e,t){var i;try{if(t&&t.billMasters&&t.billMasters.length&&t.billMasters[0]&&t.billMasters[0].client&&t.billMasters[0].client.imageProperties&&t.billMasters[0].client.imageProperties.length){var n=t.billMasters[0].client.imageProperties.find((function(e){return"receipt"===e.imageType.trim().toLowerCase()}));if(n){var l=new Image;l.src=this.filePath+"/uploads/"+(null===(i=null==t?void 0:t.billMasters[0].client)||void 0===i?void 0:i.photo),l.onload=function(){e.addImage(l,n.imgX,n.imgY,n.imgW,n.imgH)}}else this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar")}else this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar")}catch(a){this.notificationMessage("Image not found.","red-snackbar")}return e}},{key:"getReport",value:function(e,t,i){var n,l,a,o,r,s,c,u,d,m,h,b,f,p,g,v,C,S,T,P,D,w,N,x,k,A,F,R,I,O,W,M,L,B,z,U,E,j,H,Y,V,_,G,X,q,$,J=new Fe.default({orientation:"portrait",unit:"pt",format:"letter"}),Q=Object(y.f)(null===(l=null===(n=null==e?void 0:e.billMasters[0])||void 0===n?void 0:n.client)||void 0===l?void 0:l.website).split(".")[1];J.rect(5,5,J.internal.pageSize.width-10,J.internal.pageSize.height-10,"S"),J.setFontSize(30),this.addImage(J,e),J.setTextColor(0,0,0),J.setFontSize(14),J.setFont("Cambria","bold"),J.text("PAYMENT RECEIPT",260,30),J.setFont("Cambria","normal"),J.setFontSize(14),J.text(Object(y.f)(null===(o=null===(a=null==e?void 0:e.billMasters[0])||void 0===a?void 0:a.client)||void 0===o?void 0:o.clientName).toUpperCase(),10,50),J.setFontSize(10),J.text("TRN: "+Object(y.f)(null===(s=null===(r=null==e?void 0:e.billMasters[0])||void 0===r?void 0:r.client)||void 0===s?void 0:s.trnNo),10,60),J.text("PO Box "+Object(y.f)(null===(d=null===(u=null===(c=null==e?void 0:e.billMasters[0])||void 0===c?void 0:c.client)||void 0===u?void 0:u.addresses[0])||void 0===d?void 0:d.zipPostalCode),10,70),J.text(Object(y.f)(null===(b=null===(h=null===(m=null==e?void 0:e.billMasters[0])||void 0===m?void 0:m.client)||void 0===h?void 0:h.addresses[0])||void 0===b?void 0:b.location,",")+Object(y.f)(null===(g=null===(p=null===(f=null==e?void 0:e.billMasters[0])||void 0===f?void 0:f.client)||void 0===p?void 0:p.addresses[0])||void 0===g?void 0:g.city,",")+Object(y.f)(null===(S=null===(C=null===(v=null==e?void 0:e.billMasters[0])||void 0===v?void 0:v.client)||void 0===C?void 0:C.addresses[0])||void 0===S?void 0:S.country,","),10,80),J.text("Phone: "+Object(y.f)(null===(P=null===(T=null==e?void 0:e.billMasters[0])||void 0===T?void 0:T.client)||void 0===P?void 0:P.phoneNo),10,90),J.text("Email: "+Object(y.f)(null===(w=null===(D=null==e?void 0:e.billMasters[0])||void 0===D?void 0:D.client)||void 0===w?void 0:w.email),10,100),J.text("Web: "+Object(y.f)(null===(x=null===(N=null==e?void 0:e.billMasters[0])||void 0===N?void 0:N.client)||void 0===x?void 0:x.website),10,110),J.setFillColor(241,241,244),J.setDrawColor(206,203,203),J.rect(10,120,250,90,"FD"),J.setTextColor(0,0,0),J.setFontSize(12),J.text(Object(y.f)(null==e?void 0:e.tenantName).toUpperCase(),20,135),J.text("CUSTOMER TRN: "+Object(y.f)(null==e?void 0:e.trn),20,155),J.text("unit #"+Object(y.f)(null===(k=null==e?void 0:e.billMasters[0])||void 0===k?void 0:k.unitNumber),20,170),J.setFontSize(10),J.text(Object(y.f)(null===(A=null==e?void 0:e.billMasters[0])||void 0===A?void 0:A.clientName),20,185),J.text(Object(y.f)(null===(R=null===(F=null==e?void 0:e.billMasters[0].client)||void 0===F?void 0:F.addresses[0])||void 0===R?void 0:R.city,",")+Object(y.f)(null===(W=null===(O=null===(I=null==e?void 0:e.billMasters[0])||void 0===I?void 0:I.client)||void 0===O?void 0:O.addresses[0])||void 0===W?void 0:W.country,","),20,200),J.setFontSize(9),J.autoTable("",i,{startX:210,startY:120,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:400},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:100,halign:"right"}},didParseCell:function(e){var t=e.column.index;0!=t&&1!=t||(e.cell.styles.rowHeight=1)},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});var K=Number(this.decimalPipe.transform(J.autoTable.previous.finalY,"1.0-0"));J.setLineWidth(.1),J.line(5,K+10,607,K+10),J.setTextColor(0,0,0),J.setFontSize(10),J.text("Thank you for using "+Q+" payment services.",20,K+30),J.text("We confirm receipt of your payment.",20,K+40),J.text("Please see the below details for your reference.",20,K+50),J.setTextColor(0,0,0),J.autoTable("",t,{startX:300,startY:K+60,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:110},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:180,halign:"left"},1:{cellWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"}}),J.setTextColor(0,0,0);var Z=Number(this.decimalPipe.transform(J.autoTable.previous.finalY,"1.0-0"));J.setTextColor(255,0,0),J.setFontSize(9),J.text("Note: A Late Fee will be applied after the due date. A Default Payment \nPenalty will be added to any unit that is ".concat(null===(M=null==e?void 0:e.billMasters[0])||void 0===M?void 0:M.penaltyAfter," days or more in arrears."),320,Z+20),J.setTextColor(25,118,210),J.setFontSize(12),J.text("USAGE TIPS to reduce consumption:",10,Z+80),J.text("Please Try to:",10,Z+100),J.setTextColor(0,0,0),J.setFontSize(9),J.text("- Keep filters clean",30,Z+110),J.text("- Set thermostats between 23C and 25C",30,Z+120),J.text("- Keep vents unblocked",30,Z+130),J.text("- Keep doors and windows closed",30,Z+140),J.text("- Undertake regular maintenance of the system",30,Z+150),J.setTextColor(25,118,210),J.setFontSize(12),J.text("Please Do Not:",10,Z+170),J.setTextColor(0,0,0),J.setFontSize(9),J.text("- Set thermostats to 20C or lower",30,Z+180),J.text("- Block vents",30,Z+190),J.text("- Leave doors and windows open",30,Z+200),J.text("- Leave heat producing appliances near thermostats",30,Z+210),J.setFillColor(119,183,11);var ee=J.internal.pageSize.height||J.internal.pageSize.getHeight();J.rect(320,Z+60,280,ee-80-(Z+60),"FD"),J.setFont("Comic Sans"),J.setTextColor(255,255,255),J.setFontSize(16),J.text("ADVERTISE WITH US",360,Z+80);var te=J.getTextWidth("ADVERTISE WITH US");J.setLineWidth(.1),J.line(360,Z+85,360+te,Z+85),J.setFontSize(9),J.text("For advertisement, contact at",390,Z+95),J.text(Object(y.f)(null===(B=null===(L=null==e?void 0:e.billMasters[0])||void 0===L?void 0:L.client)||void 0===B?void 0:B.phoneNo),390,Z+105),J.text(Object(y.f)(null===(U=null===(z=null==e?void 0:e.billMasters[0])||void 0===z?void 0:z.client)||void 0===U?void 0:U.email),390,Z+115),J.text(Object(y.f)(null===(j=null===(E=null==e?void 0:e.billMasters[0])||void 0===E?void 0:E.client)||void 0===j?void 0:j.website),390,Z+125),J.setTextColor(0,0,0),J.setLineWidth(.1),J.line(5,ee-70,607,ee-70),J.text(null!==(X=null!==(V="For any enquiries, write to us "+(null===(Y=null===(H=null==e?void 0:e.billMasters[0])||void 0===H?void 0:H.client)||void 0===Y?void 0:Y.email))&&void 0!==V?V:"\n or Logon to "+(null===(G=null===(_=e.billMasters[0])||void 0===_?void 0:_.client)||void 0===G?void 0:G.website))&&void 0!==X?X:"",10,ee-60),J.setTextColor(255,0,0),J.setFont("bold");var ie=J.getTextWidth("Notice:");J.text("Notice:",340,ee-60),J.setFont("none"),J.setTextColor(0,0,0),J.text("Pay your bills before due date to avoid late payment surcharge",340+ie,ee-60),J.text("and disconnection.",340,ee-50),J.text("You can log onto "+(null===($=null===(q=null==e?void 0:e.billMasters[0])||void 0===q?void 0:q.client)||void 0===$?void 0:$.website)+" to pay your invoices \nTerms & Conditions for Supply of Utility Services",340,ee-40),"function"==typeof J.putTotalPages&&J.putTotalPages("1");var ne=J.output("datauristring");this.pdfsToMerge.push(ne)}},{key:"onSendReceipt",value:function(){var e=this;this.selectedRows&&this.selectedRows.length?this.templateService.emailCustomTemplate({clientId:this.clientId,templateName:"Receipt",notificationType:"Receipt",payments:this.selectedRows}).subscribe({next:function(t){t&&t.status?e.notificationMessage("Notifications send failed. "+t.status,"red-snackbar"):t&&t.isSuccess?e.notificationMessage("Notifications send successfully.\nTotal Requests : "+(null==t?void 0:t.totalRequests)+"\nSuccessfull Requests : "+(null==t?void 0:t.successFullRequests)+"\nFailed Requests : "+(null==t?void 0:t.failedRequests),"green-snackbar"):e.notificationMessage("Notifications send failed.\nTotal Requests : "+(t?t.totalRequests:"0")+"\nSuccessfull Requests : "+(t?t.successFullRequests:"0")+"\nFailed Requests : "+(t?t.failedRequests:"0"),"red-snackbar")},error:function(){e.notificationMessage("Notifications send failed.","red-snackbar")}}):this.notificationMessage("Please select Bills.","red-snackbar")}},{key:"notificationMessage",value:function(e,t){this.snackbar.open(e,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[t]})}},{key:"onDeleteDataRow",value:function(e){var t=this;e.contractNotExist?this.notificationMessage("Contract against this payment is in suspended or closed state, Hence payment can't be cancelled","red-snackbar"):e.refundAmount>0?this.notificationMessage("Can't cancel this payment,refund exist against this payment","red-snackbar"):this.dialog.open(pi,{data:e}).afterClosed().subscribe((function(){e&&t.onGetPaymentHistory(t.manageParams)}))}},{key:"onSelectedRows",value:function(e){this.selectedRows=[],this.selectedRows=e}},{key:"onViewDataRow",value:function(e){this.dialog.open(P,{data:e}).afterClosed().subscribe()}},{key:"getJsonData",value:function(){var e=this;this.tableData=[],null!=this.payments&&this.payments.forEach((function(t){var i={PaymentDate:e.date.transform(t.paymentDate,"yyyy-MM-dd"),PaymentNo:t.paymentNumber,AccountNumber:t.accountNumber,CustomerName:t.tenantName,RefNo:t.paymentReference,PaymentMode:t.paymentMode,ReceivedAmount:t.paymentAmountLocal};e.tableData.push(i)}))}},{key:"onExport",value:function(){if(this.payments&&this.payments.length>0){if(this.getJsonData(),null!=this.tableData){var e=jt.utils.json_to_sheet(this.tableData),t=jt.utils.book_new();jt.utils.book_append_sheet(t,e,"Sheet1"),jt.writeFile(t,"Payment History.xlsx")}}else this.notificationMessage("No Data to Export","yellow-snackbar")}},{key:"onFilterDataRow",value:function(e){var t=0,i=0;e&&e.length&&e.forEach((function(e){t+=e.paymentAmount,i+=e.advanceAmount})),this.receivedAmount=this.currency.transform(t,this.currencyFormat.toString(),!0,this.roundOffFormat),this.advanceAmount=this.currency.transform(i,this.currencyFormat.toString(),!0,this.roundOffFormat)}},{key:"onFilterChange",value:function(e){this.dataSource&&(e=(e=e.trim()).toLowerCase(),this.dataSource.filter=e)}},{key:"onGetPaymentDetail",value:function(e){var t=this,i=Number(this.cookieService.get("globalClientId"));this.billService.getPaymentDetail(e,i).subscribe({next:function(e){e.forEach((function(e){e.paymentDateLocal=t.date.transform(e.paymentDate.toString(),t.dateFormat.toString()),e.referenceDateLocal=t.date.transform(e.referenceDate.toString(),t.dateFormat.toString()),e.paymentAmountLocal=t.currency.transform(e.paymentAmount,t.currency.toString(),!0,t.roundFormat),e.advanceAmountLocal=t.currency.transform(e.advanceAmount,t.currency.toString(),!0,t.roundFormat),e.billMasters&&e.billMasters.length&&e.billMasters.forEach((function(e){var i,n,l,a,o;e.billDateLocal=t.date.transform(null===(i=null==e?void 0:e.billDate)||void 0===i?void 0:i.toString(),t.dateFormat.toString()),e.billAmountLocal=t.currency.transform(null==e?void 0:e.billAmount,t.currency.toString(),!0,t.roundFormat),e.fromDateLocal=t.date.transform(null===(n=null==e?void 0:e.fromDate)||void 0===n?void 0:n.toString(),t.dateFormat.toString()),e.toDateLocal=t.date.transform(null===(l=null==e?void 0:e.toDate)||void 0===l?void 0:l.toString(),t.dateFormat.toString()),e.dueDateLocal=t.date.transform(null===(a=null==e?void 0:e.dueDate)||void 0===a?void 0:a.toString(),t.dateFormat.toString()),e.paidLocal=t.currency.transform(null===(o=null==e?void 0:e.paid)||void 0===o?void 0:o.toString(),t.currency.toString(),!0,t.roundFormat)}))})),t.sdReceiptView(e)},error:function(){t.notificationMessage("Payment details not found","red-snackbar")}})}},{key:"sdReceiptView",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.billService.sdReceiptView(e).subscribe({next:function(e){i&&i.length&&(e.forEach((function(e){i.push(e)})),e=i),e?t.downloadFile(e):t.notificationMessage("No data to print","red-snackbar")},error:function(e){t.notificationMessage("No data to print","red-snackbar")}})}},{key:"content",set:function(e){this.sort=e,this.dataSource&&this.sort&&(this.dataSource.sort=this.sort)}},{key:"visibleColumns",get:function(){return this.displayedColumns.filter((function(e){return e.visible})).map((function(e){return e.property}))}}]),e}()).\u0275fac=function(e){return new(e||Yi)(g.Nb(b.a),g.Nb(M.a),g.Nb(d.f),g.Nb(d.d),g.Nb(d.g),g.Nb(v.b),g.Nb(Ae.a),g.Nb(D.a),g.Nb(B.b),g.Nb(Z.a),g.Nb(w.a),g.Nb(C.a),g.Nb(g.h))},Yi.\u0275cmp=g.Hb({type:Yi,selectors:[["app-payment-history"]],viewQuery:function(e,t){var i;1&e&&(g.Vc(Ht.a,!0),g.Vc(Yt.a,!0)),2&e&&(g.zc(i=g.cc())&&(t.paginator=i.first),g.zc(i=g.cc())&&(t.content=i.first))},inputs:{displayedColumns:"displayedColumns"},decls:17,vars:9,consts:[["mode","card",2,"margin-top","20px"],["fxLayout","column"],["color","primary",1,"position-fixed"],["src","assets/img/fav-icon.png",1,"img-style"],[1,"toolbar-spacer"],[3,"show","sendReceiptClicked","printClicked","exportClicked",4,"ngIf"],["fxFlex","noshrink","fxLayout","column","fxLayout.gt-sm","row","fxLayoutAlign.gt-sm","start stretch",3,"fxLayoutGap"],["fxFlex","grow",1,"basic-forms","route-animations-elements",3,"fxFlex.gt-sm"],["fxLayout","column",1,"result"],[3,"paymentModes","role","searchClicked"],["class","padding","fxLayout","column","style","overflow:auto",4,"ngIf"],["class","padding","fxLayout","column",4,"ngIf"],["class","result","fxLayout.gt-sm","row","fxLayout","column","fxLayoutAlign","end center","fxLayoutGap.gt-sm","12px",4,"ngIf"],[3,"show","sendReceiptClicked","printClicked","exportClicked"],["fxLayout","column",1,"padding",2,"overflow","auto"],[3,"tableData","columnsToDisplay","innerDisplayedColumns","columnNames","innerTableName","visibleButtons","hideHeader","viewButtonColumn","cssStyledColumn","role","buttonDisableColumn","selectedRows","printDataRow","viewDataRow","deleteDataRow","filterDataRow"],["fxLayout","column",1,"padding"],[3,"columns","filterChange"],["mat-table","","matSort","",2,"text-align","center",3,"dataSource"],[4,"ngFor","ngForOf"],["matColumnDef","paymentAmountLocal"],["mat-header-cell","","class","header-align-right",4,"matHeaderCellDef"],["mat-cell","","class","header-align-right",4,"matCellDef"],["matColumnDef","actions"],["class","actions-cell","mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["class","actions-cell","mat-cell","",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["class","clickable route-animations-elements","mat-row","",4,"matRowDef","matRowDefColumns"],[1,"paginator",3,"pageSize"],[3,"matColumnDef",4,"ngIf"],[3,"matColumnDef"],["mat-header-cell","","mat-sort-header","","class","header-align-left",4,"matHeaderCellDef"],["mat-cell","","class","header-align-left",4,"matCellDef"],["mat-header-cell","","mat-sort-header","",1,"header-align-left"],["mat-cell","",1,"header-align-left"],["mat-header-cell","",1,"header-align-right"],["mat-cell","",1,"header-align-right"],["mat-header-cell","","mat-sort-header","",1,"actions-cell"],["mat-cell","",1,"actions-cell"],["matTooltip","Print","mat-icon-button","",1,"example-icon",3,"click"],["mat-header-row",""],["mat-row","",1,"clickable","route-animations-elements"],["fxLayout.gt-sm","row","fxLayout","column","fxLayoutAlign","end center","fxLayoutGap.gt-sm","12px",1,"result"],["color","primary","fxFlex","15%",1,"result"],["type","text","id","advanceAmount","name","advanceAmount","matInput","",2,"text-align","right",3,"ngModel","ngModelChange"],["type","text","id","receivedAmount","name","receivedAmount","matInput","",2,"text-align","right",3,"ngModel","ngModelChange"]],template:function(e,t){1&e&&(g.Tb(0,"fury-page-layout",0),g.Tb(1,"fury-page-layout-content",1),g.Tb(2,"mat-toolbar",2),g.Ob(3,"img",3),g.Tb(4,"span"),g.Rc(5,"Payment History"),g.Sb(),g.Ob(6,"span",4),g.Pc(7,Ai,1,1,"fury-payment-history-footer-toolbar",5),g.Sb(),g.Tb(8,"div",6),g.Tb(9,"fury-card",7),g.Ob(10,"fury-card-header"),g.Tb(11,"fury-card-content",1),g.Tb(12,"div",8),g.Tb(13,"app-payment-history-toolbar",9),g.bc("searchClicked",(function(e){return t.onGetPaymentHistory(e)})),g.Sb(),g.Sb(),g.Pc(14,Fi,2,11,"div",10),g.Pc(15,ji,13,6,"div",11),g.Pc(16,Hi,9,2,"div",12),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb()),2&e&&(g.Cb(7),g.mc("ngIf",0==t.ownerId),g.Cb(1),g.mc("fxLayoutGap",t.gap),g.Cb(1),g.mc("fxFlex.gt-sm",t.col2)("@fadeInUp",void 0),g.Cb(4),g.mc("paymentModes",t.paymentModes)("role",t.role),g.Cb(1),g.mc("ngIf",0==t.ownerId),g.Cb(1),g.mc("ngIf",t.ownerId>0),g.Cb(1),g.mc("ngIf",0==t.ownerId))},directives:[te.a,ie.a,N.d,ne.a,d.o,N.b,N.c,N.e,S.a,S.d,S.c,xi,ki.a,x.a,Vt.a,ye.j,Yt.a,d.n,ye.c,ye.e,ye.b,ye.g,ye.i,Ht.a,ye.d,Yt.b,ye.a,k.a,A.a,F.a,ye.f,ye.h,z.d,z.h,E.b,s.c,s.q,s.t],styles:[".padding[_ngcontent-%COMP%]{padding:0 0 24px}.toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.img-style[_ngcontent-%COMP%]{width:32px}ul[_ngcontent-%COMP%]{margin:20px}.label-color[_ngcontent-%COMP%]{position:relative}.label-color[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{padding-left:20px}.label-color[_ngcontent-%COMP%]   .color-box[_ngcontent-%COMP%]{width:10px;height:10px;display:inline-block;background-color:#ccc;position:absolute;left:5px;top:5px}.position-fixed[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;top:0;z-index:5}.header-align-right[_ngcontent-%COMP%]{text-align:right}.header-align-left[_ngcontent-%COMP%]{text-align:left}"],data:{animation:[p.a,f.a]}}),Yi),$i=["htmlData"],Ji=((Vi=function(){function e(t,i,n,a,o,r,s,c){var u,d,m,h;l(this,e),this.route=t,this.router=i,this.date=n,this.currencyPipe=a,this.decimalPipe=o,this.billSettlementService=r,this.snackbar=s,this.envService=c,this.dateFormat="",this.currency="",this.roundFormat="",this.consumptionRoundOffFormat="",this.filePath="",this.filePath=c.backendForFiles,this.dateFormat=null!==(u=Object(y.e)("DateFormat"))&&void 0!==u?u:c.dateFormat,this.currency=null!==(d=Object(y.e)("Currency"))&&void 0!==d?d:c.currencyFormat,this.roundFormat=null!==(m=Object(y.e)("RoundOff"))&&void 0!==m?m:c.roundOffFormat,this.consumptionRoundOffFormat=null!==(h=Object(y.e)("ConsumptionRoundOff"))&&void 0!==h?h:c.consumptionRoundOffFormat}return o(e,[{key:"ngOnInit",value:function(){var e=this;this.route&&this.route.paramMap.subscribe((function(t){t&&(e.id=t.get("id"),e.type=t.get("type"))})),this.type&&"invoice"===this.type&&this.onGetInvoiceBillDetails(this.id),this.type&&"receipt"===this.type&&this.onGetReceiptDetails(this.id)}},{key:"onGetInvoiceBillDetails",value:function(e){var t=this;this.billSettlementService.getInvoiceBillDetails(e).subscribe((function(e){e.billDateLocal=t.date.transform(e.billDate.toString(),t.dateFormat.toString()),e.fromDateLocal=t.date.transform(e.fromDate.toString(),t.dateFormat.toString()),e.toDateLocal=t.date.transform(e.toDate.toString(),t.dateFormat.toString()),e.dueDateLocal=t.date.transform(e.toDate.toString(),t.dateFormat.toString()),e.billAmountLocal=t.currencyPipe.transform(e.billAmount,t.currency.toString(),!0,t.roundFormat),e.paidLocal=t.currencyPipe.transform(e.paid,t.currency.toString(),!0,t.roundFormat),e.bills.forEach((function(e){e.billAmountLocal=t.currencyPipe.transform(e.billAmount,t.currency.toString(),!0,t.roundFormat)})),"Bill Format 1"===e.billFormat?t.downloadBillReport(e):"Bill Format 2"===e.billFormat?e.bills&&e.bills.length>3?t.downloadLargeBillNewReport(e):t.downloadBillNewReport(e):"Bill Format 3"===e.billFormat&&t.downloadBillNewFormatReport(e)}))}},{key:"downloadLargeBillNewReport",value:function(e){for(var t,i,n,l,a,o,r,s,c,u,d,m,h,b,f,p,g,v,C=this,S=[],T=[],P=[],D=[],w=[],N=[],x=[],k=[],A=[],F=[],R=0;R<e.bills.length;R++)this.consumptionRoundOffFormat=null!==(t=Object(y.e)("ConsumptionRoundOff",e.bills[R].utilityTypeId))&&void 0!==t?t:this.envService.consumptionRoundOffFormat,S.push(e.bills[R].unitNumber),S.push(e.bills[R].deviceName),S.push(this.decimalPipe.transform(e.bills[R].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[R].measuringUnit),S.push(this.decimalPipe.transform(e.bills[R].presentReading,this.consumptionRoundOffFormat)+" "+e.bills[R].measuringUnit),S.push(e.bills[R].isDifferentiateBill?this.decimalPipe.transform(e.bills[R].presentReading-e.bills[R].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[R].measuringUnit:this.decimalPipe.transform(e.bills[R].consumption,this.consumptionRoundOffFormat)+" "+e.bills[R].measuringUnit),"BTU"===e.bills[R].utilityType&&e.bills[R].billTransactions&&e.bills[R].billTransactions.length&&e.bills[R].billTransactions.findIndex((function(e){return e.measuringUnitId&&2===e.measuringUnitId}))>-1?S.push(this.decimalPipe.transform(.284345*e.bills[R].consumption,this.consumptionRoundOffFormat)):S.push(0),T.push(S),S=[];for(var I=0,O=0;O<e.bills.length;O++){this.consumptionRoundOffFormat=null!==(i=Object(y.e)("ConsumptionRoundOff",e.bills[O].utilityTypeId))&&void 0!==i?i:this.envService.consumptionRoundOffFormat;for(var W=e.bills[O],M=0;M<W.billTransactions.length;M++)W.billTransactions[M].headAmount&&(S.push(W.billNumber),S.push(W.billTransactions[M].headDisplay),"BTU"===W.utilityType&&W.billTransactions&&W.billTransactions.length&&W.billTransactions[M]&&W.billTransactions[M].measuringUnitId&&2===W.billTransactions[M].measuringUnitId?(S.push(this.decimalPipe.transform(.284345*W.consumption,this.consumptionRoundOffFormat)),S.push("TR-HR"),S.push(W.consumptionRate)):(S.push(this.decimalPipe.transform(W.consumption,this.consumptionRoundOffFormat)),S.push(W.measuringUnit),S.push(W.consumptionRate)),S.push(this.decimalPipe.transform(W.billTransactions[M].headAmount,this.roundFormat)),k.push(S),S=[],I+=W.billTransactions[M].headAmount)}S.push(e.accountNumber),S.push(e.fromDateLocal+"-"+e.toDateLocal),S.push(this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)),S.push(e.billAmountLocal),D.push(S),e.billCharges.forEach((function(e){if("VAT"!==e.headDisplay){var t=P.find((function(t){return t.label===e.headDisplay}));t?t.value+=e.headAmount:P.push({label:e.headDisplay,value:e.headAmount})}})),P.forEach((function(e){A.push({label:e.label,value:C.currencyPipe.transform(e.value,C.currency.toString(),!0,C.roundFormat)}),I+=e.value})),A.push({label:"Total Charges for Current Period",value:this.currencyPipe.transform(I,this.currency.toString(),!0,this.roundFormat)}),e.billTaxDetails.forEach((function(e){var t=A.find((function(t){return t.label===e.taxDisplayName}));if(t){var i=Number(t.value.replace(C.currency,"").trim())+Number(e.taxAmount);t.value=C.currencyPipe.transform(i,C.currency.toString(),!0,C.roundFormat)}else A.push({label:e.taxDisplayName,value:C.currencyPipe.transform(e.taxAmount,C.currency.toString(),!0,C.roundFormat)})})),A.push({label:"Previous Outstanding Amount",value:this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)},{label:"Total Amount Due",value:this.currencyPipe.transform(e.billAmount+e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)}),w.push({label:"Date of issue",value:null!==(n=null==e?void 0:e.billDateLocal)&&void 0!==n?n:""},{label:"Due Date",value:null!==(l=null==e?void 0:e.dueDateLocal)&&void 0!==l?l:""}),N.push({label:"Customer Name",value:null!==(a=null==e?void 0:e.ownerName)&&void 0!==a?a:""},{label:"Customer AccountNumber",value:null!==(o=null==e?void 0:e.accountNumber)&&void 0!==o?o:""},{label:"Address",value:null!==(s=null===(r=null==e?void 0:e.receiverDetails[0])||void 0===r?void 0:r.address1)&&void 0!==s?s:""},{label:"City",value:null!==(u=null===(c=null==e?void 0:e.receiverDetails[0])||void 0===c?void 0:c.city)&&void 0!==u?u:""},{label:"P.O Box",value:null!==(m=null===(d=null==e?void 0:e.receiverDetails[0])||void 0===d?void 0:d.zipPostalCode)&&void 0!==m?m:""},{label:"Phone number",value:null!==(b=null===(h=null==e?void 0:e.receiverDetails[0])||void 0===h?void 0:h.phoneNumber)&&void 0!==b?b:""},{label:"Fax Number",value:""},{label:"Client",value:null!==(p=null===(f=null==e?void 0:e.client)||void 0===f?void 0:f.clientName)&&void 0!==p?p:""},{label:"Client TRN",value:null!==(v=null===(g=null==e?void 0:e.client)||void 0===g?void 0:g.trnNo)&&void 0!==v?v:""}),x.push({firstItem:"Billing period",secondItem:"From:",thirdItem:e.fromDateLocal,fourthItem:"To:",fifthItem:e.toDateLocal});var L=[];S=[],e&&e.bills&&e.bills.length&&e.bills.forEach((function(e){if(e.billTariffDetails&&e.billTariffDetails.length)for(var t=0;t<e.billTariffDetails.length;t++)e.billTariffDetails[t].slabSettingsId&&e.billTariffDetails[t].slabSettingsId>0&&0==t?L=["Slab","Min Consumption","Max Consumption","Consumption","Rate","Amount"]:0==e.billTariffDetails[t].slabSettingsId&&0==t&&(L=["Season","Week Type","Peak Type","Consumption","Rate","Amount"]),S.push(e.billTariffDetails[t].season),S.push(e.billTariffDetails[t].weekType),S.push(e.billTariffDetails[t].peakType),S.push(e.billTariffDetails[t].consumption),S.push(e.billTariffDetails[t].rate),S.push(e.billTariffDetails[t].amount),F.push(S),S=[]})),this.getNewLargeBillReport(["Unit No","Meter No","Previous Reading","Present Reading","Consumption","Consumption TR-HR"],T,P,["Customer AccountNumber","Billing Period","Previous Due","Total for current period"],D,w,N,x,"Sample Report",["Bill No","Charges","Consumption","Measuring Unit","Tariff","Total"],k,e,A,L,F)}},{key:"addImage",value:function(e,t){var i;try{if(t&&t.client&&t.client.imageProperties&&t.client.imageProperties.length){var n=t.client.imageProperties.find((function(e){return"invoice"===e.imageType.trim().toLowerCase()}));if(n){var l=new Image;l.src=this.filePath+"/uploads/"+(null===(i=null==t?void 0:t.client)||void 0===i?void 0:i.photo),l.onload=function(){e.addImage(l,n.imgX,n.imgY,n.imgW,n.imgH)}}else this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar")}else this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar")}catch(a){this.notificationMessage("Image not found.","red-snackbar")}return e}},{key:"getNewLargeBillReport",value:function(e,t,i,n,l,a,o,r,s,c,u,d,m,h,b){var f,p,g,v,y;(new Image).src=this.filePath+"/uploads/"+(null===(f=null==d?void 0:d.client)||void 0===f?void 0:f.photo);var C=new Fe.default({orientation:"portrait",unit:"pt",format:"letter"}),S=null!==(g=null===(p=null==d?void 0:d.client)||void 0===p?void 0:p.clientName)&&void 0!==g?g:"",T=C.getTextWidth(S.trim())+4;C.setTextColor(0,0,0),C.setFontSize(17),C.setFont("Cambria"),C.text(S,Number(C.internal.pageSize.width/2)-Number(0!=T?T/2:0),23),C.setDrawColor(0,0,0),C.line(Number(C.internal.pageSize.width/2)-Number(0!=T?T/2:0),26,Number(C.internal.pageSize.width/2)-Number(0!=T?T/2:0)+T,26),C.setFont("Cambria","normal"),C.setFontSize(14),C.text("Billing Statement",35,46),this.addImage(C,d),C.autoTable("",a,{startX:10,startY:55,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:35},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:150,halign:"left"},1:{cellWidth:190,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"},didParseCell:function(e){e.cell.styles.cellPadding=1}});var P=Math.round(C.autoTable.previous.finalY);C.autoTable("",r,{startX:10,startY:P,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:35},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:150,halign:"left"},1:{cellWidth:95,halign:"center"},2:{cellWidth:95,halign:"center"},3:{cellWidth:95,halign:"center"},4:{cellWidth:95,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0]},didParseCell:function(e){e.cell.styles.cellPadding=1}});var D=Math.round(C.autoTable.previous.finalY);C.autoTable("",o,{startX:10,startY:D,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:35},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:150,halign:"left"},1:{cellWidth:380,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0]},didParseCell:function(e){e.cell.styles.cellPadding=1}});var w=function(e){var t="Page "+e.pageCount;"function"==typeof C.putTotalPages&&(t=t),C.setFontSize(9)},N=Math.round(C.autoTable.previous.finalY);C.setFont("Cambria"),C.setFontSize(10),C.text("Meter Read-Outs".toUpperCase(),35,N+20),C.autoTable(e,t,{startX:10,startY:N+40,showHead:"everyPage",didDrawPage:w,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:35},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"center"},1:{cellWidth:95,halign:"center"},2:{cellWidth:95,halign:"center"},3:{cellWidth:95,halign:"center"},4:{cellWidth:74,halign:"center"},5:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}});var x=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"));C.setFontSize(10),C.text("Charges Breakdown".toUpperCase(),35,x+20),C.autoTable(c,u,{startX:10,startY:x+40,showHead:"everyPage",didDrawPage:w,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:35},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:60,halign:"center"},1:{cellWidth:155,halign:"center"},2:{cellWidth:85,halign:"center"},3:{cellWidth:85,halign:"center"},4:{cellWidth:74,halign:"center"},5:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}});var k=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"));C.autoTable(h,b,{startX:10,startY:k+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:130,halign:"center"},1:{cellWidth:85,halign:"center"},2:{cellWidth:85,halign:"center"},3:{cellWidth:85,halign:"center"},4:{cellWidth:74,halign:"center"},5:{cellWidth:75,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}});var A=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0")),F=C.internal.pageSize.height;F-A<200&&(C.addPage(),A=P,F=370+P),C.autoTable("",m,{startX:10,startY:A+20,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{bottom:40,left:250},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:244,fontStyle:"italic"},1:{cellWidth:75}},didParseCell:function(e){1==e.column.index&&(e.cell.styles.halign="right"),e.cell.styles.cellPadding=1},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});var R=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"));C.setFillColor(241,241,244),C.rect(35,R+20,535,80,"FD"),C.setFillColor(0,0,0),C.setFontSize(9),C.text(null===(y=null===(v=null==d?void 0:d.client)||void 0===v?void 0:v.termsConditions[0])||void 0===y?void 0:y.termsAndCondition.replace("{{ClientName}}",d.client.clientName).replace("{{TRNNumber}}",d.client.trnNo).replace("{{Currency}}",this.currency),65,R+30),C.setTextColor(0,0,0),C.line(5,R+110,607,R+110),C.text("Notice :- Please tear and attach the slip  along with your payment",35,F-80),C.autoTable(n,l,{startX:10,startY:F-70,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:35},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:120,halign:"center"},1:{cellWidth:200,halign:"center"},2:{cellWidth:100,halign:"right"},3:{cellWidth:120,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}});var I=C.output("blob");window.open(URL.createObjectURL(I))}},{key:"onGetReceiptDetails",value:function(e){var t=this;this.billSettlementService.getReceiptDetails(e).subscribe((function(e){e.paymentDateLocal=t.date.transform(e.paymentDate.toString(),t.dateFormat.toString()),e.referenceDateLocal=t.date.transform(e.referenceDate.toString(),t.dateFormat.toString()),e.paymentAmountLocal=t.currencyPipe.transform(e.paymentAmount,t.currency.toString(),!0,t.roundFormat),e.advanceAmountLocal=t.currencyPipe.transform(e.advanceAmount,t.currency.toString(),!0,t.roundFormat),e.billMasters.forEach((function(e){e.billDateLocal=t.date.transform(e.billDate.toString(),t.dateFormat.toString()),e.billAmountLocal=t.currencyPipe.transform(e.billAmount,t.currency.toString(),!0,t.roundFormat),e.fromDateLocal=t.date.transform(e.fromDate.toString(),t.dateFormat.toString()),e.toDateLocal=t.date.transform(e.toDate.toString(),t.dateFormat.toString()),e.dueDateLocal=t.date.transform(e.dueDate.toString(),t.dateFormat.toString()),e.paidLocal=t.currencyPipe.transform(e.paid.toString(),t.currency.toString(),!0,t.roundFormat)})),t.downloadReport(e)}))}},{key:"downloadBillReport",value:function(e){var t=this,i=[],n=[],l=[],a=[],o=[];e.bills.forEach((function(l){l.billTransactions&&l.billTransactions.length&&l.billTransactions.forEach((function(a){i.push(a.headDisplay),i.push(e.fromDateLocal),i.push(e.toDateLocal),"BTU"===l.utilityType&&a.measuringUnitId&&2===a.measuringUnitId?(i.push(t.decimalPipe.transform(.284345*l.previousReading,t.roundFormat)+" TR-HR"),i.push(t.decimalPipe.transform(.284345*l.presentReading,t.roundFormat)+" TR-HR"),i.push(t.decimalPipe.transform(.284345*l.consumption,t.roundFormat)+" TR-HR")):(i.push(l.previousReading+" "+l.measuringUnit),i.push(l.presentReading+" "+l.measuringUnit),i.push(l.consumption+" "+l.measuringUnit)),i.push(l.consumptionRate),i.push(t.decimalPipe.transform(a.headAmount,t.roundFormat)),n.push(i),i=[]}))})),e.billCharges.forEach((function(e){if("VAT"!==e.headDisplay){var t=l.find((function(t){return t.label===e.headDisplay}));t?t.value+=e.headAmount:l.push({label:e.headDisplay,value:e.headAmount})}}));for(var r=0;r<l.length;r++)i.push(l[r].label),i.push(""),i.push(""),i.push(""),i.push(""),i.push(""),i.push(""),i.push(this.decimalPipe.transform(l[r].value,this.roundFormat)),n.push(i),i=[];var s="";e.bills.forEach((function(e){s+=e.deviceName+","})),a.push({label:"Account Number:",value:e.accountNumber},{label:"Meter Number:",value:s.slice(0,-1)},{label:"Unit Number:",value:e.unitNumber},{label:"Billing Date:",value:e.billDateLocal},{label:"Due Date:",value:e.dueDateLocal});var c=0;n.forEach((function(e){c+=Number(e[7].replace(",",""))})),o.push({label:"Current Month Total:",value:this.currencyPipe.transform(c,this.currency.toString(),!0,this.roundFormat)}),e.billTaxDetails&&e.billTaxDetails.length?e.billTaxDetails.forEach((function(e){o.push({label:e.taxDisplayName,value:t.currencyPipe.transform(e.taxAmount,t.currency.toString(),!0,t.roundFormat)})})):o.push({label:"TAX:",value:this.currencyPipe.transform(0,this.currency.toString(),!0,this.roundFormat)}),o.push({label:"Current Month + TAX:",value:e.billAmountLocal},{label:"Previous Bill Outstanding Balance:",value:this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)},{label:"Total Due incl TAX:",value:this.currencyPipe.transform(e.billAmount+e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)}),this.getBillReport(e,["Services Description","From","To","Previous","Current","Consumption","Rate ","Charges"],n,l,["Customer Id","Billing Period","Total for current period"],[],[{value:"",value1:"Bill Period",value2:"Meter Reading",value3:"",value4:""}],a,o,"Invoice")}},{key:"getBillReport",value:function(e,t,i,n,l,a,o,r,s,c){var u,d,m,h,b,f,p,g,v,C,S,T,P,D,w,N,x,k,A,F,R,I,O,W,M,L,B,z=new Fe.default({orientation:"portrait",unit:"pt",format:"letter"});z.rect(5,5,z.internal.pageSize.width-10,z.internal.pageSize.height-10,"S"),z.setFontSize(30),(z=this.addInvoiceImage(z,e)).setTextColor(0,0,0),z.setFontSize(16),z.setFont("Cambria","bold"),z.text("Tax Invoice",260,30),z.setFontSize(13),z.setFont("Cambria","normal"),z.text(null===(d=null===(u=null==e?void 0:e.client)||void 0===u?void 0:u.clientName)||void 0===d?void 0:d.toUpperCase(),10,60),z.setFontSize(10),z.setFont("Cambria"),z.text("TRN: "+e.client.trnNo,10,70),z.text("PO Box "+e.client.addresses[0].zipPostalCode,10,80),z.text(e.client.addresses[0].address1+","+e.client.addresses[0].country,10,90),z.text("Phone: "+e.client.phoneNo,10,100),z.text("Email: "+e.client.email+", Web: "+e.client.website,10,110),z.setFillColor(241,241,244),z.setDrawColor(206,203,203),z.rect(10,120,350,90,"FD"),z.setTextColor(0,0,0),z.setFontSize(12),z.text(null==e?void 0:e.ownerName.toUpperCase(),20,135),z.text("CUSTOMER TRN: "+e.trn,20,155),z.text("unit #"+e.unitNumber,20,170),z.setFontSize(10),z.text(e.clientName,20,185),z.text(Object(y.f)(null===(m=null==e?void 0:e.client)||void 0===m?void 0:m.buildingName,",")+Object(y.f)(null===(b=null===(h=null==e?void 0:e.client)||void 0===h?void 0:h.addresses[0])||void 0===b?void 0:b.location,",")+Object(y.f)(null===(p=null===(f=null==e?void 0:e.client)||void 0===f?void 0:f.addresses[0])||void 0===p?void 0:p.city,",")+Object(y.f)(null===(v=null===(g=null==e?void 0:e.client)||void 0===g?void 0:g.addresses[0])||void 0===v?void 0:v.country,","),20,200),z.setFontSize(9),z.setLineWidth(.1),z.line(5,265,607,265),z.setFontSize(10),z.setFont("bold"),z.text("Invoice#: ".toUpperCase(),400,110),z.setTextColor(25,118,210);var U=z.getTextWidth("Invoice#: "),E="";(null==e?void 0:e.billNumber)&&(E=null===(C=e.billNumber)||void 0===C?void 0:C.toUpperCase()),z.text(E,410+U,110),z.setFont("none"),z.setTextColor(0,0,0),z.setFontSize(9),z.autoTable("",r,{startX:210,startY:120,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:400},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:100,halign:"right"}},didParseCell:function(e){var t=e.column.index;0!=t&&1!=t||(e.cell.styles.rowHeight=1)},headStyles:{lineWidth:.1,lineColor:[0,0,0]}}),z.autoTable("",o,{startX:10,startY:220,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:220,left:10},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,fontStyle:"bold",halign:"center"},1:{cellWidth:160,fontStyle:"bold",halign:"center"},2:{cellWidth:120,fontStyle:"bold",halign:"center"},3:{cellWidth:75,fontStyle:"bold",halign:"center"},4:{cellWidth:135,fontStyle:"bold",halign:"center"}},didParseCell:function(e){var t=e.column.index;0!=t&&1!=t||(e.cell.styles.rowHeight=1)},headStyles:{lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]}});var j=Number(this.decimalPipe.transform(z.autoTable.previous.finalY,"1.0-0"));z.autoTable(t,i,{startX:10,startY:j,didDrawPage:function(e){var t="Page "+e.pageCount;"function"==typeof z.putTotalPages&&(t+=" of 1",z.rect(5,5,z.internal.pageSize.width-10,z.internal.pageSize.height-10,"S")),z.setFontSize(9);var i=z.internal.pageSize.height||z.internal.pageSize.getHeight();z.text(t,e.settings.margin.left,i-10)},styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:j,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:80,halign:"center"},2:{cellWidth:80,halign:"center"},3:{cellWidth:60,halign:"center"},4:{cellWidth:60,halign:"center"},5:{cellWidth:75,halign:"center"},6:{cellWidth:60,halign:"right"},7:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=r.length>12?1.5:2}}),z.setTextColor(0,0,0);var H=Number(this.decimalPipe.transform(z.autoTable.previous.finalY,"1.0-0"));z.setTextColor(25,118,210),z.setFontSize(12),z.text("Bank Payment Account Details",10,H+20),z.setTextColor(0,0,0),z.setFontSize(9),z.text("Account Title: "+Object(y.f)(null===(T=null===(S=null==e?void 0:e.client)||void 0===S?void 0:S.bankDetails[0])||void 0===T?void 0:T.accountName),10,H+40),z.text("Account #: "+Object(y.f)(null===(D=null===(P=null==e?void 0:e.client)||void 0===P?void 0:P.bankDetails[0])||void 0===D?void 0:D.accountNo),10,H+50),z.text("IBAN #: "+Object(y.f)(null===(N=null===(w=null==e?void 0:e.client)||void 0===w?void 0:w.bankDetails[0])||void 0===N?void 0:N.ibanNumber),10,H+60),z.text("Bank Name: "+Object(y.f)(null===(k=null===(x=null==e?void 0:e.client)||void 0===x?void 0:x.bankDetails[0])||void 0===k?void 0:k.bankName),10,H+70),z.text("Swift Code: "+ +Object(y.f)(null===(F=null===(A=null==e?void 0:e.client)||void 0===A?void 0:A.bankDetails[0])||void 0===F?void 0:F.swiftCode),10,H+80),z.setFontSize(9),z.autoTable("",s,{startX:300,startY:H+20,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:320},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:180,halign:"left"},1:{cellWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"}});var Y=Number(this.decimalPipe.transform(z.autoTable.previous.finalY,"1.0-0"));z.setTextColor(255,0,0),z.text("Note: A Late Fee will be applied after the due date. A Default Payment \nPenalty will be added to any unit that is ".concat(Object(y.f)(null===(R=null==e?void 0:e.penaltyAfter)||void 0===R?void 0:R.toString())," days or more in arrears."),320,Y+10),z.setTextColor(25,118,210),z.setFontSize(12),z.text("USAGE TIPS to reduce consumption:",10,Y+10),z.text("Please Try to:",10,Y+30),z.setTextColor(0,0,0),z.setFontSize(9),z.text("- Keep filters clean",30,Y+40),z.text("- Set thermostats between 23C and 25C",30,Y+50),z.text("- Keep vents unblocked",30,Y+60),z.text("- Keep doors and windows closed",30,Y+70),z.text("- Undertake regular maintenance of the system",30,Y+80),z.setTextColor(25,118,210),z.setFontSize(12),z.text("Please Do Not:",10,Y+100),z.setTextColor(0,0,0),z.setFontSize(9),z.text("- Set thermostats to 20C or lower",30,Y+110),z.text("- Block vents",30,Y+120),z.text("- Leave doors and windows open",30,Y+130),z.text("- Leave heat producing appliances near thermostats",30,Y+140),z.setFillColor(119,183,11);var V=z.internal.pageSize.height||z.internal.pageSize.getHeight();z.rect(320,Y+30,280,V-80-(Y+30),"FD"),z.setFont("Comic Sans"),z.setTextColor(255,255,255),z.setFontSize(16),z.text("ADVERTISE WITH US",360,Y+50);var _=z.getTextWidth("ADVERTISE WITH US");z.setLineWidth(.1),z.line(360,Y+55,360+_,Y+55),z.setFontSize(9),z.text("For advertisement, contact at",390,Y+65),z.text(Object(y.f)(null===(I=null==e?void 0:e.client)||void 0===I?void 0:I.phoneNo),390,Y+75),z.text(Object(y.f)(null===(O=null==e?void 0:e.client)||void 0===O?void 0:O.email),390,Y+85),z.text(Object(y.f)(null===(W=null==e?void 0:e.client)||void 0===W?void 0:W.website),390,Y+95),z.setTextColor(0,0,0),z.setLineWidth(.1),z.line(5,V-70,607,V-70),z.text("For any enquiries, write to us ".concat(Object(y.f)(null===(M=null==e?void 0:e.client)||void 0===M?void 0:M.email)," \nor Logon to ").concat(Object(y.f)(null===(L=null==e?void 0:e.client)||void 0===L?void 0:L.website)),10,V-60),z.setTextColor(255,0,0),z.setFont("bold");var G=z.getTextWidth("Notice:");z.text("Notice:",340,V-60),z.setFont("none"),z.setTextColor(0,0,0),z.text("Pay your bills before due date to avoid late payment surcharge",340+G,V-60),z.text("and disconnection.",340,V-50),z.text("You can log onto ".concat(Object(y.f)(null===(B=null==e?void 0:e.client)||void 0===B?void 0:B.website)," to pay your invoices \nTerms & Conditions for Supply of Utility Services"),340,V-40),"function"==typeof z.putTotalPages&&z.putTotalPages("1");var X=z.output("blob");window.open(URL.createObjectURL(X))}},{key:"downloadReport",value:function(e){var t=[],i=[],n="",l="",a=Array.from(new Set(e.billMasters.map((function(e){return e.billNumber})))),o=Array.from(new Set(e.billMasters.map((function(e){return e.unitNumber}))));a&&a.length&&a.forEach((function(e){n+=e+","})),o&&o.length&&o.forEach((function(e){l+=e+","})),i.push({label:"Receipt Number:",value:e.paymentNumber},{label:"Receipt Date:",value:e.paymentDateLocal},{label:"Account Number:",value:e.accountNumber},{label:"Invoice Number:",value:0===n.trim().indexOf(",")?n.trim().slice(1).slice(0,-1):n.trim().slice(0,-1)},{label:"Unit Number:",value:0===l.trim().indexOf(",")?l.trim().slice(1).slice(0,-1):l.trim().slice(0,-1)},{label:"Mode of payment:",value:e.paymentMode});var r=0;e.billMasters.forEach((function(e){r+=e.paid}));var s=e.outStandingAmount-r;t.push({label:"Total Outstanding Amount :",value:this.currencyPipe.transform(e.outStandingAmount,this.currency.toString(),!0,this.roundFormat)},{label:"Received Payments :",value:e.paymentAmountLocal},{label:"",value:""},{label:"Balance Outstanding :",value:this.currencyPipe.transform(s,this.currency.toString(),!0,this.roundFormat)}),this.getReport(e,t,i)}},{key:"addReceiptImage",value:function(e,t){var i;try{if(t&&t.billMasters&&t.billMasters.length&&t.billMasters[0]&&t.billMasters[0].client&&t.billMasters[0].client.imageProperties&&t.billMasters[0].client.imageProperties.length){var n=t.billMasters[0].client.imageProperties.find((function(e){return"receipt"===e.imageType.trim().toLowerCase()}));if(n){var l=new Image;l.src=this.filePath+"/uploads/"+(null===(i=null==t?void 0:t.billMasters[0].client)||void 0===i?void 0:i.photo),l.onload=function(){e.addImage(l,n.imgX,n.imgY,n.imgW,n.imgH)}}else this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar")}else this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar")}catch(a){this.notificationMessage("Image not found.","red-snackbar")}return e}},{key:"notificationMessage",value:function(e,t){this.snackbar.open(e,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[t]})}},{key:"getReport",value:function(e,t,i){var n,l,a,o,r,s,c,u,d,m,h,b,f,p,g,v,C,S,T,P,D,w,N,x,k,A,F,R,I,O,W,M,L,B,z,U,E,j,H,Y,V,_,G,X,q,$,J=new Fe.default({orientation:"portrait",unit:"pt",format:"letter"}),Q=Object(y.f)(null===(l=null===(n=null==e?void 0:e.billMasters[0])||void 0===n?void 0:n.client)||void 0===l?void 0:l.website).split(".")[1];J.rect(5,5,J.internal.pageSize.width-10,J.internal.pageSize.height-10,"S"),J.setFontSize(30),this.addReceiptImage(J,e),J.setTextColor(0,0,0),J.setFontSize(14),J.setFont("Cambria","bold"),J.text("PAYMENT RECEIPT",260,30),J.setFont("Cambria","normal"),J.setFontSize(14),J.text(Object(y.f)(null===(o=null===(a=null==e?void 0:e.billMasters[0])||void 0===a?void 0:a.client)||void 0===o?void 0:o.clientName).toUpperCase(),10,50),J.setFontSize(10),J.text("TRN: "+Object(y.f)(null===(s=null===(r=null==e?void 0:e.billMasters[0])||void 0===r?void 0:r.client)||void 0===s?void 0:s.trnNo),10,60),J.text("PO Box "+Object(y.f)(null===(d=null===(u=null===(c=null==e?void 0:e.billMasters[0])||void 0===c?void 0:c.client)||void 0===u?void 0:u.addresses[0])||void 0===d?void 0:d.zipPostalCode),10,70),J.text(Object(y.f)(null===(b=null===(h=null===(m=null==e?void 0:e.billMasters[0])||void 0===m?void 0:m.client)||void 0===h?void 0:h.addresses[0])||void 0===b?void 0:b.location,",")+Object(y.f)(null===(g=null===(p=null===(f=null==e?void 0:e.billMasters[0])||void 0===f?void 0:f.client)||void 0===p?void 0:p.addresses[0])||void 0===g?void 0:g.city,",")+Object(y.f)(null===(S=null===(C=null===(v=null==e?void 0:e.billMasters[0])||void 0===v?void 0:v.client)||void 0===C?void 0:C.addresses[0])||void 0===S?void 0:S.country,","),10,80),J.text("Phone: "+Object(y.f)(null===(P=null===(T=null==e?void 0:e.billMasters[0])||void 0===T?void 0:T.client)||void 0===P?void 0:P.phoneNo),10,90),J.text("Email: "+Object(y.f)(null===(w=null===(D=null==e?void 0:e.billMasters[0])||void 0===D?void 0:D.client)||void 0===w?void 0:w.email),10,100),J.text("Web: "+Object(y.f)(null===(x=null===(N=null==e?void 0:e.billMasters[0])||void 0===N?void 0:N.client)||void 0===x?void 0:x.website),10,110),J.setFillColor(241,241,244),J.setDrawColor(206,203,203),J.rect(10,120,250,90,"FD"),J.setTextColor(0,0,0),J.setFontSize(12),J.text(Object(y.f)(null==e?void 0:e.tenantName).toUpperCase(),20,135),J.text("CUSTOMER TRN: "+Object(y.f)(null==e?void 0:e.trn),20,155),J.text("unit #"+Object(y.f)(null===(k=null==e?void 0:e.billMasters[0])||void 0===k?void 0:k.unitNumber),20,170),J.setFontSize(10),J.text(Object(y.f)(null===(A=null==e?void 0:e.billMasters[0])||void 0===A?void 0:A.clientName),20,185),J.text(Object(y.f)(null===(R=null===(F=null==e?void 0:e.billMasters[0].client)||void 0===F?void 0:F.addresses[0])||void 0===R?void 0:R.city,",")+Object(y.f)(null===(W=null===(O=null===(I=null==e?void 0:e.billMasters[0])||void 0===I?void 0:I.client)||void 0===O?void 0:O.addresses[0])||void 0===W?void 0:W.country,","),20,200),J.setFontSize(9),J.autoTable("",i,{startX:210,startY:120,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:400},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:100,halign:"right"}},didParseCell:function(e){var t=e.column.index;0!=t&&1!=t||(e.cell.styles.rowHeight=1)},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});var K=Number(this.decimalPipe.transform(J.autoTable.previous.finalY,"1.0-0"));J.setLineWidth(.1),J.line(5,K+10,607,K+10),J.setTextColor(0,0,0),J.setFontSize(10),J.text("Thank you for using "+Q+" payment services.",20,K+30),J.text("We confirm receipt of your payment.",20,K+40),J.text("Please see the below details for your reference.",20,K+50),J.setTextColor(0,0,0),J.autoTable("",t,{startX:300,startY:K+60,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:110},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:180,halign:"left"},1:{cellWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"}}),J.setTextColor(0,0,0);var Z=Number(this.decimalPipe.transform(J.autoTable.previous.finalY,"1.0-0"));J.setTextColor(255,0,0),J.setFontSize(9),J.text("Note: A Late Fee will be applied after the due date. A Default Payment \nPenalty will be added to any unit that is ".concat(null===(M=null==e?void 0:e.billMasters[0])||void 0===M?void 0:M.penaltyAfter," days or more in arrears."),320,Z+20),J.setTextColor(25,118,210),J.setFontSize(12),J.text("USAGE TIPS to reduce consumption:",10,Z+80),J.text("Please Try to:",10,Z+100),J.setTextColor(0,0,0),J.setFontSize(9),J.text("- Keep filters clean",30,Z+110),J.text("- Set thermostats between 23C and 25C",30,Z+120),J.text("- Keep vents unblocked",30,Z+130),J.text("- Keep doors and windows closed",30,Z+140),J.text("- Undertake regular maintenance of the system",30,Z+150),J.setTextColor(25,118,210),J.setFontSize(12),J.text("Please Do Not:",10,Z+170),J.setTextColor(0,0,0),J.setFontSize(9),J.text("- Set thermostats to 20C or lower",30,Z+180),J.text("- Block vents",30,Z+190),J.text("- Leave doors and windows open",30,Z+200),J.text("- Leave heat producing appliances near thermostats",30,Z+210),J.setFillColor(119,183,11);var ee=J.internal.pageSize.height||J.internal.pageSize.getHeight();J.rect(320,Z+60,280,ee-80-(Z+60),"FD"),J.setFont("Comic Sans"),J.setTextColor(255,255,255),J.setFontSize(16),J.text("ADVERTISE WITH US",360,Z+80);var te=J.getTextWidth("ADVERTISE WITH US");J.setLineWidth(.1),J.line(360,Z+85,360+te,Z+85),J.setFontSize(9),J.text("For advertisement, contact at",390,Z+95),J.text(Object(y.f)(null===(B=null===(L=null==e?void 0:e.billMasters[0])||void 0===L?void 0:L.client)||void 0===B?void 0:B.phoneNo),390,Z+105),J.text(Object(y.f)(null===(U=null===(z=null==e?void 0:e.billMasters[0])||void 0===z?void 0:z.client)||void 0===U?void 0:U.email),390,Z+115),J.text(Object(y.f)(null===(j=null===(E=null==e?void 0:e.billMasters[0])||void 0===E?void 0:E.client)||void 0===j?void 0:j.website),390,Z+125),J.setTextColor(0,0,0),J.setLineWidth(.1),J.line(5,ee-70,607,ee-70),J.text(null!==(X=null!==(V="For any enquiries, write to us "+(null===(Y=null===(H=null==e?void 0:e.billMasters[0])||void 0===H?void 0:H.client)||void 0===Y?void 0:Y.email))&&void 0!==V?V:"\n or Logon to "+(null===(G=null===(_=e.billMasters[0])||void 0===_?void 0:_.client)||void 0===G?void 0:G.website))&&void 0!==X?X:"",10,ee-60),J.setTextColor(255,0,0),J.setFont("bold");var ie=J.getTextWidth("Notice:");J.text("Notice:",340,ee-60),J.setFont("none"),J.setTextColor(0,0,0),J.text("Pay your bills before due date to avoid late payment surcharge",340+ie,ee-60),J.text("and disconnection.",340,ee-50),J.text("You can log onto "+(null===($=null===(q=null==e?void 0:e.billMasters[0])||void 0===q?void 0:q.client)||void 0===$?void 0:$.website)+" to pay your invoices \nTerms & Conditions for Supply of Utility Services",340,ee-40),"function"==typeof J.putTotalPages&&J.putTotalPages("1");var ne=J.output("blob");window.open(URL.createObjectURL(ne))}},{key:"downloadBillNewReport",value:function(e){for(var t,i,n,l,a,o,r,s,c,u,d,m,h,b,f,p,g,v,C,S,T=this,P=[],D=[],w=[],N=[],x=[],k=[],A=[],F=[],R=[],I=[],O=0;O<e.bills.length;O++)this.consumptionRoundOffFormat=null!==(t=Object(y.e)("ConsumptionRoundOff",e.bills[O].utilityTypeId))&&void 0!==t?t:this.consumptionRoundOffFormat,P.push(e.unitNumber),P.push(e.bills[O].deviceName),P.push(this.decimalPipe.transform(e.bills[O].previousReading,this.consumptionRoundOffFormat)),P.push(this.decimalPipe.transform(e.bills[O].presentReading,this.consumptionRoundOffFormat)),P.push(e.bills[O].isDifferentiateBill?this.decimalPipe.transform(e.bills[O].presentReading-e.bills[O].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[O].measuringUnit:this.decimalPipe.transform(e.bills[O].consumption,this.consumptionRoundOffFormat)+" "+e.bills[O].measuringUnit),"BTU"===e.bills[O].utilityType&&e.bills[O].billTransactions&&e.bills[O].billTransactions.length&&e.bills[O].billTransactions.findIndex((function(e){return e.measuringUnitId&&2===e.measuringUnitId}))>-1?P.push(this.decimalPipe.transform(.284345*e.bills[O].consumption,this.consumptionRoundOffFormat)):P.push(0),D.push(P),P=[];for(var W=0,M=0;M<e.bills.length;M++){var L=e.bills[M];this.consumptionRoundOffFormat=null!==(i=Object(y.e)("ConsumptionRoundOff",e.bills[M].utilityTypeId))&&void 0!==i?i:this.consumptionRoundOffFormat;for(var B=0;B<L.billTransactions.length;B++)L.billTransactions[B].headAmount&&(P.push(L.billNumber),P.push(L.billTransactions[B].headDisplay),"BTU"===L.utilityType&&L.billTransactions&&L.billTransactions.length&&L.billTransactions[B]&&L.billTransactions[B].measuringUnitId&&2===L.billTransactions[B].measuringUnitId?(P.push(this.decimalPipe.transform(.284345*L.consumption,this.consumptionRoundOffFormat)),P.push("TR-HR"),P.push(L.consumptionRate)):(P.push(this.decimalPipe.transform(L.consumption,this.consumptionRoundOffFormat)),P.push(L.measuringUnit),P.push(L.consumptionRate)),P.push(this.decimalPipe.transform(L.billTransactions[B].headAmount,this.roundFormat)),F.push(P),P=[],W+=L.billTransactions[B].headAmount)}P.push(e.accountNumber),P.push(e.fromDateLocal+"-"+e.toDateLocal),P.push(this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)),P.push(e.billAmountLocal),N.push(P),e.billCharges.forEach((function(e){if("VAT"!==e.headDisplay){var t=w.find((function(t){return t.label===e.headDisplay}));t?t.value+=e.headAmount:w.push({label:e.headDisplay,value:e.headAmount})}})),w.forEach((function(e){R.push({label:e.label,value:T.currencyPipe.transform(e.value,T.currency.toString(),!0,T.roundFormat)}),W+=e.value})),R.push({label:"Total Charges for Current Period",value:this.currencyPipe.transform(W,this.currency.toString(),!0,this.roundFormat)}),e.billTaxDetails.forEach((function(e){var t=R.find((function(t){return t.label===e.taxDisplayName}));if(t){var i=Number(t.value.replace(T.currency,"").trim())+Number(e.taxAmount);t.value=T.currencyPipe.transform(i,T.currency.toString(),!0,T.roundFormat)}else R.push({label:e.taxDisplayName,value:T.currencyPipe.transform(e.taxAmount,T.currency.toString(),!0,T.roundFormat)})})),R.push({label:"Previous Outstanding Amount",value:this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)},{label:"Total Amount Due",value:this.currencyPipe.transform(e.billAmount+e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)}),x.push({label:"Bill No",value:null!==(n=null==e?void 0:e.billNumber)&&void 0!==n?n:""},{label:"Date of issue",value:null!==(l=null==e?void 0:e.billDateLocal)&&void 0!==l?l:""},{label:"Due Date",value:null!==(a=null==e?void 0:e.dueDateLocal)&&void 0!==a?a:""}),k.push({label:"Customer Name",value:null!==(o=null==e?void 0:e.ownerName)&&void 0!==o?o:""},{label:"Customer AccountNumber",value:null!==(r=null==e?void 0:e.accountNumber)&&void 0!==r?r:""},{label:"Unit No",value:null!==(s=null==e?void 0:e.unitNumber)&&void 0!==s?s:""},{label:"Address",value:null!==(u=null===(c=null==e?void 0:e.receiverDetails[0])||void 0===c?void 0:c.address1)&&void 0!==u?u:""},{label:"City",value:null!==(m=null===(d=null==e?void 0:e.receiverDetails[0])||void 0===d?void 0:d.city)&&void 0!==m?m:""},{label:"P.O Box",value:null!==(b=null===(h=null==e?void 0:e.receiverDetails[0])||void 0===h?void 0:h.zipPostalCode)&&void 0!==b?b:""},{label:"Phone number",value:null!==(p=null===(f=null==e?void 0:e.receiverDetails[0])||void 0===f?void 0:f.phoneNumber)&&void 0!==p?p:""},{label:"Fax Number",value:""},{label:"Client",value:null!==(v=null===(g=null==e?void 0:e.client)||void 0===g?void 0:g.clientName)&&void 0!==v?v:""},{label:"Client TRN",value:null!==(S=null===(C=null==e?void 0:e.client)||void 0===C?void 0:C.trnNo)&&void 0!==S?S:""}),A.push({firstItem:"Billing period",secondItem:"From:",thirdItem:e.fromDateLocal,fourthItem:"To:",fifthItem:e.toDateLocal});var z=[];P=[],e&&e.bills&&e.bills.length&&e.bills.forEach((function(e){if(e.billTariffDetails&&e.billTariffDetails.length)for(var t=0;t<e.billTariffDetails.length;t++)e.billTariffDetails[t].slabSettingsId&&e.billTariffDetails[t].slabSettingsId>0&&0==t?z=["Slab","Min Consumption","Max Consumption","Consumption","Rate","Amount"]:0==e.billTariffDetails[t].slabSettingsId&&0==t&&(z=["Season","Week Type","Peak Type","Consumption","Rate","Amount"]),P.push(e.billTariffDetails[t].season),P.push(e.billTariffDetails[t].weekType),P.push(e.billTariffDetails[t].peakType),P.push(e.billTariffDetails[t].consumption),P.push(e.billTariffDetails[t].rate),P.push(e.billTariffDetails[t].amount),I.push(P),P=[]})),this.getNewBillReport(["Unit No","Meter No","Previous Reading","Present Reading","Consumption","Consumption TR-HR"],D,w,["Customer AccountNumber","Billing Period","Previous Due","Total for current period"],N,x,k,A,"Sample Report",["Charges","Consumption","Measuring Unit","Tariff","Total"],F,e,R,z,I)}},{key:"addInvoiceImage",value:function(e,t){var i;try{if(t&&t.client&&t.client.imageProperties&&t.client.imageProperties.length){var n=t.client.imageProperties.find((function(e){return"invoice"===e.imageType.trim().toLowerCase()}));if(n){var l=new Image;l.src=this.filePath+"/uploads/"+(null===(i=null==t?void 0:t.client)||void 0===i?void 0:i.photo),l.onload=function(){e.addImage(l,n.imgX,n.imgY,n.imgW,n.imgH)}}else this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar")}else this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar")}catch(a){this.notificationMessage("Image not found.","red-snackbar")}return e}},{key:"getNewBillReport",value:function(e,t,i,n,l,a,o,r,s,c,u,d,m,h,b){var f,p,g,v,y,C,S,T,P=new Fe.default({orientation:"portrait",unit:"pt",format:"letter"}),D=null!==(p=null===(f=null==d?void 0:d.client)||void 0===f?void 0:f.clientName)&&void 0!==p?p:"",w=P.getTextWidth(D.trim());P.setTextColor(0,0,0),P.setFontSize(17),P.setFont("Cambria"),P.text(D,Number(P.internal.pageSize.width/2)-Number(0!=w?w/2:0),18),this.addInvoiceImage(P,d),P.setLineWidth(.1),P.line(Number(P.internal.pageSize.width/2)-Number(0!=w?w/2:0),21,Number(P.internal.pageSize.width/2)-Number(0!=w?w/2:0)+w,21),P.setFontSize(13);var N="";d&&d.client&&d.client.addresses[0]&&","==(N=null!==(C=null!==(v=null===(g=d.client.addresses[0].address1)||void 0===g?void 0:g.toLowerCase())&&void 0!==v?v:","+(null===(y=d.client.addresses[0].city)||void 0===y?void 0:y.toLowerCase()))&&void 0!==C?C:"").trim()&&(N=""),P.text(N,Number(P.internal.pageSize.width/2)-Number(0!=w?w/2:0)+5,30),P.setLineWidth(.1),P.setFontSize(14),P.text("Billing Statement",30,41),P.autoTable("",a,{startX:10,startY:50,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:150,halign:"left"},1:{cellWidth:190,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"},didParseCell:function(e){e.cell.styles.cellPadding=1}});var x=Number(this.decimalPipe.transform(P.autoTable.previous.finalY,"1.0-0"));P.autoTable("",r,{startX:10,startY:x,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:150,halign:"left"},1:{cellWidth:95,halign:"center"},2:{cellWidth:95,halign:"center"},3:{cellWidth:95,halign:"center"},4:{cellWidth:95,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0]},didParseCell:function(e){e.cell.styles.cellPadding=1}});var k=Number(this.decimalPipe.transform(P.autoTable.previous.finalY,"1.0-0"));P.autoTable("",o,{startX:10,startY:k,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:150,halign:"left"},1:{cellWidth:380,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0]},didParseCell:function(e){e.cell.styles.cellPadding=1}});var A=Number(this.decimalPipe.transform(P.autoTable.previous.finalY,"1.0-0"));P.setFont("Cambria"),P.setFontSize(10),P.text("Meter Read-Outs".toUpperCase(),30,A+15),P.autoTable(e,t,{startX:10,startY:A+30,didDrawPage:function(e){var t="Page "+e.pageCount;P.setFontSize(10);var i=P.internal.pageSize.height||P.internal.pageSize.getHeight();P.text(t,e.settings.margin.left,i-10)},styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"center"},1:{cellWidth:95,halign:"center"},2:{cellWidth:95,halign:"center"},3:{cellWidth:95,halign:"center"},4:{cellWidth:74,halign:"center"},5:{cellWidth:75,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}});var F=Number(this.decimalPipe.transform(P.autoTable.previous.finalY,"1.0-0"));P.setFontSize(10),P.text("Charges Breakdown".toUpperCase(),30,F+15),P.autoTable(c,u,{startX:10,startY:F+30,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:60,halign:"center"},1:{cellWidth:155,halign:"center"},2:{cellWidth:85,halign:"center"},3:{cellWidth:85,halign:"center"},4:{cellWidth:74,halign:"center"},5:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}});var R=Number(this.decimalPipe.transform(P.autoTable.previous.finalY,"1.0-0"));P.autoTable(h,b,{startX:10,startY:R+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:130,halign:"center"},1:{cellWidth:85,halign:"center"},2:{cellWidth:85,halign:"center"},3:{cellWidth:85,halign:"center"},4:{cellWidth:74,halign:"center"},5:{cellWidth:75,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}});var I=Number(this.decimalPipe.transform(P.autoTable.previous.finalY,"1.0-0"));P.autoTable("",m,{startX:10,startY:I+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{bottom:35,left:230},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:235,fontStyle:"italic"},1:{cellWidth:100}},didParseCell:function(e){1==e.column.index&&(e.cell.styles.halign="right"),e.cell.styles.cellPadding=1},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});var O=Number(this.decimalPipe.transform(P.autoTable.previous.finalY,"1.0-0"));P.setFillColor(241,241,244),P.rect(30,O+20,535,80,"FD"),P.setFillColor(0,0,0),P.setFontSize(9),P.text(null===(T=null===(S=null==d?void 0:d.client)||void 0===S?void 0:S.termsConditions[0])||void 0===T?void 0:T.termsAndCondition.replace("{{ClientName}}",d.client.clientName).replace("{{TRNNumber}}",d.client.trnNo).replace("{{Currency}}",this.currency),60,O+30),P.setTextColor(0,0,0),P.line(5,O+110,607,O+110);var W=P.internal.pageSize.height;P.text("Notice :- Please tear and attach the slip  along with your payment",30,W-90),P.autoTable(n,l,{startX:10,startY:W-80,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:120,halign:"center"},1:{cellWidth:200,halign:"center"},2:{cellWidth:100,halign:"right"},3:{cellWidth:120,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}),"function"==typeof P.putTotalPages&&P.putTotalPages("1");var M=P.output("blob");window.open(URL.createObjectURL(M))}},{key:"downloadBillNewFormatReport",value:function(e){for(var t,i,n,l,a,o,r,s,c,u,d,m=this,h=[],b=[],f=[],p=[],g=[],v=[],C=[],S=[],T=["Meter No","Tarif","Previous Reading","Present Reading","Consumption","Unit Rate "+this.currency+"/TR-HR","Amount"],P=0;P<e.bills.length;P++)this.consumptionRoundOffFormat=null!==(t=Object(y.e)("ConsumptionRoundOff",e.bills[P].utilityTypeId))&&void 0!==t?t:this.envService.consumptionRoundOffFormat,h.push(e.bills[P].deviceName),h.push(e.bills[P].utilityType),"BTU"===e.bills[P].utilityType&&e.bills[P].billTransactions&&e.bills[P].billTransactions.length&&e.bills[P].billTransactions.findIndex((function(e){return e.measuringUnitId&&2===e.measuringUnitId}))>-1?(h.push(this.decimalPipe.transform(.284345*e.bills[P].previousReading,this.roundFormat)+" TR-HR"),h.push(this.decimalPipe.transform(.284345*e.bills[P].presentReading,this.roundFormat)+" TR-HR"),h.push(this.decimalPipe.transform(.284345*e.bills[P].consumption,this.roundFormat)+" TR-HR")):(h.push(this.decimalPipe.transform(e.bills[P].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[P].measuringUnit),h.push(this.decimalPipe.transform(e.bills[P].presentReading,this.consumptionRoundOffFormat)+" "+e.bills[P].measuringUnit),h.push(this.decimalPipe.transform(e.bills[P].consumption,this.consumptionRoundOffFormat)+" "+e.bills[P].measuringUnit)),h.push(e.bills[P].consumptionRate),h.push(e.bills[P].billAmountLocal),b.push(h),h=[];for(var D=0;D<e.bills.length;D++){this.consumptionRoundOffFormat=null!==(i=Object(y.e)("ConsumptionRoundOff",e.bills[D].utilityTypeId))&&void 0!==i?i:this.envService.consumptionRoundOffFormat;for(var w=e.bills[D],N=0;N<w.billTransactions.length;N++)h.push(w.utilityType+"-"+w.billTransactions[N].headDisplay),h.push(this.decimalPipe.transform(w.consumption,this.consumptionRoundOffFormat)),h.push(w.consumptionUnit),h.push(w.consumptionRate),h.push(this.decimalPipe.transform(w.billTransactions[N].headAmount,this.roundFormat)),C.push(h),h=[]}h.push(e.accountNumber),h.push(e.fromDateLocal+"-"+e.toDateLocal),h.push(e.billAmountLocal),p.push(h);var x=[];e.bills.forEach((function(e){if(e.billTransactions&&e.billTransactions.length){var t=["consumption","consumptioncharge"];e.billTransactions.forEach((function(e){if(!t.includes(e.headDisplay.toLowerCase())){var i=x.find((function(t){return t.label===e.headDisplay}));i?i.value+=e.headAmount:x.push({label:e.headDisplay,value:e.headAmount})}}))}})),e.billCharges.forEach((function(e){if("VAT"!==e.headDisplay){var t=x.find((function(t){return t.label===e.headDisplay}));t?t.value+=e.headAmount:x.push({label:e.headDisplay,value:e.headAmount})}})),x.forEach((function(e){f.push({label:e.label,value:m.currencyPipe.transform(e.value,m.currency.toString(),!0,m.roundFormat)}),Number(e.value)})),e.billTaxDetails&&e.billTaxDetails.length&&e.billTaxDetails.forEach((function(e){f.push({label:e.taxDisplayName,value:m.currencyPipe.transform(e.taxAmount,m.currency.toString(),!0,m.roundFormat)}),Number(e.taxAmount)})),S.push({label:"Total for Current Period",value:this.currencyPipe.transform(e.billAmount+e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)}),g.push({label:"Bill No",value:": "+Object(y.f)(e.billNumber)},{label:"Date of issue",value:": "+Object(y.f)(e.billDateLocal)},{label:"Due Date",value:": "+Object(y.f)(e.dueDateLocal)}),v.push({label:"Billing period",value:":  From: ".concat(Object(y.f)(e.fromDateLocal)," To: ").concat(Object(y.f)(e.toDateLocal)," ")},{label:"Customer Account",value:": "+Object(y.f)(e.accountNumber)},{label:"Customer Name",value:": "+Object(y.f)(e.ownerName)},{label:"Unit No",value:": "+Object(y.f)(e.unitNumber)},{label:"Address",value:": "+Object(y.f)(null===(l=null===(n=null==e?void 0:e.client)||void 0===n?void 0:n.addresses[0])||void 0===l?void 0:l.address1)},{label:"City",value:": "+Object(y.f)(null===(o=null===(a=null==e?void 0:e.client)||void 0===a?void 0:a.addresses[0])||void 0===o?void 0:o.city)},{label:"P.O Box",value:": "+Object(y.f)(null===(s=null===(r=null==e?void 0:e.client)||void 0===r?void 0:r.addresses[0])||void 0===s?void 0:s.zipPostalCode)},{label:"Phone number",value:": "+Object(y.f)(null===(c=null==e?void 0:e.receiverDetails[0])||void 0===c?void 0:c.phoneNumber)},{label:"Fax Number",value:": "},{label:"Client",value:": "+Object(y.f)(null===(u=null==e?void 0:e.client)||void 0===u?void 0:u.clientName)},{label:"Client TRN",value:": "+Object(y.f)(null===(d=null==e?void 0:e.client)||void 0===d?void 0:d.trnNo)}),this.getNewBillFormatReport(T,b,f,["Customer Number","Billing Period","Total for current period"],p,g,v,[],"Sample Report",["Charges","Consumption","Measuring Unit","Tariff","Total"],C,e,S)}},{key:"getNewBillFormatReport",value:function(e,t,i,n,l,a,o,r,s,c,u,d,m){var h,b,f=new Fe.default({orientation:"portrait",unit:"pt",format:"letter"});f.rect(5,5,f.internal.pageSize.width-10,f.internal.pageSize.height-10,"S"),f.setTextColor(0,0,0),f.setFontSize(11),f.setFont("Cambria"),f.text("Billing Statement".toUpperCase(),10,20),this.addInvoiceImage(f,d),f.setLineWidth(.1),f.autoTable("",a,{startX:10,startY:35,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:15},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:190,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"},didParseCell:function(e){e.cell.styles.cellPadding=1.5}});var p=Number(this.decimalPipe.transform(f.autoTable.previous.finalY,"1.0-0"));f.autoTable("",o,{startX:10,startY:p,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:15},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:380,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0]},didParseCell:function(e){e.cell.styles.cellPadding=1.5}});var g=Number(this.decimalPipe.transform(f.autoTable.previous.finalY,"1.0-0"));f.setFont("Cambria"),f.text("Meter Read-Out".toUpperCase(),10,g+15),f.autoTable(e,t,{startX:10,startY:g+30,didDrawPage:function(e){var t="Page "+e.pageCount;f.setFontSize(10);var i=f.internal.pageSize.height||f.internal.pageSize.getHeight();f.text(t,e.settings.margin.left,i-10)},styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:15},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:70,halign:"center"},1:{cellWidth:100,halign:"center"},2:{cellWidth:90,halign:"center"},3:{cellWidth:90,halign:"center"},4:{cellWidth:80,halign:"center"},5:{cellWidth:73,halign:"center"},6:{cellWidth:73,halign:"center"},7:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1.5}});var v=Number(this.decimalPipe.transform(f.autoTable.previous.finalY,"1.0-0"));f.autoTable("",i,{startX:10,startY:v+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{bottom:35,left:250},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:250,fontStyle:"italic"},1:{cellWidth:100}},didParseCell:function(e){1==e.column.index&&(e.cell.styles.halign="right"),e.cell.styles.cellPadding=1.5},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});var y=Number(this.decimalPipe.transform(f.autoTable.previous.finalY,"1.0-0"));f.line(5,y+10,607,y+10),f.autoTable("",m,{startX:10,startY:y+20,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{bottom:35,left:250},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:250,fontStyle:"italic"},1:{cellWidth:100}},didParseCell:function(e){1==e.column.index&&(e.cell.styles.halign="right"),e.cell.styles.cellPadding=1.5},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});var C=Number(this.decimalPipe.transform(f.autoTable.previous.finalY,"1.0-0"));f.line(5,C+10,607,C+10),f.text(null===(b=null===(h=null==d?void 0:d.client)||void 0===h?void 0:h.termsConditions[0])||void 0===b?void 0:b.termsAndCondition.replace("{{ClientName}}",d.client.clientName).replace("{{TRNNumber}}",d.client.trnNo).replace("{{Currency}}",this.currency),10,C+30);var S=f.internal.pageSize.height||f.internal.pageSize.getHeight();f.text("Notice :- Please tear and attach the slip  along with your payment",10,S-90),f.autoTable(n,l,{startX:10,startY:S-70,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:15},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"center"},1:{cellWidth:340,halign:"center"},2:{cellWidth:150,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1.5}}),"function"==typeof f.putTotalPages&&f.putTotalPages("1");var T=f.output("blob");window.open(URL.createObjectURL(T))}}]),e}()).\u0275fac=function(e){return new(e||Vi)(g.Nb(m.a),g.Nb(m.f),g.Nb(d.f),g.Nb(d.d),g.Nb(d.g),g.Nb(M.a),g.Nb(B.b),g.Nb(C.a))},Vi.\u0275cmp=g.Hb({type:Vi,selectors:[["fury-email-pdf-report"]],viewQuery:function(e,t){var i;1&e&&g.Vc($i,!0),2&e&&g.zc(i=g.cc())&&(t.htmlData=i.first)},decls:0,vars:0,template:function(e,t){},styles:[""]}),Vi),Qi=["htmlData"],Ki=((Xi=function(){function e(t,i,n,a,o,r,s,c,u,d,m,h){var b,f,p,g;l(this,e),this.billService=t,this.masterService=i,this.billSettlementService=n,this.date=a,this.currencyPipe=o,this.decimalPipe=r,this.dialog=s,this.templateService=c,this.cookieService=u,this.clientSelectionService=d,this.snackbar=m,this.envService=h,this._gap=16,this.gap=this._gap+"px",this.col2="1 1 calc(50% - ".concat(this._gap/2,"px)"),this.col3="1 1 calc(33.3333% - ".concat(this._gap/1.5,"px)"),this.tenants=[],this.billPeriods=[],this.billTypes=[],this.selectedRows=[],this.columns=[],this.innerColumns=[],this.columnNames=[],this.billMasterDetails=[],this.manageParams={},this.pdfsToMerge=[],this.billAmount="",this.receivedAmount="",this.billNumberConsumptionColumnName="Bill No",this.buildingColumnName="Building",this.unitNumberColumnName="Unit Number",this.smsColumnName="SMS",this.emailColumnName="Email",this.watsappColumnName="Watsapp",this.dateFormat="",this.currency="",this.roundFormat="",this.consumptionRoundOffFormat="",this.filePath="",this.billNumberColumnName="Bill Number",this.accountNumberColumnName="Account Number",this.billDateColumnName="BillDate",this.tenantNameColumnName="Tenant Name",this.entityTypeColumnName="Owner/Tenant",this.unitColumnName="Unit",this.fromDateColumnName="From Date",this.toDateColumnName="To Date",this.dueDateColumnName="Due Date",this.billAmountColumnName="Bill Amount",this.paidColumnName="Paid",this.reasonColumnName="Reason",this.utilityTypeCoulmnNmae="Utility Type",this.meterNumberCoulmnNmae="Meter Number",this.previousReadingColumnName="Previous",this.presentReadingColumnName="Present",this.currentConsumptionColumnName="Cur-Consumption",this.filePath=h.backendForFiles,this.dateFormat=null!==(b=Object(y.e)("DateFormat"))&&void 0!==b?b:h.dateFormat,this.currency=null!==(f=Object(y.e)("Currency"))&&void 0!==f?f:h.currencyFormat,this.roundFormat=null!==(p=Object(y.e)("RoundOff"))&&void 0!==p?p:h.roundOffFormat,this.consumptionRoundOffFormat=null!==(g=Object(y.e)("ConsumptionRoundOff"))&&void 0!==g?g:h.consumptionRoundOffFormat}return o(e,[{key:"ngOnInit",value:function(){this.clientSelectionService.setIsClientVisible(!0),this.clientId=parseInt(this.cookieService.get("globalClientId")),this.onGetTenants(),this.getBillPeriods(),this.getBillTypes(),this.createColumnNames(),this.createGridColumns(),this.createInnerGridColumns()}},{key:"createGridColumns",value:function(){this.columns=["select","accountNumber","ownerName","entityType","unitNumber","fromDateLocal","toDateLocal","dueDateLocal","billAmountLocal","paidLocal","cancelRemarks","button"]}},{key:"createInnerGridColumns",value:function(){this.innerColumns=["utilityType","deviceName","previousReadingLocal","presentReadingLocal","consumptionLocal","billAmountLocal"]}},{key:"createColumnNames",value:function(){this.columnNames=[{name:this.billNumberColumnName,property:"billNumber"},{name:this.accountNumberColumnName,property:"accountNumber"},{name:this.billDateColumnName,property:"billDate"},{name:this.tenantNameColumnName,property:"ownerName"},{name:this.entityTypeColumnName,property:"entityType"},{name:this.unitColumnName,property:"unitNumber"},{name:this.fromDateColumnName,property:"fromDateLocal"},{name:this.toDateColumnName,property:"toDateLocal"},{name:this.dueDateColumnName,property:"dueDateLocal"},{name:this.billAmountColumnName,property:"billAmountLocal",columnAlign:{"text-align":"right"}},{name:this.paidColumnName,property:"paidLocal",columnAlign:{"text-align":"right"}},{name:this.reasonColumnName,property:"cancelRemarks"},{name:this.utilityTypeCoulmnNmae,property:"utilityType"},{name:this.meterNumberCoulmnNmae,property:"deviceName"},{name:this.previousReadingColumnName,property:"previousReadingLocal"},{name:this.presentReadingColumnName,property:"presentReadingLocal"},{name:this.currentConsumptionColumnName,property:"consumptionLocal"},{name:this.billAmountColumnName,property:"amountLocal",columnAlign:{"text-align":"right"}}]}},{key:"onGetBillsHistory",value:function(e){var t=this;this.manageParams=e,this.billMasterDetails=[],this.billAmount="";var i=0;this.receivedAmount="";var n=0;e.fromDate=""==e.fromDate?"":L(e.fromDate).format("YYYY-MM-DD"),e.toDate=""==e.toDate?"":L(e.toDate).format("YYYY-MM-DD"),e.clientId=this.clientId,this.billService.getBillCancelledHistory(e).subscribe((function(e){t.dateFormat=Object(y.e)("DateFormat"),t.roundFormat=Object(y.e)("RoundOff"),t.currency=Object(y.e)("Currency"),e.forEach((function(e){e.billDateLocal=t.date.transform(e.billDate.toString(),t.dateFormat.toString()),e.fromDateLocal=t.date.transform(e.fromDate.toString(),t.dateFormat.toString()),e.toDateLocal=t.date.transform(e.toDate.toString(),t.dateFormat.toString()),e.dueDateLocal=t.date.transform(e.toDate.toString(),t.dateFormat.toString()),e.billAmountLocal=t.currencyPipe.transform(e.billAmount,t.currency.toString(),!0,t.roundFormat),e.paidLocal=t.currencyPipe.transform(e.paid,t.currency.toString(),!0,t.roundFormat),e.bills.forEach((function(e){var i;t.consumptionRoundOffFormat=null!==(i=Object(y.e)("ConsumptionRoundOff",e.utilityTypeId))&&void 0!==i?i:t.envService.consumptionRoundOffFormat,e.previousReadingLocal=t.decimalPipe.transform(e.previousReading,t.consumptionRoundOffFormat),e.presentReadingLocal=t.decimalPipe.transform(e.presentReading,t.consumptionRoundOffFormat),e.consumptionLocal=t.decimalPipe.transform(e.consumption,t.consumptionRoundOffFormat),e.billAmountLocal=t.currencyPipe.transform(e.billAmount,t.currency.toString(),!0,t.roundFormat)})),i+=e.billAmount,n+=e.paid})),t.billMasterDetails=e,t.billAmount=t.currencyPipe.transform(i,t.currency.toString(),!0,t.roundFormat),t.receivedAmount=t.currencyPipe.transform(n,t.currency.toString(),!0,t.roundFormat)}))}},{key:"onSelectedRows",value:function(e){this.selectedRows=[],this.selectedRows=e}},{key:"getBillPeriods",value:function(){var e=this;this.billPeriods=[{label:"Select",value:0}],this.billService.getBillPeriods(this.clientId).subscribe((function(t){t.forEach((function(t){e.billPeriods.push({label:t.periodDescription,value:t.id})}))}))}},{key:"getBillTypes",value:function(){var e=this;this.billTypes=[{label:"Select",value:0}],this.masterService.getSystemMasterdata(64,0).subscribe((function(t){t.forEach((function(t){e.billTypes.push({label:t.description,value:t.id})}))}))}},{key:"onGetTenants",value:function(){var e=this;this.billSettlementService.getTenantsDetails(this.clientId).subscribe((function(t){e.tenants=t}))}},{key:"onViewDataRow",value:function(e){this.dialog.open(P,{data:e}).afterClosed().subscribe()}},{key:"downloadReport",value:function(e){for(var t,i=[],n=[],l=[],a=[],o=[],r=[],s=[],c=0;c<e.bills.length;c++)this.consumptionRoundOffFormat=null!==(t=Object(y.e)("ConsumptionRoundOff",e.bills[c].utilityTypeId))&&void 0!==t?t:this.envService.consumptionRoundOffFormat,i.push(e.bills[c].deviceName),i.push(this.decimalPipe.transform(e.bills[c].previousReading,this.consumptionRoundOffFormat)),i.push(this.decimalPipe.transform(e.bills[c].presentReading,this.consumptionRoundOffFormat)),i.push(e.bills[c].measuringUnit),i.push(this.decimalPipe.transform(e.bills[c].consumption,this.consumptionRoundOffFormat)),i.push(e.bills[c].consumptionRate),i.push(e.bills[c].billAmountLocal),n.push(i),i=[];i.push(e.ownerId),i.push(e.fromDateLocal+"-"+e.toDateLocal),i.push(e.billAmountLocal),a.push(i),e.bills.forEach((function(e){e.billTransactions&&e.billTransactions.length&&e.billTransactions.forEach((function(e){var t=l.find((function(t){return t.label===e.headDisplay}));t?t.value+=e.headAmount:l.push({label:e.headDisplay,value:e.headAmount})}))})),e.billCharges.forEach((function(e){var t=l.find((function(t){return t.label===e.headDisplay}));t?t.value+=e.headAmount:l.push({label:e.headDisplay,value:e.headAmount})}));var u=0;l.forEach((function(e){u+=Number(e.value)})),l.push({label:"Total",value:u}),o.push({label:"Bill No",value:e.billNumber},{label:"Date of issue",value:e.billDateLocal},{label:"Due Date",value:e.dueDateLocal}),r.push({label:"Customer Name",value:e.ownerName},{label:"Customer Id",value:e.ownerId},{label:"Unit No",value:e.unitNumber},{label:"Address",value:""},{label:"City",value:""},{label:"P.O Box",value:""},{label:"Phone number",value:""}),s.push({firstItem:"Billing period",secondItem:"From:",thirdItem:e.fromDateLocal,fourthItem:"To:",fifthItem:e.toDateLocal}),this.getReport(["Meter Type","Previous Reading","Present Reading","Measuring Unit","Consumption","Unit Rate","Amount"],n,l,["Customer Id","Billing Period","Total for current period"],a,o,r,s,"Bill History")}},{key:"getReport",value:function(e,t,i,n,l,a,o,r,s){var c=new Image;c.src="assets/img/logo_dark.png";var u=new Fe.default({orientation:"portrait",unit:"pt",format:"letter"});u.rect(5,5,u.internal.pageSize.width-10,u.internal.pageSize.height-10,"S"),u.setFontSize(14),u.text("BOULEVARD TOWER",u.internal.pageSize.width/2-30-50,30);var d=u.getTextWidth("BOULEVARD TOWER");u.setLineWidth(.1),u.line(u.internal.pageSize.width/2-30-50,33,u.internal.pageSize.width/2-30-50+d,33),u.text("Muscat Hills",u.internal.pageSize.width/2-60,50),u.setFontSize(10),u.setLineWidth(.1),u.line(5,55,607,55),u.autoTable("",a,{startX:10,startY:60,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100},1:{cellWidth:245}},didParseCell:function(e){var t=e.column.index;0!=t&&1!=t||(e.cell.styles.rowHeight=1)},headStyles:{lineWidth:.1,lineColor:[0,0,0]}}),u.autoTable("",r,{startX:10,startY:115,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100},1:{cellWidth:50},2:{cellWidth:195},3:{cellWidth:50},4:{cellWidth:195}},didParseCell:function(e){var t=e.column.index;0!=t&&1!=t&&2!=t&&3!=t&&4!=t||(e.cell.styles.rowHeight=1)},headStyles:{lineWidth:.1,lineColor:[0,0,0]}}),u.autoTable("",o,{startX:10,startY:132,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100},1:{cellWidth:490}},didParseCell:function(e){var t=e.column.index;0!=t&&1!=t||(e.cell.styles.rowHeight=1)},headStyles:{lineWidth:.1,lineColor:[0,0,0]}}),u.addImage(c,"png",400,60,120,55),u.setLineWidth(.1),u.line(5,265,607,265),u.setFont("bold"),u.text("Meter Read-Outs".toUpperCase(),10,290),u.setFont("none"),u.autoTable(e,t,{startX:10,startY:310,didDrawPage:function(e){var t="Page "+e.pageCount;"function"==typeof u.putTotalPages&&(t+=" of 1"),u.setFontSize(10);var i=u.internal.pageSize.height||u.internal.pageSize.getHeight();u.text(t,e.settings.margin.left,i-10)},styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:80,halign:"center"},1:{cellWidth:95,halign:"center"},2:{cellWidth:95,halign:"center"},3:{cellWidth:95,halign:"center"},4:{cellWidth:74,halign:"center"},5:{cellWidth:75,halign:"center"},6:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"}}),u.setTextColor(0,0,0);var m=Number(this.decimalPipe.transform(u.autoTable.previous.finalY,"1.0-0"));u.setLineWidth(.1),u.line(5,m+10,607,m+10),u.autoTable("",i,{startX:10,startY:m+20,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{bottom:50,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:490,fontStyle:"italic"},1:{cellWidth:100}},didParseCell:function(e){1==e.column.index&&(e.cell.styles.halign="right")},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});var h=Number(this.decimalPipe.transform(u.autoTable.previous.finalY,"1.0-0"));u.setFillColor(255,255,200),u.rect(10,h+20,590,80,"FD"),u.setFillColor(0,0,0),u.text("Notes :-",50,h+30),u.text("Payment should be ade within 15 days",50,h+40),u.text("1. Cash / Cheque",50,h+50),u.text("2. Tax Registeration Number",50,h+60),u.text("3. Minimum charges payable",50,h+70),u.text("4. Late fee of ".concat(this.currency," 50 /- will be levied, if payments are made by the due date"),50,h+80),u.text("5. Late payment fee of 1 % per month will be calculated on the over due amount from the origional date of payment",50,h+90),u.setTextColor(0,0,0),u.line(5,h+110,607,h+110),u.text("Notice :- Please tear and attach the slip  along with your payment",50,h+130),u.autoTable(n,l,{startX:10,startY:h+150,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{bottom:110,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"center"},1:{cellWidth:340,halign:"center"},2:{cellWidth:150,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"}}),"function"==typeof u.putTotalPages&&u.putTotalPages("1");var b=u.output("blob");window.open(URL.createObjectURL(b))}},{key:"onSendEmail",value:function(){this.selectedRows&&this.templateService.emailInvoiceTemplate({notificationType:"EMAIL",templateType:"Invoice",templateName:"Custom",billMasterDetails:this.selectedRows}).subscribe({next:function(e){},error:function(e){}})}},{key:"invoiceView",value:function(e){var t=this;this.billService.invoiceView(e).subscribe({next:function(e){e?t.downloadFile(e):t.notificationMessage("No data to print","red-snackbar")},error:function(e){t.notificationMessage("No data to print","red-snackbar")}})}},{key:"downloadFile",value:function(e){return Object(h.a)(this,void 0,void 0,regeneratorRuntime.mark((function i(){var n,l,a,o,r,s,c,u;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,ee.PDFDocument.create();case 2:n=i.sent,l=t(e),i.prev=4,l.s();case 6:if((a=l.n()).done){i.next=16;break}return o=a.value,i.next=10,ee.PDFDocument.load(o);case 10:return r=i.sent,i.next=13,n.copyPages(r,r.getPageIndices());case 13:i.sent.forEach((function(e){n.addPage(e)}));case 14:i.next=6;break;case 16:i.next=21;break;case 18:i.prev=18,i.t0=i.catch(4),l.e(i.t0);case 21:return i.prev=21,l.f(),i.finish(21);case 24:return i.next=26,n.save();case 26:s=i.sent,c=new Blob([s],{type:"application/pdf"}),u=window.URL.createObjectURL(c),window.open(u);case 30:case"end":return i.stop()}}),i,null,[[4,18,21,24]])})))}},{key:"onPrintPdf",value:function(){return Object(h.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.selectedRows&&this.selectedRows.length?this.invoiceView(this.selectedRows):this.notificationMessage("Please select Bills.","red-snackbar");case 1:case"end":return e.stop()}}),e,this)})))}},{key:"downloadBillFormat1LargeReport",value:function(e){var t,i,n=this,l=[],a=[],o=[],r=[],s=[],c=[],u=[],d=[],m=["Unit No","Meter No","Previous Reading","Present Reading","Consumption"],h=["Bill No","Charges","Consumption","Measuring Unit","Tariff","Total"],b="";e.bills.forEach((function(e){b+=e.deviceName+","})),s.push({label:"Account Number:",value:e.accountNumber},{label:"Meter Number:",value:b.slice(0,-1)},{label:"Unit Number:",value:e.unitNumber},{label:"Billing Date:",value:e.billDateLocal},{label:"Due Date:",value:e.dueDateLocal},{label:"Bill Period",value:"".concat(Object(y.f)(e.fromDateLocal)," - ").concat(Object(y.f)(e.toDateLocal)," ")});var f=!1,p=!1;if(e&&e.bills&&e.bills.length){var g=Array.from(new Set(e.bills.map((function(e){return e.billNumber})))),v=Array.from(new Set(e.bills.map((function(e){return e.unitNumber}))));if(f=!!(g&&g.length>1),p=!!(v&&v.length>1),f||h.splice(0,1),p){var C=s.findIndex((function(e){return"Unit Number:"===e.label}));s.splice(C,1)}else m.splice(0,1)}for(var S=0;S<e.bills.length;S++)this.consumptionRoundOffFormat=null!==(t=Object(y.e)("ConsumptionRoundOff",e.bills[S].utilityTypeId))&&void 0!==t?t:this.envService.consumptionRoundOffFormat,p&&l.push(e.bills[S].unitNumber),l.push(e.bills[S].deviceName),l.push(this.decimalPipe.transform(e.bills[S].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[S].measuringUnit),l.push(this.decimalPipe.transform(e.bills[S].presentReading,this.consumptionRoundOffFormat)+" "+e.bills[S].measuringUnit),l.push(e.bills[S].isDifferentiateBill?this.decimalPipe.transform(e.bills[S].presentReading-e.bills[S].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[S].measuringUnit:this.decimalPipe.transform(e.bills[S].consumption,this.consumptionRoundOffFormat)+" "+e.bills[S].measuringUnit),"BTU"===e.bills[S].utilityType&&e.bills[S].billTransactions&&e.bills[S].billTransactions.length&&e.bills[S].billTransactions.findIndex((function(e){return e.measuringUnitId&&2===e.measuringUnitId}))>-1&&(0==S&&m.push("Consumption TR-HR"),l.push(this.decimalPipe.transform(.284345*e.bills[S].consumption,this.consumptionRoundOffFormat))),a.push(l),l=[];for(var T=0,P=0;P<e.bills.length;P++){this.consumptionRoundOffFormat=null!==(i=Object(y.e)("ConsumptionRoundOff",e.bills[P].utilityTypeId))&&void 0!==i?i:this.envService.consumptionRoundOffFormat;for(var D=e.bills[P],w=0;w<D.billTransactions.length;w++)f&&l.push(D.billNumber),l.push(D.billTransactions[w].headDisplay),"BTU"===D.utilityType&&D.billTransactions&&D.billTransactions.length&&D.billTransactions[w]&&D.billTransactions[w].measuringUnitId&&2===D.billTransactions[w].measuringUnitId?(l.push(this.decimalPipe.transform(.284345*D.consumption,this.consumptionRoundOffFormat)),l.push("TR-HR"),l.push(D.billTransactions[w].rate)):(l.push(this.decimalPipe.transform(D.consumption,this.consumptionRoundOffFormat)),l.push(D.measuringUnit),l.push(D.billTransactions[w].rate)),l.push(this.currencyPipe.transform(D.billTransactions[w].headAmount,this.currency.toString(),!0,this.roundFormat)),u.push(l),l=[],T+=D.billTransactions[w].headAmount}l.push(e.accountNumber),l.push(e.fromDateLocal+"-"+e.toDateLocal),l.push(this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)),l.push(e.billAmountLocal),r.push(l),e.billCharges&&e.billCharges.length&&(e.billCharges.sort((function(e,t){return e.position-t.position})).forEach((function(e){if("VAT"!==e.headDisplay){var t=o.find((function(t){return t.label===e.headDisplay}));t?t.value+=e.headAmount:o.push({label:e.headDisplay,value:e.headAmount})}})),o.forEach((function(e){c.push({label:e.label,value:n.currencyPipe.transform(e.value,n.currency.toString(),!0,n.roundFormat)})}))),c.push({label:"Current Month Total Consumption Charge:",value:this.currencyPipe.transform(T,this.currency.toString(),!0,this.roundFormat)}),e.billTaxDetails&&e.billTaxDetails.length?e.billTaxDetails.forEach((function(e){c.push({label:e.taxDisplayName,value:n.currencyPipe.transform(e.taxAmount,n.currency.toString(),!0,n.roundFormat)})})):c.push({label:"TAX:",value:this.currencyPipe.transform(0,this.currency.toString(),!0,this.roundFormat)}),c.push({label:"Current Month + TAX:",value:e.billAmountLocal},{label:"Previous Bill Outstanding Balance:",value:this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)},{label:"Total Due incl TAX:",value:this.currencyPipe.transform(e.billAmount+e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)});var N=[],x=!1;l=[],e&&e.bills&&e.bills.length&&e.bills.forEach((function(e){var t;if(n.consumptionRoundOffFormat=null!==(t=Object(y.e)("ConsumptionRoundOff",e.utilityTypeId))&&void 0!==t?t:n.envService.consumptionRoundOffFormat,e.billTariffDetails&&e.billTariffDetails.length)for(var i=0;i<e.billTariffDetails.length;i++){if(e.billTariffDetails[i].slabSettingsId&&e.billTariffDetails[i].slabSettingsId>0){var a=e.billTariffDetails[i].season;Number(e.billTariffDetails[i].peakType)<Number(e.billTariffDetails[i].consumption)&&(a=e.billTariffDetails[i].peakType+" - "+e.billTariffDetails[i].consumption),0==i&&(x=!0,N=["Slab","Consumption","Rate","Amount"]),l.push(a),l.push(n.decimalPipe.transform(e.billTariffDetails[i].consumption,n.consumptionRoundOffFormat)),l.push(e.billTariffDetails[i].rate),l.push(n.currencyPipe.transform(e.billTariffDetails[i].amount,n.currency.toString(),!0,n.roundFormat))}else 0==e.billTariffDetails[i].slabSettingsId&&(0==i&&(N=["Season","Week Type","Peak Type","Consumption","Rate","Amount"]),l.push(e.billTariffDetails[i].season),l.push(e.billTariffDetails[i].weekType),l.push(e.billTariffDetails[i].peakType),l.push(n.decimalPipe.transform(e.billTariffDetails[i].consumption,n.consumptionRoundOffFormat)),l.push(e.billTariffDetails[i].rate),l.push(n.currencyPipe.transform(e.billTariffDetails[i].amount,n.currency.toString(),!0,n.roundFormat)));d.push(l),l=[]}})),this.getNewBillFormat1LargeReport(m,a,o,["Customer AccountNumber","Billing Period","Previous Due","Total for current period"],r,[],s,c,"Invoice",h,u,e,[],N,d,x)}},{key:"getNewBillFormat1LargeReport",value:function(e,t,i,n,l,a,o,r,s,c,u,d,m,h,b){var f,p,g,v,C,S,T,P,D,w,N,x,k,A,F,R,I,O,W,M,L,B,z=arguments.length>15&&void 0!==arguments[15]&&arguments[15],U=new Fe.default({orientation:"portrait",unit:"pt",format:"letter"});U.rect(5,5,U.internal.pageSize.width-10,U.internal.pageSize.height-10,"S"),U.setFontSize(30),(U=this.addImage(U,d)).setTextColor(0,0,0),U.setFontSize(16),U.setFont("Cambria","bold"),U.text("Tax Invoice",260,30),U.setFontSize(13),U.setFont("Cambria","normal"),U.text(d.client.clientName.toUpperCase(),10,60),U.setFontSize(10),U.setFont("Cambria"),U.text("TRN: "+d.client.trnNo,10,70),U.text("PO Box "+d.client.addresses[0].zipPostalCode,10,80),U.text(d.client.addresses[0].address1+","+d.client.addresses[0].country,10,90),U.text("Phone: "+d.client.phoneNo,10,100),U.text("Email: "+d.client.email+", Web: "+d.client.website,10,110),U.setFontSize(10),U.setFont("bold"),U.text("Invoice#: ".toUpperCase(),370,110),U.setTextColor(25,118,210);var E=U.getTextWidth("Invoice#: "),j="";(null==d?void 0:d.billNumber)&&(j=null===(f=d.billNumber)||void 0===f?void 0:f.toUpperCase()),U.text(j,380+E,110),U.setFont("none"),U.setTextColor(0,0,0),U.setFontSize(9),U.autoTable("",o,{startY:120,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:370},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:80,halign:"left"},1:{cellWidth:150,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0]},didParseCell:function(e){e.cell.styles.cellPadding=6===e.length?1.8:2.7}});var H=Number(this.decimalPipe.transform(U.autoTable.previous.finalY,"1.0-0"));U.setLineWidth(.1),U.line(5,H+5,607,H+5),U.setFont("Cambria"),U.setFillColor(241,241,244),U.setDrawColor(206,203,203),U.rect(10,120,340,H-120,"FD"),U.setTextColor(0,0,0),U.setFontSize(12),U.text(null==d?void 0:d.ownerName.toUpperCase(),20,135),U.text("CUSTOMER TRN: "+d.trn,20,150),U.text("unit #"+d.unitNumber,20,165),U.setFontSize(10),U.text(Object(y.f)(null==d?void 0:d.clientName,""),20,180),U.text(Object(y.f)(null===(p=null==d?void 0:d.client)||void 0===p?void 0:p.buildingName,",")+Object(y.f)(null===(v=null===(g=null==d?void 0:d.client)||void 0===g?void 0:g.addresses[0])||void 0===v?void 0:v.location,",")+Object(y.f)(null===(S=null===(C=null==d?void 0:d.client)||void 0===C?void 0:C.addresses[0])||void 0===S?void 0:S.city,",")+Object(y.f)(null===(P=null===(T=null==d?void 0:d.client)||void 0===T?void 0:T.addresses[0])||void 0===P?void 0:P.country,","),20,195),U.setFontSize(10),U.text("Meter Read-Outs".toUpperCase(),10,H+20);var Y=function(e){};if(U.autoTable(e,t,{startX:10,startY:H+35,showHead:"everyPage",didDrawPage:Y,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:6==e.length?120:4==e.length?200:155,halign:"center"},1:{cellWidth:6==e.length?100:4==e.length?135:125,halign:"center"},2:{cellWidth:6==e.length?100:4==e.length?135:125,halign:"center"},3:{cellWidth:4==e.length?120:100,halign:"center"},4:{cellWidth:85,halign:"center"},5:{cellWidth:85,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}),u&&u.length){var V=Number(this.decimalPipe.transform(U.autoTable.previous.finalY,"1.0-0"));U.setFontSize(10),U.text("Charges Breakdown".toUpperCase(),10,V+15),U.autoTable(c,u,{startX:10,startY:V+30,showHead:"everyPage",didDrawPage:Y,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:6==c.length?80:200,halign:"center"},1:{cellWidth:6==c.length?180:100,halign:"center"},2:{cellWidth:6==c.length?90:100,halign:"center"},3:{cellWidth:6==c.length?90:100,halign:"center"},4:{cellWidth:6==c.length?75:90,halign:"right"},5:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}})}var _=Number(this.decimalPipe.transform(U.autoTable.previous.finalY,"1.0-0")),G=U.internal.pageSize.height,X=_;z?(U.autoTable(h,b,{startX:10,startY:X+10,showHead:"everyPage",didDrawPage:Y,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:250,halign:"center"},1:{cellWidth:120,halign:"center"},2:{cellWidth:120,halign:"center"},3:{cellWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}),X=Number(this.decimalPipe.transform(U.autoTable.previous.finalY,"1.0-0"))):(U.autoTable(h,b,{startX:10,startY:_+10,showHead:"everyPage",didDrawPage:Y,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:140,halign:"center"},1:{cellWidth:100,halign:"center"},2:{cellWidth:100,halign:"center"},3:{cellWidth:100,halign:"center"},4:{cellWidth:75,halign:"center"},5:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}),X=Number(this.decimalPipe.transform(U.autoTable.previous.finalY,"1.0-0"))),G-X<200&&(U.addPage(),U.setTextColor(25,118,210),U.rect(5,5,U.internal.pageSize.width-10,U.internal.pageSize.height-10,"S"),X=10),U.setTextColor(25,118,210),U.setFontSize(12),U.text("Bank Payment Account Details",10,X+20),U.setTextColor(0,0,0),U.setFontSize(9),U.text("Account Title: "+Object(y.f)(null===(w=null===(D=null==d?void 0:d.client)||void 0===D?void 0:D.bankDetails[0])||void 0===w?void 0:w.accountName),10,X+40),U.text("Account #: "+Object(y.f)(null===(x=null===(N=null==d?void 0:d.client)||void 0===N?void 0:N.bankDetails[0])||void 0===x?void 0:x.accountNo),10,X+50),U.text("IBAN #: "+Object(y.f)(null===(A=null===(k=null==d?void 0:d.client)||void 0===k?void 0:k.bankDetails[0])||void 0===A?void 0:A.ibanNumber),10,X+60),U.text("Bank Name: "+Object(y.f)(null===(R=null===(F=null==d?void 0:d.client)||void 0===F?void 0:F.bankDetails[0])||void 0===R?void 0:R.bankName),10,X+70),U.text("Swift Code: "+ +Object(y.f)(null===(O=null===(I=null==d?void 0:d.client)||void 0===I?void 0:I.bankDetails[0])||void 0===O?void 0:O.swiftCode),10,X+80),U.setFontSize(9),U.autoTable("",r,{startX:300,startY:X+20,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:320},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:180,halign:"left"},1:{cellWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"},didParseCell:function(e){e.cell.styles.cellPadding=1.8}}),Number(this.decimalPipe.transform(U.autoTable.previous.finalY,"1.0-0"))>G-190&&(U.addPage(),U.rect(5,5,U.internal.pageSize.width-10,U.internal.pageSize.height-10,"S"),G=400),(null===(M=null===(W=null==d?void 0:d.client)||void 0===W?void 0:W.termsConditions[0])||void 0===M?void 0:M.termsAndCondition)&&(U.setFillColor(241,241,244),U.rect(10,G-190,590,90,"FD"),U.setFillColor(0,0,0),U.setFontSize(9),U.text(null===(B=null===(L=null==d?void 0:d.client)||void 0===L?void 0:L.termsConditions[0])||void 0===B?void 0:B.termsAndCondition.replace("{{ClientName}}",d.client.clientName).replace("{{TRNNumber}}",d.client.trnNo).replace("{{Currency}}",this.currency),40,G-175)),U.setTextColor(0,0,0),U.line(5,G-95,607,G-95),U.text("Notice :- Please tear and attach the slip  along with your payment",10,G-80),U.autoTable(n,l,{startX:10,startY:G-65,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:130,halign:"center"},1:{cellWidth:210,halign:"center"},2:{cellWidth:110,halign:"right"},3:{cellWidth:140,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}});var q=U.output("datauristring");this.pdfsToMerge.push(q)}},{key:"downloadBillFormat3LargeReport",value:function(e){var t,i,n,l,a,o,r,s,c,u,d,m=this,h=[],b=[],f=[],p=[],g=[],v=[],C=[],S=[],T=[],P=["Unit No","Meter No","Previous Reading","Present Reading","Consumption"],D=["Bill No","Charges","Consumption","Measuring Unit","Tariff","Total"];g.push({label:"Bill No",value:": "+Object(y.f)(e.billNumber)},{label:"Date of issue",value:": "+Object(y.f)(e.billDateLocal)},{label:"Due Date",value:": "+Object(y.f)(e.dueDateLocal)}),v.push({label:"Billing period",value:": From: ".concat(Object(y.f)(e.fromDateLocal)," To: ").concat(Object(y.f)(e.toDateLocal)," ")},{label:"Customer Account",value:": "+Object(y.f)(e.accountNumber)},{label:"Customer Name",value:": "+Object(y.f)(e.ownerName)},{label:"Address",value:": "+Object(y.f)(null===(i=null===(t=null==e?void 0:e.client)||void 0===t?void 0:t.addresses[0])||void 0===i?void 0:i.address1)},{label:"City",value:": "+Object(y.f)(null===(l=null===(n=null==e?void 0:e.client)||void 0===n?void 0:n.addresses[0])||void 0===l?void 0:l.city)},{label:"P.O Box",value:": "+Object(y.f)(null===(o=null===(a=null==e?void 0:e.client)||void 0===a?void 0:a.addresses[0])||void 0===o?void 0:o.zipPostalCode)},{label:"Phone number",value:": "+Object(y.f)(null===(r=null==e?void 0:e.receiverDetails[0])||void 0===r?void 0:r.phoneNumber)},{label:"Fax Number",value:": "},{label:"Client",value:": "+Object(y.f)(null===(s=null==e?void 0:e.client)||void 0===s?void 0:s.clientName)},{label:"Client TRN",value:": "+Object(y.f)(null===(c=null==e?void 0:e.client)||void 0===c?void 0:c.trnNo)});var w=!1,N=!1;if(e&&e.bills&&e.bills.length){var x=Array.from(new Set(e.bills.map((function(e){return e.billNumber})))),k=Array.from(new Set(e.bills.map((function(e){return e.unitNumber}))));if(w=!!(x&&x.length>1),N=!!(k&&k.length>1),w?g.splice(0,1):D.splice(0,1),N){var A=v.findIndex((function(e){return"Unit No"===e.label}));v.splice(A,1)}else P.splice(0,1)}for(var F=0;F<e.bills.length;F++)this.consumptionRoundOffFormat=null!==(u=Object(y.e)("ConsumptionRoundOff",e.bills[F].utilityTypeId))&&void 0!==u?u:this.envService.consumptionRoundOffFormat,N&&h.push(e.bills[F].unitNumber),h.push(e.bills[F].deviceName),h.push(this.decimalPipe.transform(e.bills[F].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[F].measuringUnit),h.push(this.decimalPipe.transform(e.bills[F].presentReading,this.consumptionRoundOffFormat)+" "+e.bills[F].measuringUnit),h.push(e.bills[F].isDifferentiateBill?this.decimalPipe.transform(e.bills[F].presentReading-e.bills[F].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[F].measuringUnit:this.decimalPipe.transform(e.bills[F].consumption,this.consumptionRoundOffFormat)+" "+e.bills[F].measuringUnit),"BTU"===e.bills[F].utilityType&&e.bills[F].billTransactions&&e.bills[F].billTransactions.length&&e.bills[F].billTransactions.findIndex((function(e){return e.measuringUnitId&&2===e.measuringUnitId}))>-1&&(0==F&&P.push("Consumption TR-HR"),h.push(this.decimalPipe.transform(.284345*e.bills[F].consumption,this.consumptionRoundOffFormat))),b.push(h),h=[];for(var R=0;R<e.bills.length;R++){this.consumptionRoundOffFormat=null!==(d=Object(y.e)("ConsumptionRoundOff",e.bills[R].utilityTypeId))&&void 0!==d?d:this.envService.consumptionRoundOffFormat;for(var I=e.bills[R],O=0;O<I.billTransactions.length;O++)w&&h.push(I.billNumber),h.push(I.billTransactions[O].headDisplay),"BTU"===I.utilityType&&I.billTransactions&&I.billTransactions.length&&I.billTransactions[O]&&I.billTransactions[O].measuringUnitId&&2===I.billTransactions[O].measuringUnitId?(h.push(this.decimalPipe.transform(.284345*I.consumption,this.consumptionRoundOffFormat)),h.push("TR-HR"),h.push(I.billTransactions[O].rate)):(h.push(this.decimalPipe.transform(I.consumption,this.consumptionRoundOffFormat)),h.push(I.measuringUnit),h.push(I.billTransactions[O].rate)),h.push(this.currencyPipe.transform(I.billTransactions[O].headAmount,this.currency.toString(),!0,this.roundFormat)),C.push(h),h=[],I.billTransactions[O].headAmount}h.push(e.accountNumber),h.push(e.fromDateLocal+"-"+e.toDateLocal),h.push(this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)),h.push(e.billAmountLocal),p.push(h),e.bills.forEach((function(e){e.deviceName}));var W=[],M=!1;h=[],e&&e.bills&&e.bills.length&&e.bills.forEach((function(e){var t;if(m.consumptionRoundOffFormat=null!==(t=Object(y.e)("ConsumptionRoundOff",e.utilityTypeId))&&void 0!==t?t:m.envService.consumptionRoundOffFormat,e.billTariffDetails&&e.billTariffDetails.length)for(var i=0;i<e.billTariffDetails.length;i++){if(e.billTariffDetails[i].slabSettingsId&&e.billTariffDetails[i].slabSettingsId>0){var n=e.billTariffDetails[i].season;Number(e.billTariffDetails[i].peakType)<Number(e.billTariffDetails[i].consumption)&&(n=e.billTariffDetails[i].peakType+" - "+e.billTariffDetails[i].consumption),0==i&&(M=!0,W=["Slab","Consumption","Rate","Amount"]),h.push(n),h.push(m.decimalPipe.transform(e.billTariffDetails[i].consumption,m.consumptionRoundOffFormat)),h.push(e.billTariffDetails[i].rate),h.push(m.currencyPipe.transform(e.billTariffDetails[i].amount,m.currency.toString(),!0,m.roundFormat))}else 0==e.billTariffDetails[i].slabSettingsId&&(0==i&&(W=["Season","Week Type","Peak Type","Consumption","Rate","Amount"]),h.push(e.billTariffDetails[i].season),h.push(e.billTariffDetails[i].weekType),h.push(e.billTariffDetails[i].peakType),h.push(m.decimalPipe.transform(e.billTariffDetails[i].consumption,m.consumptionRoundOffFormat)),h.push(e.billTariffDetails[i].rate),h.push(m.currencyPipe.transform(e.billTariffDetails[i].amount,m.currency.toString(),!0,m.roundFormat)));T.push(h),h=[]}}));var L=[];e.bills.forEach((function(e){var t;if(m.consumptionRoundOffFormat=null!==(t=Object(y.e)("ConsumptionRoundOff",e.utilityTypeId))&&void 0!==t?t:m.envService.consumptionRoundOffFormat,e.billTransactions&&e.billTransactions.length){var i=["consumption","consumptioncharge"];e.billTransactions.forEach((function(e){if(!i.includes(e.headDisplay.toLowerCase())){var t=L.find((function(t){return t.label===e.headDisplay}));t?t.value+=e.headAmount:L.push({label:e.headDisplay,value:e.headAmount})}}))}})),e.billCharges&&e.billCharges.length&&e.billCharges.sort((function(e,t){return e.position-t.position})).forEach((function(e){if("VAT"!==e.headDisplay){var t=L.find((function(t){return t.label===e.headDisplay}));t?t.value+=e.headAmount:L.push({label:e.headDisplay,value:e.headAmount})}})),L.forEach((function(e){f.push({label:e.label,value:m.currencyPipe.transform(e.value,m.currency.toString(),!0,m.roundFormat)}),Number(e.value)})),e.billTaxDetails&&e.billTaxDetails.length&&e.billTaxDetails.forEach((function(e){f.push({label:e.taxDisplayName,value:m.currencyPipe.transform(e.taxAmount,m.currency.toString(),!0,m.roundFormat)}),Number(e.taxAmount)})),S.push({label:"Total for Current Period",value:this.currencyPipe.transform(e.billAmount+e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)}),this.getNewBillFormat3LargeReport(P,b,f,["Customer AccountNumber","Billing Period","Previous Due","Total for current period"],p,g,v,[],"Invoice",D,C,e,S,W,T,M)}},{key:"getNewBillFormat3LargeReport",value:function(e,t,i,n,l,a,o,r,s,c,u,d,m,h,b){var f,p,g,v,y=arguments.length>15&&void 0!==arguments[15]&&arguments[15],C=new Fe.default({orientation:"portrait",unit:"pt",format:"letter"});C.rect(5,5,C.internal.pageSize.width-10,C.internal.pageSize.height-10,"S"),C.setTextColor(0,0,0),C.setFontSize(11),C.setFont("Cambria"),C.text("Billing Statement".toUpperCase(),10,20),this.addImage(C,d),C.setLineWidth(.1),C.autoTable("",a,{startX:10,startY:35,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:15},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:190,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"},didParseCell:function(e){e.cell.styles.cellPadding=1.5}});var S=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"));C.autoTable("",o,{startX:10,startY:S,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:15},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:380,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0]},didParseCell:function(e){e.cell.styles.cellPadding=1.5}});var T=function(e){},P=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"));C.setFont("Cambria"),C.setFontSize(10),C.text("Meter Read-Outs".toUpperCase(),10,P+15),C.autoTable(e,t,{startX:10,startY:P+30,didDrawPage:T,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:6==e.length?120:4==e.length?200:155,halign:"center"},1:{cellWidth:6==e.length?100:4==e.length?135:125,halign:"center"},2:{cellWidth:6==e.length?100:4==e.length?135:125,halign:"center"},3:{cellWidth:4==e.length?120:100,halign:"center"},4:{cellWidth:85,halign:"center"},5:{cellWidth:85,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}});var D=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"));u&&u.length&&(C.setFontSize(10),C.text("Charges Breakdown".toUpperCase(),10,D+15),C.autoTable(c,u,{startX:10,startY:D+30,showHead:"everyPage",didDrawPage:T,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:6===c.length?80:200,halign:"center"},1:{cellWidth:6===c.length?180:100,halign:"center"},2:{cellWidth:6===c.length?90:100,halign:"center"},3:{cellWidth:6===c.length?90:100,halign:"center"},4:{cellWidth:6===c.length?75:90,halign:"right"},5:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}));var w=C.internal.pageSize.height,N=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0")),x=N;y?(C.autoTable(h,b,{startX:10,startY:N+10,showHead:"everyPage",didDrawPage:T,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:250,halign:"center"},1:{cellWidth:120,halign:"center"},2:{cellWidth:120,halign:"center"},3:{cellWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}),x=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"))):(C.autoTable(h,b,{startX:10,startY:N+10,showHead:"everyPage",didDrawPage:T,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:140,halign:"center"},1:{cellWidth:100,halign:"center"},2:{cellWidth:100,halign:"center"},3:{cellWidth:100,halign:"center"},4:{cellWidth:75,halign:"center"},5:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}),x=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"))),w-x<200&&(C.addPage(),C.setTextColor(25,118,210),C.rect(5,5,C.internal.pageSize.width-10,C.internal.pageSize.height-10,"S"),x=10),C.autoTable("",i,{startX:10,startY:x+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{bottom:35,left:250},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:250,fontStyle:"italic"},1:{cellWidth:90}},didParseCell:function(e){1==e.column.index&&(e.cell.styles.halign="right"),e.cell.styles.cellPadding=1.5},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});var k=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"));C.line(5,k+10,607,k+10),C.autoTable("",m,{startX:10,startY:k+20,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{bottom:35,left:250},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:250,fontStyle:"italic"},1:{cellWidth:90}},didParseCell:function(e){1==e.column.index&&(e.cell.styles.halign="right"),e.cell.styles.cellPadding=1.5},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});var A=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"));C.line(5,A+10,607,A+10),A>(w=C.internal.pageSize.height)-190&&(C.addPage(),C.rect(5,5,C.internal.pageSize.width-10,C.internal.pageSize.height-10,"S"),w=400),(null===(p=null===(f=null==d?void 0:d.client)||void 0===f?void 0:f.termsConditions[0])||void 0===p?void 0:p.termsAndCondition)&&(C.setFillColor(241,241,244),C.rect(10,w-190,590,90,"FD"),C.setFillColor(0,0,0),C.setFontSize(9),C.text(null===(v=null===(g=null==d?void 0:d.client)||void 0===g?void 0:g.termsConditions[0])||void 0===v?void 0:v.termsAndCondition.replace("{{ClientName}}",d.client.clientName).replace("{{TRNNumber}}",d.client.trnNo).replace("{{Currency}}",this.currency),30,w-175)),C.setTextColor(0,0,0),C.line(5,w-95,607,w-95),C.text("Notice :- Please tear and attach the slip  along with your payment",10,w-80),C.autoTable(n,l,{startX:10,startY:w-65,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:130,halign:"center"},1:{cellWidth:210,halign:"center"},2:{cellWidth:110,halign:"right"},3:{cellWidth:140,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}});var F=C.output("datauristring");this.pdfsToMerge.push(F)}},{key:"downloadBillFormat2Report",value:function(e){var t,i,n,l,a,o,r,s,c,u,d,m,h,b,f,p,g,v,C,S,T=this,P=[],D=[],w=[],N=[],x=[],k=[],A=[],F=[],R=[],I=[],O=["Unit No","Meter No","Previous Reading","Present Reading","Consumption"],W=["Bill No","Charges","Consumption","Measuring Unit","Tariff","Total"],M=!1,L=!1;if(e&&e.bills&&e.bills.length){var B=Array.from(new Set(e.bills.map((function(e){return e.billNumber})))),z=Array.from(new Set(e.bills.map((function(e){return e.unitNumber}))));M=!!(B&&B.length>1),L=!!(z&&z.length>1),M||W.splice(0,1),L||O.splice(0,1)}for(var U=0;U<e.bills.length;U++)this.consumptionRoundOffFormat=null!==(t=Object(y.e)("ConsumptionRoundOff",e.bills[U].utilityTypeId))&&void 0!==t?t:this.envService.consumptionRoundOffFormat,L&&P.push(e.unitNumber),P.push(e.bills[U].deviceName),P.push(this.decimalPipe.transform(e.bills[U].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[U].measuringUnit),P.push(this.decimalPipe.transform(e.bills[U].presentReading,this.consumptionRoundOffFormat)+" "+e.bills[U].measuringUnit),P.push(e.bills[U].isDifferentiateBill?this.decimalPipe.transform(e.bills[U].presentReading-e.bills[U].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[U].measuringUnit:this.decimalPipe.transform(e.bills[U].consumption,this.consumptionRoundOffFormat)+" "+e.bills[U].measuringUnit),"BTU"===e.bills[U].utilityType&&e.bills[U].billTransactions&&e.bills[U].billTransactions.length&&e.bills[U].billTransactions.findIndex((function(e){return e.measuringUnitId&&2===e.measuringUnitId}))>-1&&(0==U&&O.push("Consumption TR-HR"),P.push(this.decimalPipe.transform(.284345*e.bills[U].consumption,this.consumptionRoundOffFormat))),D.push(P),P=[];for(var E=0,j=0;j<e.bills.length;j++){this.consumptionRoundOffFormat=null!==(i=Object(y.e)("ConsumptionRoundOff",e.bills[j].utilityTypeId))&&void 0!==i?i:this.envService.consumptionRoundOffFormat;for(var H=e.bills[j],Y=0;Y<H.billTransactions.length;Y++)M&&P.push(H.billNumber),P.push(H.billTransactions[Y].headDisplay),"BTU"===H.utilityType&&H.billTransactions&&H.billTransactions.length&&H.billTransactions[Y]&&H.billTransactions[Y].measuringUnitId&&2===H.billTransactions[Y].measuringUnitId?(P.push(this.decimalPipe.transform(.284345*H.consumption,this.consumptionRoundOffFormat)),P.push("TR-HR"),P.push(H.billTransactions[Y].rate)):(P.push(this.decimalPipe.transform(H.consumption,this.consumptionRoundOffFormat)),P.push(H.measuringUnit),P.push(H.billTransactions[Y].rate)),P.push(this.currencyPipe.transform(H.billTransactions[Y].headAmount,this.currency.toString(),!0,this.roundFormat)),F.push(P),P=[],E+=H.billTransactions[Y].headAmount}P.push(e.accountNumber),P.push(e.fromDateLocal+"-"+e.toDateLocal),P.push(this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)),P.push(e.billAmountLocal),N.push(P),e.billCharges&&e.billCharges.length&&(e.billCharges.sort((function(e,t){return e.position-t.position})).forEach((function(e){if("VAT"!==e.headDisplay){var t=w.find((function(t){return t.label===e.headDisplay}));t?t.value+=e.headAmount:w.push({label:e.headDisplay,value:e.headAmount})}})),w.forEach((function(e){R.push({label:e.label,value:T.currencyPipe.transform(e.value,T.currency.toString(),!0,T.roundFormat)})}))),e.billCharges.find((function(e){return"VAT"===e.headDisplay})),R.push({label:"Total consumption charge for Current Period",value:this.currencyPipe.transform(E,this.currency.toString(),!0,this.roundFormat)}),e.billTaxDetails.forEach((function(e){var t=R.find((function(t){return t.label===e.taxDisplayName}));if(t){var i=Number(t.value.replace(T.currency,"").trim())+Number(e.taxAmount);t.value=T.currencyPipe.transform(i,T.currency.toString(),!0,T.roundFormat)}else R.push({label:e.taxDisplayName,value:T.currencyPipe.transform(e.taxAmount,T.currency.toString(),!0,T.roundFormat)})})),R.push({label:"Previous Outstanding Amount",value:this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)},{label:"Total Amount Due",value:this.currencyPipe.transform(e.billAmount+e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)}),x.push({label:"Bill No",value:null!==(n=null==e?void 0:e.billNumber)&&void 0!==n?n:""},{label:"Date of issue",value:null!==(l=null==e?void 0:e.billDateLocal)&&void 0!==l?l:""},{label:"Due Date",value:null!==(a=null==e?void 0:e.dueDateLocal)&&void 0!==a?a:""}),k.push({label:"Customer Name",value:null!==(o=null==e?void 0:e.ownerName)&&void 0!==o?o:""},{label:"Customer AccountNumber",value:null!==(r=null==e?void 0:e.accountNumber)&&void 0!==r?r:""},{label:"Unit No",value:null!==(s=null==e?void 0:e.unitNumber)&&void 0!==s?s:""},{label:"Address",value:null!==(u=null===(c=null==e?void 0:e.receiverDetails[0])||void 0===c?void 0:c.address1)&&void 0!==u?u:""},{label:"City",value:null!==(m=null===(d=null==e?void 0:e.receiverDetails[0])||void 0===d?void 0:d.city)&&void 0!==m?m:""},{label:"P.O Box",value:null!==(b=null===(h=null==e?void 0:e.receiverDetails[0])||void 0===h?void 0:h.zipPostalCode)&&void 0!==b?b:""},{label:"Phone number",value:null!==(p=null===(f=null==e?void 0:e.receiverDetails[0])||void 0===f?void 0:f.phoneNumber)&&void 0!==p?p:""},{label:"Fax Number",value:""},{label:"Client",value:null!==(v=null===(g=null==e?void 0:e.client)||void 0===g?void 0:g.clientName)&&void 0!==v?v:""},{label:"Client TRN",value:null!==(S=null===(C=null==e?void 0:e.client)||void 0===C?void 0:C.trnNo)&&void 0!==S?S:""}),A.push({firstItem:"Billing period",secondItem:"From:",thirdItem:e.fromDateLocal,fourthItem:"To:",fifthItem:e.toDateLocal});var V=[],_=!1;P=[],e&&e.bills&&e.bills.length&&e.bills.forEach((function(e){var t;if(T.consumptionRoundOffFormat=null!==(t=Object(y.e)("ConsumptionRoundOff",e.utilityTypeId))&&void 0!==t?t:T.envService.consumptionRoundOffFormat,e.billTariffDetails&&e.billTariffDetails.length)for(var i=0;i<e.billTariffDetails.length;i++){if(e.billTariffDetails[i].slabSettingsId&&e.billTariffDetails[i].slabSettingsId>0){var n=e.billTariffDetails[i].season;Number(e.billTariffDetails[i].peakType)<Number(e.billTariffDetails[i].consumption)&&(n=e.billTariffDetails[i].peakType+" - "+e.billTariffDetails[i].consumption),0==i&&(_=!0,V=["Slab","Consumption","Rate","Amount"]),P.push(n),P.push(T.decimalPipe.transform(e.billTariffDetails[i].consumption,T.consumptionRoundOffFormat)),P.push(e.billTariffDetails[i].rate),P.push(T.currencyPipe.transform(e.billTariffDetails[i].amount,T.currency.toString(),!0,T.roundFormat))}else 0==e.billTariffDetails[i].slabSettingsId&&(0==i&&(V=["Season","Week Type","Peak Type","Consumption","Rate","Amount"]),P.push(e.billTariffDetails[i].season),P.push(e.billTariffDetails[i].weekType),P.push(e.billTariffDetails[i].peakType),P.push(T.decimalPipe.transform(e.billTariffDetails[i].consumption,T.consumptionRoundOffFormat)),P.push(e.billTariffDetails[i].rate),P.push(T.currencyPipe.transform(e.billTariffDetails[i].amount,T.currency.toString(),!0,T.roundFormat)));I.push(P),P=[]}})),this.getBillFormat2Report(O,D,w,["Customer AccountNumber","Billing Period","Previous Due","Total for current period"],N,x,k,A,"Cancelled Bill Report",W,F,e,R,V,I,_)}},{key:"getBillFormat2Report",value:function(e,t,i,n,l,a,o,r,s,c,u,d,m,h,b){var f,p,g,v,y,C,S=arguments.length>15&&void 0!==arguments[15]&&arguments[15],T=new Fe.default({orientation:"portrait",unit:"pt",format:"letter"}),P=null!==(p=null===(f=null==d?void 0:d.client)||void 0===f?void 0:f.clientName)&&void 0!==p?p:"",D=T.getTextWidth(P.trim());T.setTextColor(0,0,0),T.setFontSize(17),T.setFont("Cambria"),T.text(P,Number(T.internal.pageSize.width/2)-Number(0!=D?D/2:0),18),this.addImage(T,d),T.setLineWidth(.1),T.line(Number(T.internal.pageSize.width/2)-Number(0!=D?D/2:0),21,Number(T.internal.pageSize.width/2)-Number(0!=D?D/2:0)+D,21),T.setFontSize(13),T.setLineWidth(.1),T.setFontSize(14),T.text("Billing Statement",30,41),T.autoTable("",a,{startX:10,startY:50,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:150,halign:"left"},1:{cellWidth:190,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"},didParseCell:function(e){e.cell.styles.cellPadding=1}});var w=Number(this.decimalPipe.transform(T.autoTable.previous.finalY,"1.0-0"));T.autoTable("",r,{startX:10,startY:w,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:150,halign:"left"},1:{cellWidth:95,halign:"center"},2:{cellWidth:95,halign:"center"},3:{cellWidth:97,halign:"center"},4:{cellWidth:97,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0]},didParseCell:function(e){e.cell.styles.cellPadding=1}});var N=Number(this.decimalPipe.transform(T.autoTable.previous.finalY,"1.0-0"));T.autoTable("",o,{startX:10,startY:N,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:150,halign:"left"},1:{cellWidth:384,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0]},didParseCell:function(e){e.cell.styles.cellPadding=1}});var x=Number(this.decimalPipe.transform(T.autoTable.previous.finalY,"1.0-0"));T.setFont("Cambria"),T.setFontSize(10),T.text("Meter Read-Outs".toUpperCase(),30,x+15),T.autoTable(e,t,{startX:10,startY:x+30,didDrawPage:function(e){var t="Page "+e.pageCount;T.setFontSize(10);var i=T.internal.pageSize.height||T.internal.pageSize.getHeight();T.text(t,e.settings.margin.left,i-10)},styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:6==e.length?100:4==e.length?182:150,halign:"center"},1:{cellWidth:6==e.length?95:4==e.length?142:120,halign:"center"},2:{cellWidth:4==e.length?105:95,halign:"center"},3:{cellWidth:4==e.length?105:95,halign:"center"},4:{cellWidth:74,halign:"center"},5:{cellWidth:75,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}});var k=Number(this.decimalPipe.transform(T.autoTable.previous.finalY,"1.0-0"));u&&u.length&&(T.setFontSize(10),T.text("Charges Breakdown".toUpperCase(),30,k+15),T.autoTable(c,u,{startX:10,startY:k+30,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:6==c.length?80:215,halign:"center"},1:{cellWidth:6==c.length?145:85,halign:"center"},2:{cellWidth:85,halign:"center"},3:{cellWidth:75,halign:"center"},4:{cellWidth:74,halign:"right"},5:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}));var A=Number(this.decimalPipe.transform(T.autoTable.previous.finalY,"1.0-0")),F=A;S?(T.autoTable(h,b,{startX:10,startY:A+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:200,halign:"center"},1:{cellWidth:117,halign:"center"},2:{cellWidth:117,halign:"center"},3:{cellWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}),F=Number(this.decimalPipe.transform(T.autoTable.previous.finalY,"1.0-0"))):(T.autoTable(h,b,{startX:10,startY:A+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:130,halign:"center"},1:{cellWidth:85,halign:"center"},2:{cellWidth:85,halign:"center"},3:{cellWidth:85,halign:"center"},4:{cellWidth:74,halign:"center"},5:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}),F=Number(this.decimalPipe.transform(T.autoTable.previous.finalY,"1.0-0"))),T.autoTable("",m,{startX:10,startY:F+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{bottom:35,left:230},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:235,fontStyle:"italic"},1:{cellWidth:100}},didParseCell:function(e){1==e.column.index&&(e.cell.styles.halign="right"),e.cell.styles.cellPadding=1},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});var R=Number(this.decimalPipe.transform(T.autoTable.previous.finalY,"1.0-0"));(null===(v=null===(g=null==d?void 0:d.client)||void 0===g?void 0:g.termsConditions[0])||void 0===v?void 0:v.termsAndCondition)&&(T.setFillColor(241,241,244),T.rect(30,R+20,535,80,"FD"),T.setFillColor(0,0,0),T.setFontSize(9),T.text(null===(C=null===(y=null==d?void 0:d.client)||void 0===y?void 0:y.termsConditions[0])||void 0===C?void 0:C.termsAndCondition.replace("{{ClientName}}",d.client.clientName).replace("{{TRNNumber}}",d.client.trnNo).replace("{{Currency}}",this.currency),60,R+30)),T.setTextColor(0,0,0),T.line(5,R+110,607,R+110);var I=T.internal.pageSize.height;T.text("Notice :- Please tear and attach the slip  along with your payment",30,I-90),T.autoTable(n,l,{startX:10,startY:I-80,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:120,halign:"center"},1:{cellWidth:200,halign:"center"},2:{cellWidth:100,halign:"right"},3:{cellWidth:120,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}),"function"==typeof T.putTotalPages&&T.putTotalPages("1");var O=T.output("datauristring");this.pdfsToMerge.push(O)}},{key:"downloadBillFormat1Report",value:function(e){var t,i,n=this,l=[],a=[],o=[],r=[],s=[],c=[],u=[],d=[],m=["Unit No","Meter No","Previous Reading","Present Reading","Consumption"],h=["Bill No","Charges","Consumption","Measuring Unit","Tariff","Total"],b="";e.bills.forEach((function(e){b+=e.deviceName+","})),s.push({label:"Account Number:",value:e.accountNumber},{label:"Meter Number:",value:b.slice(0,-1)},{label:"Unit Number:",value:e.unitNumber},{label:"Billing Date:",value:e.billDateLocal},{label:"Due Date:",value:e.dueDateLocal},{label:"Bill Period",value:"".concat(Object(y.f)(e.fromDateLocal)," - ").concat(Object(y.f)(e.toDateLocal)," ")});var f=!1,p=!1;if(e&&e.bills&&e.bills.length){var g=Array.from(new Set(e.bills.map((function(e){return e.billNumber})))),v=Array.from(new Set(e.bills.map((function(e){return e.unitNumber}))));if(f=!!(g&&g.length>1),p=!!(v&&v.length>1),f||m.splice(0,1),p){var C=s.findIndex((function(e){return"Unit Number:"===e.label}));s.splice(C,1)}else h.splice(0,1)}for(var S=0;S<e.bills.length;S++)this.consumptionRoundOffFormat=null!==(t=Object(y.e)("ConsumptionRoundOff",e.bills[S].utilityTypeId))&&void 0!==t?t:this.envService.consumptionRoundOffFormat,p&&l.push(e.unitNumber),l.push(e.bills[S].deviceName),l.push(this.decimalPipe.transform(e.bills[S].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[S].measuringUnit),l.push(this.decimalPipe.transform(e.bills[S].presentReading,this.consumptionRoundOffFormat)+" "+e.bills[S].measuringUnit),l.push(e.bills[S].isDifferentiateBill?this.decimalPipe.transform(e.bills[S].presentReading-e.bills[S].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[S].measuringUnit:this.decimalPipe.transform(e.bills[S].consumption,this.consumptionRoundOffFormat)+" "+e.bills[S].measuringUnit),"BTU"===e.bills[S].utilityType&&e.bills[S].billTransactions&&e.bills[S].billTransactions.length&&e.bills[S].billTransactions.findIndex((function(e){return e.measuringUnitId&&2===e.measuringUnitId}))>-1&&(0==S&&m.push("Consumption TR-HR"),l.push(this.decimalPipe.transform(.284345*e.bills[S].consumption,this.consumptionRoundOffFormat))),a.push(l),l=[];for(var T=0,P=0;P<e.bills.length;P++){this.consumptionRoundOffFormat=null!==(i=Object(y.e)("ConsumptionRoundOff",e.bills[P].utilityTypeId))&&void 0!==i?i:this.envService.consumptionRoundOffFormat;for(var D=e.bills[P],w=0;w<D.billTransactions.length;w++)f&&l.push(D.billNumber),l.push(D.billTransactions[w].headDisplay),"BTU"===D.utilityType&&D.billTransactions&&D.billTransactions.length&&D.billTransactions[w]&&D.billTransactions[w].measuringUnitId&&2===D.billTransactions[w].measuringUnitId?(l.push(this.decimalPipe.transform(.284345*D.consumption,this.consumptionRoundOffFormat)),l.push("TR-HR"),l.push(D.billTransactions[w].rate)):(l.push(this.decimalPipe.transform(D.consumption,this.consumptionRoundOffFormat)),l.push(D.measuringUnit),l.push(D.billTransactions[w].rate)),l.push(this.currencyPipe.transform(D.billTransactions[w].headAmount,this.currency.toString(),!0,this.roundFormat)),u.push(l),l=[],T+=D.billTransactions[w].headAmount}l.push(e.accountNumber),l.push(e.fromDateLocal+"-"+e.toDateLocal),l.push(this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)),l.push(e.billAmountLocal),r.push(l),e.billCharges&&e.billCharges.length&&(e.billCharges.sort((function(e,t){return e.position-t.position})).forEach((function(e){if("VAT"!==e.headDisplay){var t=o.find((function(t){return t.label===e.headDisplay}));t?t.value+=e.headAmount:o.push({label:e.headDisplay,value:e.headAmount})}})),o.forEach((function(e){c.push({label:e.label,value:n.currencyPipe.transform(e.value,n.currency.toString(),!0,n.roundFormat)})}))),c.push({label:"Current Month Total Consumption Charge:",value:this.currencyPipe.transform(T,this.currency.toString(),!0,this.roundFormat)}),e.billTaxDetails&&e.billTaxDetails.length?e.billTaxDetails.forEach((function(e){c.push({label:e.taxDisplayName,value:n.currencyPipe.transform(e.taxAmount,n.currency.toString(),!0,n.roundFormat)})})):c.push({label:"TAX:",value:this.currencyPipe.transform(0,this.currency.toString(),!0,this.roundFormat)}),c.push({label:"Current Month + TAX:",value:e.billAmountLocal},{label:"Previous Bill Outstanding Balance:",value:this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)},{label:"Total Due incl TAX:",value:this.currencyPipe.transform(e.billAmount+e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)});var N=[],x=!1;l=[],e&&e.bills&&e.bills.length&&e.bills.forEach((function(e){var t;if(n.consumptionRoundOffFormat=null!==(t=Object(y.e)("ConsumptionRoundOff",e.utilityTypeId))&&void 0!==t?t:n.envService.consumptionRoundOffFormat,e.billTariffDetails&&e.billTariffDetails.length)for(var i=0;i<e.billTariffDetails.length;i++){if(e.billTariffDetails[i].slabSettingsId&&e.billTariffDetails[i].slabSettingsId>0){var a=e.billTariffDetails[i].season;Number(e.billTariffDetails[i].peakType)<Number(e.billTariffDetails[i].consumption)&&(a=e.billTariffDetails[i].peakType+" - "+e.billTariffDetails[i].consumption),0==i&&(x=!0,N=["Slab","Consumption","Rate","Amount"]),l.push(a),l.push(n.decimalPipe.transform(e.billTariffDetails[i].consumption,n.consumptionRoundOffFormat)),l.push(e.billTariffDetails[i].rate),l.push(n.currencyPipe.transform(e.billTariffDetails[i].amount,n.currency.toString(),!0,n.roundFormat))}else 0==e.billTariffDetails[i].slabSettingsId&&(0==i&&(N=["Season","Week Type","Peak Type","Consumption","Rate","Amount"]),l.push(e.billTariffDetails[i].season),l.push(e.billTariffDetails[i].weekType),l.push(e.billTariffDetails[i].peakType),l.push(n.decimalPipe.transform(e.billTariffDetails[i].consumption,n.consumptionRoundOffFormat)),l.push(e.billTariffDetails[i].rate),l.push(n.currencyPipe.transform(e.billTariffDetails[i].amount,n.currency.toString(),!0,n.roundFormat)));d.push(l),l=[]}})),this.getNewBillFormat1Report(m,a,o,["Customer AccountNumber","Billing Period","Previous Due","Total for current period"],r,[],s,c,"Invoice",h,u,e,[],N,d,x)}},{key:"getNewBillFormat1Report",value:function(e,t,i,n,l,a,o,r,s,c,u,d,m,h,b){var f,p,g,v,C,S,T,P,D,w,N,x,k,A,F,R,I,O,W,M,L,B,z=arguments.length>15&&void 0!==arguments[15]&&arguments[15],U=new Fe.default({orientation:"portrait",unit:"pt",format:"letter"});U.rect(5,5,U.internal.pageSize.width-10,U.internal.pageSize.height-10,"S"),U.setFontSize(30),(U=this.addImage(U,d)).setTextColor(0,0,0),U.setFontSize(16),U.setFont("Cambria","bold"),U.text("Tax Invoice",260,30),U.setFontSize(13),U.setFont("Cambria","normal"),U.text(d.client.clientName.toUpperCase(),10,60),U.setFontSize(10),U.setFont("Cambria"),U.text("TRN: "+d.client.trnNo,10,70),U.text("PO Box "+d.client.addresses[0].zipPostalCode,10,80),U.text(d.client.addresses[0].address1+","+d.client.addresses[0].country,10,90),U.text("Phone: "+d.client.phoneNo,10,100),U.text("Email: "+d.client.email+", Web: "+d.client.website,10,110),U.setFontSize(10),U.setFont("bold"),U.text("Invoice#: ".toUpperCase(),370,110),U.setTextColor(25,118,210);var E=U.getTextWidth("Invoice#: "),j="";(null==d?void 0:d.billNumber)&&(j=null===(f=d.billNumber)||void 0===f?void 0:f.toUpperCase()),U.text(j,380+E,110),U.setFont("none"),U.setTextColor(0,0,0),U.setFontSize(9),U.autoTable("",o,{startY:120,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:370},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:80,halign:"left"},1:{cellWidth:150,halign:"right"}},didParseCell:function(e){e.cell.styles.cellPadding=6===e.length?1.8:2.7},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});var H=Number(this.decimalPipe.transform(U.autoTable.previous.finalY,"1.0-0"));if(U.setLineWidth(.1),U.line(5,H+5,607,H+5),U.setFont("Cambria"),U.setFillColor(241,241,244),U.setDrawColor(206,203,203),U.rect(10,120,340,H-120,"FD"),U.setTextColor(0,0,0),U.setFontSize(12),U.text(null==d?void 0:d.ownerName.toUpperCase(),20,135),U.text("CUSTOMER TRN: "+d.trn,20,150),U.text("unit #"+d.unitNumber,20,165),U.setFontSize(10),U.text(d.clientName,20,180),U.text(Object(y.f)(null===(p=null==d?void 0:d.client)||void 0===p?void 0:p.buildingName,",")+Object(y.f)(null===(v=null===(g=null==d?void 0:d.client)||void 0===g?void 0:g.addresses[0])||void 0===v?void 0:v.location,",")+Object(y.f)(null===(S=null===(C=null==d?void 0:d.client)||void 0===C?void 0:C.addresses[0])||void 0===S?void 0:S.city,",")+Object(y.f)(null===(P=null===(T=null==d?void 0:d.client)||void 0===T?void 0:T.addresses[0])||void 0===P?void 0:P.country,","),20,195),U.setFontSize(10),U.text("Meter Read-Outs".toUpperCase(),10,H+20),U.autoTable(e,t,{startX:10,startY:H+35,didDrawPage:function(e){var t="Page "+e.pageCount;U.setFontSize(10);var i=U.internal.pageSize.height||U.internal.pageSize.getHeight();U.text(t,e.settings.margin.left,i-10)},styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:6==e.length?120:4==e.length?200:155,halign:"center"},1:{cellWidth:6==e.length?100:4==e.length?135:125,halign:"center"},2:{cellWidth:6==e.length?100:4==e.length?135:125,halign:"center"},3:{cellWidth:4==e.length?120:100,halign:"center"},4:{cellWidth:85,halign:"center"},5:{cellWidth:85,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}),u&&u.length){var Y=Number(this.decimalPipe.transform(U.autoTable.previous.finalY,"1.0-0"));U.setFontSize(10),U.text("Charges Breakdown".toUpperCase(),10,Y+15),U.autoTable(c,u,{startX:10,startY:Y+30,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:6==c.length?80:200,halign:"center"},1:{cellWidth:6==c.length?180:100,halign:"center"},2:{cellWidth:6==c.length?90:100,halign:"center"},3:{cellWidth:6==c.length?90:100,halign:"center"},4:{cellWidth:6==c.length?75:90,halign:"right"},5:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}})}var V=Number(this.decimalPipe.transform(U.autoTable.previous.finalY,"1.0-0")),_=V;z?(U.autoTable(h,b,{startX:10,startY:V+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:250,halign:"center"},1:{cellWidth:120,halign:"center"},2:{cellWidth:120,halign:"center"},3:{cellWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}),_=Number(this.decimalPipe.transform(U.autoTable.previous.finalY,"1.0-0"))):(U.autoTable(h,b,{startX:10,startY:V+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:140,halign:"center"},1:{cellWidth:100,halign:"center"},2:{cellWidth:100,halign:"center"},3:{cellWidth:100,halign:"center"},4:{cellWidth:75,halign:"center"},5:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}),_=Number(this.decimalPipe.transform(U.autoTable.previous.finalY,"1.0-0"))),U.setTextColor(25,118,210),U.setFontSize(12),U.text("Bank Payment Account Details",10,_+20),U.setTextColor(0,0,0),U.setFontSize(9),U.text("Account Title: "+Object(y.f)(null===(w=null===(D=null==d?void 0:d.client)||void 0===D?void 0:D.bankDetails[0])||void 0===w?void 0:w.accountName),10,_+40),U.text("Account #: "+Object(y.f)(null===(x=null===(N=null==d?void 0:d.client)||void 0===N?void 0:N.bankDetails[0])||void 0===x?void 0:x.accountNo),10,_+50),U.text("IBAN #: "+Object(y.f)(null===(A=null===(k=null==d?void 0:d.client)||void 0===k?void 0:k.bankDetails[0])||void 0===A?void 0:A.ibanNumber),10,_+60),U.text("Bank Name: "+Object(y.f)(null===(R=null===(F=null==d?void 0:d.client)||void 0===F?void 0:F.bankDetails[0])||void 0===R?void 0:R.bankName),10,_+70),U.text("Swift Code: "+ +Object(y.f)(null===(O=null===(I=null==d?void 0:d.client)||void 0===I?void 0:I.bankDetails[0])||void 0===O?void 0:O.swiftCode),10,_+80),U.setFontSize(9),U.autoTable("",r,{startX:300,startY:_+20,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:320},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:180,halign:"left"},1:{cellWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"},didParseCell:function(e){e.cell.styles.cellPadding=1.8}});var G=Number(this.decimalPipe.transform(U.autoTable.previous.finalY,"1.0-0")),X=U.internal.pageSize.height;if(G>X-190){U.addPage(),U.rect(5,5,U.internal.pageSize.width-10,U.internal.pageSize.height-10,"S");var q="Page "+U.getNumberOfPages();U.setFontSize(10),U.text(q,10,X-10),X=230}(null===(M=null===(W=null==d?void 0:d.client)||void 0===W?void 0:W.termsConditions[0])||void 0===M?void 0:M.termsAndCondition)&&(U.setFillColor(241,241,244),U.rect(10,X-190,590,90,"FD"),U.setFillColor(0,0,0),U.setFontSize(9),U.text(null===(B=null===(L=null==d?void 0:d.client)||void 0===L?void 0:L.termsConditions[0])||void 0===B?void 0:B.termsAndCondition.replace("{{ClientName}}",d.client.clientName).replace("{{TRNNumber}}",d.client.trnNo).replace("{{Currency}}",this.currency),40,X-175)),U.setTextColor(0,0,0),U.line(5,X-95,607,X-95),U.text("Notice :- Please tear and attach the slip  along with your payment",10,X-80),U.autoTable(n,l,{startX:10,startY:X-65,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:130,halign:"center"},1:{cellWidth:210,halign:"center"},2:{cellWidth:110,halign:"right"},3:{cellWidth:140,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}});var $=U.output("datauristring");this.pdfsToMerge.push($)}},{key:"downloadBillFormat3Report",value:function(e){var t,i,n,l,a,o,r,s,c,u,d,m=this,h=[],b=[],f=[],p=[],g=[],v=[],C=[],S=[],T=[],P=["Unit No","Meter No","Previous Reading","Present Reading","Consumption"],D=["Bill No","Charges","Consumption","Measuring Unit","Tariff","Total"];g.push({label:"Bill No",value:": "+Object(y.f)(e.billNumber)},{label:"Date of issue",value:": "+Object(y.f)(e.billDateLocal)},{label:"Due Date",value:": "+Object(y.f)(e.dueDateLocal)}),v.push({label:"Billing period",value:": From: ".concat(Object(y.f)(e.fromDateLocal)," To: ").concat(Object(y.f)(e.toDateLocal)," ")},{label:"Customer Account",value:": "+Object(y.f)(e.accountNumber)},{label:"Customer Name",value:": "+Object(y.f)(e.ownerName)},{label:"Unit No",value:": "+Object(y.f)(e.unitNumber)},{label:"Address",value:": "+Object(y.f)(null===(i=null===(t=null==e?void 0:e.client)||void 0===t?void 0:t.addresses[0])||void 0===i?void 0:i.address1)},{label:"City",value:": "+Object(y.f)(null===(l=null===(n=null==e?void 0:e.client)||void 0===n?void 0:n.addresses[0])||void 0===l?void 0:l.city)},{label:"P.O Box",value:": "+Object(y.f)(null===(o=null===(a=null==e?void 0:e.client)||void 0===a?void 0:a.addresses[0])||void 0===o?void 0:o.zipPostalCode)},{label:"Phone number",value:": "+Object(y.f)(null===(r=null==e?void 0:e.receiverDetails[0])||void 0===r?void 0:r.phoneNumber)},{label:"Fax Number",value:": "},{label:"Client",value:": "+Object(y.f)(null===(s=null==e?void 0:e.client)||void 0===s?void 0:s.clientName)},{label:"Client TRN",value:": "+Object(y.f)(null===(c=null==e?void 0:e.client)||void 0===c?void 0:c.trnNo)});var w=!1,N=!1;if(e&&e.bills&&e.bills.length){var x=Array.from(new Set(e.bills.map((function(e){return e.billNumber})))),k=Array.from(new Set(e.bills.map((function(e){return e.unitNumber}))));if(w=!!(x&&x.length>1),N=!!(k&&k.length>1),w?g.splice(0,1):D.splice(0,1),N){var A=v.findIndex((function(e){return"Unit No"===e.label}));v.splice(A,1)}else P.splice(0,1)}for(var F=0;F<e.bills.length;F++)this.consumptionRoundOffFormat=null!==(u=Object(y.e)("ConsumptionRoundOff",e.bills[F].utilityTypeId))&&void 0!==u?u:this.envService.consumptionRoundOffFormat,N&&h.push(e.unitNumber),h.push(e.bills[F].deviceName),h.push(this.decimalPipe.transform(e.bills[F].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[F].measuringUnit),h.push(this.decimalPipe.transform(e.bills[F].presentReading,this.consumptionRoundOffFormat)+" "+e.bills[F].measuringUnit),h.push(e.bills[F].isDifferentiateBill?this.decimalPipe.transform(e.bills[F].presentReading-e.bills[F].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[F].measuringUnit:this.decimalPipe.transform(e.bills[F].consumption,this.consumptionRoundOffFormat)+" "+e.bills[F].measuringUnit),"BTU"===e.bills[F].utilityType&&e.bills[F].billTransactions&&e.bills[F].billTransactions.length&&e.bills[F].billTransactions.findIndex((function(e){return e.measuringUnitId&&2===e.measuringUnitId}))>-1&&(0==F&&P.push("Consumption TR-HR"),h.push(this.decimalPipe.transform(.284345*e.bills[F].consumption,this.consumptionRoundOffFormat))),b.push(h),h=[];for(var R=0;R<e.bills.length;R++){this.consumptionRoundOffFormat=null!==(d=Object(y.e)("ConsumptionRoundOff",e.bills[R].utilityTypeId))&&void 0!==d?d:this.envService.consumptionRoundOffFormat;for(var I=e.bills[R],O=0;O<I.billTransactions.length;O++)w&&h.push(I.billNumber),h.push(I.billTransactions[O].headDisplay),"BTU"===I.utilityType&&I.billTransactions&&I.billTransactions.length&&I.billTransactions[O]&&I.billTransactions[O].measuringUnitId&&2===I.billTransactions[O].measuringUnitId?(h.push(this.decimalPipe.transform(.284345*I.consumption,this.consumptionRoundOffFormat)),h.push("TR-HR"),h.push(I.billTransactions[O].rate)):(h.push(this.decimalPipe.transform(I.consumption,this.consumptionRoundOffFormat)),h.push(I.measuringUnit),h.push(I.billTransactions[O].rate)),h.push(this.currencyPipe.transform(I.billTransactions[O].headAmount,this.currency.toString(),!0,this.roundFormat)),C.push(h),h=[],I.billTransactions[O].headAmount}h.push(e.accountNumber),h.push(e.fromDateLocal+"-"+e.toDateLocal),h.push(this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)),h.push(e.billAmountLocal),p.push(h),e.bills.forEach((function(e){e.deviceName}));var W=[],M=!1;h=[],e&&e.bills&&e.bills.length&&e.bills.forEach((function(e){var t;if(m.consumptionRoundOffFormat=null!==(t=Object(y.e)("ConsumptionRoundOff",e.utilityTypeId))&&void 0!==t?t:m.envService.consumptionRoundOffFormat,e.billTariffDetails&&e.billTariffDetails.length)for(var i=0;i<e.billTariffDetails.length;i++){if(e.billTariffDetails[i].slabSettingsId&&e.billTariffDetails[i].slabSettingsId>0){var n=e.billTariffDetails[i].season;Number(e.billTariffDetails[i].peakType)<Number(e.billTariffDetails[i].consumption)&&(n=e.billTariffDetails[i].peakType+" - "+e.billTariffDetails[i].consumption),0==i&&(M=!0,W=["Slab","Consumption","Rate","Amount"]),h.push(n),h.push(m.decimalPipe.transform(e.billTariffDetails[i].consumption,m.consumptionRoundOffFormat)),h.push(e.billTariffDetails[i].rate),h.push(m.currencyPipe.transform(e.billTariffDetails[i].amount,m.currency.toString(),!0,m.roundFormat))}else 0==e.billTariffDetails[i].slabSettingsId&&(0==i&&(W=["Season","Week Type","Peak Type","Consumption","Rate","Amount"]),h.push(e.billTariffDetails[i].season),h.push(e.billTariffDetails[i].weekType),h.push(e.billTariffDetails[i].peakType),h.push(m.decimalPipe.transform(e.billTariffDetails[i].consumption,m.consumptionRoundOffFormat)),h.push(e.billTariffDetails[i].rate),h.push(m.currencyPipe.transform(e.billTariffDetails[i].amount,m.currency.toString(),!0,m.roundFormat)));T.push(h),h=[]}}));var L=[];e.bills.forEach((function(e){if(e.billTransactions&&e.billTransactions.length){var t=["consumption","consumptioncharge"];e.billTransactions.forEach((function(e){if(!t.includes(e.headDisplay.toLowerCase())){var i=L.find((function(t){return t.label===e.headDisplay}));i?i.value+=e.headAmount:L.push({label:e.headDisplay,value:e.headAmount})}}))}})),e.billCharges&&e.billCharges.length&&e.billCharges.sort((function(e,t){return e.position-t.position})).forEach((function(e){if("VAT"!==e.headDisplay){var t=L.find((function(t){return t.label===e.headDisplay}));t?t.value+=e.headAmount:L.push({label:e.headDisplay,value:e.headAmount})}})),L.forEach((function(e){f.push({label:e.label,value:m.currencyPipe.transform(e.value,m.currency.toString(),!0,m.roundFormat)}),Number(e.value)})),e.billTaxDetails&&e.billTaxDetails.length&&e.billTaxDetails.forEach((function(e){f.push({label:e.taxDisplayName,value:m.currencyPipe.transform(e.taxAmount,m.currency.toString(),!0,m.roundFormat)}),Number(e.taxAmount)})),S.push({label:"Total for Current Period",value:this.currencyPipe.transform(e.billAmount+e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)}),this.getNewBillFormat3Report(P,b,f,["Customer AccountNumber","Billing Period","Previous Due","Total for current period"],p,g,v,[],"Invoice",D,C,e,S,W,T,M)}},{key:"addImage",value:function(e,t){var i;try{if(t&&t.client&&t.client.imageProperties&&t.client.imageProperties.length){var n=t.client.imageProperties.find((function(e){return"invoice"===e.imageType.trim().toLowerCase()}));if(n){var l=new Image;l.src=this.filePath+"/uploads/"+(null===(i=null==t?void 0:t.client)||void 0===i?void 0:i.photo),l.onload=function(){e.addImage(l,n.imgX,n.imgY,n.imgW,n.imgH)}}else this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar")}else this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar")}catch(a){this.notificationMessage("Image not found.","red-snackbar")}return e}},{key:"notificationMessage",value:function(e,t){this.snackbar.open(e,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[t]})}},{key:"getNewBillFormat3Report",value:function(e,t,i,n,l,a,o,r,s,c,u,d,m,h,b){var f,p,g,v,y=arguments.length>15&&void 0!==arguments[15]&&arguments[15],C=new Fe.default({orientation:"portrait",unit:"pt",format:"letter"});C.rect(5,5,C.internal.pageSize.width-10,C.internal.pageSize.height-10,"S"),C.setTextColor(0,0,0),C.setFontSize(11),C.setFont("Cambria"),C.text("Billing Statement".toUpperCase(),10,20),this.addImage(C,d),C.setLineWidth(.1),C.autoTable("",a,{startX:10,startY:35,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:15},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:190,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"},didParseCell:function(e){e.cell.styles.cellPadding=1.5}});var S=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"));C.autoTable("",o,{startX:10,startY:S,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:15},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:380,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0]},didParseCell:function(e){e.cell.styles.cellPadding=1.5}});var T=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"));C.setFont("Cambria"),C.setFontSize(10),C.text("Meter Read-Outs".toUpperCase(),10,T+15),C.autoTable(e,t,{startX:10,startY:T+30,didDrawPage:function(e){var t="Page "+e.pageCount;"function"==typeof C.putTotalPages&&(t+=" of 1",C.rect(5,5,C.internal.pageSize.width-10,C.internal.pageSize.height-10,"S")),C.setFontSize(9);var i=C.internal.pageSize.height||C.internal.pageSize.getHeight();C.text(t,e.settings.margin.left,i-10)},styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:6==e.length?120:4==e.length?200:155,halign:"center"},1:{cellWidth:6==e.length?100:4==e.length?135:125,halign:"center"},2:{cellWidth:6==e.length?100:4==e.length?135:125,halign:"center"},3:{cellWidth:4==e.length?120:100,halign:"center"},4:{cellWidth:85,halign:"center"},5:{cellWidth:85,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}});var P=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"));u&&u.length&&(C.setFontSize(10),C.text("Charges Breakdown".toUpperCase(),10,P+15),C.autoTable(c,u,{startX:10,startY:P+30,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:6==c.length?80:200,halign:"center"},1:{cellWidth:6==c.length?180:100,halign:"center"},2:{cellWidth:6==c.length?90:100,halign:"center"},3:{cellWidth:6==c.length?90:100,halign:"center"},4:{cellWidth:6==c.length?75:90,halign:"right"},5:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}));var D=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0")),w=D;y?(C.autoTable(h,b,{startX:10,startY:D+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:250,halign:"center"},1:{cellWidth:120,halign:"center"},2:{cellWidth:120,halign:"center"},3:{cellWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}),w=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"))):(C.autoTable(h,b,{startX:10,startY:D+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:140,halign:"center"},1:{cellWidth:100,halign:"center"},2:{cellWidth:100,halign:"center"},3:{cellWidth:100,halign:"center"},4:{cellWidth:75,halign:"center"},5:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}),w=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"))),C.autoTable("",i,{startX:10,startY:w+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{bottom:35,left:250},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:250,fontStyle:"italic"},1:{cellWidth:90}},didParseCell:function(e){1==e.column.index&&(e.cell.styles.halign="right"),e.cell.styles.cellPadding=1.5},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});var N=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"));C.line(5,N+10,607,N+10),C.autoTable("",m,{startX:10,startY:N+20,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{bottom:35,left:250},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:250,fontStyle:"italic"},1:{cellWidth:90}},didParseCell:function(e){1==e.column.index&&(e.cell.styles.halign="right"),e.cell.styles.cellPadding=1.5},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});var x=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"));C.line(5,x+10,607,x+10);var k=C.internal.pageSize.height;T>k-190&&(C.addPage(),C.rect(5,5,C.internal.pageSize.width-10,C.internal.pageSize.height-10,"S"),k=400),(null===(p=null===(f=null==d?void 0:d.client)||void 0===f?void 0:f.termsConditions[0])||void 0===p?void 0:p.termsAndCondition)&&(C.setFillColor(241,241,244),C.rect(10,k-190,590,90,"FD"),C.setFillColor(0,0,0),C.setFontSize(9),C.text(null===(v=null===(g=null==d?void 0:d.client)||void 0===g?void 0:g.termsConditions[0])||void 0===v?void 0:v.termsAndCondition.replace("{{ClientName}}",d.client.clientName).replace("{{TRNNumber}}",d.client.trnNo).replace("{{Currency}}",this.currency),30,k-175)),C.setTextColor(0,0,0),C.line(5,k-95,607,k-95),C.text("Notice :- Please tear and attach the slip  along with your payment",10,k-80),C.autoTable(n,l,{startX:10,startY:k-65,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:130,halign:"center"},1:{cellWidth:210,halign:"center"},2:{cellWidth:110,halign:"right"},3:{cellWidth:140,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}),"function"==typeof C.putTotalPages&&C.putTotalPages("1");var A=C.output("datauristring");this.pdfsToMerge.push(A)}},{key:"downloadBillFormat2LargeReport",value:function(e){var t,i,n,l,a,o,r,s,c,u,d,m,h,b,f,p,g,v,C,S,T=this,P=[],D=[],w=[],N=[],x=[],k=[],A=[],F=[],R=[],I=[],O=["Unit No","Meter No","Previous Reading","Present Reading","Consumption"],W=["Bill No","Charges","Consumption","Measuring Unit","Tariff","Total"];x.push({label:"Bill No",value:null!==(t=null==e?void 0:e.billNumber)&&void 0!==t?t:""},{label:"Date of issue",value:null!==(i=null==e?void 0:e.billDateLocal)&&void 0!==i?i:""},{label:"Due Date",value:null!==(n=null==e?void 0:e.dueDateLocal)&&void 0!==n?n:""}),k.push({label:"Customer Name",value:null!==(l=null==e?void 0:e.ownerName)&&void 0!==l?l:""},{label:"Customer AccountNumber",value:null!==(a=null==e?void 0:e.accountNumber)&&void 0!==a?a:""},{label:"Unit No",value:null!==(o=null==e?void 0:e.unitNumber)&&void 0!==o?o:""},{label:"Address",value:null!==(s=null===(r=null==e?void 0:e.receiverDetails[0])||void 0===r?void 0:r.address1)&&void 0!==s?s:""},{label:"City",value:null!==(u=null===(c=null==e?void 0:e.receiverDetails[0])||void 0===c?void 0:c.city)&&void 0!==u?u:""},{label:"P.O Box",value:null!==(m=null===(d=null==e?void 0:e.receiverDetails[0])||void 0===d?void 0:d.zipPostalCode)&&void 0!==m?m:""},{label:"Phone number",value:null!==(b=null===(h=null==e?void 0:e.receiverDetails[0])||void 0===h?void 0:h.phoneNumber)&&void 0!==b?b:""},{label:"Fax Number",value:""},{label:"Client",value:null!==(p=null===(f=null==e?void 0:e.client)||void 0===f?void 0:f.clientName)&&void 0!==p?p:""},{label:"Client TRN",value:null!==(v=null===(g=null==e?void 0:e.client)||void 0===g?void 0:g.trnNo)&&void 0!==v?v:""});var M=!1,L=!1;if(e&&e.bills&&e.bills.length){var B=Array.from(new Set(e.bills.map((function(e){return e.billNumber})))),z=Array.from(new Set(e.bills.map((function(e){return e.unitNumber}))));if(M=!!(B&&B.length>1),L=!!(z&&z.length>1),M?x.splice(0,1):W.splice(0,1),L){var U=k.findIndex((function(e){return"Unit No"===e.label}));k.splice(U,1)}else O.splice(0,1)}for(var E=0;E<e.bills.length;E++)this.consumptionRoundOffFormat=null!==(C=Object(y.e)("ConsumptionRoundOff",e.bills[E].utilityTypeId))&&void 0!==C?C:this.envService.consumptionRoundOffFormat,L&&P.push(e.bills[E].unitNumber),P.push(e.bills[E].deviceName),P.push(this.decimalPipe.transform(e.bills[E].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[E].measuringUnit),P.push(this.decimalPipe.transform(e.bills[E].presentReading,this.consumptionRoundOffFormat)+" "+e.bills[E].measuringUnit),P.push(e.bills[E].isDifferentiateBill?this.decimalPipe.transform(e.bills[E].presentReading-e.bills[E].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[E].measuringUnit:this.decimalPipe.transform(e.bills[E].consumption,this.consumptionRoundOffFormat)+" "+e.bills[E].measuringUnit),"BTU"===e.bills[E].utilityType&&e.bills[E].billTransactions&&e.bills[E].billTransactions.length&&e.bills[E].billTransactions.findIndex((function(e){return e.measuringUnitId&&2===e.measuringUnitId}))>-1&&(0==E&&O.push("Consumption TR-HR"),P.push(this.decimalPipe.transform(.284345*e.bills[E].consumption,this.consumptionRoundOffFormat))),D.push(P),P=[];for(var j=0,H=0;H<e.bills.length;H++){var Y=e.bills[H];this.consumptionRoundOffFormat=null!==(S=Object(y.e)("ConsumptionRoundOff",e.bills[H].utilityTypeId))&&void 0!==S?S:this.envService.consumptionRoundOffFormat;for(var V=0;V<Y.billTransactions.length;V++)M&&P.push(Y.billNumber),P.push(Y.billTransactions[V].headDisplay),"BTU"===Y.utilityType&&Y.billTransactions&&Y.billTransactions.length&&Y.billTransactions[V]&&Y.billTransactions[V].measuringUnitId&&2===Y.billTransactions[V].measuringUnitId?(P.push(this.decimalPipe.transform(.284345*Y.consumption,this.consumptionRoundOffFormat)),P.push("TR-HR"),P.push(Y.billTransactions[V].rate)):(P.push(this.decimalPipe.transform(Y.consumption,this.consumptionRoundOffFormat)),P.push(Y.measuringUnit),P.push(Y.billTransactions[V].rate)),P.push(this.currencyPipe.transform(Y.billTransactions[V].headAmount,this.currency.toString(),!0,this.roundFormat)),F.push(P),P=[],j+=Y.billTransactions[V].headAmount}P.push(e.accountNumber),P.push(e.fromDateLocal+"-"+e.toDateLocal),P.push(this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)),P.push(e.billAmountLocal),N.push(P),e.billCharges&&e.billCharges.length&&(e.billCharges.sort((function(e,t){return e.position-t.position})).forEach((function(e){if("VAT"!==e.headDisplay){var t=w.find((function(t){return t.label===e.headDisplay}));t?t.value+=e.headAmount:w.push({label:e.headDisplay,value:e.headAmount})}})),w.forEach((function(e){R.push({label:e.label,value:T.currencyPipe.transform(e.value,T.currency.toString(),!0,T.roundFormat)}),j+=e.value}))),R.push({label:"Total Charges for Current Period",value:this.currencyPipe.transform(j,this.currency.toString(),!0,this.roundFormat)}),e.billTaxDetails.forEach((function(e){var t=R.find((function(t){return t.label===e.taxDisplayName}));if(t){var i=Number(t.value.replace(T.currency,"").trim())+Number(e.taxAmount);t.value=T.currencyPipe.transform(i,T.currency.toString(),!0,T.roundFormat)}else R.push({label:e.taxDisplayName,value:T.currencyPipe.transform(e.taxAmount,T.currency.toString(),!0,T.roundFormat)})})),R.push({label:"Previous Outstanding Amount",value:this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)},{label:"Total Amount Due",value:this.currencyPipe.transform(e.billAmount+e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)}),A.push({firstItem:"Billing period",secondItem:"From:",thirdItem:e.fromDateLocal,fourthItem:"To:",fifthItem:e.toDateLocal});var _=[],G=!1,X=[];P=[],e&&e.bills&&e.bills.length&&e.bills.forEach((function(e){var t;T.consumptionRoundOffFormat=null!==(t=Object(y.e)("ConsumptionRoundOff",e.utilityTypeId))&&void 0!==t?t:T.envService.consumptionRoundOffFormat,X=[];var i="Unit Number : "+e.unitNumber+" - Meter Number : "+e.deviceName;if(e.billTariffDetails&&e.billTariffDetails.length)for(var n=0;n<e.billTariffDetails.length;n++){if(e.billTariffDetails[n].slabSettingsId&&e.billTariffDetails[n].slabSettingsId>0){var l=e.billTariffDetails[n].season;Number(e.billTariffDetails[n].peakType)<Number(e.billTariffDetails[n].consumption)&&(l=e.billTariffDetails[n].peakType+" - "+e.billTariffDetails[n].consumption),0==n&&(G=!0,_=["Slab","Consumption","Rate","Amount"]),X&&X.length?X.find((function(e){return e===i}))||T.createUnitMeterNumberRow(i,_.length,I):(X.push(i),T.createUnitMeterNumberRow(i,_.length,I)),P.push(l),P.push(T.decimalPipe.transform(e.billTariffDetails[n].consumption,T.consumptionRoundOffFormat)),P.push(e.billTariffDetails[n].rate),P.push(T.currencyPipe.transform(e.billTariffDetails[n].amount,T.currency.toString(),!0,T.roundFormat))}else 0==e.billTariffDetails[n].slabSettingsId&&(0==n&&(_=["Season","Week Type","Peak Type","Consumption","Rate","Amount"]),P.push(e.billTariffDetails[n].season),P.push(e.billTariffDetails[n].weekType),P.push(e.billTariffDetails[n].peakType),P.push(T.decimalPipe.transform(e.billTariffDetails[n].consumption,T.consumptionRoundOffFormat)),P.push(e.billTariffDetails[n].rate),P.push(T.currencyPipe.transform(e.billTariffDetails[n].amount,T.currency.toString(),!0,T.roundFormat)));I.push(P),P=[]}})),this.getBillFormat2LargeReport(O,D,w,["Customer AccountNumber","Billing Period","Previous Due","Total for current period"],N,x,k,A,"Sample Report",W,F,e,R,_,I,G)}},{key:"getBillFormat2LargeReport",value:function(e,t,i,n,l,a,o,r,s,c,u,d,m,h,b){var f,p,g,v,y,C,S,T=arguments.length>15&&void 0!==arguments[15]&&arguments[15];(new Image).src=this.filePath+"/uploads/"+(null===(f=null==d?void 0:d.client)||void 0===f?void 0:f.photo);var P=new Fe.default({orientation:"portrait",unit:"pt",format:"letter"}),D=null!==(g=null===(p=null==d?void 0:d.client)||void 0===p?void 0:p.clientName)&&void 0!==g?g:"",w=P.getTextWidth(D.trim())+4;P.setTextColor(0,0,0),P.setFontSize(17),P.setFont("Cambria"),P.text(D,Number(P.internal.pageSize.width/2)-Number(0!=w?w/2:0),23),P.setDrawColor(0,0,0),P.line(Number(P.internal.pageSize.width/2)-Number(0!=w?w/2:0),26,Number(P.internal.pageSize.width/2)-Number(0!=w?w/2:0)+w,26),P.setFont("Cambria","normal"),P.setFontSize(14),P.text("Billing Statement",35,46),this.addImage(P,d),P.autoTable("",a,{startX:10,startY:55,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:35},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:150,halign:"left"},1:{cellWidth:190,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"},didParseCell:function(e){e.cell.styles.cellPadding=1}});var N=Math.round(P.autoTable.previous.finalY);P.autoTable("",r,{startX:10,startY:N,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:35},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:150,halign:"left"},1:{cellWidth:95,halign:"center"},2:{cellWidth:95,halign:"center"},3:{cellWidth:97,halign:"center"},4:{cellWidth:97,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0]},didParseCell:function(e){e.cell.styles.cellPadding=1}});var x=Math.round(P.autoTable.previous.finalY);P.autoTable("",o,{startX:10,startY:x,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:35},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:150,halign:"left"},1:{cellWidth:384,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0]},didParseCell:function(e){e.cell.styles.cellPadding=1}});var k=function(e){var t="Page "+e.pageCount;"function"==typeof P.putTotalPages&&(t=t),P.setFontSize(9)},A=Math.round(P.autoTable.previous.finalY);P.setFont("Cambria"),P.setFontSize(10),P.text("Meter Read-Outs".toUpperCase(),35,A+20),P.autoTable(e,t,{startX:10,startY:A+40,showHead:"everyPage",didDrawPage:k,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:35},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:6==e.length?100:4==e.length?182:150,halign:"center"},1:{cellWidth:6==e.length?95:4==e.length?142:120,halign:"center"},2:{cellWidth:4==e.length?105:95,halign:"center"},3:{cellWidth:4==e.length?105:95,halign:"center"},4:{cellWidth:74,halign:"center"},5:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}});var F=Number(this.decimalPipe.transform(P.autoTable.previous.finalY,"1.0-0"));u&&u.length&&(P.setFontSize(10),P.text("Charges Breakdown".toUpperCase(),35,F+20),P.autoTable(c,u,{startX:10,startY:F+40,showHead:"everyPage",didDrawPage:k,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:35},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:6==c.length?80:215,halign:"center"},1:{cellWidth:6==c.length?145:85,halign:"center"},2:{cellWidth:85,halign:"center"},3:{cellWidth:75,halign:"center"},4:{cellWidth:74,halign:"right"},5:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}));var R=Number(this.decimalPipe.transform(P.autoTable.previous.finalY,"1.0-0")),I=R;T?(P.autoTable(h,b,{startX:10,startY:R+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:200,halign:"center"},1:{cellWidth:117,halign:"center"},2:{cellWidth:117,halign:"center"},3:{cellWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}),I=Number(this.decimalPipe.transform(P.autoTable.previous.finalY,"1.0-0"))):(P.autoTable(h,b,{startX:10,startY:R+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:130,halign:"center"},1:{cellWidth:85,halign:"center"},2:{cellWidth:85,halign:"center"},3:{cellWidth:85,halign:"center"},4:{cellWidth:74,halign:"center"},5:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}),I=Number(this.decimalPipe.transform(P.autoTable.previous.finalY,"1.0-0")));var O=P.internal.pageSize.height;O-I<200&&(P.addPage(),I=N,O=370+N),P.autoTable("",m,{startX:10,startY:I+20,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{bottom:40,left:250},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:244,fontStyle:"italic"},1:{cellWidth:75}},didParseCell:function(e){1==e.column.index&&(e.cell.styles.halign="right"),e.cell.styles.cellPadding=1},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});var W=Number(this.decimalPipe.transform(P.autoTable.previous.finalY,"1.0-0"));(null===(y=null===(v=null==d?void 0:d.client)||void 0===v?void 0:v.termsConditions[0])||void 0===y?void 0:y.termsAndCondition)&&(P.setFillColor(241,241,244),P.rect(35,W+20,535,80,"FD"),P.setFillColor(0,0,0),P.setFontSize(9),P.text(null===(S=null===(C=null==d?void 0:d.client)||void 0===C?void 0:C.termsConditions[0])||void 0===S?void 0:S.termsAndCondition.replace("{{ClientName}}",d.client.clientName).replace("{{TRNNumber}}",d.client.trnNo).replace("{{Currency}}",this.currency),65,W+30)),P.setTextColor(0,0,0),P.line(5,W+110,607,W+110),P.text("Notice :- Please tear and attach the slip  along with your payment",35,O-80),P.autoTable(n,l,{startX:10,startY:O-70,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:35},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:120,halign:"center"},1:{cellWidth:200,halign:"center"},2:{cellWidth:100,halign:"right"},3:{cellWidth:120,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}});var M=P.output("datauristring");this.pdfsToMerge.push(M)}},{key:"createUnitMeterNumberRow",value:function(e,t,i){for(var n=[],l=0;l<t-1;l++)n.push(0===l?e:"");i.push(n)}}]),e}()).\u0275fac=function(e){return new(e||Xi)(g.Nb(b.a),g.Nb(at.a),g.Nb(M.a),g.Nb(d.f),g.Nb(d.d),g.Nb(d.g),g.Nb(v.b),g.Nb(Ae.a),g.Nb(w.a),g.Nb(Z.a),g.Nb(B.b),g.Nb(C.a))},Xi.\u0275cmp=g.Hb({type:Xi,selectors:[["app-bill-history-cancel"]],viewQuery:function(e,t){var i;1&e&&g.Vc(Qi,!0),2&e&&g.zc(i=g.cc())&&(t.htmlData=i.first)},decls:27,vars:15,consts:[["mode","card",2,"margin-top","20px"],["fxLayout","column"],["color","primary",1,"position-fixed"],["src","assets/img/fav-icon.png",1,"img-style"],[1,"toolbar-spacer"],["matTooltip","Print","mat-icon-button","","aria-label","Example icon-button with menu icon",1,"example-icon",3,"click"],["fxFlex","noshrink","fxLayout","column","fxLayout.gt-sm","row","fxLayoutAlign.gt-sm","start stretch",3,"fxLayoutGap"],["fxFlex","grow",1,"basic-forms","route-animations-elements",3,"fxFlex.gt-sm"],["fxLayout","column",1,"result"],[3,"tenants","billPeriods","isTenantVisible","billTypes","isHide","searchClicked"],["fxLayout","column",1,"padding"],[3,"tableData","columnsToDisplay","innerDisplayedColumns","columnNames","hideHeader","selectedRows","viewDataRow","printDataRow"],["fxLayout.gt-sm","row","fxLayout","column","fxLayoutAlign","end end","fxLayoutGap.gt-sm","12px",1,"result"],["color","primary",1,"result"],["type","text","id","billAmount","name","billAmount","matInput","",2,"text-align","right",3,"ngModel","ngModelChange"],["type","text","id","receivedAmount","name","receivedAmount","matInput","",2,"text-align","right",3,"ngModel","ngModelChange"]],template:function(e,t){1&e&&(g.Tb(0,"fury-page-layout",0),g.Tb(1,"fury-page-layout-content",1),g.Tb(2,"mat-toolbar",2),g.Ob(3,"img",3),g.Tb(4,"span"),g.Rc(5,"Bill Cancel History"),g.Sb(),g.Ob(6,"span",4),g.Tb(7,"button",5),g.bc("click",(function(){return t.onPrintPdf()})),g.Tb(8,"mat-icon"),g.Rc(9,"print"),g.Sb(),g.Sb(),g.Sb(),g.Tb(10,"div",6),g.Tb(11,"fury-card",7),g.Ob(12,"fury-card-header"),g.Tb(13,"fury-card-content",1),g.Tb(14,"div",8),g.Tb(15,"app-bill-history-toolbar",9),g.bc("searchClicked",(function(e){return t.onGetBillsHistory(e)})),g.Sb(),g.Sb(),g.Tb(16,"div",10),g.Tb(17,"fury-expandable-table-structure",11),g.bc("selectedRows",(function(e){return t.onSelectedRows(e)}))("viewDataRow",(function(e){return t.onViewDataRow(e)}))("printDataRow",(function(e){return t.downloadReport(e)})),g.Sb(),g.Sb(),g.Tb(18,"div",12),g.Tb(19,"mat-form-field",13),g.Tb(20,"mat-label"),g.Rc(21,"Bill Amount"),g.Sb(),g.Tb(22,"input",14),g.bc("ngModelChange",(function(e){return t.billAmount=e})),g.Sb(),g.Sb(),g.Tb(23,"mat-form-field",13),g.Tb(24,"mat-label"),g.Rc(25,"Paid Amount"),g.Sb(),g.Tb(26,"input",15),g.bc("ngModelChange",(function(e){return t.receivedAmount=e})),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb()),2&e&&(g.Cb(10),g.mc("fxLayoutGap",t.gap),g.Cb(1),g.mc("fxFlex.gt-sm",t.col2)("@fadeInUp",void 0),g.Cb(4),g.mc("tenants",t.tenants)("billPeriods",t.billPeriods)("isTenantVisible",!1)("billTypes",t.billTypes)("isHide",!1),g.Cb(2),g.mc("tableData",t.billMasterDetails)("columnsToDisplay",t.columns)("innerDisplayedColumns",t.innerColumns)("columnNames",t.columnNames)("hideHeader",!1),g.Cb(5),g.mc("ngModel",t.billAmount),g.Cb(4),g.mc("ngModel",t.receivedAmount))},directives:[te.a,ie.a,N.d,ne.a,k.a,A.a,F.a,N.b,N.c,N.e,S.a,S.d,S.c,Pt,x.a,z.d,z.h,E.b,s.c,s.q,s.t],styles:[".padding[_ngcontent-%COMP%]{padding:0 0 24px}.toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.img-style[_ngcontent-%COMP%]{width:32px}.position-fixed[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;top:0;z-index:5}"],data:{animation:[p.a,f.a]}}),Xi),Zi=((Gi=function(){function e(t,i,n,a,o,r,s,c,u,d){var m,h,b;l(this,e),this.billService=t,this.billSettlementService=i,this.date=n,this.currency=a,this.decimalPipe=o,this.cookieService=r,this.snackbar=s,this.clientSelectionService=c,this.templateService=u,this.envService=d,this._gap=16,this.gap=this._gap+"px",this.col2="1 1 calc(50% - ".concat(this._gap/2,"px)"),this.col3="1 1 calc(33.3333% - ".concat(this._gap/1.5,"px)"),this.columns=[],this.innerColumns=[],this.columnNames=[],this.payments=[],this.paymentModes=[{label:"Select",value:0}],this.selectedRows=[],this.manageParams={},this.innerTableName="billMasters",this.billAmount="",this.receivedAmount="",this.filePath="",this.pdfsToMerge=[],this.dateFormat="",this.currencyFormat="",this.roundOffFormat="",this.paymentNumberColumnName="Payment No",this.accountNumberColumnName="Account Number",this.paymentDateColumnName="Payment Date",this.paymentModeColumnName="Payment Mode",this.refNoColumnName="Ref No",this.tenantColumnName="Customer Name",this.receivedAmountColumnName="Received Amount",this.reasonColumnName="Reason",this.billNumberColumnName="Bill No",this.billDateCoulmnName="BillDate",this.tenantNameColumnName="Tenant Name",this.unitColumnName="Unit",this.fromDateColumnName="From Date",this.toDateColumnName="To Date",this.dueDateColumnName="Due Date",this.billAmountColumnName="Bill Amount",this.billDateColumnName="BillDate",this.dateFormat=null!==(m=Object(y.e)("DateFormat"))&&void 0!==m?m:d.dateFormat,this.currencyFormat=null!==(h=Object(y.e)("Currency"))&&void 0!==h?h:d.currencyFormat,this.roundOffFormat=null!==(b=Object(y.e)("RoundOff"))&&void 0!==b?b:d.roundOffFormat}return o(e,[{key:"ngOnInit",value:function(){this.clientSelectionService.setIsClientVisible(!0),this.clientId=parseInt(this.cookieService.get("globalClientId")),this.onGetPaymentModes(),this.createColumnNames(),this.createGridColumns(),this.createInnerGridColumns()}},{key:"createGridColumns",value:function(){this.columns=["select","paymentNumber","paymentDateLocal","paymentReference","paymentMode","accountNumber","tenantName","paymentAmountLocal","cancelReason"]}},{key:"createInnerGridColumns",value:function(){this.innerColumns=["billNumber","billDateLocal","unitNumber","fromDateLocal","toDateLocal","dueDateLocal","billAmountLocal"]}},{key:"createColumnNames",value:function(){this.columnNames=[{name:this.paymentNumberColumnName,property:"paymentNumber"},{name:this.paymentDateColumnName,property:"paymentDateLocal"},{name:this.refNoColumnName,property:"paymentReference"},{name:this.paymentModeColumnName,property:"paymentMode"},{name:this.accountNumberColumnName,property:"accountNumber"},{name:this.tenantColumnName,property:"tenantName"},{name:this.receivedAmountColumnName,property:"paymentAmountLocal",columnAlign:{"text-align":"right"}},{name:this.reasonColumnName,property:"cancelReason"},{name:this.billNumberColumnName,property:"billNumber"},{name:this.billDateColumnName,property:"billDateLocal"},{name:this.unitColumnName,property:"unitNumber"},{name:this.fromDateColumnName,property:"fromDateLocal"},{name:this.toDateColumnName,property:"toDateLocal"},{name:this.dueDateColumnName,property:"dueDateLocal"},{name:this.billAmountColumnName,property:"billAmountLocal",columnAlign:{"text-align":"right"}}]}},{key:"onGetPaymentHistory",value:function(e){var t=this;this.manageParams=e,this.payments=[],this.billAmount="",this.receivedAmount="";var i=0,n=0;e.clientId=this.clientId,this.billService.getPaymentCancelHistory(e).subscribe((function(e){t.dateFormat=Object(y.e)("DateFormat"),t.roundOffFormat=Object(y.e)("RoundOff"),t.currencyFormat=Object(y.e)("Currency"),e.forEach((function(e){e.paymentDateLocal=t.date.transform(e.paymentDate.toString(),t.dateFormat.toString()),e.referenceDateLocal=t.date.transform(e.referenceDate.toString(),t.dateFormat.toString()),e.paymentAmountLocal=t.currency.transform(e.paymentAmount,t.currencyFormat.toString(),!0,t.roundOffFormat),e.advanceAmountLocal=t.currency.transform(e.advanceAmount,t.currencyFormat.toString(),!0,t.roundOffFormat),e.billMasters.forEach((function(e){var n;e.billDate&&(e.billDateLocal=t.date.transform(e.billDate.toString(),t.dateFormat.toString())),e.billAmount&&(e.billAmountLocal=t.currency.transform(e.billAmount,t.currencyFormat.toString(),!0,t.roundOffFormat)),e.fromDate&&(e.fromDateLocal=t.date.transform(e.fromDate.toString(),t.dateFormat.toString())),e.toDate&&(e.toDateLocal=t.date.transform(e.toDate.toString(),t.dateFormat.toString())),e.dueDate&&(e.dueDateLocal=t.date.transform(e.dueDate.toString(),t.dateFormat.toString())),e.paid&&(e.paidLocal=t.currency.transform(e.paid.toString(),t.currencyFormat.toString(),!0,t.roundOffFormat)),i=null!==(n=i+e.billAmount)&&void 0!==n?n:0})),n+=e.paymentAmount})),t.payments=e,t.billAmount=t.currency.transform(i,t.currencyFormat.toString(),!0,t.roundOffFormat),t.receivedAmount=t.currency.transform(n,t.currencyFormat.toString(),!0,t.roundOffFormat)}))}},{key:"onGetPaymentModes",value:function(){var e=this;this.paymentModes=[{label:"Select",value:0}],this.billSettlementService.getPaymentModes().subscribe((function(t){t.forEach((function(t){e.paymentModes.push({label:t.description,value:t.id})}))}))}},{key:"onPrintPdf",value:function(){return Object(h.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.selectedRows&&this.selectedRows.length?this.receiptView(this.selectedRows):this.notificationMessage("Please select Bills.","red-snackbar");case 1:case"end":return e.stop()}}),e,this)})))}},{key:"receiptView",value:function(e){var t=this;this.billService.receiptView(e).subscribe({next:function(e){e?t.downloadFile(e):t.notificationMessage("No data to print","red-snackbar")},error:function(e){t.notificationMessage("No data to print","red-snackbar")}})}},{key:"downloadFile",value:function(e){return Object(h.a)(this,void 0,void 0,regeneratorRuntime.mark((function i(){var n,l,a,o,r,s,c,u;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,ee.PDFDocument.create();case 2:n=i.sent,l=t(e),i.prev=4,l.s();case 6:if((a=l.n()).done){i.next=16;break}return o=a.value,i.next=10,ee.PDFDocument.load(o);case 10:return r=i.sent,i.next=13,n.copyPages(r,r.getPageIndices());case 13:i.sent.forEach((function(e){n.addPage(e)}));case 14:i.next=6;break;case 16:i.next=21;break;case 18:i.prev=18,i.t0=i.catch(4),l.e(i.t0);case 21:return i.prev=21,l.f(),i.finish(21);case 24:return i.next=26,n.save();case 26:s=i.sent,c=new Blob([s],{type:"application/pdf"}),u=window.URL.createObjectURL(c),window.open(u);case 30:case"end":return i.stop()}}),i,null,[[4,18,21,24]])})))}},{key:"downloadReport",value:function(e){var t=[],i=[],n="",l="",a=Array.from(new Set(e.billMasters.map((function(e){return e.billNumber})))),o=Array.from(new Set(e.billMasters.map((function(e){return e.unitNumber}))));a&&a.length&&a.forEach((function(e){n+=e+","})),o&&o.length&&o.forEach((function(e){l+=e+","})),i.push({label:"Receipt Number:",value:e.paymentNumber},{label:"Receipt Date:",value:e.paymentDateLocal},{label:"Account Number:",value:e.accountNumber},{label:"Invoice Number:",value:0===n.trim().indexOf(",")?n.trim().slice(1).slice(0,-1):n.trim().slice(0,-1)},{label:"Unit Number:",value:0===l.trim().indexOf(",")?l.trim().slice(1).slice(0,-1):l.trim().slice(0,-1)},{label:"Mode of payment:",value:e.paymentMode});var r=0;e.billMasters.forEach((function(e){r+=e.paid}));var s=e.outStandingAmount-r;t.push({label:"Total Outstanding Amount :",value:this.currency.transform(e.outStandingAmount,this.currencyFormat.toString(),!0,this.roundOffFormat)},{label:"Received Payments :",value:e.paymentAmountLocal},{label:"",value:""},{label:"Balance Outstanding :",value:this.currency.transform(s,this.currencyFormat.toString(),!0,this.roundOffFormat)}),this.getReport(e,t,i)}},{key:"addImage",value:function(e,t){var i;try{if(t&&t.billMasters&&t.billMasters.length&&t.billMasters[0]&&t.billMasters[0].client&&t.billMasters[0].client.imageProperties&&t.billMasters[0].client.imageProperties.length){var n=t.billMasters[0].client.imageProperties.find((function(e){return"receipt"===e.imageType.trim().toLowerCase()}));if(n){var l=new Image;l.src=this.filePath+"/uploads/"+(null===(i=null==t?void 0:t.billMasters[0].client)||void 0===i?void 0:i.photo),l.onload=function(){e.addImage(l,n.imgX,n.imgY,n.imgW,n.imgH)}}else this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar")}else this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar")}catch(a){this.notificationMessage("Image not found.","red-snackbar")}return e}},{key:"getReport",value:function(e,t,i){var n,l,a,o,r,s,c,u,d,m,h,b,f,p,g,v,C,S,T,P,D,w,N,x,k,A,F,R,I,O,W,M,L,B,z,U,E,j,H,Y,V,_,G,X,q,$,J=new Fe.default({orientation:"portrait",unit:"pt",format:"letter"}),Q=Object(y.f)(null===(l=null===(n=null==e?void 0:e.billMasters[0])||void 0===n?void 0:n.client)||void 0===l?void 0:l.website).split(".")[1];J.rect(5,5,J.internal.pageSize.width-10,J.internal.pageSize.height-10,"S");var K=30;J.setFontSize(30),this.addImage(J,e),J.setTextColor(0,0,0),J.setFontSize(14),J.setFont("Cambria","bold"),J.text("CANCELLED PAYMENT RECEIPT",190,K),J.setFont("Cambria","normal"),J.setFontSize(14),K=37,J.text(Object(y.f)(null===(o=null===(a=null==e?void 0:e.billMasters[0])||void 0===a?void 0:a.client)||void 0===o?void 0:o.clientName).toUpperCase(),10,K+20),K=44,J.setFontSize(10),J.text("TRN: "+Object(y.f)(null===(s=null===(r=null==e?void 0:e.billMasters[0])||void 0===r?void 0:r.client)||void 0===s?void 0:s.trnNo),10,K+30),J.text("PO Box "+Object(y.f)(null===(d=null===(u=null===(c=null==e?void 0:e.billMasters[0])||void 0===c?void 0:c.client)||void 0===u?void 0:u.addresses[0])||void 0===d?void 0:d.zipPostalCode),10,K+40),J.text(Object(y.f)(null===(b=null===(h=null===(m=null==e?void 0:e.billMasters[0])||void 0===m?void 0:m.client)||void 0===h?void 0:h.addresses[0])||void 0===b?void 0:b.location,",")+Object(y.f)(null===(g=null===(p=null===(f=null==e?void 0:e.billMasters[0])||void 0===f?void 0:f.client)||void 0===p?void 0:p.addresses[0])||void 0===g?void 0:g.city,",")+Object(y.f)(null===(S=null===(C=null===(v=null==e?void 0:e.billMasters[0])||void 0===v?void 0:v.client)||void 0===C?void 0:C.addresses[0])||void 0===S?void 0:S.country,","),10,K+50),J.text("Phone: "+Object(y.f)(null===(P=null===(T=null==e?void 0:e.billMasters[0])||void 0===T?void 0:T.client)||void 0===P?void 0:P.phoneNo),10,K+60),J.text("Email: "+Object(y.f)(null===(w=null===(D=null==e?void 0:e.billMasters[0])||void 0===D?void 0:D.client)||void 0===w?void 0:w.email),10,K+70),J.text("Web: "+Object(y.f)(null===(x=null===(N=null==e?void 0:e.billMasters[0])||void 0===N?void 0:N.client)||void 0===x?void 0:x.website),10,K+80),J.setFillColor(241,241,244),J.setDrawColor(206,203,203),J.rect(10,K+90,250,90,"FD"),J.setTextColor(0,0,0),J.setFontSize(12),J.text(Object(y.f)(null==e?void 0:e.tenantName).toUpperCase(),20,K+105),J.setFontSize(11),J.text("CUSTOMER TRN: "+Object(y.f)(null==e?void 0:e.trn),20,K+125),J.text("unit #"+Object(y.f)(null===(k=null==e?void 0:e.billMasters[0])||void 0===k?void 0:k.unitNumber),20,K+140),J.setFontSize(10),J.text(Object(y.f)(null===(A=null==e?void 0:e.billMasters[0])||void 0===A?void 0:A.clientName),20,K+155),J.text(Object(y.f)(null===(R=null===(F=null==e?void 0:e.billMasters[0].client)||void 0===F?void 0:F.addresses[0])||void 0===R?void 0:R.city,",")+Object(y.f)(null===(W=null===(O=null===(I=null==e?void 0:e.billMasters[0])||void 0===I?void 0:I.client)||void 0===O?void 0:O.addresses[0])||void 0===W?void 0:W.country,","),20,K+170),J.setFontSize(9),J.autoTable("",i,{startX:210,startY:K+90,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:400},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:100,halign:"right"}},didParseCell:function(e){var t=e.column.index;0!=t&&1!=t||(e.cell.styles.rowHeight=1)},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});var Z=Number(this.decimalPipe.transform(J.autoTable.previous.finalY,"1.0-0"));J.setLineWidth(.1),J.line(5,Z+10,607,Z+10),J.setTextColor(0,0,0),J.setFontSize(10),J.text("Thank you for using "+Q+" payment services.",20,Z+30),J.text("We confirm receipt of your payment.",20,Z+40),J.text("Please see the below details for your reference.",20,Z+50),J.setTextColor(0,0,0),J.autoTable("",t,{startX:300,startY:Z+60,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:110},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:180,halign:"left"},1:{cellWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"}}),J.setTextColor(0,0,0);var ee=Number(this.decimalPipe.transform(J.autoTable.previous.finalY,"1.0-0"));J.setTextColor(255,0,0),J.setFontSize(9),J.text("Note: A Late Fee will be applied after the due date. A Default Payment \nPenalty will be added to any unit that is ".concat(null===(M=null==e?void 0:e.billMasters[0])||void 0===M?void 0:M.penaltyAfter," days or more in arrears."),320,ee+20),J.setTextColor(25,118,210),J.setFontSize(12),J.text("USAGE TIPS to reduce consumption:",10,ee+80),J.text("Please Try to:",10,ee+100),J.setTextColor(0,0,0),J.setFontSize(9),J.text("- Keep filters clean",30,ee+110),J.text("- Set thermostats between 23C and 25C",30,ee+120),J.text("- Keep vents unblocked",30,ee+130),J.text("- Keep doors and windows closed",30,ee+140),J.text("- Undertake regular maintenance of the system",30,ee+150),J.setTextColor(25,118,210),J.setFontSize(12),J.text("Please Do Not:",10,ee+170),J.setTextColor(0,0,0),J.setFontSize(9),J.text("- Set thermostats to 20C or lower",30,ee+180),J.text("- Block vents",30,ee+190),J.text("- Leave doors and windows open",30,ee+200),J.text("- Leave heat producing appliances near thermostats",30,ee+210),J.setFillColor(119,183,11);var te=J.internal.pageSize.height||J.internal.pageSize.getHeight();J.rect(320,ee+60,280,te-80-(ee+60),"FD"),J.setFont("Comic Sans"),J.setTextColor(255,255,255),J.setFontSize(16),J.text("ADVERTISE WITH US",360,ee+80);var ie=J.getTextWidth("ADVERTISE WITH US");J.setLineWidth(.1),J.line(360,ee+85,360+ie,ee+85),J.setFontSize(9),J.text("For advertisement, contact at",390,ee+95),J.text(Object(y.f)(null===(B=null===(L=null==e?void 0:e.billMasters[0])||void 0===L?void 0:L.client)||void 0===B?void 0:B.phoneNo),390,ee+105),J.text(Object(y.f)(null===(U=null===(z=null==e?void 0:e.billMasters[0])||void 0===z?void 0:z.client)||void 0===U?void 0:U.email),390,ee+115),J.text(Object(y.f)(null===(j=null===(E=null==e?void 0:e.billMasters[0])||void 0===E?void 0:E.client)||void 0===j?void 0:j.website),390,ee+125),J.setTextColor(0,0,0),J.setLineWidth(.1),J.line(5,te-70,607,te-70),J.text(null!==(X=null!==(V="For any enquiries, write to us "+(null===(Y=null===(H=null==e?void 0:e.billMasters[0])||void 0===H?void 0:H.client)||void 0===Y?void 0:Y.email))&&void 0!==V?V:"\n or Logon to "+(null===(G=null===(_=e.billMasters[0])||void 0===_?void 0:_.client)||void 0===G?void 0:G.website))&&void 0!==X?X:"",10,te-60),J.setTextColor(255,0,0),J.setFont("bold");var ne=J.getTextWidth("Notice:");J.text("Notice:",330,te-60),J.setFont("none"),J.setTextColor(0,0,0),J.text("Pay your bills before due date to avoid late payment surcharge",330+ne,te-60),J.text("and disconnection.",330,te-50),J.text("You can log onto "+(null===($=null===(q=null==e?void 0:e.billMasters[0])||void 0===q?void 0:q.client)||void 0===$?void 0:$.website)+" to pay your invoices \nTerms & Conditions for Supply of Utility Services",330,te-40),"function"==typeof J.putTotalPages&&J.putTotalPages("1");var le=J.output("datauristring");this.pdfsToMerge.push(le)}},{key:"notificationMessage",value:function(e,t){this.snackbar.open(e,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[t]})}},{key:"onSendEmail",value:function(){this.selectedRows&&this.templateService.emailReceiptTemplate(this.selectedRows).subscribe((function(e){}))}},{key:"onSelectedRows",value:function(e){this.selectedRows=[],this.selectedRows=e}}]),e}()).\u0275fac=function(e){return new(e||Gi)(g.Nb(b.a),g.Nb(M.a),g.Nb(d.f),g.Nb(d.d),g.Nb(d.g),g.Nb(w.a),g.Nb(B.b),g.Nb(Z.a),g.Nb(Ae.a),g.Nb(C.a))},Gi.\u0275cmp=g.Hb({type:Gi,selectors:[["app-payment-history-cancel"]],decls:27,vars:12,consts:[["mode","card",2,"margin-top","20px"],["fxLayout","column"],["color","primary",1,"position-fixed"],["src","assets/img/fav-icon.png",1,"img-style"],[1,"toolbar-spacer"],["matTooltip","Print","mat-icon-button","","aria-label","Example icon-button with menu icon",1,"example-icon",3,"click"],["fxFlex","noshrink","fxLayout","column","fxLayout.gt-sm","row","fxLayoutAlign.gt-sm","start stretch",3,"fxLayoutGap"],["fxFlex","grow",1,"basic-forms","route-animations-elements",3,"fxFlex.gt-sm"],["fxLayout","column",1,"result"],[3,"paymentModes","searchClicked"],["fxLayout","column",1,"padding"],[3,"tableData","columnsToDisplay","innerDisplayedColumns","columnNames","innerTableName","hideHeader","selectedRows","printDataRow"],["fxLayout.gt-sm","row","fxLayout","column","fxLayoutAlign","end end","fxLayoutGap.gt-sm","12px",1,"result"],["color","primary",1,"result"],["type","text","id","billAmount","name","billAmount","matInput","",2,"text-align","right",3,"ngModel","ngModelChange"],["type","text","id","receivedAmount","name","receivedAmount","matInput","",2,"text-align","right",3,"ngModel","ngModelChange"]],template:function(e,t){1&e&&(g.Tb(0,"fury-page-layout",0),g.Tb(1,"fury-page-layout-content",1),g.Tb(2,"mat-toolbar",2),g.Ob(3,"img",3),g.Tb(4,"span"),g.Rc(5,"Payment Cancel History"),g.Sb(),g.Ob(6,"span",4),g.Tb(7,"button",5),g.bc("click",(function(){return t.onPrintPdf()})),g.Tb(8,"mat-icon"),g.Rc(9,"print"),g.Sb(),g.Sb(),g.Sb(),g.Tb(10,"div",6),g.Tb(11,"fury-card",7),g.Ob(12,"fury-card-header"),g.Tb(13,"fury-card-content",1),g.Tb(14,"div",8),g.Tb(15,"app-payment-history-toolbar",9),g.bc("searchClicked",(function(e){return t.onGetPaymentHistory(e)})),g.Sb(),g.Sb(),g.Tb(16,"div",10),g.Tb(17,"fury-expandable-table-structure",11),g.bc("selectedRows",(function(e){return t.onSelectedRows(e)}))("printDataRow",(function(e){return t.downloadReport(e)})),g.Sb(),g.Sb(),g.Tb(18,"div",12),g.Tb(19,"mat-form-field",13),g.Tb(20,"mat-label"),g.Rc(21,"Bill Amount"),g.Sb(),g.Tb(22,"input",14),g.bc("ngModelChange",(function(e){return t.billAmount=e})),g.Sb(),g.Sb(),g.Tb(23,"mat-form-field",13),g.Tb(24,"mat-label"),g.Rc(25,"Received Amount"),g.Sb(),g.Tb(26,"input",15),g.bc("ngModelChange",(function(e){return t.receivedAmount=e})),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb()),2&e&&(g.Cb(10),g.mc("fxLayoutGap",t.gap),g.Cb(1),g.mc("fxFlex.gt-sm",t.col2)("@fadeInUp",void 0),g.Cb(4),g.mc("paymentModes",t.paymentModes),g.Cb(2),g.mc("tableData",t.payments)("columnsToDisplay",t.columns)("innerDisplayedColumns",t.innerColumns)("columnNames",t.columnNames)("innerTableName",t.innerTableName)("hideHeader",!1),g.Cb(5),g.mc("ngModel",t.billAmount),g.Cb(4),g.mc("ngModel",t.receivedAmount))},directives:[te.a,ie.a,N.d,ne.a,k.a,A.a,F.a,N.b,N.c,N.e,S.a,S.d,S.c,xi,x.a,z.d,z.h,E.b,s.c,s.q,s.t],styles:[".padding[_ngcontent-%COMP%]{padding:0 0 24px}.toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.img-style[_ngcontent-%COMP%]{width:32px}.position-fixed[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;top:0;z-index:5}"],data:{animation:[p.a,f.a]}}),Gi),en=((_i=function(){function e(t){var i,n,a;l(this,e),this.envService=t,this.columns=[],this.innerColumns=[],this.columnNames=[],this.failedBills=[],this.selectedRows=[],this.innerTableName="bills",this.banks=[],this.paymentModes=[],this.isHide=!0,this.format="",this.currency="",this.roundFormat="",this.hideHeader=!0,this.saveClicked=new g.o,this.rowsSelected=new g.o,this.slNumberColumnName="Sl No.",this.unitNumberCoulmnName="Unit Number",this.deviceNameCoulmnName="Device Name",this.consumptionCoulmnName="First Consumption",this.unitAverageColumnName="Average Consumption",this.differenceColumnName="Difference",this.differencePercenatgeColumnName="Difference [%]",this.format=null!==(i=Object(y.e)("DateFormat"))&&void 0!==i?i:t.dateFormat,this.currency=null!==(n=Object(y.e)("Currency"))&&void 0!==n?n:t.currencyFormat,this.roundFormat=null!==(a=Object(y.e)("RoundOff"))&&void 0!==a?a:t.roundOffFormat}return o(e,[{key:"ngOnInit",value:function(){this.createGridColumns(),this.updateTableColumns()}},{key:"createGridColumns",value:function(){this.columns=[{name:"Checkbox",property:"checkbox",visible:!0},{name:this.slNumberColumnName,property:"id",visible:!0,isModelProperty:!0},{name:this.unitNumberCoulmnName,property:"unitNumber",visible:!0,isModelProperty:!0},{name:this.deviceNameCoulmnName,property:"deviceName",visible:!0,isModelProperty:!0},{name:this.consumptionCoulmnName,property:"consumptionLocal",visible:!0,isModelProperty:!0,columnAlign:{"text-align":"right"}},{name:this.unitAverageColumnName,property:"averageConsumptionLocal",visible:!0,isModelProperty:!0,columnAlign:{"text-align":"right"}},{name:this.differenceColumnName,property:"consumptionDifferenceLocal",visible:!0,isModelProperty:!0,columnAlign:{"text-align":"right"}},{name:this.differencePercenatgeColumnName,property:"consumptionDifferencePercentageLocal",visible:!0,isModelProperty:!0,icon:"status",columnAlign:{"text-align":"right"}}]}},{key:"updateTableColumns",value:function(){this.columns.splice(0,1)}},{key:"onSelectedRows",value:function(e){this.selectedRows=[],this.selectedRows=e,this.rowsSelected.emit(this.selectedRows)}},{key:"updateDataFormats",value:function(e){return e&&e.forEach((function(e){})),e}},{key:"content",set:function(e){this.sort=e,this.sort&&this.dataSource&&(this.dataSource.sort=this.sort)}},{key:"dataSource",set:function(e){e&&e.length&&(this.failedBills=e)}},{key:"visibleColumns",get:function(){return this.columns.filter((function(e){return e.visible})).map((function(e){return e.property}))}}]),e}()).\u0275fac=function(e){return new(e||_i)(g.Nb(C.a))},_i.\u0275cmp=g.Hb({type:_i,selectors:[["fury-bill-consumption-details"]],viewQuery:function(e,t){var i;1&e&&(g.Jc(Ht.a,!0),g.Vc(Yt.a,!0)),2&e&&(g.zc(i=g.cc())&&(t.paginator=i.first),g.zc(i=g.cc())&&(t.content=i.first))},inputs:{banks:"banks",paymentModes:"paymentModes",isHide:"isHide",dataSource:"dataSource",hideHeader:"hideHeader"},outputs:{saveClicked:"saveClicked",rowsSelected:"rowsSelected"},decls:5,vars:4,consts:[[1,"person"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","24px"],["fxFlex","",1,"fury-flex-form-field"],[3,"tableData","columns","buttonVisible","hideHeader","selectedRows"]],template:function(e,t){1&e&&(g.Tb(0,"mat-dialog-content"),g.Tb(1,"div",0),g.Tb(2,"div",1),g.Tb(3,"div",2),g.Tb(4,"app-table-structure",3),g.bc("selectedRows",(function(e){return t.onSelectedRows(e)})),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb()),2&e&&(g.Cb(4),g.mc("tableData",t.failedBills)("columns",t.columns)("buttonVisible",!1)("hideHeader",t.hideHeader))},directives:[v.f,N.d,N.e,N.b,T.a],styles:[""]}),_i),tn=a("xXXn");function nn(e,t){if(1&e&&(g.Tb(0,"mat-option",13),g.Rc(1),g.Sb()),2&e){var i=t.$implicit;g.mc("value",i.value),g.Cb(1),g.Tc("",i.label," ")}}function ln(e,t){1&e&&(g.Tb(0,"mat-hint",14),g.Rc(1," Select Consumption Type"),g.Sb())}function an(e,t){if(1&e&&(g.Tb(0,"mat-option",13),g.Rc(1),g.Sb()),2&e){var i=t.$implicit;g.mc("value",i.value),g.Cb(1),g.Tc("",i.label," ")}}function on(e,t){1&e&&(g.Tb(0,"mat-hint",14),g.Rc(1,"Select Utility Type"),g.Sb())}function rn(e,t){1&e&&(g.Tb(0,"mat-label"),g.Rc(1,"Bill Period"),g.Sb())}function sn(e,t){1&e&&(g.Tb(0,"mat-label"),g.Rc(1,"Bill Period to compare"),g.Sb())}function cn(e,t){if(1&e&&(g.Tb(0,"mat-option",13),g.Rc(1),g.Sb()),2&e){var i=t.$implicit;g.mc("value",i.value),g.Cb(1),g.Tc("",i.label," ")}}function un(e,t){1&e&&(g.Tb(0,"mat-hint",14),g.Rc(1," Select Bill Period to compare"),g.Sb())}function dn(e,t){if(1&e&&(g.Tb(0,"mat-option",13),g.Rc(1),g.Sb()),2&e){var i=t.$implicit;g.mc("value",i.value),g.Cb(1),g.Tc("",i.label," ")}}function mn(e,t){1&e&&(g.Tb(0,"mat-hint",14),g.Rc(1," Select Bill Period To be compared with"),g.Sb())}function hn(e,t){if(1&e){var i=g.Ub();g.Tb(0,"mat-form-field",3),g.Tb(1,"mat-label"),g.Rc(2,"Bill Period To be compared with"),g.Sb(),g.Tb(3,"mat-select",21),g.bc("selectionChange",(function(e){return g.Ec(i),g.fc(2).onChangeToBillPeriod(e)})),g.Pc(4,dn,2,2,"mat-option",5),g.Sb(),g.Pc(5,mn,2,0,"mat-hint",6),g.Sb()}if(2&e){var n=g.fc(2);g.Cb(4),g.mc("ngForOf",n.billPeriods),g.Cb(1),g.mc("ngIf",!n.billPeriodForm.controls.toBillPeriodId.value||0==n.billPeriodForm.controls.toBillPeriodId.value)}}function bn(e,t){if(1&e){var i=g.Ub();g.Tb(0,"mat-form-field",3),g.Tb(1,"mat-label"),g.Rc(2,"Threshold [%]"),g.Sb(),g.Tb(3,"input",22),g.bc("ngModelChange",(function(e){return g.Ec(i),g.fc(2).percentageBillPeriod=e})),g.Sb(),g.Sb()}if(2&e){var n=g.fc(2);g.Cb(3),g.mc("ngModel",n.percentageBillPeriod)}}function fn(e,t){if(1&e){var i=g.Ub();g.Tb(0,"div"),g.Tb(1,"div",1),g.Tb(2,"form",0),g.Tb(3,"div",15),g.Tb(4,"div",2),g.Tb(5,"mat-form-field",3),g.Pc(6,rn,2,0,"mat-label",11),g.Pc(7,sn,2,0,"mat-label",11),g.Tb(8,"mat-select",16),g.bc("selectionChange",(function(e){return g.Ec(i),g.fc().onChangeFromBillPeriod(e)})),g.Pc(9,cn,2,2,"mat-option",5),g.Sb(),g.Pc(10,un,2,0,"mat-hint",6),g.Sb(),g.Pc(11,hn,6,2,"mat-form-field",17),g.Pc(12,bn,4,1,"mat-form-field",17),g.Tb(13,"div",3),g.Tb(14,"button",18),g.bc("click",(function(){return g.Ec(i),g.fc().onSearch("BillPeriod")})),g.Tb(15,"mat-icon"),g.Rc(16,"compare"),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Tb(17,"div",19),g.Tb(18,"div",15),g.Tb(19,"app-table-structure",20),g.bc("deleteRow",(function(e){return g.Ec(i),g.fc().onDeleteRow(e)})),g.Sb(),g.Sb(),g.Sb(),g.Sb()}if(2&e){var n=g.fc();g.Cb(2),g.mc("formGroup",n.billPeriodForm),g.Cb(4),g.mc("ngIf","Zero Consumption"===n.consumptionType),g.Cb(1),g.mc("ngIf","Zero Consumption"!==n.consumptionType),g.Cb(2),g.mc("ngForOf",n.billPeriods),g.Cb(1),g.mc("ngIf",!n.billPeriodForm.controls.fromBillPeriodId.value||0==n.billPeriodForm.controls.fromBillPeriodId.value),g.Cb(1),g.mc("ngIf","Zero Consumption"!==n.consumptionType),g.Cb(1),g.mc("ngIf","Zero Consumption"!==n.consumptionType),g.Cb(2),g.mc("disabled",n.disableBillPeriod),g.Cb(5),g.mc("visibleDeleteButton",!0)("tableData",n.consumptionAlerts)("columns",n.columns)("hideHeader",!0)}}function pn(e,t){1&e&&(g.Tb(0,"mat-hint",14),g.Rc(1,"Select Date to compare with"),g.Sb())}function gn(e,t){1&e&&(g.Tb(0,"mat-hint",14),g.Rc(1,"Select Average consumption From"),g.Sb())}function vn(e,t){1&e&&(g.Tb(0,"mat-hint",14),g.Rc(1,"Select Average consumption To"),g.Sb())}var yn=function(){return{standalone:!0}};function Cn(e,t){if(1&e){var i=g.Ub();g.Tb(0,"div",1),g.Tb(1,"div",2),g.Tb(2,"mat-form-field"),g.Tb(3,"mat-label"),g.Rc(4,"Date to compare with "),g.Sb(),g.Tb(5,"input",23),g.bc("click",(function(){return g.Ec(i),g.Ac(8).open()}))("ngModelChange",(function(e){return g.Ec(i),g.fc().fromDate=e}))("focus",(function(){return g.Ec(i),g.Ac(8).open()})),g.Sb(),g.Ob(6,"mat-datepicker-toggle",24),g.Ob(7,"mat-datepicker",null,25),g.Pc(9,pn,2,0,"mat-hint",6),g.Sb(),g.Tb(10,"mat-form-field"),g.Tb(11,"mat-label"),g.Rc(12,"Average consumption From"),g.Sb(),g.Tb(13,"input",26),g.bc("click",(function(){return g.Ec(i),g.Ac(16).open()}))("ngModelChange",(function(e){return g.Ec(i),g.fc().startDate=e}))("focus",(function(){return g.Ec(i),g.Ac(16).open()})),g.Sb(),g.Ob(14,"mat-datepicker-toggle",24),g.Ob(15,"mat-datepicker",null,27),g.Pc(17,gn,2,0,"mat-hint",6),g.Sb(),g.Tb(18,"mat-form-field"),g.Tb(19,"mat-label"),g.Rc(20,"Average consumption To"),g.Sb(),g.Tb(21,"input",28),g.bc("click",(function(){return g.Ec(i),g.Ac(24).open()}))("ngModelChange",(function(e){return g.Ec(i),g.fc().endDate=e}))("focus",(function(){return g.Ec(i),g.Ac(24).open()})),g.Sb(),g.Ob(22,"mat-datepicker-toggle",24),g.Ob(23,"mat-datepicker",null,29),g.Pc(25,vn,2,0,"mat-hint",6),g.Sb(),g.Tb(26,"mat-form-field",30),g.Tb(27,"mat-label"),g.Rc(28,"Threshold"),g.Sb(),g.Tb(29,"input",31),g.bc("ngModelChange",(function(e){return g.Ec(i),g.fc().percentageDatewise=e})),g.Sb(),g.Sb(),g.Tb(30,"button",18),g.bc("click",(function(){return g.Ec(i),g.fc().onSearch("DateWise")})),g.Tb(31,"mat-icon"),g.Rc(32,"compare"),g.Sb(),g.Sb(),g.Sb(),g.Sb()}if(2&e){var n=g.Ac(8),l=g.Ac(16),a=g.Ac(24),o=g.fc();g.Cb(5),g.mc("ngModel",o.fromDate)("matDatepicker",n)("ngModelOptions",g.qc(17,yn)),g.Cb(1),g.mc("for",n),g.Cb(3),g.mc("ngIf",!o.fromDate||""==o.fromDate),g.Cb(4),g.mc("ngModel",o.startDate)("matDatepicker",l)("ngModelOptions",g.qc(18,yn)),g.Cb(1),g.mc("for",l),g.Cb(3),g.mc("ngIf",!o.startDate||""==o.startDate),g.Cb(4),g.mc("ngModel",o.endDate)("matDatepicker",a)("ngModelOptions",g.qc(19,yn)),g.Cb(1),g.mc("for",a),g.Cb(3),g.mc("ngIf",!o.endDate||""==o.endDate),g.Cb(4),g.mc("ngModel",o.percentageDatewise),g.Cb(1),g.mc("disabled",!(o.formValidation(o.form)&&o.startDate&&o.endDate&&o.fromDate))}}var Sn,Tn,Pn=((Tn=function(){function e(t,i,n,a,o){l(this,e),this.snackbar=t,this.billSettlementService=i,this.dialog=n,this.cookieService=a,this.fb=o,this.billPeriods=[],this.utilityTypes=[],this.searchClicked=new g.o,this.saveClicked=new g.o,this.disableSave=new g.o,this.percentageDatewise=0,this.toBillPeriod="",this.fromBillPeriod="",this.consumptionType="",this.utilityType="",this.optionId="1",this.consumptionTypes=[{label:"Select",value:0},{label:"High Consumption",value:1},{label:"Low Consumption",value:2},{label:"Zero Consumption",value:3}],this.alertTypeToCompareCoulmnName="Alert Type",this.utilityTypeToCompareCoulmnName="Utility Type",this.billPeriodToCompareCoulmnName="Bill Period To Compare",this.toBeCompareWithCoulmnName="To Be Compared With",this.percentageDifferenceColumnName="Percentage Difference [%]",this.descriptionColumnName="Description",this.columns=[],this.consumptionAlerts=[],this.consumptionAlertRanges=[],this.filterConsumptionAlerts=[],this.consumptionAlertRange={},this.disableBillPeriod=!0,this.disableDatewise=!0}return o(e,[{key:"ngOnInit",value:function(){this.clientId=parseInt(this.cookieService.get("globalClientId")),this.createGridColumns(),this.form=this.fb.group({consumptionTypeId:[this.consumptionAlertRange.consumptionTypeId||0,s.y.required],utilityTypeId:[this.consumptionAlertRange.utilityTypeId||0,s.y.required]}),this.billPeriodForm=this.fb.group({fromBillPeriodId:[this.consumptionAlertRange.fromBillPeriodId||0,s.y.required],toBillPeriodId:[this.consumptionAlertRange.toBillPeriodId||0,s.y.required],percentageBillPeriod:[this.consumptionAlertRange.percentage||0]})}},{key:"onSearch",value:function(e){var t;this.enbaleValidators(e)?("BillPeriod"==e&&this.disableSave.emit(!1),this.manageParams="1"==this.optionId?{consumptionTypeId:this.form.controls.consumptionTypeId.value,consumptionType:this.consumptionType,utilityTypeId:this.form.controls.utilityTypeId.value,utilityType:this.utilityType,fromBillPeriodId:this.billPeriodForm.controls.fromBillPeriodId.value,toBillPeriodId:this.billPeriodForm.controls.toBillPeriodId.value,percentage:null!==(t=this.billPeriodForm.controls.percentageBillPeriod.value)&&void 0!==t?t:0}:{consumptionTypeId:this.form.controls.consumptionTypeId.value,consumptionType:this.consumptionType,utilityTypeId:this.form.controls.utilityTypeId.value,utilityType:this.utilityType,fromDate:""+(void 0===this.fromDate?"":L(this.fromDate).format("YYYY-MM-DD")),startDate:""+(void 0===this.startDate?"":L(this.startDate).format("YYYY-MM-DD")),endDate:""+(void 0===this.endDate?"":L(this.endDate).format("YYYY-MM-DD")),percentage:this.percentageDatewise},this.searchClicked.emit(this.manageParams)):"BillPeriod"==e&&this.disableSave.emit(!0)}},{key:"enbaleValidators",value:function(e){var t=!0;return"BillPeriod"==e?this.formValidation(this.form)&&this.formValidation(this.billPeriodForm)||(t=!1):this.formValidation(this.form)&&this.startDate&&this.endDate&&this.fromDate||(t=!1),t}},{key:"formValidation",value:function(e){var t=!0,i=e.controls;return Object.keys(i).forEach((function(e){!i[e].validator||i[e].value&&0!=i[e].value||(t=!1)})),t}},{key:"reset",value:function(){"1"==this.optionId?(this.fromDate=this.startDate=this.endDate="",this.disableDatewise=!0):(this.billPeriodForm.reset(),this.consumptionAlerts=[],this.disableDatewise=!0)}},{key:"createGridColumns",value:function(){this.columns=[{name:"Id",property:"id",visible:!1,isModelProperty:!1},{name:this.alertTypeToCompareCoulmnName,property:"consumptionType",visible:!0,isModelProperty:!0},{name:this.utilityTypeToCompareCoulmnName,property:"utilityType",visible:!0,isModelProperty:!0},{name:this.billPeriodToCompareCoulmnName,property:"fromBillPeriod",visible:!0,isModelProperty:!0},{name:this.toBeCompareWithCoulmnName,property:"toBillPeriod",visible:!0,isModelProperty:!0},{name:this.percentageDifferenceColumnName,property:"percentage",visible:!0,isModelProperty:!0},{name:this.descriptionColumnName,property:"description",visible:!0,isModelProperty:!0},{name:"Actions",property:"actions",visible:!0,isModelProperty:!1}]}},{key:"onChangeFromBillPeriod",value:function(e){this.fromBillPeriod=e.source.triggerValue,this.dropDownValidation()}},{key:"onChangeToBillPeriod",value:function(e){this.toBillPeriod=e.source.triggerValue,this.dropDownValidation()}},{key:"onChangeConsumptionType",value:function(e){this.consumptionType=e.source.triggerValue,"Zero Consumption"===this.consumptionType&&this.billPeriodForm.get("toBillPeriodId").clearValidators(),this.dropDownValidation()}},{key:"onChangeUtilityType",value:function(e){this.utilityType=e.source.triggerValue,this.dropDownValidation()}},{key:"dropDownValidation",value:function(){this.filter(),this.formValidation(this.form)&&this.formValidation(this.billPeriodForm)?(this.disableBillPeriod=!1,this.disableSave.emit(!1)):(this.disableBillPeriod=!0,this.disableSave.emit(!0))}},{key:"onSave",value:function(){this.saveClicked.emit()}},{key:"notificationMessage",value:function(e,t){this.snackbar.open(e,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[t]})}},{key:"optionChange",value:function(e){this.optionId=e.value,"2"===this.optionId&&this.disableSave.emit(!0),this.reset()}},{key:"filter",value:function(){var e=this;this.consumptionAlerts=this.filterConsumptionAlerts,this.consumptionAlerts&&this.consumptionAlerts.length&&(this.consumptionType&&(this.consumptionAlerts=this.consumptionAlerts.filter((function(t){return t.consumptionType==e.consumptionType}))),this.utilityType&&(this.consumptionAlerts=this.consumptionAlerts.filter((function(t){return t.utilityType==e.utilityType}))),this.fromBillPeriod&&(this.consumptionAlerts=this.consumptionAlerts.filter((function(t){return t.fromBillPeriod==e.fromBillPeriod}))),this.toBillPeriod&&(this.consumptionAlerts=this.consumptionAlerts.filter((function(t){return t.toBillPeriod==e.toBillPeriod}))))}},{key:"getConsumptionAlertRanges",value:function(){var e=this;this.consumptionAlerts=[],this.filterConsumptionAlerts=[];var t={clientId:this.clientId};t&&this.billSettlementService.getConsumptioSavedAlertDetails(t).subscribe((function(t){t&&t.length?e.consumptionAlerts=e.filterConsumptionAlerts=t:(e.consumptionAlerts=[],e.filterConsumptionAlerts=[])}))}},{key:"onDeleteRow",value:function(e){var t=this;this.dialog.open(tn.a,{data:{label:"Are you sure you want to Delete?",selected:!1}}).afterClosed().subscribe((function(i){i&&t.billSettlementService.deleteConsumptionAlert(e.id,e).subscribe({next:function(e){e?(t.getConsumptionAlertRanges(),t.notificationMessage("Consumption Alert deleted successfully.","green-snackbar")):t.notificationMessage("Consumption Alert deletion failed.","red-snackbar")},error:function(e){t.notificationMessage("Consumption Alert deletion failed.","red-snackbar")}})}))}},{key:"consumptionRangeDatas",set:function(e){var t=[];e&&e.length&&(e.forEach((function(e){var i="";"High Consumption"===e.consumptionType&&(i="Threshold set for ".concat(e.consumptionType," for the ").concat(e.fromBillPeriod," bill period is ").concat(e.percentage,"% .Bill will be considered in failed state if consumption exceeds the ").concat(e.percentage,"%")),"Low Consumption"===e.consumptionType&&(i="Threshold set for ".concat(e.consumptionType," for the ").concat(e.fromBillPeriod," bill period is ").concat(e.percentage,"% .Bill will be considered in failed state if consumption is lower than the ").concat(e.percentage,"%")),"Zero Consumption"===e.consumptionType&&(i="Threshold set for ".concat(e.consumptionType," for the ").concat(e.fromBillPeriod," bill period is ").concat(e.percentage,"%")),t.push({id:e.id,fromBillPeriod:e.fromBillPeriod,toBillPeriod:e.toBillPeriod,consumptionType:e.consumptionType,utilityType:e.utilityType,percentage:e.percentage,description:i})})),this.filterConsumptionAlerts=this.consumptionAlerts=t)}}]),e}()).\u0275fac=function(e){return new(e||Tn)(g.Nb(B.b),g.Nb(M.a),g.Nb(v.b),g.Nb(w.a),g.Nb(s.f))},Tn.\u0275cmp=g.Hb({type:Tn,selectors:[["fury-bill-consumption-toolbar"]],inputs:{billPeriods:"billPeriods",utilityTypes:"utilityTypes",consumptionRangeDatas:"consumptionRangeDatas"},outputs:{searchClicked:"searchClicked",saveClicked:"saveClicked",disableSave:"disableSave"},decls:24,vars:8,consts:[[3,"formGroup"],[1,"person"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","20px"],["fxFlex",""],["id","consumptionTypeId","name","consumptionTypeId","formControlName","consumptionTypeId",3,"selectionChange"],[3,"value",4,"ngFor","ngForOf"],["class","small",4,"ngIf"],["id","utilityTypeId","name","utilityTypeId","formControlName","utilityTypeId",3,"selectionChange"],["fxLayout","column","fxLayoutGap","12px",3,"value","change"],["value","1"],["value","2"],[4,"ngIf"],["class","person",4,"ngIf"],[3,"value"],[1,"small"],["fxLayout","column","fxLayout.gt-sm","column"],["id","fromBillPeriodId","name","fromBillPeriodId","formControlName","fromBillPeriodId",3,"selectionChange"],["fxFlex","",4,"ngIf"],["mat-icon-button","","matTooltip","Compare","aria-label","Example icon-button with menu icon",1,"example-icon",3,"disabled","click"],[1,"person","topPadding"],[3,"visibleDeleteButton","tableData","columns","hideHeader","deleteRow"],["id","toBillPeriodId","name","toBillPeriodId","formControlName","toBillPeriodId",3,"selectionChange"],["type","number","id","percentageBillPeriod","name","percentageBillPeriod","formControlName","percentageBillPeriod","matInput","",3,"ngModel","ngModelChange"],["id","fromDate","name","fromDate","matInput","","readonly","",3,"ngModel","matDatepicker","ngModelOptions","click","ngModelChange","focus"],["matSuffix","",3,"for"],["formDatepickerRef1",""],["id","startDate","name","startDate","matInput","","readonly","",3,"ngModel","matDatepicker","ngModelOptions","click","ngModelChange","focus"],["formDatepickerRef2",""],["id","endDate","name","endDate","matInput","","readonly","",3,"ngModel","matDatepicker","ngModelOptions","click","ngModelChange","focus"],["formDatepickerRef3",""],[2,"width","100px"],["type","text","id","percentageDatewise","name","percentageDatewise","matInput","",3,"ngModel","ngModelChange"]],template:function(e,t){1&e&&(g.Tb(0,"mat-dialog-content"),g.Tb(1,"form",0),g.Tb(2,"div",1),g.Tb(3,"div",2),g.Tb(4,"mat-form-field",3),g.Tb(5,"mat-label"),g.Rc(6,"Alert Type"),g.Sb(),g.Tb(7,"mat-select",4),g.bc("selectionChange",(function(e){return t.onChangeConsumptionType(e)})),g.Pc(8,nn,2,2,"mat-option",5),g.Sb(),g.Pc(9,ln,2,0,"mat-hint",6),g.Sb(),g.Tb(10,"mat-form-field",3),g.Tb(11,"mat-label"),g.Rc(12,"Utility Type"),g.Sb(),g.Tb(13,"mat-select",7),g.bc("selectionChange",(function(e){return t.onChangeUtilityType(e)})),g.Pc(14,an,2,2,"mat-option",5),g.Sb(),g.Pc(15,on,2,0,"mat-hint",6),g.Sb(),g.Tb(16,"div",3),g.Tb(17,"mat-radio-group",8),g.bc("change",(function(e){return t.optionChange(e)})),g.Tb(18,"mat-radio-button",9),g.Rc(19,"Compare based on Bill Period"),g.Sb(),g.Tb(20,"mat-radio-button",10),g.Rc(21," Compare based on Date range"),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Pc(22,fn,20,12,"div",11),g.Pc(23,Cn,33,20,"div",12),g.Sb()),2&e&&(g.Cb(1),g.mc("formGroup",t.form),g.Cb(7),g.mc("ngForOf",t.consumptionTypes),g.Cb(1),g.mc("ngIf",!t.form.controls.consumptionTypeId.value||0==t.form.controls.consumptionTypeId.value),g.Cb(5),g.mc("ngForOf",t.utilityTypes),g.Cb(1),g.mc("ngIf",!t.form.controls.utilityTypeId.value||0==t.form.controls.utilityTypeId.value),g.Cb(2),g.mc("value",t.optionId),g.Cb(5),g.mc("ngIf","1"==t.optionId),g.Cb(1),g.mc("ngIf","2"==t.optionId))},directives:[v.f,s.z,s.r,s.k,N.d,N.e,z.d,N.b,z.h,U.a,s.q,s.i,d.n,d.o,We.b,We.a,H.n,z.g,k.a,A.a,F.a,T.a,s.u,s.c,E.b,Y.b,s.t,Y.d,z.j,Y.a],styles:[".blank_row[_ngcontent-%COMP%]{height:16px!important}.small[_ngcontent-%COMP%]{color:red}.hidden[_ngcontent-%COMP%]{display:none}.topPadding[_ngcontent-%COMP%]{padding-top:40px}"]}),Tn),Dn=((Sn=function(){function e(t,i,n,a,o,r,s,c){var u;l(this,e),this.billService=t,this.billSettlementService=i,this.snackbar=n,this.decimalPipe=a,this.datePipe=o,this.clientSelectionService=r,this.cookieService=s,this.envService=c,this._gap=16,this.gap=this._gap+"px",this.col2="1 1 calc(50% - ".concat(this._gap/2,"px)"),this.col3="1 1 calc(33.3333% - ".concat(this._gap/1.5,"px)"),this.billPeriods=[{label:"Select",value:0}],this.utilityTypes=[],this.failedBills=[],this.consumptionAlerts=[],this.isBillPeriodEnabled=!1,this.roundFormat="",this.consumptionRoundOffFormat=Object(y.e)("ConsumptionRoundOff"),this.tableData=[],this.disableSaveButton=!0,this.isData=!1,this.roundFormat=null!==(u=Object(y.e)("RoundOff"))&&void 0!==u?u:c.roundOffFormat}return o(e,[{key:"ngOnInit",value:function(){this.clientSelectionService.setIsClientVisible(!0),this.clientId=parseInt(this.cookieService.get("globalClientId")),this.getBillPeriods(),this.getUtilities(),this.getConsumptionAlertRanges()}},{key:"disable",value:function(e){this.disableSaveButton=e}},{key:"getConsumptionAlertRanges",value:function(){var e=this;this.consumptionAlerts=[];var t={clientId:this.clientId};t&&this.billSettlementService.getConsumptioSavedAlertDetails(t).subscribe((function(t){e.consumptionAlerts=t&&t.length?t:[]}))}},{key:"onSearch",value:function(e){var t=this;e?(this.manageParams=e,this.manageParams.clientId=this.clientId,this.billConsumptionDetailsComponent.failedBills=[],this.isData=!1,this.message="",this.consumptionRoundOffFormat=Object(y.e)("ConsumptionRoundOff",parseInt(e.utilityTypeId)),this.consumptionRoundOffFormat&&""!=this.consumptionRoundOffFormat&&(this.consumptiondecimalPlaces=parseInt(this.consumptionRoundOffFormat.substring(this.consumptionRoundOffFormat.indexOf("-")+1,this.consumptionRoundOffFormat.length))),this.billSettlementService.getConumptionAlertDetails(e).subscribe((function(i){if(i&&i.length){var n=0;i.sort((function(e,t){return e.unitNumber.localeCompare(t.unitNumber)})),i.forEach((function(e){e.id=n+=1,e.consumption=Number(t.decimalPipe.transform(e.consumption,t.consumptionRoundOffFormat.toString()).replace(",","")),e.consumptionLocal=e.consumption.toFixed(t.consumptiondecimalPlaces)+" "+e.consumptionUnit,e.consumptionDifference=Number(t.decimalPipe.transform(e.consumptionDifference,t.consumptionRoundOffFormat.toString()).replace(",","")),e.consumptionDifferenceLocal=e.consumptionDifference.toFixed(t.consumptiondecimalPlaces)+" "+e.consumptionUnit,e.averageConsumption=Number(t.decimalPipe.transform(e.averageConsumption,t.consumptionRoundOffFormat.toString()).replace(",","")),e.averageConsumptionLocal=e.averageConsumption.toFixed(t.consumptiondecimalPlaces)+" "+e.consumptionUnit,e.consumptionDifferencePercentageLocal=e.consumptionDifferencePercentage.toFixed(t.consumptiondecimalPlaces)})),t.billConsumptionDetailsComponent.failedBills=i,t.isData=!0,t.message=e.consumptionType+" of "+e.utilityType+" in comparison with "+e.percentage+"% buffer"}else t.billConsumptionDetailsComponent.failedBills=[],t.isData=!1}))):this.notificationMessage("Invalid Parameters.","yellow-snackbar")}},{key:"toggleBillPeriodEnabled",value:function(e){this.isBillPeriodEnabled=e.checked||!1}},{key:"getBillPeriods",value:function(){var e=this;this.billPeriods=[{label:"Select",value:0,fromDate:"",ToDate:""}],this.billService.getBillPeriods(this.clientId).subscribe((function(t){t.forEach((function(t){e.billPeriods.push({label:t.periodDescription,value:t.id,fromDate:t.periodStart,toDate:t.periodEnd})}))}))}},{key:"getUtilities",value:function(){var e=this;this.utilityTypes=[{label:"Select",value:0}],this.billService.getUtilities(this.clientId).subscribe((function(t){t&&t.forEach((function(t){e.utilityTypes.push({label:t.description,value:t.id})}))}))}},{key:"onReset",value:function(){this.billConsumptionToolbarComponent.form.reset(),this.billConsumptionToolbarComponent.billPeriodForm.reset(),this.billConsumptionDetailsComponent.failedBills=[],this.billConsumptionToolbarComponent.form.controls.consumptionTypeId.setValue(0),this.billConsumptionToolbarComponent.form.controls.utilityTypeId.setValue(0),this.billConsumptionToolbarComponent.billPeriodForm.controls.fromBillPeriodId.setValue(0),this.billConsumptionToolbarComponent.billPeriodForm.controls.toBillPeriodId.setValue(0),this.getConsumptionAlertRanges()}},{key:"onSave",value:function(){var e=this,t=this.billConsumptionToolbarComponent.form.controls.consumptionTypeId.value,i=this.billConsumptionToolbarComponent.form.controls.utilityTypeId.value,n=0,l=0,a=0,o=null,r=null,s=null;if("1"==this.billConsumptionToolbarComponent.optionId?(n=this.billConsumptionToolbarComponent.billPeriodForm.controls.fromBillPeriodId.value,l=this.billConsumptionToolbarComponent.billPeriodForm.controls.toBillPeriodId.value,a=this.billConsumptionToolbarComponent.billPeriodForm.controls.percentageBillPeriod.value):(o=new Date(this.datePipe.transform(this.billConsumptionToolbarComponent.fromDate,"yyyy-MM-dd")),r=new Date(this.datePipe.transform(this.billConsumptionToolbarComponent.startDate,"yyyy-MM-dd")),s=new Date(this.datePipe.transform(this.billConsumptionToolbarComponent.endDate,"yyyy-MM-dd")),a=this.billConsumptionToolbarComponent.percentageDatewise),t&&i){var c={consumptionTypeId:Number(t),utilityTypeId:Number(i),fromBillPeriodId:Number(n),toBillPeriodId:Number(l),fromDate:o,startDate:r,endDate:s,percentage:Number(null!=a?a:0),clientId:Number(this.clientId)};this.billSettlementService.saveConsumptionRange(c).subscribe({next:function(t){t?(e.notificationMessage("Consumption range saved successfully","green-snackbar"),e.onReset()):e.notificationMessage("Consumption range save failed","red-snackbar")},error:function(t){e.notificationMessage("Consumption range save failed","red-snackbar")}})}}},{key:"notificationMessage",value:function(e,t){this.snackbar.open(e,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[t]})}},{key:"onPrintSummary",value:function(){this.billConsumptionDetailsComponent.failedBills.length>0&&this.downloadSummary(this.billConsumptionDetailsComponent.failedBills)}},{key:"downloadSummary",value:function(e){for(var t=[],i=[],n=0;n<e.length;n++)t.push(e[n].unitNumber),t.push(e[n].consumptionLocal),t.push(e[n].averageConsumptionLocal),t.push(e[n].consumptionDifferenceLocal),t.push(e[n].consumptionDifferencePercentageLocal),i.push(t),t=[];this.getSummaryReport(e,["Unit Number","First Consumption","Second Consumption","Difference","Difference %"],i,"Consumption Alert Report")}},{key:"getSummaryReport",value:function(e,t,i,n){var l=new Image;l.src="assets/img/logo.png";var a=new Fe.default({orientation:"portrait",unit:"pt",format:"letter"});a.rect(5,5,a.internal.pageSize.width-10,a.internal.pageSize.height-10,"S"),a.setFontSize(30),a.addImage(l,"png",5,5,190,l.height),a.setTextColor(25,118,210),a.setFontSize(9),a.setFont("Cambria"),a.text("PO Box 127404",260,20),a.text("Office 201, Al Zarouni Business Centre",260,30),a.text("Al Barsha 1, Dubai, UAE",260,40),a.setTextColor(0,0,0),a.text("Phone:800 Logic (56442)",460,20),a.text("Email: ",460,30),a.setTextColor(25,118,210),a.text("enquiry@logicutilities.com",485,30),a.setTextColor(0,0,0),a.text("Web: ",460,40),a.setTextColor(25,118,210),a.text("www.logicutilities.com",485,40),a.setTextColor(0,0,0),a.setFontSize(12),a.setTextColor(25,118,210),a.text("Logic Utilities District Cooling Services LLC",10,70),a.text("TRN: 100567483100003",10,90),a.setTextColor(0,0,0),a.setFontSize(14),a.text("Consumption Alert Report for "+this.message,50,120),a.setFontSize(9),Number(a.autoTable.previous.finalY),a.autoTable(t,i,{startX:10,startY:140,didDrawPage:function(e){var t="Page "+e.pageCount;"function"==typeof a.putTotalPages&&(t+=" of 1"),a.setFontSize(9);var i=a.internal.pageSize.height||a.internal.pageSize.getHeight();a.text(t,e.settings.margin.left,i-10)},styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:280,left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:110,halign:"center"},1:{cellWidth:110,halign:"center"},2:{cellWidth:110,halign:"center"},3:{cellWidth:110,halign:"center"},4:{cellWidth:110,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]}});var o=a.output("blob");window.open(URL.createObjectURL(o))}},{key:"getJsonData",value:function(){var e=this;this.tableData=[],null!=this.billConsumptionDetailsComponent.failedBills&&this.billConsumptionDetailsComponent.failedBills.forEach((function(t){e.tableData.push({UnitNumber:t.unitNumber,Consumption:t.consumptionLocal,UnitAverage:t.averageConsumptionLocal,Difference:t.consumptionDifferenceLocal,DifferencePercentage:t.consumptionDifferencePercentageLocal})}))}},{key:"onExport",value:function(){if(this.billConsumptionDetailsComponent.failedBills&&this.billConsumptionDetailsComponent.failedBills.length>0){if(this.getJsonData(),null!=this.tableData){var e=jt.utils.json_to_sheet(this.tableData),t=jt.utils.book_new();jt.utils.book_append_sheet(t,e,"Sheet1"),jt.writeFile(t,"Consumption Alert Report.xlsx")}}else this.notificationMessage("No Data to Export","yellow-snackbar")}}]),e}()).\u0275fac=function(e){return new(e||Sn)(g.Nb(b.a),g.Nb(M.a),g.Nb(B.b),g.Nb(d.g),g.Nb(d.f),g.Nb(Z.a),g.Nb(w.a),g.Nb(C.a))},Sn.\u0275cmp=g.Hb({type:Sn,selectors:[["fury-bill-consumption"]],viewQuery:function(e,t){var i;1&e&&(g.Jc(en,!0),g.Jc(Pn,!0)),2&e&&(g.zc(i=g.cc())&&(t.billConsumptionDetailsComponent=i.first),g.zc(i=g.cc())&&(t.billConsumptionToolbarComponent=i.first))},decls:28,vars:10,consts:[["mode","card",2,"margin-top","20px"],["fxLayout","column"],["color","primary",1,"position-fixed"],["src","assets/img/fav-icon.png",1,"img-style"],[1,"toolbar-spacer"],[1,"fury-flex-form-field"],["matTooltip","Reset","mat-icon-button","","aria-label","Example icon-button with menu icon",1,"example-icon",3,"click"],["matTooltip","Save","mat-icon-button","","aria-label","Example icon-button with menu icon",1,"example-icon",3,"disabled","click"],["matTooltip","Print","mat-icon-button","","aria-label","Example icon-button with menu icon",1,"example-icon",3,"disabled","click"],["matTooltip","Export","mat-icon-button","","aria-label","Example icon-button with menu icon",1,"example-icon",3,"click"],["fxFlex","noshrink","fxLayout","column","fxLayout.gt-sm","row","fxLayoutAlign.gt-sm","start stretch",3,"fxLayoutGap"],["fxFlex","grow",1,"basic-forms","route-animations-elements",3,"fxFlex.gt-sm"],["fxLayout","column",1,"result"],[3,"billPeriods","utilityTypes","consumptionRangeDatas","disableSave","searchClicked"],["fxLayout","column",1,"result","padding-top"],[3,"dataSource","hideHeader"]],template:function(e,t){1&e&&(g.Tb(0,"fury-page-layout",0),g.Tb(1,"fury-page-layout-content",1),g.Tb(2,"mat-toolbar",2),g.Ob(3,"img",3),g.Tb(4,"span"),g.Rc(5,"Consumption Alert"),g.Sb(),g.Ob(6,"span",4),g.Tb(7,"div",5),g.Tb(8,"button",6),g.bc("click",(function(){return t.onReset()})),g.Tb(9,"mat-icon"),g.Rc(10,"refresh"),g.Sb(),g.Sb(),g.Tb(11,"button",7),g.bc("click",(function(){return t.onSave()})),g.Tb(12,"mat-icon"),g.Rc(13,"save"),g.Sb(),g.Sb(),g.Tb(14,"button",8),g.bc("click",(function(){return t.onPrintSummary()})),g.Tb(15,"mat-icon"),g.Rc(16,"print"),g.Sb(),g.Sb(),g.Tb(17,"button",9),g.bc("click",(function(){return t.onExport()})),g.Tb(18,"mat-icon"),g.Rc(19,"import_export"),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Tb(20,"div",10),g.Tb(21,"fury-card",11),g.Ob(22,"fury-card-header"),g.Tb(23,"fury-card-content",1),g.Tb(24,"div",12),g.Tb(25,"fury-bill-consumption-toolbar",13),g.bc("disableSave",(function(e){return t.disable(e)}))("searchClicked",(function(e){return t.onSearch(e)})),g.Sb(),g.Sb(),g.Tb(26,"div",14),g.Ob(27,"fury-bill-consumption-details",15),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb()),2&e&&(g.Cb(11),g.mc("disabled",0==t.isData&&t.disableSaveButton),g.Cb(3),g.mc("disabled",0==t.isData),g.Cb(6),g.mc("fxLayoutGap",t.gap),g.Cb(1),g.mc("fxFlex.gt-sm",t.col2)("@fadeInUp",void 0),g.Cb(4),g.mc("billPeriods",t.billPeriods)("utilityTypes",t.utilityTypes)("consumptionRangeDatas",t.consumptionAlerts),g.Cb(2),g.mc("dataSource",t.failedBills)("hideHeader",!1))},directives:[te.a,ie.a,N.d,ne.a,k.a,A.a,F.a,N.b,N.c,N.e,S.a,S.d,S.c,Pn,en],styles:[".toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.img-style[_ngcontent-%COMP%]{width:32px}.position-fixed[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;top:0;z-index:5}"],data:{animation:[p.a,f.a]}}),Sn),wn=a("Ektq");function Nn(e,t){if(1&e&&(g.Tb(0,"mat-option",15),g.Rc(1),g.Sb()),2&e){var i=t.$implicit;g.mc("value",i.value),g.Cb(1),g.Tc("",i.label," ")}}function xn(e,t){if(1&e&&(g.Tb(0,"mat-option",15),g.Rc(1),g.Sb()),2&e){var i=t.$implicit;g.mc("value",i.value),g.Cb(1),g.Tc("",i.label," ")}}var kn,An,Fn=((An=function(){function e(t,i,n,a,o,r){l(this,e),this.data=t,this.billSettlementService=i,this.snackbar=n,this.masterService=a,this.variablePayService=o,this.dialogRef=r,this.consumption="",this.accountHeadId=0,this.utilityTypeId=0,this.meterId=0,this.accountHeads=[{label:"Select",value:0}],this.utilityTypes=[{label:"Select",value:0}],this.meterNumbers=[{label:"Select",value:0}]}return o(e,[{key:"ngOnInit",value:function(){this.getUtilityTypes()}},{key:"onSave",value:function(){var e=this;if(this.consumption&&this.utilityTypeId){var t=[],i={utilityTypeId:this.utilityTypeId,amount:Number(this.consumption),billPeriodId:this.data.billPeriodId,tenantId:this.data.ownerId,unitId:this.data.unitId,clientId:this.data.clientId,meterId:this.meterId,isDeduction:!1};t.push(i),this.variablePayService.createOtherTypeConsumptionVariablePay(t,"manual").subscribe({next:function(t){t.isSuccess?e.onSaveOtherTypeConsumptionBills():e.notificationMessage(t.message?t.message:"No consumption to save","red-snackbar")},error:function(t){e.notificationMessage("Manual consumption save failed","red-snackbar")}})}}},{key:"getUtilityTypes",value:function(){var e=this;this.utilityTypes=[{label:"Select",value:0}],this.masterService.getSystemMasterdata(16,0).subscribe((function(t){if(t){var i=e.data.bills.filter((function(e){return 1==e.isFailed}));i&&i.length&&i.forEach((function(i){var n=t.find((function(e){return e.id===i.utilityTypeId}));if(n){var l=e.utilityTypes.find((function(e){return e.value==n.id}));l?l.subListItems.push({description:i.deviceName,id:i.meterId}):e.utilityTypes.push({label:n.description,value:n.id,subListItems:[{description:i.deviceName,id:i.meterId}]})}}))}}))}},{key:"notificationMessage",value:function(e,t){this.snackbar.open(e,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[t]})}},{key:"onUtilityChange",value:function(e){var t=this;if(this.utilityTypeId=e,this.meterNumbers=[{label:"Select",value:0}],this.utilityTypeId){var i=this.utilityTypes.find((function(e){return e.value==t.utilityTypeId}));i&&i.subListItems.forEach((function(e){t.meterNumbers.push({label:e.description,value:e.id})}))}}},{key:"onAccountHeadChange",value:function(e){var t,i;this.accountHeadId=null!==(i=null===(t=null==e?void 0:e.option)||void 0===t?void 0:t.value)&&void 0!==i?i:e}},{key:"onSaveOtherTypeConsumptionBills",value:function(){var e=this,t=[];this.data.billTypeId=y.a.ManualBill,t.push(this.data),this.billSettlementService.updateOtherTypeConsumption(t).subscribe({next:function(t){t&&e.dialogRef.close(!0)},error:function(t){e.notificationMessage("Manual consumption save failed","red-snackbar")}})}},{key:"close",value:function(){this.dialogRef.close(!1)}}]),e}()).\u0275fac=function(e){return new(e||An)(g.Nb(v.a),g.Nb(M.a),g.Nb(B.b),g.Nb(at.a),g.Nb(wn.a),g.Nb(v.h))},An.\u0275cmp=g.Hb({type:An,selectors:[["fury-manual-bill-consumption"]],decls:36,vars:6,consts:[["mat-dialog-title",""],["role","toolbar",1,"task-header"],[1,"fx-spacer"],["mat-icon-button","",3,"click"],["mat-list-icon",""],[1,"person"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","10px"],["fxFlex",""],["name","utilityTypeId","id","utilityTypeId","placeholder","Utility Type",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["name","meterId","id","meterId","placeholder","Meter Number",3,"ngModel","ngModelChange"],["color","primary",1,"result"],["type","text","id","consumption","name","consumption","matInput","",3,"ngModel","ngModelChange"],[1,"fury-flex-form-field"],["mat-icon-button","","aria-label","Example icon-button with menu icon",1,"example-icon",3,"disabled","click"],[3,"value"]],template:function(e,t){1&e&&(g.Tb(0,"h4",0),g.Tb(1,"mat-toolbar",1),g.Tb(2,"span"),g.Rc(3,"Manual Bill"),g.Sb(),g.Ob(4,"span",2),g.Tb(5,"button",3),g.bc("click",(function(){return t.close()})),g.Tb(6,"mat-icon",4),g.Rc(7,"close"),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Tb(8,"mat-dialog-content"),g.Tb(9,"div",5),g.Tb(10,"form"),g.Tb(11,"div",6),g.Tb(12,"mat-form-field",7),g.Tb(13,"mat-label"),g.Rc(14,"Utitlity Type"),g.Sb(),g.Tb(15,"mat-select",8),g.bc("ngModelChange",(function(e){return t.utilityTypeId=e}))("ngModelChange",(function(e){return t.onUtilityChange(e)})),g.Pc(16,Nn,2,2,"mat-option",9),g.Sb(),g.Tb(17,"mat-hint"),g.Rc(18,"Please select an utility Type"),g.Sb(),g.Sb(),g.Sb(),g.Tb(19,"div",6),g.Tb(20,"mat-form-field",7),g.Tb(21,"mat-label"),g.Rc(22,"Meter Number"),g.Sb(),g.Tb(23,"mat-select",10),g.bc("ngModelChange",(function(e){return t.meterId=e})),g.Pc(24,xn,2,2,"mat-option",9),g.Sb(),g.Tb(25,"mat-hint"),g.Rc(26,"Please select an Meter Number"),g.Sb(),g.Sb(),g.Sb(),g.Tb(27,"div",6),g.Tb(28,"mat-form-field",11),g.Tb(29,"mat-label"),g.Rc(30,"Consumption"),g.Sb(),g.Tb(31,"input",12),g.bc("ngModelChange",(function(e){return t.consumption=e})),g.Sb(),g.Sb(),g.Tb(32,"div",13),g.Tb(33,"button",14),g.bc("click",(function(){return t.onSave()})),g.Tb(34,"mat-icon"),g.Rc(35,"save"),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb()),2&e&&(g.Cb(15),g.mc("ngModel",t.utilityTypeId),g.Cb(1),g.mc("ngForOf",t.utilityTypes),g.Cb(7),g.mc("ngModel",t.meterId),g.Cb(1),g.mc("ngForOf",t.meterNumbers),g.Cb(7),g.mc("ngModel",t.consumption),g.Cb(2),g.mc("disabled",!t.meterId||!t.utilityTypeId||!t.consumption))},directives:[v.i,ne.a,k.a,F.a,nt.c,v.f,s.z,s.r,s.s,N.d,N.e,z.d,N.b,z.h,U.a,s.q,s.t,d.n,z.g,E.b,s.c,H.n],styles:[".task-header[_ngcontent-%COMP%]{background-color:transparent;padding:0 5px;height:20px}.fx-spacer[_ngcontent-%COMP%]{flex:1 1 auto}"]}),An),Rn=((kn=function(){function e(){l(this,e),this.forceVerifyClicked=new g.o,this.averageConsumptionClicked=new g.o}return o(e,[{key:"ngOnInit",value:function(){}},{key:"onForceVerify",value:function(){this.forceVerifyClicked.emit()}},{key:"onAverageConsumption",value:function(){this.averageConsumptionClicked.emit()}}]),e}()).\u0275fac=function(e){return new(e||kn)},kn.\u0275cmp=g.Hb({type:kn,selectors:[["fury-failed-bills-footer-toolbar"]],outputs:{forceVerifyClicked:"forceVerifyClicked",averageConsumptionClicked:"averageConsumptionClicked"},decls:9,vars:0,consts:[[1,"person"],["matTooltip","Force Generate","mat-icon-button","","aria-label","Example icon-button with menu icon",1,"example-icon",3,"click"],["matTooltip","Average Conumption Generate","mat-icon-button","","aria-label","Example icon-button with menu icon",1,"example-icon",3,"click"]],template:function(e,t){1&e&&(g.Tb(0,"mat-dialog-content"),g.Tb(1,"div",0),g.Tb(2,"form"),g.Tb(3,"button",1),g.bc("click",(function(){return t.onForceVerify()})),g.Tb(4,"mat-icon"),g.Rc(5,"launch"),g.Sb(),g.Sb(),g.Tb(6,"button",2),g.bc("click",(function(){return t.onAverageConsumption()})),g.Tb(7,"mat-icon"),g.Rc(8,"save"),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb())},directives:[v.f,s.z,s.r,s.s,k.a,A.a,F.a],styles:[""]}),kn);function In(e,t){if(1&e&&(g.Tb(0,"mat-option",13),g.Rc(1),g.Sb()),2&e){var i=t.$implicit;g.mc("value",i.value),g.Cb(1),g.Tc("",i.label," ")}}var On,Wn,Mn=((Wn=function(){function e(t,i){l(this,e),this.snackbar=t,this.date=i,this.billPeriods=[],this.searchClicked=new g.o,this.manageParams={},this.tenantId=0,this.fromDate="",this.toDate="",this.unitNumber="",this.billPeriodId=0}return o(e,[{key:"ngOnInit",value:function(){}},{key:"onSearch",value:function(){this.fromDate||this.toDate||this.billPeriodId?(this.manageParams={fromDate:""+(""==this.fromDate?"":L(this.fromDate).format("YYYY-MM-DD")),toDate:""+(""==this.toDate?"":L(this.toDate).format("YYYY-MM-DD")),billPeriodId:""+this.billPeriodId,unitNumber:this.unitNumber,isFine:!1,isPenalty:!1},this.searchClicked.emit(this.manageParams)):this.snackbar.open("Invalid search parameters",null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:["yellow-snackbar"]})}},{key:"onChangeBillPeriod",value:function(e){this.billPeriodId=e}}]),e}()).\u0275fac=function(e){return new(e||Wn)(g.Nb(B.b),g.Nb(d.f))},Wn.\u0275cmp=g.Hb({type:Wn,selectors:[["fury-failed-bills-toolbar"]],inputs:{billPeriods:"billPeriods"},outputs:{searchClicked:"searchClicked"},decls:33,vars:9,consts:[[1,"person"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","8px"],["color","primary",1,"result"],["id","fromDate","name","fromDate","matInput","","readonly","",3,"ngModel","matDatepicker","click","ngModelChange","focus"],["matSuffix","",3,"for"],["formDatepickerRef1",""],["id","toDate","name","toDate","matInput","","readonly","",3,"ngModel","matDatepicker","click","ngModelChange","focus"],["formDatepickerRef2",""],["type","text","id","unitNumber","name","unitNumber","matInput","",3,"ngModel","ngModelChange"],["id","billPeriod","name","billPeriod",3,"value","selectionChange","valueChange"],[3,"value",4,"ngFor","ngForOf"],[1,"fury-flex-form-field"],["mat-icon-button","","aria-label","Example icon-button with menu icon",1,"example-icon",3,"click"],[3,"value"]],template:function(e,t){if(1&e){var i=g.Ub();g.Tb(0,"mat-dialog-content"),g.Tb(1,"div",0),g.Tb(2,"form"),g.Tb(3,"div",1),g.Tb(4,"mat-form-field",2),g.Tb(5,"mat-label"),g.Rc(6,"From Date"),g.Sb(),g.Tb(7,"input",3),g.bc("click",(function(){return g.Ec(i),g.Ac(10).open()}))("ngModelChange",(function(e){return t.fromDate=e}))("focus",(function(){return g.Ec(i),g.Ac(10).open()})),g.Sb(),g.Ob(8,"mat-datepicker-toggle",4),g.Ob(9,"mat-datepicker",null,5),g.Sb(),g.Tb(11,"mat-form-field",2),g.Tb(12,"mat-label"),g.Rc(13,"To Date"),g.Sb(),g.Tb(14,"input",6),g.bc("click",(function(){return g.Ec(i),g.Ac(17).open()}))("ngModelChange",(function(e){return t.toDate=e}))("focus",(function(){return g.Ec(i),g.Ac(17).open()})),g.Sb(),g.Ob(15,"mat-datepicker-toggle",4),g.Ob(16,"mat-datepicker",null,7),g.Sb(),g.Tb(18,"mat-form-field",2),g.Tb(19,"mat-label"),g.Rc(20,"Unit Number"),g.Sb(),g.Tb(21,"input",8),g.bc("ngModelChange",(function(e){return t.unitNumber=e})),g.Sb(),g.Sb(),g.Tb(22,"mat-form-field",2),g.Tb(23,"mat-label"),g.Rc(24,"Bill Period"),g.Sb(),g.Tb(25,"mat-select",9),g.bc("selectionChange",(function(e){return t.onChangeBillPeriod(e.value)}))("valueChange",(function(e){return t.billPeriodId=e})),g.Pc(26,In,2,2,"mat-option",10),g.Sb(),g.Tb(27,"mat-hint"),g.Rc(28,"Please select a Bill period"),g.Sb(),g.Sb(),g.Tb(29,"div",11),g.Tb(30,"button",12),g.bc("click",(function(){return t.onSearch()})),g.Tb(31,"mat-icon"),g.Rc(32,"search"),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb()}if(2&e){var n=g.Ac(10),l=g.Ac(17);g.Cb(7),g.mc("ngModel",t.fromDate)("matDatepicker",n),g.Cb(1),g.mc("for",n),g.Cb(6),g.mc("ngModel",t.toDate)("matDatepicker",l),g.Cb(1),g.mc("for",l),g.Cb(6),g.mc("ngModel",t.unitNumber),g.Cb(4),g.mc("value",t.billPeriodId),g.Cb(1),g.mc("ngForOf",t.billPeriods)}},directives:[v.f,s.z,s.r,s.s,N.d,N.e,z.d,z.h,E.b,s.c,Y.b,s.q,s.t,Y.d,z.j,Y.a,U.a,d.n,z.g,k.a,F.a,H.n],styles:[""]}),Wn),Ln=((On=function(){function e(t,i,n,a,o,r,s,c,u,d,m){var h,b,f;l(this,e),this.billService=t,this.billSettlementService=i,this.variablePayService=n,this.date=a,this.currencyPipe=o,this.decimalPipe=r,this.dialog=s,this.snackbar=c,this.clientSelectionService=u,this.cookieService=d,this.envService=m,this._gap=16,this.gap=this._gap+"px",this.col2="1 1 calc(50% - ".concat(this._gap/2,"px)"),this.col3="1 1 calc(33.3333% - ".concat(this._gap/1.5,"px)"),this.billPeriods=[],this.selectedRows=[],this.columns=[],this.innerColumns=[],this.columnNames=[],this.visibleButtons=[],this.billMasterDetails=[],this.manageParams={},this.billAmount="",this.receivedAmount="",this.buttonName="Manual Bill",this.billNumberConsumptionColumnName="Bill No",this.buildingColumnName="Building",this.unitNumberColumnName="Unit Number",this.smsColumnName="SMS",this.emailColumnName="Email",this.watsappColumnName="Watsapp",this.consumptionRoundOffFormat=Object(y.e)("ConsumptionRoundOff"),this.dateFormat="",this.currency="",this.roundFormat="",this.billNumberColumnName="Bill Number",this.accountNumberColumnName="Account Number",this.billDateColumnName="BillDate",this.tenantNameColumnName="Tenant Name",this.entityTypeColumnName="Owner/Tenant",this.unitColumnName="Unit",this.fromDateColumnName="From Date",this.toDateColumnName="To Date",this.dueDateColumnName="Due Date",this.billAmountColumnName="Bill Amount",this.paidColumnName="Paid",this.failedReasonColumnName="Failed Reason",this.cancelColumnName="Cancel",this.utilityTypeCoulmnNmae="Utility Type",this.meterNumberCoulmnNmae="Meter Number",this.previousReadingColumnName="Previous",this.presentReadingColumnName="Present",this.currentConsumptionColumnName="Cur-Consumption",this.dateFormat=null!==(h=Object(y.e)("DateFormat"))&&void 0!==h?h:m.dateFormat,this.currency=null!==(b=Object(y.e)("Currency"))&&void 0!==b?b:m.currencyFormat,this.roundFormat=null!==(f=Object(y.e)("RoundOff"))&&void 0!==f?f:m.roundOffFormat}return o(e,[{key:"ngOnInit",value:function(){this.clientSelectionService.setIsClientVisible(!0),this.clientId=parseInt(this.cookieService.get("globalClientId")),this.getBillPeriods(),this.createColumnNames(),this.createGridColumns(),this.createInnerGridColumns(),this.addVisibleButtons()}},{key:"createGridColumns",value:function(){this.columns=["select","accountNumber","billNumber","ownerName","entityType","unitNumber","fromDateLocal","toDateLocal","dueDateLocal","billAmountLocal","paidLocal","reasonForFailed","button","action"]}},{key:"createInnerGridColumns",value:function(){this.innerColumns=["utilityType","deviceName","previousReadingLocal","presentReadingLocal","consumptionLocal","billAmountLocal"]}},{key:"addVisibleButtons",value:function(){this.visibleButtons=[{property:"modify"},{property:"print"}]}},{key:"createColumnNames",value:function(){this.columnNames=[{name:this.billNumberColumnName,property:"billNumber"},{name:this.accountNumberColumnName,property:"accountNumber"},{name:this.billDateColumnName,property:"billDate"},{name:this.tenantNameColumnName,property:"ownerName"},{name:this.entityTypeColumnName,property:"entityType"},{name:this.unitColumnName,property:"unitNumber"},{name:this.fromDateColumnName,property:"fromDateLocal"},{name:this.toDateColumnName,property:"toDateLocal"},{name:this.dueDateColumnName,property:"dueDateLocal"},{name:this.billAmountColumnName,property:"billAmountLocal",columnAlign:{"text-align":"right"}},{name:this.paidColumnName,property:"paidLocal",columnAlign:{"text-align":"right"}},{name:this.failedReasonColumnName,property:"reasonForFailed"},{name:this.utilityTypeCoulmnNmae,property:"utilityType"},{name:this.meterNumberCoulmnNmae,property:"deviceName"},{name:this.previousReadingColumnName,property:"previousReadingLocal"},{name:this.presentReadingColumnName,property:"presentReadingLocal"},{name:this.currentConsumptionColumnName,property:"consumptionLocal"},{name:this.billAmountColumnName,property:"amountLocal",columnAlign:{"text-align":"right"}}]}},{key:"onGetBillsHistory",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.manageParams=e,this.billMasterDetails=[],this.billAmount="",this.receivedAmount="";var n=0,l=0;e.fromDate=""===e.fromDate?"":L(e.fromDate).format("YYYY-MM-DD"),e.toDate=""===e.toDate?"":L(e.toDate).format("YYYY-MM-DD"),e.clientId=this.clientId,this.billService.getBillHistory(e).subscribe((function(e){if(e){var a=e.filter((function(e){return!0===e.isBillFailed}));if(t.dateFormat=Object(y.e)("DateFormat"),t.roundFormat=Object(y.e)("RoundOff"),t.currency=Object(y.e)("Currency"),a.forEach((function(e){e.billDateLocal=t.date.transform(e.billDate.toString(),t.dateFormat.toString()),e.fromDateLocal=t.date.transform(e.fromDate.toString(),t.dateFormat.toString()),e.toDateLocal=t.date.transform(e.toDate.toString(),t.dateFormat.toString()),e.dueDateLocal=t.date.transform(e.toDate.toString(),t.dateFormat.toString()),e.billAmountLocal=t.currencyPipe.transform(e.billAmount,t.currency.toString(),!0,t.roundFormat),e.paidLocal=t.currencyPipe.transform(e.paid,t.currency.toString(),!0,t.roundFormat),e.bills.forEach((function(e){t.consumptionRoundOffFormat=Object(y.e)("ConsumptionRoundOff",e.utilityTypeId),e.previousReadingLocal=t.decimalPipe.transform(e.previousReading,t.consumptionRoundOffFormat),e.presentReadingLocal=t.decimalPipe.transform(e.presentReading,t.consumptionRoundOffFormat),e.consumptionLocal=t.decimalPipe.transform(e.consumption,t.consumptionRoundOffFormat),e.billAmountLocal=t.currencyPipe.transform(e.billAmount,t.currency.toString(),!0,t.roundFormat)})),n+=e.billAmount,l+=e.paid})),t.billMasterDetails=a,t.billAmount=t.currencyPipe.transform(n,t.currency.toString(),!0,t.roundFormat),t.receivedAmount=t.currencyPipe.transform(l,t.currency.toString(),!0,t.roundFormat),null!=i){var o=t.billMasterDetails.find((function(e){return e.billNumber==i.billNumber}));null!=o?o.isBillFailed&&t.notificationMessage("Manual Bill save failed. Please check the consumption entered.","red-snackbar"):t.notificationMessage("Manual Bill saved successfully","green-snackbar")}}}))}},{key:"onSelectedRows",value:function(e){this.selectedRows=[],this.selectedRows=e}},{key:"getBillPeriods",value:function(){var e=this;this.billPeriods=[{label:"Select",value:0}],this.billService.getBillPeriods(this.clientId).subscribe((function(t){t.forEach((function(t){e.billPeriods.push({label:t.periodDescription,value:t.id})}))}))}},{key:"onViewDataRow",value:function(e){this.dialog.open(P,{data:e}).afterClosed().subscribe()}},{key:"onDeleteDataRow",value:function(e){var t=this;e.type="Cancel",this.dialog.open(lt,{data:e}).afterClosed().subscribe((function(){e&&t.onGetBillsHistory(t.manageParams)}))}},{key:"onForceVerify",value:function(){var e=this;this.selectedRows&&this.selectedRows.length?(this.selectedRows.forEach((function(e){e.isBillFailed=!1})),this.billSettlementService.updateFaileBillsStatus(this.selectedRows).subscribe((function(t){t?e.notificationMessage("Failed bills status updated successfully","green-snackbar"):e.notificationMessage("Failed bills status update failed","red-snackbar"),e.onGetBillsHistory(e.manageParams)}))):(this.notificationMessage("Please select Bills.","red-snackbar"),this.onGetBillsHistory(this.manageParams))}},{key:"notificationMessage",value:function(e,t){this.snackbar.open(e,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[t]})}},{key:"onAverageConsumptionSave",value:function(){var e=this,t=[];this.selectedRows&&this.selectedRows.length?(this.selectedRows.forEach((function(e){e.bills&&e.bills.length&&(e.billTypeId=y.a.AverageBill,e.bills.forEach((function(i){t.push({billPeriodId:e.billPeriodId,tenantId:e.ownerId,unitId:e.unitId,clientId:e.clientId,isDeduction:!1,utilityTypeId:i.utilityTypeId})})))})),this.variablePayService.createOtherTypeConsumptionVariablePay(t,"average").subscribe({next:function(t){t.isSuccess?e.onSaveAverageConsumptionBills():(e.notificationMessage(t.message?t.message:"No consumption to save","red-snackbar"),e.onGetBillsHistory(e.manageParams))},error:function(t){e.notificationMessage("Average consumption save failed","red-snackbar"),e.onGetBillsHistory(e.manageParams)}})):this.notificationMessage("Please select Bills.","red-snackbar")}},{key:"onSaveAverageConsumptionBills",value:function(){var e=this;this.billSettlementService.updateOtherTypeConsumption(this.selectedRows).subscribe({next:function(t){t?e.notificationMessage("Average consumption saved successfully","green-snackbar"):e.notificationMessage("Average consumption save failed","red-snackbar"),e.onGetBillsHistory(e.manageParams)},error:function(t){e.notificationMessage("Average consumption save failed","red-snackbar"),e.onGetBillsHistory(e.manageParams)}})}},{key:"onUpdateRow",value:function(e){var t=this;this.dialog.open(Fn,{data:e}).afterClosed().subscribe((function(i){i&&t.onGetBillsHistory(t.manageParams,e)}))}},{key:"downloadReport",value:function(e){return Object(h.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.invoiceView([e]);case 1:case"end":return t.stop()}}),t,this)})))}},{key:"invoiceView",value:function(e){var t=this;this.billService.invoiceView(e).subscribe({next:function(e){e?t.downloadFile(e):t.notificationMessage("No data to print","red-snackbar")},error:function(e){t.notificationMessage("No data to print","red-snackbar")}})}},{key:"downloadFile",value:function(e){return Object(h.a)(this,void 0,void 0,regeneratorRuntime.mark((function i(){var n,l,a,o,r,s,c,u;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,ee.PDFDocument.create();case 2:n=i.sent,l=t(e),i.prev=4,l.s();case 6:if((a=l.n()).done){i.next=16;break}return o=a.value,i.next=10,ee.PDFDocument.load(o);case 10:return r=i.sent,i.next=13,n.copyPages(r,r.getPageIndices());case 13:i.sent.forEach((function(e){n.addPage(e)}));case 14:i.next=6;break;case 16:i.next=21;break;case 18:i.prev=18,i.t0=i.catch(4),l.e(i.t0);case 21:return i.prev=21,l.f(),i.finish(21);case 24:return i.next=26,n.save();case 26:s=i.sent,c=new Blob([s],{type:"application/pdf"}),u=window.URL.createObjectURL(c),window.open(u);case 30:case"end":return i.stop()}}),i,null,[[4,18,21,24]])})))}}]),e}()).\u0275fac=function(e){return new(e||On)(g.Nb(b.a),g.Nb(M.a),g.Nb(wn.a),g.Nb(d.f),g.Nb(d.d),g.Nb(d.g),g.Nb(v.b),g.Nb(B.b),g.Nb(Z.a),g.Nb(w.a),g.Nb(C.a))},On.\u0275cmp=g.Hb({type:On,selectors:[["fury-failed-bills"]],decls:26,vars:13,consts:[["mode","card",2,"margin-top","20px"],["fxLayout","column"],["color","primary",1,"position-fixed"],["src","assets/img/fav-icon.png",1,"img-style"],[1,"toolbar-spacer"],[3,"averageConsumptionClicked","forceVerifyClicked"],["fxFlex","noshrink","fxLayout","column","fxLayout.gt-sm","row","fxLayoutAlign.gt-sm","start stretch",3,"fxLayoutGap"],["fxFlex","grow",1,"basic-forms","route-animations-elements",3,"fxFlex.gt-sm"],["fxLayout","column",1,"result"],[3,"billPeriods","searchClicked"],[3,"tableData","columnsToDisplay","innerDisplayedColumns","columnNames","hideHeader","buttonName","visibleButtons","selectedRows","viewDataRow","printDataRow","updateRow","deleteDataRow"],["fxLayout.gt-sm","row","fxLayout","column","fxLayoutAlign","end end","fxLayoutGap.gt-sm","12px",1,"result"],["color","primary",1,"result"],["type","text","id","billAmount","name","billAmount","matInput","",2,"text-align","right",3,"ngModel","ngModelChange"],["type","text","id","receivedAmount","name","receivedAmount","matInput","",2,"text-align","right",3,"ngModel","ngModelChange"]],template:function(e,t){1&e&&(g.Tb(0,"fury-page-layout",0),g.Tb(1,"fury-page-layout-content",1),g.Tb(2,"mat-toolbar",2),g.Ob(3,"img",3),g.Tb(4,"span"),g.Rc(5,"Failed Bills"),g.Sb(),g.Ob(6,"span",4),g.Tb(7,"fury-failed-bills-footer-toolbar",5),g.bc("averageConsumptionClicked",(function(){return t.onAverageConsumptionSave()}))("forceVerifyClicked",(function(){return t.onForceVerify()})),g.Sb(),g.Sb(),g.Tb(8,"div",6),g.Tb(9,"fury-card",7),g.Ob(10,"fury-card-header"),g.Tb(11,"fury-card-content",1),g.Tb(12,"div",8),g.Tb(13,"fury-failed-bills-toolbar",9),g.bc("searchClicked",(function(e){return t.onGetBillsHistory(e)})),g.Sb(),g.Sb(),g.Sb(),g.Tb(14,"fury-card-content",1),g.Tb(15,"div",8),g.Tb(16,"fury-expandable-table-structure",10),g.bc("selectedRows",(function(e){return t.onSelectedRows(e)}))("viewDataRow",(function(e){return t.onViewDataRow(e)}))("printDataRow",(function(e){return t.downloadReport(e)}))("updateRow",(function(e){return t.onUpdateRow(e)}))("deleteDataRow",(function(e){return t.onDeleteDataRow(e)})),g.Sb(),g.Sb(),g.Tb(17,"div",11),g.Tb(18,"mat-form-field",12),g.Tb(19,"mat-label"),g.Rc(20,"Bill Amount"),g.Sb(),g.Tb(21,"input",13),g.bc("ngModelChange",(function(e){return t.billAmount=e})),g.Sb(),g.Sb(),g.Tb(22,"mat-form-field",12),g.Tb(23,"mat-label"),g.Rc(24,"Paid Amount"),g.Sb(),g.Tb(25,"input",14),g.bc("ngModelChange",(function(e){return t.receivedAmount=e})),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb()),2&e&&(g.Cb(8),g.mc("fxLayoutGap",t.gap),g.Cb(1),g.mc("fxFlex.gt-sm",t.col2)("@fadeInUp",void 0),g.Cb(4),g.mc("billPeriods",t.billPeriods),g.Cb(3),g.mc("tableData",t.billMasterDetails)("columnsToDisplay",t.columns)("innerDisplayedColumns",t.innerColumns)("columnNames",t.columnNames)("hideHeader",!1)("buttonName",t.buttonName)("visibleButtons",t.visibleButtons),g.Cb(5),g.mc("ngModel",t.billAmount),g.Cb(4),g.mc("ngModel",t.receivedAmount))},directives:[te.a,ie.a,N.d,ne.a,Rn,N.b,N.c,N.e,S.a,S.d,S.c,Mn,x.a,z.d,z.h,E.b,s.c,s.q,s.t],styles:[".toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.img-style[_ngcontent-%COMP%]{width:32px}.position-fixed[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;top:0;z-index:5}"],data:{animation:[p.a,f.a]}}),On),Bn=a("jtHE"),zn=a("pLZG");function Un(e,t){if(1&e){var i=g.Ub();g.Tb(0,"fury-payment-history-footer-toolbar",20),g.bc("exportClicked",(function(){return g.Ec(i),g.fc().onExport()})),g.Sb()}if(2&e){var n=g.fc();g.mc("visible",!1)("hide",n.hasData)("show",!1)}}function En(e,t){if(1&e&&(g.Tb(0,"mat-option",30),g.Rc(1),g.Sb()),2&e){var i=t.$implicit;g.mc("value",i.value),g.Cb(1),g.Tc("",i.label," ")}}function jn(e,t){if(1&e){var i=g.Ub();g.Tb(0,"div",21),g.Tb(1,"div",22),g.Tb(2,"mat-form-field",23),g.Tb(3,"mat-label"),g.Rc(4,"From Date"),g.Sb(),g.Tb(5,"input",24),g.bc("click",(function(){return g.Ec(i),g.Ac(8).open()}))("ngModelChange",(function(e){return g.Ec(i),g.fc().fromDate=e}))("focus",(function(){return g.Ec(i),g.Ac(8).open()})),g.Sb(),g.Ob(6,"mat-datepicker-toggle",25),g.Ob(7,"mat-datepicker",null,26),g.Sb(),g.Tb(9,"mat-form-field",23),g.Tb(10,"mat-label"),g.Rc(11,"To Date"),g.Sb(),g.Tb(12,"input",27),g.bc("click",(function(){return g.Ec(i),g.Ac(15).open()}))("ngModelChange",(function(e){return g.Ec(i),g.fc().toDate=e}))("focus",(function(){return g.Ec(i),g.Ac(15).open()})),g.Sb(),g.Ob(13,"mat-datepicker-toggle",25),g.Ob(14,"mat-datepicker",null,28),g.Sb(),g.Tb(16,"mat-form-field",23),g.Tb(17,"mat-label"),g.Rc(18,"Bill Period"),g.Sb(),g.Tb(19,"mat-select",29),g.bc("selectionChange",(function(e){return g.Ec(i),g.fc().onChangeBillPeriod(e.value)}))("valueChange",(function(e){return g.Ec(i),g.fc().billPeriodId=e})),g.Tb(20,"mat-option",30),g.Rc(21,"Select"),g.Sb(),g.Pc(22,En,2,2,"mat-option",31),g.Sb(),g.Tb(23,"mat-hint"),g.Rc(24,"Please select a Bill period"),g.Sb(),g.Sb(),g.Tb(25,"div",32),g.Tb(26,"button",33),g.bc("click",(function(){return g.Ec(i),g.fc().getPaymentDueReport()})),g.Tb(27,"mat-icon"),g.Rc(28,"search"),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb()}if(2&e){var n=g.Ac(8),l=g.Ac(15),a=g.fc();g.Cb(5),g.mc("ngModel",a.fromDate)("matDatepicker",n),g.Cb(1),g.mc("for",n),g.Cb(6),g.mc("ngModel",a.toDate)("matDatepicker",l),g.Cb(1),g.mc("for",l),g.Cb(6),g.mc("value",a.billPeriodId),g.Cb(1),g.mc("value",0),g.Cb(2),g.mc("ngForOf",a.billPeriods)}}function Hn(e,t){if(1&e&&(g.Tb(0,"th",38),g.Rc(1),g.Sb()),2&e){var i=g.fc(2).$implicit;g.Cb(1),g.Tc(" ",i.name,"")}}function Yn(e,t){if(1&e&&(g.Tb(0,"td",39),g.Rc(1),g.Sb()),2&e){var i=t.$implicit,n=g.fc(2).$implicit;g.mc("ngStyle",n.columnAlign),g.Cb(1),g.Tc(" ",i[n.property]," ")}}function Vn(e,t){if(1&e&&(g.Rb(0,35),g.Pc(1,Hn,2,1,"th",36),g.Pc(2,Yn,2,2,"td",37),g.Qb()),2&e){var i=g.fc().$implicit;g.mc("matColumnDef",i.property)}}function _n(e,t){if(1&e&&(g.Rb(0),g.Pc(1,Vn,3,1,"ng-container",34),g.Qb()),2&e){var i=t.$implicit;g.Cb(1),g.mc("ngIf",i.isModelProperty)}}function Gn(e,t){1&e&&(g.Tb(0,"th",40),g.Rc(1,"BILL AMOUNT"),g.Sb())}function Xn(e,t){if(1&e&&(g.Tb(0,"td",41),g.Rc(1),g.Sb()),2&e){var i=t.$implicit;g.Cb(1),g.Tc(" ",i.billAmountLocal," ")}}function qn(e,t){1&e&&(g.Tb(0,"th",40),g.Rc(1,"CREDIT NOTE AMOUNT"),g.Sb())}function $n(e,t){if(1&e&&(g.Tb(0,"td",41),g.Rc(1),g.Sb()),2&e){var i=t.$implicit;g.Cb(1),g.Tc(" ",i.creditNoteAmountLocal," ")}}function Jn(e,t){1&e&&(g.Tb(0,"th",40),g.Rc(1,"PAID AMOUNT"),g.Sb())}function Qn(e,t){if(1&e&&(g.Tb(0,"td",41),g.Rc(1),g.Sb()),2&e){var i=t.$implicit;g.Cb(1),g.Tc(" ",i.paidLocal," ")}}function Kn(e,t){1&e&&(g.Tb(0,"th",40),g.Rc(1,"PAYMENT DUE"),g.Sb())}function Zn(e,t){if(1&e&&(g.Tb(0,"td",41),g.Rc(1),g.Sb()),2&e){var i=t.$implicit;g.Cb(1),g.Tc(" ",i.toPayLocal," ")}}function el(e,t){1&e&&g.Ob(0,"tr",42)}function tl(e,t){1&e&&g.Ob(0,"tr",43)}var il,nl=((il=function(){function e(t,i,n,a,o,r,s,c,u){var d,m,h;l(this,e),this.billService=t,this.currency=i,this.date=n,this.templateService=a,this.jwtHelperService=o,this.snackbar=r,this.clientSelectionService=s,this.cookieService=c,this.envService=u,this.subject$=new Bn.a(1),this.data$=this.subject$.asObservable(),this.currencyFormat="",this.dateFormat="",this.billPeriodId=0,this.selectedRows=[],this.billPeriods=[],this.roundOffFormat="",this.role="",this.hasData=!1,this.filePath="",this.displayedColumns=[],this.pageSize=8,this.filePath=u.backendForFiles,this.currencyFormat=null!==(d=Object(y.e)("Currency"))&&void 0!==d?d:u.currencyFormat,this.roundOffFormat=null!==(m=Object(y.e)("RoundOff"))&&void 0!==m?m:u.roundOffFormat,this.dateFormat=null!==(h=Object(y.e)("DateFormat"))&&void 0!==h?h:u.dateFormat}return o(e,[{key:"createGridColumns",value:function(){this.displayedColumns=0==this.ownerId?[{name:"Bill Number",property:"billNumber",visible:!0,isModelProperty:!0},{name:"Owner Name",property:"ownerName",visible:!0,isModelProperty:!0},{name:"Owner/Tenant",property:"entityType",visible:!0,isModelProperty:!0},{name:"Unit",property:"unitNumber",visible:!0,isModelProperty:!0},{name:"From Date",property:"fromDateLocal",visible:!0,isModelProperty:!0},{name:"To Date",property:"toDateLocal",visible:!0,isModelProperty:!0},{name:"Due Date",property:"dueDateLocal",visible:!0,isModelProperty:!0},{name:"Bill Amount",property:"billAmountLocal",visible:!0,isModelProperty:!1},{name:"Credit Note Amount",property:"creditNoteAmountLocal",visible:!0,isModelProperty:!1},{name:"Paid Amount",property:"paidLocal",visible:!0,isModelProperty:!1},{name:"Payment Due",property:"toPayLocal",visible:!0,isModelProperty:!1}]:[{name:"Bill Number",property:"billNumber",visible:!0,isModelProperty:!0},{name:"Bill Date",property:"billDateLocal",visible:!0,isModelProperty:!0},{name:"Unit",property:"unitNumber",visible:!0,isModelProperty:!0},{name:"Due Date",property:"dueDateLocal",visible:!0,isModelProperty:!0},{name:"Payment Due",property:"toPayLocal",visible:!0,isModelProperty:!1}]}},{key:"ngOnInit",value:function(){this.columnsProps=this.displayedColumns.map((function(e){return e.property}));var e=this.cookieService.get("access_token"),t=this.jwtHelperService.decodeToken(e);t&&(this.role=t["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"]),this.ownerId=parseInt(this.cookieService.get("ownerId")),this.createGridColumns(),this.ownerId>0?(this.clientSelectionService.setIsClientVisible(!1),this.getPaymentDue()):this.clientSelectionService.setIsClientVisible(!0),this.getBillPeriods()}},{key:"getBillPeriods",value:function(){var e=this;this.clientId=parseInt(this.cookieService.get("globalClientId")),this.billService.getBillPeriods(this.clientId).subscribe((function(t){t.forEach((function(t){e.billPeriods.push({label:t.periodDescription,value:t.id})}))}))}},{key:"getPaymentDueReport",value:function(){this.fromDate=null==this.fromDate?"":this.fromDate,this.toDate=null==this.toDate?"":this.toDate,""!=this.fromDate&&""!=this.toDate||this.billPeriodId>0?this.getPaymentDue():this.notificationMessage("Invalid Parameters.","yellow-snackbar")}},{key:"getPaymentDue",value:function(){var e=this;this.paymentDue=[],this.hasData=!1,this.clientId=parseInt(this.cookieService.get("globalClientId")),this.fromDate=""==this.fromDate?"":L(this.fromDate).format("YYYY-MM-DD"),this.toDate=""==this.toDate?"":L(this.toDate).format("YYYY-MM-DD"),this.billService.GetPaymentDue(this.fromDate,this.toDate,this.billPeriodId,this.ownerId,this.clientId).subscribe((function(t){e.dateFormat=Object(y.e)("DateFormat"),e.roundOffFormat=Object(y.e)("RoundOff"),e.currencyFormat=Object(y.e)("Currency"),t.forEach((function(t){if(t.billAmountLocal=e.currency.transform(t.billAmount,e.currencyFormat.toString(),!0,e.roundOffFormat),t.billDateLocal=e.date.transform(t.billDate.toString(),e.dateFormat.toString()),t.dueDateLocal=e.date.transform(t.dueDate.toString(),e.dateFormat.toString()),t.fromDateLocal=e.date.transform(t.fromDate.toString(),e.dateFormat.toString()),t.toDateLocal=e.date.transform(t.toDate.toString(),e.dateFormat.toString()),t.paidLocal=e.currency.transform(t.paid,e.currencyFormat.toString(),!0,e.roundOffFormat),t.creditNoteAmountLocal=e.currency.transform(t.creditNoteAmount,e.currencyFormat.toString(),!0,e.roundOffFormat),t.toPay.toString().substring(0).includes("-",0)){var i=t.toPay.toString().replace("-","");t.toPayLocal=e.currency.transform(i,e.currencyFormat.toString()+"-",!0,e.roundOffFormat)}else t.toPayLocal=e.currency.transform(t.toPay,e.currencyFormat.toString(),!0,e.roundOffFormat)})),e.paymentDue=t,e.subject$.next(e.paymentDue),e.paymentDue.length>0&&(e.hasData=!0)})),this.dataSource=new ye.k(this.paymentDue),this.data$.pipe(Object(zn.a)((function(e){return!!e}))).subscribe((function(t){e.paymentDue=t,e.dataSource.data=t})),this.ngAfterViewInit()}},{key:"ngAfterViewInit",value:function(){null!=this.dataSource&&(this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort)}},{key:"notificationMessage",value:function(e,t){this.snackbar.open(e,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[t]})}},{key:"onChangeBillPeriod",value:function(e){this.billPeriodId=e}},{key:"onSelectedRows",value:function(e){this.selectedRows=[],this.selectedRows=e}},{key:"onSendEmail",value:function(){var e=this;this.paymentDue&&this.templateService.emailInvoiceTemplate({notificationType:"EMAIL",templateType:"Invoice",templateName:"Invoice",billMasterDetails:this.paymentDue}).subscribe((function(t){e.notificationMessage("Email send successfully.","green-snackbar")}))}},{key:"onPrintSummary",value:function(){this.downloadSummary(this.paymentDue)}},{key:"downloadSummary",value:function(e){for(var t=[],i=[],n=[],l=0,a=0,o=0,r=0;r<e.length;r++)t.push(e[r].billNumber),t.push(e[r].ownerName),t.push(e[r].accountNumber),t.push(e[r].unitNumber),t.push(e[r].billDateLocal),t.push(e[r].dueDateLocal),t.push(e[r].billAmountLocal),t.push(e[r].paidLocal),t.push(e[r].toPayLocal),i.push(t),l+=e[r].billAmount,a+=e[r].paid,o+=e[r].toPay,t=[];n.push({label:"Total Amount",value0:l,value1:a,value2:o});for(var s=0;s<n.length;s++)t.push(""),t.push(""),t.push(""),t.push(""),t.push(""),t.push(n[s].label),t.push(this.currency.transform(n[s].value0,this.currencyFormat.toString(),!0,this.roundOffFormat)),t.push(this.currency.transform(n[s].value1,this.currencyFormat.toString(),!0,this.roundOffFormat)),t.push(this.currency.transform(n[s].value2,this.currencyFormat.toString(),!0,this.roundOffFormat)),i.push(t),t=[];this.getSummaryReport(this.paymentDue,["Bill Number","Tenant Name","Account No.","Unit","Bill Date","Due Date","Bill Amount","Paid","Amount Due"],i,"Payment Due Report")}},{key:"getSummaryReport",value:function(e,t,i,n){var l,a,o=new Image;o.src=this.filePath+"/uploads/"+(null===(a=null===(l=e[0])||void 0===l?void 0:l.client)||void 0===a?void 0:a.photo);var r=new Fe.default({orientation:"landscape",unit:"pt",format:"letter"});r.rect(5,5,r.internal.pageSize.width-10,r.internal.pageSize.height-10,"S");var s=L().format("M/D/YYYY hh:mm:ss a");r.autoTable(t,i,{startX:10,startY:110,didDrawPage:function(t){var i,n,l,a;if(r.setFontSize(30),o&&e[0]&&e[0].client&&e[0].client.imageProperties&&e[0].client.imageProperties.length){var c=null===(n=null===(i=e[0])||void 0===i?void 0:i.client)||void 0===n?void 0:n.imageProperties.find((function(e){return"portrait"===e.imageType.trim().toLowerCase()}));c&&(o.onload=function(){r.addImage(o,c.imgX,c.imgY,c.imgW,c.imgH)})}r.setTextColor(25,118,210),r.setFontSize(9),r.setFont("Cambria"),r.setTextColor(0,0,0),r.text("Print Date: "+s,r.internal.pageSize.width-150,20),r.setFontSize(14),r.text("Payment Dues From "+Object(y.f)(null===(l=e[0])||void 0===l?void 0:l.fromDateLocal)+" To "+Object(y.f)(null===(a=e[0])||void 0===a?void 0:a.toDateLocal),r.internal.pageSize.width/2-140,90),r.setFontSize(9);var u="Page "+t.pageCount;"function"==typeof r.putTotalPages&&(u+=" of 1"),r.setFontSize(9);var d=r.internal.pageSize.height||r.internal.pageSize.getHeight();r.text(u,t.settings.margin.left,d-10)},styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:100,left:15},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:70,halign:"left"},1:{cellWidth:120,halign:"left"},2:{cellWidth:80,halign:"left"},3:{cellWidth:80,halign:"left"},4:{cellWidth:70,halign:"center"},5:{cellWidth:70,halign:"center"},6:{cellWidth:90,halign:"right"},7:{cellWidth:90,halign:"right"},8:{cellWidth:90,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]}});var c=r.output("blob");window.open(URL.createObjectURL(c))}},{key:"onFilterChange",value:function(e){this.dataSource&&(e=(e=e.trim()).toLowerCase(),this.dataSource.filter=e)}},{key:"getJsonData",value:function(){var e=this;this.tableData=[],null!=this.paymentDue&&this.paymentDue.forEach((function(t){var i={BillNumber:t.billNumber,OwnerName:t.ownerName,AccountNumber:t.accountNumber,EntityType:t.entityType,UnitNumber:t.unitNumber,BillDate:e.date.transform(t.billDate,"yyyy-MM-dd"),DueDate:e.date.transform(t.dueDate,"yyyy-MM-dd"),BillAmount:t.billAmountLocal,CreditNoteAmount:t.creditNoteAmountLocal,PaidAmount:t.paidLocal,PaymentDue:t.toPayLocal};e.tableData.push(i)}))}},{key:"onExport",value:function(){if(this.paymentDue&&this.paymentDue.length>0){if(this.getJsonData(),null!=this.tableData){var e=jt.utils.json_to_sheet(this.tableData),t=jt.utils.book_new();jt.utils.book_append_sheet(t,e,"Sheet1"),jt.writeFile(t,"PaymentDue.xlsx")}}else this.notificationMessage("No Data to Export","yellow-snackbar")}},{key:"content",set:function(e){this.sort=e,this.sort&&this.dataSource&&(this.dataSource.sort=this.sort)}},{key:"visibleColumns",get:function(){return this.displayedColumns.filter((function(e){return e.visible})).map((function(e){return e.property}))}}]),e}()).\u0275fac=function(e){return new(e||il)(g.Nb(b.a),g.Nb(d.d),g.Nb(d.f),g.Nb(Ae.a),g.Nb(D.a),g.Nb(B.b),g.Nb(Z.a),g.Nb(w.a),g.Nb(C.a))},il.\u0275cmp=g.Hb({type:il,selectors:[["fury-create-paymentdue"]],viewQuery:function(e,t){var i;1&e&&(g.Vc(Ht.a,!0),g.Vc(Yt.a,!0)),2&e&&(g.zc(i=g.cc())&&(t.paginator=i.first),g.zc(i=g.cc())&&(t.content=i.first))},inputs:{displayedColumns:"displayedColumns"},decls:30,vars:9,consts:[["mode","card",2,"margin-top","20px"],["fxLayout","column",1,"top-padding"],["color","primary",1,"position-fixed"],["src","assets/img/fav-icon.png",1,"img-style"],[1,"toolbar-spacer"],[3,"visible","hide","show","exportClicked",4,"ngIf"],["fxFlex","grow",1,"basic-forms","route-animations-elements"],["class","person bottom-padding",4,"ngIf"],[3,"columns","filterChange"],["mat-table","","matSort","",1,"list",3,"dataSource"],[4,"ngFor","ngForOf"],["matColumnDef","billAmountLocal"],["mat-header-cell","","class","header-align-right",4,"matHeaderCellDef"],["mat-cell","","class","header-align-right",4,"matCellDef"],["matColumnDef","creditNoteAmountLocal"],["matColumnDef","paidLocal"],["matColumnDef","toPayLocal"],["mat-header-row","",4,"matHeaderRowDef"],["class","clickable route-animations-elements","mat-row","",4,"matRowDef","matRowDefColumns"],[1,"paginator",3,"pageSize"],[3,"visible","hide","show","exportClicked"],[1,"person","bottom-padding"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","20px"],["color","primary",1,"result"],["id","FromDate","name","FromDate","matInput","","readonly","",3,"ngModel","matDatepicker","click","ngModelChange","focus"],["matSuffix","",3,"for"],["formDatepickerRef1",""],["id","ToDate","name","ToDate","matInput","","readonly","",3,"ngModel","matDatepicker","click","ngModelChange","focus"],["formDatepickerRef2",""],["id","billPeriod","name","billPeriod",3,"value","selectionChange","valueChange"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],[1,"top-padding"],["color","primary","mat-button","",3,"click"],[3,"matColumnDef",4,"ngIf"],[3,"matColumnDef"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",3,"ngStyle",4,"matCellDef"],["mat-header-cell","","mat-sort-header",""],["mat-cell","",3,"ngStyle"],["mat-header-cell","",1,"header-align-right"],["mat-cell","",1,"header-align-right"],["mat-header-row",""],["mat-row","",1,"clickable","route-animations-elements"]],template:function(e,t){1&e&&(g.Tb(0,"fury-page-layout",0),g.Tb(1,"fury-page-layout-content",1),g.Tb(2,"mat-toolbar",2),g.Ob(3,"img",3),g.Tb(4,"span"),g.Rc(5,"Payment Due"),g.Sb(),g.Ob(6,"span",4),g.Pc(7,Un,1,3,"fury-payment-history-footer-toolbar",5),g.Sb(),g.Tb(8,"fury-card",6),g.Ob(9,"fury-card-header"),g.Tb(10,"fury-card-content"),g.Pc(11,jn,29,9,"div",7),g.Tb(12,"fury-list",8),g.bc("filterChange",(function(e){return t.onFilterChange(e)})),g.Tb(13,"table",9),g.Pc(14,_n,2,1,"ng-container",10),g.Rb(15,11),g.Pc(16,Gn,2,0,"th",12),g.Pc(17,Xn,2,1,"td",13),g.Qb(),g.Rb(18,14),g.Pc(19,qn,2,0,"th",12),g.Pc(20,$n,2,1,"td",13),g.Qb(),g.Rb(21,15),g.Pc(22,Jn,2,0,"th",12),g.Pc(23,Qn,2,1,"td",13),g.Qb(),g.Rb(24,16),g.Pc(25,Kn,2,0,"th",12),g.Pc(26,Zn,2,1,"td",13),g.Qb(),g.Pc(27,el,1,0,"tr",17),g.Pc(28,tl,1,0,"tr",18),g.Sb(),g.Ob(29,"mat-paginator",19),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb()),2&e&&(g.Cb(7),g.mc("ngIf",0==t.ownerId),g.Cb(1),g.mc("@fadeInUp",void 0),g.Cb(3),g.mc("ngIf",0==t.ownerId),g.Cb(1),g.mc("columns",t.displayedColumns),g.Cb(1),g.mc("dataSource",t.dataSource),g.Cb(1),g.mc("ngForOf",t.displayedColumns),g.Cb(13),g.mc("matHeaderRowDef",t.visibleColumns),g.Cb(1),g.mc("matRowDefColumns",t.visibleColumns),g.Cb(1),g.mc("pageSize",t.pageSize))},directives:[te.a,ie.a,N.d,ne.a,d.o,S.a,N.b,S.d,S.c,Vt.a,ye.j,Yt.a,d.n,ye.c,ye.e,ye.b,ye.g,ye.i,Ht.a,ki.a,N.e,z.d,z.h,E.b,s.c,Y.b,s.q,s.t,Y.d,z.j,Y.a,U.a,H.n,z.g,k.a,F.a,ye.d,Yt.b,ye.a,d.p,Ie.c,ye.f,ye.h],styles:[".top-padding[_ngcontent-%COMP%]{padding-top:.7%}.bottom-padding[_ngcontent-%COMP%]{padding-bottom:2%}.toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.img-style[_ngcontent-%COMP%]{width:32px}.position-fixed[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;top:0;z-index:5}.header-align-right[_ngcontent-%COMP%]{text-align:right}"],data:{animation:[p.a,f.a]}}),il),ll=a("STbY");function al(e,t){if(1&e&&(g.Tb(0,"mat-option",36),g.Rc(1),g.Sb()),2&e){var i=t.$implicit;g.mc("value",i.ownerName),g.Cb(1),g.Tc(" ",i.ownerName," ")}}function ol(e,t){if(1&e){var i=g.Ub();g.Tb(0,"div",20),g.Tb(1,"div",21),g.Tb(2,"mat-form-field",22),g.Tb(3,"mat-label"),g.Rc(4,"From Date"),g.Sb(),g.Tb(5,"input",23),g.bc("click",(function(){return g.Ec(i),g.Ac(8).open()}))("ngModelChange",(function(e){return g.Ec(i),g.fc().fromDate=e}))("focus",(function(){return g.Ec(i),g.Ac(8).open()})),g.Sb(),g.Ob(6,"mat-datepicker-toggle",24),g.Ob(7,"mat-datepicker",null,25),g.Sb(),g.Tb(9,"mat-form-field",22),g.Tb(10,"mat-label"),g.Rc(11,"To Date"),g.Sb(),g.Tb(12,"input",26),g.bc("click",(function(){return g.Ec(i),g.Ac(15).open()}))("ngModelChange",(function(e){return g.Ec(i),g.fc().toDate=e}))("focus",(function(){return g.Ec(i),g.Ac(15).open()})),g.Sb(),g.Ob(13,"mat-datepicker-toggle",24),g.Ob(14,"mat-datepicker",null,27),g.Sb(),g.Tb(16,"form",28),g.Tb(17,"mat-form-field",29),g.Tb(18,"mat-label"),g.Rc(19,"Tenant Name"),g.Sb(),g.Ob(20,"input",30),g.Tb(21,"mat-autocomplete",31,32),g.bc("optionSelected",(function(e){return g.Ec(i),g.fc().selectTenant(e)})),g.Pc(23,al,2,2,"mat-option",33),g.Sb(),g.Tb(24,"mat-hint"),g.Rc(25,"Please select a Tenant Name"),g.Sb(),g.Sb(),g.Sb(),g.Tb(26,"div",34),g.Tb(27,"button",35),g.bc("click",(function(){return g.Ec(i),g.fc().getRefund()})),g.Tb(28,"mat-icon"),g.Rc(29,"search"),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb()}if(2&e){var n=g.Ac(8),l=g.Ac(15),a=g.Ac(22),o=g.fc();g.Cb(5),g.mc("ngModel",o.fromDate)("matDatepicker",n),g.Cb(1),g.mc("for",n),g.Cb(6),g.mc("ngModel",o.toDate)("matDatepicker",l),g.Cb(1),g.mc("for",l),g.Cb(3),g.mc("formGroup",o.form),g.Cb(4),g.mc("matAutocomplete",a),g.Cb(3),g.mc("ngForOf",o.filteredTenants)}}function rl(e,t){if(1&e&&(g.Tb(0,"th",41),g.Rc(1),g.Sb()),2&e){var i=g.fc(2).$implicit;g.Cb(1),g.Tc(" ",i.name,"")}}function sl(e,t){if(1&e&&(g.Tb(0,"td",42),g.Rc(1),g.Sb()),2&e){var i=t.$implicit,n=g.fc(2).$implicit;g.Cb(1),g.Tc(" ",i[n.property]," ")}}function cl(e,t){if(1&e&&(g.Rb(0,38),g.Pc(1,rl,2,1,"th",39),g.Pc(2,sl,2,1,"td",40),g.Qb()),2&e){var i=g.fc().$implicit;g.mc("matColumnDef",i.property)}}function ul(e,t){if(1&e&&(g.Rb(0),g.Pc(1,cl,3,1,"ng-container",37),g.Qb()),2&e){var i=t.$implicit;g.Cb(1),g.mc("ngIf",i.isModelProperty)}}function dl(e,t){1&e&&(g.Tb(0,"th",43),g.Rc(1,"REFUND AMOUNT"),g.Sb())}function ml(e,t){if(1&e&&(g.Tb(0,"td",44),g.Rc(1),g.Sb()),2&e){var i=t.$implicit;g.Cb(1),g.Tc(" ",i.refundAmountLocal," ")}}function hl(e,t){1&e&&g.Ob(0,"th",45)}function bl(e,t){if(1&e){var i=g.Ub();g.Tb(0,"td",46),g.Tb(1,"button",47),g.bc("click",(function(e){return g.Ec(i),e.stopPropagation()})),g.Tb(2,"mat-icon"),g.Rc(3,"more_horiz"),g.Sb(),g.Sb(),g.Tb(4,"mat-menu",48,49),g.Tb(6,"button",50),g.bc("click",(function(){g.Ec(i);var e=t.$implicit;return g.fc().onPrintPdf(e)})),g.Tb(7,"span"),g.Rc(8,"Print"),g.Sb(),g.Sb(),g.Tb(9,"button",50),g.bc("click",(function(){g.Ec(i);var e=t.$implicit;return g.fc().deleteVariablePay(e)})),g.Tb(10,"span"),g.Rc(11,"Delete"),g.Sb(),g.Sb(),g.Sb(),g.Sb()}if(2&e){var n=g.Ac(5);g.Cb(1),g.mc("matMenuTriggerFor",n)}}function fl(e,t){1&e&&g.Ob(0,"tr",51)}function pl(e,t){1&e&&g.Ob(0,"tr",52)}var gl,vl,yl,Cl,Sl=((yl=function(){function e(t,i,n,a,o,r,s,c,u,d,m,h){var b,f,p;l(this,e),this.billService=t,this.billSettlementService=i,this.currency=n,this.date=a,this.route=o,this.fb=r,this.snackbar=s,this.templateService=c,this.decimalPipe=u,this.clientSelectionService=d,this.cookieService=m,this.envService=h,this.subject$=new Bn.a(1),this.data$=this.subject$.asObservable(),this.tenants=[],this.currencyFormat="",this.dateFormat="",this.roundOffFormat="",this.tenantId=0,this.showMoreControls=!1,this.isData=!1,this.displayedColumns=[{name:"Refund Number",property:"refundNumber",visible:!0,isModelProperty:!0},{name:"Refund Date",property:"refundDateLocal",visible:!0,isModelProperty:!0},{name:"Owner Name",property:"ownerName",visible:!0,isModelProperty:!0},{name:"Unit Number",property:"unitNumber",visible:!0,isModelProperty:!0},{name:"Refund Amount",property:"refundAmountLocal",visible:!0,isModelProperty:!1,columnAlign:{"text-align":"right"}},{name:"Remarks",property:"remarks",visible:!0,isModelProperty:!0},{name:"Actions",property:"actions",visible:!0}],this.pageSize=8,this.roundOffFormat=null!==(b=Object(y.e)("RoundOff"))&&void 0!==b?b:h.roundOffFormat,this.currencyFormat=null!==(f=Object(y.e)("Currency"))&&void 0!==f?f:h.currencyFormat,this.dateFormat=null!==(p=Object(y.e)("DateFormat"))&&void 0!==p?p:h.dateFormat}return o(e,[{key:"ngOnInit",value:function(){var e=this;this.clientSelectionService.setIsClientVisible(!0),this.route.queryParams.subscribe((function(t){t.id&&(e.tenantId=parseInt(t.id))})),this.clientId=parseInt(this.cookieService.get("globalClientId")),this.onGetTenants(),this.ownerId=parseInt(this.cookieService.get("ownerId")),this.ownerId>0&&this.getRefundReport(this.fromDate,this.toDate),this.form=this.fb.group({tenantName:[""]}),this.form.controls.tenantName.valueChanges.subscribe((function(t){e.filteredTenants=e.filterTenant(t)}))}},{key:"filterTenant",value:function(e){return""!=e&&null!=e?this.tenants.filter((function(t){return 0===t.ownerName.toLowerCase().indexOf(e.toLowerCase())})):this.tenants}},{key:"getRefundReport",value:function(e,t){var i=this;e=e&&""!==e?L(e).format("YYYY-MM-DD"):"",t=t&&""!==t?L(t).format("YYYY-MM-DD"):"",this.billService.GetRefundReport(e,t,0==this.ownerId?this.tenantId:this.ownerId,this.clientId).subscribe((function(e){i.refunds=e,i.dateFormat=Object(y.e)("DateFormat"),i.roundOffFormat=Object(y.e)("RoundOff"),i.currencyFormat=Object(y.e)("Currency"),e.forEach((function(e){e.refundAmountLocal=i.currency.transform(e.refundAmount.toString(),i.currencyFormat.toString(),!0,i.roundOffFormat),e.refundDateLocal=i.date.transform(e.refundDate.toString(),i.dateFormat.toString()),e.paymentAmountLocal=i.currency.transform(e.paymentAmount,i.currencyFormat.toString(),!0,i.roundOffFormat)})),i.subject$.next(e),i.refunds=e,i.isData=e.length>0})),this.dataSource=new ye.k(this.refunds),this.data$.pipe(Object(zn.a)((function(e){return!!e}))).subscribe((function(e){i.refunds=e,i.dataSource.data=e})),this.ngAfterViewInit()}},{key:"onGetTenants",value:function(){var e=this;this.billSettlementService.getTenantsDetails(this.clientId,2).subscribe((function(t){if(e.tenants=t,e.filteredTenants=t,e.tenantId>0&&e.tenants){var i=e.tenants.filter((function(t){return t.id==e.tenantId}));i.length>0&&(e.form.controls.tenantName.setValue(i[0].ownerName),e.getRefundReport(e.fromDate,e.toDate))}}))}},{key:"ngAfterViewInit",value:function(){null!=this.dataSource&&(this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort)}},{key:"notificationMessage",value:function(e,t){this.snackbar.open(e,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[t]})}},{key:"getRefund",value:function(){this.clientId=parseInt(this.cookieService.get("globalClientId")),this.fromDate=""==this.fromDate?"":this.fromDate,this.toDate=""==this.toDate?"":this.toDate,""!=this.fromDate&&""!=this.toDate||this.tenantId>0?this.getRefundReport(this.fromDate,this.toDate):this.notificationMessage("Invalid Parameters.","yellow-snackbar")}},{key:"selectTenant",value:function(e){var t=this;this.tenants.forEach((function(i){i.ownerName===e.option.value&&(t.tenantId=i.id)}))}},{key:"onFilterChange",value:function(e){this.dataSource&&(e=(e=e.trim()).toLowerCase(),this.dataSource.filter=e)}},{key:"onPrintPdf",value:function(e){this.downloadReport(e)}},{key:"downloadReport",value:function(e){var t=[],i=[];i.push({label:"Refund Number:",value:e.refundNumber},{label:"Refund Date:",value:e.refundDateLocal},{label:"Account Number:",value:e.accountNumber},{label:"Meter Number:",value:""},{label:"Unit Number:",value:""},{label:"Mode of payment:",value:e.paymentMode}),t.push({label:"Received Payments :",value:e.paymentAmountLocal},{label:"Refund Amount :",value:e.refundAmountLocal},{label:"",value:""},{label:"Balance Amount :",value:this.currency.transform(e.paymentAmount-e.refundAmount,this.currencyFormat.toString(),!0,this.roundOffFormat)}),this.getReport(e,[],[],t,[],[],[],i,[],"Refund")}},{key:"getReport",value:function(e,t,i,n,l,a,o,r,s,c){var u=new Image;u.src="assets/img/"+e.client.photo;var d=new Image;d.src="assets/img/lu.JPG";var m=new Fe.default({orientation:"portrait",unit:"pt",format:"letter"});m.rect(5,5,m.internal.pageSize.width-10,m.internal.pageSize.height-10,"S"),m.setFontSize(30),m.addImage(u,"png",5,5,190,u.height),m.addImage(d,"png",547,10,56,56),m.setTextColor(0,0,0),m.setFontSize(14),m.setFont("Cambria"),m.text("REFUND RECEIPT",260,30),m.setFontSize(9),m.setTextColor(25,118,210),m.setFont("Cambria","bold"),m.text(e.client.clientName,10,60),m.setFont("Cambria","normal"),m.text("TRN: "+e.client.trnNo,10,70),m.text("PO Box "+e.client.addresses[0].zipPostalCode,10,80),m.text(e.client.addresses[0].address1+","+e.client.addresses[0].country,10,90),m.text("Phone: "+e.client.phoneNo,10,100),m.text("Email: "+e.client.email+", Web: "+e.client.website,10,110),m.setFillColor(241,241,244),m.setDrawColor(206,203,203),m.rect(10,120,250,90,"FD"),m.setTextColor(0,0,0),m.setFontSize(12),m.text(e.ownerName.toUpperCase(),20,135),m.text("CUSTOMER TRN: ",20,155),m.text("unit #",20,170),m.setFontSize(10),m.text("",20,185),m.text("Al Barsha 1, Dubai, UAE",20,200),m.setFontSize(9),m.autoTable("",r,{startX:210,startY:120,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:400},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:100,halign:"right"}},didParseCell:function(e){var t=e.column.index;0!=t&&1!=t||(e.cell.styles.rowHeight=1)},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});var h=Number(this.decimalPipe.transform(m.autoTable.previous.finalY,"1.0-0"));m.setLineWidth(.1),m.line(5,h+10,607,h+10),m.setTextColor(0,0,0),m.setFontSize(10),m.text("Thank you for using Logic Utilities Payment Services.",20,h+20),m.text("We confirm receipt of your payment.",20,h+30),m.text("Please see the below details for your reference.",20,h+40),m.setTextColor(0,0,0),m.autoTable("",n,{startX:300,startY:h+50,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:110},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:180,halign:"left"},1:{cellWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"}}),m.setTextColor(0,0,0);var b=Number(this.decimalPipe.transform(m.autoTable.previous.finalY,"1.0-0"));m.setTextColor(255,0,0),m.setFontSize(9),m.text("Note: A Late Fee will be applied after the due date. A Default Payment \nPenalty will be added to any unit that is 45 days or more in arrears.",320,b+20),m.setTextColor(25,118,210),m.setFontSize(12),m.text("USAGE TIPS to reduce consumption:",10,b+80),m.text("Please Try to:",10,b+100),m.setTextColor(0,0,0),m.setFontSize(9),m.text("- Keep filters clean",30,b+110),m.text("- Set thermostats between 23C and 25C",30,b+120),m.text("- Keep vents unblocked",30,b+130),m.text("- Keep doors and windows closed",30,b+140),m.text("- Undertake regular maintenance of the system",30,b+150),m.setTextColor(25,118,210),m.setFontSize(12),m.text("Please Do Not:",10,b+170),m.setTextColor(0,0,0),m.setFontSize(9),m.text("- Set thermostats to 20C or lower",30,b+180),m.text("- Block vents",30,b+190),m.text("- Leave doors and windows open",30,b+200),m.text("- Leave heat producing appliances near thermostats",30,b+210),m.setFillColor(119,183,11);var f=m.internal.pageSize.height||m.internal.pageSize.getHeight();m.rect(320,b+60,280,f-80-(b+60),"FD"),m.setFont("Comic Sans"),m.setTextColor(255,255,255),m.setFontSize(16),m.text("ADVERTISE WITH US",360,b+80);var p=m.getTextWidth("ADVERTISE WITH US");m.setLineWidth(.1),m.line(360,b+85,360+p,b+85),m.setFontSize(9),m.text("For advertisement, contact at",390,b+95),m.text("800 Logic (56442)",390,b+105),m.text("enquiry@logicutilities.com",390,b+115),m.text("www.logicutilities.com",390,b+125),m.setTextColor(0,0,0),m.setLineWidth(.1),m.line(5,f-70,607,f-70),m.text("For any enquiries, write to us enquiry@logicutilities.com \nor Logon to www.logicutilites.com",10,f-60),m.setTextColor(255,0,0),m.setFont("bold");var g=m.getTextWidth("Notice:");m.text("Notice:",340,f-60),m.setFont("none"),m.setTextColor(0,0,0),m.text("Pay your bills before due date to avoid late payment surcharge",340+g,f-60),m.text("and disconnection.",340,f-50),m.text("You can log onto www.logicutilites.com to pay your invoices \nTerms & Conditions for Supply of Utility Services",340,f-40),"function"==typeof m.putTotalPages&&m.putTotalPages("1");var v=m.output("blob");window.open(URL.createObjectURL(v))}},{key:"onSendEmail",value:function(){this.refunds||this.notificationMessage("Refund Data not available.","yellow-snackbar")}},{key:"onPrintSummary",value:function(){this.refunds&&this.refunds.length>0?this.downloadSummary(this.refunds):this.notificationMessage("Refund Data not available.","yellow-snackbar")}},{key:"downloadSummary",value:function(e){for(var t=[],i=[],n=[],l=0,a=0;a<e.length;a++)t.push(e[a].refundNumber),t.push(e[a].refundDateLocal),t.push(e[a].accountNumber),t.push(e[a].unitNumber),t.push(e[a].refundAmountLocal),t.push(e[a].remarks),i.push(t),l+=e[a].refundAmount,t=[];n.push({label:"Total Amount",value0:l});for(var o=0;o<n.length;o++)t.push(""),t.push(""),t.push(""),t.push(n[o].label),t.push(this.currency.transform(n[o].value0,this.currencyFormat.toString(),!0,this.roundOffFormat)),t.push(""),i.push(t),t=[];this.getSummaryReport(this.refunds,["Refund Number","Refund Date","Account No.","Unit","Refund Amount","Remarks"],i,"Refund Report")}},{key:"getSummaryReport",value:function(e,t,i,n){var l=new Image;l.src="assets/img/logo.png";var a=new Fe.default({orientation:"portrait",unit:"pt",format:"letter"});a.rect(5,5,a.internal.pageSize.width-10,a.internal.pageSize.height-10,"S"),a.setFontSize(30),a.addImage(l,"png",5,5,190,l.height),a.setTextColor(25,118,210),a.setFontSize(9),a.setFont("Cambria"),a.text("PO Box 127404",260,20),a.text("Office 201, Al Zarouni Business Centre",260,30),a.text("Al Barsha 1, Dubai, UAE",260,40),a.setTextColor(0,0,0),a.text("Phone:800 Logic (56442)",460,20),a.text("Email: ",460,30),a.setTextColor(25,118,210),a.text("enquiry@logicutilities.com",485,30),a.setTextColor(0,0,0),a.text("Web: ",460,40),a.setTextColor(25,118,210),a.text("www.logicutilities.com",485,40),a.setTextColor(0,0,0),a.setFontSize(12),a.setTextColor(25,118,210),a.text("Logic Utilities District Cooling Services LLC",10,70),a.text("TRN: 100567483100003",10,90),a.setTextColor(0,0,0),a.setFontSize(14),""!=this.fromDate&&""!=this.toDate?a.text("Refunds From "+L(this.fromDate).format("YYYY-MM-DD")+" To "+L(this.toDate).format("YYYY-MM-DD"),a.internal.pageSize.width/2-80,110):a.text("Refunds Report",a.internal.pageSize.width/2-20,70),a.setFontSize(9),Number(a.autoTable.previous.finalY),a.autoTable(t,i,{startX:10,startY:110,didDrawPage:function(e){var t="Page "+e.pageCount;"function"==typeof a.putTotalPages&&(t+=" of 1"),a.setFontSize(9);var i=a.internal.pageSize.height||a.internal.pageSize.getHeight();a.text(t,e.settings.margin.left,i-10)},styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:100,left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:80,halign:"left"},1:{cellWidth:80,halign:"center"},2:{cellWidth:80,halign:"center"},3:{cellWidth:80,halign:"center"},4:{cellWidth:100,halign:"right"},5:{cellWidth:120,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]}});var o=a.output("blob");window.open(URL.createObjectURL(o))}},{key:"getJsonData",value:function(){var e=this;this.tableData=[],null!=this.refunds&&this.refunds.forEach((function(t){var i={RefundNumber:t.refundNumber,RefundDate:e.date.transform(t.refundDate,"yyyy-MM-dd"),OwnerName:t.ownerName,UnitNumber:t.unitNumber,refundAmount:t.refundAmountLocal,Remarks:t.remarks};e.tableData.push(i)}))}},{key:"onExport",value:function(){if(this.refunds&&this.refunds.length>0){if(this.getJsonData(),null!=this.tableData){var e=jt.utils.json_to_sheet(this.tableData),t=jt.utils.book_new();jt.utils.book_append_sheet(t,e,"Sheet1"),jt.writeFile(t,"Refund.xlsx")}}else this.notificationMessage("No Data to Export","yellow-snackbar")}},{key:"content",set:function(e){this.sort=e,this.sort&&this.dataSource&&(this.dataSource.sort=this.sort)}},{key:"visibleColumns",get:function(){return this.displayedColumns.filter((function(e){return e.visible})).map((function(e){return e.property}))}}]),e}()).\u0275fac=function(e){return new(e||yl)(g.Nb(b.a),g.Nb(M.a),g.Nb(d.d),g.Nb(d.f),g.Nb(m.a),g.Nb(s.f),g.Nb(B.b),g.Nb(Ae.a),g.Nb(d.g),g.Nb(Z.a),g.Nb(w.a),g.Nb(C.a))},yl.\u0275cmp=g.Hb({type:yl,selectors:[["fury-create-refund"]],viewQuery:function(e,t){var i;1&e&&(g.Jc(Ht.a,!0),g.Vc(Yt.a,!0)),2&e&&(g.zc(i=g.cc())&&(t.paginator=i.first),g.zc(i=g.cc())&&(t.content=i.first))},inputs:{displayedColumns:"displayedColumns"},decls:24,vars:10,consts:[["mode","card",2,"margin-top","20px"],["fxLayout","column"],["color","primary",1,"top-padding","position-fixed"],["src","assets/img/fav-icon.png",1,"img-style"],[1,"toolbar-spacer"],[3,"show","hide","exportClicked","printClicked"],["fxFlex","grow",1,"basic-forms","route-animations-elements"],["class","person bottom-padding",4,"ngIf"],["fxFlex","grow","fxLayout","column",1,"list",3,"hideHeader","filterChange"],["mat-table","","matSort","",1,"list",3,"dataSource"],[4,"ngFor","ngForOf"],["matColumnDef","refundAmountLocal"],["mat-header-cell","","class","header-align-right",4,"matHeaderCellDef"],["mat-cell","","class","header-align-right",4,"matCellDef"],["matColumnDef","actions"],["class","actions-cell","mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["class","actions-cell","mat-cell","",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["class","clickable route-animations-elements","mat-row","",4,"matRowDef","matRowDefColumns"],[1,"paginator",3,"pageSize"],[1,"person","bottom-padding"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","20px"],["color","primary",1,"result"],["id","FromDate","name","FromDate","matInput","","readonly","",3,"ngModel","matDatepicker","click","ngModelChange","focus"],["matSuffix","",3,"for"],["formDatepickerRef1",""],["id","ToDate","name","ToDate","matInput","","readonly","",3,"ngModel","matDatepicker","click","ngModelChange","focus"],["formDatepickerRef2",""],[3,"formGroup"],["color","primary",1,"result",2,"width","400px"],["type","text","formControlName","tenantName","name","tenantName","matInput","",3,"matAutocomplete"],[3,"optionSelected"],["tenant","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[1,"top-padding"],["color","primary","mat-button","",3,"click"],[3,"value"],[3,"matColumnDef",4,"ngIf"],[3,"matColumnDef"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell","",1,"header-align-right"],["mat-cell","",1,"header-align-right"],["mat-header-cell","","mat-sort-header","",1,"actions-cell"],["mat-cell","",1,"actions-cell"],["type","button","mat-icon-button","",3,"matMenuTriggerFor","click"],["yPosition","below","xPosition","before"],["actionsMenu","matMenu"],["mat-menu-item","",3,"click"],["mat-header-row",""],["mat-row","",1,"clickable","route-animations-elements"]],template:function(e,t){1&e&&(g.Tb(0,"fury-page-layout",0),g.Tb(1,"fury-page-layout-content",1),g.Tb(2,"mat-toolbar",2),g.Ob(3,"img",3),g.Tb(4,"span"),g.Rc(5,"Refund Report"),g.Sb(),g.Ob(6,"span",4),g.Tb(7,"fury-payment-history-footer-toolbar",5),g.bc("exportClicked",(function(){return t.onExport()}))("printClicked",(function(){return t.onPrintSummary()})),g.Sb(),g.Sb(),g.Tb(8,"fury-card",6),g.Ob(9,"fury-card-header"),g.Tb(10,"fury-card-content"),g.Pc(11,ol,30,9,"div",7),g.Tb(12,"fury-list",8),g.bc("filterChange",(function(e){return t.onFilterChange(e)})),g.Tb(13,"table",9),g.Pc(14,ul,2,1,"ng-container",10),g.Rb(15,11),g.Pc(16,dl,2,0,"th",12),g.Pc(17,ml,2,1,"td",13),g.Qb(),g.Rb(18,14),g.Pc(19,hl,1,0,"th",15),g.Pc(20,bl,12,1,"td",16),g.Qb(),g.Pc(21,fl,1,0,"tr",17),g.Pc(22,pl,1,0,"tr",18),g.Sb(),g.Ob(23,"mat-paginator",19),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb()),2&e&&(g.Cb(7),g.mc("show",!1)("hide",t.isData),g.Cb(1),g.mc("@fadeInUp",void 0),g.Cb(3),g.mc("ngIf",0==t.ownerId),g.Cb(1),g.mc("hideHeader",!1),g.Cb(1),g.mc("dataSource",t.dataSource),g.Cb(1),g.mc("ngForOf",t.displayedColumns),g.Cb(7),g.mc("matHeaderRowDef",t.visibleColumns),g.Cb(1),g.mc("matRowDefColumns",t.visibleColumns),g.Cb(1),g.mc("pageSize",t.pageSize))},directives:[te.a,ie.a,N.d,ne.a,ki.a,S.a,N.b,S.d,S.c,d.o,Vt.a,ye.j,Yt.a,d.n,ye.c,ye.e,ye.b,ye.g,ye.i,Ht.a,N.e,z.d,z.h,E.b,s.c,Y.b,s.q,s.t,Y.d,z.j,Y.a,s.z,s.r,s.k,Oe.c,s.i,Oe.a,z.g,k.a,F.a,H.n,ye.d,Yt.b,ye.a,ll.d,ll.e,ll.b,ye.f,ye.h],styles:[".top-padding[_ngcontent-%COMP%]{padding-top:.7%}.bottom-padding[_ngcontent-%COMP%]{padding-bottom:2%}.toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.img-style[_ngcontent-%COMP%]{width:32px}.position-fixed[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;top:0;z-index:5}.right-margin[_ngcontent-%COMP%]{margin-right:5px}.header-align-right[_ngcontent-%COMP%]{text-align:right}"],data:{animation:[p.a,f.a]}}),yl),Tl=((vl=function(){function e(t,i,n){var a,o,r;l(this,e),this.date=t,this.currencyPipe=i,this.envService=n,this.outStandingBills=[],this.selectedRows=[],this.columns=[],this.dateColumnName="Date",this.billNumberConsumptionColumnName="Bill No",this.unitColumnName="Unit",this.amountColumnName="Amount",this.paidColumnName="Paid",this.toPayColumnName="To Pay",this.format="",this.currency="",this.roundFormat="",this.isHide=!0,this.rowsSelected=new g.o,this.format=null!==(a=Object(y.e)("DateFormat"))&&void 0!==a?a:n.dateFormat,this.currency=null!==(o=Object(y.e)("Currency"))&&void 0!==o?o:n.currencyFormat,this.roundFormat=null!==(r=Object(y.e)("RoundOff"))&&void 0!==r?r:n.roundOffFormat}return o(e,[{key:"ngOnInit",value:function(){this.createGridColumns(),this.isHide&&this.updateTableColumns()}},{key:"createGridColumns",value:function(){this.columns=[{name:"Checkbox",property:"checkbox",visible:!0},{name:this.dateColumnName,property:"billDateLocal",visible:!0,isModelProperty:!0},{name:this.billNumberConsumptionColumnName,property:"billNumber",visible:!0,isModelProperty:!0},{name:this.unitColumnName,property:"unitNumber",visible:!0,isModelProperty:!0},{name:this.amountColumnName,property:"billAmountLocal",visible:!0,isModelProperty:!0},{name:this.paidColumnName,property:"paidLocal",visible:!0,isModelProperty:!0},{name:this.toPayColumnName,property:"toPayLocal",visible:!0,isModelProperty:!0}]}},{key:"updateTableColumns",value:function(){this.columns.splice(0,1)}},{key:"onSelectedRows",value:function(e){this.selectedRows=[],this.selectedRows=e,this.rowsSelected.emit(this.selectedRows)}},{key:"updateDataFormats",value:function(e){var t=this;return e&&e.forEach((function(e){e.billDateLocal=t.date.transform(e.billDate.toString(),t.format.toString()),e.billAmountLocal=t.currencyPipe.transform(e.billAmount,t.currency.toString(),!0,t.roundFormat),e.toPayLocal=t.currencyPipe.transform(e.toPay,t.currency.toString(),!0,t.roundFormat),e.paidLocal=t.currencyPipe.transform(e.paid,t.currency.toString(),!0,t.roundFormat)})),e}},{key:"dataSource",set:function(e){e&&(this.outStandingBills=e.outstandingBills&&e.outstandingBills.length?this.updateDataFormats(e.outstandingBills):[])}}]),e}()).\u0275fac=function(e){return new(e||vl)(g.Nb(d.f),g.Nb(d.d),g.Nb(C.a))},vl.\u0275cmp=g.Hb({type:vl,selectors:[["fury-tenant-outstanding-bills"]],inputs:{isHide:"isHide",dataSource:"dataSource"},outputs:{rowsSelected:"rowsSelected"},decls:5,vars:2,consts:[[1,"person"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","1px"],[1,"fury-flex-form-field"],[3,"tableData","columns","selectedRows"]],template:function(e,t){1&e&&(g.Tb(0,"mat-dialog-content"),g.Tb(1,"div",0),g.Tb(2,"div",1),g.Tb(3,"div",2),g.Tb(4,"app-table-structure",3),g.bc("selectedRows",(function(e){return t.onSelectedRows(e)})),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb()),2&e&&(g.Cb(4),g.mc("tableData",t.outStandingBills)("columns",t.columns))},directives:[v.f,N.d,N.e,T.a],styles:[""]}),vl),Pl=((gl=function(){function e(t,i,n,a,o,r,s){var c;l(this,e),this.billSettlementService=t,this.billService=i,this.snackbar=n,this.decimalPipe=a,this.date=o,this.cookieService=r,this.envService=s,this.totAmt=0,this.tenantId="0",this._gap=16,this.gap=this._gap+"px",this.col2="1 1 calc(50% - ".concat(this._gap/2,"px)"),this.col3="1 1 calc(33.3333% - ".concat(this._gap/1.5,"px)"),this.billPeriods=[{label:"Select",value:0}],this.billSettlement={outstandingBills:[]},this.paymentModes=[{label:"Select",value:0}],this.banks=[{label:"Select",value:0}],this.tenants=[],this.manageParams={},this.billPayment={},this.selectedRows=[],this.bankId=0,this.remarks="",this.paymentModeId=0,this.paymentDate=new Date,this.refNumber="",this.paymentAmount=0,this.excessAmount=0,this.labelName="",this.roundFormat="",this.roundFormat=null!==(c=Object(y.e)("RoundOff"))&&void 0!==c?c:s.roundOffFormat}return o(e,[{key:"ngOnInit",value:function(){this.clientId=parseInt(this.cookieService.get("globalClientId")),this.onGetBillDetails()}},{key:"getBillPeriods",value:function(){var e=this;this.billPeriods=[{label:"Select",value:0,fromDate:Date.now.toString(),ToDate:Date.now.toString()}],this.billService.getBillPeriods(this.clientId).subscribe((function(t){t.forEach((function(t){e.billPeriods.push({label:t.periodDescription,value:t.id,fromDate:t.periodStart,toDate:t.periodEnd})}))}))}},{key:"onGetBanks",value:function(e){var t=this;this.banks=[{label:"Select",value:0}],this.billSettlementService.getBanks(e).subscribe((function(e){e.forEach((function(e){t.banks.push({label:e.description,value:e.id})}))}))}},{key:"onGetBillDetails",value:function(){var e=this;this.tenantId=this.cookieService.get("ownerId"),this.billSettlementService.getTenantBillDetails(this.tenantId).subscribe({next:function(t){e.billSettlement=t},error:function(t){e.notificationMessage("Outstanding Bills Not Found.","yellow-snackbar")}})}},{key:"onSaveBillPayment",value:function(e){var t=this,i=this.outstandingBillsComponent.selectedRows;i&&i.length&&(this.onGetValues(),this.updateBillPayments(),this.updatePaymentTransactions(),this.billSettlementService.saveBillPayments(this.billPayment).subscribe({next:function(e){e?"Excess Amount"===t.labelName&&t.excessAmount>0&&0!==e?t.saveAdvancePaymentDetails(e):(t.notificationMessage("Bill payment saved successfully","green-snackbar"),t.reset()):t.notificationMessage("Bill payment save failed","green - snackbar")},error:function(e){t.notificationMessage("Bill payment save failed","red-snackbar")}}))}},{key:"updatePaymentTransactions",value:function(){var e=[],t=[];e=this.outstandingBillsComponent.selectedRows,(e=this.outstandingBillsComponent.selectedRows)&&e.length&&e.forEach((function(e){t.push({billId:e.id,paidAmount:e.billAmount,advanceAmount:0})})),this.billPayment.paymentTransactions=t}},{key:"onGetValues",value:function(){this.bankId=this.paymentDetailsComponent.bankId,this.remarks=this.paymentDetailsComponent.remarks,this.paymentModeId=this.paymentDetailsComponent.paymentModeId,this.paymentDate=new Date(this.paymentDetailsComponent.paymentDate),this.refNumber=this.paymentDetailsComponent.refNumber,this.paymentAmount=Number(this.billAmountDetailsComponent.toPay),this.excessAmount=this.billAmountDetailsComponent.excessAmount,this.labelName=this.billAmountDetailsComponent.labelName}},{key:"updateBillPayments",value:function(){this.billPayment={paymentDate:this.date.transform(this.paymentDate,"yyyy-MM-dd"),paymentAmount:Number(this.paymentAmount),clientId:Number(this.cookieService.get("globalClientId")),billType:1,ownerId:this.outstandingBillsComponent.selectedRows[0].ownerId,modeofPayment:this.paymentModeId,paymentReference:this.refNumber,remarks:this.remarks}}},{key:"notificationMessage",value:function(e,t){this.snackbar.open(e,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[t]})}},{key:"onSelectedRows",value:function(e){var t=this;this.selectedRows=[],this.selectedRows=e,this.totAmt=0,this.selectedRows&&this.selectedRows.length?this.selectedRows.forEach((function(e){t.totAmt+=e.toPay})):this.totAmt=0,this.totAmt=Number(this.decimalPipe.transform(this.totAmt,this.roundFormat).replace(",",""))}},{key:"saveAdvancePaymentDetails",value:function(e){var t=this,i={advanceDate:this.paymentDate,paymentId:e,advanceAmount:Number(this.excessAmount)};this.billService.saveAdvancePayment(i).subscribe((function(e){e?(t.notificationMessage("Bill payment saved successfully","green-snackbar"),t.reset()):t.notificationMessage("Bill payment save failed","green - snackbar")}))}},{key:"reset",value:function(){this.bankId=this.paymentDetailsComponent.bankId=0,this.remarks=this.paymentDetailsComponent.remarks="",this.paymentModeId=this.paymentDetailsComponent.paymentModeId=0,this.paymentDate=new Date(Date.now.toString()),this.refNumber=this.paymentDetailsComponent.refNumber="",this.paymentAmount=0,this.billAmountDetailsComponent.toPay="0",this.excessAmount=this.billAmountDetailsComponent.excessAmount=0,this.billSettlement={outstandingBills:[]}}}]),e}()).\u0275fac=function(e){return new(e||gl)(g.Nb(M.a),g.Nb(b.a),g.Nb(B.b),g.Nb(d.g),g.Nb(d.f),g.Nb(w.a),g.Nb(C.a))},gl.\u0275cmp=g.Hb({type:gl,selectors:[["fury-tenant-payment"]],viewQuery:function(e,t){var i;1&e&&(g.Jc(fe,!0),g.Jc(xe,!0),g.Jc(Ne,!0)),2&e&&(g.zc(i=g.cc())&&(t.paymentDetailsComponent=i.first),g.zc(i=g.cc())&&(t.outstandingBillsComponent=i.first),g.zc(i=g.cc())&&(t.billAmountDetailsComponent=i.first))},decls:22,vars:7,consts:[["mode","card"],["color","primary"],["src","assets/img/fav-icon.png",1,"img-style"],[1,"toolbar-spacer"],["fxLayout","column",1,"padding-top",3,"fxLayoutGap"],["fxFlex","noshrink","fxLayout","column","fxLayout.gt-sm","row","fxLayoutAlign.gt-sm","start stretch",3,"fxLayoutGap"],["fxFlex","grow",1,"basic-forms","route-animations-elements",3,"fxFlex.gt-sm"],["fxLayout","row","fxLayoutGap","5%"],["fxLayout","column"],[3,"dataSource","isHide","rowsSelected"],["fxFlex.xs","100%","fxFlex","50%",1,"content"],[2,"width","220px"],["disabled","","type","number","id","totAmtId","name","totAmtNa","matInput","",3,"ngModel","ngModelChange"],["mat-raised-button","","color","primary",1,"button-style"]],template:function(e,t){1&e&&(g.Tb(0,"fury-page-layout",0),g.Tb(1,"mat-toolbar",1),g.Ob(2,"img",2),g.Tb(3,"span"),g.Rc(4,"Tenant Bill Payment"),g.Sb(),g.Ob(5,"span",3),g.Sb(),g.Tb(6,"fury-page-layout-content",4),g.Tb(7,"div",5),g.Tb(8,"fury-card",6),g.Tb(9,"fury-card-header"),g.Tb(10,"fury-card-header-heading"),g.Rc(11,"Outstanding Bills"),g.Sb(),g.Sb(),g.Tb(12,"fury-card-content",7),g.Tb(13,"div",8),g.Tb(14,"fury-tenant-outstanding-bills",9),g.bc("rowsSelected",(function(e){return t.onSelectedRows(e)})),g.Sb(),g.Sb(),g.Tb(15,"div",10),g.Tb(16,"b"),g.Rc(17,"Total Amount"),g.Sb(),g.Tb(18,"mat-form-field",11),g.Tb(19,"input",12),g.bc("ngModelChange",(function(e){return t.totAmt=e})),g.Sb(),g.Sb(),g.Tb(20,"button",13),g.Rc(21,"Proceed To Payment"),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb()),2&e&&(g.Cb(6),g.mc("fxLayoutGap",t.gap),g.Cb(1),g.mc("fxLayoutGap",t.gap),g.Cb(1),g.mc("fxFlex.gt-sm",t.col2)("@fadeInUp",void 0),g.Cb(6),g.mc("dataSource",t.billSettlement)("isHide",!1),g.Cb(5),g.mc("ngModel",t.totAmt))},directives:[te.a,ne.a,ie.a,N.d,N.e,N.b,N.c,S.a,S.d,S.g,S.c,Tl,z.d,s.u,E.b,s.c,s.q,s.t,k.a],styles:[".toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.img-style[_ngcontent-%COMP%]{width:32px}.button-style[_ngcontent-%COMP%]{align-self:center}"],data:{animation:[p.a,f.a]}}),gl),Dl=a("nST0"),wl=((Cl=function(){function e(){l(this,e),this.printClicked=new g.o}return o(e,[{key:"ngOnInit",value:function(){}},{key:"onPrint",value:function(){this.printClicked.emit()}}]),e}()).\u0275fac=function(e){return new(e||Cl)},Cl.\u0275cmp=g.Hb({type:Cl,selectors:[["fury-invoice-aging-report-footer-toolbar"]],outputs:{printClicked:"printClicked"},decls:5,vars:0,consts:[[1,"person"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutAlign","end end","fxLayoutGap.gt-sm","24px"],[1,"fury-flex-form-field"]],template:function(e,t){1&e&&(g.Tb(0,"mat-dialog-content"),g.Tb(1,"div",0),g.Tb(2,"form"),g.Tb(3,"div",1),g.Ob(4,"div",2),g.Sb(),g.Sb(),g.Sb(),g.Sb())},directives:[v.f,s.z,s.r,s.s,N.d,N.c,N.e],styles:[".button[_ngcontent-%COMP%]{line-height:50px}"]}),Cl),Nl=["htmlData"];function xl(e,t){if(1&e){var i=g.Ub();g.Tb(0,"fury-invoice-aging-report-footer-toolbar",21),g.bc("printClicked",(function(){return g.Ec(i),g.fc().onPrintPdf()})),g.Sb()}}var kl,Al=((kl=function(){function e(t,i,n,a,o,r,s,c,u,d){var m,h,b;l(this,e),this.billService=t,this.date=i,this.decimalPipe=n,this.currencyPipe=a,this.snackbar=o,this.jwtHelperService=r,this.cookieService=s,this.clientSelectionService=c,this.clientService=u,this.envService=d,this.role="",this._gap=16,this.gap=this._gap+"px",this.col2="1 1 calc(50% - ".concat(this._gap/2,"px)"),this.col3="1 1 calc(33.3333% - ".concat(this._gap/1.5,"px)"),this.invoiceAgingReport=[],this.selectedRows=[],this.imageProperties=[],this.columns=[],this.columnNames=[],this.billAmount="",this.billPeriodId=0,this.billPeriods=[{label:"Select",value:0}],this.fromDate="",this.toDate="",this.dateFormat="",this.currency="",this.roundFormat="",this.filePath="",this.ownerId=0,this.billNumberColumnName="Account Number",this.ownerNameColumnName="Owner",this.totalBalanceColumnName="Total Balance",this.balance30ColumnName="30 Days",this.balance60ColumnName="60 Days",this.balance90ColumnName="90 Days",this.balance120ColumnName="180 Days",this.balanceabove120ColumnName="Above 180 Days",this.filePath=d.backendForFiles,this.roundFormat=null!==(m=Object(y.e)("RoundOff"))&&void 0!==m?m:d.roundOffFormat,this.currency=null!==(h=Object(y.e)("Currency"))&&void 0!==h?h:d.currencyFormat,this.dateFormat=null!==(b=Object(y.e)("DateFormat"))&&void 0!==b?b:d.dateFormat}return o(e,[{key:"ngOnInit",value:function(){var e;this.today=new Date,this.toDate=(new Date).toISOString().substr(0,10),this.clientSelectionService.setIsClientVisible(!0);var t=this.cookieService.get("access_token"),i=this.jwtHelperService.decodeToken(t);i&&(this.role=i["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"]),this.ownerId=parseInt(null!==(e=this.cookieService.get("ownerId"))&&void 0!==e?e:"0"),this.createColumnNames(),this.createGridColumns(),this.clientId=parseInt(this.cookieService.get("globalClientId")),this.getBillPeriods()}},{key:"createGridColumns",value:function(){this.columns=["accountNumber","owner","totalBalancelocal","balance30Local","balance60Local","balance90Local","balance180Local","balanceAbove180Local"]}},{key:"createColumnNames",value:function(){this.columnNames=[{name:this.billNumberColumnName,property:"accountNumber"},{name:this.ownerNameColumnName,property:"owner"},{name:this.totalBalanceColumnName,property:"totalBalancelocal",columnAlign:{"text-align":"right"}},{name:this.balance30ColumnName,property:"balance30Local",columnAlign:{"text-align":"right"}},{name:this.balance60ColumnName,property:"balance60Local",columnAlign:{"text-align":"right"}},{name:this.balance90ColumnName,property:"balance90Local",columnAlign:{"text-align":"right"}},{name:this.balance120ColumnName,property:"balance180Local",columnAlign:{"text-align":"right"}},{name:this.balanceabove120ColumnName,property:"balanceAbove180Local",columnAlign:{"text-align":"right"}}]}},{key:"ngAfterViewInit",value:function(){}},{key:"getInvoiceAgingReport",value:function(){var e=this;this.billAmount="";var t=0;if(this.toDate){var i=""==this.toDate?"":L(this.toDate).format("YYYY-MM-DD");this.billService.getInvoiceAgingReport(this.clientId,i).subscribe((function(i){e.dateFormat=Object(y.e)("DateFormat"),e.roundFormat=Object(y.e)("RoundOff"),e.currency=Object(y.e)("Currency"),i.forEach((function(i){i.billDatelocal=e.date.transform(i.billDate.toString(),e.dateFormat.toString()),i.totalBalancelocal=e.currencyPipe.transform(i.totalBalance,e.currency.toString(),!0,e.roundFormat),i.balance30Local=e.currencyPipe.transform(i.balance30,e.currency.toString(),!0,e.roundFormat),i.balance60Local=e.currencyPipe.transform(i.balance60,e.currency.toString(),!0,e.roundFormat),i.balance90Local=e.currencyPipe.transform(i.balance90,e.currency.toString(),!0,e.roundFormat),i.balance180Local=e.currencyPipe.transform(i.balance180,e.currency.toString(),!0,e.roundFormat),i.balanceAbove180Local=e.currencyPipe.transform(i.balanceAbove180,e.currency.toString(),!0,e.roundFormat),t+=i.totalBalance})),e.invoiceAgingReport=i,e.billAmount=e.currencyPipe.transform(t,e.currency.toString(),!0,e.roundFormat)}))}else this.snackbar.open("Invalid search parameters",null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:["yellow-snackbar"]})}},{key:"onPrintPdf",value:function(){this.getClientImageProperties()}},{key:"getClientImageProperties",value:function(){var e=this;this.imageProperties=[],this.clientService.getClientImageProperties(this.clientId).subscribe({next:function(t){t&&t.length&&(e.imageProperties=t,e.downloadReport(e.invoiceAgingReport))},error:function(){this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar"),this.downloadReport(this.invoiceAgingReport)}})}},{key:"downloadReport",value:function(e){for(var t=[],i=[],n=[],l=0,a=0;a<e.length;a++)t.push(e[a].accountNumber),t.push(e[a].owner),t.push(e[a].totalBalancelocal),t.push(e[a].balance30Local),t.push(e[a].balance60Local),t.push(e[a].balance90Local),t.push(e[a].balance180Local),t.push(e[a].balanceAbove180Local),i.push(t),l+=e[a].totalBalance,t=[];n.push({label:"Total Amount",value1:l});for(var o=0;o<n.length;o++)t.push(""),t.push(n[o].label),t.push(this.currencyPipe.transform(n[o].value1,this.currency.toString(),!0,this.roundFormat)),t.push(""),t.push(""),t.push(""),t.push(""),t.push(""),i.push(t),t=[];this.getSummaryReport(this.invoiceAgingReport,["Account Number","Owner","Total Balance","Balance 30","Balance 60 ","Balance 90 ","Balance 180","Balance Above 180"],i,"Invoice Aging Report")}},{key:"getSummaryReport",value:function(e,t,i,n){var l,a=new Image;a.src=this.filePath+"/uploads/"+(null===(l=this.imageProperties[0])||void 0===l?void 0:l.photo);var o=new Fe.default({orientation:"landscape",unit:"pt",format:"letter"}),r=L().format("M/D/YYYY hh:mm:ss a");if(o.rect(5,5,o.internal.pageSize.width-10,o.internal.pageSize.height-10,"S"),o.setFontSize(30),a&&e&&this.imageProperties&&this.imageProperties.length){var s=this.imageProperties.find((function(e){return"landscape"===e.imageType.trim().toLowerCase()}));s&&(a.onload=function(){o.addImage(a,s.imgX,s.imgY,s.imgW,s.imgH)})}o.setTextColor(25,118,210),o.setFontSize(9),o.setFont("Cambria"),o.setTextColor(0,0,0),o.text("Print Date: "+r,o.internal.pageSize.width-150,20),o.setFontSize(14),o.text("Invoice Aging Report ",o.internal.pageSize.width/2-50,60),o.setFontSize(9),Number(this.decimalPipe.transform(o.autoTable.previous.finalY,"1.0-0")),o.autoTable(t,i,{startX:10,startY:80,didDrawPage:function(e){var t="Page "+e.pageCount;"function"==typeof o.putTotalPages&&(t+=" of 1"),o.setFontSize(9);var i=o.internal.pageSize.height||o.internal.pageSize.getHeight();o.text(t,e.settings.margin.left,i-10)},styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:100,left:20},theme:"grid",tableWidth:"auto",columnStyles:{0:{cellWidth:"wrap",halign:"left"},1:{cellWidth:100,halign:"left"},2:{cellWidth:"wrap",halign:"right"},3:{cellWidth:"wrap",halign:"right"},4:{cellWidth:"wrap",halign:"right"},5:{cellWidth:"wrap",halign:"right"},6:{cellWidth:"wrap",halign:"right"},7:{cellWidth:"wrap",halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]}});var c=o.output("blob");window.open(URL.createObjectURL(c))}},{key:"notificationMessage",value:function(e,t){this.snackbar.open(e,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[t]})}},{key:"getJsonData",value:function(){var e=this;this.tableData=[];var t=0;if(null!=this.invoiceAgingReport){this.invoiceAgingReport.forEach((function(i){var n={AccountNumber:i.accountNumber,Owner:i.owner,TotalBalance:i.totalBalancelocal,"30Days":i.balance30Local,"60Days":i.balance60Local,"90Days":i.balance90Local,"180Days":i.balance180Local,Above180Days:i.balanceAbove180Local};t+=Number(n.TotalBalance.replace(/[^0-9\.-]+/g,"")),e.tableData.push(n)}));var i={AccountNumber:"",Owner:"Total Amount",TotalBalance:this.currencyPipe.transform(t,this.currency.toString(),!0,this.roundFormat.toString())};this.tableData.push(i)}}},{key:"onExport",value:function(){if(this.invoiceAgingReport&&this.invoiceAgingReport.length>0){if(this.getJsonData(),null!=this.tableData&&this.tableData.length>0){var e=jt.utils.json_to_sheet(this.tableData),t=jt.utils.book_new();jt.utils.book_append_sheet(t,e,"Sheet1"),jt.writeFile(t,"Invoice Aging Report.xlsx")}}else this.notificationMessage("No Data to Export","yellow-snackbar")}},{key:"getBillPeriods",value:function(){var e=this;this.clientId=parseInt(this.cookieService.get("globalClientId")),this.billPeriods=[{label:"Select",value:0,fromDate:Date.now.toString(),ToDate:Date.now.toString()}],this.billService.getBillPeriods(this.clientId).subscribe((function(t){t.forEach((function(t){e.billPeriods.push({label:t.periodDescription,value:t.id,fromDate:t.periodStart,toDate:t.periodEnd})}))}))}},{key:"onChangeBillPeriod",value:function(e){this.billPeriodId=e}},{key:"visibleColumns",get:function(){return this.columns.filter((function(e){return e.visible})).map((function(e){return e.property}))}}]),e}()).\u0275fac=function(e){return new(e||kl)(g.Nb(b.a),g.Nb(d.f),g.Nb(d.g),g.Nb(d.d),g.Nb(B.b),g.Nb(D.a),g.Nb(w.a),g.Nb(Z.a),g.Nb(Dl.a),g.Nb(C.a))},kl.\u0275cmp=g.Hb({type:kl,selectors:[["invoice-aging-report"]],viewQuery:function(e,t){var i;1&e&&g.Vc(Nl,!0),2&e&&g.zc(i=g.cc())&&(t.htmlData=i.first)},decls:32,vars:12,consts:[["mode","card",2,"margin-top","27px"],["fxLayout","column",1,"content"],["color","primary",1,"position-fixed"],["src","assets/img/fav-icon.png",1,"img-style"],[1,"example-spacer"],[3,"printClicked",4,"ngIf"],["matTooltip","Export","mat-icon-button","","aria-label","Example icon-button with menu icon",1,"example-icon",3,"click"],["fxFlex","noshrink","fxLayout","column","fxLayout.gt-sm","row","fxLayoutAlign.gt-sm","start stretch",3,"fxLayoutGap"],["fxFlex","grow",1,"basic-forms","route-animations-elements",3,"fxFlex.gt-sm"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","16px",1,"padding-top",2,"padding-left","25px"],["color","primary",1,"result"],["id","toDate","name","toDate","matInput","","readonly","",3,"ngModel","max","matDatepicker","click","ngModelChange","focus"],["matSuffix","",3,"for"],["formDatepickerRef2",""],[1,"fury-flex-form-field","seach-icon"],[3,"click"],["fxLayout","column"],["fxLayout","column",1,"padding-top"],[3,"tableData","columnsToDisplay","columnNames"],["fxLayout.gt-sm","row","fxLayout","column","fxLayoutAlign","center start","fxLayoutGap.gt-sm","12px",1,"result","padding-top"],["type","text","id","billAmount","name","billAmount","matInput","",2,"text-align","right",3,"ngModel","ngModelChange"],[3,"printClicked"]],template:function(e,t){if(1&e){var i=g.Ub();g.Tb(0,"fury-page-layout",0),g.Tb(1,"fury-page-layout-content",1),g.Tb(2,"mat-toolbar",2),g.Ob(3,"img",3),g.Tb(4,"span"),g.Rc(5,"Invoice Aging Report"),g.Sb(),g.Ob(6,"span",4),g.Pc(7,xl,1,0,"fury-invoice-aging-report-footer-toolbar",5),g.Tb(8,"button",6),g.bc("click",(function(){return t.onExport()})),g.Tb(9,"mat-icon"),g.Rc(10,"import_export"),g.Sb(),g.Sb(),g.Sb(),g.Tb(11,"div",7),g.Tb(12,"fury-card",8),g.Tb(13,"div",9),g.Tb(14,"mat-form-field",10),g.Tb(15,"mat-label"),g.Rc(16,"As of Date"),g.Sb(),g.Tb(17,"input",11),g.bc("click",(function(){return g.Ec(i),g.Ac(20).open()}))("ngModelChange",(function(e){return t.toDate=e}))("focus",(function(){return g.Ec(i),g.Ac(20).open()})),g.Sb(),g.Ob(18,"mat-datepicker-toggle",12),g.Ob(19,"mat-datepicker",null,13),g.Sb(),g.Tb(21,"div",14),g.Tb(22,"mat-icon",15),g.bc("click",(function(){return t.getInvoiceAgingReport()})),g.Rc(23,"search"),g.Sb(),g.Sb(),g.Sb(),g.Tb(24,"fury-card-content",16),g.Tb(25,"div",17),g.Ob(26,"fury-expandable-table-structure",18),g.Sb(),g.Tb(27,"div",19),g.Tb(28,"mat-form-field",10),g.Tb(29,"mat-label"),g.Rc(30,"Total"),g.Sb(),g.Tb(31,"input",20),g.bc("ngModelChange",(function(e){return t.billAmount=e})),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb()}if(2&e){var n=g.Ac(20);g.Cb(7),g.mc("ngIf",0==t.ownerId),g.Cb(4),g.mc("fxLayoutGap",t.gap),g.Cb(1),g.mc("fxFlex.gt-sm",t.col2)("@fadeInUp",void 0),g.Cb(5),g.mc("ngModel",t.toDate)("max",t.today)("matDatepicker",n),g.Cb(1),g.mc("for",n),g.Cb(8),g.mc("tableData",t.invoiceAgingReport)("columnsToDisplay",t.columns)("columnNames",t.columnNames),g.Cb(5),g.mc("ngModel",t.billAmount)}},directives:[te.a,ie.a,N.d,ne.a,d.o,k.a,A.a,F.a,N.b,N.c,N.e,S.a,z.d,z.h,E.b,s.c,Y.b,s.q,s.t,Y.d,z.j,Y.a,S.c,x.a,wl],styles:[".padding[_ngcontent-%COMP%]{padding:0 0 24px}.example-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.content[_ngcontent-%COMP%]{margin-top:2%}.img-style[_ngcontent-%COMP%]{width:32px}.button[_ngcontent-%COMP%]{line-height:50px}.left-margin[_ngcontent-%COMP%]{margin-left:30px}.seach-icon[_ngcontent-%COMP%]{vertical-align:middle;padding-top:1%;margin-left:1%;cursor:pointer}.position-fixed[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;top:0;z-index:5}"],data:{animation:[p.a,f.a]}}),kl),Fl=["TABLE"];function Rl(e,t){if(1&e&&(g.Tb(0,"th",9),g.Rc(1),g.Sb()),2&e){var i=g.fc().$implicit,n=g.fc();g.Cb(1),g.Sc(n.capitalize(i))}}function Il(e,t){if(1&e&&(g.Tb(0,"td",10),g.Rc(1),g.Sb()),2&e){var i=t.$implicit,n=g.fc().$implicit;g.Cb(1),g.Sc(i[n])}}function Ol(e,t){1&e&&(g.Rb(0,6),g.Pc(1,Rl,2,1,"th",7),g.Pc(2,Il,2,1,"td",8),g.Qb()),2&e&&g.mc("matColumnDef",t.$implicit)}function Wl(e,t){1&e&&g.Ob(0,"tr",11)}function Ml(e,t){1&e&&g.Ob(0,"tr",12)}var Ll,Bl=((Ll=function(){function e(){l(this,e),this.tableData=[],this.columnNames=[]}return o(e,[{key:"ngOnInit",value:function(){}},{key:"capitalize",value:function(e){return(e=e.replace("Local","")).charAt(0).toUpperCase()+e.slice(1)}}]),e}()).\u0275fac=function(e){return new(e||Ll)},Ll.\u0275cmp=g.Hb({type:Ll,selectors:[["fury-dynamic-table-structure"]],viewQuery:function(e,t){var i;1&e&&g.Vc(Fl,!0),2&e&&g.zc(i=g.cc())&&(t.table=i.first)},inputs:{tableData:"tableData",columnNames:"columnNames"},decls:6,vars:4,consts:[[1,"example-container","mat-elevation-z8"],["TABLE",""],["mat-table","",1,"mat-elevation-z8",3,"dataSource"],[3,"matColumnDef",4,"ngFor","ngForOf"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[3,"matColumnDef"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-cell",""],["mat-cell",""],["mat-header-row",""],["mat-row",""]],template:function(e,t){1&e&&(g.Tb(0,"div",0,1),g.Tb(2,"table",2),g.Pc(3,Ol,3,1,"ng-container",3),g.Pc(4,Wl,1,0,"tr",4),g.Pc(5,Ml,1,0,"tr",5),g.Sb(),g.Sb()),2&e&&(g.Cb(2),g.mc("dataSource",t.tableData),g.Cb(1),g.mc("ngForOf",t.columnNames),g.Cb(1),g.mc("matHeaderRowDef",t.columnNames),g.Cb(1),g.mc("matRowDefColumns",t.columnNames))},directives:[ye.j,d.n,ye.g,ye.i,ye.c,ye.e,ye.b,ye.d,ye.a,ye.f,ye.h],styles:["h3[_ngcontent-%COMP%]{font-family:Verdana}table[_ngcontent-%COMP%]{width:100%}"]}),Ll);function zl(e,t){if(1&e&&(g.Tb(0,"mat-option",16),g.Rc(1),g.Sb()),2&e){var i=t.$implicit;g.mc("value",i.value),g.Cb(1),g.Tc("",i.label," ")}}function Ul(e,t){if(1&e&&(g.Tb(0,"th",27),g.Rc(1),g.Sb()),2&e){var i=g.fc().$implicit;g.Cb(1),g.Tc(" ",i.name,"")}}function El(e,t){if(1&e&&(g.Tb(0,"td",28),g.Rc(1),g.Sb()),2&e){var i=t.$implicit,n=g.fc().$implicit;g.mc("ngStyle",n.columnAlign),g.Cb(1),g.Tc(" ",i[n.property]," ")}}function jl(e,t){1&e&&(g.Rb(0,24),g.Pc(1,Ul,2,1,"th",25),g.Pc(2,El,2,2,"td",26),g.Qb()),2&e&&g.mc("matColumnDef",t.$implicit.property)}function Hl(e,t){1&e&&g.Ob(0,"tr",29)}function Yl(e,t){1&e&&g.Ob(0,"tr",30)}function Vl(e,t){if(1&e&&(g.Tb(0,"div",17),g.Tb(1,"fury-list",18),g.Tb(2,"table",19),g.Pc(3,jl,3,1,"ng-container",20),g.Pc(4,Hl,1,0,"tr",21),g.Pc(5,Yl,1,0,"tr",22),g.Sb(),g.Ob(6,"mat-paginator",23),g.Sb(),g.Sb()),2&e){var i=g.fc();g.Cb(1),g.mc("hideHeader",!0)("hideFilter",!0),g.Cb(1),g.mc("dataSource",i.dataSource),g.Cb(1),g.mc("ngForOf",i.columnNames),g.Cb(1),g.mc("matHeaderRowDef",i.visibleColumns),g.Cb(1),g.mc("matRowDefColumns",i.visibleColumns),g.Cb(1),g.mc("pageSize",i.pageSize)}}function _l(e,t){if(1&e){var i=g.Ub();g.Tb(0,"mat-form-field",8),g.Tb(1,"mat-label"),g.Rc(2,"Bill Amount"),g.Sb(),g.Tb(3,"input",31),g.bc("ngModelChange",(function(e){return g.Ec(i),g.fc().billAmount=e})),g.Sb(),g.Sb()}if(2&e){var n=g.fc();g.Cb(3),g.mc("ngModel",n.billAmount)}}var Gl,Xl,ql=((Xl=function(){function e(t,i,n,a,o,r,s,c,u,d,m){l(this,e),this.billService=t,this.currency=i,this.decimalPipe=n,this.date=a,this.templateService=o,this.jwtHelperService=r,this.snackbar=s,this.cookieService=c,this.clientSelectionService=u,this.clientService=d,this.envService=m,this.subject$=new Bn.a(1),this.data$=this.subject$.asObservable(),this.selectedRows=[],this.columns=[],this.columnNames=[],this.imageProperties=[],this.currencyFormat=Object(y.e)("Currency"),this.roundOffFormat=Object(y.e)("RoundOff"),this.consumptionRoundOffFormat=Object(y.e)("ConsumptionRoundOff"),this.dateFormat=Object(y.e)("DateFormat"),this.filePath="",this.fromDate=Date.UTC.toString(),this.toDate=Date.UTC.toString(),this.billPeriodId=0,this.billPeriods=[{label:"Select",value:0}],this.billCharges="",this.vatAmount="",this.billAmount="",this.billNumberColumnName="Bill Number",this.billDateLocalColumnName="Bill Date",this.customerNameColumnName="Customer Name",this.unitNumberColumnName="Unit Number",this.meterNumberColumnName="Meter Number",this.consumptionsLocalColumnName="Consumptions",this.consumptionLocalColumnName="Consumption Charge",this.billChargeLocalColumnName="Bill Charge",this.vatLocalColumnName="VAT",this.billAmountLocalColumnName="Bill Amount",this.pageSize=7,this.filePath=m.backendForFiles}return o(e,[{key:"createGridColumns",value:function(){this.columns=["billNumber","billDateLocal","customerName","unitNumber","meterNumber","consumptions","consumptionLocal","billChargeLocal","vatLocal","billAmountLocal"]}},{key:"createColumnNames",value:function(){}},{key:"ngOnInit",value:function(){this.clientSelectionService.setIsClientVisible(!0),this.createColumnNames(),this.createGridColumns(),this.getBillPeriods()}},{key:"getBillPeriods",value:function(){var e=this;this.clientId=parseInt(this.cookieService.get("globalClientId")),this.billPeriods=[{label:"Select",value:0,fromDate:Date.now.toString(),ToDate:Date.now.toString()}],this.billService.getBillPeriods(this.clientId).subscribe((function(t){t.forEach((function(t){e.billPeriods.push({label:t.periodDescription,value:t.id,fromDate:t.periodStart,toDate:t.periodEnd})}))}))}},{key:"onChangeBillPeriod",value:function(e){var t=this;if(this.billPeriodId=e,this.billPeriodId){var i=this.billPeriods.find((function(e){return e.value===t.billPeriodId}));i&&(this.fromDate=""===i.fromDate?"":L(i.fromDate).format("YYYY-MM-DD"),this.toDate=""===i.toDate?"":L(i.toDate).format("YYYY-MM-DD"))}}},{key:"getConsolidatedData",value:function(){var e=this;this.billAmount="",this.billCharges="",this.vatAmount="";var t=0,i=0,n=0;this.consolidatedData=[],this.dateFormat=Object(y.e)("DateFormat"),this.roundOffFormat=Object(y.e)("RoundOff"),this.currencyFormat=Object(y.e)("Currency",0),this.billAmount=this.currency.transform(0,this.currencyFormat.toString(),!0,this.roundOffFormat),this.billCharges=this.currency.transform(0,this.currencyFormat.toString(),!0,this.roundOffFormat),this.vatAmount=this.currency.transform(0,this.currencyFormat.toString(),!0,this.roundOffFormat),this.clientId=parseInt(this.cookieService.get("globalClientId")),this.billService.getConsolidatedData(this.clientId,this.billPeriodId).subscribe((function(l){for(var a in e.consolidatedData=l,l.forEach((function(e){i+=null==e.Bill_Charge?0:e.Bill_Charge,t+=null==e.Bill_Amount?0:e.Bill_Amount,n+=e.VAT})),e.subject$.next(l),e.consolidatedData=l,e.columnNames=[],Object.keys(l[0]).forEach((function(t){e.columnNames.find((function(e){return e===t.replace("Local","")}))||e.columnNames.push({name:t.replace("Local","").replace("_"," "),property:t,visible:!0,isModelProperty:!0,columnAlign:t.includes("_Amount")?{"text-align":"right"}:{"text-align":"left"}})})),e.billAmount=e.currency.transform(t,e.currencyFormat.toString(),!0,e.roundOffFormat),e.billCharges=e.currency.transform(i,e.currencyFormat.toString(),!0,e.roundOffFormat),e.vatAmount=e.currency.transform(n,e.currencyFormat.toString(),!0,e.roundOffFormat),e.consolidatedData.forEach((function(t){for(var i in t)i.includes("_Amount")&&(t[i]=e.currency.transform(t[i],e.currencyFormat.toString(),!0,e.roundOffFormat));e.consumptionRoundOffFormat=Object(y.e)("ConsumptionRoundOff",t.UtilityTypeId,t.Utility_Type),t.Consumptions=e.decimalPipe.transform(t.Consumptions,e.consumptionRoundOffFormat)})),e.columnNames)"Bill_Amount"!=e.columnNames[a].name&&e.columnNames[a].name.includes("_Amount")&&(e.columnNames[a].name=e.columnNames[a].name.replace("_Amount","").replace("_"," "));e.dataSource=new ye.k(e.consolidatedData),e.data$.pipe(Object(zn.a)((function(e){return!e}))).subscribe((function(t){e.consolidatedData=t,e.dataSource.data=t})),e.ngAfterViewInit()}))}},{key:"ngAfterViewInit",value:function(){null!=this.dataSource&&(this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort)}},{key:"notificationMessage",value:function(e,t){this.snackbar.open(e,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[t]})}},{key:"onSelectedRows",value:function(e){this.selectedRows=[],this.selectedRows=e}},{key:"onSendEmail",value:function(){var e=this;this.consolidatedData&&this.templateService.emailCustomTemplate({notificationType:"EMAIL",templateType:"customized",templateName:"customized",billMasterDetails:this.consolidatedData}).subscribe((function(t){e.notificationMessage("Email send successfully.","green-snackbar")}))}},{key:"onPrintSummary",value:function(){this.getClientImageProperties()}},{key:"getClientImageProperties",value:function(){var e=this;this.imageProperties=[],this.clientService.getClientImageProperties(this.clientId).subscribe({next:function(t){t&&t.length&&(e.imageProperties=t,e.downloadSummary(e.consolidatedData))},error:function(){this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar"),this.downloadSummary(this.consolidatedData)}})}},{key:"downloadSummary",value:function(e){var t=[],i=[],n=[],l=[],a=0,o=e[0];for(var r in o)"bill_amount"!=r.toLowerCase()&&(r=r.replace("_Amount","")),r=r.replace("_"," "),l.push(r.replace("_"," "));for(var s=0;s<e.length;s++){for(var c in o)"UtilityTypeId"!=c&&t.push(e[s][c]);i.push(t);var u=0;e[s]&&e[s].Bill_Amount&&(u=Number(e[s].Bill_Amount.replace(/[^0-9.-]+/g,""))),a+=u,e[s].VAT,e[s].BillCharge,t=[]}n.push({label:"Total Amount",value2:a});for(var d=0;d<l.length-4;d++)t.push("");t.push(n[0].label),t.push(this.currency.transform(n[0].value0,this.currencyFormat.toString(),!0,this.roundOffFormat)),t.push(this.currency.transform(n[0].value1,this.currencyFormat.toString(),!0,this.roundOffFormat)),t.push(this.currency.transform(n[0].value2,this.currencyFormat.toString(),!0,this.roundOffFormat)),i.push(t),t=[],this.getSummaryReport(this.consolidatedData,l,i,"Consolidated Report")}},{key:"getSummaryReport",value:function(e,t,i,n){var l,a=new Image;a.src=this.filePath+"/uploads/"+(null===(l=this.imageProperties[0])||void 0===l?void 0:l.photo);var o=new Fe.default({orientation:"landscape",unit:"pt",format:"letter"}),r=L().format("M/D/YYYY hh:mm:ss a");if(o.rect(5,5,o.internal.pageSize.width-10,o.internal.pageSize.height-10,"S"),o.setFontSize(30),a&&e&&this.imageProperties&&this.imageProperties.length){var s=this.imageProperties.find((function(e){return"landscape"===e.imageType.trim().toLowerCase()}));s&&(a.onload=function(){o.addImage(a,s.imgX,s.imgY,s.imgW,s.imgH)})}o.setTextColor(25,118,210),o.setFontSize(9),o.setFont("Cambria"),o.setTextColor(0,0,0),o.text("Print Date: "+r,o.internal.pageSize.width-150,20),o.setFontSize(14),o.text("Consolidated Report",o.internal.pageSize.width/2-80,70),o.setFontSize(9),Number(o.autoTable.previous.finalY),o.autoTable(t,i,{startX:10,startY:80,didDrawPage:function(e){var t="Page "+e.pageCount;"function"==typeof o.putTotalPages&&(t+=" of 1"),o.setFontSize(9);var i=o.internal.pageSize.height||o.internal.pageSize.getHeight();o.text(t,e.settings.margin.left,i-10)},styles:{overflow:"linebreak",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:100,left:15},theme:"grid",tableWidth:"auto",columnStyles:{0:{cellWidth:"wrap",halign:"left"},1:{cellWidth:"wrap",halign:"center"},2:{cellWidth:"wrap",halign:"left"},3:{cellWidth:"wrap",halign:"center"},4:{cellWidth:"wrap",halign:"center"},5:{cellWidth:"wrap",halign:"right"},6:{cellWidth:"wrap",halign:"right"},7:{cellWidth:"wrap",halign:"right"},8:{cellWidth:"wrap",halign:"right"},9:{cellWidth:"wrap",halign:"right"},10:{cellWidth:"wrap",halign:"right"},11:{cellWidth:"wrap",halign:"center"},12:{cellWidth:"wrap",halign:"center"},13:{cellWidth:"wrap",halign:"right"},14:{cellWidth:"wrap",halign:"right"},15:{cellWidth:"wrap",halign:"right"},16:{cellWidth:"wrap",halign:"right"},17:{cellWidth:"wrap",halign:"right"},18:{cellWidth:"wrap",halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]}});var c=o.output("blob");window.open(URL.createObjectURL(c))}},{key:"getJsonData",value:function(){var e=this;this.tableData=[],null!=this.consolidatedData&&(this.consolidatedData.forEach((function(t){e.tableData.push(Object.assign({},t))})),this.tableData=this.renameKeysForPassedInObjectWithCustomFilters(this.tableData))}},{key:"renameKeysForPassedInObjectWithCustomFilters",value:function(e){return e.forEach((function(e){for(var t in e){var i=t.replace(/_/g," ");i.includes("Amount")&&"Bill Amount"!==i&&(i=i.replace("Amount","").trim()),e[i]=e[t],delete e[t]}})),e}},{key:"onExport",value:function(){if(this.dataSource.data&&this.dataSource.data.length>0){if(this.getJsonData(),null!=this.tableData){var e=jt.utils.json_to_sheet(this.tableData),t=jt.utils.book_new();jt.utils.book_append_sheet(t,e,"Sheet1"),jt.writeFile(t,"Consolidated Report.xlsx")}}else this.notificationMessage("No Data to Export","yellow-snackbar")}},{key:"onFilterChange",value:function(e){this.dataSource&&(e=(e=e.trim()).toLowerCase(),this.dataSource.filter=e)}},{key:"paginator",set:function(e){this.dataSource&&(this.dataSource.paginator=e)}},{key:"sort",set:function(e){this.dataSource&&(this.dataSource.sort=e)}},{key:"visibleColumns",get:function(){return this.columnNames.filter((function(e){return!e.property.includes("Id")})).map((function(e){return e.property}))}}]),e}()).\u0275fac=function(e){return new(e||Xl)(g.Nb(b.a),g.Nb(d.d),g.Nb(d.g),g.Nb(d.f),g.Nb(Ae.a),g.Nb(D.a),g.Nb(B.b),g.Nb(w.a),g.Nb(Z.a),g.Nb(Dl.a),g.Nb(C.a))},Xl.\u0275cmp=g.Hb({type:Xl,selectors:[["fury-create-consolidated"]],viewQuery:function(e,t){var i;1&e&&(g.Vc(Ht.a,!0),g.Vc(Yt.a,!0),g.Vc(Bl,!0)),2&e&&(g.zc(i=g.cc())&&(t.paginator=i.first),g.zc(i=g.cc())&&(t.sort=i.first),g.zc(i=g.cc())&&(t.dynamicTableStructureComponent=i.first))},decls:23,vars:7,consts:[["mode","card",2,"margin-top","27px"],["fxLayout","column"],["color","primary",1,"position-fixed"],["src","assets/img/fav-icon.png",1,"img-style"],[1,"toolbar-spacer"],[3,"show","visible","sendEmailClicked","printClicked","exportClicked"],["fxFlex","grow",1,"basic-forms","route-animations-elements"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","6px",1,"padding-top"],["color","primary",1,"result"],["id","BillPeriod","name","BillPeriod",3,"value","selectionChange","valueChange"],[3,"value",4,"ngFor","ngForOf"],[1,"fury-flex-form-field","seach-icon"],[3,"click"],["class","padding","fxLayout","column",4,"ngIf"],["fxLayout.gt-sm","row","fxLayout","column","fxLayoutAlign","end end","fxLayoutGap.gt-sm","12px",1,"result"],["class","result","color","primary",4,"ngIf"],[3,"value"],["fxLayout","column",1,"padding"],["fxFlex","grow","fxLayout","column",1,"list",2,"display","inline-block",3,"hideHeader","hideFilter"],["mat-table","","matSort","",3,"dataSource"],[3,"matColumnDef",4,"ngFor","ngForOf"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[1,"paginator",3,"pageSize"],[3,"matColumnDef"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",3,"ngStyle",4,"matCellDef"],["mat-header-cell","","mat-sort-header",""],["mat-cell","",3,"ngStyle"],["mat-header-row",""],["mat-row",""],["type","text","id","billAmount","name","billAmount","matInput","",2,"text-align","right",3,"ngModel","ngModelChange"]],template:function(e,t){1&e&&(g.Tb(0,"fury-page-layout",0),g.Tb(1,"fury-page-layout-content",1),g.Tb(2,"mat-toolbar",2),g.Ob(3,"img",3),g.Tb(4,"span"),g.Rc(5,"Consolidated Report"),g.Sb(),g.Ob(6,"span",4),g.Tb(7,"fury-payment-history-footer-toolbar",5),g.bc("sendEmailClicked",(function(){return t.onSendEmail()}))("printClicked",(function(){return t.onPrintSummary()}))("exportClicked",(function(){return t.onExport()})),g.Sb(),g.Sb(),g.Tb(8,"fury-card",6),g.Tb(9,"fury-card-content"),g.Tb(10,"form"),g.Tb(11,"div",7),g.Tb(12,"mat-form-field",8),g.Tb(13,"mat-label"),g.Rc(14,"Bill Period"),g.Sb(),g.Tb(15,"mat-select",9),g.bc("selectionChange",(function(e){return t.onChangeBillPeriod(e.value)}))("valueChange",(function(e){return t.billPeriodId=e})),g.Pc(16,zl,2,2,"mat-option",10),g.Sb(),g.Sb(),g.Tb(17,"div",11),g.Tb(18,"mat-icon",12),g.bc("click",(function(){return t.getConsolidatedData()})),g.Rc(19,"search"),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Pc(20,Vl,7,7,"div",13),g.Tb(21,"div",14),g.Pc(22,_l,4,1,"mat-form-field",15),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb()),2&e&&(g.Cb(7),g.mc("show",!1)("visible",!1),g.Cb(1),g.mc("@fadeInUp",void 0),g.Cb(7),g.mc("value",t.billPeriodId),g.Cb(1),g.mc("ngForOf",t.billPeriods),g.Cb(4),g.mc("ngIf",t.consolidatedData&&t.consolidatedData.length>0),g.Cb(2),g.mc("ngIf",t.consolidatedData&&t.consolidatedData.length))},directives:[te.a,ie.a,N.d,ne.a,ki.a,S.a,N.b,S.c,s.z,s.r,s.s,N.e,z.d,z.h,U.a,d.n,F.a,d.o,N.c,H.n,Vt.a,ye.j,Yt.a,ye.g,ye.i,Ht.a,ye.c,ye.e,ye.b,ye.d,Yt.b,ye.a,d.p,Ie.c,ye.f,ye.h,E.b,s.c,s.q,s.t],styles:[".toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.padding[_ngcontent-%COMP%]{padding:20px 0;width:100%;height:100%;overflow:scroll}.seach-icon[_ngcontent-%COMP%]{vertical-align:middle;padding-top:1%;margin-left:1%;cursor:pointer}.img-style[_ngcontent-%COMP%]{width:32px}.position-fixed[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;top:0;z-index:5}"],data:{animation:[p.a,f.a]}}),Xl),$l=((Gl=function(){function e(){l(this,e),this.printClicked=new g.o,this.exportClicked=new g.o}return o(e,[{key:"ngOnInit",value:function(){}},{key:"onPrint",value:function(){this.printClicked.emit()}},{key:"onExport",value:function(){this.exportClicked.emit()}}]),e}()).\u0275fac=function(e){return new(e||Gl)},Gl.\u0275cmp=g.Hb({type:Gl,selectors:[["fury-credit-note-history-details"]],outputs:{printClicked:"printClicked",exportClicked:"exportClicked"},decls:10,vars:0,consts:[[1,"person"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","10px"],[1,"fury-flex-form-field"],["matTooltip","Print","mat-icon-button","",1,"example-icon",3,"click"],["matTooltip","Export","mat-icon-button","","aria-label","Example icon-button with menu icon",1,"example-icon",3,"click"]],template:function(e,t){1&e&&(g.Tb(0,"mat-dialog-content"),g.Tb(1,"div",0),g.Tb(2,"div",1),g.Tb(3,"div",2),g.Tb(4,"button",3),g.bc("click",(function(){return t.onPrint()})),g.Tb(5,"mat-icon"),g.Rc(6,"print"),g.Sb(),g.Sb(),g.Tb(7,"button",4),g.bc("click",(function(){return t.onExport()})),g.Tb(8,"mat-icon"),g.Rc(9,"import_export"),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb())},directives:[v.f,N.d,N.e,k.a,A.a,F.a],styles:[""]}),Gl);function Jl(e,t){if(1&e){var i=g.Ub();g.Tb(0,"mat-form-field",2),g.Tb(1,"mat-label"),g.Rc(2,"Unit Number"),g.Sb(),g.Tb(3,"input",11),g.bc("ngModelChange",(function(e){return g.Ec(i),g.fc().unitNumber=e})),g.Sb(),g.Sb()}if(2&e){var n=g.fc();g.Cb(3),g.mc("ngModel",n.unitNumber)}}function Ql(e,t){if(1&e&&(g.Tb(0,"mat-option",14),g.Rc(1),g.Sb()),2&e){var i=t.$implicit;g.mc("value",i.value),g.Cb(1),g.Tc("",i.label," ")}}function Kl(e,t){if(1&e){var i=g.Ub();g.Tb(0,"mat-form-field",2),g.Tb(1,"mat-label"),g.Rc(2,"Bill Period"),g.Sb(),g.Tb(3,"mat-select",12),g.bc("selectionChange",(function(e){return g.Ec(i),g.fc().onChangeBillPeriod(e.value)}))("valueChange",(function(e){return g.Ec(i),g.fc().billPeriodId=e})),g.Pc(4,Ql,2,2,"mat-option",13),g.Sb(),g.Tb(5,"mat-hint"),g.Rc(6,"Please select a Bill period"),g.Sb(),g.Sb()}if(2&e){var n=g.fc();g.Cb(3),g.mc("value",n.billPeriodId),g.Cb(1),g.mc("ngForOf",n.billPeriods)}}var Zl,ea,ta=((ea=function(){function e(t,i){l(this,e),this.snackbar=t,this.date=i,this.billPeriods=[],this.billTypes=[],this.isHide=!0,this.searchClicked=new g.o,this.billTypeChanged=new g.o,this.manageParams={},this.tenantId=0,this.fromDate="",this.toDate="",this.unitNumber="",this.billPeriodId=0,this.billTypeId=0,this.billType="",this.role="",this.ownerId=0}return o(e,[{key:"ngOnInit",value:function(){}},{key:"onSearch",value:function(){this.fromDate&&this.toDate||this.billPeriodId||this.ownerId>0?(this.manageParams={fromDate:""+(""==this.fromDate?"":L(this.fromDate).format("YYYY-MM-DD")),toDate:""+(""==this.toDate?"":L(this.toDate).format("YYYY-MM-DD")),billPeriodId:""+this.billPeriodId},this.searchClicked.emit(this.manageParams)):this.snackbar.open("Invalid search parameters",null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:["yellow-snackbar"]})}},{key:"onChangeBillPeriod",value:function(e){this.billPeriodId=e}}]),e}()).\u0275fac=function(e){return new(e||ea)(g.Nb(B.b),g.Nb(d.f))},ea.\u0275cmp=g.Hb({type:ea,selectors:[["fury-credit-note-history-toolbar"]],inputs:{billPeriods:"billPeriods",billTypes:"billTypes",isHide:"isHide"},outputs:{searchClicked:"searchClicked",billTypeChanged:"billTypeChanged"},decls:24,vars:8,consts:[[1,"person"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","8px"],["color","primary",1,"result"],["id","fromDate","name","fromDate","matInput","","readonly","",3,"ngModel","matDatepicker","click","ngModelChange","focus"],["matSuffix","",3,"for"],["formDatepickerRef1",""],["id","toDate","name","toDate","matInput","","readonly","",3,"ngModel","matDatepicker","click","ngModelChange","focus"],["formDatepickerRef2",""],["class","result","color","primary",4,"ngIf"],[1,"fury-flex-form-field"],["mat-icon-button","","aria-label","Example icon-button with menu icon",1,"example-icon",3,"click"],["type","text","id","unitNumber","name","unitNumber","matInput","",3,"ngModel","ngModelChange"],["id","billPeriod","name","billPeriod",3,"value","selectionChange","valueChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(e,t){if(1&e){var i=g.Ub();g.Tb(0,"mat-dialog-content"),g.Tb(1,"div",0),g.Tb(2,"form"),g.Tb(3,"div",1),g.Tb(4,"mat-form-field",2),g.Tb(5,"mat-label"),g.Rc(6,"From Date"),g.Sb(),g.Tb(7,"input",3),g.bc("click",(function(){return g.Ec(i),g.Ac(10).open()}))("ngModelChange",(function(e){return t.fromDate=e}))("focus",(function(){return g.Ec(i),g.Ac(10).open()})),g.Sb(),g.Ob(8,"mat-datepicker-toggle",4),g.Ob(9,"mat-datepicker",null,5),g.Sb(),g.Tb(11,"mat-form-field",2),g.Tb(12,"mat-label"),g.Rc(13,"To Date"),g.Sb(),g.Tb(14,"input",6),g.bc("click",(function(){return g.Ec(i),g.Ac(17).open()}))("ngModelChange",(function(e){return t.toDate=e}))("focus",(function(){return g.Ec(i),g.Ac(17).open()})),g.Sb(),g.Ob(15,"mat-datepicker-toggle",4),g.Ob(16,"mat-datepicker",null,7),g.Sb(),g.Pc(18,Jl,4,1,"mat-form-field",8),g.Pc(19,Kl,7,2,"mat-form-field",8),g.Tb(20,"div",9),g.Tb(21,"button",10),g.bc("click",(function(){return t.onSearch()})),g.Tb(22,"mat-icon"),g.Rc(23,"search"),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb()}if(2&e){var n=g.Ac(10),l=g.Ac(17);g.Cb(7),g.mc("ngModel",t.fromDate)("matDatepicker",n),g.Cb(1),g.mc("for",n),g.Cb(6),g.mc("ngModel",t.toDate)("matDatepicker",l),g.Cb(1),g.mc("for",l),g.Cb(3),g.mc("ngIf",t.isHide),g.Cb(1),g.mc("ngIf","External"!=t.role)}},directives:[v.f,s.z,s.r,s.s,N.d,N.e,z.d,z.h,E.b,s.c,Y.b,s.q,s.t,Y.d,z.j,Y.a,d.o,k.a,F.a,U.a,d.n,z.g,H.n],styles:[""]}),ea),ia=((Zl=function(){function e(t,i,n,a,o,r,s,c,u,d,m,h,b){var f,p,g;l(this,e),this.billService=t,this.billSettlementService=i,this.snackbar=n,this.decimalPipe=a,this.currencyPipe=o,this.datePipe=r,this.date=s,this.currency=c,this.dialog=u,this.cookieService=d,this.clientSelectionService=m,this.clientService=h,this.envService=b,this._gap=16,this.gap=this._gap+"px",this.col2="1 1 calc(50% - ".concat(this._gap/2,"px)"),this.col3="1 1 calc(33.3333% - ".concat(this._gap/1.5,"px)"),this.tableData=[],this.columns=[],this.innerColumns=[],this.columnNames=[],this.creditNotes=[],this.selectedRows=[],this.visibleButtons=[],this.billPeriods=[{label:"Select",value:0}],this.utilityTypes=[],this.creditNoteAmount="",this.billAmount="",this.message="",this.billPeriod="",this.imageProperties=[],this.isBillPeriodEnabled=!1,this.roundFormat="",this.currencyFormat="",this.dateFormat="",this.filePath="",this.creditNoteDateCoulmnName="Credit Note Date",this.billNumberCoulmnName="Bill No",this.billDateCoulmnName="Bill Date",this.accountNumberColumnName="Account No",this.ownerNameColumnName="Owner Name",this.creditNoteNumberCoulmnName="Credit Note No",this.billAmountLocalColumnName="Bill Amount",this.creditNoteAmountColumnName="Credit Note Amount",this.filePath=b.backendForFiles,this.roundFormat=null!==(f=Object(y.e)("RoundOff"))&&void 0!==f?f:b.roundOffFormat,this.currencyFormat=null!==(p=Object(y.e)("Currency"))&&void 0!==p?p:b.currencyFormat,this.dateFormat=null!==(g=Object(y.e)("DateFormat"))&&void 0!==g?g:b.dateFormat}return o(e,[{key:"ngOnInit",value:function(){this.clientSelectionService.setIsClientVisible(!0),this.clientId=parseInt(this.cookieService.get("globalClientId")),this.getBillPeriods(),this.getUtilities(),this.createGridColumns(),this.createColumnNames(),this.createInnerGridColumns(),this.addVisibleButtons()}},{key:"createGridColumns",value:function(){this.columns=["select","creditNoteDateLocal","creditNoteNumber","billNumber","billDateLocal","accountNumber","ownerName","billAmountLocal","creditNoteAmountLocal","button","action"]}},{key:"createInnerGridColumns",value:function(){this.innerColumns=[]}},{key:"createColumnNames",value:function(){this.columnNames=[{name:this.creditNoteDateCoulmnName,property:"creditNoteDateLocal",visible:!0,isModelProperty:!0},{name:this.creditNoteNumberCoulmnName,property:"creditNoteNumber",visible:!0,isModelProperty:!0},{name:this.billNumberCoulmnName,property:"billNumber",visible:!0,isModelProperty:!0},{name:this.billDateCoulmnName,property:"billDateLocal",visible:!0,isModelProperty:!0},{name:this.accountNumberColumnName,property:"accountNumber",visible:!0,isModelProperty:!0},{name:this.ownerNameColumnName,property:"ownerName",visible:!0,isModelProperty:!0},{name:this.billAmountLocalColumnName,property:"billAmountLocal",visible:!0,isModelProperty:!0,columnAlign:{"text-align":"right"}},{name:this.creditNoteAmountColumnName,property:"creditNoteAmountLocal",visible:!0,isModelProperty:!0,columnAlign:{"text-align":"right"}}]}},{key:"addVisibleButtons",value:function(){this.visibleButtons=[{property:"print"}]}},{key:"onSearch",value:function(e){var t=this;this.manageParams=e,this.manageParams.clientId=this.clientId,this.creditNotes=[];var i=0,n=0;this.message="",this.billSettlementService.getCreditNoteDetails(e).subscribe((function(l){l&&l.length?(t.dateFormat=Object(y.e)("DateFormat"),t.roundFormat=Object(y.e)("RoundOff"),t.currencyFormat=Object(y.e)("Currency"),l.forEach((function(e){e.billAmountLocal=t.currencyPipe.transform(e.billAmount,t.currencyFormat.toString(),!0,t.roundFormat),e.creditNoteAmountLocal=t.currencyPipe.transform(e.creditNoteAmount,t.currencyFormat.toString(),!0,t.roundFormat),e.billDateLocal=t.datePipe.transform(e.billDate,t.dateFormat),e.creditNoteDateLocal=t.datePipe.transform(e.creditNoteDate,t.dateFormat),i+=Number(e.creditNoteAmount),n+=Number(e.billAmount)})),l.sort((function(e,t){return e.creditNoteDateLocal.localeCompare(t.creditNoteDateLocal)})),t.creditNotes=l,t.billAmount=t.currencyPipe.transform(n,t.currencyFormat.toString(),!0,t.roundFormat),t.creditNoteAmount=t.currencyPipe.transform(i,t.currencyFormat.toString(),!0,t.roundFormat),""!=e.billPeriodId&&(t.billPeriods.find((function(i){i.value==e.billPeriodId&&0!=i.value&&(t.billPeriod=i.label)})),""!=t.billPeriod&&(t.billPeriod=" for "+t.billPeriod)),""!=e.fromDate&&""!=e.toDate&&(t.message="Period : "+t.datePipe.transform(e.fromDate,t.dateFormat)+" to "+t.datePipe.transform(e.toDate,t.dateFormat))):t.creditNotes=[]}))}},{key:"toggleBillPeriodEnabled",value:function(e){this.isBillPeriodEnabled=e.checked||!1}},{key:"getBillPeriods",value:function(){var e=this;this.billPeriods=[{label:"Select",value:0,fromDate:"",ToDate:""}],this.billService.getBillPeriods(this.clientId).subscribe((function(t){t.forEach((function(t){e.billPeriods.push({label:t.periodDescription,value:t.id,fromDate:t.periodStart,toDate:t.periodEnd})}))}))}},{key:"getUtilities",value:function(){var e=this;this.billService.getUtilities(this.clientId).subscribe((function(t){t&&t.forEach((function(t){e.utilityTypes.push({label:t.description,value:t.id})}))}))}},{key:"onViewDataRow",value:function(e){var t=this;if(e){var i=1;e.transactionMode="View",e.creditNoteTransactions.forEach((function(e){e.rowNumber=i,e.fixedAmountLocal=t.currencyPipe.transform(e.fixedAmount,t.currencyFormat.toString(),!0,t.roundFormat),e.creditNoteAmountLocal=t.currencyPipe.transform(e.creditNoteAmount,t.currencyFormat.toString(),!0,t.roundFormat),i+=1}))}this.dialog.open(Lt,{data:e}).afterClosed().subscribe()}},{key:"onSelectedRows",value:function(e){this.selectedRows=[],this.selectedRows=e}},{key:"getClientImageProperties",value:function(){var e=this;this.imageProperties=[],this.clientService.getClientImageProperties(this.clientId).subscribe({next:function(t){t&&t.length&&(e.imageProperties=t,e.downloadSummary(e.creditNotes))},error:function(){this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","green-snackbar"),this.downloadSummary(this.consolidatedData)}})}},{key:"creditNoteSummaryView",value:function(e){var t=this;this.billSettlementService.creditNoteSummaryView(e).subscribe({next:function(e){e?t.downloadFile(e):t.notificationMessage("No data to print","red-snackbar")},error:function(e){t.notificationMessage("No data to print","red-snackbar")}})}},{key:"creditNoteView",value:function(e){var t=this;this.billSettlementService.creditNoteView(e).subscribe({next:function(e){e?t.downloadFile(e):t.notificationMessage("No data to print","red-snackbar")},error:function(e){t.notificationMessage("No data to print","red-snackbar")}})}},{key:"downloadFile",value:function(e){return Object(h.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var i,n,l,a,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ee.PDFDocument.create();case 2:return i=t.sent,t.next=5,ee.PDFDocument.load(e);case 5:return n=t.sent,t.next=8,i.copyPages(n,n.getPageIndices());case 8:return t.sent.forEach((function(e){i.addPage(e)})),t.next=11,i.save();case 11:l=t.sent,a=new Blob([l],{type:"application/pdf"}),o=window.URL.createObjectURL(a),window.open(o);case 15:case"end":return t.stop()}}),t)})))}},{key:"onPrintSummary",value:function(){this.selectedRows&&this.selectedRows.length?this.creditNoteSummaryView(this.selectedRows):this.notificationMessage("Please select Credit Notes.","red-snackbar")}},{key:"downloadSummary",value:function(e){for(var t,i,n,l,a,o=0,r=0,s=[],c=[],u=[],d=0;d<e.length;d++)s.push(e[d].creditNoteDateLocal),s.push(e[d].creditNoteNumber),s.push(e[d].billNumber),s.push(e[d].billDateLocal),s.push(e[d].accountNumber),s.push(e[d].ownerName),s.push(e[d].billAmountLocal),s.push(e[d].creditNoteAmountLocal),c.push(s),r+=Number(null===(t=e[d])||void 0===t?void 0:t.creditNoteAmount),o+=Number(null===(i=e[d])||void 0===i?void 0:i.billAmount),s=[];u.push({label:"Total Amount",value0:o,value1:r});for(var m=0;m<u.length;m++)s.push(""),s.push(""),s.push(""),s.push(""),s.push(""),s.push(null===(n=u[m])||void 0===n?void 0:n.label),s.push(this.currency.transform(null===(l=u[m])||void 0===l?void 0:l.value0,this.currencyFormat.toString(),!0,this.roundFormat)),s.push(this.currency.transform(null===(a=u[m])||void 0===a?void 0:a.value1,this.currencyFormat.toString(),!0,this.roundFormat)),c.push(s),s=[];this.getSummaryReport(e,["Date","CreditNoteNo","BillNo","BillDate","AccountNo","OwnerName","BillAmount","CreditNoteAmount"],c,"Consumption Alert Report")}},{key:"getSummaryReport",value:function(e,t,i,n){var l,a=new Image;a.src=this.filePath+"/uploads/"+(null===(l=this.imageProperties[0])||void 0===l?void 0:l.photo);var o=new Fe.default({orientation:"landscape",unit:"pt",format:"letter"}),r=L().format("M/D/YYYY hh:mm:ss a");if(o.rect(5,5,o.internal.pageSize.width-10,o.internal.pageSize.height-10,"S"),o.setFontSize(30),a&&e&&this.imageProperties&&this.imageProperties.length){var s=this.imageProperties.find((function(e){return"landscape"===e.imageType.trim().toLowerCase()}));s&&(a.onload=function(){o.addImage(a,s.imgX,s.imgY,s.imgW,s.imgH)})}o.setTextColor(25,118,210),o.setFontSize(9),o.setFont("Cambria"),o.setTextColor(0,0,0),o.text("Print Date: "+r,o.internal.pageSize.width-150,20),o.setFontSize(14),o.text("Credit Note History "+this.billPeriod,o.internal.pageSize.width/2-120,100),o.text(this.message,o.internal.pageSize.width/2-120,120),o.setFontSize(9),Number(o.autoTable.previous.finalY),o.autoTable(t,i,{startX:10,startY:125,didDrawPage:function(e){var t="Page "+e.pageCount;"function"==typeof o.putTotalPages&&(t+=" of 1"),o.setFontSize(9);var i=o.internal.pageSize.height||o.internal.pageSize.getHeight();o.text(t,e.settings.margin.left,i-10)},styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:280,left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:80,halign:"center"},1:{cellWidth:75,halign:"center"},2:{cellWidth:80,halign:"center"},3:{cellWidth:80,halign:"center"},4:{cellWidth:80,halign:"center"},5:{cellWidth:150,halign:"left"},6:{cellWidth:80,halign:"right"},7:{cellWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]}});var c=o.output("blob");window.open(URL.createObjectURL(c))}},{key:"onPrintPdf",value:function(){var e=this;this.selectedRows&&this.selectedRows.length?this.selectedRows.forEach((function(t){e.downloadReport(t)})):this.notificationMessage("Please select Bills.","red-snackbar")}},{key:"downloadReport",value:function(e){for(var t=[],i=[],n=[],l=[],a=[],o=0,r=0,s=0;s<e.creditNoteTransactions.length;s++)if(e.creditNoteTransactions[s]&&!e.creditNoteTransactions[s].taxId){var c=this.currencyPipe.transform(Number(e.creditNoteTransactions[s].creditNoteAmount),this.currencyFormat,!0,this.roundFormat);t.push(e.creditNoteTransactions[s].headDisplay),t.push(c),i.push(t),o+=Number(e.creditNoteTransactions[s].creditNoteAmount),t=[]}else r+=Number(e.creditNoteTransactions[s].creditNoteAmount);n.push({label:"Previous Balance:",value:this.currencyPipe.transform(Number(e.previousDueAmount),this.currencyFormat.toString(),!0,this.roundFormat)}),l.push({label:"Account Number:",value:e.accountNumber},{label:"Unit Number:",value:e.unitNumber},{label:"Billing Date:",value:e.creditNoteDateLocal},{label:"Invoice Number:",value:e.billNumber},{label:"Customer TRN:",value:e.trn}),a.push({label:"Credit Note Total:",value:this.currencyPipe.transform(o,this.currencyFormat.toString(),!0,this.roundFormat)},{label:"Tax:",value:this.currencyPipe.transform(r,this.currencyFormat.toString(),!0,this.roundFormat)},{label:"Credit Note Total + Tax:",value:this.currencyPipe.transform(Number(e.creditNoteAmount),this.currencyFormat.toString(),!0,this.roundFormat)},{label:"Previous Bill Outstanding Balance:",value:this.currencyPipe.transform(Number(e.previousDueAmount),this.currencyFormat.toString(),!0,this.roundFormat)},{label:"Total Due incl VAT:",value:this.currencyPipe.transform(Number(e.previousDueAmount)-Number(e.creditNoteAmount),this.currencyFormat.toString(),!0,this.roundFormat)}),this.getReport(e,["Services Description","Amount"],i,[],["Customer Id","Billing Period","Total for current period"],[],n,l,a,"Credit Note")}},{key:"getReport",value:function(e,t,i,n,l,a,o,r,s,c){var u;(new Image).src=this.filePath+"/uploads/"+e.client.photo;var d=new Image;d.src="assets/img/lu.JPG";var m=new Fe.default({orientation:"portrait",unit:"pt",format:"letter"});m.rect(5,5,m.internal.pageSize.width-10,m.internal.pageSize.height-10,"S"),m.setFontSize(30),m.addImage(d,"png",547,10,56,56),m.setTextColor(0,0,0),m.setFontSize(14),m.setFont("Cambria"),m.text("Tax Credit Note",260,30),m.setFontSize(9),m.setTextColor(25,118,210),m.setFont("Cambria","bold"),m.text(e.client.clientName,10,60),m.setFont("Cambria","normal"),m.text("TRN: "+e.client.trnNo,10,70),m.text("PO Box "+e.client.addresses[0].zipPostalCode,10,80),m.text(e.client.addresses[0].address1+","+e.client.addresses[0].country,10,90),m.text("Phone: "+e.client.phoneNo,10,100),m.text("Email: "+e.client.email+", Web: "+e.client.website,10,110),m.setFillColor(241,241,244),m.setDrawColor(206,203,203),m.rect(10,120,250,90,"FD"),m.setTextColor(0,0,0),m.setFontSize(12),m.text(null==e?void 0:e.ownerName.toUpperCase(),20,135),m.text("CUSTOMER TRN: "+e.trn,20,155),m.text("unit #"+e.unitNumber,20,170),m.setFontSize(10),m.text(e.client.clientName,20,185),m.text("Al Barsha 1, Dubai, UAE",20,200),m.setFontSize(9),m.setLineWidth(.1),m.line(5,265,607,265),m.setFontSize(10),m.setFont("bold"),m.text("Credit Note No#: ".toUpperCase(),400,110),m.setTextColor(25,118,210);var h=m.getTextWidth("Credit Note No#: "),b="";(null==e?void 0:e.billNumber)&&(b=null===(u=e.creditNoteNumber)||void 0===u?void 0:u.toUpperCase()),m.text(b,418+h,110),m.setFont("none"),m.setTextColor(0,0,0),m.setFontSize(9),m.autoTable("",r,{startX:210,startY:120,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:400},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:100,halign:"right"}},didParseCell:function(e){var t=e.column.index;0!=t&&1!=t||(e.cell.styles.rowHeight=1)},headStyles:{lineWidth:.1,lineColor:[0,0,0]}}),m.autoTable("",o,{startX:10,startY:220,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:220,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:515,fontStyle:"bold"},1:{cellWidth:75,fontStyle:"bold",halign:"right"}},didParseCell:function(e){var t=e.column.index;0!=t&&1!=t||(e.cell.styles.rowHeight=1)},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});var f=Number(this.decimalPipe.transform(m.autoTable.previous.finalY,"1.0-0"));m.autoTable(t,i,{startX:10,startY:f,didDrawPage:function(e){var t="Page "+e.pageCount;"function"==typeof m.putTotalPages&&(t+=" of 1",m.rect(5,5,m.internal.pageSize.width-10,m.internal.pageSize.height-10,"S")),m.setFontSize(9);var i=m.internal.pageSize.height||m.internal.pageSize.getHeight();m.text(t,e.settings.margin.left,i-10)},styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:f,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:t.length>2?100:515,halign:"left"},1:{cellWidth:t.length>2?80:75,halign:t.length>2?"center":"right"},2:{cellWidth:80,halign:"center"},3:{cellWidth:60,halign:"center"},4:{cellWidth:60,halign:"center"},5:{cellWidth:75,halign:"center"},6:{cellWidth:60,halign:"right"},7:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]}}),m.setTextColor(0,0,0);var p=Number(this.decimalPipe.transform(m.autoTable.previous.finalY,"1.0-0"));m.setTextColor(25,118,210),m.setFontSize(12),m.text("Bank Payment Account Details",10,p+20),m.setTextColor(0,0,0),m.setFontSize(9),m.text("Account Title: LOGIC UTILITIES DISTRICT COOLING SERVICES L.L.C",10,p+40),m.text("Account #: 019100074892",10,p+50),m.text("IBAN #: AE54 0330 0000 1910 0074 892",10,p+60),m.text("Bank Name: MASHREQ BANK - DUBAI MALL BRANCH",10,p+70),m.text("Swift Code: BOMLAEAD",10,p+80),m.setFontSize(9),m.autoTable("",s,{startX:300,startY:p+20,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:320},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:180,halign:"left"},1:{cellWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"}});var g=Number(this.decimalPipe.transform(m.autoTable.previous.finalY,"1.0-0"));m.setTextColor(255,0,0),m.text("Note: A Late Fee will be applied after the due date. A Default Payment \nPenalty will be added to any unit that is 45 days or more in arrears.",320,g+10),m.setTextColor(25,118,210),m.setFontSize(12),m.text("USAGE TIPS to reduce consumption:",10,g+10),m.text("Please Try to:",10,g+30),m.setTextColor(0,0,0),m.setFontSize(9),m.text("- Keep filters clean",30,g+40),m.text("- Set thermostats between 23C and 25C",30,g+50),m.text("- Keep vents unblocked",30,g+60),m.text("- Keep doors and windows closed",30,g+70),m.text("- Undertake regular maintenance of the system",30,g+80),m.setTextColor(25,118,210),m.setFontSize(12),m.text("Please Do Not:",10,g+100),m.setTextColor(0,0,0),m.setFontSize(9),m.text("- Set thermostats to 20C or lower",30,g+110),m.text("- Block vents",30,g+120),m.text("- Leave doors and windows open",30,g+130),m.text("- Leave heat producing appliances near thermostats",30,g+140),m.setFillColor(119,183,11);var v=m.internal.pageSize.height||m.internal.pageSize.getHeight();m.rect(320,g+30,280,v-80-(g+30),"FD"),m.setFont("Comic Sans"),m.setTextColor(255,255,255),m.setFontSize(16),m.text("ADVERTISE WITH US",360,g+50);var y=m.getTextWidth("ADVERTISE WITH US");m.setLineWidth(.1),m.line(360,g+55,360+y,g+55),m.setFontSize(9),m.text("For advertisement, contact at",390,g+65),m.text("800 Logic (56442)",390,g+75),m.text("enquiry@logicutilities.com",390,g+85),m.text("www.logicutilities.com",390,g+95),m.setTextColor(0,0,0),m.setLineWidth(.1),m.line(5,v-70,607,v-70),m.text("For any enquiries, write to us enquiry@logicutilities.com \nor Logon to www.logicutilites.com",10,v-60),m.setTextColor(255,0,0),m.setFont("bold");var C=m.getTextWidth("Notice:");m.text("Notice:",340,v-60),m.setFont("none"),m.setTextColor(0,0,0),m.text("Pay your bills before due date to avoid late payment surcharge",340+C,v-60),m.text("and disconnection.",340,v-50),m.text("You can log onto www.logicutilites.com to pay your invoices \nTerms & Conditions for Supply of Utility Services",340,v-40),"function"==typeof m.putTotalPages&&m.putTotalPages("1");var S=m.output("blob");window.open(URL.createObjectURL(S))}},{key:"notificationMessage",value:function(e,t){this.snackbar.open(e,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[t]})}},{key:"getJsonData",value:function(){var e=this;this.tableData=[],null==this.creditNotes&&null==this.creditNotes||this.creditNotes.forEach((function(t){var i={Date:e.date.transform(t.creditNoteDate,"yyyy-MM-dd"),CreditNoteNumber:t.creditNoteNumber,BillNumber:t.billNumber,BillDate:e.date.transform(t.billDate,"yyyy-MM-dd"),AccountNumber:t.accountNumber,OwnerName:t.ownerName,BillAmount:t.billAmountLocal,CreditNoteAmount:t.creditNoteAmountLocal};e.tableData.push(i)}))}},{key:"onExport",value:function(){if(this.creditNotes&&this.creditNotes.length>0){if(this.getJsonData(),null!=this.tableData||null!=this.tableData){var e=jt.utils.json_to_sheet(this.tableData),t=jt.utils.book_new();jt.utils.book_append_sheet(t,e,"Sheet1"),jt.writeFile(t,"Credit Note History.xlsx")}}else this.notificationMessage("No Data to Export","yellow-snackbar")}}]),e}()).\u0275fac=function(e){return new(e||Zl)(g.Nb(b.a),g.Nb(M.a),g.Nb(B.b),g.Nb(d.g),g.Nb(d.d),g.Nb(d.f),g.Nb(d.f),g.Nb(d.d),g.Nb(v.b),g.Nb(w.a),g.Nb(Z.a),g.Nb(Dl.a),g.Nb(C.a))},Zl.\u0275cmp=g.Hb({type:Zl,selectors:[["fury-credit-note-history"]],viewQuery:function(e,t){var i;1&e&&(g.Jc($l,!0),g.Jc(ta,!0)),2&e&&(g.zc(i=g.cc())&&(t.creditNoteHistoryDetailsComponent=i.first),g.zc(i=g.cc())&&(t.creditNoteHistoryToolbarComponent=i.first))},decls:25,vars:13,consts:[["mode","card",2,"margin-top","27px"],["fxLayout","column",1,"content"],["color","primary",1,"position-fixed"],["src","assets/img/fav-icon.png",1,"img-style"],[1,"toolbar-spacer"],[3,"printClicked","exportClicked"],["fxFlex","noshrink","fxLayout","column","fxLayout.gt-sm","row","fxLayoutAlign.gt-sm","start stretch",3,"fxLayoutGap"],["fxFlex","grow",1,"basic-forms","route-animations-elements",3,"fxFlex.gt-sm"],["fxLayout","column"],["fxLayout","column",1,"result"],[3,"billPeriods","isHide","searchClicked"],[1,"padding-top",3,"tableData","columnsToDisplay","innerDisplayedColumns","columnNames","hideHeader","visibleButtons","selectedRows","viewDataRow","printDataRow"],["fxLayout","column",1,"padding"],["fxLayout.gt-sm","row","fxLayout","column","fxLayoutAlign","end end","fxLayoutGap.gt-sm","12px",1,"result"],["color","primary",1,"result"],["type","text","id","billAmount","name","billAmount","matInput","",2,"text-align","right",3,"ngModel","ngModelChange"],["type","textbox","id","creditNoteAmount","name","creditNoteAmount","matInput","",2,"text-align","right",3,"ngModel","ngModelChange"]],template:function(e,t){1&e&&(g.Tb(0,"fury-page-layout",0),g.Tb(1,"fury-page-layout-content",1),g.Tb(2,"mat-toolbar",2),g.Ob(3,"img",3),g.Tb(4,"span"),g.Rc(5,"Credit Note History"),g.Sb(),g.Ob(6,"span",4),g.Tb(7,"fury-credit-note-history-details",5),g.bc("printClicked",(function(){return t.onPrintSummary()}))("exportClicked",(function(){return t.onExport()})),g.Sb(),g.Sb(),g.Tb(8,"div",6),g.Tb(9,"fury-card",7),g.Ob(10,"fury-card-header"),g.Tb(11,"fury-card-content",8),g.Tb(12,"div",9),g.Tb(13,"fury-credit-note-history-toolbar",10),g.bc("searchClicked",(function(e){return t.onSearch(e)})),g.Sb(),g.Tb(14,"fury-expandable-table-structure",11),g.bc("selectedRows",(function(e){return t.onSelectedRows(e)}))("viewDataRow",(function(e){return t.onViewDataRow(e)}))("printDataRow",(function(e){return t.creditNoteView(e)})),g.Sb(),g.Sb(),g.Ob(15,"div",12),g.Tb(16,"div",13),g.Tb(17,"mat-form-field",14),g.Tb(18,"mat-label"),g.Rc(19,"Bill Amount"),g.Sb(),g.Tb(20,"input",15),g.bc("ngModelChange",(function(e){return t.billAmount=e})),g.Sb(),g.Sb(),g.Tb(21,"mat-form-field",14),g.Tb(22,"mat-label"),g.Rc(23,"Credit Note Amount"),g.Sb(),g.Tb(24,"input",16),g.bc("ngModelChange",(function(e){return t.creditNoteAmount=e})),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb()),2&e&&(g.Cb(8),g.mc("fxLayoutGap",t.gap),g.Cb(1),g.mc("fxFlex.gt-sm",t.col2)("@fadeInUp",void 0),g.Cb(4),g.mc("billPeriods",t.billPeriods)("isHide",!1),g.Cb(1),g.mc("tableData",t.creditNotes)("columnsToDisplay",t.columns)("innerDisplayedColumns",t.innerColumns)("columnNames",t.columnNames)("hideHeader",!1)("visibleButtons",t.visibleButtons),g.Cb(6),g.mc("ngModel",t.billAmount),g.Cb(4),g.mc("ngModel",t.creditNoteAmount))},directives:[te.a,ie.a,N.d,ne.a,$l,N.b,N.c,N.e,S.a,S.d,S.c,ta,x.a,z.d,z.h,E.b,s.c,s.q,s.t],styles:[".toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.img-style[_ngcontent-%COMP%]{width:32px}.position-fixed[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;top:0;z-index:5}"],data:{animation:[p.a,f.a]}}),Zl),na=["allSelected"];function la(e,t){if(1&e){var i=g.Ub();g.Tb(0,"div",13),g.Tb(1,"mat-checkbox",14),g.bc("change",(function(){g.Ec(i);var e=g.fc();return e.showMovedOutTenants(e.isMovedOutTenant)})),g.Rc(2," Show only Moved Out Tenants "),g.Sb(),g.Sb()}}function aa(e,t){if(1&e){var i=g.Ub();g.Tb(0,"mat-option",22),g.bc("click",(function(){g.Ec(i),g.fc();var e=g.Ac(8);return g.fc().togglePerOne(e.viewValue)})),g.Rc(1),g.Sb()}if(2&e){var n=t.$implicit;g.mc("optionSelected",n.selected)("value",n.id),g.Cb(1),g.Tc(" ",n.ownerName," ")}}function oa(e,t){if(1&e){var i=g.Ub();g.Tb(0,"mat-form-field",15),g.Tb(1,"mat-label"),g.Rc(2,"Tenant Name"),g.Sb(),g.Tb(3,"mat-select",16),g.bc("ngModelChange",(function(e){return g.Ec(i),g.fc().selectedTenants=e})),g.Tb(4,"input",17,18),g.bc("keydown",(function(e){return g.Ec(i),g.fc().handleInput(e)}))("keyup",(function(e){return g.Ec(i),g.fc().searchTenant(e.target.value)})),g.Sb(),g.Ob(6,"mat-divider"),g.Tb(7,"mat-option",19,20),g.bc("click",(function(){return g.Ec(i),g.fc().toggleAllSelection()})),g.Rc(9,"Select All"),g.Sb(),g.Pc(10,aa,2,3,"mat-option",21),g.Sb(),g.Tb(11,"mat-hint"),g.Rc(12,"Please select a tenant name"),g.Sb(),g.Sb()}if(2&e){var n=g.fc();g.Cb(3),g.mc("ngModel",n.selectedTenants),g.Cb(4),g.mc("value",0),g.Cb(3),g.mc("ngForOf",n.filteredTenants)}}var ra,sa,ca=((sa=function(){function i(e,t,n,a,o){l(this,i),this.snackbar=e,this.date=t,this.fb=n,this.jwtHelperService=a,this.cookieService=o,this.billPeriods=[],this.billTypes=[],this.isHide=!0,this.searchClicked=new g.o,this.billTypeChanged=new g.o,this.tenantChanged=new g.o,this.manageParams={},this.tenantId=0,this.fromDate="",this.toDate="",this.unitNumber="",this.billPeriodId=0,this.billTypeId=0,this.billType="",this.role="",this.filteredTenants=[],this.data=[],this.tenantName="",this.ownerId=0,this.selectedTenants=[],this.isMovedOutTenant=!1}return o(i,[{key:"ngOnInit",value:function(){var e,t,i=this.cookieService.get("access_token"),n=this.jwtHelperService.decodeToken(i);n&&(this.role=n["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"]),this.ownerId=parseInt(this.cookieService.get("ownerId")),this.tenantId=null!==(e=this.ownerId)&&void 0!==e?e:0,this.tenantId>0&&this.selectedTenants.push(null!==(t=this.ownerId)&&void 0!==t?t:0),this.form=this.fb.group({movedOutTenant:[""],fromDate:[""],toDate:[""],tenant:[""]})}},{key:"onSearch",value:function(){var e=this.selectedTenants.findIndex((function(e){return 0==e}));e>=0&&this.selectedTenants.splice(e,1),this.fromDate&&this.toDate&&this.selectedTenants&&this.selectedTenants.length>0?(this.manageParams={fromDate:""+(""==this.fromDate?"":L(this.fromDate).format("YYYY-MM-DD")),toDate:""+(""==this.toDate?"":L(this.toDate).format("YYYY-MM-DD")),tenantId:this.selectedTenants.join(","),tenantName:""+this.tenantName},this.searchClicked.emit(this.manageParams)):this.snackbar.open("Invalid search parameters",null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:["yellow-snackbar"]})}},{key:"selectTenant",value:function(e){var t=this;this.tenants.forEach((function(i){i.ownerName===e.option.value&&(t.tenantId=i.id)}))}},{key:"filterTenant",value:function(e){""!=e&&(this.filteredTenants=this.data.filter((function(t){return 0===t.ownerName.toLowerCase().indexOf(e.toLowerCase())})))}},{key:"toggleAllSelection",value:function(){this.form.controls.tenant.patchValue(this.allSelected.selected?[].concat(e(this.filteredTenants.map((function(e){return e.id}))),[0]):[])}},{key:"togglePerOne",value:function(e){if(this.allSelected.selected)return this.allSelected.deselect(),!1;this.form.controls.tenant.value.length==this.filteredTenants.length&&this.allSelected.select()}},{key:"searchTenant",value:function(e){var t=this.selectOwnerTenant(e.toLowerCase());this.filteredTenants=t}},{key:"selectOwnerTenant",value:function(e){var i=[];if(!e)return this.data;var n,l=t(this.data);try{for(l.s();!(n=l.n()).done;){var a=n.value;a.ownerName.toLowerCase().indexOf(e)>-1&&i.push(a)}}catch(o){l.e(o)}finally{l.f()}return i}},{key:"showMovedOutTenants",value:function(e){this.isMovedOutTenant=!e,this.form.controls.tenant.setValue(""),this.selectedTenants=[],this.tenantChanged.emit(this.isMovedOutTenant)}},{key:"handleInput",value:function(e){e.stopPropagation()}},{key:"tenants",get:function(){return this.data},set:function(e){this.filteredTenants=this.data=e}}]),i}()).\u0275fac=function(e){return new(e||sa)(g.Nb(B.b),g.Nb(d.f),g.Nb(s.f),g.Nb(D.a),g.Nb(w.a))},sa.\u0275cmp=g.Hb({type:sa,selectors:[["app-account-statement-toolbar"]],viewQuery:function(e,t){var i;1&e&&g.Vc(na,!0),2&e&&g.zc(i=g.cc())&&(t.allSelected=i.first)},inputs:{billPeriods:"billPeriods",billTypes:"billTypes",isHide:"isHide",tenants:"tenants"},outputs:{searchClicked:"searchClicked",billTypeChanged:"billTypeChanged",tenantChanged:"tenantChanged"},decls:24,vars:9,consts:[[1,"person","padding-bottom"],[3,"formGroup"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","8px","style","padding-bottom: 20px;",4,"ngIf"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","8px"],["color","primary",1,"result"],["id","fromDate","name","fromDate","formControlName","fromDate","matInput","","readonly","",3,"ngModel","matDatepicker","click","ngModelChange","focus"],["matSuffix","",3,"for"],["formDatepickerRef1",""],["id","toDate","name","toDate","formControlName","toDate","matInput","","readonly","",3,"ngModel","matDatepicker","click","ngModelChange","focus"],["formDatepickerRef2",""],["class","result","color","primary","style","width: 400px;",4,"ngIf"],[1,"fury-flex-form-field"],["mat-icon-button","",3,"click"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","8px",2,"padding-bottom","20px"],["color","primary","formControlName","movedOutTenant",1,"formulaLabel",3,"change"],["color","primary",1,"result",2,"width","400px"],["multiple","","formControlName","tenant",3,"ngModel","ngModelChange"],["matInput","","focused","'true'","type","text","autocomplete","off","placeholder","search",1,"myInput",3,"keydown","keyup"],["myInput",""],[3,"value","click"],["allSelected",""],[3,"optionSelected","value","click",4,"ngFor","ngForOf"],[3,"optionSelected","value","click"]],template:function(e,t){if(1&e){var i=g.Ub();g.Tb(0,"mat-dialog-content"),g.Tb(1,"div",0),g.Tb(2,"form",1),g.Pc(3,la,3,0,"div",2),g.Tb(4,"div",3),g.Tb(5,"mat-form-field",4),g.Tb(6,"mat-label"),g.Rc(7,"From Date"),g.Sb(),g.Tb(8,"input",5),g.bc("click",(function(){return g.Ec(i),g.Ac(11).open()}))("ngModelChange",(function(e){return t.fromDate=e}))("focus",(function(){return g.Ec(i),g.Ac(11).open()})),g.Sb(),g.Ob(9,"mat-datepicker-toggle",6),g.Ob(10,"mat-datepicker",null,7),g.Sb(),g.Tb(12,"mat-form-field",4),g.Tb(13,"mat-label"),g.Rc(14,"To Date"),g.Sb(),g.Tb(15,"input",8),g.bc("click",(function(){return g.Ec(i),g.Ac(18).open()}))("ngModelChange",(function(e){return t.toDate=e}))("focus",(function(){return g.Ec(i),g.Ac(18).open()})),g.Sb(),g.Ob(16,"mat-datepicker-toggle",6),g.Ob(17,"mat-datepicker",null,9),g.Sb(),g.Pc(19,oa,13,3,"mat-form-field",10),g.Tb(20,"div",11),g.Tb(21,"button",12),g.bc("click",(function(){return t.onSearch()})),g.Tb(22,"mat-icon"),g.Rc(23,"search"),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb()}if(2&e){var n=g.Ac(11),l=g.Ac(18);g.Cb(2),g.mc("formGroup",t.form),g.Cb(1),g.mc("ngIf",0==t.tenantId),g.Cb(5),g.mc("ngModel",t.fromDate)("matDatepicker",n),g.Cb(1),g.mc("for",n),g.Cb(6),g.mc("ngModel",t.toDate)("matDatepicker",l),g.Cb(1),g.mc("for",l),g.Cb(3),g.mc("ngIf",0==t.ownerId)}},directives:[v.f,s.z,s.r,s.k,d.o,N.d,N.e,z.d,z.h,s.c,E.b,Y.b,s.q,s.i,Y.d,z.j,Y.a,k.a,F.a,gi.a,U.a,j.a,H.n,d.n,z.g],styles:[".button[_ngcontent-%COMP%]{line-height:50px}.myInput[_ngcontent-%COMP%]{height:50px!important;padding:10px!important}"]}),sa),ua=((ra=function(){function e(t,i){l(this,e),this.jwtHelperService=t,this.cookieService=i,this.role="",this.showAprrovedButton=!1,this.actions=[],this.billType="",this.sendInvoiceClicked=new g.o,this.printClicked=new g.o,this.sendSMSClicked=new g.o,this.printSummaryClicked=new g.o,this.approveClickedClicked=new g.o,this.regenerateClicked=new g.o,this.exportClicked=new g.o}return o(e,[{key:"ngOnInit",value:function(){var e=this.cookieService.get("access_token"),t=this.jwtHelperService.decodeToken(e);t&&(this.role=t["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"])}},{key:"onPrint",value:function(e){this.printClicked.emit(e)}},{key:"onExport",value:function(){this.exportClicked.emit()}},{key:"onSendSMS",value:function(){this.sendSMSClicked.emit()}},{key:"userActions",get:function(){return this.actions},set:function(e){if(this.actions=e,this.actions&&this.actions.length){var t=this.actions.find((function(e){return"Bill Approval"===e.actionName}));this.showAprrovedButton=!!t}}}]),e}()).\u0275fac=function(e){return new(e||ra)(g.Nb(D.a),g.Nb(w.a))},ra.\u0275cmp=g.Hb({type:ra,selectors:[["fury-account-statement-footer-toolbar"]],inputs:{disable:"disable",userActions:"userActions"},outputs:{sendInvoiceClicked:"sendInvoiceClicked",printClicked:"printClicked",sendSMSClicked:"sendSMSClicked",printSummaryClicked:"printSummaryClicked",approveClickedClicked:"approveClickedClicked",regenerateClicked:"regenerateClicked",exportClicked:"exportClicked"},decls:11,vars:0,consts:[[1,"person"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutAlign","end end","fxLayoutGap.gt-sm","24px"],[1,"fury-flex-form-field"],["matTooltip","Print","mat-icon-button","",1,"example-icon",3,"click"],["matTooltip","Export","mat-icon-button","","aria-label","Example icon-button with menu icon",1,"example-icon",3,"click"]],template:function(e,t){1&e&&(g.Tb(0,"mat-dialog-content"),g.Tb(1,"div",0),g.Tb(2,"form"),g.Tb(3,"div",1),g.Tb(4,"div",2),g.Tb(5,"button",3),g.bc("click",(function(){return t.onPrint("Normal")})),g.Tb(6,"mat-icon"),g.Rc(7,"print"),g.Sb(),g.Sb(),g.Tb(8,"button",4),g.bc("click",(function(){return t.onExport()})),g.Tb(9,"mat-icon"),g.Rc(10,"import_export"),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb())},directives:[v.f,s.z,s.r,s.s,N.d,N.c,N.e,k.a,A.a,F.a],styles:[".button[_ngcontent-%COMP%]{line-height:50px}"]}),ra),da=a("Vvus"),ma=["htmlData"];function ha(e,t){1&e&&(g.Tb(0,"div",14),g.Ob(1,"mat-progress-spinner",15),g.Sb())}function ba(e,t){1&e&&(g.Tb(0,"div",16),g.Rc(1," Click the Print button to view the Account Statement. "),g.Sb())}function fa(e,t){if(1&e){var i=g.Ub();g.Tb(0,"div",16),g.Tb(1,"fury-expandable-table-structure",17),g.bc("selectedRows",(function(e){return g.Ec(i),g.fc().onSelectedRows(e)})),g.Sb(),g.Sb()}if(2&e){var n=g.fc();g.Cb(1),g.mc("tableData",n.billMasterDetails)("columnsToDisplay",n.columns)("innerDisplayedColumns",n.innerColumns)("columnNames",n.columnNames)("hideHeader",!1)("cssStyledColumn",n.cssStyledColumn)("visibleButtons",n.visibleButtons)("role",n.role)("buttonName",n.buttonName)("disableColumn",n.disableColumn)}}function pa(e,t){if(1&e){var i=g.Ub();g.Tb(0,"div",18),g.Tb(1,"mat-form-field",19),g.Tb(2,"mat-label"),g.Rc(3,"Bill Amount"),g.Sb(),g.Tb(4,"input",20),g.bc("ngModelChange",(function(e){return g.Ec(i),g.fc().billAmount=e})),g.Sb(),g.Sb(),g.Tb(5,"mat-form-field",19),g.Tb(6,"mat-label"),g.Rc(7,"Credit Note Amount"),g.Sb(),g.Tb(8,"input",21),g.bc("ngModelChange",(function(e){return g.Ec(i),g.fc().creditNoteAmount=e})),g.Sb(),g.Sb(),g.Tb(9,"mat-form-field",19),g.Tb(10,"mat-label"),g.Rc(11,"Paid Amount"),g.Sb(),g.Tb(12,"input",22),g.bc("ngModelChange",(function(e){return g.Ec(i),g.fc().receivedAmount=e})),g.Sb(),g.Sb(),g.Tb(13,"mat-form-field",19),g.Tb(14,"mat-label"),g.Rc(15,"Balance Due"),g.Sb(),g.Tb(16,"input",23),g.bc("ngModelChange",(function(e){return g.Ec(i),g.fc().previousDueAmount=e})),g.Sb(),g.Sb(),g.Sb()}if(2&e){var n=g.fc();g.Cb(4),g.mc("ngModel",n.billAmount),g.Cb(4),g.mc("ngModel",n.creditNoteAmount),g.Cb(4),g.mc("ngModel",n.receivedAmount),g.Cb(4),g.mc("ngModel",n.previousDueAmount)}}var ga,va,ya,Ca,Sa=[{path:"create-bill",component:se},{path:"create-bill-payment",component:it},{path:"final-bill-settlement",component:Ze},{path:"bill-history",component:fi},{path:"approve-bills",component:fi},{path:"rejected-bills",component:fi},{path:"bill-history-cancel",component:Ki},{path:"payment-history",component:qi},{path:"payment-history-cancel",component:Zi},{path:"email-pdf-report/:type/:id",component:Ji},{path:"bill-consumption",component:Dn},{path:"failed-bills",component:Ln},{path:"create-paymentdue",component:nl},{path:"create-refund",component:Sl},{path:"tenant-payment",component:Pl},{path:"invoice-aging-report",component:Al},{path:"create-consolidated",component:ql},{path:"credit-note-history",component:ia},{path:"account-statement",component:(ga=function(){function e(t,i,n,a,o,r,s,c,u,d,m,h){var b,f,p;l(this,e),this.billService=t,this.billSettlementService=i,this.ownerService=n,this.date=a,this.currencyPipe=o,this.decimalPipe=r,this.jwtHelperService=s,this.snackbar=c,this.registerService=u,this.clientSelectionService=d,this.cookieService=m,this.showSpinner=!1,this.role="",this._gap=16,this.gap=this._gap+"px",this.col2="1 1 calc(50% - ".concat(this._gap/2,"px)"),this.col3="1 1 calc(33.3333% - ".concat(this._gap/1.5,"px)"),this.tenants=[],this.billPeriods=[],this.billTypes=[],this.selectedRows=[],this.visibleButtons=[],this.columns=[],this.innerColumns=[],this.columnNames=[],this.billMasterDetails=[],this.availableBillMasterDetails=[],this.manageParams={},this.userActions=[],this.billType="",this.billAmount="",this.creditNoteAmount="",this.receivedAmount="",this.previousDueAmount="",this.userId="",this.disable=!1,this.disableColumn="paid",this.isMultipleTenant=!1,this.isMovedOutTenant=!1,this.dateFormat="",this.currency="",this.roundFormat="",this.filePath="",this.billNumberColumnName="Bill Number",this.tenantNameColumnName="Tenant Name",this.entityTypeColumnName="Transactions",this.detailsColumnName="Details",this.billDateColumnName="Bill Date",this.billAmountColumnName="Bill Amount",this.creditNoteAmountColumnName="Credit Note Amount",this.paidColumnName="Payment Amount",this.previousDueAmountColumnName="Balance",this.cssStyledColumn="status",this.buttonName="Credit Note",this.pdfsToMerge=[],this.filePath=h.backendForFiles,this.dateFormat=null!==(b=Object(y.e)("DateFormat"))&&void 0!==b?b:h.dateFormat,this.currency=null!==(f=Object(y.e)("Currency"))&&void 0!==f?f:h.currencyFormat,this.roundFormat=null!==(p=Object(y.e)("RoundOff"))&&void 0!==p?p:h.roundOffFormat}return o(e,[{key:"ngOnInit",value:function(){this.clientSelectionService.setIsClientVisible(!0);var e=this.cookieService.get("access_token"),t=this.jwtHelperService.decodeToken(e);t&&(this.role=t["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"],this.userId=t["http://schemas.xmlsoap.org/ws/2005/05/identity/claims/sid"],this.getUserEnabledActions()),this.ownerId=parseInt(this.cookieService.get("ownerId")),this.getTenants(),this.createColumnNames(),this.createGridColumns(),this.createInnerGridColumns(),this.addVisibleButtons()}},{key:"createGridColumns",value:function(){this.columns=["billDateLocal","entityType","status","ownerName","billAmountLocal","creditNoteAmountLocal","paidLocal","previousDueAmountLocal"]}},{key:"createInnerGridColumns",value:function(){this.innerColumns=[]}},{key:"createColumnNames",value:function(){this.columnNames=[{name:this.billNumberColumnName,property:"billNumber",visible:!0,isModelProperty:!0},{name:this.tenantNameColumnName,property:"ownerName",visible:!0,isModelProperty:!0},{name:this.entityTypeColumnName,property:"entityType",visible:!0,isModelProperty:!0},{name:this.billDateColumnName,property:"billDateLocal",visible:!0,isModelProperty:!0},{name:this.billAmountColumnName,property:"billAmountLocal",visible:!0,isModelProperty:!0,columnAlign:{"text-align":"right"}},{name:this.paidColumnName,property:"paidLocal",visible:!0,isModelProperty:!0,columnAlign:{"text-align":"right"}},{name:this.detailsColumnName,property:"status",visible:!0,isModelProperty:!0},{name:this.creditNoteAmountColumnName,property:"creditNoteAmountLocal",visible:!0,isModelProperty:!0,columnAlign:{"text-align":"right"}},{name:this.previousDueAmountColumnName,property:"previousDueAmountLocal",visible:!0,isModelProperty:!0,columnAlign:{"text-align":"right"}}]}},{key:"addVisibleButtons",value:function(){this.visibleButtons=[{property:"modify"},{property:"print"},{property:"reject"},{property:"cancel"}]}},{key:"getTenants",value:function(){var e=this;this.tenants=[],this.clientId=parseInt(this.cookieService.get("globalClientId")),this.isMovedOutTenant?this.ownerService.getMovedOutTenants(this.clientId).subscribe((function(t){e.tenants=t.filter((function(e,t,i){return i.findIndex((function(t){return t.Id===e.Id}))===t})),e.tenants=t})):this.billSettlementService.getTenantsDetails(this.clientId).subscribe((function(t){e.tenants=t}))}},{key:"getUserEnabledActions",value:function(){var e=this;this.userActions=[],this.registerService.getUserEnabledActions(this.userId).subscribe({next:function(t){e.userActions=t},error:function(){e.notificationMessage("User Actions not found","red-snackbar")}})}},{key:"onGetAccountStatement",value:function(e){var t=this;this.showSpinner=!0,this.manageParams=e,this.billMasterDetails=[],this.billAmount="",this.receivedAmount="",this.previousDueAmount="";var i=0,n=0,l=0;this.lstTenant=[],e.fromDate=""==e.fromDate?"":L(e.fromDate).format("YYYY-MM-DD"),e.toDate=""==e.toDate?"":L(e.toDate).format("YYYY-MM-DD"),this.lstTenant=this.manageParams.tenantId.split(","),this.isMultipleTenant=this.lstTenant.length>1,e.clientId=this.clientId,this.availableBillMasterDetails=this.billMasterDetails=[],this.billService.getAccountStatement(e).subscribe({next:function(a){if(a&&a.length){var o=a.filter((function(e){return!1===e.isBillFailed&&"SecurityDeposit"==e.entityType})),r=a.filter((function(e){return!1===e.isBillFailed&&"SecurityDeposit"!=e.entityType}));if(r&&r.length){var s=null;t.dateFormat=Object(y.e)("DateFormat"),t.roundFormat=Object(y.e)("RoundOff"),t.currency=Object(y.e)("Currency"),r.forEach((function(a){a.billDateLocal=t.date.transform(a.billDate.toString(),t.dateFormat.toString()),a.billAmountLocal=t.currencyPipe.transform(a.billAmount,t.currency.toString(),!0,t.roundFormat),a.creditNoteAmountLocal=t.currencyPipe.transform(a.creditNoteAmount,t.currency.toString(),!0,t.roundFormat),a.paidLocal=t.currencyPipe.transform(Number(a.paid),t.currency.toString(),!0,t.roundFormat),null!=s&&"Invoice"===a.entityType||"CreditNote"===a.entityType?a.previousDueAmount=Number(s)+Number(a.billAmount)-Number(a.paid)-Number(a.creditNoteAmount):null!=s&&"Payment"===a.entityType&&(a.previousDueAmount=Number(s)-Number(a.billAmount)-Number(a.paid)-Number(a.creditNoteAmount)),a.previousDueAmountLocal=t.currencyPipe.transform(a.previousDueAmount,t.currency.toString(),!0,t.roundFormat),i+=Number(a.billAmount),l+=Number(a.creditNoteAmount),n+=Number(a.paid),s=Number(a.previousDueAmount),a.fromDate=new Date(e.fromDate),a.toDate=new Date(e.toDate)})),t.billMasterDetails=r,t.billAmount=t.currencyPipe.transform(i,t.currency.toString(),!0,t.roundFormat),t.creditNoteAmount=t.currencyPipe.transform(l,t.currency.toString(),!0,t.roundFormat),t.receivedAmount=t.currencyPipe.transform(n,t.currency.toString(),!0,t.roundFormat),t.previousDueAmount=t.currencyPipe.transform(a[a.length-1].previousDueAmount,t.currency.toString(),!0,t.roundFormat),t.availableBillMasterDetails=r.map((function(e){return e})),o&&o.length&&o.forEach((function(e){return t.availableBillMasterDetails.push(e)}))}else t.notificationMessage("No data found.","yellow-snackbar")}else t.notificationMessage("No data found.","yellow-snackbar");t.showSpinner=!1},error:function(){t.showSpinner=!1}})}},{key:"onSelectedRows",value:function(e){this.selectedRows=[],this.selectedRows=e,this.disable=!1,this.selectedRows&&this.selectedRows.length&&this.selectedRows.find((function(e){return 1==e.isApproved}))&&(this.disable=!0)}},{key:"onPrintPdf",value:function(e){return Object(h.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.pdfsToMerge=[],this.availableBillMasterDetails&&this.availableBillMasterDetails.length?(this.availableBillMasterDetails[0].fromDate=new Date(this.manageParams.fromDate),this.availableBillMasterDetails[0].toDate=new Date(this.manageParams.toDate),"Normal"===e?this.accountStatementView(this.availableBillMasterDetails):this.downloadDetailReport(this.availableBillMasterDetails)):this.notificationMessage("Account statement not available.","red-snackbar");case 1:case"end":return t.stop()}}),t,this)})))}},{key:"downloadAllTenantsFiles",value:function(e){return Object(h.a)(this,void 0,void 0,regeneratorRuntime.mark((function i(){var n,l,a,o,r,s,c,u;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,ee.PDFDocument.create();case 2:n=i.sent,l=t(e),i.prev=4,l.s();case 6:if((a=l.n()).done){i.next=16;break}return o=a.value,i.next=10,ee.PDFDocument.load(o);case 10:return r=i.sent,i.next=13,n.copyPages(r,r.getPageIndices());case 13:i.sent.forEach((function(e){n.addPage(e)}));case 14:i.next=6;break;case 16:i.next=21;break;case 18:i.prev=18,i.t0=i.catch(4),l.e(i.t0);case 21:return i.prev=21,l.f(),i.finish(21);case 24:return i.next=26,n.save();case 26:s=i.sent,c=new Blob([s],{type:"application/pdf"}),u=window.URL.createObjectURL(c),window.open(u);case 30:case"end":return i.stop()}}),i,null,[[4,18,21,24]])})))}},{key:"downloadFile",value:function(e){return Object(h.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var i,n,l,a,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ee.PDFDocument.create();case 2:return i=t.sent,t.next=5,ee.PDFDocument.load(e);case 5:return n=t.sent,t.next=8,i.copyPages(n,n.getPageIndices());case 8:return t.sent.forEach((function(e){i.addPage(e)})),t.next=11,i.save();case 11:l=t.sent,a=new Blob([l],{type:"application/pdf"}),o=window.URL.createObjectURL(a),window.open(o);case 15:case"end":return t.stop()}}),t)})))}},{key:"downloadReport",value:function(e){var t=[],i=[],n=[],l=0,a=0;e.forEach((function(e){l+=Number(e.billAmount),"Opening Balance"!==e.entityType&&(a+=Number(e.paid))}));for(var o=0;o<e.length;o++)t.push(e[o].billDateLocal),t.push(e[o].entityType),t.push(e[o].status),t.push(e[o].billAmountLocal),t.push(e[o].paidLocal),t.push(e[o].previousDueAmountLocal),n.push(t),t=[];t.push(""),t.push(""),t.push(""),t.push(""),t.push("Balance Due"),t.push(e[e.length-1].previousDueAmountLocal),n.push(t),i.push({label:"Opening Balance",value:e[0].previousDueAmountLocal},{label:"Invoiced Amount",value:this.currencyPipe.transform(l,this.currency.toString(),!0,this.roundFormat)},{label:"Amount Paid",value:this.currencyPipe.transform(a,this.currency.toString(),!0,this.roundFormat)},{label:"Balance Due",value:e[e.length-1].previousDueAmountLocal}),this.getReport(e,i,["Date","Transactions","Details","Amount","Payments","Balance"],n)}},{key:"addImage",value:function(e,t,i){var n;try{if(t&&t.length&&t[0]&&t[0].client&&t[0].client.imageProperties&&t[0].client.imageProperties.length){var l=t[0].client.imageProperties.find((function(e){return e.imageType.trim().toLowerCase()===i.toLowerCase()}));if(l){var a=new Image;a.src=this.filePath+"/uploads/"+(null===(n=t[0].client)||void 0===n?void 0:n.photo),a.onload=function(){e.addImage(a,l.imgX,l.imgY,l.imgW,l.imgH)}}else this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar")}else this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar")}catch(o){this.notificationMessage("Image not found.","red-snackbar")}return e}},{key:"accountStatementView",value:function(e){var t=this;this.lstTenant.length>1?this.billService.accountStatementSummaryView(e).subscribe({next:function(e){e?t.downloadAllTenantsFiles(e):t.notificationMessage("No data to print","red-snackbar")},error:function(){t.notificationMessage("No data to print","red-snackbar")}}):this.billService.accountStatementView(e).subscribe({next:function(e){e?t.downloadFile(e):t.notificationMessage("No data to print","red-snackbar")},error:function(){t.notificationMessage("No data to print","red-snackbar")}})}},{key:"getReport",value:function(e,t,i,n){var l,a,o,r,s=new Fe.default({orientation:"portrait",unit:"pt",format:"letter"});s.rect(5,5,s.internal.pageSize.width-10,s.internal.pageSize.height-10,"S"),this.addImage(s,e,"Account Statement"),s.setFontSize(30),s.setTextColor(0,0,0),s.setFontSize(14),s.setFont("Cambria"),s.text(Object(y.f)(e[0].client.clientName).toUpperCase(),s.internal.pageSize.width-600,50),s.setFontSize(10),s.text("TRN: "+e[0].client.trnNo,s.internal.pageSize.width-600,60),s.text("PO Box "+e[0].client.addresses[0].zipPostalCode,s.internal.pageSize.width-600,70),s.text(e[0].client.addresses[0].address1+","+e[0].client.addresses[0].country,s.internal.pageSize.width-600,80),s.text("Phone: "+e[0].client.phoneNo,s.internal.pageSize.width-600,90),s.text("Email: "+e[0].client.email+", Web: "+e[0].client.website,s.internal.pageSize.width-600,100),s.setTextColor(0,0,0),s.setFontSize(10),s.text("Customer Details",10,120),s.setFillColor(241,241,244),s.setDrawColor(206,203,203),s.rect(10,130,250,75,"FD"),s.setTextColor(0,0,0),s.setFontSize(10),s.text(null===(l=e[0])||void 0===l?void 0:l.ownerName.toUpperCase(),20,145),s.text("CUSTOMER TRN: "+(null===(a=e[0])||void 0===a?void 0:a.trn),20,160),s.text("unit #"+(null===(o=e[1])||void 0===o?void 0:o.unitNumber),20,175),s.text("Account Number: "+(null===(r=e[0])||void 0===r?void 0:r.accountNumber),20,190),s.setFontSize(9),s.setFontSize(11),s.setFont("Cambria","bold"),s.text("Statement of Accounts".toUpperCase(),s.internal.pageSize.width-250,70),s.setFont("Cambria","normal"),s.setTextColor(0,0,0),s.setFontSize(9),s.line(s.internal.pageSize.width-250,80,607,80);var c=this.date.transform(this.manageParams.fromDate.toString(),this.dateFormat.toString()),u=this.date.transform(this.manageParams.toDate.toString(),this.dateFormat.toString());s.text((c+" - "+u).toString(),s.internal.pageSize.width-250,90),s.line(s.internal.pageSize.width-250,100,607,100),s.setFontSize(10),s.text("Account Summary",s.internal.pageSize.width-250,120),s.setFontSize(9),s.autoTable("",t,{startX:s.internal.pageSize.width-250,startY:130,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:s.internal.pageSize.width-250},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:135,halign:"left"},1:{cellWidth:100,halign:"right"}},didParseCell:function(e){var t=e.column.index;0!=t&&1!=t||(e.cell.styles.rowHeight=1)},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});var d=Number(this.decimalPipe.transform(s.autoTable.previous.finalY,"1.0-0"));s.setLineWidth(.1),s.line(5,d+10,607,d+10),s.autoTable(i,n,{startX:10,startY:d+20,didDrawPage:function(e){var t="Page "+e.pageCount;"function"==typeof s.putTotalPages&&(t+=" of 1",s.rect(5,5,s.internal.pageSize.width-10,s.internal.pageSize.height-10,"S")),s.setFontSize(9);var i=s.internal.pageSize.height||s.internal.pageSize.getHeight();s.text(t,e.settings.margin.left,i-10)},styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:d+20,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:70,halign:"center"},1:{cellWidth:100,halign:"center"},2:{cellWidth:180,halign:"center"},3:{cellWidth:80,halign:"right"},4:{cellWidth:80,halign:"right"},5:{cellWidth:80,halign:"right"}},didParseCell:function(e){"Balance Due"===e.cell.raw&&(e.cell.styles.fontStyle="bold")},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]}}),s.setTextColor(0,0,0),"function"==typeof s.putTotalPages&&s.putTotalPages("1");var m=s.output("datauristring");this.pdfsToMerge.push(m)}},{key:"notificationMessage",value:function(e,t){this.snackbar.open(e,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[t]})}},{key:"downloadDetailReport",value:function(e){var t=this,i=[],n=[];e.forEach((function(e){}));var l=[],a=[];e.forEach((function(e){e.bills&&e.bills.length&&e.bills.forEach((function(e){e.billTransactions&&e.billTransactions.length&&e.billTransactions.forEach((function(e){l.includes(e.headDisplay)||l.push(e.headDisplay)}))})),e.billCharges&&e.billCharges.length&&e.billCharges.forEach((function(e){a.includes(e.headDisplay)||a.push(e.headDisplay)}))}));var o=["Date","Transactions","Details"];l.forEach((function(e){o.push(e)})),a.forEach((function(e){o.push(e)})),o.push("Amount","Payments","Balance");for(var r=this.currencyPipe.transform(0,this.currency.toString(),!0,this.roundFormat),s=function(o){i.push(e[o].billDateLocal),i.push(e[o].entityType),i.push(e[o].status),l.forEach((function(n){if(e[o].bills&&e[o].bills.length){var l=e[o].bills.filter((function(e){return 1==e.isDifferentiateBill}));if(l&&l.length&&e[o].bills.length==l.length)if(l[l.length-1].billTransactions&&l[l.length-1].billTransactions.length){var a=l[l.length-1].billTransactions.find((function(e){return e.headDisplay.toLowerCase()===n.toLowerCase()}));i.push(a?t.currencyPipe.transform(a.headAmount,t.currency.toString(),!0,t.roundFormat):r)}else i.push(r);else e[o].bills.forEach((function(e){if(e.billTransactions&&e.billTransactions.length){var l=e.billTransactions.find((function(e){return e.headDisplay.toLowerCase()===n.toLowerCase()}));i.push(l?t.currencyPipe.transform(l.headAmount,t.currency.toString(),!0,t.roundFormat):r)}else i.push(r)}))}else i.push(r)})),a.forEach((function(n){if(e[o].billCharges&&e[o].billCharges.length){var l=e[o].billCharges.find((function(e){return e.headDisplay.toLowerCase()===n.toLowerCase()}));i.push(l?t.currencyPipe.transform(l.headAmount,t.currency.toString(),!0,t.roundFormat):r)}else i.push(r)})),i.push(t.currencyPipe.transform(e[o].billAmount,t.currency.toString(),!0,t.roundFormat)),i.push(t.currencyPipe.transform(e[o].paid,t.currency.toString(),!0,t.roundFormat)),i.push(t.currencyPipe.transform(e[o].previousDueAmount,t.currency.toString(),!0,t.roundFormat)),n.push(i),i=[]},c=0;c<e.length;c++)s(c);i=[];for(var u=0;u<o.length;u++)u<o.length-2?i.push(""):(i.push("Balance Due"),i.push(e[e.length-1].previousDueAmountLocal));n.push(i),this.getDetailReport(e,o,n)}},{key:"getDetailReport",value:function(e,t,i){var n,l,a,o,r,s=new Fe.default({orientation:"landscape",unit:"pt",format:"letter"});s.rect(5,5,s.internal.pageSize.width-10,s.internal.pageSize.height-10,"S"),s.setFontSize(30),this.addImage(s,e,"Landscape"),s.setTextColor(0,0,0),s.setFontSize(12),s.setFont("Cambria","bold");var c=this.date.transform((new Date).toString(),this.dateFormat.toString()),u=L().format("M/D/YYYY hh:mm:ss a");s.text("Statement of Accounts As "+c,310,30),s.setFont("Cambria","normal"),s.setFontSize(9),s.text("Print Date:"+u,s.internal.pageSize.width-150,20),s.setTextColor(0,0,0),s.setFontSize(10),s.text(null===(n=e[0])||void 0===n?void 0:n.ownerName.toUpperCase(),340,50),s.text("Unit #"+(null===(l=e[1])||void 0===l?void 0:l.unitNumber),340,65),s.text("Tower Name: "+(null===(o=null===(a=e[0])||void 0===a?void 0:a.client)||void 0===o?void 0:o.clientName),340,80),s.text("Account Number: "+(null===(r=e[0])||void 0===r?void 0:r.accountNumber),340,95),s.setFontSize(9);var d=this.date.transform(this.manageParams.fromDate.toString(),this.dateFormat.toString()),m=this.date.transform(this.manageParams.toDate.toString(),this.dateFormat.toString());s.text((d+" - "+m).toString(),340,110),s.setFontSize(10),s.autoTable(t,i,{startX:10,startY:120,didDrawPage:function(e){var t="Page "+e.pageCount;"function"==typeof s.putTotalPages&&(t+=" of 1",s.rect(5,5,s.internal.pageSize.width-10,s.internal.pageSize.height-10,"S")),s.setFontSize(9);var i=s.internal.pageSize.height||s.internal.pageSize.getHeight();s.text(t,e.settings.margin.left,i-10)},styles:{overflow:"linebreak",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:120,left:10},theme:"grid",tableWidth:"auto",columnStyles:{0:{cellWidth:t.length>4?"40":"wrap",halign:"center"},1:{cellWidth:t.length>4?"40":"wrap",halign:"center"},2:{cellWidth:t.length>4?"60":"wrap",halign:"center"},3:{cellWidth:"wrap",halign:"right"},4:{cellWidth:"wrap",halign:"right"},5:{cellWidth:"wrap",halign:"right"},6:{cellWidth:"wrap",halign:"right"},7:{cellWidth:"wrap",halign:"right"},8:{cellWidth:"wrap",halign:"right"},9:{cellWidth:"wrap",halign:"right"},10:{cellWidth:"wrap",halign:"right"}},didParseCell:function(e){"Balance Due"===e.cell.raw&&(e.cell.styles.fontStyle="bold")},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]}}),s.setTextColor(0,0,0),"function"==typeof s.putTotalPages&&s.putTotalPages("1");var h=s.output("datauristring");this.pdfsToMerge.push(h)}},{key:"getJsonData",value:function(){var e=this,t=[],i=[];this.tableData=[];var n=[],l=[];this.billMasterDetails.forEach((function(e){e.bills&&e.bills.length&&e.bills.forEach((function(e){e.billTransactions&&e.billTransactions.length&&e.billTransactions.forEach((function(e){n.includes(e.headDisplay)||n.push(e.headDisplay)}))})),e.billCharges&&e.billCharges.length&&e.billCharges.forEach((function(e){l.includes(e.headDisplay)||l.push(e.headDisplay)}))}));var a=["Date","Transactions","Details"];n.forEach((function(e){a.push(e)})),l.forEach((function(e){a.push(e)})),a.push("Amount","Payments","Balance"),this.tableData.push(a);for(var o=this.currencyPipe.transform(0,this.currency.toString(),!0,this.roundFormat),r=function(a){t.push(e.billMasterDetails[a].billDateLocal),t.push(e.billMasterDetails[a].entityType),t.push(e.billMasterDetails[a].status),n.forEach((function(i){var n=0;if(e.billMasterDetails[a].bills&&e.billMasterDetails[a].bills.length){var l=e.billMasterDetails[a].bills.filter((function(e){return 1==e.isDifferentiateBill}));if(l&&l.length&&e.billMasterDetails[a].bills.length==l.length)if(l[l.length-1].billTransactions&&l[l.length-1].billTransactions.length){var r=l[l.length-1].billTransactions.find((function(e){return e.headDisplay.toLowerCase()===i.toLowerCase()}));r&&(n=r.headAmount)}else t.push(o);else e.billMasterDetails[a].bills.forEach((function(e){if(e.billTransactions&&e.billTransactions.length){var t=e.billTransactions.find((function(e){return e.headDisplay.toLowerCase()===i.toLowerCase()}));t&&(n+=t.headAmount)}})),t.push(n>0?e.currencyPipe.transform(n,e.currency.toString(),!0,e.roundFormat):o)}else t.push(o)})),l.forEach((function(i){if(e.billMasterDetails[a].billCharges&&e.billMasterDetails[a].billCharges.length){var n=e.billMasterDetails[a].billCharges.find((function(e){return e.headDisplay.toLowerCase()===i.toLowerCase()}));t.push(n?e.currencyPipe.transform(n.headAmount,e.currency.toString(),!0,e.roundFormat):o)}else t.push(o)})),t.push(e.currencyPipe.transform(e.billMasterDetails[a].billAmount,e.currency.toString(),!0,e.roundFormat)),t.push(e.currencyPipe.transform(e.billMasterDetails[a].paid,e.currency.toString(),!0,e.roundFormat)),t.push(e.currencyPipe.transform(e.billMasterDetails[a].previousDueAmount,e.currency.toString(),!0,e.roundFormat)),i.push(t),e.tableData.push(t),t=[]},s=0;s<this.billMasterDetails.length;s++)r(s);t=[];for(var c=0;c<a.length;c++)c<a.length-2?t.push(""):t.includes("Balance Due")||(t.push("Balance Due"),t.push(this.billMasterDetails[this.billMasterDetails.length-1].previousDueAmountLocal));this.tableData.push(t)}},{key:"getAllTenantsJsonData",value:function(){var e=this;this.tableData=[];var t=this.currencyPipe.transform(0,this.currency.toString(),!0,this.roundFormat.toString());null!=this.billMasterDetails&&this.billMasterDetails.forEach((function(i){var n=[];n=e.billMasterDetails.filter((function(e){return e.ownerName==i.ownerName}));var l=e.tableData.filter((function(e){return e.TenantName==i.ownerName}));l&&0==l.length&&(n.forEach((function(i){var n={BillDate:e.date.transform(i.billDate,"yyyy-MM-dd"),Transactions:i.entityType,Details:i.status,TenantName:i.ownerName,BillAmount:i.billAmountLocal,CreditNoteAmount:i.creditNoteAmountLocal,PaymentAmount:i.paidLocal,Balance:i.previousDueAmountLocal};t=i.previousDueAmountLocal,e.tableData.push(n)})),e.tableData.push({BillDate:"",Transactions:"",Details:"",TenantName:"",BillAmount:"",CreditNoteAmount:"",PaymentAmount:"Balance Due",Balance:t}))}))}},{key:"onExport",value:function(){if(this.billMasterDetails&&this.billMasterDetails.length>0){if(this.lstTenant.length>1?this.getAllTenantsJsonData():this.getJsonData(),null!=this.tableData){var e=this.lstTenant.length>1?jt.utils.json_to_sheet(this.tableData):jt.utils.aoa_to_sheet(this.tableData),t=jt.utils.book_new();jt.utils.book_append_sheet(t,e,"Sheet1"),jt.writeFile(t,"AccountStatement.xlsx")}}else this.notificationMessage("No Data to Export","yellow-snackbar")}},{key:"showMovedOutTenants",value:function(e){this.isMovedOutTenant=e,this.getTenants()}}]),e}(),ga.\u0275fac=function(e){return new(e||ga)(g.Nb(b.a),g.Nb(M.a),g.Nb(da.a),g.Nb(d.f),g.Nb(d.d),g.Nb(d.g),g.Nb(D.a),g.Nb(B.b),g.Nb(Dt.a),g.Nb(Z.a),g.Nb(w.a),g.Nb(C.a))},ga.\u0275cmp=g.Hb({type:ga,selectors:[["app-account-statement"]],viewQuery:function(e,t){var i;1&e&&(g.Vc(ma,!0),g.Jc(ca,!0),g.Jc(ua,!0)),2&e&&(g.zc(i=g.cc())&&(t.htmlData=i.first),g.zc(i=g.cc())&&(t.accountStatementToolbarComponent=i.first),g.zc(i=g.cc())&&(t.accountStatementFooterToolbarComponent=i.first))},decls:18,vars:13,consts:[["mode","card"],["class","loading-indicator",4,"ngIf"],["fxLayout","column",1,"content"],["color","primary",1,"position-fixed"],["src","assets/img/fav-icon.png",1,"img-style"],[1,"example-spacer"],[3,"userActions","disable","printClicked","exportClicked"],["fxFlex","noshrink","fxLayout","column","fxLayout.gt-sm","row","fxLayoutAlign.gt-sm","start stretch",3,"fxLayoutGap"],["fxFlex","grow",1,"basic-forms","route-animations-elements",3,"fxFlex.gt-sm"],["fxLayout","column"],["fxLayout","column",1,"result"],[3,"tenants","billPeriods","isHide","billTypes","searchClicked","tenantChanged"],["class","padding","fxLayout","column",4,"ngIf"],["class","result","fxLayout.gt-sm","row","fxLayout","column","fxLayoutAlign","end end","fxLayoutGap.gt-sm","12px",4,"ngIf"],[1,"loading-indicator"],["mode","indeterminate","color","accent"],["fxLayout","column",1,"padding"],[3,"tableData","columnsToDisplay","innerDisplayedColumns","columnNames","hideHeader","cssStyledColumn","visibleButtons","role","buttonName","disableColumn","selectedRows"],["fxLayout.gt-sm","row","fxLayout","column","fxLayoutAlign","end end","fxLayoutGap.gt-sm","12px",1,"result"],["color","primary",1,"result"],["type","text","id","billAmount","name","billAmount","matInput","",2,"text-align","right",3,"ngModel","ngModelChange"],["type","text","id","creditNoteAmount","name","creditNoteAmount","matInput","",2,"text-align","right",3,"ngModel","ngModelChange"],["type","text","id","receivedAmount","name","receivedAmount","matInput","",2,"text-align","right",3,"ngModel","ngModelChange"],["type","text","id","previousDueAmount","name","previousDueAmount","matInput","",2,"text-align","right",3,"ngModel","ngModelChange"]],template:function(e,t){1&e&&(g.Tb(0,"fury-page-layout",0),g.Pc(1,ha,2,0,"div",1),g.Tb(2,"fury-page-layout-content",2),g.Tb(3,"mat-toolbar",3),g.Ob(4,"img",4),g.Tb(5,"span"),g.Rc(6,"Account Statement"),g.Sb(),g.Ob(7,"span",5),g.Tb(8,"fury-account-statement-footer-toolbar",6),g.bc("printClicked",(function(e){return t.onPrintPdf(e)}))("exportClicked",(function(){return t.onExport()})),g.Sb(),g.Sb(),g.Tb(9,"div",7),g.Tb(10,"fury-card",8),g.Ob(11,"fury-card-header"),g.Tb(12,"fury-card-content",9),g.Tb(13,"div",10),g.Tb(14,"app-account-statement-toolbar",11),g.bc("searchClicked",(function(e){return t.onGetAccountStatement(e)}))("tenantChanged",(function(e){return t.showMovedOutTenants(e)})),g.Sb(),g.Sb(),g.Pc(15,ba,2,0,"div",12),g.Pc(16,fa,2,10,"div",12),g.Pc(17,pa,17,4,"div",13),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb()),2&e&&(g.Cb(1),g.mc("ngIf",t.showSpinner),g.Cb(7),g.mc("userActions",t.userActions)("disable",t.disable),g.Cb(1),g.mc("fxLayoutGap",t.gap),g.Cb(1),g.mc("fxFlex.gt-sm",t.col2)("@fadeInUp",void 0),g.Cb(4),g.mc("tenants",t.tenants)("billPeriods",t.billPeriods)("isHide",!1)("billTypes",t.billTypes),g.Cb(1),g.mc("ngIf",1==t.isMultipleTenant),g.Cb(1),g.mc("ngIf",0==t.isMultipleTenant),g.Cb(1),g.mc("ngIf",!1))},directives:[te.a,d.o,ie.a,N.d,ne.a,ua,N.b,N.c,N.e,S.a,S.d,S.c,ca,ae.a,x.a,z.d,z.h,E.b,s.c,s.q,s.t],styles:['.padding[_ngcontent-%COMP%]{padding:0 0 24px}.example-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.content[_ngcontent-%COMP%]{margin-top:2%}.img-style[_ngcontent-%COMP%]{width:32px}ul[_ngcontent-%COMP%]{margin:20px}.label-color[_ngcontent-%COMP%]{position:relative}.label-color[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{padding-left:20px}.label-color[_ngcontent-%COMP%]   .color-box[_ngcontent-%COMP%]{width:10px;height:10px;display:inline-block;background-color:#ccc;position:absolute;left:5px;top:5px}.position-fixed[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;top:0;z-index:5}.loading-indicator[_ngcontent-%COMP%]{position:fixed;z-index:999;height:2em;width:2em;overflow:show;margin:auto;top:0;left:0;bottom:0;right:0}.loading-indicator[_ngcontent-%COMP%]:before{content:"";display:block;position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.3)}'],data:{animation:[p.a,f.a]}}),ga)}],Ta=((va=function e(){l(this,e)}).\u0275mod=g.Lb({type:va}),va.\u0275inj=g.Kb({factory:function(e){return new(e||va)},imports:[[m.j.forChild(Sa)],m.j]}),va),Pa=a("KthW"),Da=a("WCGO"),wa=a("QMK6"),Na=a("VE2z"),xa=a("q8Jb"),ka=a("jaxi"),Aa=a("0jmt"),Fa=a("qnpF"),Ra=((ya=function e(){l(this,e)}).\u0275mod=g.Lb({type:ya}),ya.\u0275inj=g.Kb({factory:function(e){return new(e||ya)},imports:[[d.c,s.l,Pa.a,Da.a,Aa.a,ye.l]]}),ya),Ia=a("zWnM"),Oa=a("zeEN"),Wa=((Ca=function e(){l(this,e)}).\u0275mod=g.Lb({type:Ca}),Ca.\u0275inj=g.Kb({factory:function(e){return new(e||Ca)},providers:[d.f,d.g],imports:[[d.c,Ta,s.l,c.a,u.a,Fa.a,Pa.a,Da.a,s.w,wa.a,Na.a,Aa.a,xa.a,z.f,E.c,ka.c,F.b,ll.c,ne.b,A.b,v.g,Ra,Ia.a,Oa.a]]}),Ca)}}])}();