(window.webpackJsonp=window.webpackJsonp||[]).push([[103],{"q/tE":function(t,e,o){"use strict";o.r(e),o.d(e,"EmsGroupwiseEnergyCostModule",(function(){return A}));var r=o("ofXK"),n=o("3Pt+"),s=o("tyNb"),i=o("6n/F"),a=o("KHMF"),c=o("zSPf"),l=o("JX19"),h=o("sXtk"),u=o("fXoL"),p=o("b6Qw"),d=o("xBcV"),g=o("rvYj"),b=o("XiUz"),m=o("jaxi"),f=o("kmnG"),y=o("d3UM"),C=o("qFsG"),S=o("f0Cb"),v=o("FKr1"),x=o("Wp6s");const T=["allMeterGroupsSelected"];function G(t,e){if(1&t&&(u.Tb(0,"mat-button-toggle",27),u.Rc(1),u.Sb()),2&t){const t=e.$implicit,o=e.index;u.nc("id",t),u.nc("value",t),u.mc("checked",0===o),u.Cb(1),u.Sc(t)}}function M(t,e){if(1&t&&(u.Tb(0,"mat-button-toggle",28),u.Rc(1),u.Sb()),2&t){const t=e.$implicit,o=e.index;u.nc("id",t),u.nc("value",t),u.mc("checked",0===o),u.Cb(1),u.Sc(t)}}function k(t,e){if(1&t){const t=u.Ub();u.Tb(0,"mat-option",15),u.bc("click",(function(){u.Ec(t);const e=u.fc(),o=u.Ac(21);return e.toggleMeterGroupPerOne(o.viewValue)})),u.Rc(1),u.Sb()}if(2&t){const t=e.$implicit;u.mc("value",t.id),u.Cb(1),u.Tc(" ",t.description," ")}}const L=[{path:"",component:(()=>{class t{constructor(t,e,o,r,n){var s;this.cookieService=t,this.fb=e,this.masterService=o,this.emsDashboardService=r,this.envService=n,this.showSpinner=!1,this.frequency=["Daily","Weekly","Monthly","Yearly"],this.buttons=["Today","Yesterday"],this.selectedValue="Daily",this.reportType="Today",this.previousLabel="",this.currentLabel="",this.forecastLabel="",this.estimatedSavingsLabel="Estimated Savings",this.previousEnergyCost=0,this.currentEnergyCost=0,this.forecastEnergyCost=0,this.estimatedSavings=0,this.clientId="0",this.meterTypes=[],this.energyCostComparison=[],this.costComparisonChart=[],this.energyCost=[],this.isCurrent=!0,this.currency="",this.donutChartOptions={},this.meterGroup=[],this.lstMeterGroup=[],this.lstFilterMeterGroup=[],this.currency=null!==(s=Object(a.e)("Currency"))&&void 0!==s?s:n.currencyFormat}ngOnInit(){this.form=this.fb.group({meterGroup:[""]});const t=this.cookieService.get("filterData");if(t){let e=JSON.parse(t);this.clientId=""==e.strClientId?this.cookieService.get("globalClientId"):e.strClientId}this.setConsumptionLables(),this.getDeviceGroups(),this.getGroupwiseEnergyCost()}getUtilities(){this.emsDashboardService.getUtilities(this.clientId).subscribe(t=>{t&&(this.meterTypes=[],t.forEach(t=>{this.meterTypes.push(t.description)}))})}getDeviceGroups(){this.lstMeterGroup=[],this.masterService.getUserMasterdata(71,0).subscribe(t=>{this.lstMeterGroup=this.lstFilterMeterGroup=t,this.lstMeterGroup.forEach(t=>{this.meterGroup.push(t.id)}),this.getGroupwiseEnergyCost()})}onValChange(t){this.selectedValue=null!=t?t.value:this.frequency[0],this.reportType=this.buttons[0],this.isCurrent=!0,this.setConsumptionLables(t.value),this.getGroupwiseEnergyCost()}ngAfterViewChecked(){let t=document.getElementById(this.reportType);this.buttons.forEach(t=>{document.getElementById(t).className="mat-raised-button"}),t.className="mat-raised-button-checked"}onButtonChange(t){this.reportType=null!=t?t.value:this.buttons[0];let e=document.getElementById(this.reportType);this.buttons.forEach(t=>{document.getElementById(t).className="mat-raised-button"}),e.className="mat-raised-button-checked",this.isCurrent=this.buttons[0]==this.reportType,this.getGroupwiseEnergyCost()}setConsumptionLables(t="Daily"){this.previousLabel="",this.currentLabel="",this.forecastLabel="";let e=new Date;"Daily"===t?(this.currentLabel="So far Today",this.previousLabel="Yesterday",this.forecastLabel="Predicted Today",this.buttons=["Today","Yesterday"],this.reportType=this.buttons[0]):"Weekly"===t?(this.currentLabel="So far This Week",this.previousLabel="Last Week",this.forecastLabel="Predicted This Week",this.buttons=["This Week","Last Week"],this.reportType=this.buttons[0]):"Monthly"===t?(e.setDate(1),e.setMonth(e.getMonth()-1),this.currentLabel="So far This Month",this.previousLabel=e.toLocaleString("en-us",{month:"long"}),this.forecastLabel="Predicted This Month",this.buttons=["This Month","Last Month"],this.reportType=this.buttons[0]):(this.currentLabel="So far This Year",this.previousLabel="Last Year",this.forecastLabel="Predicted This Year",this.buttons=["This Year","Last Year"],this.reportType=this.buttons[0])}toggleMeterGroupsAllSelection(){this.allMeterGroupsSelected.selected?(this.form.controls.meterGroup.patchValue([...this.lstMeterGroup.map(t=>t.id),0]),this.getGroupwiseEnergyCost()):(this.form.controls.meterGroup.patchValue([]),this.getGroupwiseEnergyCost())}toggleMeterGroupPerOne(){this.allMeterGroupsSelected.selected&&this.allMeterGroupsSelected.deselect(),this.form.controls.meterGroup.value.length==this.lstMeterGroup.length&&this.allMeterGroupsSelected.select(),this.getGroupwiseEnergyCost()}search(t){let e=this.select(t);this.lstMeterGroup=e}select(t){let e=[];if(t)for(let o of this.lstMeterGroup)o.description.toLowerCase().indexOf(t)>-1&&e.push(o);else e=this.lstFilterMeterGroup;return e}getGroupwiseEnergyCost(){this.showSpinner=!1;let t,e={};this.costComparisonChart=[];let o=[];e.chartValues=[],this.currentEnergyCost=0,this.stackedBarChartOptions=this.setStackedCostComparisonChart(this.costComparisonChart,o);let r=document.getElementById("egecontainer1");r&&i.chart("egecontainer1",this.stackedBarChartOptions),this.donutChartOptions=this.setDonutChart(e);let n=document.getElementById("egecontainer2");if(n&&i.chart("egecontainer2",this.donutChartOptions),this.meterGroup&&this.meterGroup.length>0){let s=this.meterGroup.findIndex(t=>0==t);s>=0&&this.meterGroup.splice(s,1);let a=this.meterGroup.join(",");this.emsDashboardService.getOverallGroupWiseEnergyCost(this.clientId,a,this.selectedValue,this.isCurrent).subscribe({next:s=>{s?(this.showSpinner=!1,this.groupWiseEnergyCost=s,t=s.energyCostStacks,o=s.categories,this.stackedBarChartOptions=this.setStackedCostComparisonChart(t,o),r=document.getElementById("egecontainer1"),r&&i.chart("egecontainer1",this.stackedBarChartOptions),this.currentEnergyCost=this.groupWiseEnergyCost.totalCost,e.chartValues=[],this.groupWiseEnergyCost.energyCost.forEach(t=>{e.chartValues.push([t.utilityType,t.currentCost])}),this.donutChartOptions=this.setDonutChart(e),n=document.getElementById("egecontainer2"),n&&i.chart("egecontainer2",this.donutChartOptions)):this.showSpinner=!1},error:t=>{this.showSpinner=!1}})}else this.showSpinner=!1}setDonutChart(t){return{chart:{marginTop:0,marginBottom:0,marginLeft:0,marginRight:0,backgroundColor:"#fafafa",height:350,type:"pie",options3d:{enabled:!1,alpha:45}},title:{text:"",align:"left",style:{fontFamily:"Roboto",fontWeight:"bolder"}},credits:{enabled:!1},exporting:{enabled:!1},noData:{style:{fontWeight:"bold",fontSize:"15px"}},legend:{floating:!1,align:"left",verticalAlign:"bottom",layout:"horizontal",fontFamily:"Roboto"},plotOptions:{series:{shadow:!1},marginLeft:0,pointPadding:.25,pie:{startAngle:-90,endAngle:90,innerSize:100,depth:25,colors:["#1fd286","#1e5eff","#ffda44","#d80027","#808080","#0d233a","#8bbc21","#910000","#1aadce","#492970","#f28f43","#77a1e5","#c42525","#a6c96a"]}},series:[{name:"Amount in "+this.currency,type:"pie",allowPointSelect:!0,dataLabels:{connectorWidth:0,crookDistance:"10%",enabled:!0},keys:["name","y","selected","sliced"],data:t.chartValues}]}}setStackedCostComparisonChart(t,e=[]){let o="",r="",n=new Date,s=new Date,a="Today's Energy Cost",c="";return"Monthly"==this.selectedValue?(c="Day",s.setDate(1),s.setMonth(s.getMonth()-1),o=n.toLocaleString("en-us",{month:"long"}),r=s.toLocaleString("en-us",{month:"long"}),a=1==this.isCurrent?o+" Energy Cost":r+" Energy Cost"):"Daily"==this.selectedValue?(c="Hour",a=1==this.isCurrent?"Today's Energy Cost":"Yesterday's Energy Cost"):"Weekly"==this.selectedValue?(c="Date",a=1==this.isCurrent?"This Week Energy Cost":"Last Week Energy Cost"):"Yearly"==this.selectedValue&&(c="Month",a=1==this.isCurrent?"This Year Energy Cost":"Last Year Energy Cost"),{chart:{type:"spline",marginLeft:90},title:{text:a,style:{fontWeight:"bolder",fontFamily:"Roboto"}},credits:{enabled:!1},colors:["#1fd286","#1e5eff","#ffda44","#d80027","#808080","#0d233a","#8bbc21","#910000","#1aadce","#492970","#f28f43","#77a1e5","#c42525","#a6c96a"],xAxis:{categories:e,visible:!0,title:{text:c}},yAxis:{title:{text:"Total Cost"}},legend:{align:"center",x:30,verticalAlign:"bottom",y:20,floating:!1,backgroundColor:i.defaultOptions.legend.backgroundColor||"white",shadow:!1},tooltip:{headerFormat:"<b>{point.x}</b><br/>",pointFormat:"{series.name}: "+this.currency+" {point.y}<br/>Total: "+this.currency+" {point.stackTotal}"},plotOptions:{series:{pointWidth:50},column:{pointWidth:20,stacking:"normal",dataLabels:{enabled:!1}}},series:t}}}return t.\u0275fac=function(e){return new(e||t)(u.Nb(p.a),u.Nb(n.f),u.Nb(c.a),u.Nb(l.a),u.Nb(h.a))},t.\u0275cmp=u.Hb({type:t,selectors:[["fury-ems-groupwise-energycost"]],viewQuery:function(t,e){var o;1&t&&u.Vc(T,!0),2&t&&u.zc(o=u.cc())&&(e.allMeterGroupsSelected=o.first)},decls:35,vars:10,consts:[["mode","card"],["fxLayout","column",1,"content"],[1,"toolBar"],[1,"example-spacer"],["name","fontStyle","aria-label","Font Style",1,"buttons",2,"font-size","small","float","right",3,"value","change"],["mat-raised-button","","style","padding: 0px;",3,"id","checked","value",4,"ngFor","ngForOf"],["name","fontStyle","aria-label","Font Style",2,"font-size","small","border","0px",3,"value","change"],["style","padding: 0px;margin-right: 8px;",3,"id","checked","value",4,"ngFor","ngForOf"],["fxLayout","row","fxLayout.xs","column","fxLayout.sm","column","fxLayoutGap","30px","fxFlex","100%",1,"content",2,"padding","0% 0% 1% 0%"],["fxLayout","column","fxFlex","30%"],[1,"tileHeading",2,"clear","both","padding-top","50px"],["fxFlex","",2,"padding-top","5px"],["multiple","","placeholder","Select a Meter Group",1,"multiSelectCustom",3,"ngModel","formControl","ngModelChange"],["matInput","","focused","'true'","type","text","autocomplete","off","placeholder","search",1,"myInput",3,"keyup"],["myInput",""],[3,"value","click"],["allMeterGroupsSelected",""],[3,"value","click",4,"ngFor","ngForOf"],["fxFlex","22%",1,"mat-elevation-z4",2,"height","175px","text-align","center"],["fxFlex","",2,"padding-top","30px"],[1,"topPadding"],[1,"tileHeading"],[1,"energyCost"],["id","egecontainer2",2,"height","200px","background-color","transparent","width","400px"],["fxLayout","row","fxLayout.xs","column","fxLayout.sm","column",1,"content",2,"padding","0% 0% 0.25% 0.20%"],["fxFlex","100%",1,"mat-elevation-z4"],["id","egecontainer1"],["mat-raised-button","",2,"padding","0px",3,"id","checked","value"],[2,"padding","0px","margin-right","8px",3,"id","checked","value"]],template:function(t,e){1&t&&(u.Tb(0,"fury-page-layout",0),u.Tb(1,"fury-page-layout-content",1),u.Tb(2,"div"),u.Tb(3,"span",2),u.Rc(4,"Group-wise Energy Cost"),u.Sb(),u.Ob(5,"span",3),u.Tb(6,"mat-button-toggle-group",4),u.bc("change",(function(t){return e.onValChange(t)})),u.Pc(7,G,2,4,"mat-button-toggle",5),u.Sb(),u.Sb(),u.Tb(8,"div"),u.Tb(9,"mat-button-toggle-group",6),u.bc("change",(function(t){return e.onButtonChange(t)})),u.Pc(10,M,2,4,"mat-button-toggle",7),u.Sb(),u.Sb(),u.Tb(11,"div",8),u.Tb(12,"div",9),u.Tb(13,"div",10),u.Rc(14,"Group By"),u.Sb(),u.Tb(15,"mat-form-field",11),u.Tb(16,"mat-select",12),u.bc("ngModelChange",(function(t){return e.meterGroup=t})),u.Tb(17,"input",13,14),u.bc("keyup",(function(t){return e.search(t.target.value)})),u.Sb(),u.Ob(19,"mat-divider"),u.Tb(20,"mat-option",15,16),u.bc("click",(function(){return e.toggleMeterGroupsAllSelection()})),u.Rc(22,"Select All"),u.Sb(),u.Pc(23,k,2,2,"mat-option",17),u.Sb(),u.Sb(),u.Sb(),u.Tb(24,"mat-card",18),u.Tb(25,"div",19),u.Ob(26,"span",20),u.Tb(27,"span",21),u.Rc(28,"Total Energy Cost"),u.Sb(),u.Tb(29,"p",22),u.Rc(30),u.Sb(),u.Sb(),u.Sb(),u.Ob(31,"div",23),u.Sb(),u.Tb(32,"div",24),u.Tb(33,"mat-card",25),u.Ob(34,"div",26),u.Sb(),u.Sb(),u.Sb(),u.Sb()),2&t&&(u.Cb(6),u.mc("value",e.selectedValue),u.Cb(1),u.mc("ngForOf",e.frequency),u.Cb(2),u.mc("value",e.reportType),u.Cb(1),u.mc("ngForOf",e.buttons),u.Cb(6),u.mc("ngModel",e.meterGroup)("formControl",e.form.controls.meterGroup),u.Cb(4),u.mc("value",0),u.Cb(3),u.mc("ngForOf",e.lstMeterGroup),u.Cb(7),u.Uc("",e.currency," ",e.currentEnergyCost," "))},directives:[d.a,g.a,b.d,m.b,r.n,b.e,b.b,f.d,y.a,n.q,n.h,C.b,S.a,v.n,x.a,m.a],styles:[".mat-button-toggle-checked[_ngcontent-%COMP%]{background-color:#0051b4;color:#fff!important}.content[_ngcontent-%COMP%]{margin-top:1%}.toolBar[_ngcontent-%COMP%]{font-size:x-large;font-weight:700;line-height:50px}.common-buttons[_ngcontent-%COMP%]{height:50%}.topPadding[_ngcontent-%COMP%]{padding-top:20px}.tileHeading[_ngcontent-%COMP%]{font-weight:700}.myInput[_ngcontent-%COMP%]{height:50px!important;padding:10px!important}.energyCost[_ngcontent-%COMP%]{font-size:x-large;vertical-align:middle;margin:0;padding:25px 0 10px;font-weight:700}.mat-button-toggle-group-checked[_ngcontent-%COMP%]   .group1[_ngcontent-%COMP%]{background-color:#1fd286;color:#fff!important}.mat-raised-button[_ngcontent-%COMP%]{color:#000}.mat-raised-button-checked[_ngcontent-%COMP%]{background-color:#1fd286!important;color:#fff!important}"]}),t})()}];let E=(()=>{class t{}return t.\u0275mod=u.Lb({type:t}),t.\u0275inj=u.Kb({factory:function(e){return new(e||t)},imports:[[s.j.forChild(L)],s.j]}),t})();var w=o("NFeN"),O=o("/t3+"),F=o("VE2z"),P=o("KthW"),D=o("WCGO"),I=o("QMK6"),W=o("q8Jb"),V=o("0jmt"),B=o("0IaG"),Y=o("Qu3c"),z=o("STbY"),N=o("jJIU");let A=(()=>{class t{}return t.\u0275mod=u.Lb({type:t}),t.\u0275inj=u.Kb({factory:function(e){return new(e||t)},providers:[r.f,r.g],imports:[[r.c,E,n.l,P.a,D.a,n.w,I.a,F.a,V.a,W.a,f.f,C.c,m.c,w.b,z.c,O.b,Y.b,B.g,N.a]]}),t})()}}]);