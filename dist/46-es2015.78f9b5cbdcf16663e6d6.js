(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{"9xt4":function(t,e,i){"use strict";i.d(e,"a",(function(){return f}));var a=i("ofXK"),s=i("3Pt+"),n=i("KthW"),r=i("WCGO"),o=i("0jmt"),l=i("+0xr"),c=i("zWnM"),d=i("zeEN"),u=i("fXoL");let f=(()=>{class t{}return t.\u0275mod=u.Lb({type:t}),t.\u0275inj=u.Kb({factory:function(e){return new(e||t)},imports:[[a.c,s.l,n.a,r.a,o.a,l.l,c.a,d.a]]}),t})()},"a+RD":function(t,e,i){"use strict";i.d(e,"a",(function(){return T}));var a=i("fXoL"),s=i("xgIS"),n=i("/uUt"),r=i("Kj3r"),o=i("ofXK"),l=i("STbY"),c=i("XiUz"),d=i("NFeN"),u=i("bTqV"),f=i("bSwM"),b=i("3Pt+");const p=["filter"];function h(t,e){if(1&t&&(a.Tb(0,"button",12),a.Tb(1,"mat-icon"),a.Rc(2,"filter_list"),a.Sb(),a.Sb()),2&t){a.fc(2);const t=a.Ac(3);a.mc("matMenuTriggerFor",t)}}function m(t,e){if(1&t&&(a.Tb(0,"div",5),a.Tb(1,"div",6),a.Rc(2),a.Sb(),a.Tb(3,"div",7),a.Tb(4,"mat-icon",8),a.Rc(5,"search"),a.Sb(),a.Ob(6,"input",9,10),a.Sb(),a.Pc(8,h,3,1,"button",11),a.kc(9,1),a.Sb()),2&t){const t=a.fc();a.Cb(2),a.Sc(t.name),a.Cb(6),a.mc("ngIf",!t.hideFilter)}}function g(t,e){if(1&t){const t=a.Ub();a.Tb(0,"button",13),a.bc("click",(function(i){a.Ec(t);const s=e.$implicit;return a.fc().toggleColumnVisibility(s,i)})),a.Tb(1,"mat-checkbox",14,15),a.bc("ngModelChange",(function(i){return a.Ec(t),e.$implicit.visible=i}))("click",(function(e){return a.Ec(t),e.stopPropagation()})),a.Rc(3),a.Sb(),a.Sb()}if(2&t){const t=e.$implicit;a.Cb(1),a.mc("ngModel",t.visible),a.Cb(2),a.Tc(" ",t.name," ")}}const S=["*",[["",8,"actions"]]],y=["*",".actions"];let T=(()=>{class t{constructor(){this.filterChange=new a.o}ngAfterViewInit(){this.hideHeader||Object(s.a)(this.filter.nativeElement,"keyup").pipe(Object(n.a)(),Object(r.a)(150)).subscribe(()=>{this.filterChange.emit(this.filter.nativeElement.value)})}toggleColumnVisibility(t,e){e.stopPropagation(),e.stopImmediatePropagation(),t.visible=!t.visible}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=a.Hb({type:t,selectors:[["fury-list"]],viewQuery:function(t,e){var i;1&t&&a.Vc(p,!0),2&t&&a.zc(i=a.cc())&&(e.filter=i.first)},inputs:{name:"name",columns:"columns",hideHeader:"hideHeader",hideFilter:"hideFilter"},outputs:{filterChange:"filterChange"},ngContentSelectors:y,decls:6,vars:2,consts:[[1,"fury-list-table"],["class","fury-list-header","fxLayout","row","fxLayoutAlign","start center","fxLayoutGap","8px","fxLayoutGap.gt-xs","24px",4,"ngIf"],["yPosition","below","xPosition","before"],["columnFilter","matMenu"],["class","checkbox-item mat-menu-item",3,"click",4,"ngFor","ngForOf"],["fxLayout","row","fxLayoutAlign","start center","fxLayoutGap","8px","fxLayoutGap.gt-xs","24px",1,"fury-list-header"],[1,"fury-list-name"],["fxLayout","row","fxLayoutAlign","start center","fxFlex",""],[1,"fury-filter-input-icon"],["fxFlex","","placeholder","Search\u2026",1,"fury-filter-input"],["filter",""],["class","fury-column-filter","type","button","mat-icon-button","",3,"matMenuTriggerFor",4,"ngIf"],["type","button","mat-icon-button","",1,"fury-column-filter",3,"matMenuTriggerFor"],[1,"checkbox-item","mat-menu-item",3,"click"],[1,"checkbox",3,"ngModel","ngModelChange","click"],["checkbox",""]],template:function(t,e){1&t&&(a.lc(S),a.Tb(0,"div",0),a.Pc(1,m,10,2,"div",1),a.Tb(2,"mat-menu",2,3),a.Pc(4,g,4,2,"button",4),a.Sb(),a.kc(5),a.Sb()),2&t&&(a.Cb(1),a.mc("ngIf",!e.hideHeader),a.Cb(3),a.mc("ngForOf",e.columns))},directives:[o.o,l.e,o.n,c.d,c.c,c.e,c.b,d.a,u.a,l.d,f.a,b.q,b.t],styles:[".fury-list-table{display:flex;flex-direction:column}.fury-list-table .fury-list-header{padding-left:24px;padding-right:24px;height:64px;border-top-left-radius:8px;border-top-right-radius:8px}@media screen and (max-width:599px){.fury-list-table .fury-list-header{height:auto;padding-top:24px;padding-bottom:24px}}.fury-list-table .fury-list-header .fury-list-name{font-size:20px;line-height:32px;font-weight:500;padding-right:24px}@media screen and (max-width:599px){.fury-list-table .fury-list-header .fury-list-name{border-right:none}}.fury-list-table .fury-list-header .fury-filter-input{font-size:16px;line-height:1.125;border:none;height:32px}.fury-list-table .fury-list-header .fury-filter-input:focus{outline:none}.fury-list-table .fury-list-header .fury-filter-input-icon{width:1.2em;vertical-align:bottom;height:22px;font-size:22px;margin-right:8px}.fury-list-table table{width:100%}.fury-list-table .mat-header-row .mat-header-cell .mat-sort-header-button{text-transform:uppercase}.fury-list-table .mat-cell.image-cell,.fury-list-table .mat-header-cell.image-cell{flex:0;width:59px}.fury-list-table .mat-cell.image-cell img,.fury-list-table .mat-header-cell.image-cell img{border-radius:50%;height:35px;width:35px;margin-right:24px;vertical-align:middle}.fury-list-table .mat-cell,.fury-list-table .mat-header-cell{white-space:nowrap;padding-left:12px;padding-right:12px}.fury-list-table .mat-cell.actions-cell,.fury-list-table .mat-header-cell.actions-cell{flex:0;width:40px;overflow:visible}.fury-list-table .paginator{display:block}"],encapsulation:2}),t})()},zWnM:function(t,e,i){"use strict";i.d(e,"a",(function(){return s}));var a=i("fXoL");let s=(()=>{class t{}return t.\u0275mod=a.Lb({type:t}),t.\u0275inj=a.Kb({factory:function(e){return new(e||t)},imports:[[]]}),t})()},zeEN:function(t,e,i){"use strict";i.d(e,"a",(function(){return s}));var a=i("fXoL");let s=(()=>{class t{}return t.\u0275mod=a.Lb({type:t}),t.\u0275inj=a.Kb({factory:function(e){return new(e||t)},imports:[[]]}),t})()},zxEL:function(t,e,i){"use strict";i.r(e),i.d(e,"TariffSettingsModule",(function(){return St}));var a=i("ofXK"),s=i("3Pt+"),n=i("VCcF"),r=i("WCGO"),o=i("KthW"),l=i("9xt4"),c=i("tyNb"),d=i("nStZ"),u=i("Ku73"),f=i("KGtp"),b=i("zSPf"),p=i("fXoL"),h=i("dNgK"),m=i("XiUz"),g=i("kmnG"),S=i("qFsG"),y=i("d3UM"),T=i("FKr1");const C=["allSelected"];function x(t,e){if(1&t&&(p.Tb(0,"mat-option",10),p.Rc(1),p.Sb()),2&t){const t=e.$implicit;p.mc("value",t.value),p.Cb(1),p.Tc(" ",t.label," ")}}function v(t,e){1&t&&(p.Tb(0,"mat-error"),p.Rc(1,"Utility type is required."),p.Sb())}function M(t,e){if(1&t){const t=p.Ub();p.Tb(0,"mat-option",11),p.bc("click",(function(){p.Ec(t);const e=p.fc(),i=p.Ac(20);return e.tosslePerOne(i.viewValue)})),p.Rc(1),p.Sb()}if(2&t){const t=e.$implicit;p.mc("optionSelected",t.selected)("value",t.id),p.Cb(1),p.Tc(" ",t.clientName," ")}}let k=(()=>{class t{constructor(t,e,i){this.fb=t,this.cd=e,this.snackbar=i,this.listParameters=[{label:"Select",value:0}],this.listUtilityTypes=[{label:"Select",value:0}],this.listClients=[],this.utilityType="",this.parameter="",this.tariffName="",this.wefDate="",this.selectedClients=[],this.tariffMaster={},this.season_tariff=t.group({tariff_name:["",s.y.required],utility_type:[null,s.y.required],client_select:[null,s.y.required]})}get utilityTypes(){return this.listUtilityTypes}set utilityTypes(t){t&&t.length?(this.listUtilityTypes=t,this.tariffMaster&&(this.utilityType=this.tariffMaster.parameter,this.utilityTypeId=this.tariffMaster.utilityTypeId,this.season_tariff.controls.utility_type.setValue(this.utilityTypeId))):this.listUtilityTypes=[{label:"Select",value:0}]}get parameters(){return this.listParameters}set parameters(t){this.listParameters=t&&t.length?t:[{label:"Select",value:0}]}get clients(){return this.listClients}set clients(t){if(t&&t.length&&(this.listClients=t,this.tariffMaster&&this.tariffMaster.tariffClients&&this.tariffMaster.tariffClients.length)){for(let t=0;t<this.tariffMaster.tariffClients.length;t++)this.tariffMaster.tariffClients[t].clientId&&this.tariffMaster.tariffClients[t].clientId>0&&(this.selectedClients[t]=this.tariffMaster.tariffClients[t].clientId);this.season_tariff.controls.client_select.patchValue([...this.tariffMaster.tariffClients.filter(t=>t.clientId>0).map(t=>t.clientId)])}}set data(t){t&&(this.tariffMaster=t)}ngOnInit(){this.tariffMaster&&(this.tariffName=this.tariffMaster.tariffName)}onChangeUtilityType(t){this.utilityTypeId=t,this.utilityType=this.utilityTypes.find(t=>t.value===this.utilityTypeId).label}onChangeParameter(t){this.parameterId=t,this.parameter=this.parameters.find(t=>t.value===this.parameterId).label}tosslePerOne(t){if(this.allSelected.selected)return this.allSelected.deselect(),!1;this.season_tariff.controls.client_select.value.length==this.clients.length&&this.allSelected.select()}toggleAllSelection(){this.season_tariff.controls.client_select.patchValue(this.allSelected.selected?[...this.clients.map(t=>t.id),0]:[])}}return t.\u0275fac=function(e){return new(e||t)(p.Nb(s.f),p.Nb(p.h),p.Nb(h.b))},t.\u0275cmp=p.Hb({type:t,selectors:[["app-create-seasonal-tariff-settings"]],viewQuery:function(t,e){var i;1&t&&p.Vc(C,!0),2&t&&p.zc(i=p.cc())&&(e.allSelected=i.first)},inputs:{utilityTypes:"utilityTypes",parameters:"parameters",clients:"clients",data:"data"},decls:23,vars:8,consts:[["fxLayout","column","fxLayoutGap","8px",1,"content",3,"formGroup"],["fxFlex","auto"],["formControlName","tariff_name","matInput","","required","",3,"ngModel","ngModelChange"],["formControlName","utility_type","required","",3,"value","selectionChange","valueChange"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["multiple","","formControlName","client_select",3,"ngModel","ngModelChange"],[3,"value","click"],["allSelected",""],[3,"optionSelected","value","click",4,"ngFor","ngForOf"],[3,"value"],[3,"optionSelected","value","click"]],template:function(t,e){1&t&&(p.Tb(0,"div",0),p.Tb(1,"mat-form-field",1),p.Tb(2,"mat-label"),p.Rc(3,"Tariff Name"),p.Sb(),p.Tb(4,"input",2),p.bc("ngModelChange",(function(t){return e.tariffName=t})),p.Sb(),p.Tb(5,"mat-hint"),p.Rc(6,"This will be unique tariff name."),p.Sb(),p.Sb(),p.Tb(7,"mat-form-field",1),p.Tb(8,"mat-label"),p.Rc(9,"Utility Type"),p.Sb(),p.Tb(10,"mat-select",3),p.bc("selectionChange",(function(t){return e.onChangeUtilityType(t.value)}))("valueChange",(function(t){return e.utilityTypeId=t})),p.Pc(11,x,2,2,"mat-option",4),p.Sb(),p.Tb(12,"mat-hint"),p.Rc(13,"This will be utility type."),p.Sb(),p.Pc(14,v,2,0,"mat-error",5),p.Sb(),p.Tb(15,"mat-form-field",1),p.Tb(16,"mat-label"),p.Rc(17,"Clients"),p.Sb(),p.Tb(18,"mat-select",6),p.bc("ngModelChange",(function(t){return e.selectedClients=t})),p.Tb(19,"mat-option",7,8),p.bc("click",(function(){return e.toggleAllSelection()})),p.Rc(21,"Select All"),p.Sb(),p.Pc(22,M,2,3,"mat-option",9),p.Sb(),p.Sb(),p.Sb()),2&t&&(p.mc("formGroup",e.season_tariff),p.Cb(4),p.mc("ngModel",e.tariffName),p.Cb(6),p.mc("value",e.utilityTypeId),p.Cb(1),p.mc("ngForOf",e.listUtilityTypes),p.Cb(3),p.mc("ngIf",e.season_tariff.invalid),p.Cb(4),p.mc("ngModel",e.selectedClients),p.Cb(1),p.mc("value",0),p.Cb(3),p.mc("ngForOf",e.clients))},directives:[m.d,m.e,s.r,s.k,g.d,m.b,g.h,s.c,S.b,s.q,s.i,s.x,g.g,y.a,a.n,a.o,T.n,g.c],styles:[""],data:{animation:[d.a,u.a,f.a]}}),t})();var w=i("+WJP"),I=i("wd/R"),P=i("0IaG"),_=i("sXtk"),N=i("tk/3");let R=(()=>{class t{constructor(t,e){this.http=t,this.envService=e,this.baseUrl="",this.baseUrl=e.backend}saveTariffMaster(t){return this.http.post(this.baseUrl+"/tariffs",t)}getTariffMasters(){return this.http.get(this.baseUrl+"/tariffs")}updateTariffMaster(t){return this.http.put(this.baseUrl+"/tariffs/"+t.id,t)}saveTariffSettings(t){return this.http.post(this.baseUrl+"/tariffs/settings",t)}getTariffSettings(){return this.http.get(this.baseUrl+"/tariffs/settings")}deleteTariffSettings(t){return this.http.post(this.baseUrl+"/tariffs/delete/settings",t)}deleteTariffMaster(t){return this.http.delete(this.baseUrl+"/tariffs/"+t.id)}}return t.\u0275fac=function(e){return new(e||t)(p.Xb(N.c),p.Xb(_.a))},t.\u0275prov=p.Jb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var O=i("/t3+"),D=i("bTqV"),H=i("NFeN"),F=i("MutI"),L=i("4FRi");const E=["allSelected"];function A(t,e){if(1&t){const t=p.Ub();p.Tb(0,"mat-option",19),p.bc("click",(function(){p.Ec(t);const e=p.fc(),i=p.Ac(25);return e.tosslePerOne(i.viewValue)})),p.Rc(1),p.Sb()}if(2&t){const t=e.$implicit;p.mc("optionSelected",t.selected)("value",t.id),p.Cb(1),p.Tc(" ",t.description," ")}}let G=(()=>{class t{constructor(t,e,i,a,s){this.fb=t,this.tariffItem=e,this.dialogRef=i,this.tariffMasterService=a,this.snackbar=s,this.type="",this.subItems=[],this.selectedSubItems=[],this.dataSource=[],this.columns=[],this.tariffSettings=null,this.typeNameColumnName="Type Name",this.subItemColumnName="Sub Item",this.buttonName="CREATE ITEM",e&&(this.type=e.type,this.subItems=e.subItems,this.dataSource=e.tariffSettings)}ngOnInit(){this.createGridColumns(),this.tariff_items_create=this.fb.group({itemName:["",s.y.required],subItem_select:[null,s.y.required]})}createGridColumns(){this.columns=[{name:this.typeNameColumnName,property:"typeName",visible:!0,isModelProperty:!0},{name:this.subItemColumnName,property:"subItemNames",visible:!0,isModelProperty:!0},{name:"Actions",property:"actions",visible:!0,isModelProperty:!1}]}close(){this.dialogRef.close()}closeDialog(){}save(){var t;const e=this.tariff_items_create.controls.itemName.value;if(this.tariffSettings&&e!==this.tariffSettings.typeName){if(this.dataSource.findIndex(t=>t.typeName===e)>-1)return void this.notificationMessage(this.type+" name already exist","red-snackbar")}else if(!this.tariffSettings&&this.dataSource.findIndex(t=>t.typeName===e)>-1)return void this.notificationMessage(this.type+" name already exist","red-snackbar");let i=0;this.dataSource&&this.dataSource.length&&(i=null!==(t=Math.max.apply(Math,this.dataSource.map((function(t){return t.typeId}))))&&void 0!==t?t:0);let a=this.tariff_items_create.controls.subItem_select.value,s=[];const n="Season"===this.type?1:2;let r="";if(a&&a.length){if(a.filter(t=>0!=t).forEach(t=>{this.tariffSettings?this.tariffItem.tariffSettings.filter(t=>t.typeId!==this.tariffSettings.typeId).forEach(e=>{const i=e.subItems.find(e=>e.id===t);i&&(r+=i.description+",")}):this.dataSource.forEach(e=>{const i=e.subItems.find(e=>e.id===t);i&&(r+=i.description+",")})}),r&&r.length)return void this.notificationMessage(`Already ${r.slice(0,-1)} assigned to another ${this.type}`,"red-snackbar");a.filter(t=>0!=t).forEach(t=>{s.push({id:t})})}let o={};o=this.tariffSettings?{typeName:e,typeId:this.tariffSettings.typeId,type:this.tariffSettings.type,subItems:s}:{typeName:e,typeId:i+1,type:n,subItems:s},this.dialogRef.close(o)}onDeleteRow(t){t&&this.deleteTariffSettings(t)}onUpdateRow(t){if(this.tariffSettings={},t){if(this.tariff_items_create.controls.itemName.setValue(t.typeName),t.subItems&&t.subItems.length){for(let e=0;e<t.subItems.length;e++)this.selectedSubItems[e]=t.subItems[e].id;this.tariff_items_create.controls.subItem_select.patchValue([...t.subItems.map(t=>t.id)])}this.tariffSettings=t,this.buttonName="UPDATE ITEM"}}tosslePerOne(t){if(this.allSelected.selected)return this.allSelected.deselect(),!1;this.tariff_items_create.controls.subItem_select.value.length==this.subItems.length&&this.allSelected.select()}toggleAllSelection(){this.tariff_items_create.controls.subItem_select.patchValue(this.allSelected.selected?[...this.subItems.map(t=>t.id),0]:[])}deleteTariffSettings(t){this.tariffMasterService.deleteTariffSettings(t).subscribe({next:e=>{if(e){if(this.tariffItem.tariffSettings&&this.tariffItem.tariffSettings.length){const e=this.tariffItem.tariffSettings.findIndex(e=>e.typeName===t.typeName&&e.typeId===t.typeId&&e.type===t.type);e>-1&&(this.dataSource=[],this.tariffItem.tariffSettings.splice(e,1),this.dataSource=this.tariffItem.tariffSettings,this.tableStructureComponent.tableData=this.dataSource)}else this.dataSource=[],this.dataSource=this.tariffItem.tariffSettings,this.tableStructureComponent.tableData=this.dataSource;this.notificationMessage("Tariff settings deleted successfully","green-snackbar")}else this.notificationMessage("Tariff settings delete failed","red-snackbar")},error:t=>{this.notificationMessage("Tariff settings delete failed","red-snackbar")}})}notificationMessage(t,e){this.snackbar.open(t,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[e]})}}return t.\u0275fac=function(e){return new(e||t)(p.Nb(s.f),p.Nb(P.a),p.Nb(P.h),p.Nb(R),p.Nb(h.b))},t.\u0275cmp=p.Hb({type:t,selectors:[["fury-add-tariff-items"]],viewQuery:function(t,e){var i;1&t&&(p.Vc(E,!0),p.Jc(w.a,!0)),2&t&&(p.zc(i=p.cc())&&(e.allSelected=i.first),p.zc(i=p.cc())&&(e.tableStructureComponent=i.first))},decls:36,vars:12,consts:[["mat-dialog-title",""],["role","toolbar",1,"task-header"],[1,"fx-spacer"],["mat-icon-button","",3,"click"],["title","Close","mat-list-icon",""],[3,"formGroup","ngSubmit"],[1,"padding-top"],[1,"person"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","48px"],["fxFlex",""],["formControlName","itemName","matInput","","required",""],["multiple","","formControlName","subItem_select",3,"ngModel","ngModelChange"],[3,"value","click"],["allSelected",""],[3,"optionSelected","value","click",4,"ngFor","ngForOf"],[2,"width","100%",3,"visibleUpdateButton","visibleDeleteButton","tableData","columns","updateRow","deleteRow"],["fxLayout","row","fxLayoutAlign","end center"],["mat-button","",3,"click"],["mat-button",""],[3,"optionSelected","value","click"]],template:function(t,e){1&t&&(p.Tb(0,"div",0),p.Tb(1,"mat-toolbar",1),p.Tb(2,"span"),p.Rc(3),p.Sb(),p.Ob(4,"span",2),p.Tb(5,"button",3),p.bc("click",(function(){return e.close()})),p.Tb(6,"mat-icon",4),p.Rc(7,"close"),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Tb(8,"form",5),p.bc("ngSubmit",(function(){return e.save()})),p.Tb(9,"mat-dialog-content"),p.Tb(10,"fury-card"),p.Tb(11,"fury-card-content",6),p.Tb(12,"div",7),p.Tb(13,"div",8),p.Tb(14,"mat-form-field",9),p.Tb(15,"mat-label"),p.Rc(16),p.Sb(),p.Ob(17,"input",10),p.Tb(18,"mat-hint"),p.Rc(19),p.Sb(),p.Sb(),p.Tb(20,"mat-form-field",9),p.Tb(21,"mat-label"),p.Rc(22,"Sub Items"),p.Sb(),p.Tb(23,"mat-select",11),p.bc("ngModelChange",(function(t){return e.selectedSubItems=t})),p.Tb(24,"mat-option",12,13),p.bc("click",(function(){return e.toggleAllSelection()})),p.Rc(26,"Select All "),p.Sb(),p.Pc(27,A,2,3,"mat-option",14),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Tb(28,"div",7),p.Tb(29,"div",8),p.Tb(30,"app-table-structure",15),p.bc("updateRow",(function(t){return e.onUpdateRow(t)}))("deleteRow",(function(t){return e.onDeleteRow(t)})),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Tb(31,"mat-dialog-actions",16),p.Tb(32,"button",17),p.bc("click",(function(){return e.closeDialog()})),p.Rc(33,"CANCEL"),p.Sb(),p.Tb(34,"button",18),p.Rc(35),p.Sb(),p.Sb(),p.Sb()),2&t&&(p.Cb(3),p.Tc("Add ",e.type,""),p.Cb(5),p.mc("formGroup",e.tariff_items_create),p.Cb(8),p.Tc("",e.type," Name"),p.Cb(3),p.Tc("This will be ",e.type," name."),p.Cb(4),p.mc("ngModel",e.selectedSubItems),p.Cb(1),p.mc("value",0),p.Cb(3),p.mc("ngForOf",e.subItems),p.Cb(3),p.mc("visibleUpdateButton",!0)("visibleDeleteButton",!0)("tableData",e.dataSource)("columns",e.columns),p.Cb(5),p.Sc(e.buttonName))},directives:[P.i,O.a,D.a,H.a,F.c,s.z,s.r,s.k,P.f,L.a,L.c,m.d,m.e,g.d,m.b,g.h,s.c,S.b,s.q,s.i,s.x,g.g,y.a,T.n,a.n,w.a,P.c,m.c],styles:[".task-header[_ngcontent-%COMP%]{background-color:transparent;padding:0 5px;height:20px}.fx-spacer[_ngcontent-%COMP%]{flex:1 1 auto}"]}),t})();var U=i("xXXn");function z(t,e){if(1&t&&(p.Tb(0,"mat-option",18),p.Rc(1),p.Sb()),2&t){const t=e.$implicit;p.mc("value",t.value),p.Cb(1),p.Tc(" ",t.label," ")}}function q(t,e){1&t&&(p.Tb(0,"mat-error"),p.Rc(1,"Season is required."),p.Sb())}function V(t,e){if(1&t&&(p.Tb(0,"mat-option",18),p.Rc(1),p.Sb()),2&t){const t=e.$implicit;p.mc("value",t.value),p.Cb(1),p.Tc(" ",t.label," ")}}function $(t,e){1&t&&(p.Tb(0,"mat-error"),p.Rc(1,"Week type is required."),p.Sb())}function j(t,e){if(1&t&&(p.Tb(0,"mat-option",18),p.Rc(1),p.Sb()),2&t){const t=e.$implicit;p.mc("value",t.value),p.Cb(1),p.Tc(" ",t.label," ")}}function B(t,e){1&t&&(p.Tb(0,"mat-error"),p.Rc(1,"Type is required."),p.Sb())}let W=(()=>{class t{constructor(t,e,i){this.fb=t,this.snackbar=e,this.dialog=i,this._gap=16,this.gap=this._gap+"px",this.col2=`1 1 calc(50% - ${this._gap/2}px)`,this.col3=`1 1 calc(33.3333% - ${this._gap/1.5}px)`,this.col4=`1 1 calc(5% - ${this._gap/1}px)`,this.dataSource=[],this.deletedDataSource=[],this.sortDataSource=[],this.columns=[],this.tariffMaster={},this.months=[],this.peakTypes=[],this.days=[],this.seasons=[],this.weekTypes=[],this.tariffSettings=[],this.isDisable=new p.o,this.tariffSettingsChanged=new p.o,this.season="",this.peakType="",this.weekType="",this.fromHour="00:00:00",this.toHour="23:59:59",this.rowNumberColumnName="#",this.seasonColumnName="Season",this.weekTypeColumnName="Week Type",this.peakTypeColumnName="Peak Type",this.fromHourColumnName="From",this.toHourColumnName="To",this.rateColumnName="Rate",this.isContentChange=!1,this.peak_settings=t.group({season:[null,s.y.required],peakType:[null,s.y.required],weekType:[null,s.y.required],fromHour:["",s.y.required],toHour:["",s.y.required],rate:[null,s.y.required]})}set data(t){if(t&&(this.tariffMaster=t,t.seasonPeakSettings&&t.seasonPeakSettings.length)){for(let e=0;e<t.seasonPeakSettings.length;e++)this.tariffMaster.seasonPeakSettings[e].rowNumber=e+1;this.dataSource=this.sortDataSource=t.seasonPeakSettings}}ngOnInit(){this.createGridColumns()}createGridColumns(){this.columns=[{name:this.rowNumberColumnName,property:"rowNumber",visible:!0,isModelProperty:!0},{name:this.seasonColumnName,property:"season",visible:!0,isModelProperty:!0},{name:this.weekTypeColumnName,property:"weekType",visible:!0,isModelProperty:!0},{name:this.peakTypeColumnName,property:"peakType",visible:!0,isModelProperty:!0},{name:this.fromHourColumnName,property:"hourStart",visible:!0,isModelProperty:!0},{name:this.toHourColumnName,property:"hourEnd",visible:!0,isModelProperty:!0},{name:this.rateColumnName,property:"rate",visible:!0,isModelProperty:!0},{name:"Actions",property:"actions",visible:!0,isModelProperty:!1}]}addNewItem(){this.peak_settings.valid?(this.addItemToDataSource(),this.peak_settings.reset(),this.fromHour="00:00:00",this.toHour="23:59:59",this.peak_settings.controls.fromHour.setValue(this.fromHour),this.peak_settings.controls.toHour.setValue(this.toHour),this.isDisable.emit(!1)):this.validateAllFormFields(this.peak_settings)}addItemToDataSource(){let t=I(),e=I();if(!(this.seasons&&this.seasons.length&&this.weekTypes&&this.weekTypes.length))return void this.notificationMessage("Months Or Days not configured","red-snackbar");if(this.sortDataSource.findIndex(t=>t.seasonId===this.seasonId&&t.weekTypeId===this.weekTypeId&&t.hourEnd===this.toHour)>-1)return void this.notificationMessage("Time already exist","red-snackbar");if(this.sortDataSource.sort((t,e)=>e.hourEnd.localeCompare(t.hourEnd)).find(t=>t.monthId===this.seasonId&&t.dayId===this.weekTypeId)){if(t=I(this.fromHour,"HH:mm:ss"),e=I(this.toHour,"HH:mm:ss"),this.strfromHour=""+t.format("HH:mm:ss"),this.strToHour=""+e.format("HH:mm:ss"),t>e)return void this.notificationMessage("To-hour should be greater than From-hour","red-snackbar")}else t=I(this.fromHour,"HH:mm:ss"),e=I(this.toHour,"HH:mm:ss"),this.strfromHour=""+t.format("HH:mm:ss"),this.strToHour=""+e.format("HH:mm:ss");const i={season:this.season,seasonId:this.seasonId,weekType:this.weekType,weekTypeId:this.weekTypeId,peakType:this.peakType,peakTypeId:this.peakTypeId,hourStart:""+this.strfromHour,hourEnd:""+this.strToHour,rate:Number(this.rate),rowNumber:this.dataSource&&this.dataSource.length?this.dataSource.length+1:1};i&&(this.isContentChange=!0,this.dataSource.push(i)),this.tableStructureComponent.tableData=this.sortDataSource=this.dataSource,"23:59:59"!==this.strToHour&&(this.fromHour=this.strToHour.slice(0,-1)+"1",this.toHour="23:59:59")}notificationMessage(t,e){this.snackbar.open(t,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[e]})}onChangeWeekTypes(t){if(this.weekTypeId=t,this.weekType=this.weekTypes.find(t=>t.value===this.weekTypeId).label,this.seasonId&&this.weekTypeId){const t=this.sortDataSource.sort((t,e)=>e.hourEnd.localeCompare(t.hourEnd)).find(t=>t.monthId===this.seasonId&&t.dayId===this.weekTypeId);t?(this.fromHour=t.hourStart,this.toHour="23:59:59"):(this.fromHour="00:00:00",this.toHour="23:59:59")}}onChangeType(t){if(this.peakTypeId=t,this.peakType=this.peakTypes.find(t=>t.value===this.peakTypeId).label,this.seasonId&&this.weekTypeId){const t=this.sortDataSource.sort((t,e)=>e.hourEnd.localeCompare(t.hourEnd)).find(t=>t.monthId===this.seasonId&&t.dayId===this.weekTypeId);t?(this.fromHour=t.hourStart,this.toHour="23:59:59"):(this.fromHour="00:00:00",this.toHour="23:59:59")}}onChangeSeasons(t){if(this.seasonId=t,this.season=this.seasons.find(t=>t.value===this.seasonId).label,this.seasonId&&this.weekTypeId){const t=this.sortDataSource.sort((t,e)=>e.hourEnd.localeCompare(t.hourEnd)).find(t=>t.monthId===this.seasonId&&t.dayId===this.weekTypeId);t?(this.fromHour=t.hourStart,this.toHour="23:59:59"):(this.fromHour="00:00:00",this.toHour="23:59:59")}}validateAllFormFields(t){Object.keys(t.controls).forEach(e=>{const i=t.get(e);i instanceof s.g?i.markAsTouched({onlySelf:!0}):i instanceof s.j&&this.validateAllFormFields(i)})}onDeleteRow(t){this.dialog.open(U.a,{data:{label:"Are you sure you want to Delete?",selected:!1}}).afterClosed().subscribe(e=>{if(e){const e=this.dataSource.findIndex(e=>e.seasonId==t.seasonId&&e.peakTypeId===t.peakTypeId&&e.weekTypeId===t.weekTypeId);e>-1&&(this.deletedDataSource.push(this.dataSource[e]),this.dataSource.splice(e,1)),this.tableStructureComponent.tableData=this.dataSource,this.isDisable.emit(!(this.dataSource&&this.dataSource.length>0))}})}addItem(t){let e=[];e=this.tariffSettings.filter("Season"===t?t=>1==t.type:t=>2==t.type),this.dialog.open(G,{data:{type:t,subItems:"Season"==t?this.months:this.days,tariffSettings:e}}).afterClosed().subscribe(t=>{t&&this.tariffSettingsChanged.emit(t)})}}return t.\u0275fac=function(e){return new(e||t)(p.Nb(s.f),p.Nb(h.b),p.Nb(P.b))},t.\u0275cmp=p.Hb({type:t,selectors:[["app-create-peak-settings"]],viewQuery:function(t,e){var i;1&t&&p.Jc(w.a,!0),2&t&&p.zc(i=p.cc())&&(e.tableStructureComponent=i.first)},inputs:{months:"months",peakTypes:"peakTypes",days:"days",seasons:"seasons",weekTypes:"weekTypes",tariffSettings:"tariffSettings",data:"data"},outputs:{isDisable:"isDisable",tariffSettingsChanged:"tariffSettingsChanged"},decls:63,vars:17,consts:[["fxLayout","row","fxLayoutGap","8px",1,"actions"],["fxFlex","noshrink","fxLayout","column","fxLayout.gt-sm","column","fxLayoutAlign.gt-sm","start stretch",3,"fxLayoutGap"],[3,"formGroup"],[1,"person"],["fxLayout","row","fxLayoutGap","8px",1,"content"],["fxFlex","auto"],["formControlName","season","required","",3,"value","selectionChange","valueChange"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["type","button","mat-mini-fab","","color","primary",1,"create",3,"click"],["formControlName","weekType","required","",3,"value","selectionChange","valueChange"],["formControlName","peakType","required","",3,"value","selectionChange","valueChange"],["formControlName","fromHour","type","time","step","2","format","hh:mm:ss","matInput","","required","",3,"ngModel","ngModelChange"],["formControlName","toHour","type","time","step","2","format","hh:mm:ss","matInput","","required","",3,"ngModel","ngModelChange"],["formControlName","rate","matInput","","required","",3,"ngModel","ngModelChange"],[2,"text-align","right"],["fxLayout","row",1,"result",2,"padding-top","10px"],[2,"width","100%",3,"visibleDeleteButton","tableData","columns","deleteRow"],[3,"value"]],template:function(t,e){1&t&&(p.Tb(0,"div",0),p.Tb(1,"div",1),p.Tb(2,"form",2),p.Tb(3,"div",3),p.Tb(4,"div",4),p.Tb(5,"mat-form-field",5),p.Tb(6,"mat-label"),p.Rc(7,"Seasons"),p.Sb(),p.Tb(8,"mat-select",6),p.bc("selectionChange",(function(t){return e.onChangeSeasons(t.value)}))("valueChange",(function(t){return e.seasonId=t})),p.Pc(9,z,2,2,"mat-option",7),p.Sb(),p.Tb(10,"mat-hint"),p.Rc(11,"This will be season."),p.Sb(),p.Pc(12,q,2,0,"mat-error",8),p.Sb(),p.Tb(13,"div",5),p.Tb(14,"button",9),p.bc("click",(function(){return e.addItem("Season")})),p.Tb(15,"mat-icon"),p.Rc(16,"add"),p.Sb(),p.Sb(),p.Sb(),p.Tb(17,"mat-form-field",5),p.Tb(18,"mat-label"),p.Rc(19,"Week Types"),p.Sb(),p.Tb(20,"mat-select",10),p.bc("selectionChange",(function(t){return e.onChangeWeekTypes(t.value)}))("valueChange",(function(t){return e.weekTypeId=t})),p.Pc(21,V,2,2,"mat-option",7),p.Sb(),p.Tb(22,"mat-hint"),p.Rc(23,"This will be week type."),p.Sb(),p.Pc(24,$,2,0,"mat-error",8),p.Sb(),p.Tb(25,"div",5),p.Tb(26,"button",9),p.bc("click",(function(){return e.addItem("WeekType")})),p.Tb(27,"mat-icon"),p.Rc(28,"add"),p.Sb(),p.Sb(),p.Sb(),p.Tb(29,"mat-form-field",5),p.Tb(30,"mat-label"),p.Rc(31,"Type"),p.Sb(),p.Tb(32,"mat-select",11),p.bc("selectionChange",(function(t){return e.onChangeType(t.value)}))("valueChange",(function(t){return e.peakTypeId=t})),p.Pc(33,j,2,2,"mat-option",7),p.Sb(),p.Tb(34,"mat-hint"),p.Rc(35,"This will be peak type."),p.Sb(),p.Pc(36,B,2,0,"mat-error",8),p.Sb(),p.Sb(),p.Sb(),p.Tb(37,"div",3),p.Tb(38,"div",4),p.Tb(39,"mat-form-field",5),p.Tb(40,"mat-label"),p.Rc(41,"From"),p.Sb(),p.Tb(42,"input",12),p.bc("ngModelChange",(function(t){return e.fromHour=t})),p.Sb(),p.Tb(43,"mat-hint"),p.Rc(44,"This will be from Hour start."),p.Sb(),p.Sb(),p.Tb(45,"mat-form-field",5),p.Tb(46,"mat-label"),p.Rc(47,"To"),p.Sb(),p.Tb(48,"input",13),p.bc("ngModelChange",(function(t){return e.toHour=t})),p.Sb(),p.Tb(49,"mat-hint"),p.Rc(50,"This will be to Hour end."),p.Sb(),p.Sb(),p.Tb(51,"mat-form-field",5),p.Tb(52,"mat-label"),p.Rc(53,"Rate"),p.Sb(),p.Tb(54,"input",14),p.bc("ngModelChange",(function(t){return e.rate=t})),p.Sb(),p.Tb(55,"mat-hint"),p.Rc(56,"This will be rate."),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Tb(57,"div",15),p.Tb(58,"button",9),p.bc("click",(function(){return e.addNewItem()})),p.Tb(59,"mat-icon"),p.Rc(60,"add"),p.Sb(),p.Sb(),p.Sb(),p.Tb(61,"div",16),p.Tb(62,"app-table-structure",17),p.bc("deleteRow",(function(t){return e.onDeleteRow(t)})),p.Sb(),p.Sb(),p.Sb(),p.Sb()),2&t&&(p.Cb(1),p.mc("fxLayoutGap",e.gap),p.Cb(1),p.mc("formGroup",e.peak_settings),p.Cb(6),p.mc("value",e.seasonId),p.Cb(1),p.mc("ngForOf",e.seasons),p.Cb(3),p.mc("ngIf",e.peak_settings.invalid),p.Cb(8),p.mc("value",e.weekTypeId),p.Cb(1),p.mc("ngForOf",e.weekTypes),p.Cb(3),p.mc("ngIf",e.peak_settings.invalid),p.Cb(8),p.mc("value",e.peakTypeId),p.Cb(1),p.mc("ngForOf",e.peakTypes),p.Cb(3),p.mc("ngIf",e.peak_settings.invalid),p.Cb(6),p.mc("ngModel",e.fromHour),p.Cb(6),p.mc("ngModel",e.toHour),p.Cb(6),p.mc("ngModel",e.rate),p.Cb(8),p.mc("visibleDeleteButton",!0)("tableData",e.dataSource)("columns",e.columns))},directives:[m.d,m.e,m.b,m.c,s.z,s.r,s.k,g.d,g.h,y.a,s.q,s.i,s.x,a.n,g.g,a.o,D.a,H.a,s.c,S.b,w.a,T.n,g.c],styles:[".bottomPadding[_ngcontent-%COMP%]{padding-bottom:10px}"],data:{animation:[d.a,u.a,f.a]}}),t})(),X=(()=>{class t{constructor(t,e,i,a){this.fb=t,this.cd=e,this.snackbar=i,this.dialog=a,this._gap=16,this.gap=this._gap+"px",this.col2=`1 1 calc(50% - ${this._gap/2}px)`,this.col3=`1 1 calc(33.3333% - ${this._gap/1.5}px)`,this.col4=`1 1 calc(5% - ${this._gap/1}px)`,this.dataSource=[],this.deletedDataSource=[],this.columns=[],this.tariffMaster={},this.isDisable=new p.o,this.slabs=[],this.slabName="",this.slabNameColumnName="Slab Name",this.minColumnName="Min",this.maxColumnName="Max",this.rateColumnName="Rate",this.isContentChange=!1,this.slab_rate=t.group({slab:["",s.y.required],minimumConsumption:["",s.y.required],maximumConsumption:["",s.y.required],rate:["",s.y.required]})}set data(t){t&&(this.tariffMaster=t,t.tariffConsumptionSettings&&t.tariffConsumptionSettings.length&&(this.dataSource=t.tariffConsumptionSettings))}ngOnInit(){this.createGridColumns()}createGridColumns(){this.columns=[{name:this.slabNameColumnName,property:"slab",visible:!0,isModelProperty:!0},{name:this.minColumnName,property:"consumptionMin",visible:!0,isModelProperty:!0},{name:this.maxColumnName,property:"consumptionMax",visible:!0,isModelProperty:!0},{name:this.rateColumnName,property:"tariffRate",visible:!0,isModelProperty:!0},{name:"Actions",property:"actions",visible:!0,isModelProperty:!1}]}addNewItem(){this.slab_rate.valid?(this.addItemToDataSource(),this.isDisable.emit(!1),this.slab_rate.reset()):this.validateAllFormFields(this.slab_rate)}addItemToDataSource(){if(this.dataSource&&this.dataSource.length&&this.dataSource.findIndex(t=>t.slab===this.slabName&&t.consumptionMin===this.minimumConsumption&&t.consumptionMax===this.maximumConsumption)>-1)return void this.notificationMessage("Slab already exist","red-snackbar");const t={slab:this.slabName,tariffRate:Number(this.rate),consumptionMin:Number(this.minimumConsumption),consumptionMax:Number(this.maximumConsumption)};t&&(this.isContentChange=!0,this.dataSource.push(t),this.tableStructureComponent.tableData=this.dataSource.sort((t,e)=>t.consumptionMin-e.consumptionMin||t.consumptionMax-e.consumptionMax))}validateAllFormFields(t){Object.keys(t.controls).forEach(e=>{const i=t.get(e);i instanceof s.g?i.markAsTouched({onlySelf:!0}):i instanceof s.j&&this.validateAllFormFields(i)})}onDeleteRow(t){this.dialog.open(U.a,{data:{label:"Are you sure you want to Delete?",selected:!1}}).afterClosed().subscribe(e=>{if(e){const e=this.dataSource.findIndex(e=>e.slab==t.slab&&e.consumptionMin===t.consumptionMin&&e.consumptionMax===t.consumptionMax);e>-1&&(this.deletedDataSource.push(this.dataSource[e]),this.dataSource.splice(e,1)),this.tableStructureComponent.tableData=this.dataSource,this.isDisable.emit(!(this.dataSource&&this.dataSource.length>0))}})}notificationMessage(t,e){this.snackbar.open(t,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[e]})}}return t.\u0275fac=function(e){return new(e||t)(p.Nb(s.f),p.Nb(p.h),p.Nb(h.b),p.Nb(P.b))},t.\u0275cmp=p.Hb({type:t,selectors:[["app-create-slab-rate-settings"]],viewQuery:function(t,e){var i;1&t&&p.Jc(w.a,!0),2&t&&p.zc(i=p.cc())&&(e.tableStructureComponent=i.first)},inputs:{slabs:"slabs",data:"data"},outputs:{isDisable:"isDisable"},decls:36,vars:9,consts:[["fxLayout","row","fxLayoutGap","8px",1,"actions"],["fxFlex","noshrink","fxLayout","column","fxLayout.gt-sm","column","fxLayoutAlign.gt-sm","start stretch",3,"fxLayoutGap"],[3,"formGroup"],[1,"person"],["fxLayout","row","fxLayoutGap","8px",1,"content"],["fxFlex","auto"],["formControlName","slab","matInput","","required","",3,"ngModel","ngModelChange"],["type","number","formControlName","minimumConsumption","min","1","matInput","","required","",3,"ngModel","ngModelChange"],["type","number","formControlName","maximumConsumption","matInput","","required","",3,"ngModel","ngModelChange"],[1,"person","padding-top"],["formControlName","rate","matInput","","required","",3,"ngModel","ngModelChange"],["type","button","mat-mini-fab","","color","primary",1,"create",3,"click"],["fxLayout","row",1,"result","padding-top"],[2,"width","100%",3,"visibleDeleteButton","tableData","columns","deleteRow"]],template:function(t,e){1&t&&(p.Tb(0,"div",0),p.Tb(1,"div",1),p.Tb(2,"form",2),p.Tb(3,"div",3),p.Tb(4,"div",4),p.Tb(5,"mat-form-field",5),p.Tb(6,"mat-label"),p.Rc(7,"Slab"),p.Sb(),p.Tb(8,"input",6),p.bc("ngModelChange",(function(t){return e.slabName=t})),p.Sb(),p.Tb(9,"mat-hint"),p.Rc(10,"This will be slab name."),p.Sb(),p.Sb(),p.Tb(11,"mat-form-field",5),p.Tb(12,"mat-label"),p.Rc(13,"Minimum"),p.Sb(),p.Tb(14,"input",7),p.bc("ngModelChange",(function(t){return e.minimumConsumption=t})),p.Sb(),p.Tb(15,"mat-hint"),p.Rc(16,"This will be minimum."),p.Sb(),p.Sb(),p.Tb(17,"mat-form-field",5),p.Tb(18,"mat-label"),p.Rc(19,"Maximum"),p.Sb(),p.Tb(20,"input",8),p.bc("ngModelChange",(function(t){return e.maximumConsumption=t})),p.Sb(),p.Tb(21,"mat-hint"),p.Rc(22,"This will be maximum."),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Tb(23,"div",9),p.Tb(24,"div",4),p.Tb(25,"mat-form-field",5),p.Tb(26,"mat-label"),p.Rc(27,"Rate"),p.Sb(),p.Tb(28,"input",10),p.bc("ngModelChange",(function(t){return e.rate=t})),p.Sb(),p.Tb(29,"mat-hint"),p.Rc(30,"This will be with rate."),p.Sb(),p.Sb(),p.Tb(31,"button",11),p.bc("click",(function(){return e.addNewItem()})),p.Tb(32,"mat-icon"),p.Rc(33,"add"),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Tb(34,"div",12),p.Tb(35,"app-table-structure",13),p.bc("deleteRow",(function(t){return e.onDeleteRow(t)})),p.Sb(),p.Sb(),p.Sb(),p.Sb()),2&t&&(p.Cb(1),p.mc("fxLayoutGap",e.gap),p.Cb(1),p.mc("formGroup",e.slab_rate),p.Cb(6),p.mc("ngModel",e.slabName),p.Cb(6),p.mc("ngModel",e.minimumConsumption),p.Cb(6),p.mc("ngModel",e.maximumConsumption),p.Cb(8),p.mc("ngModel",e.rate),p.Cb(7),p.mc("visibleDeleteButton",!0)("tableData",e.dataSource)("columns",e.columns))},directives:[m.d,m.e,m.b,m.c,s.z,s.r,s.k,g.d,g.h,s.c,S.b,s.q,s.i,s.x,g.g,s.u,D.a,H.a,w.a],styles:[""],data:{animation:[d.a,u.a,f.a]}}),t})();var K=i("5cYQ"),J=i("xHqg");function Q(t,e){1&t&&p.Rc(0,"Tariff Settings")}function Y(t,e){1&t&&p.Rc(0,"Season Settings")}let Z=(()=>{class t{constructor(t,e,i,a,s,n,r){this.snackbar=t,this.masterService=e,this.announcementService=i,this.dialogRef=a,this.defaults=s,this.tariffMasterService=n,this.dialog=r,this._gap=16,this.gap=this._gap+"px",this.col2=`1 1 calc(50% - ${this._gap/2}px)`,this.col3=`1 1 calc(33.3333% - ${this._gap/1.5}px)`,this.utilityTypes=[],this.parameters=[],this.seasons=[],this.weekTypes=[],this.days=[],this.peakTypes=[],this.months=[],this.slabs=[],this.clients=[],this.tariffSettings=[],this.utilityTypeId=0,this.parameterId=0,this.passwordInputType="password",this.tariffName="",this.rate=0,this.peakTypeId=0,this.weekTypeId=0,this.from=0,this.to=0,this.tariffDate=new Date,this.isDisable=!0,this.tariffMaster={},this.peakSettingsHide=!0,this.slabSettingsHide=!0,this.buttonName="CREATE TARIFF",a.disableClose=!0}ngOnInit(){this.defaults&&(this.peakSettingsHide=!1,this.buttonName="UPDATE TARIFF"),this.seasonSettingsFormGroup=this.createSeasonalTariffSettingsComponent.season_tariff,this.peakSettingsFormGroup=this.createPeakSettingsComponent.peak_settings,this.getMonths(),this.getDays(),this.getTariffSettings(),this.getUtilityTypes(),this.getParameters(),this.getClients(),this.getSeasons(),this.getWeekTypes(),this.getPeakTypes(),this.getSlabs()}getClients(){this.clients=[],this.announcementService.getClients().subscribe(t=>{t&&(this.clients=t)})}submit(){this.updateValues()&&this.dialogRef.close(this.tariffMaster)}updateValues(){let t=[];const e=this.createSeasonalTariffSettingsComponent.selectedClients;e&&e.forEach(e=>{t.push({clientId:Number(e)})});let i=0;this.defaults&&(i=this.defaults.id);let a=[];const s=this.createPeakSettingsComponent.dataSource;s&&s.length&&this.seasons&&this.seasons.length&&s.forEach(t=>{const e=this.seasons.find(e=>e.value===t.seasonId);if(e&&e.subListItems&&e.subListItems.length&&this.weekTypes&&this.weekTypes.length){const i=this.weekTypes.find(e=>e.value===t.weekTypeId);e.subListItems.forEach(s=>{i.subListItems.forEach(n=>{a.push({season:e.label,seasonId:e.value,weekType:i.label,weekTypeId:i.value,month:s.description,monthId:s.id,day:n.description,dayId:n.id,peakType:t.peakType,peakTypeId:t.peakTypeId,hourStart:t.hourStart,hourEnd:t.hourEnd,rate:t.rate,rowNumber:a&&a.length?a.length+1:1})})})}});const n=this.validateSeasonPeakSettings(a);if(!n)return this.notificationMessage("Season peak settings not fully complete","red-snackbar"),n;const r={id:i,tariffName:this.createSeasonalTariffSettingsComponent.tariffName,utility:this.createSeasonalTariffSettingsComponent.utilityType,utilityTypeId:this.createSeasonalTariffSettingsComponent.utilityTypeId,parameter:this.createSeasonalTariffSettingsComponent.parameter?this.createSeasonalTariffSettingsComponent.parameter:"",parameterId:this.createSeasonalTariffSettingsComponent.parameterId?this.createSeasonalTariffSettingsComponent.parameterId:0,wefDate:this.createSeasonalTariffSettingsComponent.wefDate?new Date(this.createSeasonalTariffSettingsComponent.wefDate):null,tariffClients:t,seasonPeakSettings:a};return this.tariffMaster=r,n}validateSeasonPeakSettings(t){let e=!0,i=0;const a=t.find(t=>t.monthId);return t.filter(t=>t.monthId===a.monthId).sort((function(t,e){return t.dayId-e.dayId||t.hourStart.localeCompare(e.hourStart)})).forEach(t=>{var e=new Date,a=new Date;let s=t.hourEnd;"23:59:59"===t.hourEnd&&(s="24:00:00");var n=t.hourStart.split(":"),r=s.split(":");e.setHours(Number(n[0]),Number(n[1]),Number(n[2]),0),a.setHours(Number(r[0]),Number(r[1]),Number(r[2]),0);const o=I(a).diff(I(e),"hours");i+=o}),168!=i&&(e=!1),e}notificationMessage(t,e){this.snackbar.open(t,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[e]})}getUtilityTypes(){this.utilityTypes=[];let t=[];this.masterService.getSystemMasterdata(16,0).subscribe(e=>{e&&(e.forEach(e=>{t.push({label:e.description,value:e.id})}),this.utilityTypes=t)})}getParameters(){this.parameters=[];let t=[];this.masterService.getSystemMasterdata(33,0).subscribe(e=>{e&&(e.forEach(e=>{t.push({label:e.description,value:e.id})}),this.parameters=t)})}getSeasons(){this.seasons=[],this.masterService.getUserMasterParentData(1).subscribe(t=>{t&&t.forEach(t=>{this.seasons.push({label:t.description,value:t.id,subListItems:t.masters})})})}getWeekTypes(){this.weekTypes=[],this.masterService.getUserMasterParentData(2).subscribe(t=>{t&&t.forEach(t=>{this.weekTypes.push({label:t.description,value:t.id,subListItems:t.masters})})})}getDays(){this.days=[],this.masterService.getSystemMasterdata(32,0).subscribe(t=>{t&&(this.days=t)})}getPeakTypes(){this.peakTypes=[],this.masterService.getSystemMasterdata(13,0).subscribe(t=>{t&&t.forEach(t=>{this.peakTypes.push({label:t.description,value:t.id})})})}getMonths(){this.months=[],this.masterService.getSystemMasterdata(65,0).subscribe(t=>{t&&(this.months=t)})}getSlabs(){this.slabs=[],this.masterService.getUserMasterdata(38,0).subscribe(t=>{t&&t.forEach(t=>{this.slabs.push({label:t.description,value:t.id})})})}isSlabSettingsAdded(t){this.slabSettingsHide=t}isPeakSettingsAdded(t){this.peakSettingsHide=t}close(){this.createPeakSettingsComponent.deletedDataSource&&this.createPeakSettingsComponent.deletedDataSource.length||this.createPeakSettingsComponent.isContentChange?this.dialog.open(U.a,{data:{label:"By Closing the Page added data will be lost . Do you want to Exit?",selected:!1}}).afterClosed().subscribe(t=>{t&&(this.createPeakSettingsComponent.deletedDataSource&&this.createPeakSettingsComponent.deletedDataSource.length?(this.createPeakSettingsComponent.deletedDataSource.forEach(t=>this.createPeakSettingsComponent.dataSource.push(t)),this.createPeakSettingsComponent.deletedDataSource=[]):this.createPeakSettingsComponent.isContentChange=!1,this.dialogRef.close())}):this.dialogRef.close()}getTariffSettings(){this.tariffSettings=[],this.tariffMasterService.getTariffSettings().subscribe(t=>{t&&(this.tariffSettings=t)})}saveTariffSettings(t){this.tariffMasterService.saveTariffSettings(t).subscribe({next:t=>{t?this.notificationMessage("Tariff settings saved successfully","green-snackbar"):this.notificationMessage("Tariff settings save failed","red-snackbar"),this.getTariffSettings(),this.getSeasons(),this.getWeekTypes()},error:t=>{this.notificationMessage("Tariff settings save failed","red-snackbar")}})}}return t.\u0275fac=function(e){return new(e||t)(p.Nb(h.b),p.Nb(b.a),p.Nb(K.a),p.Nb(P.h),p.Nb(P.a),p.Nb(R),p.Nb(P.b))},t.\u0275cmp=p.Hb({type:t,selectors:[["app-create-tariff-settings"]],viewQuery:function(t,e){var i;1&t&&(p.Jc(k,!0),p.Jc(W,!0),p.Jc(X,!0)),2&t&&(p.zc(i=p.cc())&&(e.createSeasonalTariffSettingsComponent=i.first),p.zc(i=p.cc())&&(e.createPeakSettingsComponent=i.first),p.zc(i=p.cc())&&(e.createSlabRateSettingsComponent=i.first))},decls:34,vars:19,consts:[["mat-dialog-title",""],["role","toolbar",1,"task-header"],[1,"fx-spacer"],["mat-icon-button","",3,"click"],["title","Close","mat-list-icon",""],[3,"linear"],["stepper","matHorizontalStepper"],[3,"stepControl"],[3,"formGroup"],["matStepLabel",""],[1,"heading"],[1,"subheading"],[3,"utilityTypes","data","parameters","clients"],["fxLayout","row","fxLayoutAlign","end center","fxLayoutGap","8px",1,"actions"],["color","primary","mat-button","","type","button",3,"disabled","click"],["color","primary","mat-raised-button","","matStepperNext","",3,"disabled"],[3,"tariffSettings","peakTypes","days","months","weekTypes","seasons","data","tariffSettingsChanged","isDisable"],["fxLayout","row","fxLayoutAlign","end center","fxLayoutGap","8px",1,"actions",2,"padding-top","20px"],["color","primary","mat-button","","matStepperPrevious","","type","button"],["color","primary","mat-raised-button","","matStepperNext","",3,"disabled","click"]],template:function(t,e){if(1&t){const t=p.Ub();p.Tb(0,"div",0),p.Tb(1,"mat-toolbar",1),p.Tb(2,"span"),p.Rc(3,"Tariff Settings"),p.Sb(),p.Ob(4,"span",2),p.Tb(5,"button",3),p.bc("click",(function(){return e.close()})),p.Tb(6,"mat-icon",4),p.Rc(7,"close"),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Tb(8,"mat-dialog-content"),p.Tb(9,"fury-card"),p.Tb(10,"mat-horizontal-stepper",5,6),p.Tb(12,"mat-step",7),p.Tb(13,"form",8),p.Pc(14,Q,1,0,"ng-template",9),p.Ob(15,"div",10),p.Ob(16,"div",11),p.Ob(17,"app-create-seasonal-tariff-settings",12),p.Tb(18,"div",13),p.Tb(19,"button",14),p.bc("click",(function(){return p.Ec(t),p.Ac(11).reset()})),p.Rc(20,"RESET "),p.Sb(),p.Tb(21,"button",15),p.Rc(22,"NEXT "),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Tb(23,"mat-step"),p.Tb(24,"form",8),p.Pc(25,Y,1,0,"ng-template",9),p.Ob(26,"div",10),p.Ob(27,"div",11),p.Tb(28,"app-create-peak-settings",16),p.bc("tariffSettingsChanged",(function(t){return e.saveTariffSettings(t)}))("isDisable",(function(t){return e.isPeakSettingsAdded(t)})),p.Sb(),p.Tb(29,"div",17),p.Tb(30,"button",18),p.Rc(31,"PREVIOUS"),p.Sb(),p.Tb(32,"button",19),p.bc("click",(function(){return e.submit()})),p.Rc(33),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb()}2&t&&(p.Cb(10),p.mc("linear",!0),p.Cb(2),p.mc("stepControl",e.seasonSettingsFormGroup),p.Cb(1),p.mc("formGroup",e.seasonSettingsFormGroup),p.Cb(4),p.mc("utilityTypes",e.utilityTypes)("data",e.defaults)("parameters",e.parameters)("clients",e.clients),p.Cb(2),p.mc("disabled",e.seasonSettingsFormGroup.pristine),p.Cb(2),p.mc("disabled",e.seasonSettingsFormGroup.invalid),p.Cb(3),p.mc("formGroup",e.peakSettingsFormGroup),p.Cb(4),p.mc("tariffSettings",e.tariffSettings)("peakTypes",e.peakTypes)("days",e.days)("months",e.months)("weekTypes",e.weekTypes)("seasons",e.seasons)("data",e.defaults),p.Cb(4),p.mc("disabled",e.peakSettingsHide),p.Cb(1),p.Tc(" ",e.buttonName," "))},directives:[P.i,O.a,D.a,H.a,F.c,P.f,L.a,J.a,J.b,s.z,s.r,s.k,J.c,k,m.d,m.c,m.e,J.e,W,J.f],styles:["[_nghost-%COMP%]{background:url(/assets/img/backgrounds/form-wizard.jpg);background-size:cover;display:block}.title[_ngcontent-%COMP%]{color:#fff}.card[_ngcontent-%COMP%]{margin:24px;max-width:100%;border-radius:8px;overflow:hidden;box-shadow:0 6px 6px -3px rgba(0,0,0,.2),0 10px 14px 1px rgba(0,0,0,.14),0 4px 18px 3px rgba(0,0,0,.12)}.card[_ngcontent-%COMP%]   .heading[_ngcontent-%COMP%]{font:var(--font-title)}.card[_ngcontent-%COMP%]   .subheading[_ngcontent-%COMP%]{font:var(--font-subheading-1)}.card[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{margin:12px 0}.card[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .checkbox[_ngcontent-%COMP%]{margin-top:12px}.card[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{margin-top:24px;padding:24px 8px 0}.copyright[_ngcontent-%COMP%]{position:absolute;bottom:24px;right:24px;color:#fff}.padding[_ngcontent-%COMP%]{padding-bottom:0}.titleSelector[_ngcontent-%COMP%]{margin-top:auto;margin-right:24px}.profile[_ngcontent-%COMP%]{width:50%;display:flex}.profileImage[_ngcontent-%COMP%]{height:100px;margin-left:24px;margin-right:10px;padding:10px}.profileButton[_ngcontent-%COMP%]{align-self:center;padding:3px 15px}.document[_ngcontent-%COMP%]{width:50%;display:flex}.selectDocument[_ngcontent-%COMP%]{width:inherit;margin-right:30px;align-self:center;padding:3px 15px;overflow:hidden}.uploadButton[_ngcontent-%COMP%]{align-self:center;padding:5px 15px;border:1px solid grey;border-radius:3px;box-shadow:1px 1px 1px grey;cursor:pointer}.uploadButtonDisabled[_ngcontent-%COMP%]{align-self:center;padding:5px 15px;border:1px solid rgba(0,0,0,.26);border-radius:3px;box-shadow:1px 1px 1px rgba(0,0,0,.26);color:rgba(0,0,0,.26)}.deleteIcon[_ngcontent-%COMP%]{cursor:pointer}.company[_ngcontent-%COMP%]{align-self:center;margin-left:24px}.companyName[_ngcontent-%COMP%]{margin-top:10px;margin-right:24px}.mat-slide-toggle[_ngcontent-%COMP%]{padding-right:10px}.hide[_ngcontent-%COMP%]{display:none}.under-line[_ngcontent-%COMP%]{text-decoration:underline;cursor:pointer}.duplicateMessage[_ngcontent-%COMP%]{color:red;font-size:small}.duplicate[_ngcontent-%COMP%]{color:red}.task-header[_ngcontent-%COMP%]{background-color:transparent;padding:0 5px;height:20px}.fx-spacer[_ngcontent-%COMP%]{flex:1 1 auto}"],data:{animation:[d.a,u.a,f.a]}}),t})();var tt=i("KHMF"),et=i("xBcV"),it=i("Hbgg"),at=i("rnAf"),st=i("rvYj"),nt=i("M9IT"),rt=i("Dh3D"),ot=i("a8hA");let lt=(()=>{class t{constructor(t,e){this.router=t,this.clientSelectionService=e,this.columns=[],this.innerColumns=[],this.columnNames=[],this.tariffMasters=[],this.selectedRows=[],this.rowsSelected=new p.o,this.updateRow=new p.o,this.deleteRow=new p.o,this.addItemClicked=new p.o,this.hideHeader=!0,this.tariffColumnName="Tariff Name",this.utilityTypeColumnName="Utility Type",this.parameterColumnName="Parameter",this.wefDateColumnName="WEF Date",this.formName="Create Tariff"}set content(t){this.sort=t,this.sort&&(this.dataSource.sort=this.sort)}set dataSource(t){t&&t.length&&(this.tariffMasters=t)}ngOnInit(){this.clientSelectionService.setIsClientVisible(!1),this.formName=this.router.url.includes("slab-tariff-settings")?"Create Slab Tariff":"Create Tariff",this.createGridColumns()}createGridColumns(){this.columns=[{name:this.tariffColumnName,property:"tariffName",visible:!0,isModelProperty:!0},{name:this.utilityTypeColumnName,property:"utility",visible:!0,isModelProperty:!0},{name:"Actions",property:"actions",visible:!0,isModelProperty:!1}]}onSelectedRows(t){this.selectedRows=[],this.selectedRows=t,this.rowsSelected.emit(this.selectedRows)}onUpdateRow(t){this.updateRow.emit(t)}onAddItem(){this.addItemClicked.emit()}onDeleteRow(t){this.deleteRow.emit(t)}}return t.\u0275fac=function(e){return new(e||t)(p.Nb(c.f),p.Nb(ot.a))},t.\u0275cmp=p.Hb({type:t,selectors:[["fury-edit-tariff-settings-details"]],viewQuery:function(t,e){var i;1&t&&(p.Jc(nt.a,!0),p.Vc(rt.a,!0)),2&t&&(p.zc(i=p.cc())&&(e.paginator=i.first),p.zc(i=p.cc())&&(e.content=i.first))},inputs:{dataSource:"dataSource",hideHeader:"hideHeader"},outputs:{rowsSelected:"rowsSelected",updateRow:"updateRow",deleteRow:"deleteRow",addItemClicked:"addItemClicked"},decls:5,vars:6,consts:[[1,"person"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","24px"],["fxFlex","",1,"fury-flex-form-field"],[3,"visibleUpdateButton","visibleDeleteButton","formName","tableData","columns","hideHeader","addItemClicked","deleteRow","updateRow","selectedRows"]],template:function(t,e){1&t&&(p.Tb(0,"mat-dialog-content"),p.Tb(1,"div",0),p.Tb(2,"div",1),p.Tb(3,"div",2),p.Tb(4,"app-table-structure",3),p.bc("addItemClicked",(function(){return e.onAddItem()}))("deleteRow",(function(t){return e.onDeleteRow(t)}))("updateRow",(function(t){return e.onUpdateRow(t)}))("selectedRows",(function(t){return e.onSelectedRows(t)})),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb()),2&t&&(p.Cb(4),p.mc("visibleUpdateButton",!0)("visibleDeleteButton",!0)("formName",e.formName)("tableData",e.tariffMasters)("columns",e.columns)("hideHeader",!1))},directives:[P.f,m.d,m.e,m.b,w.a],styles:[""]}),t})();const ct=function(){return[]};let dt=(()=>{class t{constructor(t,e,i,a,s){var n;this.tariffMasterService=t,this.date=e,this.dialog=i,this.snackbar=a,this.envService=s,this._gap=16,this.gap=this._gap+"px",this.col2=`1 1 calc(50% - ${this._gap/2}px)`,this.col3=`1 1 calc(33.3333% - ${this._gap/1.5}px)`,this.tariffMasters=[],this.dateFormat="",this.dateFormat=null!==(n=Object(tt.e)("DateFormat"))&&void 0!==n?n:s.dateFormat}ngOnInit(){this.getTariffMasters()}getTariffMasters(){this.tariffMasterService.getTariffMasters().subscribe(t=>{t&&(t.forEach(t=>{t.wefDateLocal=this.date.transform(t.wefDate,this.dateFormat)}),this.tariffMasters=t.filter(t=>t.seasonPeakSettings.length>0))})}onUpdateRow(t){this.dialog.open(Z,{data:t}).afterClosed().subscribe(t=>{t?this.tariffMasterService.updateTariffMaster(t).subscribe({next:t=>{t?this.notificationMessage("Tariff master updated successfully","green-snackbar"):this.notificationMessage("Tariff master update failed","red-snackbar"),this.getTariffMasters()},error:t=>{this.notificationMessage("Tariff master update failed","red-snackbar")}}):this.getTariffMasters()})}onAddItem(){this.dialog.open(Z).afterClosed().subscribe(t=>{t&&this.tariffMasterService.saveTariffMaster(t).subscribe({next:t=>{t?this.notificationMessage("Tariff master saved successfully","green-snackbar"):this.notificationMessage("Tariff master save failed","red-snackbar"),this.getTariffMasters()},error:t=>{this.notificationMessage("Tariff master save failed","red-snackbar")}})})}notificationMessage(t,e){this.snackbar.open(t,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[e]})}onDeleteRow(t){t.isTariffUsed?this.notificationMessage("Cannot delete as tariff is in use","red-snackbar"):this.dialog.open(U.a,{data:{label:"Are you sure you want to Delete?",selected:!1}}).afterClosed().subscribe(e=>{e&&this.tariffMasterService.deleteTariffMaster(t).subscribe({next:t=>{t?this.notificationMessage("Tariff master deleted successfully","green-snackbar"):this.notificationMessage("Tariff master delete failed","red-snackbar"),this.getTariffMasters()},error:t=>{this.notificationMessage("Tariff master delete failed","red-snackbar")}})})}}return t.\u0275fac=function(e){return new(e||t)(p.Nb(R),p.Nb(a.f),p.Nb(P.b),p.Nb(h.b),p.Nb(_.a))},t.\u0275cmp=p.Hb({type:t,selectors:[["fury-edit-tariff-settings"]],decls:7,vars:6,consts:[["mode","card"],["current","Tariff Settings",3,"crumbs"],["fxFlex","noshrink","fxLayout","column","fxLayout.gt-sm","row","fxLayoutAlign.gt-sm","start stretch",3,"fxLayoutGap"],["fxLayout","column",1,"containerDiv"],[3,"dataSource","updateRow","deleteRow","addItemClicked"]],template:function(t,e){1&t&&(p.Tb(0,"fury-page-layout",0),p.Tb(1,"fury-page-layout-header"),p.Ob(2,"fury-breadcrumbs",1),p.Sb(),p.Tb(3,"fury-page-layout-content"),p.Tb(4,"div",2),p.Tb(5,"div",3),p.Tb(6,"fury-edit-tariff-settings-details",4),p.bc("updateRow",(function(t){return e.onUpdateRow(t)}))("deleteRow",(function(t){return e.onDeleteRow(t)}))("addItemClicked",(function(){return e.onAddItem()})),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb()),2&t&&(p.Cb(2),p.mc("@fadeInRight",void 0)("crumbs",p.qc(5,ct)),p.Cb(1),p.mc("@fadeInUp",void 0),p.Cb(1),p.mc("fxLayoutGap",e.gap),p.Cb(2),p.mc("dataSource",e.tariffMasters))},directives:[et.a,it.a,at.a,st.a,m.b,m.d,m.c,m.e,lt],styles:["[_nghost-%COMP%]{background:url(/assets/img/backgrounds/form-wizard.jpg);background-size:cover;display:block}.title[_ngcontent-%COMP%]{color:#fff}.card[_ngcontent-%COMP%]{margin:24px;max-width:100%;border-radius:8px;overflow:hidden;box-shadow:0 6px 6px -3px rgba(0,0,0,.2),0 10px 14px 1px rgba(0,0,0,.14),0 4px 18px 3px rgba(0,0,0,.12)}.card[_ngcontent-%COMP%]   .heading[_ngcontent-%COMP%]{font:var(--font-title)}.card[_ngcontent-%COMP%]   .subheading[_ngcontent-%COMP%]{font:var(--font-subheading-1)}.card[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{margin:12px 0}.card[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .checkbox[_ngcontent-%COMP%]{margin-top:12px}.card[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{margin-top:24px;padding:24px 8px 0}.copyright[_ngcontent-%COMP%]{position:absolute;bottom:24px;right:24px;color:#fff}.containerDiv[_ngcontent-%COMP%]{padding:0 0 24px;display:flex;width:100%}"],data:{animation:[d.a,u.a]}}),t})();var ut=i("nST0");function ft(t,e){1&t&&p.Rc(0,"Tariff Settings")}function bt(t,e){1&t&&p.Rc(0,"Slab Settings")}let pt=(()=>{class t{constructor(t,e,i,a,s,n,r,o,l,c,d){this.fb=t,this.cd=e,this.snackbar=i,this.masterService=a,this.announcementService=s,this.tariffMasterService=n,this.clientService=r,this.clientSelectionService=o,this.dialogRef=l,this.defaults=c,this.dialog=d,this._gap=16,this.gap=this._gap+"px",this.col2=`1 1 calc(50% - ${this._gap/2}px)`,this.col3=`1 1 calc(33.3333% - ${this._gap/1.5}px)`,this.utilityTypes=[],this.parameters=[],this.days=[],this.peakTypes=[],this.months=[],this.slabs=[],this.clients=[],this.utilityTypeId=0,this.parameterId=0,this.passwordInputType="password",this.tariffName="",this.rate=0,this.peakTypeId=0,this.weekTypeId=0,this.from=0,this.to=0,this.tariffDate=new Date,this.isDisable=!0,this.tariffMaster={},this.isSlabTariffSettings=!1,this.isSeasonalTariffSettings=!1,this.peakSettingsHide=!0,this.slabSettingsHide=!0,this.buttonName="CREATE SLAB TARIFF",l.disableClose=!0}ngOnInit(){this.clientSelectionService.setIsClientVisible(!1),this.defaults&&(this.slabSettingsHide=!1,this.buttonName="UPDATE SLAB TARIFF"),this.seasonSettingsFormGroup=this.createSeasonalTariffSettingsComponent.season_tariff,this.slabSettingsFormGroup=this.createSlabRateSettingsComponent.slab_rate,this.getUtilityTypes(),this.getParameters(),this.getClients(),this.getDays(),this.getPeakTypes(),this.getMonths(),this.getSlabs()}getClients(){this.clients=[],this.announcementService.getClients().subscribe(t=>{t&&(this.clients=t)})}submit(){this.updateValues(),this.dialogRef.close(this.tariffMaster)}updateValues(){let t=[];const e=this.createSeasonalTariffSettingsComponent.selectedClients;e&&e.forEach(e=>{t.push({clientId:Number(e)})});let i=0;this.defaults&&(i=this.defaults.id);const a={id:i,tariffName:this.createSeasonalTariffSettingsComponent.tariffName,utility:this.createSeasonalTariffSettingsComponent.utilityType,utilityTypeId:this.createSeasonalTariffSettingsComponent.utilityTypeId,parameter:this.createSeasonalTariffSettingsComponent.parameter,parameterId:this.createSeasonalTariffSettingsComponent.parameterId,wefDate:new Date(this.createSeasonalTariffSettingsComponent.wefDate),tariffClients:t,tariffConsumptionSettings:this.createSlabRateSettingsComponent.dataSource};this.tariffMaster=a}notificationMessage(t,e){this.snackbar.open(t,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[e]})}getUtilityTypes(){this.utilityTypes=[];let t=[];this.masterService.getSystemMasterdata(16,0).subscribe(e=>{e&&(e.forEach(e=>{t.push({label:e.description,value:e.id})}),this.utilityTypes=t)})}getParameters(){this.parameters=[];let t=[];this.masterService.getSystemMasterdata(33,0).subscribe(e=>{e&&(e.forEach(e=>{t.push({label:e.description,value:e.id})}),this.parameters=t)})}getDays(){this.days=[],this.masterService.getSystemMasterdata(32,0).subscribe(t=>{t&&t.forEach(t=>{this.days.push({label:t.description,value:t.id})})})}getPeakTypes(){this.peakTypes=[],this.masterService.getSystemMasterdata(13,0).subscribe(t=>{t&&t.forEach(t=>{this.peakTypes.push({label:t.description,value:t.id})})})}getMonths(){this.months=[],this.masterService.getSystemMasterdata(65,0).subscribe(t=>{t&&t.forEach(t=>{this.months.push({label:t.description,value:t.id})})})}getSlabs(){this.slabs=[],this.masterService.getUserMasterdata(38,0).subscribe(t=>{t&&t.forEach(t=>{this.slabs.push({label:t.description,value:t.id})})})}isSlabSettingsAdded(t){this.slabSettingsHide=t}isPeakSettingsAdded(t){this.peakSettingsHide=t}close(){this.createSlabRateSettingsComponent.deletedDataSource&&this.createSlabRateSettingsComponent.deletedDataSource.length||this.createSlabRateSettingsComponent.isContentChange?this.dialog.open(U.a,{data:{label:"By Closing the Page added data will be lost . Do you want to Exit?",selected:!1}}).afterClosed().subscribe(t=>{t&&(this.createSlabRateSettingsComponent.dataSource.length?(this.createSlabRateSettingsComponent.deletedDataSource.forEach(t=>this.createSlabRateSettingsComponent.dataSource.push(t)),this.createSlabRateSettingsComponent.dataSource.sort((t,e)=>t.consumptionMin-e.consumptionMin||t.consumptionMax-e.consumptionMax),this.createSlabRateSettingsComponent.deletedDataSource=[]):this.createSlabRateSettingsComponent.isContentChange=!1,this.dialogRef.close())}):this.dialogRef.close()}}return t.\u0275fac=function(e){return new(e||t)(p.Nb(s.f),p.Nb(p.h),p.Nb(h.b),p.Nb(b.a),p.Nb(K.a),p.Nb(R),p.Nb(ut.a),p.Nb(ot.a),p.Nb(P.h),p.Nb(P.a),p.Nb(P.b))},t.\u0275cmp=p.Hb({type:t,selectors:[["app-create-slab-tariff-settings"]],viewQuery:function(t,e){var i;1&t&&(p.Jc(k,!0),p.Jc(W,!0),p.Jc(X,!0)),2&t&&(p.zc(i=p.cc())&&(e.createSeasonalTariffSettingsComponent=i.first),p.zc(i=p.cc())&&(e.createPeakSettingsComponent=i.first),p.zc(i=p.cc())&&(e.createSlabRateSettingsComponent=i.first))},decls:34,vars:14,consts:[["mat-dialog-title",""],["role","toolbar",1,"task-header"],[1,"fx-spacer"],["mat-icon-button","",3,"click"],["title","Close","mat-list-icon",""],[3,"linear"],["stepper","matHorizontalStepper"],[3,"stepControl"],[3,"formGroup"],["matStepLabel",""],[1,"heading"],[1,"subheading"],[3,"utilityTypes","data","parameters","clients"],["fxLayout","row","fxLayoutAlign","end center","fxLayoutGap","8px",1,"actions"],["color","primary","mat-button","","type","button",3,"disabled","click"],["color","primary","mat-raised-button","","matStepperNext","",3,"disabled"],[3,"slabs","data","isDisable"],["fxLayout","row","fxLayoutAlign","end center","fxLayoutGap","8px",1,"actions",2,"padding-top","20px"],["color","primary","mat-button","","matStepperPrevious","","type","button"],["color","primary","mat-raised-button","","matStepperNext","",3,"disabled","click"]],template:function(t,e){if(1&t){const t=p.Ub();p.Tb(0,"div",0),p.Tb(1,"mat-toolbar",1),p.Tb(2,"span"),p.Rc(3,"Slab Tariff Settings"),p.Sb(),p.Ob(4,"span",2),p.Tb(5,"button",3),p.bc("click",(function(){return e.close()})),p.Tb(6,"mat-icon",4),p.Rc(7,"close"),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Tb(8,"mat-dialog-content"),p.Tb(9,"fury-card"),p.Tb(10,"mat-horizontal-stepper",5,6),p.Tb(12,"mat-step",7),p.Tb(13,"form",8),p.Pc(14,ft,1,0,"ng-template",9),p.Ob(15,"div",10),p.Ob(16,"div",11),p.Ob(17,"app-create-seasonal-tariff-settings",12),p.Tb(18,"div",13),p.Tb(19,"button",14),p.bc("click",(function(){return p.Ec(t),p.Ac(11).reset()})),p.Rc(20,"RESET "),p.Sb(),p.Tb(21,"button",15),p.Rc(22,"NEXT "),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Tb(23,"mat-step"),p.Tb(24,"form",8),p.Pc(25,bt,1,0,"ng-template",9),p.Ob(26,"div",10),p.Ob(27,"div",11),p.Tb(28,"app-create-slab-rate-settings",16),p.bc("isDisable",(function(t){return e.isSlabSettingsAdded(t)})),p.Sb(),p.Tb(29,"div",17),p.Tb(30,"button",18),p.Rc(31,"PREVIOUS"),p.Sb(),p.Tb(32,"button",19),p.bc("click",(function(){return e.submit()})),p.Rc(33),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb()}2&t&&(p.Cb(10),p.mc("linear",!0),p.Cb(2),p.mc("stepControl",e.seasonSettingsFormGroup),p.Cb(1),p.mc("formGroup",e.seasonSettingsFormGroup),p.Cb(4),p.mc("utilityTypes",e.utilityTypes)("data",e.defaults)("parameters",e.parameters)("clients",e.clients),p.Cb(2),p.mc("disabled",e.seasonSettingsFormGroup.pristine),p.Cb(2),p.mc("disabled",e.seasonSettingsFormGroup.invalid),p.Cb(3),p.mc("formGroup",e.slabSettingsFormGroup),p.Cb(4),p.mc("slabs",e.slabs)("data",e.defaults),p.Cb(4),p.mc("disabled",e.slabSettingsHide),p.Cb(1),p.Tc(" ",e.buttonName," "))},directives:[P.i,O.a,D.a,H.a,F.c,P.f,L.a,J.a,J.b,s.z,s.r,s.k,J.c,k,m.d,m.c,m.e,J.e,X,J.f],styles:["[_nghost-%COMP%]{background:url(/assets/img/backgrounds/form-wizard.jpg);background-size:cover;display:block}.title[_ngcontent-%COMP%]{color:#fff}.card[_ngcontent-%COMP%]{margin:24px;max-width:100%;border-radius:8px;overflow:hidden;box-shadow:0 6px 6px -3px rgba(0,0,0,.2),0 10px 14px 1px rgba(0,0,0,.14),0 4px 18px 3px rgba(0,0,0,.12)}.card[_ngcontent-%COMP%]   .heading[_ngcontent-%COMP%]{font:var(--font-title)}.card[_ngcontent-%COMP%]   .subheading[_ngcontent-%COMP%]{font:var(--font-subheading-1)}.card[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{margin:12px 0}.card[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .checkbox[_ngcontent-%COMP%]{margin-top:12px}.card[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{margin-top:24px;padding:24px 8px 0}.copyright[_ngcontent-%COMP%]{position:absolute;bottom:24px;right:24px;color:#fff}.padding[_ngcontent-%COMP%]{padding-bottom:0}.titleSelector[_ngcontent-%COMP%]{margin-top:auto;margin-right:24px}.profile[_ngcontent-%COMP%]{width:50%;display:flex}.profileImage[_ngcontent-%COMP%]{height:100px;margin-left:24px;margin-right:10px;padding:10px}.profileButton[_ngcontent-%COMP%]{align-self:center;padding:3px 15px}.document[_ngcontent-%COMP%]{width:50%;display:flex}.selectDocument[_ngcontent-%COMP%]{width:inherit;margin-right:30px;align-self:center;padding:3px 15px;overflow:hidden}.uploadButton[_ngcontent-%COMP%]{align-self:center;padding:5px 15px;border:1px solid grey;border-radius:3px;box-shadow:1px 1px 1px grey;cursor:pointer}.uploadButtonDisabled[_ngcontent-%COMP%]{align-self:center;padding:5px 15px;border:1px solid rgba(0,0,0,.26);border-radius:3px;box-shadow:1px 1px 1px rgba(0,0,0,.26);color:rgba(0,0,0,.26)}.deleteIcon[_ngcontent-%COMP%]{cursor:pointer}.company[_ngcontent-%COMP%]{align-self:center;margin-left:24px}.companyName[_ngcontent-%COMP%]{margin-top:10px;margin-right:24px}.mat-slide-toggle[_ngcontent-%COMP%]{padding-right:10px}.hide[_ngcontent-%COMP%]{display:none}.under-line[_ngcontent-%COMP%]{text-decoration:underline;cursor:pointer}.duplicateMessage[_ngcontent-%COMP%]{color:red;font-size:small}.duplicate[_ngcontent-%COMP%]{color:red}.task-header[_ngcontent-%COMP%]{background-color:transparent;padding:0 5px;height:20px}.fx-spacer[_ngcontent-%COMP%]{flex:1 1 auto}"],data:{animation:[d.a,u.a,f.a]}}),t})();const ht=function(){return[]},mt=[{path:"create-tariff-settings",component:Z},{path:"tariff-settings",component:dt},{path:"slab-tariff-settings",component:(()=>{class t{constructor(t,e,i,a,s){var n;this.tariffMasterService=t,this.date=e,this.dialog=i,this.snackbar=a,this.envService=s,this._gap=16,this.gap=this._gap+"px",this.col2=`1 1 calc(50% - ${this._gap/2}px)`,this.col3=`1 1 calc(33.3333% - ${this._gap/1.5}px)`,this.tariffMasters=[],this.dateFormat="",this.dateFormat=null!==(n=Object(tt.e)("DateFormat"))&&void 0!==n?n:s.dateFormat}ngOnInit(){this.getTariffMasters()}getTariffMasters(){this.tariffMasterService.getTariffMasters().subscribe(t=>{t&&(t.forEach(t=>{t.wefDateLocal=this.date.transform(t.wefDate,this.dateFormat)}),this.tariffMasters=t.filter(t=>t.tariffConsumptionSettings.length>0))})}onUpdateRow(t){this.dialog.open(pt,{data:t}).afterClosed().subscribe(t=>{t?this.tariffMasterService.updateTariffMaster(t).subscribe({next:t=>{t?this.notificationMessage("Tariff master updated successfully","green-snackbar"):this.notificationMessage("Tariff master update failed","red-snackbar"),this.getTariffMasters()},error:t=>{this.notificationMessage("Tariff master update failed","red-snackbar")}}):this.getTariffMasters()})}onAddItem(){this.dialog.open(pt).afterClosed().subscribe(t=>{t&&this.tariffMasterService.saveTariffMaster(t).subscribe({next:t=>{t?this.notificationMessage("Tariff master saved successfully","green-snackbar"):this.notificationMessage("Tariff master save failed","red-snackbar"),this.getTariffMasters()},error:t=>{this.notificationMessage("Tariff master save failed","red-snackbar")}})})}notificationMessage(t,e){this.snackbar.open(t,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[e]})}onDeleteRow(t){t.isTariffUsed?this.notificationMessage("Cannot delete as tariff is in use","red-snackbar"):this.dialog.open(U.a,{data:{label:"Are you sure you want to Delete?",selected:!1}}).afterClosed().subscribe(e=>{e&&this.tariffMasterService.deleteTariffMaster(t).subscribe({next:t=>{t?this.notificationMessage("Tariff master deleted successfully","green-snackbar"):this.notificationMessage("Tariff master delete failed","red-snackbar"),this.getTariffMasters()},error:t=>{this.notificationMessage("Tariff master delete failed","red-snackbar")}})})}}return t.\u0275fac=function(e){return new(e||t)(p.Nb(R),p.Nb(a.f),p.Nb(P.b),p.Nb(h.b),p.Nb(_.a))},t.\u0275cmp=p.Hb({type:t,selectors:[["fury-edit-slab-tariff-settings"]],decls:7,vars:6,consts:[["mode","card"],["current","Slab Tariff Settings",3,"crumbs"],["fxFlex","noshrink","fxLayout","column","fxLayout.gt-sm","row","fxLayoutAlign.gt-sm","start stretch",3,"fxLayoutGap"],["fxLayout","column",1,"containerDiv"],[3,"dataSource","updateRow","deleteRow","addItemClicked"]],template:function(t,e){1&t&&(p.Tb(0,"fury-page-layout",0),p.Tb(1,"fury-page-layout-header"),p.Ob(2,"fury-breadcrumbs",1),p.Sb(),p.Tb(3,"fury-page-layout-content"),p.Tb(4,"div",2),p.Tb(5,"div",3),p.Tb(6,"fury-edit-tariff-settings-details",4),p.bc("updateRow",(function(t){return e.onUpdateRow(t)}))("deleteRow",(function(t){return e.onDeleteRow(t)}))("addItemClicked",(function(){return e.onAddItem()})),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb()),2&t&&(p.Cb(2),p.mc("@fadeInRight",void 0)("crumbs",p.qc(5,ht)),p.Cb(1),p.mc("@fadeInUp",void 0),p.Cb(1),p.mc("fxLayoutGap",e.gap),p.Cb(2),p.mc("dataSource",e.tariffMasters))},directives:[et.a,it.a,at.a,st.a,m.b,m.d,m.c,m.e,lt],styles:["[_nghost-%COMP%]{background:url(/assets/img/backgrounds/form-wizard.jpg);background-size:cover;display:block}.title[_ngcontent-%COMP%]{color:#fff}.card[_ngcontent-%COMP%]{margin:24px;max-width:100%;border-radius:8px;overflow:hidden;box-shadow:0 6px 6px -3px rgba(0,0,0,.2),0 10px 14px 1px rgba(0,0,0,.14),0 4px 18px 3px rgba(0,0,0,.12)}.card[_ngcontent-%COMP%]   .heading[_ngcontent-%COMP%]{font:var(--font-title)}.card[_ngcontent-%COMP%]   .subheading[_ngcontent-%COMP%]{font:var(--font-subheading-1)}.card[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{margin:12px 0}.card[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .checkbox[_ngcontent-%COMP%]{margin-top:12px}.card[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{margin-top:24px;padding:24px 8px 0}.copyright[_ngcontent-%COMP%]{position:absolute;bottom:24px;right:24px;color:#fff}.containerDiv[_ngcontent-%COMP%]{padding:0 0 24px;display:flex;width:100%}"],data:{animation:[d.a,u.a]}}),t})()}];let gt=(()=>{class t{}return t.\u0275mod=p.Lb({type:t}),t.\u0275inj=p.Kb({factory:function(e){return new(e||t)},imports:[[c.j.forChild(mt)],c.j]}),t})(),St=(()=>{class t{}return t.\u0275mod=p.Lb({type:t}),t.\u0275inj=p.Kb({factory:function(e){return new(e||t)},imports:[[a.c,s.l,n.a,r.a,s.w,o.a,gt,l.a,P.g]]}),t})()}}]);