!function(){function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[60],{"XL0+":function(t,n,r){"use strict";r.r(n),r.d(n,"LoginModule",(function(){return D}));var o=r("ofXK"),a=r("3Pt+"),s=r("KthW"),c=r("tyNb"),u=r("nStZ"),l=r("seMb"),d=r("+Kgr"),f=r("cIyM"),g=r("zSPf"),h=r("0E0g"),b=r("Y0L5"),m=r("hKI3"),p=r("KHMF"),v=r("sXtk"),y=r("fXoL"),k=r("dNgK"),S=r("Nm8O"),w=r("0IaG"),C=r("b6Qw"),I=r("XiUz"),x=r("kmnG"),L=r("qFsG"),P=r("YaQ2"),A=r("bTqV"),R=r("Qu3c"),F=r("NFeN");function T(e,t){1&e&&(y.Tb(0,"mat-icon"),y.Rc(1,"visibility"),y.Sb())}function N(e,t){1&e&&(y.Tb(0,"mat-icon"),y.Rc(1,"visibility_off"),y.Sb())}var O=function(){return["/forgot-password"]};function M(e,t){1&e&&(y.Tb(0,"a",16),y.Rc(1,"Forgot Password?"),y.Sb()),2&e&&y.mc("routerLink",y.qc(1,O))}function E(e,t){if(1&e){var i=y.Ub();y.Tb(0,"a",17),y.bc("click",(function(){return y.Ec(i),y.fc().goRegister(0)})),y.Rc(1,"New User Registration"),y.Sb()}}var _,U,z,q=[{path:"",component:(_=function(){function t(i,n,r,o,a,s,c,u,l,d,f,g,h){e(this,t),this.router=i,this.fb=n,this.cd=r,this.snackbar=o,this.fv=a,this.authenticationService=s,this.jwtHelperService=c,this.menuItemService=u,this.masterService=l,this.dialog=d,this.loginReportService=f,this.cookieService=g,this.envService=h,this.menuItems=[],this.inputType="password",this.visible=!1,this.userAcceptanceFiles=[],this.userAcceptanceLog=[],this.loginButtonClicked=!1,this.parameterValue=!0,this.parameterValueForgotPassword=!0}return i(t,[{key:"ngOnInit",value:function(){var e=this;this.unauthorizedSubcription=this.menuItemService.isUnauthorizedHandler.subscribe((function(t){e.loginButtonClicked=!1})),this.masterService.getParameterValue("Register").subscribe((function(t){t||(e.parameterValue=t)})),this.masterService.getParameterValue("ForgotPassword").subscribe((function(t){t||(e.parameterValueForgotPassword=t)})),this.getDefaultRoutePages(),this.form=this.fb.group({username:["",this.fv.requiredAlphanumericNoSpaces],password:["",this.fv.passwordValidators]}),this.defaults=new m.a({})}},{key:"removeSessionStorageItems",value:function(){Object(p.d)(this.cookieService,this.envService)}},{key:"send",value:function(){var e=this;this.loginButtonClicked=!0,this.authenticationService.login({userName:this.form.value.username||"",password:this.form.value.password||""}).subscribe({next:function(t){t?"Failed"==t.status?(e.notificationMessage("Please confirm your email to continue login","red-snackbar"),e.loginButtonClicked=!1):t.token?(e.cookieService.set("access_token",t.token),localStorage.setItem("logged_in","true"),e.loginUserDetails(t.token),e.defaults.userId=e.cookieService.get("userId"),e.defaults.accountNumber=e.form.value.username,e.loginReportService.getIPAddress().subscribe((function(t){t&&(e.defaults.ipAddress=t.ip,e.captureWhoLoggedInDetails(e.defaults))}),(function(){console.log("No response fron ipify"),e.loginButtonClicked=!1}))):(e.notificationMessage("login failed due to no access token","red-snackbar"),e.loginButtonClicked=!1):(e.notificationMessage("login failed due to no access token","red-snackbar"),e.loginButtonClicked=!1)},error:function(){e.notificationMessage("Invalid Username and Password","red-snackbar"),e.loginButtonClicked=!1}})}},{key:"captureWhoLoggedInDetails",value:function(e){var t=this;this.loginReportService.createLoginDetails(e).subscribe((function(e){e?(t.cookieService.set("userLoginId",e),t.loginButtonClicked=!1):(t.cookieService.set("userLoginId",""),t.loginButtonClicked=!1)}))}},{key:"notificationMessage",value:function(e,t){this.snackbar.open(e,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[t]})}},{key:"showCredentials",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.userAcceptanceFiles=[],this.menuItemService.getUserAcceptanceFiles(t).subscribe({next:function(t){e.userAcceptanceFiles=t,e.userAcceptanceFiles&&e.userAcceptanceFiles.length&&e.userAcceptanceFiles.forEach((function(t){if(e.userAcceptanceLog&&e.userAcceptanceLog.length){var i=e.userAcceptanceLog.find((function(e){return e.userAcceptanceFileId===t.id}));(!i||i&&!i.isAccepted)&&e.dialog.open(h.a,{autoFocus:!0,height:"610px",data:t}).afterClosed().subscribe()}else e.dialog.open(h.a,{autoFocus:!0,height:"610px",data:t}).afterClosed().subscribe()}))},error:function(){e.userAcceptanceFiles=[]}})}},{key:"userFileAcceptance",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.userAcceptanceLog=[],this.menuItemService.getUserFileAcceptanceLog(e).subscribe({next:function(e){e&&e.length?(t.userAcceptanceLog=e,t.showCredentials(i)):(t.userAcceptanceLog=[],t.showCredentials(i))},error:function(){t.userAcceptanceLog=[],t.showCredentials(i)}})}},{key:"loginUserDetails",value:function(e){var t=this,i=this.jwtHelperService.decodeToken(e);if(i){var n=i["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"];if("External"===n){var r=i["http://schemas.xmlsoap.org/ws/2005/05/identity/claims/sid"];this.cookieService.set("userId",r),this.authenticationService.getExternalUserDetails(r).subscribe({next:function(e){if(e){var i=0;i="Owner"===e.entityType?t.envService.externalRoles.ownerExternal:t.envService.externalRoles.tenantExternal,t.setInitialSessionStorageForUser(e.userDetails,e.photo);var o=t.cookieService.get("globalClientId");if(t.getClientDataFormats(0==i?0:o),t.menuItemService.setIsExteranlUser(i),t.cookieService.set("ownerId",e.id.toString()),t.cookieService.set("external_role",i.toString()),!t.defaultPageRoutes||!t.defaultPageRoutes.length)return t.notificationMessage("Default page is missing for ".concat(n," role. Please contact administrator."),"red-snackbar"),void(t.loginButtonClicked=!1);var a=t.defaultPageRoutes.find((function(e){return e.roleId===i&&!1===e.isInternalUser}));if(!a)return t.notificationMessage("Default page is missing for ".concat(n," role. Please contact administrator."),"red-snackbar"),void(t.loginButtonClicked=!1);t.router.navigate([a.route]),t.userFileAcceptance(r,i),t.loginButtonClicked=!1}},error:function(){t.notificationMessage("Invalid user details","red-snackbar"),t.loginButtonClicked=!1}})}else{this.menuItemService.setIsAuthenticatedUser(!0);var o=i["http://schemas.xmlsoap.org/ws/2005/05/identity/claims/sid"];this.cookieService.set("userId",o),this.authenticationService.getUserDetailsById(o).subscribe({next:function(e){if(e){if(t.setInitialSessionStorageForUser(e,i["http://schemas.microsoft.com/ws/2008/06/identity/claims/userdata"]),!t.defaultPageRoutes||!t.defaultPageRoutes.length)return t.notificationMessage("Default page is missing for ".concat(n," role. Please contact administrator."),"red-snackbar"),void(t.loginButtonClicked=!1);var r=t.defaultPageRoutes.find((function(e){return e.role===n&&!0===e.isInternalUser}));if(!r)return t.notificationMessage("Default page is missing for ".concat(n," role. Please contact administrator."),"red-snackbar"),void(t.loginButtonClicked=!1);t.router.navigate([r.route]),t.userFileAcceptance(o),t.loginButtonClicked=!1}},error:function(){t.notificationMessage("Invalid user details","red-snackbar"),t.loginButtonClicked=!1}})}}}},{key:"setInitialSessionStorageForUser",value:function(e,t){this.appUserFirstClientId=e.userClients.length>0?e.userClients[0].clientId:0,this.cookieService.set("access_profile",t),this.cookieService.set("globalClientId",this.appUserFirstClientId),localStorage.setItem("userClients",JSON.stringify(e.userClients))}},{key:"getClientDataFormats",value:function(e){e?this.masterService.getClientDataFormats(parseInt(e)).subscribe((function(e){e&&localStorage.setItem("data_formats",JSON.stringify(e))})):this.masterService.getDefaultDataFormats().subscribe((function(e){e&&localStorage.setItem("data_formats",JSON.stringify(e))}))}},{key:"getDefaultRoutePages",value:function(){var e=this;this.menuItemService.getDefaultRouterDetails().subscribe({next:function(t){e.defaultPageRoutes=t},error:function(){e.defaultPageRoutes=[]}})}},{key:"toggleVisibility",value:function(){this.visible?(this.inputType="password",this.visible=!1,this.cd.markForCheck()):(this.inputType="text",this.visible=!0,this.cd.markForCheck())}},{key:"goRegister",value:function(e){var t=this.router.serializeUrl(this.router.createUrlTree(["/register"],{queryParams:{clientId:e}}));window.open(t,"_blank")}}]),t}(),_.\u0275fac=function(e){return new(e||_)(y.Nb(c.f),y.Nb(a.f),y.Nb(y.h),y.Nb(k.b),y.Nb(l.a),y.Nb(d.a),y.Nb(S.a),y.Nb(f.a),y.Nb(g.a),y.Nb(w.b),y.Nb(b.a),y.Nb(C.a),y.Nb(v.a))},_.\u0275cmp=y.Hb({type:_,selectors:[["fury-login"]],decls:27,vars:10,consts:[["fxLayout","column","fxLayoutAlign","center center",1,"page"],[1,"card"],["fxLayout","column","fxLayoutAlign","center center",1,"header","padding"],["src","assets/img/smartBill.png","width","290px","height","90px"],["fxLayout","column","fxLayoutGap","16px",1,"padding",3,"formGroup"],["fxFlex","auto","fxLayout","column"],["fxFlex","grow"],["matInput","","required","","formControlName","username"],[3,"ctrl"],["matInput","","formControlName","password","required","",3,"type"],["type","button","mat-icon-button","","matSuffix","","matTooltip","Toggle Visibility",3,"click"],[4,"ngIf"],["fxLayout","row","fxLayoutAlign","space-between center"],["class","caption disable-anchor-link",3,"routerLink",4,"ngIf"],["class","caption disable-anchor-link",3,"routerLink","click",4,"ngIf"],["type","button","color","primary","mat-raised-button","",3,"disabled","click"],[1,"caption","disable-anchor-link",3,"routerLink"],[1,"caption","disable-anchor-link",3,"routerLink","click"]],template:function(e,t){1&e&&(y.Tb(0,"div",0),y.Tb(1,"div",1),y.Tb(2,"div",2),y.Tb(3,"div"),y.Ob(4,"img",3),y.Sb(),y.Sb(),y.Tb(5,"div",4),y.Tb(6,"div",5),y.Tb(7,"mat-form-field",6),y.Tb(8,"mat-label"),y.Rc(9,"Username"),y.Sb(),y.Ob(10,"input",7),y.Ob(11,"app-show-errors",8),y.Sb(),y.Tb(12,"mat-form-field",6),y.Tb(13,"mat-label"),y.Rc(14,"Password"),y.Sb(),y.Ob(15,"input",9),y.Tb(16,"button",10),y.bc("click",(function(){return t.toggleVisibility()})),y.Pc(17,T,2,0,"mat-icon",11),y.Pc(18,N,2,0,"mat-icon",11),y.Sb(),y.Tb(19,"mat-hint"),y.Rc(20,"Click the eye to toggle visibility"),y.Sb(),y.Ob(21,"app-show-errors",8),y.Sb(),y.Sb(),y.Tb(22,"div",12),y.Pc(23,M,2,2,"a",13),y.Pc(24,E,2,0,"a",14),y.Sb(),y.Tb(25,"button",15),y.bc("click",(function(){return t.send()})),y.Rc(26," SIGN IN "),y.Sb(),y.Sb(),y.Sb(),y.Sb()),2&e&&(y.Cb(1),y.mc("@fadeInUp",void 0),y.Cb(4),y.mc("formGroup",t.form),y.Cb(6),y.mc("ctrl",t.form.get("username")),y.Cb(4),y.mc("type",t.inputType),y.Cb(2),y.mc("ngIf",t.visible),y.Cb(1),y.mc("ngIf",!t.visible),y.Cb(3),y.mc("ctrl",t.form.get("password")),y.Cb(2),y.mc("ngIf",t.parameterValueForgotPassword),y.Cb(1),y.mc("ngIf",t.parameterValue),y.Cb(1),y.mc("disabled",t.loginButtonClicked))},directives:[I.d,I.c,I.e,a.r,a.k,I.b,x.d,x.h,L.b,a.c,a.x,a.q,a.i,P.a,A.a,x.j,R.a,o.o,x.g,F.a,c.i],styles:[".page[_ngcontent-%COMP%]{display:block;height:100%;width:100%;background-color:#fff;background-image:url(bg2.244996fb1d2175aa7b80.jpeg);background-position:50%;background-repeat:no-repeat;background-size:100% 100%}.card[_ngcontent-%COMP%]{width:380px;box-shadow:0 1px 3px rgba(0,0,0,.3),0 1px 3px rgba(0,0,0,.3);transition:all .3s cubic-bezier(.35,.8,.35,1)}@media screen and (max-width:599px){.card[_ngcontent-%COMP%]{width:300px}}.card[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{border-top-left-radius:8px;border-top-right-radius:8px}.center[_ngcontent-%COMP%]{display:block;margin-left:auto;margin-right:auto;width:50%}a[_ngcontent-%COMP%]:link{font-weight:700}a[_ngcontent-%COMP%]:hover{color:#1976d2}.disable-anchor-link[_ngcontent-%COMP%]{text-decoration:none}"],data:{animation:[u.a]}}),_)}],V=((U=function t(){e(this,t)}).\u0275mod=y.Lb({type:U}),U.\u0275inj=y.Kb({factory:function(e){return new(e||U)},imports:[[c.j.forChild(q)],c.j]}),U),B=r("GiUZ"),D=((z=function t(){e(this,t)}).\u0275mod=y.Lb({type:z}),z.\u0275inj=y.Kb({factory:function(e){return new(e||z)},imports:[[o.c,V,s.a,a.w,B.a]]}),z)},YaQ2:function(t,n,r){"use strict";r.d(n,"a",(function(){return u}));var o=r("fXoL"),a=r("ofXK");function s(e,t){if(1&e&&(o.Tb(0,"small"),o.Rc(1),o.Ob(2,"br"),o.Sb()),2&e){var i=t.$implicit;o.Cb(1),o.Tc(" ",i," ")}}function c(e,t){if(1&e&&(o.Tb(0,"div"),o.Pc(1,s,3,1,"small",1),o.Sb()),2&e){var i=o.fc();o.Cb(1),o.mc("ngForOf",i.listOfErrors())}}var u=function(){var t=function(){function t(){var i=this;e(this,t),this.PATTERN_ERROR_MESSAGE={"/^[a-zA-Z ]*$/":"Accepts only alphabets with spaces","/^[a-zA-Z0-9]*$/":"Accepts only alphanumeric values with no spaces","/^[a-zA-Z0-9 ]*$/":"Accepts only alphanumeric values with spaces","/^[0-9]*$/":"Accepts only numbers","^[a-z0-9._%+-]+@[a-z0-9.-]+\\.[a-z]{3,4}$":"Enter valid email address of format test@mail.com"},this.ERROR_MESSAGE={required:function(){return"This field is required"},minlength:function(e){return"Min ".concat(e.requiredLength," chars is required but got only ").concat(e.actualLength)},maxlength:function(e){return"Max chars allowed is ".concat(e.requiredLength," but got ").concat(e.actualLength)},pattern:function(e){return""+i.PATTERN_ERROR_MESSAGE[e.requiredPattern]},email:function(){return"Enter valid email address of format test@mail.com"}}}return i(t,[{key:"ngOnInit",value:function(){}},{key:"shouldShowErrors",value:function(){return this.ctrl&&this.ctrl.errors&&this.ctrl.touched}},{key:"listOfErrors",value:function(){var e=this;return Object.keys(this.ctrl.errors).map((function(t){return e.ERROR_MESSAGE[t](e.ctrl.getError(t))}))}}]),t}();return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=o.Hb({type:t,selectors:[["app-show-errors"]],inputs:{ctrl:"ctrl"},decls:1,vars:1,consts:[[4,"ngIf"],[4,"ngFor","ngForOf"]],template:function(e,t){1&e&&o.Pc(0,c,2,1,"div",0),2&e&&o.mc("ngIf",t.shouldShowErrors())},directives:[a.o,a.n],styles:["small[_ngcontent-%COMP%]{color:red}"]}),t}()},seMb:function(t,i,n){"use strict";n.d(i,"a",(function(){return a}));var r=n("3Pt+"),o=n("fXoL"),a=function(){var t=function t(){e(this,t),this.emailPattern="^[a-z0-9._%+-]+@[a-z0-9.-]+\\.[a-z]{3,4}$",this.nameValidators=r.y.compose([r.y.required,r.y.minLength(1),r.y.maxLength(256)]),this.optionalNameValidators=r.y.compose([r.y.minLength(1),r.y.maxLength(256),r.y.pattern(/^[a-zA-Z ]*$/)]),this.emailValidators=r.y.compose([r.y.required,r.y.pattern(this.emailPattern)]),this.mobileNumberValidators=r.y.compose([r.y.required,r.y.pattern(/^[0-9]*$/)]),this.addressValidators=r.y.compose([r.y.required,r.y.minLength(1),r.y.maxLength(256),r.y.pattern(/^[a-zA-Z0-9 ]*$/)]),this.subjectValidator=r.y.compose([r.y.required,r.y.minLength(1),r.y.maxLength(1e3),r.y.pattern(/^[a-zA-Z0-9 ]*$/)]),this.optionsAddressValidators=r.y.compose([r.y.minLength(1),r.y.maxLength(256),r.y.pattern(/^[a-zA-Z0-9 ]*$/)]),this.postalCodeValidators=r.y.compose([r.y.pattern(/^[a-zA-Z0-9]*$/)]),this.requiredAlphanumericNoSpaces=r.y.compose([r.y.required,r.y.minLength(1),r.y.maxLength(256),r.y.pattern(/^[a-zA-Z0-9]*$/)]),this.passwordValidators=r.y.compose([r.y.required,r.y.minLength(8)])};return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=o.Jb({token:t,factory:t.\u0275fac,providedIn:"root"}),t}()}}])}();