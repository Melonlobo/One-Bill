!function(){function t(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=i(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var l=0,a=function(){};return{s:a,n:function(){return l>=t.length?{done:!0}:{done:!1,value:t[l++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,r=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return r=t.done,t},e:function(t){s=!0,o=t},f:function(){try{r||null==n.return||n.return()}finally{if(s)throw o}}}}function e(t){return function(t){if(Array.isArray(t))return n(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||i(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,e){if(t){if("string"==typeof t)return n(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?n(t,e):void 0}}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function o(t,e,i){return e&&a(t.prototype,e),i&&a(t,i),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{"6GKC":function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));var n=i("KHMF"),a=i("fXoL"),r=function(){var t=function(){function t(e){l(this,t),this.el=e,this.roundOffFormat="",this.decimalPlaces=0,this.keyString="Decimal",this.regex=new RegExp(/^\d*\.?\d{0,2}$/g),this.specialKeys=["Backspace","Tab","End","Home","-","ArrowLeft","ArrowRight","Del","Delete"],this.roundOffFormat=Object(n.e)("RoundOff"),this.decimalPlaces=parseInt(this.roundOffFormat.substring(this.roundOffFormat.indexOf("-")+1,this.roundOffFormat.length))}return o(t,[{key:"onKeyDown",value:function(t){if(this.regex=new RegExp("^\\d*\\.?\\d{0,"+this.decimalPlaces+"}$"),-1===this.specialKeys.indexOf(t.key)){var e=this.el.nativeElement.value,i=this.el.nativeElement.selectionStart,n=[e.slice(0,i),t.key===this.keyString||t.key===this.keyString.toLowerCase()?".":t.key,e.slice(i)].join("");n&&!String(n).match(this.regex)&&t.preventDefault()}}}]),t}();return t.\u0275fac=function(e){return new(e||t)(a.Nb(a.l))},t.\u0275dir=a.Ib({type:t,selectors:[["","furyValidateDecimalPlacesDirective",""]],hostBindings:function(t,e){1&t&&a.bc("keydown",(function(t){return e.onKeyDown(t)}))}}),t}()},YaQ2:function(t,e,i){"use strict";i.d(e,"a",(function(){return c}));var n=i("fXoL"),a=i("ofXK");function r(t,e){if(1&t&&(n.Tb(0,"small"),n.Rc(1),n.Ob(2,"br"),n.Sb()),2&t){var i=e.$implicit;n.Cb(1),n.Tc(" ",i," ")}}function s(t,e){if(1&t&&(n.Tb(0,"div"),n.Pc(1,r,3,1,"small",1),n.Sb()),2&t){var i=n.fc();n.Cb(1),n.mc("ngForOf",i.listOfErrors())}}var c=function(){var t=function(){function t(){var e=this;l(this,t),this.PATTERN_ERROR_MESSAGE={"/^[a-zA-Z ]*$/":"Accepts only alphabets with spaces","/^[a-zA-Z0-9]*$/":"Accepts only alphanumeric values with no spaces","/^[a-zA-Z0-9 ]*$/":"Accepts only alphanumeric values with spaces","/^[0-9]*$/":"Accepts only numbers","^[a-z0-9._%+-]+@[a-z0-9.-]+\\.[a-z]{3,4}$":"Enter valid email address of format test@mail.com"},this.ERROR_MESSAGE={required:function(){return"This field is required"},minlength:function(t){return"Min ".concat(t.requiredLength," chars is required but got only ").concat(t.actualLength)},maxlength:function(t){return"Max chars allowed is ".concat(t.requiredLength," but got ").concat(t.actualLength)},pattern:function(t){return""+e.PATTERN_ERROR_MESSAGE[t.requiredPattern]},email:function(){return"Enter valid email address of format test@mail.com"}}}return o(t,[{key:"ngOnInit",value:function(){}},{key:"shouldShowErrors",value:function(){return this.ctrl&&this.ctrl.errors&&this.ctrl.touched}},{key:"listOfErrors",value:function(){var t=this;return Object.keys(this.ctrl.errors).map((function(e){return t.ERROR_MESSAGE[e](t.ctrl.getError(e))}))}}]),t}();return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=n.Hb({type:t,selectors:[["app-show-errors"]],inputs:{ctrl:"ctrl"},decls:1,vars:1,consts:[[4,"ngIf"],[4,"ngFor","ngForOf"]],template:function(t,e){1&t&&n.Pc(0,s,2,1,"div",0),2&t&&n.mc("ngIf",e.shouldShowErrors())},directives:[a.o,a.n],styles:["small[_ngcontent-%COMP%]{color:red}"]}),t}()},"a+RD":function(t,e,i){"use strict";i.d(e,"a",(function(){return T}));var n=i("fXoL"),a=i("xgIS"),r=i("/uUt"),s=i("Kj3r"),c=i("ofXK"),u=i("STbY"),d=i("XiUz"),m=i("NFeN"),f=i("bTqV"),h=i("bSwM"),b=i("3Pt+"),p=["filter"];function g(t,e){if(1&t&&(n.Tb(0,"button",12),n.Tb(1,"mat-icon"),n.Rc(2,"filter_list"),n.Sb(),n.Sb()),2&t){n.fc(2);var i=n.Ac(3);n.mc("matMenuTriggerFor",i)}}function v(t,e){if(1&t&&(n.Tb(0,"div",5),n.Tb(1,"div",6),n.Rc(2),n.Sb(),n.Tb(3,"div",7),n.Tb(4,"mat-icon",8),n.Rc(5,"search"),n.Sb(),n.Ob(6,"input",9,10),n.Sb(),n.Pc(8,g,3,1,"button",11),n.kc(9,1),n.Sb()),2&t){var i=n.fc();n.Cb(2),n.Sc(i.name),n.Cb(6),n.mc("ngIf",!i.hideFilter)}}function y(t,e){if(1&t){var i=n.Ub();n.Tb(0,"button",13),n.bc("click",(function(t){n.Ec(i);var l=e.$implicit;return n.fc().toggleColumnVisibility(l,t)})),n.Tb(1,"mat-checkbox",14,15),n.bc("ngModelChange",(function(t){return n.Ec(i),e.$implicit.visible=t}))("click",(function(t){return n.Ec(i),t.stopPropagation()})),n.Rc(3),n.Sb(),n.Sb()}if(2&t){var l=e.$implicit;n.Cb(1),n.mc("ngModel",l.visible),n.Cb(2),n.Tc(" ",l.name," ")}}var C=["*",[["",8,"actions"]]],S=["*",".actions"],T=function(){var t=function(){function t(){l(this,t),this.filterChange=new n.o}return o(t,[{key:"ngAfterViewInit",value:function(){var t=this;this.hideHeader||Object(a.a)(this.filter.nativeElement,"keyup").pipe(Object(r.a)(),Object(s.a)(150)).subscribe((function(){t.filterChange.emit(t.filter.nativeElement.value)}))}},{key:"toggleColumnVisibility",value:function(t,e){e.stopPropagation(),e.stopImmediatePropagation(),t.visible=!t.visible}}]),t}();return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=n.Hb({type:t,selectors:[["fury-list"]],viewQuery:function(t,e){var i;1&t&&n.Vc(p,!0),2&t&&n.zc(i=n.cc())&&(e.filter=i.first)},inputs:{name:"name",columns:"columns",hideHeader:"hideHeader",hideFilter:"hideFilter"},outputs:{filterChange:"filterChange"},ngContentSelectors:S,decls:6,vars:2,consts:[[1,"fury-list-table"],["class","fury-list-header","fxLayout","row","fxLayoutAlign","start center","fxLayoutGap","8px","fxLayoutGap.gt-xs","24px",4,"ngIf"],["yPosition","below","xPosition","before"],["columnFilter","matMenu"],["class","checkbox-item mat-menu-item",3,"click",4,"ngFor","ngForOf"],["fxLayout","row","fxLayoutAlign","start center","fxLayoutGap","8px","fxLayoutGap.gt-xs","24px",1,"fury-list-header"],[1,"fury-list-name"],["fxLayout","row","fxLayoutAlign","start center","fxFlex",""],[1,"fury-filter-input-icon"],["fxFlex","","placeholder","Search\u2026",1,"fury-filter-input"],["filter",""],["class","fury-column-filter","type","button","mat-icon-button","",3,"matMenuTriggerFor",4,"ngIf"],["type","button","mat-icon-button","",1,"fury-column-filter",3,"matMenuTriggerFor"],[1,"checkbox-item","mat-menu-item",3,"click"],[1,"checkbox",3,"ngModel","ngModelChange","click"],["checkbox",""]],template:function(t,e){1&t&&(n.lc(C),n.Tb(0,"div",0),n.Pc(1,v,10,2,"div",1),n.Tb(2,"mat-menu",2,3),n.Pc(4,y,4,2,"button",4),n.Sb(),n.kc(5),n.Sb()),2&t&&(n.Cb(1),n.mc("ngIf",!e.hideHeader),n.Cb(3),n.mc("ngForOf",e.columns))},directives:[c.o,u.e,c.n,d.d,d.c,d.e,d.b,m.a,f.a,u.d,h.a,b.q,b.t],styles:[".fury-list-table{display:flex;flex-direction:column}.fury-list-table .fury-list-header{padding-left:24px;padding-right:24px;height:64px;border-top-left-radius:8px;border-top-right-radius:8px}@media screen and (max-width:599px){.fury-list-table .fury-list-header{height:auto;padding-top:24px;padding-bottom:24px}}.fury-list-table .fury-list-header .fury-list-name{font-size:20px;line-height:32px;font-weight:500;padding-right:24px}@media screen and (max-width:599px){.fury-list-table .fury-list-header .fury-list-name{border-right:none}}.fury-list-table .fury-list-header .fury-filter-input{font-size:16px;line-height:1.125;border:none;height:32px}.fury-list-table .fury-list-header .fury-filter-input:focus{outline:none}.fury-list-table .fury-list-header .fury-filter-input-icon{width:1.2em;vertical-align:bottom;height:22px;font-size:22px;margin-right:8px}.fury-list-table table{width:100%}.fury-list-table .mat-header-row .mat-header-cell .mat-sort-header-button{text-transform:uppercase}.fury-list-table .mat-cell.image-cell,.fury-list-table .mat-header-cell.image-cell{flex:0;width:59px}.fury-list-table .mat-cell.image-cell img,.fury-list-table .mat-header-cell.image-cell img{border-radius:50%;height:35px;width:35px;margin-right:24px;vertical-align:middle}.fury-list-table .mat-cell,.fury-list-table .mat-header-cell{white-space:nowrap;padding-left:12px;padding-right:12px}.fury-list-table .mat-cell.actions-cell,.fury-list-table .mat-header-cell.actions-cell{flex:0;width:40px;overflow:visible}.fury-list-table .paginator{display:block}"],encapsulation:2}),t}()},pf8y:function(i,n,a){"use strict";a.r(n),a.d(n,"CreateContractModule",(function(){return We}));var r=a("ofXK"),s=a("3Pt+"),c=a("q8Jb"),u=a("0jmt"),d=a("KthW"),m=a("tyNb"),f=a("mrSG"),h=a("M9IT"),b=a("Dh3D"),p=a("+0xr"),g=a("jtHE"),v=a("pLZG"),y=a("Ku73"),C=a("nStZ"),S=a("3R10"),T=function t(e){l(this,t),this.id=e.id||0,this.contractId=e.contractId||0,this.ownerId=e.ownerId||0,this.utilityTypeId=e.utilityTypeId||"",this.utilityType=e.utilityType||"",this.groupId=e.groupId||"",this.meterNumber=e.meterNumber||"",this.meterId=e.meterId||0,this.isDifferenciateConsumption=e.isDifferenciateConsumption||!1},D=function t(e){l(this,t),this.id=e.id||0,this.clientId=e.clientId||0,this.contractNumber=e.contractNumber||"",this.contractDate=e.contractDate||"",this.tenantId=e.tenantId||0,this.tenantName=e.tenantName||"",this.unitId=e.unitId||0,this.unitNumber=e.unitNumber||"",this.utilityTypeId=e.utilityTypeId||0,this.utilityType=e.utilityType||"",this.contractTypeId=e.contractTypeId||0,this.contractType=e.contractType||"",this.contractEndDate=e.contractEndDate||null,this.contractSuspendDate=e.contractSuspendDate||null,this.reasonForContractEnd=e.reasonForContractEnd||"",this.accountNumber=e.accountNumber||"",this.type=e.type||"",this.mode=e.mode||"create",this.securityDeposit=e.securityDeposit||0,this.receivedAmount=e.receivedAmount||0,this.remainingAmount=e.remainingAmount||0,this.refundAmount=e.refundAmount||0,this.previousDueAmount=e.previousDueAmount||0,this.isSecurityDepositPaid=e.isSecurityDepositPaid||!1,this.isGroupBill=e.isGroupBill||!1,this.status=e.status||"",this.isSuspended=e.isSuspended||!1,this.isAssignToOwner=e.isAssignToOwner||!1,this.isDeleted=e.isDeleted||!1,this.contractReActivatedDate=e.contractReActivatedDate||null,this.billMasters=e.billMasters||[],this.ownerBillGroups=(e.ownerBillGroups||[]).map((function(t){return new T(t)})),this.contractTransactions=e.contractTransactions||[],this.checkDues=!0},P=a("0IaG"),w=a("ERz2"),x=a("m6b6"),k=a("zSPf"),A=a("tB66"),R=a("xXXn"),F=a("KHMF"),I=a("fXoL"),N=a("b6Qw"),M=a("/t3+"),O=a("bTqV"),W=a("NFeN"),U=a("MutI"),E=a("4FRi"),L=a("XiUz"),z=a("kmnG"),B=a("qFsG"),j=a("iadO"),G=a("YaQ2"),Y=a("/1cH"),H=a("bSwM"),V=a("6GKC"),$=a("d3UM"),_=a("FKr1"),X=a("dUAH"),q=["allSelected"];function K(t,e){if(1&t&&(I.Tb(0,"mat-option",58),I.Rc(1),I.Sb()),2&t){var i=e.$implicit;I.mc("value",i.description),I.Cb(1),I.Tc(" ",i.description," ")}}function Q(t,e){if(1&t&&(I.Tb(0,"mat-option",58),I.Rc(1),I.Sb()),2&t){var i=e.$implicit;I.mc("value",i.description),I.Cb(1),I.Tc(" ",i.description," ")}}function Z(t,e){if(1&t&&(I.Tb(0,"small"),I.Rc(1),I.Sb()),2&t){var i=I.fc();I.Cb(1),I.Tc("Contract ",i.type," date should be greater than Contract date.")}}function J(t,e){if(1&t&&(I.Tb(0,"mat-option",58),I.Rc(1),I.Sb()),2&t){var i=e.$implicit;I.mc("value",i.description),I.Cb(1),I.Tc(" ",i.description," ")}}function tt(t,e){if(1&t){var i=I.Ub();I.Tb(0,"div",59),I.Tb(1,"mat-checkbox",60),I.bc("change",(function(t){return I.Ec(i),I.fc().enableAssignToOwnerCheckChanged(t)})),I.Rc(2," Assign To Owner "),I.Sb(),I.Sb()}}function et(t,e){if(1&t){var i=I.Ub();I.Tb(0,"mat-option",37),I.bc("click",(function(){I.Ec(i);var t=I.fc(),e=I.Ac(110);return t.togglePerOne(e.viewValue)})),I.Rc(1),I.Sb()}if(2&t){var n=e.$implicit;I.mc("value",n.id),I.Cb(1),I.Tc(" ",n.utilityType," ")}}function it(t,e){1&t&&(I.Tb(0,"small"),I.Rc(1,"UtilityType already added"),I.Sb())}function nt(t,e){1&t&&(I.Tb(0,"mat-hint",61),I.Rc(1,"Bill Group Number should be same for all Utilities since Group Bill with other units check box is checked."),I.Sb())}function lt(t,e){1&t&&(I.Tb(0,"mat-hint",61),I.Rc(1,"Either Map all Utilities with Bill Group or leave all Unmapped."),I.Sb())}function at(t,e){if(1&t&&(I.Tb(0,"th",66),I.Rc(1),I.Sb()),2&t){var i=I.fc(2).$implicit;I.Cb(1),I.Tc(" ",i.name," ")}}function ot(t,e){if(1&t&&(I.Tb(0,"td",67),I.Rc(1),I.Sb()),2&t){var i=e.$implicit,n=I.fc(2).$implicit;I.Cb(1),I.Tc(" ",i[n.property]," ")}}function rt(t,e){if(1&t&&(I.Rb(0,63),I.Pc(1,at,2,1,"th",64),I.Pc(2,ot,2,1,"td",65),I.Qb()),2&t){var i=I.fc().$implicit;I.mc("matColumnDef",i.property)}}function st(t,e){if(1&t&&(I.Rb(0),I.Pc(1,rt,3,1,"ng-container",62),I.Qb()),2&t){var i=e.$implicit;I.Cb(1),I.mc("ngIf",i.isModelProperty)}}function ct(t,e){1&t&&I.Ob(0,"th",68)}function ut(t,e){1&t&&(I.Tb(0,"mat-icon",71),I.Rc(1,"delete"),I.Sb())}function dt(t,e){if(1&t){var i=I.Ub();I.Tb(0,"td",69),I.bc("click",(function(){I.Ec(i);var t=e.$implicit;return I.fc().deleteOwnerBillGroup(t)})),I.Pc(1,ut,2,0,"mat-icon",70),I.Sb()}if(2&t){var n=I.fc();I.Cb(1),I.mc("ngIf","delete"!=n.mode)}}function mt(t,e){1&t&&I.Ob(0,"tr",72)}function ft(t,e){1&t&&I.Ob(0,"tr",73)}function ht(t,e){1&t&&(I.Tb(0,"mat-label"),I.Rc(1,"Reason for Contract Suspend"),I.Sb())}function bt(t,e){1&t&&I.Ob(0,"textarea",75)}function pt(t,e){if(1&t&&(I.Tb(0,"mat-form-field",35),I.Pc(1,ht,2,0,"mat-label",23),I.Pc(2,bt,1,0,"textarea",74),I.Sb()),2&t){var i=I.fc();I.Cb(1),I.mc("ngIf",i.isDeleteMode()),I.Cb(1),I.mc("ngIf",i.isDeleteMode())}}function gt(t,e){if(1&t&&(I.Tb(0,"button",76),I.Rc(1,"CREATE CONTRACT"),I.Sb()),2&t){var i=I.fc();I.mc("disabled",!i.form.valid||1==i.billGroupMsg||(null==i.selectedUserUtilities?null:i.selectedUserUtilities.length)>0&&(null==i.selectedUserUtilities?null:i.selectedUserUtilities.length)!=(null==i.metadataUtilityTypes?null:i.metadataUtilityTypes.length))}}function vt(t,e){if(1&t&&(I.Tb(0,"button",77),I.Rc(1,"UPDATE CONTRACT"),I.Sb()),2&t){var i=I.fc();I.mc("disabled",!i.form.valid||1==i.billGroupMsg||(null==i.selectedUserUtilities?null:i.selectedUserUtilities.length)>0&&(null==i.selectedUserUtilities?null:i.selectedUserUtilities.length)!=(null==i.metadataUtilityTypes?null:i.metadataUtilityTypes.length))}}function yt(t,e){if(1&t&&(I.Tb(0,"button",76),I.Rc(1,"RENEW CONTRACT"),I.Sb()),2&t){var i=I.fc();I.mc("disabled",!i.form.valid||1==i.billGroupMsg||(null==i.selectedUserUtilities?null:i.selectedUserUtilities.length)>0&&(null==i.selectedUserUtilities?null:i.selectedUserUtilities.length)!=(null==i.metadataUtilityTypes?null:i.metadataUtilityTypes.length))}}function Ct(t,e){if(1&t&&(I.Tb(0,"button",76),I.Rc(1,"SUSPEND CONTRACT"),I.Sb()),2&t){var i=I.fc();I.mc("disabled",!i.form.valid)}}var St,Tt=((St=function(){function i(t,e,n,a,o,r,s,c){l(this,i),this.defaults=t,this.fb=e,this.datePipe=n,this.dialog=a,this.contractService=o,this.masterService=r,this.dialogRef=s,this.cookieService=c,this.securityDepositExist=!1,this.selectedUtilities=[],this.selectedUserUtilities=[],this.selectedDBUtilities=[],this.selectedData=[],this.groupId=1,this.isDuplicate=!1,this.isCancel=!1,this.isAssignToOwner=!1,this.isUtilitiesMapped=!1,this.type="End",this.error={isError:!1,errorMessage:""},this.mode="create",this.isDisabled=!0,this.show=!1,this.subject$=new g.a(1),this.data$=this.subject$.asObservable(),this.billGroupMsg=!1,this.securityDeposit=0,this.receivedAmount=0,this.refundAmount=0,this.currency=Object(F.e)("Currency",0),this.roundFormat=Object(F.e)("RoundOff"),this.displayedColumns=[{name:"Bill Group",property:"groupId",visible:!0,isModelProperty:!0},{name:"Utility TypeId",property:"utilityTypeId",visible:!1,isModelProperty:!0},{name:"Utility Type",property:"utilityType",visible:!0,isModelProperty:!0},{name:"Differentiate Consumption",property:"isDifferenciateConsumption",visible:!0,isModelProperty:!0},{name:"Modify",property:"actions",visible:!0}],this.billGroupSelected=!1,this.defaults&&this.defaults.type&&(this.type=this.defaults.type),s.disableClose=!0}return o(i,[{key:"ngOnInit",value:function(){var t=this;this.clientId=parseInt(this.cookieService.get("globalClientId")),this.defaults?(this.isDisabled=!0,this.selectedUserUtilities=this.selectedDBUtilities=this.defaults.ownerBillGroups):(this.defaults=new D({}),this.isDisabled=!1),this.securityDeposit=this.defaults.securityDeposit,this.receivedAmount=this.defaults.receivedAmount,this.refundAmount=this.defaults.refundAmount,this.clientId=parseInt(this.cookieService.get("globalClientId")),this.contractService.getTenants(this.clientId).subscribe((function(e){t.filteredTenants=t.metadataTenant=e.map((function(t){return new w.a(t)}))})),this.defaults&&this.defaults.unitId&&this.getUtilitiDetails(this.defaults.unitId),this.contractService.getUnits(this.clientId).subscribe((function(e){t.metadataUnit=t.filteredUnits=e.map((function(t){return new x.a(t)})),t.metadataUnit=t.filteredUnits})),this.masterService.getSystemMasterdata(4,0).subscribe((function(e){t.metadataContractType=t.filteredContractTypes=e})),this.form=this.fb.group({id:[this.defaults.id||i.id++],contractDate:[this.defaults.contractDate||"",s.y.required],tenantId:[this.defaults.tenantId||"",s.y.required],tenantName:[this.defaults.tenantName||"",s.y.required],unitId:[this.defaults.unitId||"",s.y.required],unitNumber:[this.defaults.unitNumber||"",s.y.required],utilityType:[""],contractTypeId:[this.defaults.contractTypeId||"",s.y.required],contractType:[this.defaults.contractType||"",s.y.required],contractEndDate:[(this.defaults.contractSuspendDate&&"Suspend"===this.defaults.type?this.defaults.contractSuspendDate:this.defaults.contractEndDate)||"",s.y.required],reasonForContractSuspend:[this.defaults.reasonForContractSuspend||""],accountNumber:[this.defaults.accountNumber||""],isSecurityDepositPaid:[this.defaults.isSecurityDepositPaid||!1],securityDeposit:[this.defaults.securityDeposit||"",s.y.pattern(/^\d*.?\d{0,1}$/g)],receivedAmount:[this.defaults.receivedAmount||0],refundAmount:[this.defaults.refundAmount||0],isAssignToOwner:[this.defaults.isAssignToOwner||!1],isGroupBill:[this.defaults.isGroupBill||!1],isDifferenciateConsumption:[!1],ownerBillGroups:[this.defaults.ownerBillGroups],billGroup:[""]}),this.defaults&&this.defaults.isSecurityDepositPaid&&(this.securityDepositExist=this.defaults.isSecurityDepositPaid),this.selectedData&&0==this.selectedData.length&&this.form.controls.isDifferenciateConsumption.disable(),this.validateSecurityDeposit(this.securityDepositExist),this.defaults&&(this.billGroupSelected=this.form.controls.isGroupBill.value,"update"===this.defaults.mode?(this.form.get("contractDate").disable(),this.form.get("contractEndDate").disable(),this.form.get("receivedAmount").disable(),this.form.get("refundAmount").disable(),this.mode="update",this.securityDepositExist=this.defaults.isSecurityDepositPaid):"renew"===this.defaults.mode?(this.form.get("tenantName").disable(),this.form.get("unitNumber").disable(),this.form.get("contractType").disable(),this.form.get("accountNumber").disable(),this.form.get("receivedAmount").disable(),this.form.get("refundAmount").disable(),this.securityDepositExist=this.defaults.isSecurityDepositPaid,this.mode="renew"):"delete"===this.defaults.mode&&(this.isAssignToOwner=this.defaults.isAssignToOwner,this.form.get("contractEndDate").setValue(new Date),this.form.get("contractEndDate").disable(),this.form.get("contractDate").disable(),this.form.get("tenantName").disable(),this.form.get("unitNumber").disable(),this.form.get("utilityType").disable(),this.form.get("contractType").disable(),this.form.get("receivedAmount").disable(),this.form.get("refundAmount").disable(),this.form.get("accountNumber").disable(),this.form.get("isSecurityDepositPaid").disable(),this.form.get("securityDeposit").disable(),this.form.get("isGroupBill").disable(),this.form.get("billGroup").disable(),this.form.get("isDifferenciateConsumption").disable(),this.securityDepositExist=this.defaults.isSecurityDepositPaid,this.mode="delete",this.fb.group({reasonForContractSuspend:[this.defaults.reasonForContractSuspend||""]}))),this.show=!1,this.subject$.next(this.selectedUserUtilities),this.dataSource=new p.k(this.selectedUserUtilities),this.data$.pipe(Object(v.a)((function(t){return!!t}))).subscribe((function(e){t.selectedUtilities=e,t.dataSource.data=e})),this.form.controls.tenantName.valueChanges.subscribe((function(e){t.filteredTenants=t.filterTenant(e)})),this.form.controls.unitNumber.valueChanges.subscribe((function(e){t.filteredUnits=t.filterUnit(e)})),this.form.controls.contractType.valueChanges.subscribe((function(e){t.filteredContractTypes=t.filterContractType(e)}))}},{key:"getTenants",value:function(){this.filteredTenants=this.filterTenant("")}},{key:"filterTenant",value:function(t){return this.form.controls.tenantName.pristine&&"create"!=this.mode?[]:this.metadataTenant.filter((function(e){return 0===e.description.toLowerCase().indexOf(t.toLowerCase())}))}},{key:"filterUnit",value:function(t){return this.metadataUnit.filter((function(e){return 0===e.description.toLowerCase().indexOf(t.toLowerCase())}))}},{key:"filterContractType",value:function(t){return this.metadataContractType.filter((function(e){return 0===e.description.toLowerCase().indexOf(t.toLowerCase())}))}},{key:"getUtilitiDetails",value:function(t){var e=this;this.contractService.getUtilityDetails(this.clientId,t).subscribe((function(t){e.metadataUtilityTypes=e.filteredUtilityTypes=t}))}},{key:"amountInputChanged",value:function(t){var e=t.replace(",","");return Number(e)}},{key:"save",value:function(){var t=this;this.isCancel?(this.isCancel=!1,this.dialog.open(R.a,{data:{label:"Are you sure you want to Cancel?",selected:!1}}).afterClosed().subscribe((function(e){e&&t.dialogRef.close()}))):"create"===this.mode?this.createContract():"update"!==this.mode&&"renew"!==this.mode&&"delete"!==this.mode||this.updateContract()}},{key:"createContract",value:function(){Object.assign(this.defaults,this.form.value),this.defaults.contractDate=this.datePipe.transform(this.defaults.contractDate,"yyyy-MM-dd"),this.defaults.contractEndDate=this.datePipe.transform(this.defaults.contractEndDate,"yyyy-MM-dd"),this.defaults.securityDeposit=1==this.securityDepositExist?this.form.get("securityDeposit").value:0,this.defaults.ownerBillGroups=this.selectedDBUtilities,this.defaults.clientId=this.clientId,this.defaults.securityDeposit=parseFloat(""==this.form.controls.securityDeposit.value?"0":this.form.controls.securityDeposit.value),this.defaults.receivedAmount=parseFloat(""==this.form.controls.receivedAmount.value?"0":this.form.controls.receivedAmount.value),this.defaults.refundAmount=parseFloat(""==this.form.controls.refundAmount.value?"0":this.form.controls.refundAmount.value),this.dialogRef.close(new D(this.defaults))}},{key:"updateContract",value:function(){Object.assign(this.defaults,this.form.value),this.defaults.contractDate=this.datePipe.transform(this.defaults.contractDate,"yyyy-MM-dd"),this.defaults.contractSuspendDate&&(this.defaults.contractSuspendDate=this.datePipe.transform(this.defaults.contractSuspendDate,"yyyy-MM-dd")),this.defaults.contractEndDate&&(this.defaults.contractDate=this.datePipe.transform(this.defaults.contractDate,"yyyy-MM-dd")),this.defaults.mode=this.mode,this.defaults.securityDeposit=1==this.securityDepositExist?parseFloat(this.form.get("securityDeposit").value.replace(",","")):0,this.defaults.ownerBillGroups=this.selectedDBUtilities,this.defaults.clientId=this.clientId,this.defaults.securityDeposit=parseFloat(""==this.form.controls.securityDeposit.value?"0":this.form.controls.securityDeposit.value),this.defaults.receivedAmount=parseFloat(""==this.form.controls.receivedAmount.value?"0":this.form.controls.receivedAmount.value),this.defaults.refundAmount=parseFloat(""==this.form.controls.refundAmount.value?"0":this.form.controls.refundAmount.value),this.dialogRef.close(this.defaults)}},{key:"isCreateMode",value:function(){return"create"===this.mode}},{key:"isUpdateMode",value:function(){return"update"===this.mode}},{key:"isRenewMode",value:function(){return"renew"===this.mode}},{key:"isDeleteMode",value:function(){return"delete"===this.mode}},{key:"selectTenant",value:function(t){var e=this;this.metadataTenant.forEach((function(i){t.option.value==i.description&&e.form.controls.tenantId.setValue(i.id)}))}},{key:"selectUnit",value:function(t){var e=this;this.metadataUnit.forEach((function(i){t.option.value==i.description&&(e.form.controls.unitId.setValue(i.id),e.onUnitSelect(i.id))}))}},{key:"selectUtilityType",value:function(t){var e=this;this.metadataUtilityTypes.forEach((function(i){t.option.value==i.utilityType&&e.form.controls.utilityTypeId.setValue(i.id)}))}},{key:"selectContractType",value:function(t){var e=this;this.metadataContractType.forEach((function(i){t.option.value==i.description&&e.form.controls.contractTypeId.setValue(i.id)}))}},{key:"onUnitSelect",value:function(t){var e=this;this.contractService.getSecurityDeposit(t).subscribe((function(t){0!=t&&e.form.controls.securityDeposit.setValue(t),0==e.form.controls.isSecurityDepositPaid.value&&e.form.get("securityDeposit").disable()})),this.getUtilitiDetails(t)}},{key:"toggleSecurityDeposit",value:function(t){this.securityDepositExist=!t,this.validateSecurityDeposit(this.securityDepositExist)}},{key:"validateSecurityDeposit",value:function(t){t?(this.form.get("securityDeposit").enable(),this.form.get("securityDeposit").setValidators([s.y.required]),this.form.get("securityDeposit").updateValueAndValidity()):(this.form.get("securityDeposit").setValue(""),this.form.get("securityDeposit").clearValidators(),this.form.get("securityDeposit").updateValueAndValidity(),this.form.get("securityDeposit").disable())}},{key:"validateDates",value:function(){this.startDate=this.datePipe.transform(this.form.get("contractDate").value,"MM-dd-yyyy"),this.endDate=this.datePipe.transform(this.form.get("contractEndDate").value,"MM-dd-yyyy"),this.isValidDate=!0;var t=new Date(this.startDate).getFullYear(),e=new Date(this.endDate).getFullYear();return 1970==t||1970==e||t<e?this.isValidDate:t>e?(this.isValidDate=!1,this.isValidDate):null==this.startDate&&""==this.startDate||null==this.endDate&&""==this.endDate?void 0:(this.endDate<=this.startDate&&(this.isValidDate=!1),this.isValidDate)}},{key:"deleteOwnerBillGroup",value:function(t){var e=this;this.dialog.open(A.a).afterClosed().subscribe((function(i){if(i){if(1==t.isDifferenciateConsumption){var n=e.selectedUserUtilities.findIndex((function(e){return e.isDifferenciateConsumption===t.isDifferenciateConsumption&&e.groupId==t.groupId}));n>-1&&e.selectedUserUtilities.splice(n,2)}else e.selectedUserUtilities.splice(e.selectedUserUtilities.findIndex("create"==e.mode?function(e){return e.meterId===t.meterId}:function(e){return e.utilityType===t.utilityType}),1);e.isDuplicate=!1,e.subject$.next(e.selectedUserUtilities),e.enableorDisableBillGroup(),e.checkUtilityMapping()}}))}},{key:"enableorDisableBillGroup",value:function(){var t=this;this.selectedUserUtilities&&this.selectedUserUtilities.forEach((function(e){var i=t.selectedUserUtilities.filter((function(t){return t.groupId!=e.groupId}));i&&i.length>0?t.form.controls.isGroupBill.disable():t.form.controls.isGroupBill.enable()}))}},{key:"toggleAllSelection",value:function(){this.form.controls.utilityType.patchValue(this.allSelected.selected?[].concat(e(this.metadataUtilityTypes.map((function(t){return t.id}))),[0]):[])}},{key:"togglePerOne",value:function(){this.allSelected.selected&&this.allSelected.deselect();var t=this.selectedData.text.replace(/\s/g,"").split(",");if("Select All"==t[0]&&(t=t.splice(1)),this.form.controls.isDifferenciateConsumption.enable(),t&&1==t.length)this.form.controls.isDifferenciateConsumption.setValue(!1),this.form.controls.isDifferenciateConsumption.disable();else if(t&&t.length>2)this.form.controls.isDifferenciateConsumption.setValue(!1),this.form.controls.isDifferenciateConsumption.disable();else if(t&&2==t.length){var e=t.filter((function(e){return e.substring(0,e.indexOf("-"))!=t[0].substring(0,t[0].indexOf("-"))}));e&&e.length>0&&(this.form.controls.isDifferenciateConsumption.setValue(!1),this.form.controls.isDifferenciateConsumption.disable())}this.form.controls.utilityType.value.length==this.metadataUtilityTypes.length&&this.allSelected.select()}},{key:"validateDifferenciateConsumption",value:function(){var t=this;this.validateBillGroup();var e=this.selectedData.text.replace(/\s/g,"").split(",");"Select All"==e[0]&&(e=e.splice(1));var i=e.filter((function(t){return t.substring(0,t.indexOf("-"))==e[0].substring(0,e[0].indexOf("-"))})),n=this.selectedUserUtilities.filter((function(e){return 1==e.isDifferenciateConsumption&&t.billGroupId==e.groupId}));n&&n.length>0?(this.form.controls.isDifferenciateConsumption.setValue(!1),this.form.controls.isDifferenciateConsumption.disable()):2==i.length&&2==e.length&&(this.form.controls.isDifferenciateConsumption.setValue(!1),this.form.controls.isDifferenciateConsumption.enable())}},{key:"selectedValue",value:function(t){this.selectedData={value:t.value,text:t.source.triggerValue}}},{key:"checkDuplication",value:function(){this.isDuplicate=!1;for(var t=0;t<this.selectedDBUtilities.length;t++)if(this.selectedUtilities.indexOf(this.selectedDBUtilities[t].meterId)>=0)return this.isDuplicate=!0,this.isDuplicate;return this.isDuplicate}},{key:"addBillGroup",value:function(){var t,e,i,n,l,a=this;if(this.selectedUtilities.length>0&&this.billGroupId>0&&null!=this.billGroupId&&null!=this.billGroupId&&!this.checkDuplication()){null===(t=this.selectedData)||void 0===t||t.text.split(",");for(var o=function(t){0!=a.selectedUtilities[t]&&a.selectedDBUtilities.push({meterId:a.selectedUtilities[t],utilityTypeId:null===(i=null===(e=a.filteredUtilityTypes)||void 0===e?void 0:e.find((function(e){return e.id===a.selectedUtilities[t]})))||void 0===i?void 0:i.utilityTypeId,utilityType:null===(l=null===(n=a.filteredUtilityTypes)||void 0===n?void 0:n.find((function(e){return e.id===a.selectedUtilities[t]})))||void 0===l?void 0:l.utilityType,ownerId:a.form.controls.tenantId.value,groupId:a.billGroupId,isDifferenciateConsumption:1==a.form.controls.isDifferenciateConsumption.value})},r=0;r<this.selectedUtilities.length;++r)o(r);var s=this.form.controls.utilityType.value,c=s.findIndex((function(t){return 0===t}));c>=0&&s.splice(c,1);var u="";this.selectedData.text.indexOf("Select All")>=0?(this.metadataUtilityTypes.forEach((function(t){u+=t.utilityType+","})),u=u.substr(0,u.length-1)):u=this.selectedData.text,this.selectedUserUtilities=this.selectedDBUtilities,this.enableorDisableBillGroup(),this.subject$.next(this.selectedUserUtilities),this.form.controls.utilityType.reset(),this.form.controls.billGroup.reset(),this.form.controls.isDifferenciateConsumption.reset(),this.selectedUtilities=null,this.checkUtilityMapping()}}},{key:"checkUtilityMapping",value:function(){var t,e,i;this.isUtilitiesMapped=(null===(t=this.selectedUserUtilities)||void 0===t?void 0:t.length)>0&&(null===(e=this.selectedUserUtilities)||void 0===e?void 0:e.length)!=(null===(i=this.metadataUtilityTypes)||void 0===i?void 0:i.length)}},{key:"enableAssignToOwnerCheckChanged",value:function(t){this.isAssignToOwner=t.checked}},{key:"validateBillGroup",value:function(){var t=this;if(1==this.billGroupSelected&&this.selectedUserUtilities&&null!=this.billGroupId){var e=this.selectedUserUtilities.filter((function(e){return e.groupId!=t.billGroupId}));e&&e.length>0&&(this.billGroupMsg=!0)}else this.billGroupMsg=!1}},{key:"checkValue",value:function(){this.billGroupSelected=this.form.controls.isGroupBill.value,this.validateBillGroup()}},{key:"close",value:function(){this.dialogRef.close()}},{key:"closeDialog",value:function(){this.isCancel=!0}},{key:"searchContractType",value:function(t){var e=this.selectFilteredContractType(t.toLowerCase());this.filteredContractTypes=e}},{key:"selectFilteredContractType",value:function(e){var i=[];if(!e)return this.metadataContractType;var n,l=t(this.metadataContractType);try{for(l.s();!(n=l.n()).done;){var a=n.value;a.description.toLowerCase().indexOf(e)>-1&&i.push(a)}}catch(o){l.e(o)}finally{l.f()}return i}},{key:"visibleColumns",get:function(){return this.displayedColumns.filter((function(t){return t.visible})).map((function(t){return t.property}))}}]),i}()).id=100,St.\u0275fac=function(t){return new(t||St)(I.Nb(P.a),I.Nb(s.f),I.Nb(r.f),I.Nb(P.b),I.Nb(S.a),I.Nb(k.a),I.Nb(P.h),I.Nb(N.a))},St.\u0275cmp=I.Hb({type:St,selectors:[["contract-create-update"]],viewQuery:function(t,e){var i;1&t&&I.Vc(q,!0),2&t&&I.zc(i=I.cc())&&(e.allSelected=i.first)},inputs:{displayedColumns:"displayedColumns"},decls:146,vars:56,consts:[["mat-dialog-title",""],["role","toolbar",1,"task-header"],[1,"fx-spacer"],["mat-icon-button","",3,"click"],["title","Close","mat-list-icon",""],[3,"formGroup","ngSubmit"],[1,"mat-dlg-content"],[1,"person"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","20px"],["fxFlex","33%"],["id","txtContractDate","formControlName","contractDate","matInput","",3,"matDatepicker","disabled","click"],["matSuffix","",3,"for"],["formDatepickerRef",""],[3,"ctrl"],["matInput","","formControlName","tenantName",3,"matAutocomplete","click"],[3,"optionSelected"],["tenant","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["matInput","","formControlName","unitNumber",3,"matAutocomplete"],["unit","matAutocomplete"],[1,"person","padding-top"],["formControlName","contractEndDate","matInput","",3,"matDatepicker","click"],["formDatepickerRef1",""],[4,"ngIf"],["matInput","","formControlName","contractType",3,"matAutocomplete","keydown"],["contractType","matAutocomplete"],["type","text","formControlName","accountNumber","maxlength","48","matInput","","id","accountNumber","oninput","javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"],["fxFlex","33%",1,"formulaLabel"],["color","primary","formControlName","isSecurityDepositPaid",1,"formulaLabel",3,"change"],["fxFlex","31%"],["type","textbox","formControlName","securityDeposit","matInput","","furyValidateDecimalPlacesDirective","",3,"ngModel"],["type","number","formControlName","receivedAmount","readonly","","matInput","","maxlength","7",3,"ngModel"],["type","number","formControlName","refundAmount","readonly","","matInput","","maxlength","7",3,"ngModel"],["class","formulaLabel","fxFlex","25%",4,"ngIf"],["color","primary","formControlName","isGroupBill",1,"isGroupBill",3,"change"],["fxFlex",""],["multiple","","formControlName","utilityType",3,"ngModel","ngModelChange","selectionChange"],[3,"value","click"],["allSelected",""],[3,"value","click",4,"ngFor","ngForOf"],["fxFlex","28%"],["type","number","formControlName","billGroup","matInput","","maxlength","5","placeholder","Bill Group Number",3,"ngModel","ngModelChange","keyup"],["fxLayout","column","fxLayoutGap.gt-sm","20px",2,"padding-top","15px"],["color","primary","formControlName","isDifferenciateConsumption",1,"isDifferenciateConsumption"],["type","button","mat-mini-fab","","color","primary",3,"disabled","click"],["style","color: red;font-size: smaller;",4,"ngIf"],["mat-table","","matSort","","align","center",1,"padding-top",3,"dataSource"],[4,"ngFor","ngForOf"],["matColumnDef","actions"],["class","actions-cell","mat-header-cell","",4,"matHeaderCellDef"],["class","actions-cell","mat-cell","",3,"click",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["class","clickable route-animations-elements","mat-row","",4,"matRowDef","matRowDefColumns"],["fxFlex","",4,"ngIf"],["fxLayout","row","fxLayoutAlign","end center"],["mat-button","",3,"click"],["mat-button","",3,"disabled",4,"ngIf"],["id","button","mat-button","",3,"disabled",4,"ngIf"],[3,"value"],["fxFlex","25%",1,"formulaLabel"],["color","primary","formControlName","isAssignToOwner",1,"formulaLabel",3,"change"],[2,"color","red","font-size","smaller"],[3,"matColumnDef",4,"ngIf"],[3,"matColumnDef"],["mat-header-cell","","mat-sort-header","","style","padding-left: 20px;",4,"matHeaderCellDef"],["mat-cell","","style","padding-left: 20px;",4,"matCellDef"],["mat-header-cell","","mat-sort-header","",2,"padding-left","20px"],["mat-cell","",2,"padding-left","20px"],["mat-header-cell","",1,"actions-cell"],["mat-cell","",1,"actions-cell",3,"click"],["style","margin-left: 20px;","class","deleteIcon",4,"ngIf"],[1,"deleteIcon",2,"margin-left","20px"],["mat-header-row",""],["mat-row","",1,"clickable","route-animations-elements"],["type","text","formControlName","reasonForContractSuspend","matInput","",4,"ngIf"],["type","text","formControlName","reasonForContractSuspend","matInput",""],["mat-button","",3,"disabled"],["id","button","mat-button","",3,"disabled"]],template:function(t,e){if(1&t){var i=I.Ub();I.Tb(0,"div",0),I.Tb(1,"mat-toolbar",1),I.Tb(2,"span"),I.Rc(3,"Contract"),I.Sb(),I.Ob(4,"span",2),I.Tb(5,"button",3),I.bc("click",(function(){return e.close()})),I.Tb(6,"mat-icon",4),I.Rc(7,"close"),I.Sb(),I.Sb(),I.Sb(),I.Sb(),I.Tb(8,"form",5),I.bc("ngSubmit",(function(){return e.save()})),I.Tb(9,"mat-dialog-content",6),I.Tb(10,"fury-card"),I.Tb(11,"fury-card-content"),I.Tb(12,"div",7),I.Tb(13,"div",8),I.Tb(14,"mat-form-field",9),I.Tb(15,"mat-label"),I.Rc(16,"Contract Date"),I.Sb(),I.Tb(17,"input",10),I.bc("click",(function(){return I.Ec(i),I.Ac(20).open()})),I.Sb(),I.Ob(18,"mat-datepicker-toggle",11),I.Ob(19,"mat-datepicker",null,12),I.Ob(21,"app-show-errors",13),I.Tb(22,"mat-hint"),I.Rc(23,"Please select Contract Date"),I.Sb(),I.Sb(),I.Tb(24,"mat-form-field",9),I.Tb(25,"mat-label"),I.Rc(26,"Tenant"),I.Sb(),I.Tb(27,"input",14),I.bc("click",(function(){return e.getTenants()})),I.Sb(),I.Tb(28,"mat-autocomplete",15,16),I.bc("optionSelected",(function(t){return e.selectTenant(t)})),I.Pc(30,K,2,2,"mat-option",17),I.Sb(),I.Ob(31,"app-show-errors",13),I.Tb(32,"mat-hint"),I.Rc(33,"Please select a Tenant"),I.Sb(),I.Sb(),I.Tb(34,"mat-form-field",9),I.Tb(35,"mat-label"),I.Rc(36,"Unit"),I.Sb(),I.Ob(37,"input",18),I.Tb(38,"mat-autocomplete",15,19),I.bc("optionSelected",(function(t){return e.selectUnit(t)})),I.Pc(40,Q,2,2,"mat-option",17),I.Sb(),I.Ob(41,"app-show-errors",13),I.Tb(42,"mat-hint"),I.Rc(43,"Please select a Unit"),I.Sb(),I.Sb(),I.Sb(),I.Sb(),I.Tb(44,"div",7),I.Ob(45,"div",8),I.Sb(),I.Tb(46,"div",20),I.Tb(47,"div",8),I.Tb(48,"mat-form-field",9),I.Tb(49,"mat-label"),I.Rc(50),I.Sb(),I.Tb(51,"input",21),I.bc("click",(function(){return I.Ec(i),I.Ac(54).open()})),I.Sb(),I.Ob(52,"mat-datepicker-toggle",11),I.Ob(53,"mat-datepicker",null,22),I.Ob(55,"app-show-errors",13),I.Tb(56,"mat-hint"),I.Rc(57),I.Sb(),I.Pc(58,Z,2,1,"small",23),I.Sb(),I.Tb(59,"mat-form-field",9),I.Tb(60,"mat-label"),I.Rc(61,"Contract Type"),I.Sb(),I.Tb(62,"input",24),I.bc("keydown",(function(t){return e.searchContractType(t.target.value)})),I.Sb(),I.Tb(63,"mat-autocomplete",15,25),I.bc("optionSelected",(function(t){return e.selectContractType(t)})),I.Pc(65,J,2,2,"mat-option",17),I.Sb(),I.Ob(66,"app-show-errors",13),I.Tb(67,"mat-hint"),I.Rc(68,"Please select a Contract Type"),I.Sb(),I.Sb(),I.Tb(69,"mat-form-field",9),I.Tb(70,"mat-label"),I.Rc(71,"Reference Number"),I.Sb(),I.Ob(72,"input",26),I.Sb(),I.Sb(),I.Tb(73,"div",20),I.Tb(74,"div",8),I.Tb(75,"div",27),I.Tb(76,"mat-checkbox",28),I.bc("change",(function(){return e.toggleSecurityDeposit(e.securityDepositExist)})),I.Rc(77," Security Deposit "),I.Sb(),I.Sb(),I.Tb(78,"mat-form-field",29),I.Tb(79,"mat-label"),I.Rc(80,"Security Deposit Amount"),I.Sb(),I.Ob(81,"input",30),I.gc(82,"noComma"),I.gc(83,"number"),I.Sb(),I.Tb(84,"mat-form-field",29),I.Tb(85,"mat-label"),I.Rc(86,"Received Amount"),I.Sb(),I.Ob(87,"input",31),I.gc(88,"noComma"),I.gc(89,"number"),I.Sb(),I.Tb(90,"mat-form-field",29),I.Tb(91,"mat-label"),I.Rc(92,"Refunded Amount"),I.Sb(),I.Ob(93,"input",32),I.gc(94,"noComma"),I.gc(95,"number"),I.Sb(),I.Pc(96,tt,3,0,"div",33),I.Sb(),I.Sb(),I.Tb(97,"div",20),I.Tb(98,"div",8),I.Rc(99," Bill Grouping "),I.Sb(),I.Tb(100,"div",8),I.Tb(101,"mat-checkbox",34),I.bc("change",(function(){return e.checkValue()})),I.Rc(102," Group bill with other units"),I.Sb(),I.Sb(),I.Sb(),I.Tb(103,"div",20),I.Tb(104,"div",8),I.Tb(105,"mat-form-field",35),I.Tb(106,"mat-label"),I.Rc(107,"Utility Type"),I.Sb(),I.Tb(108,"mat-select",36),I.bc("ngModelChange",(function(t){return e.selectedUtilities=t}))("selectionChange",(function(t){return e.selectedValue(t)})),I.Tb(109,"mat-option",37,38),I.bc("click",(function(){return e.toggleAllSelection()})),I.Rc(111,"Select All"),I.Sb(),I.Pc(112,et,2,2,"mat-option",39),I.Sb(),I.Tb(113,"mat-hint"),I.Rc(114,"Please select a Utility Type"),I.Sb(),I.Pc(115,it,2,0,"small",23),I.Sb(),I.Tb(116,"mat-form-field",40),I.Tb(117,"input",41),I.bc("ngModelChange",(function(t){return e.billGroupId=t}))("keyup",(function(){return e.validateDifferenciateConsumption()})),I.Sb(),I.Tb(118,"mat-hint"),I.Rc(119,"Please enter Bill Group Number"),I.Sb(),I.Sb(),I.Tb(120,"div",42),I.Tb(121,"mat-checkbox",43),I.Rc(122,"Differenciate Consumption"),I.Sb(),I.Sb(),I.Tb(123,"button",44),I.bc("click",(function(){return e.addBillGroup()})),I.Tb(124,"mat-icon"),I.Rc(125,"add"),I.Sb(),I.Sb(),I.Sb(),I.Sb(),I.Pc(126,nt,2,0,"mat-hint",45),I.Ob(127,"br"),I.Pc(128,lt,2,0,"mat-hint",45),I.Tb(129,"table",46),I.Pc(130,st,2,1,"ng-container",47),I.Rb(131,48),I.Pc(132,ct,1,0,"th",49),I.Pc(133,dt,2,1,"td",50),I.Qb(),I.Pc(134,mt,1,0,"tr",51),I.Pc(135,ft,1,0,"tr",52),I.Sb(),I.Sb(),I.Tb(136,"div",20),I.Tb(137,"div",8),I.Pc(138,pt,3,2,"mat-form-field",53),I.Sb(),I.Sb(),I.Sb(),I.Sb(),I.Sb(),I.Tb(139,"mat-dialog-actions",54),I.Tb(140,"button",55),I.bc("click",(function(){return e.closeDialog()})),I.Rc(141,"CANCEL"),I.Sb(),I.Pc(142,gt,2,1,"button",56),I.Pc(143,vt,2,1,"button",57),I.Pc(144,yt,2,1,"button",56),I.Pc(145,Ct,2,1,"button",56),I.Sb(),I.Sb()}if(2&t){var n=I.Ac(20),l=I.Ac(29),a=I.Ac(39),o=I.Ac(54),r=I.Ac(64);I.Cb(8),I.mc("formGroup",e.form),I.Cb(9),I.mc("matDatepicker",n)("disabled",e.isDisabled),I.Cb(1),I.mc("for",n),I.Cb(3),I.mc("ctrl",null==e.form?null:e.form.get("contractDate")),I.Cb(6),I.mc("matAutocomplete",l),I.Cb(3),I.mc("ngForOf",e.filteredTenants),I.Cb(1),I.mc("ctrl",null==e.form?null:e.form.get("tenantId")),I.Cb(6),I.mc("matAutocomplete",a),I.Cb(3),I.mc("ngForOf",e.filteredUnits),I.Cb(1),I.mc("ctrl",null==e.form?null:e.form.get("unitId")),I.Cb(9),I.Tc("Contract ",e.type," Date"),I.Cb(1),I.mc("matDatepicker",o),I.Cb(1),I.mc("for",o),I.Cb(3),I.mc("ctrl",e.form.get("contractEndDate")),I.Cb(2),I.Tc("Please select ",e.type," Date"),I.Cb(1),I.mc("ngIf",!e.validateDates()),I.Cb(4),I.mc("matAutocomplete",r),I.Cb(3),I.mc("ngForOf",e.filteredContractTypes),I.Cb(1),I.mc("ctrl",null==e.form?null:e.form.get("contractTypeId")),I.Cb(15),I.mc("ngModel",I.hc(82,41,I.ic(83,43,e.securityDeposit,e.roundFormat))),I.Cb(6),I.mc("ngModel",I.hc(88,46,I.ic(89,48,e.receivedAmount,e.roundFormat))),I.Cb(6),I.mc("ngModel",I.hc(94,51,I.ic(95,53,e.refundAmount,e.roundFormat))),I.Cb(3),I.mc("ngIf",e.isAssignToOwner),I.Cb(12),I.mc("ngModel",e.selectedUtilities),I.Cb(1),I.mc("value",0),I.Cb(3),I.mc("ngForOf",e.metadataUtilityTypes),I.Cb(3),I.mc("ngIf",e.isDuplicate),I.Cb(2),I.mc("ngModel",e.billGroupId),I.Cb(6),I.mc("disabled",1==e.billGroupMsg||"delete"==e.mode||0==(null==e.selectedUtilities?null:e.selectedUtilities.length)||null==e.billGroupId||null==e.billGroupId||e.billGroupId<=0),I.Cb(3),I.mc("ngIf",1==e.billGroupMsg),I.Cb(2),I.mc("ngIf",1==e.isUtilitiesMapped),I.Cb(1),I.mc("dataSource",e.dataSource),I.Cb(1),I.mc("ngForOf",e.displayedColumns),I.Cb(4),I.mc("matHeaderRowDef",e.visibleColumns),I.Cb(1),I.mc("matRowDefColumns",e.visibleColumns),I.Cb(3),I.mc("ngIf",e.isDeleteMode()),I.Cb(4),I.mc("ngIf",e.isCreateMode()),I.Cb(1),I.mc("ngIf",e.isUpdateMode()),I.Cb(1),I.mc("ngIf",e.isRenewMode()),I.Cb(1),I.mc("ngIf",e.isDeleteMode())}},directives:[P.i,M.a,O.a,W.a,U.c,s.z,s.r,s.k,P.f,E.a,E.c,L.d,L.e,z.d,L.b,z.h,s.c,B.b,j.b,s.q,s.i,j.d,z.j,j.a,G.a,z.g,Y.c,Y.a,r.n,r.o,s.m,H.a,V.a,s.u,$.a,_.n,p.j,b.a,p.c,p.e,p.b,p.g,p.i,P.c,L.c,p.d,b.b,p.a,p.f,p.h],pipes:[X.a,r.g],styles:[".mat-dlg-content[_ngcontent-%COMP%]{margin-left:1px;width:95%;height:fit-to-content}small[_ngcontent-%COMP%]{color:red}.hidden[_ngcontent-%COMP%]{display:none}.contractControls[_ngcontent-%COMP%]{cursor:pointer}.contractControlsDisabled[_ngcontent-%COMP%]{color:rgba(0,0,0,.26)}.formulaLabel[_ngcontent-%COMP%]{clear:both;padding-top:10px}.marginRight[_ngcontent-%COMP%]{margin-right:8%}.reasonForContractEndShow[_ngcontent-%COMP%]{display:block}.reasonForContractEndHide[_ngcontent-%COMP%]{display:none}.securityDeposit[_ngcontent-%COMP%]{align-self:center;margin-left:10px}.securityDepositAmount[_ngcontent-%COMP%]{margin-left:85px;width:400px}.deleteIcon[_ngcontent-%COMP%]{cursor:pointer}.task-header[_ngcontent-%COMP%]{background-color:transparent;padding:0 5px;height:20px}.fx-spacer[_ngcontent-%COMP%]{flex:1 1 auto}"]}),St),Dt=a("7d4Y"),Pt=a("i680"),wt=(a("DaQG"),a("dNgK"));function xt(t,e){if(1&t&&(I.Tb(0,"mat-option",21),I.Rc(1),I.Sb()),2&t){var i=e.$implicit;I.mc("value",i.value),I.Cb(1),I.Tc("",i.label," ")}}var kt,At=function(){return{standalone:!0}},Rt=((kt=function(){function t(e,i,n,a,o,r,s){l(this,t),this.data=e,this.dialogRef=i,this.billSettlementService=n,this.snackbar=a,this.fb=o,this.cookieService=r,this.date=s,this.refundDate=new Date,this.amount=0,this.remarks="",this.paymentModeId=0,this.clientId="",this.paymentModes=[{label:"Select",value:0}],this.refundAmount=0,this.errorMessage="",this.refundableAmount=0,this.title="Refund",this.maxDate=new Date,this.currency=Object(F.e)("Currency"),this.roundFormat=Object(F.e)("RoundOff"),this.title=this.data.type,this.dialogRef.disableClose=!0}return o(t,[{key:"ngOnInit",value:function(){this.clientId=this.cookieService.get("globalClientId"),this.onGetPaymentModes(),this.form=this.fb.group({amount:[""]}),this.data&&"Refund"===this.data.type?(this.refundAmount=this.data.refundAmount,this.refundableAmount=this.data.receivedAmount-this.data.refundAmount,this.amount=this.refundableAmount):this.amount=this.data.remainingAmount}},{key:"calculateRefundableAmount",value:function(t){"Refund"===this.title&&(this.errorMessage="",this.refundableAmount<parseInt(t)&&(this.errorMessage="Refund Amount should not be greater than "+this.refundableAmount),this.amount=t)}},{key:"onGetPaymentModes",value:function(){var t=this;this.paymentModes=[{label:"Select",value:0}],this.billSettlementService.getPaymentModes().subscribe((function(e){e.forEach((function(e){t.paymentModes.push({label:e.description,value:e.id})}))}))}},{key:"onSave",value:function(){if(this.amount&&this.paymentModeId&&this.remarks)if("Refund"===this.title){var t=Number(0==this.amount?0:this.amount),e={ownerId:this.data.tenantId,billType:3,modeOfPayment:this.paymentModeId,clientId:Number(this.clientId),refundDate:this.refundDate,refundAmount:t,remarks:this.remarks},i=[];if(this.data.billMasters&&this.data.billMasters.length){var n=0,l=this.data.billMasters.filter((function(t){return null==t.billNumber}));l&&l.length&&l.sort((function(t,e){return e.paymentId-t.paymentId})).forEach((function(e){if(e.billAmount!=e.previousDueAmount&&t>0){var l=Number(t)-Number(e.paid);l>=0?(n=e.paid,t=l):(n=t,t=0),n>0&&(i.push({paymentId:e.paymentId,refundAmount:n}),n=0)}}))}i&&i.length&&(e.refundTransactions=i),this.dialogRef.close(e)}else if(this.amount&&this.paymentModeId&&this.remarks){var a={paymentDate:this.date.transform(this.refundDate,"yyyy-MM-dd"),paymentAmount:Number(this.amount),clientId:Number(this.cookieService.get("globalClientId")),billType:3,ownerId:this.data.tenantId,modeofPayment:this.paymentModeId,remarks:this.remarks,paymentTransactions:[{billId:0,paidAmount:Number(this.amount),advanceAmount:0,isAdvanceAmount:!1}]};this.dialogRef.close(a)}}},{key:"onChangePaymentMode",value:function(t){this.paymentModeId=t}},{key:"notificationMessage",value:function(t,e){this.snackbar.open(t,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[e]})}},{key:"close",value:function(){this.dialogRef.close()}}]),t}()).\u0275fac=function(t){return new(t||kt)(I.Nb(P.a),I.Nb(P.h),I.Nb(Dt.a),I.Nb(wt.b),I.Nb(s.f),I.Nb(N.a),I.Nb(r.f))},kt.\u0275cmp=I.Hb({type:kt,selectors:[["fury-bill-refund"]],decls:42,vars:23,consts:[["mat-dialog-title",""],["role","toolbar",1,"task-header"],[1,"fx-spacer"],["mat-icon-button","",3,"click"],["mat-list-icon",""],[1,"person","padding-top"],[3,"formGroup"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","10px"],["color","primary","fxFlex","",1,"result","columnWidth"],["type","textbox","id","amount","name","amount","formControlName","amount","furyValidateDecimalPlacesDirective","","matInput","",3,"readonly","ngModel","keyup"],[1,"errorMessage"],["id","refundDate","name","refundDate","matInput","","readonly","",3,"ngModelOptions","max","ngModel","matDatepicker","click","ngModelChange","focus"],["matSuffix","",3,"for"],["formDatepickerRef",""],["fxLayout","column padding-top","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","10px"],["id","PaymentMode","name","PaymentMode",3,"value","selectionChange","valueChange"],[3,"value",4,"ngFor","ngForOf"],["type","text","id","remarks","name","remarks","matInput","",3,"ngModelOptions","ngModel","ngModelChange"],[1,"rightAlign"],["mat-button","",3,"click"],["mat-button","",3,"disabled","click"],[3,"value"]],template:function(t,e){if(1&t){var i=I.Ub();I.Tb(0,"h4",0),I.Tb(1,"mat-toolbar",1),I.Tb(2,"span"),I.Rc(3),I.Sb(),I.Ob(4,"span",2),I.Tb(5,"button",3),I.bc("click",(function(){return e.close()})),I.Tb(6,"mat-icon",4),I.Rc(7,"close"),I.Sb(),I.Sb(),I.Sb(),I.Sb(),I.Tb(8,"mat-dialog-content"),I.Tb(9,"div",5),I.Tb(10,"form",6),I.Tb(11,"div",7),I.Tb(12,"mat-form-field",8),I.Tb(13,"mat-label"),I.Rc(14,"Amount"),I.Sb(),I.Tb(15,"input",9),I.bc("keyup",(function(t){return e.calculateRefundableAmount(t.target.value)})),I.gc(16,"noComma"),I.gc(17,"number"),I.Sb(),I.Tb(18,"mat-hint",10),I.Rc(19),I.Sb(),I.Sb(),I.Tb(20,"mat-form-field",8),I.Tb(21,"mat-label"),I.Rc(22),I.Sb(),I.Tb(23,"input",11),I.bc("click",(function(){return I.Ec(i),I.Ac(26).open()}))("ngModelChange",(function(t){return e.refundDate=t}))("focus",(function(){return I.Ec(i),I.Ac(26).open()})),I.Sb(),I.Ob(24,"mat-datepicker-toggle",12),I.Ob(25,"mat-datepicker",null,13),I.Sb(),I.Sb(),I.Tb(27,"div",14),I.Tb(28,"mat-form-field",8),I.Tb(29,"mat-label"),I.Rc(30,"Payment Mode"),I.Sb(),I.Tb(31,"mat-select",15),I.bc("selectionChange",(function(t){return e.onChangePaymentMode(t.value)}))("valueChange",(function(t){return e.paymentModeId=t})),I.Pc(32,xt,2,2,"mat-option",16),I.Sb(),I.Sb(),I.Tb(33,"mat-form-field",8),I.Tb(34,"mat-label"),I.Rc(35,"Remarks"),I.Sb(),I.Tb(36,"input",17),I.bc("ngModelChange",(function(t){return e.remarks=t})),I.Sb(),I.Sb(),I.Sb(),I.Tb(37,"div",18),I.Tb(38,"button",19),I.bc("click",(function(){return e.close()})),I.Rc(39,"CANCEL"),I.Sb(),I.Tb(40,"button",20),I.bc("click",(function(){return e.onSave()})),I.Rc(41,"SAVE"),I.Sb(),I.Sb(),I.Sb(),I.Sb(),I.Sb()}if(2&t){var n=I.Ac(26);I.Cb(3),I.Sc(e.title),I.Cb(7),I.mc("formGroup",e.form),I.Cb(5),I.mc("readonly","Refund"!==e.title)("ngModel",I.hc(16,16,I.ic(17,18,e.amount,e.roundFormat))),I.Cb(4),I.Sc(e.errorMessage),I.Cb(3),I.Tc("",e.title," Date"),I.Cb(1),I.mc("ngModelOptions",I.qc(21,At))("max",e.maxDate)("ngModel",e.refundDate)("matDatepicker",n),I.Cb(1),I.mc("for",n),I.Cb(7),I.mc("value",e.paymentModeId),I.Cb(1),I.mc("ngForOf",e.paymentModes),I.Cb(4),I.mc("ngModelOptions",I.qc(22,At))("ngModel",e.remarks),I.Cb(4),I.mc("disabled",""!=e.errorMessage||e.amount<=0||null==e.refundDate||0==e.paymentModeId||""==e.remarks)}},directives:[P.i,M.a,O.a,W.a,U.c,P.f,s.z,s.r,s.k,L.d,L.e,z.d,L.b,z.h,s.c,B.b,s.q,s.i,V.a,z.g,j.b,s.t,j.d,z.j,j.a,$.a,r.n,_.n],pipes:[X.a,r.g],styles:[".task-header[_ngcontent-%COMP%]{background-color:transparent;padding:0 5px;height:20px}.fx-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.columnWidth[_ngcontent-%COMP%]{width:270px}.errorMessage[_ngcontent-%COMP%]{color:red}.rightAlign[_ngcontent-%COMP%]{float:right}"]}),kt),Ft=a("K+kB"),It=a("lW2b"),Nt=a("wd/R");function Mt(t,e){1&t&&(I.Tb(0,"small"),I.Rc(1,"Contract end date should be greater than Contract date."),I.Sb())}var Ot,Wt=((Ot=function(){function t(e,i,n,a,o,r,s,c){l(this,t),this.data=e,this.dialogRef=i,this.snackbar=n,this.fb=a,this.cookieService=o,this.datePipe=r,this.dialog=s,this.router=c,this.clientId="",this.totalOutstandingAmount=0,this.totalSecurityDepositAmount=0,this.dateFormat=Object(F.e)("DateFormat"),this.currencyFormat=Object(F.e)("Currency"),this.roundFormat=Object(F.e)("RoundOff"),this.checkDues=!0,this.dialogRef.disableClose=!0}return o(t,[{key:"ngOnInit",value:function(){this.clientId=this.cookieService.get("globalClientId"),this.form=this.fb.group({totalOutstandingAmount:[this.data.previousDueAmount||0],totalSecurityDepositAmount:[this.data.securityDepositInHand||0],contractEndDate:[this.data.contractEndDate||""],reasonForContractEnd:[this.data.reasonForContractEnd||""]}),this.form.get("contractEndDate").setValue(new Date),this.totalOutstandingAmount=this.data.previousDueAmount,this.totalSecurityDepositAmount=this.data.securityDepositInHand,this.checkDues=this.data.checkDues}},{key:"onEndContract",value:function(){var t=this,e=!0,i=this.form.get("contractEndDate").value;if(!this.checkDues)if(this.data&&this.data.billMasters&&this.data.billMasters.length){var n=this.data.billMasters.filter((function(e){return null!=e.billNumber&&e.billAmount!=e.paid&&t.data.id==e.contractId}));if(n&&n.length){var l=this.data.billMasters.filter((function(t){return null!=t.billNumber})).map((function(t){return new Date(t.toDate)})),a=Math.max.apply(Math,l),o=Nt(a).startOf("day");(i?Nt(i).startOf("day"):Nt().startOf("day"))<=o||(e=!1,this.redirectToFinalBill(i))}}else(Nt(i)<=Nt()||Nt(i).diff(Nt(this.data.contractDate),"days")>0)&&(e=!1,this.redirectToFinalBill(i));e&&(Object.assign(this.data,this.form.value),this.data.contractEndDate=this.datePipe.transform(this.data.contractEndDate,"yyyy-MM-dd"),this.data.contractSuspendDate||(this.data.contractSuspendDate=null),this.dialogRef.close(this.data))}},{key:"redirectToFinalBill",value:function(t){var e=this;this.dialog.open(R.a,{data:{label:"There are unbilled consumptions for this contract. Kindly generate bills for the same.Do you want to redirect to generate page?",selected:!1}}).afterClosed().subscribe((function(i){i?(e.dialogRef.close(),e.dialog.closeAll(),e.router.navigate(["bills/final-bill-settlement"],{queryParams:{id:e.data.tenantId,unit:e.data.unitNumber,settlement_date:e.datePipe.transform(t,"yyyy-MM-dd")}})):(e.dialogRef.close(),e.dialog.closeAll())}))}},{key:"notificationMessage",value:function(t,e){this.snackbar.open(t,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[e]})}},{key:"close",value:function(){this.dialogRef.close()}},{key:"validateDates",value:function(){var t=this.datePipe.transform(this.data.contractDate,"MM-dd-yyyy"),e=this.datePipe.transform(this.form.get("contractEndDate").value,"MM-dd-yyyy"),i=!0,n=new Date(t).getFullYear(),l=new Date(e).getFullYear();return 1970==n||1970==l||n<l?i:n>l?i=!1:null==t&&""==t||null==e&&""==e?void 0:(e<=t&&(i=!1),i)}}]),t}()).\u0275fac=function(t){return new(t||Ot)(I.Nb(P.a),I.Nb(P.h),I.Nb(wt.b),I.Nb(s.f),I.Nb(N.a),I.Nb(r.f),I.Nb(P.b),I.Nb(m.f))},Ot.\u0275cmp=I.Hb({type:Ot,selectors:[["fury-contract-end-details"]],decls:44,vars:17,consts:[["mat-dialog-title",""],["role","toolbar",1,"task-header"],[1,"fx-spacer"],["mat-icon-button","",3,"click"],["mat-list-icon",""],[1,"person","padding-top"],[3,"formGroup"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","10px"],["color","primary","fxFlex","",1,"result","columnWidth"],["type","number","readonly","","formControlName","totalOutstandingAmount","matInput","",3,"ngModel"],["type","number","readonly","","formControlName","totalSecurityDepositAmount","matInput","",3,"ngModel"],["formControlName","contractEndDate","matInput","",3,"matDatepicker","click"],["matSuffix","",3,"for"],["formDatepickerRef1",""],[4,"ngIf"],["fxLayout","column padding-top","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","10px"],["type","text","formControlName","reasonForContractEnd","matInput",""],[1,"rightAlign"],["mat-button","",3,"click"],["mat-button","",3,"disabled","click"]],template:function(t,e){if(1&t){var i=I.Ub();I.Tb(0,"h4",0),I.Tb(1,"mat-toolbar",1),I.Tb(2,"span"),I.Rc(3,"End Contract"),I.Sb(),I.Ob(4,"span",2),I.Tb(5,"button",3),I.bc("click",(function(){return e.close()})),I.Tb(6,"mat-icon",4),I.Rc(7,"close"),I.Sb(),I.Sb(),I.Sb(),I.Sb(),I.Tb(8,"mat-dialog-content"),I.Tb(9,"div",5),I.Tb(10,"form",6),I.Tb(11,"div",7),I.Tb(12,"mat-form-field",8),I.Tb(13,"mat-label"),I.Rc(14,"Total Outstanding Amount"),I.Sb(),I.Ob(15,"input",9),I.gc(16,"noComma"),I.gc(17,"number"),I.Sb(),I.Tb(18,"mat-form-field",8),I.Tb(19,"mat-label"),I.Rc(20,"Security Deposit in hand"),I.Sb(),I.Ob(21,"input",10),I.gc(22,"noComma"),I.gc(23,"number"),I.Sb(),I.Tb(24,"mat-form-field",8),I.Tb(25,"mat-label"),I.Rc(26,"Contract End Date"),I.Sb(),I.Tb(27,"input",11),I.bc("click",(function(){return I.Ec(i),I.Ac(30).open()})),I.Sb(),I.Ob(28,"mat-datepicker-toggle",12),I.Ob(29,"mat-datepicker",null,13),I.Tb(31,"mat-hint"),I.Rc(32,"Please select End Date"),I.Sb(),I.Pc(33,Mt,2,0,"small",14),I.Sb(),I.Sb(),I.Tb(34,"div",15),I.Tb(35,"mat-form-field",8),I.Tb(36,"mat-label"),I.Rc(37,"Reason for Contract End"),I.Sb(),I.Ob(38,"input",16),I.Sb(),I.Sb(),I.Tb(39,"div",17),I.Tb(40,"button",18),I.bc("click",(function(){return e.close()})),I.Rc(41,"CANCEL"),I.Sb(),I.Tb(42,"button",19),I.bc("click",(function(){return e.onEndContract()})),I.Rc(43,"END CONTRACT"),I.Sb(),I.Sb(),I.Sb(),I.Sb(),I.Sb()}if(2&t){var n=I.Ac(30);I.Cb(10),I.mc("formGroup",e.form),I.Cb(5),I.mc("ngModel",I.hc(16,7,I.ic(17,9,e.totalOutstandingAmount,e.roundFormat))),I.Cb(6),I.mc("ngModel",I.hc(22,12,I.ic(23,14,e.totalSecurityDepositAmount,e.roundFormat))),I.Cb(6),I.mc("matDatepicker",n),I.Cb(1),I.mc("for",n),I.Cb(5),I.mc("ngIf",!e.validateDates()),I.Cb(9),I.mc("disabled",!e.checkDues&&e.form.controls.totalOutstandingAmount.value>0)}},directives:[P.i,M.a,O.a,W.a,U.c,P.f,s.z,s.r,s.k,L.d,L.e,z.d,L.b,z.h,s.u,s.c,B.b,s.q,s.i,j.b,j.d,z.j,j.a,z.g,r.o],pipes:[X.a,r.g],styles:[".task-header[_ngcontent-%COMP%]{background-color:transparent;padding:0 5px;height:20px}.fx-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.columnWidth[_ngcontent-%COMP%]{width:270px}.errorMessage[_ngcontent-%COMP%]{color:red}.rightAlign[_ngcontent-%COMP%]{float:right}"]}),Ot),Ut=a("4Zil"),Et=a("a8hA"),Lt=a("EUZL"),zt=a("sXtk"),Bt=a("wh6T"),jt=a("xBcV"),Gt=a("Hbgg"),Yt=a("rnAf"),Ht=a("rvYj"),Vt=a("a+RD"),$t=a("Qu3c"),_t=a("STbY"),Xt=["allSelected"];function qt(t,e){if(1&t&&(I.Tb(0,"mat-option",20),I.Rc(1),I.Sb()),2&t){var i=e.$implicit;I.mc("value",i.value),I.Cb(1),I.Tc(" ",i.label,"")}}function Kt(t,e){if(1&t&&(I.Tb(0,"th",25),I.Rc(1),I.Sb()),2&t){var i=I.fc(2).$implicit;I.Cb(1),I.Tc(" ",i.name,"")}}function Qt(t,e){if(1&t&&(I.Tb(0,"td",26),I.Rc(1),I.Sb()),2&t){var i=e.$implicit,n=I.fc(2).$implicit;I.Cb(1),I.Tc(" ",i[n.property]," ")}}function Zt(t,e){if(1&t&&(I.Rb(0,22),I.Pc(1,Kt,2,1,"th",23),I.Pc(2,Qt,2,1,"td",24),I.Qb()),2&t){var i=I.fc().$implicit;I.mc("matColumnDef",i.property)}}function Jt(t,e){if(1&t&&(I.Rb(0),I.Pc(1,Zt,3,1,"ng-container",21),I.Qb()),2&t){var i=e.$implicit;I.Cb(1),I.mc("ngIf",i.isModelProperty)}}function te(t,e){1&t&&(I.Tb(0,"th",27),I.Rc(1,"SECURITY DEPOSIT IN HAND"),I.Sb())}function ee(t,e){if(1&t&&(I.Tb(0,"td",28),I.Rc(1),I.Sb()),2&t){var i=e.$implicit;I.Cb(1),I.Tc(" ",i.securityDepositInHandLocal," ")}}function ie(t,e){1&t&&(I.Tb(0,"th",27),I.Rc(1,"REMAINING AMOUNT"),I.Sb())}function ne(t,e){if(1&t&&(I.Tb(0,"td",28),I.Rc(1),I.Sb()),2&t){var i=e.$implicit;I.Cb(1),I.Tc(" ",i.remainingAmountLocal," ")}}function le(t,e){1&t&&I.Ob(0,"th",29)}function ae(t,e){if(1&t){var i=I.Ub();I.Tb(0,"button",38),I.bc("click",(function(t){return I.Ec(i),t.stopPropagation()})),I.Tb(1,"mat-icon"),I.Rc(2,"more_horiz"),I.Sb(),I.Sb()}if(2&t){I.fc();var n=I.Ac(3);I.mc("matMenuTriggerFor",n)}}function oe(t,e){if(1&t){var i=I.Ub();I.Tb(0,"button",37),I.bc("click",(function(){I.Ec(i);var t=I.fc().$implicit;return I.fc().updateContract(t)})),I.Tb(1,"span"),I.Rc(2,"Modify"),I.Sb(),I.Sb()}}function re(t,e){if(1&t){var i=I.Ub();I.Tb(0,"button",37),I.bc("click",(function(){I.Ec(i);var t=I.fc().$implicit;return I.fc().renewContract(t)})),I.Tb(1,"span"),I.Rc(2,"Renew"),I.Sb(),I.Sb()}}function se(t,e){if(1&t){var i=I.Ub();I.Tb(0,"button",37),I.bc("click",(function(){I.Ec(i);var t=I.fc().$implicit;return I.fc().deleteContract(t)})),I.Tb(1,"span"),I.Rc(2,"End Contract"),I.Sb(),I.Sb()}}function ce(t,e){if(1&t){var i=I.Ub();I.Tb(0,"button",37),I.bc("click",(function(){I.Ec(i);var t=I.fc().$implicit;return I.fc().activateContract(t)})),I.Tb(1,"span"),I.Rc(2,"Activate Contract"),I.Sb(),I.Sb()}}function ue(t,e){if(1&t){var i=I.Ub();I.Tb(0,"button",36),I.bc("click",(function(){I.Ec(i);var t=I.fc().$implicit;return I.fc().onReceivePayment(t)})),I.Tb(1,"span"),I.Rc(2,"Receive SD Payment"),I.Sb(),I.Sb()}if(2&t){var n=I.fc().$implicit;I.mc("disabled",n&&0==n.remainingAmount)}}function de(t,e){if(1&t){var i=I.Ub();I.Tb(0,"button",36),I.bc("click",(function(){I.Ec(i);var t=I.fc().$implicit;return I.fc().onSuspendContract(t)})),I.Tb(1,"span"),I.Rc(2,"Suspend Contract"),I.Sb(),I.Sb()}if(2&t){var n=I.fc().$implicit;I.mc("disabled",n&&n.isSuspended)}}function me(t,e){if(1&t){var i=I.Ub();I.Tb(0,"button",36),I.bc("click",(function(){I.Ec(i);var t=I.fc().$implicit;return I.fc().onRefund(t)})),I.Tb(1,"span"),I.Rc(2,"Refund"),I.Sb(),I.Sb()}if(2&t){var n=I.fc().$implicit;I.mc("disabled",!(n&&0===n.remainingAmount&&n.previousDueAmount<=0))}}function fe(t,e){if(1&t){var i=I.Ub();I.Tb(0,"button",36),I.bc("click",(function(){I.Ec(i);var t=I.fc().$implicit;return I.fc().onRefundHistory(t)})),I.Tb(1,"span"),I.Rc(2,"Refund History"),I.Sb(),I.Sb()}if(2&t){var n=I.fc().$implicit;I.mc("disabled",!(n&&n.refundAmount>0))}}function he(t,e){if(1&t){var i=I.Ub();I.Tb(0,"td",30),I.Pc(1,ae,3,1,"button",31),I.Tb(2,"mat-menu",32,33),I.Pc(4,oe,3,0,"button",34),I.Pc(5,re,3,0,"button",34),I.Pc(6,se,3,0,"button",34),I.Pc(7,ce,3,0,"button",34),I.Pc(8,ue,3,1,"button",35),I.Tb(9,"button",36),I.bc("click",(function(){I.Ec(i);var t=e.$implicit;return I.fc().onPrintReceipt(t)})),I.Tb(10,"span"),I.Rc(11,"Print Receipt"),I.Sb(),I.Sb(),I.Pc(12,de,3,1,"button",35),I.Tb(13,"button",37),I.bc("click",(function(){I.Ec(i);var t=e.$implicit;return I.fc().onPrintAccountStatement(t)})),I.Tb(14,"span"),I.Rc(15," Export Account Statement"),I.Sb(),I.Sb(),I.Pc(16,me,3,1,"button",35),I.Pc(17,fe,3,1,"button",35),I.Sb(),I.Sb()}if(2&t){var n=e.$implicit,l=I.fc();I.Cb(1),I.mc("ngIf",!l.movedOut),I.Cb(3),I.mc("ngIf",2!=l.filterId&&3!=l.filterId),I.Cb(1),I.mc("ngIf",2!=l.filterId&&3!=l.filterId),I.Cb(1),I.mc("ngIf",2!=l.filterId),I.Cb(1),I.mc("ngIf",n&&n.isSuspended),I.Cb(1),I.mc("ngIf",2!=l.filterId&&3!=l.filterId&&!(n&&n.isSuspended)),I.Cb(1),I.mc("disabled",!(n&&n.receivedAmount>0)),I.Cb(3),I.mc("ngIf",2!=l.filterId&&3!=l.filterId),I.Cb(4),I.mc("ngIf",3!=l.filterId),I.Cb(1),I.mc("ngIf",3!=l.filterId)}}function be(t,e){1&t&&I.Ob(0,"tr",39)}function pe(t,e){1&t&&I.Ob(0,"tr",40)}var ge,ve,ye,Ce,Se=function(){return[]},Te=function(){return{standalone:!0}},De=[{path:"",component:(ge=function(){function e(t,i,n,a,o,r,s,c,u,d,m,f,h,b){var p;l(this,e),this.dialog=t,this.snackbar=i,this.date=n,this.router=a,this.currencyPipe=o,this.dataService=r,this.decimalPipe=s,this.contractService=c,this.billSettlementService=u,this.cookieService=d,this.clientSelectionService=m,this.billService=f,this.envService=h,this.workflowRuleService=b,this.subject$=new g.a(1),this.data$=this.subject$.asObservable(),this.workflowRules=[],this.dateFormat="",this.billMaster={},this.currency=Object(F.e)("Currency"),this.roundFormat=Object(F.e)("RoundOff"),this.consumptionRoundOffFormat=Object(F.e)("ConsumptionRoundOff"),this.filePath="",this.movedOut=!1,this.reminder=!1,this.message="",this.checkDues=!0,this.filterId=0,this.pdfsToMerge=[],this.filterModes=[{label:"Current Contracts",value:0},{label:"Expiration Reminder",value:1},{label:"Closed Contracts",value:2},{label:"Suspended Contracts",value:3},{label:"Unpaid SD Contracts",value:4}],this.selectFilterModes=[],this.displayedColumns=[{name:"Contract Number",property:"contractNumber",visible:!0,isModelProperty:!0},{name:"Contract Date",property:"contractDateLocal",visible:!0,isModelProperty:!0},{name:"Contract End Date",property:"contractEndDateLocal",visible:!0,isModelProperty:!0},{name:"Tenant Name",property:"tenantName",visible:!0,isModelProperty:!0},{name:"Unit Number",property:"unitNumber",visible:!0,isModelProperty:!0},{name:"Contract Type",property:"contractType",visible:!0,isModelProperty:!0},{name:"Security Deposit In Hand",property:"securityDepositInHandLocal",visible:!0,isModelProperty:!1},{name:"Remaining Amount",property:"remainingAmountLocal",visible:!0,isModelProperty:!1},{name:"Status",property:"status",visible:!0,isModelProperty:!0},{name:"Actions",property:"actions",visible:!0}],this.pageSize=8,this.columnsProps=this.displayedColumns.map((function(t){return t.property})),this.filePath=h.backendForFiles,this.dateFormat=null!==(p=Object(F.e)("DateFormat"))&&void 0!==p?p:h.dateFormat,this.clientId=Number(this.cookieService.get("globalClientId"))}return o(e,[{key:"ngOnInit",value:function(){this.clientSelectionService.setIsClientVisible(!0),this.expiryReminder=this.dataService.getMessage(),this.expiryReminder&&(this.reminder=this.expiryReminder),this.getWorkflowRules()}},{key:"getReminder",value:function(t){this.reminder=t}},{key:"getContractDetails",value:function(){1==this.movedOut?this.getMovedOutTenants():this.reminder?this.getContractsAboutToExpire():this.getContracts()}},{key:"ngAfterViewInit",value:function(){this.listData&&(this.listData.paginator=this.paginator,this.listData.sort=this.sort)}},{key:"notificationMessage",value:function(t,e){this.snackbar.open(t,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[e]})}},{key:"createContract",value:function(){var t=this;this.dialog.open(Tt).afterClosed().subscribe((function(e){e&&(e.mode="create",t.contractService.createContract(e).subscribe((function(){t.snackbar.open("Contract created successfully",null,{duration:5e3,verticalPosition:"top",horizontalPosition:"center",panelClass:["green-snackbar"]}),t.onFilterData()})))}))}},{key:"updateContract",value:function(t){var e=this;t.mode="update",t.type="",this.dialog.open(Tt,{data:t}).afterClosed().subscribe((function(i){i&&e.contractService.updateContractById(t.id,i).subscribe({next:function(){e.snackbar.open("Contract updated successfully",null,{duration:5e3,verticalPosition:"top",horizontalPosition:"center",panelClass:["green-snackbar"]}),e.onFilterData()},error:function(){e.notificationMessage("Contract updation failed","red-snackbar")}}),e.onFilterData()}))}},{key:"renewContract",value:function(t){var e=this;t.mode="renew",this.dialog.open(Tt,{data:t}).afterClosed().subscribe((function(t){t&&e.contractService.renewContract(t.id,t).subscribe({next:function(){e.snackbar.open("Contract renewed successfully",null,{duration:5e3,verticalPosition:"top",horizontalPosition:"center",panelClass:["green-snackbar"]}),e.onFilterData()},error:function(){e.notificationMessage("Contract renewal failed","red-snackbar")}})}))}},{key:"deleteContract",value:function(t){var e=this;t.checkDues=this.checkDues,this.dialog.open(Wt,{data:t}).afterClosed().subscribe((function(t){t&&(t.clientId=e.clientId,e.contractService.deleteContractById(t.id,t).subscribe({next:function(){e.snackbar.open("Contract End Successfull.",null,{duration:5e3,verticalPosition:"top",horizontalPosition:"center",panelClass:["green-snackbar"]}),e.onFilterData()},error:function(){e.notificationMessage("Contract End failed","red-snackbar")}}))}))}},{key:"onSuspendContract",value:function(t){var e=this;t.mode="delete",t.type="Suspend",this.dialog.open(Tt,{data:t}).afterClosed().subscribe((function(t){t&&e.contractService.suspendContractById(t.id,t).subscribe({next:function(){e.snackbar.open("Contract Suspend Successfull.",null,{duration:5e3,verticalPosition:"top",horizontalPosition:"center",panelClass:["green-snackbar"]}),e.onFilterData()},error:function(){e.notificationMessage("Contract Suspend failed","red-snackbar")}})}))}},{key:"getContracts",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.clientId=parseInt(this.cookieService.get("globalClientId")),this.contractService.getContracts(this.clientId).subscribe((function(n){n=n.map((function(t){return new D(t)})),e&&(n=n.filter((function(t){return t.isSuspended==e}))),i&&(n=n.filter((function(t){return 0==t.receivedAmount&&t.securityDeposit>0}))),t.dateFormat=Object(F.e)("DateFormat"),t.roundFormat=Object(F.e)("RoundOff"),t.currency=Object(F.e)("Currency"),n.forEach((function(e){e.securityDepositLocal=t.currencyPipe.transform(e.securityDeposit,t.currency.toString(),!0,t.roundFormat),e.contractDateLocal=t.date.transform(e.contractDate.toString(),t.dateFormat.toString()),e.contractEndDateLocal=t.date.transform(e.contractEndDate.toString(),t.dateFormat.toString()),e.securityDepositInHand=e.receivedAmount-e.refundAmount,e.securityDepositInHandLocal=t.currencyPipe.transform(e.securityDepositInHand,t.currency.toString(),!0,t.roundFormat),e.receivedAmountLocal=t.currencyPipe.transform(e.receivedAmount,t.currency.toString(),!0,t.roundFormat),e.refundAmountLocal=t.currencyPipe.transform(e.refundAmount,t.currency.toString(),!0,t.roundFormat),e.remainingAmountLocal=t.currencyPipe.transform(e.remainingAmount,t.currency.toString(),!0,t.roundFormat)})),t.subject$.next(n)})),this.listData=new p.k(this.contracts),this.data$.pipe(Object(v.a)((function(t){return!!t}))).subscribe((function(e){t.contracts=e,t.listData.data=e})),this.ngAfterViewInit()}},{key:"onFilterChange",value:function(t){this.listData&&(t=(t=t.trim()).toLowerCase(),this.listData.filter=t)}},{key:"ngOnDestroy",value:function(){}},{key:"onGenerateInoice",value:function(t,e){var i=this;this.clientId=parseInt(this.cookieService.get("globalClientId")),this.billSettlementService.generateOtherTypeInvoiceDetail(this.clientId,t.id).subscribe({next:function(t){t?e&&(i.updatePaymentDetails(e,t.id),i.onSavePayment(e)):i.notificationMessage("Security deposit payment save failed","red-snackbar")},error:function(){i.notificationMessage("Security deposit payment save failed","red-snackbar")}})}},{key:"onPrintInvoice",value:function(t){t&&t.billMasters&&(t.billMasters[0].billDateLocal=this.date.transform(t.billMasters[0].billDate.toString(),this.dateFormat.toString()),t.billMasters[0].fromDateLocal=this.date.transform(t.billMasters[0].fromDate.toString(),this.dateFormat.toString()),t.billMasters[0].toDateLocal=this.date.transform(t.billMasters[0].toDate.toString(),this.dateFormat.toString()),t.billMasters[0].dueDateLocal=this.date.transform(t.billMasters[0].dueDate.toString(),this.dateFormat.toString()),t.billMasters[0].billAmountLocal=this.currencyPipe.transform(t.billMasters[0].billAmount,this.currency.toString(),!0,this.roundFormat),"Bill Format 1"===t.billMasters[0].billFormat?this.downloadBillReport(t.billMasters[0]):"Bill Format 2"===t.billMasters[0].billFormat?t.billMasters[0].bills&&t.billMasters[0].bills.length>3?this.downloadLargeBillNewReport(t.billMasters[0]):this.downloadBillNewReport(t.billMasters[0]):"Bill Format 3"===t.billMasters[0].billFormat&&this.downloadBillNewFormatReport(t.billMasters[0]))}},{key:"downloadLargeBillNewReport",value:function(t){for(var e,i,n,l,a,o,r,s,c,u,d,m,f,h,b,p,g,v,y=this,C=[],S=[],T=[],D=[],P=[],w=[],x=[],k=[],A=[],R=[],I=0;I<t.bills.length;I++)this.consumptionRoundOffFormat=null!==(e=Object(F.e)("ConsumptionRoundOff",t.bills[I].utilityTypeId))&&void 0!==e?e:this.envService.consumptionRoundOffFormat,C.push(t.bills[I].unitNumber),C.push(t.bills[I].deviceName),C.push(this.decimalPipe.transform(t.bills[I].previousReading,this.consumptionRoundOffFormat)+" "+t.bills[I].measuringUnit),C.push(this.decimalPipe.transform(t.bills[I].presentReading,this.consumptionRoundOffFormat)+" "+t.bills[I].measuringUnit),C.push(t.bills[I].isDifferentiateBill?this.decimalPipe.transform(t.bills[I].presentReading-t.bills[I].previousReading,this.consumptionRoundOffFormat)+" "+t.bills[I].measuringUnit:this.decimalPipe.transform(t.bills[I].consumption,this.consumptionRoundOffFormat)+" "+t.bills[I].measuringUnit),"BTU"===t.bills[I].utilityType&&t.bills[I].billTransactions&&t.bills[I].billTransactions.length&&t.bills[I].billTransactions.findIndex((function(t){return t.measuringUnitId&&2===t.measuringUnitId}))>-1?C.push(this.decimalPipe.transform(.284345*t.bills[I].consumption,this.consumptionRoundOffFormat)):C.push(0),S.push(C),C=[];for(var N=0,M=0;M<t.bills.length;M++){var O=t.bills[M];this.consumptionRoundOffFormat=null!==(i=Object(F.e)("ConsumptionRoundOff",t.bills[M].utilityTypeId))&&void 0!==i?i:this.envService.consumptionRoundOffFormat;for(var W=0;W<O.billTransactions.length;W++)O.billTransactions[W].headAmount&&(C.push(O.billNumber),C.push(O.billTransactions[W].headDisplay),"BTU"===O.utilityType&&O.billTransactions&&O.billTransactions.length&&O.billTransactions[W]&&O.billTransactions[W].measuringUnitId&&2===O.billTransactions[W].measuringUnitId?(C.push(this.decimalPipe.transform(.284345*O.consumption,this.consumptionRoundOffFormat)),C.push("TR-HR"),C.push(O.consumptionRate)):(C.push(this.decimalPipe.transform(O.consumption,this.consumptionRoundOffFormat)),C.push(O.measuringUnit),C.push(O.consumptionRate)),C.push(this.decimalPipe.transform(O.billTransactions[W].headAmount,this.roundFormat)),k.push(C),C=[],N+=O.billTransactions[W].headAmount)}C.push(t.accountNumber),C.push(t.fromDateLocal+"-"+t.toDateLocal),C.push(this.currencyPipe.transform(t.previousDueAmount,this.currency.toString(),!0,this.roundFormat)),C.push(t.billAmountLocal),D.push(C),t.billCharges.forEach((function(t){if("VAT"!==t.headDisplay){var e=T.find((function(e){return e.label===t.headDisplay}));e?e.value+=t.headAmount:T.push({label:t.headDisplay,value:t.headAmount})}})),T.forEach((function(t){A.push({label:t.label,value:y.currencyPipe.transform(t.value,y.currency.toString(),!0,y.roundFormat)}),N+=t.value})),A.push({label:"Total Charges for Current Period",value:this.currencyPipe.transform(N,this.currency.toString(),!0,this.roundFormat)}),t.billTaxDetails.forEach((function(t){var e=A.find((function(e){return e.label===t.taxDisplayName}));if(e){var i=Number(e.value.replace(y.currency,"").trim())+Number(t.taxAmount);e.value=y.currencyPipe.transform(i,y.currency.toString(),!0,y.roundFormat)}else A.push({label:t.taxDisplayName,value:y.currencyPipe.transform(t.taxAmount,y.currency.toString(),!0,y.roundFormat)})})),A.push({label:"Previous Outstanding Amount",value:this.currencyPipe.transform(t.previousDueAmount,this.currency.toString(),!0,this.roundFormat)},{label:"Total Amount Due",value:this.currencyPipe.transform(t.billAmount+t.previousDueAmount,this.currency.toString(),!0,this.roundFormat)}),P.push({label:"Date of issue",value:null!==(n=null==t?void 0:t.billDateLocal)&&void 0!==n?n:""},{label:"Due Date",value:null!==(l=null==t?void 0:t.dueDateLocal)&&void 0!==l?l:""}),w.push({label:"Customer Name",value:null!==(a=null==t?void 0:t.ownerName)&&void 0!==a?a:""},{label:"Customer AccountNumber",value:null!==(o=null==t?void 0:t.accountNumber)&&void 0!==o?o:""},{label:"Address",value:null!==(s=null===(r=null==t?void 0:t.receiverDetails[0])||void 0===r?void 0:r.address1)&&void 0!==s?s:""},{label:"City",value:null!==(u=null===(c=null==t?void 0:t.receiverDetails[0])||void 0===c?void 0:c.city)&&void 0!==u?u:""},{label:"P.O Box",value:null!==(m=null===(d=null==t?void 0:t.receiverDetails[0])||void 0===d?void 0:d.zipPostalCode)&&void 0!==m?m:""},{label:"Phone number",value:null!==(h=null===(f=null==t?void 0:t.receiverDetails[0])||void 0===f?void 0:f.phoneNumber)&&void 0!==h?h:""},{label:"Fax Number",value:""},{label:"Client",value:null!==(p=null===(b=null==t?void 0:t.client)||void 0===b?void 0:b.clientName)&&void 0!==p?p:""},{label:"Client TRN",value:null!==(v=null===(g=null==t?void 0:t.client)||void 0===g?void 0:g.trnNo)&&void 0!==v?v:""}),x.push({firstItem:"Billing period",secondItem:"From:",thirdItem:t.fromDateLocal,fourthItem:"To:",fifthItem:t.toDateLocal});var U=[];C=[],t&&t.bills&&t.bills.length&&t.bills.forEach((function(t){if(t.billTariffDetails&&t.billTariffDetails.length)for(var e=0;e<t.billTariffDetails.length;e++)t.billTariffDetails[e].slabSettingsId&&t.billTariffDetails[e].slabSettingsId>0&&0==e?U=["Slab","Min Consumption","Max Consumption","Consumption","Rate","Amount"]:0==t.billTariffDetails[e].slabSettingsId&&0==e&&(U=["Season","Week Type","Peak Type","Consumption","Rate","Amount"]),C.push(t.billTariffDetails[e].season),C.push(t.billTariffDetails[e].weekType),C.push(t.billTariffDetails[e].peakType),C.push(t.billTariffDetails[e].consumption),C.push(t.billTariffDetails[e].rate),C.push(t.billTariffDetails[e].amount),R.push(C),C=[]})),this.getNewLargeBillReport(["Unit No","Meter No","Previous Reading","Present Reading","Consumption","Consumption TR-HR"],S,["Customer AccountNumber","Billing Period","Previous Due","Total for current period"],D,P,w,x,["Bill No","Charges","Consumption","Measuring Unit","Tariff","Total"],k,t,A,U,R)}},{key:"getNewLargeBillReport",value:function(t,e,i,n,l,a,o,r,s,c,u,d,m){var f,h,b,p,g;(new Image).src=this.filePath+"/uploads/"+(null===(f=null==c?void 0:c.client)||void 0===f?void 0:f.photo);var v=new Pt.default({orientation:"portrait",unit:"pt",format:"letter"}),y=null!==(b=null===(h=null==c?void 0:c.client)||void 0===h?void 0:h.clientName)&&void 0!==b?b:"",C=v.getTextWidth(y.trim())+4;v.setTextColor(0,0,0),v.setFontSize(17),v.setFont("Cambria"),v.text(y,Number(v.internal.pageSize.width/2)-Number(0!=C?C/2:0),23),v.setDrawColor(0,0,0),v.line(Number(v.internal.pageSize.width/2)-Number(0!=C?C/2:0),26,Number(v.internal.pageSize.width/2)-Number(0!=C?C/2:0)+C,26),v.setFont("Cambria","normal"),v.setFontSize(14),v.text("Billing Statement",35,46),this.addImage(v,c),v.autoTable("",l,{startX:10,startY:55,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:35},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:150,halign:"left"},1:{cellWidth:190,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"},didParseCell:function(t){t.cell.styles.cellPadding=1}});var S=Math.round(v.autoTable.previous.finalY);v.autoTable("",o,{startX:10,startY:S,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:35},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:150,halign:"left"},1:{cellWidth:95,halign:"center"},2:{cellWidth:95,halign:"center"},3:{cellWidth:95,halign:"center"},4:{cellWidth:95,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0]},didParseCell:function(t){t.cell.styles.cellPadding=1}});var T=Math.round(v.autoTable.previous.finalY);v.autoTable("",a,{startX:10,startY:T,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:35},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:150,halign:"left"},1:{cellWidth:380,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0]},didParseCell:function(t){t.cell.styles.cellPadding=1}});var D=function(t){var e="Page "+t.pageCount;"function"==typeof v.putTotalPages&&(e=e),v.setFontSize(9)},P=Math.round(v.autoTable.previous.finalY);v.setFont("Cambria"),v.setFontSize(10),v.text("Meter Read-Outs".toUpperCase(),35,P+20),v.autoTable(t,e,{startX:10,startY:P+40,showHead:"everyPage",didDrawPage:D,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:35},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"center"},1:{cellWidth:95,halign:"center"},2:{cellWidth:95,halign:"center"},3:{cellWidth:95,halign:"center"},4:{cellWidth:74,halign:"center"},5:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(t){t.cell.styles.cellPadding=1}});var w=Number(this.decimalPipe.transform(v.autoTable.previous.finalY,"1.0-0"));v.setFontSize(10),v.text("Charges Breakdown".toUpperCase(),35,w+20),v.autoTable(r,s,{startX:10,startY:w+40,showHead:"everyPage",didDrawPage:D,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:35},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:60,halign:"center"},1:{cellWidth:155,halign:"center"},2:{cellWidth:85,halign:"center"},3:{cellWidth:85,halign:"center"},4:{cellWidth:74,halign:"center"},5:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(t){t.cell.styles.cellPadding=1}});var x=Number(this.decimalPipe.transform(v.autoTable.previous.finalY,"1.0-0"));v.autoTable(d,m,{startX:10,startY:x+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:130,halign:"center"},1:{cellWidth:85,halign:"center"},2:{cellWidth:85,halign:"center"},3:{cellWidth:85,halign:"center"},4:{cellWidth:74,halign:"center"},5:{cellWidth:75,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(t){t.cell.styles.cellPadding=1}});var k=Number(this.decimalPipe.transform(v.autoTable.previous.finalY,"1.0-0")),A=v.internal.pageSize.height;A-k<200&&(v.addPage(),k=S,A=370+S),v.autoTable("",u,{startX:10,startY:k+20,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{bottom:40,left:250},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:244,fontStyle:"italic"},1:{cellWidth:75}},didParseCell:function(t){1==t.column.index&&(t.cell.styles.halign="right"),t.cell.styles.cellPadding=1},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});var R=Number(this.decimalPipe.transform(v.autoTable.previous.finalY,"1.0-0"));v.setFillColor(241,241,244),v.rect(35,R+20,535,80,"FD"),v.setFillColor(0,0,0),v.setFontSize(9),v.text(null===(g=null===(p=null==c?void 0:c.client)||void 0===p?void 0:p.termsConditions[0])||void 0===g?void 0:g.termsAndCondition.replace("{{ClientName}}",c.client.clientName).replace("{{TRNNumber}}",c.client.trnNo).replace("{{Currency}}",this.currency),65,R+30),v.setTextColor(0,0,0),v.line(5,R+110,607,R+110),v.text("Notice :- Please tear and attach the slip  along with your payment",35,A-80),v.autoTable(i,n,{startX:10,startY:A-70,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:35},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:120,halign:"center"},1:{cellWidth:200,halign:"center"},2:{cellWidth:100,halign:"right"},3:{cellWidth:120,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(t){t.cell.styles.cellPadding=1}});var F=v.output("blob");window.open(URL.createObjectURL(F))}},{key:"downloadBillReport",value:function(t){var e=this,i=[],n=[],l=[],a=[],o=[];t.bills.forEach((function(l){l.billTransactions&&l.billTransactions.length&&l.billTransactions.forEach((function(a){i.push(a.headDisplay),i.push(t.fromDateLocal),i.push(t.toDateLocal),i.push(l.previousReading),i.push(l.presentReading),i.push(l.consumption+" "+l.measuringUnit),i.push(l.consumptionRate),i.push(e.decimalPipe.transform(a.headAmount,e.roundFormat)),n.push(i),i=[]}))})),t.billCharges.forEach((function(t){if("VAT"!==t.headDisplay){var e=l.find((function(e){return e.label===t.headDisplay}));e?e.value+=t.headAmount:l.push({label:t.headDisplay,value:t.headAmount})}}));for(var r=0;r<l.length;r++)i.push(l[r].label),i.push(""),i.push(""),i.push(""),i.push(""),i.push(""),i.push(""),i.push(this.decimalPipe.transform(l[r].value,this.roundFormat)),n.push(i),i=[];var s="";t.bills.forEach((function(t){s+=t.deviceName+","})),a.push({label:"Account Number:",value:t.accountNumber},{label:"Meter Number:",value:s.slice(0,-1)},{label:"Unit Number:",value:t.unitNumber},{label:"Billing Date:",value:t.billDateLocal},{label:"Due Date:",value:t.dueDateLocal});var c=0;n.forEach((function(t){c+=Number(t[7].replace(",",""))})),o.push({label:"Current Month Total:",value:this.currencyPipe.transform(c,this.currency.toString(),!0,this.roundFormat)}),t.billTaxDetails&&t.billTaxDetails.length?t.billTaxDetails.forEach((function(t){o.push({label:t.taxDisplayName,value:e.currencyPipe.transform(t.taxAmount,e.currency.toString(),!0,e.roundFormat)})})):o.push({label:"TAX:",value:this.currencyPipe.transform(0,this.currency.toString(),!0,this.roundFormat)}),o.push({label:"Current Month + TAX:",value:t.billAmountLocal},{label:"Previous Bill Outstanding Balance:",value:this.currencyPipe.transform(t.previousDueAmount,this.currency.toString(),!0,this.roundFormat)},{label:"Total Due incl TAX:",value:this.currencyPipe.transform(t.billAmount+t.previousDueAmount,this.currency.toString(),!0,this.roundFormat)}),this.getBillReport(t,["Services Description","From","To","Previous","Current","Consumption","Rate ","Charges"],n,[{value:"",value1:"Bill Period",value2:"Meter Reading",value3:"",value4:""}],a,o)}},{key:"getBillReport",value:function(t,e,i,n,l,a){var o,r,s,c,u,d,m,f,h,b,p,g,v,y,C,S,T,D,P,w,x,k,A,R,I,N=new Pt.default({orientation:"portrait",unit:"pt",format:"letter"});N.rect(5,5,N.internal.pageSize.width-10,N.internal.pageSize.height-10,"S"),N.setFontSize(30),(N=this.addImage(N,t)).setTextColor(0,0,0),N.setFontSize(16),N.setFont("Cambria","bold"),N.text("Tax Invoice",260,30),N.setFontSize(13),N.setFont("Cambria","normal"),N.text(t.client.clientName.toUpperCase(),10,60),N.setFontSize(10),N.setFont("Cambria"),N.text("TRN: "+t.client.trnNo,10,70),N.text("PO Box "+t.client.addresses[0].zipPostalCode,10,80),N.text(t.client.addresses[0].address1+","+t.client.addresses[0].country,10,90),N.text("Phone: "+t.client.phoneNo,10,100),N.text("Email: "+t.client.email+", Web: "+t.client.website,10,110),N.setFillColor(241,241,244),N.setDrawColor(206,203,203),N.rect(10,120,350,90,"FD"),N.setTextColor(0,0,0),N.setFontSize(12),N.text(null==t?void 0:t.ownerName.toUpperCase(),20,135),N.text("CUSTOMER TRN: "+t.trn,20,155),N.text("unit #"+t.unitNumber,20,170),N.setFontSize(10),N.text(t.clientName,20,185),N.text(Object(F.f)(null===(o=null==t?void 0:t.client)||void 0===o?void 0:o.buildingName,",")+Object(F.f)(null===(s=null===(r=null==t?void 0:t.client)||void 0===r?void 0:r.addresses[0])||void 0===s?void 0:s.location,",")+Object(F.f)(null===(u=null===(c=null==t?void 0:t.client)||void 0===c?void 0:c.addresses[0])||void 0===u?void 0:u.city,",")+Object(F.f)(null===(m=null===(d=null==t?void 0:t.client)||void 0===d?void 0:d.addresses[0])||void 0===m?void 0:m.country,","),20,200),N.setFontSize(9),N.setLineWidth(.1),N.line(5,265,607,265),N.setFontSize(10),N.setFont("bold"),N.text("Invoice#: ".toUpperCase(),400,110),N.setTextColor(25,118,210);var M=N.getTextWidth("Invoice#: "),O="";(null==t?void 0:t.billNumber)&&(O=null===(f=t.billNumber)||void 0===f?void 0:f.toUpperCase()),N.text(O,410+M,110),N.setFont("none"),N.setTextColor(0,0,0),N.setFontSize(9),N.autoTable("",l,{startX:210,startY:120,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:400},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:100,halign:"right"}},didParseCell:function(t){var e=t.column.index;0!=e&&1!=e||(t.cell.styles.rowHeight=1)},headStyles:{lineWidth:.1,lineColor:[0,0,0]}}),N.autoTable("",n,{startX:10,startY:220,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:220,left:10},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,fontStyle:"bold",halign:"center"},1:{cellWidth:160,fontStyle:"bold",halign:"center"},2:{cellWidth:120,fontStyle:"bold",halign:"center"},3:{cellWidth:75,fontStyle:"bold",halign:"center"},4:{cellWidth:135,fontStyle:"bold",halign:"center"}},didParseCell:function(t){var e=t.column.index;0!=e&&1!=e||(t.cell.styles.rowHeight=1)},headStyles:{lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]}});var W=Number(this.decimalPipe.transform(N.autoTable.previous.finalY,"1.0-0"));N.autoTable(e,i,{startX:10,startY:W,didDrawPage:function(t){var e="Page "+t.pageCount;"function"==typeof N.putTotalPages&&(e+=" of 1",N.rect(5,5,N.internal.pageSize.width-10,N.internal.pageSize.height-10,"S")),N.setFontSize(9);var i=N.internal.pageSize.height||N.internal.pageSize.getHeight();N.text(e,t.settings.margin.left,i-10)},styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:W,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:80,halign:"center"},2:{cellWidth:80,halign:"center"},3:{cellWidth:60,halign:"center"},4:{cellWidth:60,halign:"center"},5:{cellWidth:75,halign:"center"},6:{cellWidth:60,halign:"right"},7:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(t){t.cell.styles.cellPadding=l.length>12?1.5:2}}),N.setTextColor(0,0,0);var U=Number(this.decimalPipe.transform(N.autoTable.previous.finalY,"1.0-0"));N.setTextColor(25,118,210),N.setFontSize(12),N.text("Bank Payment Account Details",10,U+20),N.setTextColor(0,0,0),N.setFontSize(9),N.text("Account Title: "+Object(F.f)(null===(b=null===(h=null==t?void 0:t.client)||void 0===h?void 0:h.bankDetails[0])||void 0===b?void 0:b.accountName),10,U+40),N.text("Account #: "+Object(F.f)(null===(g=null===(p=null==t?void 0:t.client)||void 0===p?void 0:p.bankDetails[0])||void 0===g?void 0:g.accountNo),10,U+50),N.text("IBAN #: "+Object(F.f)(null===(y=null===(v=null==t?void 0:t.client)||void 0===v?void 0:v.bankDetails[0])||void 0===y?void 0:y.ibanNumber),10,U+60),N.text("Bank Name: "+Object(F.f)(null===(S=null===(C=null==t?void 0:t.client)||void 0===C?void 0:C.bankDetails[0])||void 0===S?void 0:S.bankName),10,U+70),N.text("Swift Code: "+ +Object(F.f)(null===(D=null===(T=null==t?void 0:t.client)||void 0===T?void 0:T.bankDetails[0])||void 0===D?void 0:D.swiftCode),10,U+80),N.setFontSize(9),N.autoTable("",a,{startX:300,startY:U+20,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:320},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:180,halign:"left"},1:{cellWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"}});var E=Number(this.decimalPipe.transform(N.autoTable.previous.finalY,"1.0-0"));N.setTextColor(255,0,0),N.text("Note: A Late Fee will be applied after the due date. A Default Payment \nPenalty will be added to any unit that is ".concat(Object(F.f)(null===(P=null==t?void 0:t.penaltyAfter)||void 0===P?void 0:P.toString())," days or more in arrears."),320,E+10),N.setTextColor(25,118,210),N.setFontSize(12),N.text("USAGE TIPS to reduce consumption:",10,E+10),N.text("Please Try to:",10,E+30),N.setTextColor(0,0,0),N.setFontSize(9),N.text("- Keep filters clean",30,E+40),N.text("- Set thermostats between 23C and 25C",30,E+50),N.text("- Keep vents unblocked",30,E+60),N.text("- Keep doors and windows closed",30,E+70),N.text("- Undertake regular maintenance of the system",30,E+80),N.setTextColor(25,118,210),N.setFontSize(12),N.text("Please Do Not:",10,E+100),N.setTextColor(0,0,0),N.setFontSize(9),N.text("- Set thermostats to 20C or lower",30,E+110),N.text("- Block vents",30,E+120),N.text("- Leave doors and windows open",30,E+130),N.text("- Leave heat producing appliances near thermostats",30,E+140),N.setFillColor(119,183,11);var L=N.internal.pageSize.height||N.internal.pageSize.getHeight();N.rect(320,E+30,280,L-80-(E+30),"FD"),N.setFont("Comic Sans"),N.setTextColor(255,255,255),N.setFontSize(16),N.text("ADVERTISE WITH US",360,E+50);var z=N.getTextWidth("ADVERTISE WITH US");N.setLineWidth(.1),N.line(360,E+55,360+z,E+55),N.setFontSize(9),N.text("For advertisement, contact at",390,E+65),N.text(Object(F.f)(null===(w=null==t?void 0:t.client)||void 0===w?void 0:w.phoneNo),390,E+75),N.text(Object(F.f)(null===(x=null==t?void 0:t.client)||void 0===x?void 0:x.email),390,E+85),N.text(Object(F.f)(null===(k=null==t?void 0:t.client)||void 0===k?void 0:k.website),390,E+95),N.setTextColor(0,0,0),N.setLineWidth(.1),N.line(5,L-70,607,L-70),N.text("For any enquiries, write to us ".concat(Object(F.f)(null===(A=null==t?void 0:t.client)||void 0===A?void 0:A.email)," \nor Logon to ").concat(Object(F.f)(null===(R=null==t?void 0:t.client)||void 0===R?void 0:R.website)),10,L-60),N.setTextColor(255,0,0),N.setFont("bold");var B=N.getTextWidth("Notice:");N.text("Notice:",310,L-60),N.setFont("none"),N.setTextColor(0,0,0),N.text("Pay your bills before due date to avoid late payment surcharge",310+B,L-60),N.text("and disconnection.",310,L-50),N.text("You can log onto ".concat(Object(F.f)(null===(I=null==t?void 0:t.client)||void 0===I?void 0:I.website)," to pay your invoices \nTerms & Conditions for Supply of Utility Services"),310,L-40),"function"==typeof N.putTotalPages&&N.putTotalPages("1");var j=N.output("blob");window.open(URL.createObjectURL(j))}},{key:"downloadBillNewReport",value:function(t){for(var e,i,n,l,a,o,r,s,c,u,d,m,f,h,b,p,g,v,y,C,S=this,T=[],D=[],P=[],w=[],x=[],k=[],A=[],R=[],I=[],N=[],M=0;M<t.bills.length;M++)this.consumptionRoundOffFormat=null!==(e=Object(F.e)("ConsumptionRoundOff",t.bills[M].utilityTypeId))&&void 0!==e?e:this.envService.consumptionRoundOffFormat,T.push(t.unitNumber),T.push(t.bills[M].deviceName),T.push(this.decimalPipe.transform(t.bills[M].previousReading,this.consumptionRoundOffFormat)),T.push(this.decimalPipe.transform(t.bills[M].presentReading,this.consumptionRoundOffFormat)),T.push(t.bills[M].isDifferentiateBill?this.decimalPipe.transform(t.bills[M].presentReading-t.bills[M].previousReading,this.consumptionRoundOffFormat)+" "+t.bills[M].measuringUnit:this.decimalPipe.transform(t.bills[M].consumption,this.consumptionRoundOffFormat)+" "+t.bills[M].measuringUnit),"BTU"===t.bills[M].utilityType&&t.bills[M].billTransactions&&t.bills[M].billTransactions.length&&t.bills[M].billTransactions.findIndex((function(t){return t.measuringUnitId&&2===t.measuringUnitId}))>-1?T.push(this.decimalPipe.transform(.2843*t.bills[M].consumption,this.roundFormat)):T.push(0),D.push(T),T=[];for(var O=0,W=0;W<t.bills.length;W++){this.consumptionRoundOffFormat=null!==(i=Object(F.e)("ConsumptionRoundOff",t.bills[W].utilityTypeId))&&void 0!==i?i:this.envService.consumptionRoundOffFormat;for(var U=t.bills[W],E=0;E<U.billTransactions.length;E++)U.billTransactions[E].headAmount&&(T.push(U.billNumber),T.push(U.billTransactions[E].headDisplay),"BTU"===U.utilityType&&U.billTransactions&&U.billTransactions.length&&U.billTransactions[E]&&U.billTransactions[E].measuringUnitId&&2===U.billTransactions[E].measuringUnitId?(T.push(this.decimalPipe.transform(.2843*U.consumption,this.roundFormat)),T.push("TR-HR"),T.push(U.consumptionRate)):(T.push(this.decimalPipe.transform(U.consumption,this.consumptionRoundOffFormat)),T.push(U.measuringUnit),T.push(U.consumptionRate)),T.push(this.decimalPipe.transform(U.billTransactions[E].headAmount,this.roundFormat)),R.push(T),T=[],O+=U.billTransactions[E].headAmount)}T.push(t.accountNumber),T.push(t.fromDateLocal+"-"+t.toDateLocal),T.push(this.currencyPipe.transform(t.previousDueAmount,this.currency.toString(),!0,this.roundFormat)),T.push(t.billAmountLocal),w.push(T),t.billCharges.forEach((function(t){if("VAT"!==t.headDisplay){var e=P.find((function(e){return e.label===t.headDisplay}));e?e.value+=t.headAmount:P.push({label:t.headDisplay,value:t.headAmount})}})),P.forEach((function(t){I.push({label:t.label,value:S.currencyPipe.transform(t.value,S.currency.toString(),!0,S.roundFormat)}),O+=t.value})),I.push({label:"Total Charges for Current Period",value:this.currencyPipe.transform(O,this.currency.toString(),!0,this.roundFormat)}),t.billTaxDetails.forEach((function(t){var e=I.find((function(e){return e.label===t.taxDisplayName}));if(e){var i=Number(e.value.replace(S.currency,"").trim())+Number(t.taxAmount);e.value=S.currencyPipe.transform(i,S.currency.toString(),!0,S.roundFormat)}else I.push({label:t.taxDisplayName,value:S.currencyPipe.transform(t.taxAmount,S.currency.toString(),!0,S.roundFormat)})})),I.push({label:"Previous Outstanding Amount",value:this.currencyPipe.transform(t.previousDueAmount,this.currency.toString(),!0,this.roundFormat)},{label:"Total Amount Due",value:this.currencyPipe.transform(t.billAmount+t.previousDueAmount,this.currency.toString(),!0,this.roundFormat)}),x.push({label:"Bill No",value:null!==(n=null==t?void 0:t.billNumber)&&void 0!==n?n:""},{label:"Date of issue",value:null!==(l=null==t?void 0:t.billDateLocal)&&void 0!==l?l:""},{label:"Due Date",value:null!==(a=null==t?void 0:t.dueDateLocal)&&void 0!==a?a:""}),k.push({label:"Customer Name",value:null!==(o=null==t?void 0:t.ownerName)&&void 0!==o?o:""},{label:"Customer AccountNumber",value:null!==(r=null==t?void 0:t.accountNumber)&&void 0!==r?r:""},{label:"Unit No",value:null!==(s=null==t?void 0:t.unitNumber)&&void 0!==s?s:""},{label:"Address",value:null!==(u=null===(c=null==t?void 0:t.receiverDetails[0])||void 0===c?void 0:c.address1)&&void 0!==u?u:""},{label:"City",value:null!==(m=null===(d=null==t?void 0:t.receiverDetails[0])||void 0===d?void 0:d.city)&&void 0!==m?m:""},{label:"P.O Box",value:null!==(h=null===(f=null==t?void 0:t.receiverDetails[0])||void 0===f?void 0:f.zipPostalCode)&&void 0!==h?h:""},{label:"Phone number",value:null!==(p=null===(b=null==t?void 0:t.receiverDetails[0])||void 0===b?void 0:b.phoneNumber)&&void 0!==p?p:""},{label:"Fax Number",value:""},{label:"Client",value:null!==(v=null===(g=null==t?void 0:t.client)||void 0===g?void 0:g.clientName)&&void 0!==v?v:""},{label:"Client TRN",value:null!==(C=null===(y=null==t?void 0:t.client)||void 0===y?void 0:y.trnNo)&&void 0!==C?C:""}),A.push({firstItem:"Billing period",secondItem:"From:",thirdItem:t.fromDateLocal,fourthItem:"To:",fifthItem:t.toDateLocal});var L=[];T=[],t&&t.bills&&t.bills.length&&t.bills.forEach((function(t){if(t.billTariffDetails&&t.billTariffDetails.length)for(var e=0;e<t.billTariffDetails.length;e++)t.billTariffDetails[e].slabSettingsId&&t.billTariffDetails[e].slabSettingsId>0&&0==e?L=["Slab","Min Consumption","Max Consumption","Consumption","Rate","Amount"]:0==t.billTariffDetails[e].slabSettingsId&&0==e&&(L=["Season","Week Type","Peak Type","Consumption","Rate","Amount"]),T.push(t.billTariffDetails[e].season),T.push(t.billTariffDetails[e].weekType),T.push(t.billTariffDetails[e].peakType),T.push(t.billTariffDetails[e].consumption),T.push(t.billTariffDetails[e].rate),T.push(t.billTariffDetails[e].amount),N.push(T),T=[]})),this.getNewBillReport(["Unit No","Meter No","Previous Reading","Present Reading","Consumption","Consumption TR-HR"],D,["Customer AccountNumber","Billing Period","Previous Due","Total for current period"],w,x,k,A,["Charges","Consumption","Measuring Unit","Tariff","Total"],R,t,I,L,N)}},{key:"getNewBillReport",value:function(t,e,i,n,l,a,o,r,s,c,u,d,m){var f,h,b,p,g,v,y,C,S=new Pt.default({orientation:"portrait",unit:"pt",format:"letter"}),T=null!==(h=null===(f=null==c?void 0:c.client)||void 0===f?void 0:f.clientName)&&void 0!==h?h:"",D=S.getTextWidth(T.trim());S.setTextColor(0,0,0),S.setFontSize(17),S.setFont("Cambria"),S.text(T,Number(S.internal.pageSize.width/2)-Number(0!=D?D/2:0),18),this.addImage(S,c),S.setLineWidth(.1),S.line(Number(S.internal.pageSize.width/2)-Number(0!=D?D/2:0),21,Number(S.internal.pageSize.width/2)-Number(0!=D?D/2:0)+D,21),S.setFontSize(13);var P="";c&&c.client&&c.client.addresses[0]&&","==(P=null!==(v=null!==(p=null===(b=c.client.addresses[0].address1)||void 0===b?void 0:b.toLowerCase())&&void 0!==p?p:","+(null===(g=c.client.addresses[0].city)||void 0===g?void 0:g.toLowerCase()))&&void 0!==v?v:"").trim()&&(P=""),S.text(P,Number(S.internal.pageSize.width/2)-Number(0!=D?D/2:0)+5,30),S.setLineWidth(.1),S.setFontSize(14),S.text("Billing Statement",30,41),S.autoTable("",l,{startX:10,startY:50,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:150,halign:"left"},1:{cellWidth:190,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"},didParseCell:function(t){t.cell.styles.cellPadding=1}});var w=Number(this.decimalPipe.transform(S.autoTable.previous.finalY,"1.0-0"));S.autoTable("",o,{startX:10,startY:w,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:150,halign:"left"},1:{cellWidth:95,halign:"center"},2:{cellWidth:95,halign:"center"},3:{cellWidth:95,halign:"center"},4:{cellWidth:95,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0]},didParseCell:function(t){t.cell.styles.cellPadding=1}});var x=Number(this.decimalPipe.transform(S.autoTable.previous.finalY,"1.0-0"));S.autoTable("",a,{startX:10,startY:x,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:150,halign:"left"},1:{cellWidth:380,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0]},didParseCell:function(t){t.cell.styles.cellPadding=1}});var k=Number(this.decimalPipe.transform(S.autoTable.previous.finalY,"1.0-0"));S.setFont("Cambria"),S.setFontSize(10),S.text("Meter Read-Outs".toUpperCase(),30,k+15),S.autoTable(t,e,{startX:10,startY:k+30,didDrawPage:function(t){var e="Page "+t.pageCount;S.setFontSize(10);var i=S.internal.pageSize.height||S.internal.pageSize.getHeight();S.text(e,t.settings.margin.left,i-10)},styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"center"},1:{cellWidth:95,halign:"center"},2:{cellWidth:95,halign:"center"},3:{cellWidth:95,halign:"center"},4:{cellWidth:74,halign:"center"},5:{cellWidth:75,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(t){t.cell.styles.cellPadding=1}});var A=Number(this.decimalPipe.transform(S.autoTable.previous.finalY,"1.0-0"));S.setFontSize(10),S.text("Charges Breakdown".toUpperCase(),30,A+15),S.autoTable(r,s,{startX:10,startY:A+30,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:60,halign:"center"},1:{cellWidth:155,halign:"center"},2:{cellWidth:85,halign:"center"},3:{cellWidth:85,halign:"center"},4:{cellWidth:74,halign:"center"},5:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(t){t.cell.styles.cellPadding=1}});var R=Number(this.decimalPipe.transform(S.autoTable.previous.finalY,"1.0-0"));S.autoTable(d,m,{startX:10,startY:R+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:130,halign:"center"},1:{cellWidth:85,halign:"center"},2:{cellWidth:85,halign:"center"},3:{cellWidth:85,halign:"center"},4:{cellWidth:74,halign:"center"},5:{cellWidth:75,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(t){t.cell.styles.cellPadding=1}});var F=Number(this.decimalPipe.transform(S.autoTable.previous.finalY,"1.0-0"));S.autoTable("",u,{startX:10,startY:F+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{bottom:35,left:230},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:235,fontStyle:"italic"},1:{cellWidth:100}},didParseCell:function(t){1==t.column.index&&(t.cell.styles.halign="right"),t.cell.styles.cellPadding=1},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});var I=Number(this.decimalPipe.transform(S.autoTable.previous.finalY,"1.0-0"));S.setFillColor(241,241,244),S.rect(30,I+20,535,80,"FD"),S.setFillColor(0,0,0),S.setFontSize(9),S.text(null===(C=null===(y=null==c?void 0:c.client)||void 0===y?void 0:y.termsConditions[0])||void 0===C?void 0:C.termsAndCondition.replace("{{ClientName}}",c.client.clientName).replace("{{TRNNumber}}",c.client.trnNo).replace("{{Currency}}",this.currency),60,I+30),S.setTextColor(0,0,0),S.line(5,I+110,607,I+110);var N=S.internal.pageSize.height;S.text("Notice :- Please tear and attach the slip  along with your payment",30,N-90),S.autoTable(i,n,{startX:10,startY:N-80,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:120,halign:"center"},1:{cellWidth:200,halign:"center"},2:{cellWidth:100,halign:"right"},3:{cellWidth:120,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(t){t.cell.styles.cellPadding=1}}),"function"==typeof S.putTotalPages&&S.putTotalPages("1");var M=S.output("blob");window.open(URL.createObjectURL(M))}},{key:"downloadBillNewFormatReport",value:function(t){for(var e,i,n,l,a,o,r,s,c,u,d,m,f=this,h=[],b=[],p=[],g=[],v=[],y=[],C=[],S=[],T=["Meter No","Tarif","Previous Reading KWH","Present Reading KWH","Consumption","Consumption TR-HR","Unit Rate "+this.currency+"/TR-HR","Amount"],D=0;D<t.bills.length;D++)this.consumptionRoundOffFormat=null!==(e=Object(F.e)("ConsumptionRoundOff",t.bills[D].utilityTypeId))&&void 0!==e?e:this.envService.consumptionRoundOffFormat,h.push(t.bills[D].deviceName),h.push(t.bills[D].utilityType),h.push(this.decimalPipe.transform(t.bills[D].previousReading,this.consumptionRoundOffFormat)),h.push(this.decimalPipe.transform(t.bills[D].presentReading,this.consumptionRoundOffFormat)),h.push(this.decimalPipe.transform(t.bills[D].consumption,this.consumptionRoundOffFormat)),"BTU"===t.bills[D].utilityType&&t.bills[D].billTransactions&&t.bills[D].billTransactions.length&&t.bills[D].billTransactions.findIndex((function(t){return t.measuringUnitId&&2===t.measuringUnitId}))>-1?h.push(this.decimalPipe.transform(.2843*t.bills[D].consumption,this.roundFormat)):h.push(0),h.push(t.bills[D].consumptionRate),h.push(t.bills[D].billAmountLocal),b.push(h),h=[];for(var P=0;P<t.bills.length;P++){this.consumptionRoundOffFormat=null!==(i=Object(F.e)("ConsumptionRoundOff",t.bills[P].utilityTypeId))&&void 0!==i?i:this.envService.consumptionRoundOffFormat;for(var w=t.bills[P],x=0;x<w.billTransactions.length;x++)h.push(w.utilityType+"-"+w.billTransactions[x].headDisplay),h.push(this.decimalPipe.transform(w.consumption,this.consumptionRoundOffFormat)),h.push(w.consumptionUnit),h.push(w.consumptionRate),h.push(this.decimalPipe.transform(w.billTransactions[x].headAmount,this.roundFormat)),C.push(h),h=[]}h.push(t.accountNumber),h.push(t.fromDateLocal+"-"+t.toDateLocal),h.push(t.billAmountLocal),g.push(h);var k=[];t.bills.forEach((function(t){if(t.billTransactions&&t.billTransactions.length){var e=["consumption","consumptioncharge"];t.billTransactions.forEach((function(t){if(!e.includes(t.headDisplay.toLowerCase())){var i=k.find((function(e){return e.label===t.headDisplay}));i?i.value+=t.headAmount:k.push({label:t.headDisplay,value:t.headAmount})}}))}})),t.billCharges.forEach((function(t){if("VAT"!==t.headDisplay){var e=k.find((function(e){return e.label===t.headDisplay}));e?e.value+=t.headAmount:k.push({label:t.headDisplay,value:t.headAmount})}})),k.forEach((function(t){p.push({label:t.label,value:f.currencyPipe.transform(t.value,f.currency.toString(),!0,f.roundFormat)})})),t.billTaxDetails&&t.billTaxDetails.length&&t.billTaxDetails.forEach((function(t){p.push({label:t.taxDisplayName,value:f.currencyPipe.transform(t.taxAmount,f.currency.toString(),!0,f.roundFormat)})})),S.push({label:"Total for Current Period",value:this.currencyPipe.transform(t.billAmount+t.previousDueAmount,this.currency.toString(),!0,this.roundFormat)}),v.push({label:"Bill No",value:": "+t.billNumber},{label:"Date of issue",value:": "+t.billDateLocal},{label:"Due Date",value:": "+t.dueDateLocal}),y.push({label:"Billing period",value:":  From: ".concat(t.fromDateLocal," To: ").concat(t.toDateLocal," ")},{label:"Customer Account",value:": "+t.accountNumber},{label:"Customer Name",value:": "+t.ownerName},{label:"Unit No",value:": "+t.unitNumber},{label:"Address",value:": "+(null===(l=null===(n=null==t?void 0:t.client)||void 0===n?void 0:n.addresses[0])||void 0===l?void 0:l.address1)},{label:"City",value:": "+(null===(o=null===(a=null==t?void 0:t.client)||void 0===a?void 0:a.addresses[0])||void 0===o?void 0:o.city)},{label:"P.O Box",value:": "+(null===(s=null===(r=null==t?void 0:t.client)||void 0===r?void 0:r.addresses[0])||void 0===s?void 0:s.zipPostalCode)},{label:"Phone number",value:null!==(u=": "+(null===(c=null==t?void 0:t.receiverDetails[0])||void 0===c?void 0:c.phoneNumber))&&void 0!==u?u:""},{label:"Fax Number",value:": "},{label:"Client",value:": "+(null===(d=null==t?void 0:t.client)||void 0===d?void 0:d.clientName)},{label:"Client TRN",value:": "+(null===(m=null==t?void 0:t.client)||void 0===m?void 0:m.trnNo)}),this.getNewBillFormatReport(T,b,p,["Customer Number","Billing Period","Total for current period"],g,v,y,t,S)}},{key:"getNewBillFormatReport",value:function(t,e,i,n,l,a,o,r,s){var c,u,d=new Image;d.src=this.filePath+"/uploads/"+r.client.photo;var m=new Pt.default({orientation:"portrait",unit:"pt",format:"letter"});m.rect(5,5,m.internal.pageSize.width-10,m.internal.pageSize.height-10,"S"),m.setTextColor(0,0,0),m.setFontSize(11),m.setFont("Cambria"),m.text("Billing Statement".toUpperCase(),10,20),d.height&&m.addImage(d,"png",450,35,80,55),m.setLineWidth(.1),m.autoTable("",a,{startX:10,startY:35,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:15},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:190,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"},didParseCell:function(t){t.cell.styles.cellPadding=1.5}});var f=Number(this.decimalPipe.transform(m.autoTable.previous.finalY,"1.0-0"));m.autoTable("",o,{startX:10,startY:f,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:15},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:380,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0]},didParseCell:function(t){t.cell.styles.cellPadding=1.5}});var h=Number(this.decimalPipe.transform(m.autoTable.previous.finalY,"1.0-0"));m.setFont("Cambria"),m.text("Meter Read-Out".toUpperCase(),10,h+15),m.autoTable(t,e,{startX:10,startY:h+30,didDrawPage:function(t){var e="Page "+t.pageCount;m.setFontSize(10);var i=m.internal.pageSize.height||m.internal.pageSize.getHeight();m.text(e,t.settings.margin.left,i-10)},styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:15},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:65,halign:"center"},1:{cellWidth:72,halign:"center"},2:{cellWidth:80,halign:"center"},3:{cellWidth:80,halign:"center"},4:{cellWidth:72,halign:"center"},5:{cellWidth:72,halign:"center"},6:{cellWidth:72,halign:"center"},7:{cellWidth:72,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(t){t.cell.styles.cellPadding=1.5}});var b=Number(this.decimalPipe.transform(m.autoTable.previous.finalY,"1.0-0"));m.autoTable("",i,{startX:10,startY:b+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{bottom:35,left:250},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:250,fontStyle:"italic"},1:{cellWidth:100}},didParseCell:function(t){1==t.column.index&&(t.cell.styles.halign="right"),t.cell.styles.cellPadding=1.5},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});var p=Number(this.decimalPipe.transform(m.autoTable.previous.finalY,"1.0-0"));m.line(5,p+10,607,p+10),m.autoTable("",s,{startX:10,startY:p+20,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{bottom:35,left:250},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:250,fontStyle:"italic"},1:{cellWidth:100}},didParseCell:function(t){1==t.column.index&&(t.cell.styles.halign="right"),t.cell.styles.cellPadding=1.5},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});var g=Number(this.decimalPipe.transform(m.autoTable.previous.finalY,"1.0-0"));m.line(5,g+10,607,g+10),m.text(null===(u=null===(c=null==r?void 0:r.client)||void 0===c?void 0:c.termsConditions[0])||void 0===u?void 0:u.termsAndCondition.replace("{{ClientName}}",r.client.clientName).replace("{{TRNNumber}}",r.client.trnNo).replace("{{Currency}}",this.currency),10,g+30);var v=m.internal.pageSize.height||m.internal.pageSize.getHeight();m.text("Notice :- Please tear and attach the slip  along with your payment",10,v-90),m.autoTable(n,l,{startX:10,startY:v-70,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:15},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"center"},1:{cellWidth:340,halign:"center"},2:{cellWidth:150,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(t){t.cell.styles.cellPadding=1.5}}),"function"==typeof m.putTotalPages&&m.putTotalPages("1");var y=m.output("blob");window.open(URL.createObjectURL(y))}},{key:"onRefund",value:function(t){var e=this;t.type="Refund",this.dialog.open(Rt,{data:t}).afterClosed().subscribe((function(t){t&&e.billSettlementService.saveRefund(t).subscribe({next:function(t){e.notificationMessage("Refund saved successfully","green-snackbar"),e.onFilterData()},error:function(t){e.notificationMessage(t,"red-snackbar")}})}))}},{key:"getMovedOutTenants",value:function(){var t=this;this.contracts=null,this.clientId=parseInt(this.cookieService.get("globalClientId")),this.contractService.getMovedOutTenants(this.clientId).subscribe((function(e){(e=e.map((function(t){return new D(t)}))).forEach((function(e){e.securityDepositLocal=t.currencyPipe.transform(e.securityDeposit,t.currency.toString(),!0,t.roundFormat),e.contractDateLocal=t.date.transform(e.contractDate.toString(),t.dateFormat.toString()),e.contractEndDateLocal=t.date.transform(e.contractEndDate.toString(),t.dateFormat.toString()),e.securityDepositInHand=e.receivedAmount-e.refundAmount,e.securityDepositInHandLocal=t.currencyPipe.transform(e.securityDepositInHand,t.currency.toString(),!0,t.roundFormat),e.receivedAmountLocal=t.currencyPipe.transform(e.receivedAmount,t.currency.toString(),!0,t.roundFormat),e.refundAmountLocal=t.currencyPipe.transform(e.refundAmount,t.currency.toString(),!0,t.roundFormat),e.remainingAmountLocal=t.currencyPipe.transform(e.remainingAmount,t.currency.toString(),!0,t.roundFormat)})),t.subject$.next(e)})),this.listData=new p.k(this.contracts),this.data$.pipe(Object(v.a)((function(t){return!!t}))).subscribe((function(e){t.contracts=e,t.listData.data=e})),this.ngAfterViewInit()}},{key:"getContractsAboutToExpire",value:function(){var t=this;this.contracts=[],this.clientId=parseInt(this.cookieService.get("globalClientId")),this.contractService.getContractsAboutToExpire(this.clientId).subscribe((function(e){(e=e.map((function(t){return new D(t)}))).forEach((function(e){e.securityDepositLocal=t.currencyPipe.transform(e.securityDeposit,t.currency.toString(),!0,t.roundFormat),e.contractDateLocal=t.date.transform(e.contractDate.toString(),t.dateFormat.toString()),e.contractEndDateLocal=t.date.transform(e.contractEndDate.toString(),t.dateFormat.toString()),e.securityDepositInHand=e.receivedAmount-e.refundAmount,e.securityDepositInHandLocal=t.currencyPipe.transform(e.securityDepositInHand,t.currency.toString(),!0,t.roundFormat),e.receivedAmountLocal=t.currencyPipe.transform(e.receivedAmount,t.currency.toString(),!0,t.roundFormat),e.refundAmountLocal=t.currencyPipe.transform(e.refundAmount,t.currency.toString(),!0,t.roundFormat),e.remainingAmountLocal=t.currencyPipe.transform(e.remainingAmount,t.currency.toString(),!0,t.roundFormat)})),t.subject$.next(e)})),this.listData=new p.k(this.contracts),this.data$.pipe(Object(v.a)((function(t){return!!t}))).subscribe((function(e){t.contracts=e,t.listData.data=e})),this.ngAfterViewInit()}},{key:"toggleMovedOutTenant",value:function(t){this.movedOut=!t,this.movedOut&&(this.reminder=t),this.getContractDetails()}},{key:"toggleContractsReminder",value:function(t){this.reminder=!t,this.reminder&&(this.movedOut=t),this.getContractDetails()}},{key:"onRefundHistory",value:function(t){this.router.navigate(["bills/create-refund"],{queryParams:{id:t.tenantId}})}},{key:"toggleAllSelection",value:function(){this.selectFilterModes=this.allSelected.selected?[this.filterModes.map((function(t){return t.value})),0]:[]}},{key:"togglePerOne",value:function(){this.allSelected.selected&&this.allSelected.deselect(),this.selectFilterModes.length>=this.filterModes.length&&this.allSelected.select()}},{key:"onReceivePayment",value:function(t){var e=this;t&&(t.type="Receive SD Payment",this.dialog.open(Rt,{data:t}).afterClosed().subscribe((function(i){i&&e.onGenerateInoice(t,i)})))}},{key:"onSavePayment",value:function(t){var e=this;this.billSettlementService.saveBillPayments(t).subscribe({next:function(t){t?(e.notificationMessage("Security deposit payment save successfully","green-snackbar"),e.getContractDetails()):e.notificationMessage("Security deposit payment save failed","red-snackbar")},error:function(t){e.notificationMessage("Security deposit payment save failed","red-snackbar")}})}},{key:"updatePaymentDetails",value:function(t,e){t.paymentTransactions.forEach((function(t){return t.billId=e}))}},{key:"onPrintReceipt",value:function(t){var e=this;this.pdfsToMerge=[],t.billMasters&&t.billMasters.length&&t.billMasters.filter((function(t){return t.paymentId&&t.paymentId>0&&5==t.billTypeId})).forEach((function(t){e.onGetPaymentDetail(t.paymentId)}))}},{key:"receiptView",value:function(t){var e=this;this.billService.sdReceiptView(t).subscribe({next:function(t){t?e.downloadSDFile(t):e.notificationMessage("No data to print","red-snackbar")},error:function(t){e.notificationMessage("No data to print","red-snackbar")}})}},{key:"downloadSDFile",value:function(e){return Object(f.a)(this,void 0,void 0,regeneratorRuntime.mark((function i(){var n,l,a,o,r,s,c,u;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,Ut.PDFDocument.create();case 2:n=i.sent,l=t(e),i.prev=4,l.s();case 6:if((a=l.n()).done){i.next=16;break}return o=a.value,i.next=10,Ut.PDFDocument.load(o);case 10:return r=i.sent,i.next=13,n.copyPages(r,r.getPageIndices());case 13:i.sent.forEach((function(t){n.addPage(t)}));case 14:i.next=6;break;case 16:i.next=21;break;case 18:i.prev=18,i.t0=i.catch(4),l.e(i.t0);case 21:return i.prev=21,l.f(),i.finish(21);case 24:return i.next=26,n.save();case 26:s=i.sent,c=new Blob([s],{type:"application/pdf"}),u=window.URL.createObjectURL(c),window.open(u);case 30:case"end":return i.stop()}}),i,null,[[4,18,21,24]])})))}},{key:"onGetPaymentDetail",value:function(t){var e=this;this.payments=[];var i=Number(this.cookieService.get("globalClientId"));this.billService.getPaymentDetail(t,i).subscribe({next:function(t){t.forEach((function(t){t.paymentDateLocal=e.date.transform(t.paymentDate.toString(),e.dateFormat.toString()),t.referenceDateLocal=e.date.transform(t.referenceDate.toString(),e.dateFormat.toString()),t.paymentAmountLocal=e.currencyPipe.transform(t.paymentAmount,e.currency.toString(),!0,e.roundFormat),t.advanceAmountLocal=e.currencyPipe.transform(t.advanceAmount,e.currency.toString(),!0,e.roundFormat),t.billMasters&&t.billMasters.length&&t.billMasters.forEach((function(t){var i,n,l,a,o;t.billDateLocal=e.date.transform(null===(i=null==t?void 0:t.billDate)||void 0===i?void 0:i.toString(),e.dateFormat.toString()),t.billAmountLocal=e.currencyPipe.transform(null==t?void 0:t.billAmount,e.currency.toString(),!0,e.roundFormat),t.fromDateLocal=e.date.transform(null===(n=null==t?void 0:t.fromDate)||void 0===n?void 0:n.toString(),e.dateFormat.toString()),t.toDateLocal=e.date.transform(null===(l=null==t?void 0:t.toDate)||void 0===l?void 0:l.toString(),e.dateFormat.toString()),t.dueDateLocal=e.date.transform(null===(a=null==t?void 0:t.dueDate)||void 0===a?void 0:a.toString(),e.dateFormat.toString()),t.paidLocal=e.currencyPipe.transform(null===(o=null==t?void 0:t.paid)||void 0===o?void 0:o.toString(),e.currency.toString(),!0,e.roundFormat)}))})),e.payments=t,e.receiptView(e.payments)},error:function(){e.notificationMessage("Payment details not found","red-snackbar")}})}},{key:"downloadFile",value:function(){return Object(f.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var i,n,l,a,o,r,s,c,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ut.PDFDocument.create();case 2:i=e.sent,n=t(this.pdfsToMerge),e.prev=4,n.s();case 6:if((l=n.n()).done){e.next=19;break}return a=l.value,e.next=10,fetch(a).then((function(t){return t.arrayBuffer()}));case 10:return o=e.sent,e.next=13,Ut.PDFDocument.load(o);case 13:return r=e.sent,e.next=16,i.copyPages(r,r.getPageIndices());case 16:e.sent.forEach((function(t){i.addPage(t)}));case 17:e.next=6;break;case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(4),n.e(e.t0);case 24:return e.prev=24,n.f(),e.finish(24);case 27:return e.next=29,i.save();case 29:s=e.sent,c=new Blob([s],{type:"application/pdf"}),u=window.URL.createObjectURL(c),window.open(u);case 33:case"end":return e.stop()}}),e,this,[[4,21,24,27]])})))}},{key:"downloadReport",value:function(t){var e=[],i=[],n="",l=Array.from(new Set(t.billMasters.map((function(t){return t.billNumber})))),a=Array.from(new Set(t.billMasters.map((function(t){return t.unitNumber}))));l&&l.length&&l.forEach((function(t){})),a&&a.length&&a.forEach((function(t){n+=t+","})),i.push({label:"Receipt Number:",value:t.paymentNumber},{label:"Receipt Date:",value:t.paymentDateLocal},{label:"Account Number:",value:t.accountNumber},{label:"Unit Number:",value:0===n.trim().indexOf(",")?n.trim().slice(1).slice(0,-1):n.trim().slice(0,-1)},{label:"Mode of payment:",value:t.paymentMode});var o=0;t.billMasters.forEach((function(t){o+=t.paid}));var r=t.outStandingAmount-o;e.push({label:"Total Outstanding Amount :",value:this.currencyPipe.transform(t.outStandingAmount,this.currency.toString(),!0,this.roundFormat)},{label:"Received Payments :",value:t.paymentAmountLocal},{label:"",value:""},{label:"Balance Outstanding :",value:this.currencyPipe.transform(r,this.currency.toString(),!0,this.roundFormat)}),this.getReport(t,e,i)}},{key:"addImage",value:function(t,e){var i;try{if(e&&e.billMasters&&e.billMasters.length&&e.billMasters[0]&&e.billMasters[0].client&&e.billMasters[0].client.imageProperties&&e.billMasters[0].client.imageProperties.length){var n=e.billMasters[0].client.imageProperties.find((function(t){return"receipt"===t.imageType.trim().toLowerCase()}));if(n){var l=new Image;l.src=this.filePath+"/uploads/"+(null===(i=null==e?void 0:e.billMasters[0].client)||void 0===i?void 0:i.photo),l.onload=function(){t.addImage(l,n.imgX,n.imgY,n.imgW,n.imgH)}}else this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar")}else this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar")}catch(a){this.notificationMessage("Image not found.","red-snackbar")}return t}},{key:"getReport",value:function(t,e,i){var n,l,a,o,r,s,c,u,d,m,f,h,b,p,g,v,y,C,S,T,D,P,w,x,k,A,R,I,N,M,O,W,U,E,L,z,B,j,G,Y,H,V,$,_,X,q=new Pt.default({orientation:"portrait",unit:"pt",format:"letter"});q.rect(5,5,q.internal.pageSize.width-10,q.internal.pageSize.height-10,"S"),q.setFontSize(30),this.addImage(q,t),q.setTextColor(0,0,0),q.setFontSize(14),q.setFont("Cambria","bold"),q.text("SECURITY DEPOSIT PAYMENT RECEIPT",180,30),q.setFont("Cambria","normal"),q.setFontSize(14),q.text(Object(F.f)(null===(l=null===(n=null==t?void 0:t.billMasters[0])||void 0===n?void 0:n.client)||void 0===l?void 0:l.clientName).toUpperCase(),10,50),q.setFontSize(10),q.text("TRN: "+Object(F.f)(null===(o=null===(a=null==t?void 0:t.billMasters[0])||void 0===a?void 0:a.client)||void 0===o?void 0:o.trnNo),10,60),q.text("PO Box "+Object(F.f)(null===(c=null===(s=null===(r=null==t?void 0:t.billMasters[0])||void 0===r?void 0:r.client)||void 0===s?void 0:s.addresses[0])||void 0===c?void 0:c.zipPostalCode),10,70),q.text(Object(F.f)(null===(m=null===(d=null===(u=null==t?void 0:t.billMasters[0])||void 0===u?void 0:u.client)||void 0===d?void 0:d.addresses[0])||void 0===m?void 0:m.location,",")+Object(F.f)(null===(b=null===(h=null===(f=null==t?void 0:t.billMasters[0])||void 0===f?void 0:f.client)||void 0===h?void 0:h.addresses[0])||void 0===b?void 0:b.city,",")+Object(F.f)(null===(v=null===(g=null===(p=null==t?void 0:t.billMasters[0])||void 0===p?void 0:p.client)||void 0===g?void 0:g.addresses[0])||void 0===v?void 0:v.country,","),10,80),q.text("Phone: "+Object(F.f)(null===(C=null===(y=null==t?void 0:t.billMasters[0])||void 0===y?void 0:y.client)||void 0===C?void 0:C.phoneNo),10,90),q.text("Email: "+Object(F.f)(null===(T=null===(S=null==t?void 0:t.billMasters[0])||void 0===S?void 0:S.client)||void 0===T?void 0:T.email),10,100),q.text("Web: "+Object(F.f)(null===(P=null===(D=null==t?void 0:t.billMasters[0])||void 0===D?void 0:D.client)||void 0===P?void 0:P.website),10,110),q.setFillColor(241,241,244),q.setDrawColor(206,203,203),q.rect(10,120,250,90,"FD"),q.setTextColor(0,0,0),q.setFontSize(12),q.text(Object(F.f)(null==t?void 0:t.tenantName).toUpperCase(),20,135),q.text("CUSTOMER TRN: "+Object(F.f)(null==t?void 0:t.trn),20,155),q.text("unit #"+Object(F.f)(null===(w=null==t?void 0:t.billMasters[0])||void 0===w?void 0:w.unitNumber),20,170),q.setFontSize(10),q.text(Object(F.f)(null===(x=null==t?void 0:t.billMasters[0])||void 0===x?void 0:x.clientName),20,185),q.text(Object(F.f)(null===(A=null===(k=null==t?void 0:t.billMasters[0].client)||void 0===k?void 0:k.addresses[0])||void 0===A?void 0:A.city,",")+Object(F.f)(null===(N=null===(I=null===(R=null==t?void 0:t.billMasters[0])||void 0===R?void 0:R.client)||void 0===I?void 0:I.addresses[0])||void 0===N?void 0:N.country,","),20,200),q.setFontSize(9),q.autoTable("",i,{startX:210,startY:120,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:400},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:100,halign:"right"}},didParseCell:function(t){var e=t.column.index;0!=e&&1!=e||(t.cell.styles.rowHeight=1)},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});var K=Number(this.decimalPipe.transform(q.autoTable.previous.finalY,"1.0-0"));q.setLineWidth(.1),q.line(5,K+10,607,K+10),q.setTextColor(0,0,0),q.setFontSize(11),q.text("Management here by acknowledges the receipt of a security deposit on behalf of "+t.tenantName,20,K+30),q.text("tenant/owner in the amount of "+t.paymentAmountLocal+" for unit #"+(null===(M=null==t?void 0:t.billMasters[0])||void 0===M?void 0:M.unitNumber),20,K+45),q.text("Authorised signatory",20,K+100),q.setTextColor(0,0,0);var Q=K+120;q.setTextColor(255,0,0),q.setFontSize(9),q.text("Note: A Late Fee will be applied after the due date. A Default Payment \nPenalty will be added to any unit that is ".concat(null===(O=null==t?void 0:t.billMasters[0])||void 0===O?void 0:O.penaltyAfter," days or more in arrears."),320,Q+20),q.setTextColor(25,118,210),q.setFontSize(12),q.text("USAGE TIPS to reduce consumption:",10,Q+80),q.text("Please Try to:",10,Q+100),q.setTextColor(0,0,0),q.setFontSize(9),q.text("- Keep filters clean",30,Q+110),q.text("- Set thermostats between 23C and 25C",30,Q+120),q.text("- Keep vents unblocked",30,Q+130),q.text("- Keep doors and windows closed",30,Q+140),q.text("- Undertake regular maintenance of the system",30,Q+150),q.setTextColor(25,118,210),q.setFontSize(12),q.text("Please Do Not:",10,Q+170),q.setTextColor(0,0,0),q.setFontSize(9),q.text("- Set thermostats to 20C or lower",30,Q+180),q.text("- Block vents",30,Q+190),q.text("- Leave doors and windows open",30,Q+200),q.text("- Leave heat producing appliances near thermostats",30,Q+210),q.setFillColor(119,183,11);var Z=q.internal.pageSize.height||q.internal.pageSize.getHeight();q.rect(320,Q+60,280,Z-80-(Q+60),"FD"),q.setFont("Comic Sans"),q.setTextColor(255,255,255),q.setFontSize(16),q.text("ADVERTISE WITH US",360,Q+80);var J=q.getTextWidth("ADVERTISE WITH US");q.setLineWidth(.1),q.line(360,Q+85,360+J,Q+85),q.setFontSize(9),q.text("For advertisement, contact at",390,Q+95),q.text(Object(F.f)(null===(U=null===(W=null==t?void 0:t.billMasters[0])||void 0===W?void 0:W.client)||void 0===U?void 0:U.phoneNo),390,Q+105),q.text(Object(F.f)(null===(L=null===(E=null==t?void 0:t.billMasters[0])||void 0===E?void 0:E.client)||void 0===L?void 0:L.email),390,Q+115),q.text(Object(F.f)(null===(B=null===(z=null==t?void 0:t.billMasters[0])||void 0===z?void 0:z.client)||void 0===B?void 0:B.website),390,Q+125),q.setTextColor(0,0,0),q.setLineWidth(.1),q.line(5,Z-70,607,Z-70),q.text(null!==($=null!==(Y="For any enquiries, write to us "+(null===(G=null===(j=null==t?void 0:t.billMasters[0])||void 0===j?void 0:j.client)||void 0===G?void 0:G.email))&&void 0!==Y?Y:"\n or Logon to "+(null===(V=null===(H=t.billMasters[0])||void 0===H?void 0:H.client)||void 0===V?void 0:V.website))&&void 0!==$?$:"",10,Z-60),q.setTextColor(255,0,0),q.setFont("bold");var tt=q.getTextWidth("Notice:");q.text("Notice:",340,Z-60),q.setFont("none"),q.setTextColor(0,0,0),q.text("Pay your bills before due date to avoid late payment surcharge",340+tt,Z-60),q.text("and disconnection.",340,Z-50),q.text("You can log onto "+(null===(X=null===(_=null==t?void 0:t.billMasters[0])||void 0===_?void 0:_.client)||void 0===X?void 0:X.website)+" to pay your invoices \nTerms & Conditions for Supply of Utility Services",340,Z-40),"function"==typeof q.putTotalPages&&q.putTotalPages("1");var et=q.output("datauristring");this.pdfsToMerge.push(et)}},{key:"selectFilter",value:function(t){this.filterId=t.value,this.onFilterData()}},{key:"onFilterData",value:function(){1==this.filterId?this.getContractsAboutToExpire():2==this.filterId?this.getMovedOutTenants():3==this.filterId?this.getContracts(!0):4==this.filterId?this.getContracts(!1,!0):this.getContracts()}},{key:"onPrintAccountStatement",value:function(t){var e,i=this,n={fromDate:Nt(t.contractDate).format("YYYY-MM-DD"),toDate:Nt(t.contractEndDate).format("YYYY-MM-DD"),tenantId:""+(null!==(e=t.tenantId)&&void 0!==e?e:0),clientId:this.clientId};this.billService.getAccountStatement(n).subscribe({next:function(e){e=e.filter((function(t){return!1===t.isBillFailed}));var l=null;e.forEach((function(t){t.billDateLocal=i.date.transform(t.billDate.toString(),i.dateFormat.toString()),t.billAmountLocal=i.currencyPipe.transform(t.billAmount,i.currency.toString(),!0,i.roundFormat),t.creditNoteAmountLocal=i.currencyPipe.transform(t.creditNoteAmount,i.currency.toString(),!0,i.roundFormat),t.paidLocal=i.currencyPipe.transform(Number(t.paid),i.currency.toString(),!0,i.roundFormat),null!=l&&"Invoice"===t.entityType||"CreditNote"===t.entityType?t.previousDueAmount=Number(l)+Number(t.billAmount)-Number(t.paid)-Number(t.creditNoteAmount):null!=l&&"Payment"===t.entityType&&(t.previousDueAmount=Number(l)-Number(t.billAmount)-Number(t.paid)-Number(t.creditNoteAmount)),t.previousDueAmountLocal=i.currencyPipe.transform(t.previousDueAmount,i.currency.toString(),!0,i.roundFormat),l=Number(t.previousDueAmount)})),i.downloadAccountStatementReport(e,n,t)},error:function(t){i.notificationMessage("Account statement not found.","red-snackbar")}})}},{key:"downloadAccountStatementReport",value:function(t,e,i){var n=[],l=[],a=[],o=0,r=0;t.forEach((function(t){"Opening Due"!==t.entityType&&(o+=Number(t.billAmount),r+=Number(t.paid))}));for(var s=0;s<t.length;s++)n.push(t[s].billDateLocal),n.push(t[s].entityType),n.push(t[s].status),n.push(t[s].billAmountLocal),n.push(t[s].paidLocal),n.push(t[s].previousDueAmountLocal),a.push(n),n=[];n.push(""),n.push(""),n.push(""),n.push(""),n.push("Balance Due"),n.push(t[t.length-1].previousDueAmountLocal),a.push(n),l.push({label:"Opening Balance",value:t[0].previousDueAmountLocal},{label:"Invoiced Amount",value:this.currencyPipe.transform(o,this.currency.toString(),!0,this.roundFormat)},{label:"Amount Paid",value:this.currencyPipe.transform(r,this.currency.toString(),!0,this.roundFormat)},{label:"Balance Due",value:t[t.length-1].previousDueAmountLocal},{label:"Security Deposit Paid",value:i.receivedAmountLocal},{label:"Security Deposit Refunded",value:i.refundAmountLocal}),this.onExport(t,l,["Date","Transactions","Details","Amount","Payments","Balance"],a)}},{key:"getAccountStatementReport",value:function(t,e,i,n,l,a,o){var r,s,c,u=new Pt.default({orientation:"portrait",unit:"pt",format:"letter"});u.rect(5,5,u.internal.pageSize.width-10,u.internal.pageSize.height-10,"S"),this.addAccountStatementImage(u,t,"Account Statement"),u.setFontSize(30),u.setTextColor(0,0,0),u.setFontSize(14),u.setFont("Cambria"),u.text(Object(F.f)(t[0].client.clientName).toUpperCase(),u.internal.pageSize.width-600,50),u.setFontSize(10),u.text("TRN: "+t[0].client.trnNo,u.internal.pageSize.width-600,60),u.text("PO Box "+t[0].client.addresses[0].zipPostalCode,u.internal.pageSize.width-600,70),u.text(t[0].client.addresses[0].address1+","+t[0].client.addresses[0].country,u.internal.pageSize.width-600,80),u.text("Phone: "+t[0].client.phoneNo,u.internal.pageSize.width-600,90),u.text("Email: "+t[0].client.email+", Web: "+t[0].client.website,u.internal.pageSize.width-600,100),u.setTextColor(0,0,0),u.setFontSize(11),u.setFont("Cambria","bold"),u.text("Statement of Accounts".toUpperCase(),u.internal.pageSize.width-250,70),u.setFont("Cambria","normal"),u.setTextColor(0,0,0),u.setFontSize(9),u.line(u.internal.pageSize.width-250,80,607,80);var d=this.date.transform(a.fromDate.toString(),this.dateFormat.toString()),m=this.date.transform(a.toDate.toString(),this.dateFormat.toString());u.text((d+" - "+m).toString(),u.internal.pageSize.width-250,90),u.line(u.internal.pageSize.width-250,100,607,100),u.setFontSize(10),u.text("Account Summary",u.internal.pageSize.width-250,120),u.setFontSize(9),u.autoTable("",e,{startX:u.internal.pageSize.width-250,startY:130,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:u.internal.pageSize.width-250},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:135,halign:"left"},1:{cellWidth:100,halign:"right"}},didParseCell:function(t){t.cell.styles.cellPadding=1.8},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});var f=Number(this.decimalPipe.transform(u.autoTable.previous.finalY,"1.0-0"));u.setFontSize(10),u.text("Customer Details",10,120),u.setFillColor(241,241,244),u.setDrawColor(206,203,203),u.rect(10,130,250,f-30-100,"FD"),u.setTextColor(0,0,0),u.setFontSize(10),u.text(null===(r=t[0])||void 0===r?void 0:r.ownerName.toUpperCase(),20,145),u.text("CUSTOMER TRN: "+(null===(s=t[0])||void 0===s?void 0:s.trn),20,160),u.text("unit #"+(null==o?void 0:o.unitNumber),20,175),u.text("Account Number: "+(null===(c=t[0])||void 0===c?void 0:c.accountNumber),20,190),u.setFontSize(9),u.setLineWidth(.1),u.line(5,f+10,607,f+10),u.autoTable(i,n,{startX:10,startY:f+20,didDrawPage:function(t){var e="Page "+t.pageCount;"function"==typeof u.putTotalPages&&(e+=" of 1",u.rect(5,5,u.internal.pageSize.width-10,u.internal.pageSize.height-10,"S")),u.setFontSize(9);var i=u.internal.pageSize.height||u.internal.pageSize.getHeight();u.text(e,t.settings.margin.left,i-10)},styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:f+20,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:70,halign:"center"},1:{cellWidth:100,halign:"center"},2:{cellWidth:180,halign:"center"},3:{cellWidth:80,halign:"right"},4:{cellWidth:80,halign:"right"},5:{cellWidth:80,halign:"right"}},didParseCell:function(t){"Balance Due"===t.cell.raw&&(t.cell.styles.fontStyle="bold")},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]}}),u.setTextColor(0,0,0),Number(this.decimalPipe.transform(u.autoTable.previous.finalY,"1.0-0")),"function"==typeof u.putTotalPages&&u.putTotalPages("1");var h=u.output("blob");window.open(URL.createObjectURL(h))}},{key:"addAccountStatementImage",value:function(t,e,i){var n;try{if(e&&e.length&&e[0]&&e[0].client&&e[0].client.imageProperties&&e[0].client.imageProperties.length){var l=e[0].client.imageProperties.find((function(t){return t.imageType.trim().toLowerCase()===i.toLowerCase()}));if(l){var a=new Image;a.src=this.filePath+"/uploads/"+(null===(n=e[0].client)||void 0===n?void 0:n.photo),a.onload=function(){t.addImage(a,l.imgX,l.imgY,l.imgW,l.imgH)}}else this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar")}else this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar")}catch(o){this.notificationMessage("Image not found.","red-snackbar")}return t}},{key:"activateContract",value:function(t){var e=this;this.contracts.findIndex((function(e){return e.unitId===t.unitId&&e.id!==t.id&&0==e.isDeleted}))>-1?this.notificationMessage("Already a contract active on this unit","red-snackbar"):this.dialog.open(R.a,{data:{label:"Do you want to activate contract?",selected:!1}}).afterClosed().subscribe((function(i){i&&e.contractService.activateContractById(t.id).subscribe({next:function(){e.snackbar.open("Contract activated successfully",null,{duration:5e3,verticalPosition:"top",horizontalPosition:"center",panelClass:["green-snackbar"]}),e.getContractDetails()},error:function(){e.notificationMessage("Contract activation failed","red-snackbar")}})}))}},{key:"onExport",value:function(t,e,i,n){if(t&&t.length>0){if(this.getJsonData(t,e,i,n),null!=this.tableData&&this.tableData.length>0){var l=Lt.utils.aoa_to_sheet(this.tableData),a=Lt.utils.book_new();Lt.utils.book_append_sheet(a,l,"Sheet1"),Lt.writeFile(a,"Statement of Accounts.xlsx")}}else this.notificationMessage("No Data to Export","yellow-snackbar")}},{key:"getJsonData",value:function(t,e,i,n){var l=this;this.tableData=[];var a=[];a.push("Account Summary"),this.tableData.push(a),a=[],e.forEach((function(t){a.push(t.label),a.push(t.value),l.tableData.push(a),a=[]})),i.forEach((function(t){a.push(t)})),this.tableData.push(a),n.forEach((function(t){l.tableData.push(t)}))}},{key:"getWorkflowRules",value:function(){var t=this;this.workflowRuleService.getWorkflowRules(Number(this.clientId)).subscribe({next:function(e){if(e&&e.length&&(t.workflowRules=e,t.workflowRules&&t.workflowRules.length)){var i=t.workflowRules.find((function(t){return"Check Dues"===t.constraint}));i&&(t.checkDues=i.value)}t.getContractDetails()},error:function(e){t.workflowRules=[],t.getContractDetails()}})}},{key:"content",set:function(t){this.sort=t,this.sort&&this.listData&&(this.listData.sort=this.sort)}},{key:"visibleColumns",get:function(){return this.displayedColumns.filter((function(t){return t.visible})).map((function(t){return t.property}))}}]),e}(),ge.\u0275fac=function(t){return new(t||ge)(I.Nb(P.b),I.Nb(wt.b),I.Nb(r.f),I.Nb(m.f),I.Nb(r.d),I.Nb(Ft.a),I.Nb(r.g),I.Nb(S.a),I.Nb(Dt.a),I.Nb(N.a),I.Nb(Et.a),I.Nb(It.a),I.Nb(zt.a),I.Nb(Bt.a))},ge.\u0275cmp=I.Hb({type:ge,selectors:[["create-contract"]],viewQuery:function(t,e){var i;1&t&&(I.Jc(h.a,!0),I.Vc(b.a,!0),I.Vc(Xt,!0)),2&t&&(I.zc(i=I.cc())&&(e.paginator=i.first),I.zc(i=I.cc())&&(e.content=i.first),I.zc(i=I.cc())&&(e.allSelected=i.first))},inputs:{expiryReminder:"expiryReminder",displayedColumns:"displayedColumns"},decls:28,vars:14,consts:[["mode","card"],["current","Create Contracts",3,"crumbs"],["name","Create Contracts",3,"columns","filterChange"],[1,"actions","right","margin"],[1,"result"],[3,"ngModel","ngModelOptions","selectionChange","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["matTooltip","Create Contract","type","button","mat-mini-fab","","color","primary",1,"create","left","margin",3,"click"],["mat-table","","matSort","",3,"dataSource"],[4,"ngFor","ngForOf"],["matColumnDef","securityDepositInHandLocal"],["mat-header-cell","","class","header-align-right",4,"matHeaderCellDef"],["mat-cell","","class","header-align-right",4,"matCellDef"],["matColumnDef","remainingAmountLocal"],["matColumnDef","actions"],["class","actions-cell","mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["class","actions-cell","mat-cell","",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["class","clickable route-animations-elements","mat-row","",4,"matRowDef","matRowDefColumns"],[1,"paginator",3,"pageSize"],[3,"value"],[3,"matColumnDef",4,"ngIf"],[3,"matColumnDef"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell","",1,"header-align-right"],["mat-cell","",1,"header-align-right"],["mat-header-cell","","mat-sort-header","",1,"actions-cell"],["mat-cell","",1,"actions-cell"],["type","button","mat-icon-button","",3,"matMenuTriggerFor","click",4,"ngIf"],["yPosition","below","xPosition","before"],["actionsMenu","matMenu"],["mat-menu-item","",3,"click",4,"ngIf"],["mat-menu-item","",3,"disabled","click",4,"ngIf"],["mat-menu-item","",3,"disabled","click"],["mat-menu-item","",3,"click"],["type","button","mat-icon-button","",3,"matMenuTriggerFor","click"],["mat-header-row",""],["mat-row","",1,"clickable","route-animations-elements"]],template:function(t,e){1&t&&(I.Tb(0,"fury-page-layout",0),I.Tb(1,"fury-page-layout-header"),I.Ob(2,"fury-breadcrumbs",1),I.Sb(),I.Tb(3,"fury-page-layout-content"),I.Tb(4,"fury-list",2),I.bc("filterChange",(function(t){return e.onFilterChange(t)})),I.Tb(5,"div",3),I.Tb(6,"mat-form-field",4),I.Tb(7,"mat-label"),I.Rc(8,"Filter contracts"),I.Sb(),I.Tb(9,"mat-select",5),I.bc("selectionChange",(function(t){return e.selectFilter(t)}))("ngModelChange",(function(t){return e.filterId=t})),I.Pc(10,qt,2,2,"mat-option",6),I.Sb(),I.Sb(),I.Tb(11,"button",7),I.bc("click",(function(){return e.createContract()})),I.Tb(12,"mat-icon"),I.Rc(13,"add"),I.Sb(),I.Sb(),I.Sb(),I.Tb(14,"table",8),I.Pc(15,Jt,2,1,"ng-container",9),I.Rb(16,10),I.Pc(17,te,2,0,"th",11),I.Pc(18,ee,2,1,"td",12),I.Qb(),I.Rb(19,13),I.Pc(20,ie,2,0,"th",11),I.Pc(21,ne,2,1,"td",12),I.Qb(),I.Rb(22,14),I.Pc(23,le,1,0,"th",15),I.Pc(24,he,18,10,"td",16),I.Qb(),I.Pc(25,be,1,0,"tr",17),I.Pc(26,pe,1,0,"tr",18),I.Sb(),I.Ob(27,"mat-paginator",19),I.Sb(),I.Sb(),I.Sb()),2&t&&(I.Cb(2),I.mc("@fadeInRight",void 0)("crumbs",I.qc(12,Se)),I.Cb(1),I.mc("@fadeInUp",void 0),I.Cb(1),I.mc("columns",e.displayedColumns),I.Cb(5),I.mc("ngModel",e.filterId)("ngModelOptions",I.qc(13,Te)),I.Cb(1),I.mc("ngForOf",e.filterModes),I.Cb(4),I.mc("dataSource",e.listData),I.Cb(1),I.mc("ngForOf",e.displayedColumns),I.Cb(10),I.mc("matHeaderRowDef",e.visibleColumns),I.Cb(1),I.mc("matRowDefColumns",e.visibleColumns),I.Cb(1),I.mc("pageSize",e.pageSize))},directives:[jt.a,Gt.a,Yt.a,Ht.a,Vt.a,z.d,z.h,$.a,s.q,s.t,r.n,O.a,$t.a,W.a,p.j,b.a,p.c,p.e,p.b,p.g,p.i,h.a,_.n,r.o,p.d,b.b,p.a,_t.e,_t.b,_t.d,p.f,p.h],styles:[".mat-dialog-container[_ngcontent-%COMP%]{margin-left:150px;margin-top:50px;width:60%;height:60%}.left-margin[_ngcontent-%COMP%]{margin-left:5px}.right-margin[_ngcontent-%COMP%]{margin-right:5px}.header-align-right[_ngcontent-%COMP%]{text-align:right}"],data:{animation:[y.a,C.a]}}),ge)}],Pe=((ve=function t(){l(this,t)}).\u0275mod=I.Lb({type:ve}),ve.\u0275inj=I.Kb({factory:function(t){return new(t||ve)},imports:[[m.j.forChild(De)],m.j]}),ve),we=a("WCGO"),xe=a("YUcS"),ke=a("GiUZ"),Ae=a("6NWb"),Re=a("Rlsg"),Fe=a("wqNl"),Ie=a("VE2z"),Ne=a("zWnM"),Me=a("zeEN"),Oe=((Ce=function t(){l(this,t)}).\u0275mod=I.Lb({type:Ce}),Ce.\u0275inj=I.Kb({factory:function(t){return new(t||Ce)},providers:[r.f],imports:[[r.c,_t.c,Ae.b,Re.a,Pe,Fe.a,Ie.a,s.l,d.a,s.w,xe.a,B.c,O.b,P.g,W.b,we.a,ke.a,u.a,c.a,Ne.a,Me.a]]}),Ce),We=((ye=function t(){l(this,t)}).\u0275mod=I.Lb({type:ye}),ye.\u0275inj=I.Kb({factory:function(t){return new(t||ye)},providers:[r.f,r.g],imports:[[r.c,Pe,s.l,d.a,s.w,d.a,we.a,Oe,u.a,c.a,Ne.a,Me.a]]}),ye)},tB66:function(t,e,i){"use strict";i.d(e,"a",(function(){return c}));var n=i("fXoL"),a=i("0IaG"),r=i("XiUz"),s=i("bTqV"),c=function(){var t=function(){function t(e){l(this,t),this.dialogRef=e,this.confirmMessage="Are you sure you want to Delete?",e.disableClose=!0}return o(t,[{key:"getConfirmation",value:function(t){this.dialogRef.close(t)}}]),t}();return t.\u0275fac=function(e){return new(e||t)(n.Nb(a.h))},t.\u0275cmp=n.Hb({type:t,selectors:[["fury-user-confirmation-popup"]],decls:9,vars:1,consts:[[1,"heading"],[1,"mat-dlg-content","contentStyle"],["fxLayout","row","fxLayoutAlign","end center",1,"bottomPadding"],["mat-button","",3,"click"],["mat-button","",1,"buttonStyle",3,"click"]],template:function(t,e){1&t&&(n.Tb(0,"div",0),n.Rc(1," Confirm Action "),n.Sb(),n.Tb(2,"div",1),n.Rc(3),n.Sb(),n.Tb(4,"mat-dialog-actions",2),n.Tb(5,"button",3),n.bc("click",(function(){return e.getConfirmation(!1)})),n.Rc(6,"NO"),n.Sb(),n.Tb(7,"button",4),n.bc("click",(function(){return e.getConfirmation(!0)})),n.Rc(8,"YES"),n.Sb(),n.Sb()),2&t&&(n.Cb(3),n.Sc(e.confirmMessage))},directives:[a.c,r.d,r.c,s.a],styles:[".buttonStyle[_ngcontent-%COMP%]{background:#1976d2;color:#fff;padding-right:10px}.headingStyle[_ngcontent-%COMP%]{text-align:center;color:red;background-color:silver;border-radius:50%;width:100px;height:100px}.heading[_ngcontent-%COMP%]{font-size:large;font-weight:700;margin-top:10px}mat-icon[_ngcontent-%COMP%]{font-size:56px;height:56px;width:56px;line-height:56px;justify-content:center}.contentStyle[_ngcontent-%COMP%]{padding-top:40px;padding-bottom:30px;padding-right:30px}.rightAlign[_ngcontent-%COMP%]{text-align:right}.bottomPadding[_ngcontent-%COMP%]{padding-bottom:20px}"]}),t}()},zWnM:function(t,e,i){"use strict";i.d(e,"a",(function(){return a}));var n=i("fXoL"),a=function(){var t=function t(){l(this,t)};return t.\u0275mod=n.Lb({type:t}),t.\u0275inj=n.Kb({factory:function(e){return new(e||t)},imports:[[]]}),t}()},zeEN:function(t,e,i){"use strict";i.d(e,"a",(function(){return a}));var n=i("fXoL"),a=function(){var t=function t(){l(this,t)};return t.\u0275mod=n.Lb({type:t}),t.\u0275inj=n.Kb({factory:function(e){return new(e||t)},imports:[[]]}),t}()}}])}();