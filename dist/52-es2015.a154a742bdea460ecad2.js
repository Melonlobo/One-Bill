(window.webpackJsonp=window.webpackJsonp||[]).push([[52],{AJS6:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var l=i("tk/3"),n=i("sXtk"),o=i("fXoL");let a=(()=>{class e{constructor(e,t){this.httpClient=e,this.envService=t,this.baseUrl="",this.baseUrl=t.backend}getTemplateByTemplateTypeId(e,t,i){let n=new l.f;return(e||t)&&(n=n.append("templateTypeId",""+e),n=n.append("clientId",""+t),n=n.append("notificationType",""+i)),this.httpClient.get(this.baseUrl+"/notifications/templates/email/content",{params:n})}CheckForTemplateType(e,t,i){let n=new l.f;return n=n.append("templateTypeId",""+e),n=n.append("notificationType",""+t),n=n.append("clientId",""+i),this.httpClient.get(this.baseUrl+"/notifications/templates/GetNotificationTemplateId",{params:n})}updateTemplateById(e,t){return this.httpClient.put(this.baseUrl+"/notifications/templates/"+e,t)}insertTemplate(e){return this.httpClient.post(this.baseUrl+"/notifications/templates",e)}getTemplateTypes(){return this.httpClient.get(this.baseUrl+"/notifications/templates/GetTemplateTypes")}getSmsTemplates(e){return this.httpClient.get(this.baseUrl+"/notifications/templates/sms/clientId/"+e)}getEmailTemplates(e){return this.httpClient.get(this.baseUrl+"/notifications/templates/email/clientId/"+e)}getNotificationTemplates(e){let t=new l.f;return t=t.append("notificationCategoryId",""+e),this.httpClient.get(this.baseUrl+"/notifications/templates/getNotificationTemplates",{params:t})}getKeywords(e=0){let t=new l.f;return t=t.append("id",""+e),this.httpClient.get(this.baseUrl+"/notifications/templates/Keywords",{params:t})}getConditions(e=0){let t=new l.f;return t=t.append("id",""+e),this.httpClient.get(this.baseUrl+"/notifications/templates/conditions",{params:t})}getNotificationModes(e){let t=new l.f;return t=t.append("clientId",""+e),this.httpClient.get(this.baseUrl+"/notifications/templates/notificationModes",{params:t})}createAlertSettings(e,t){return this.httpClient.post(this.baseUrl+"/notifications/alert/settings/"+t,e)}getAlertSettings(e=0,t=0,i=0,n=""){let o=new l.f;return e&&(o=o.append("clientId",""+e),o=o.append("notificationCategorId",""+t),o=o.append("templateTypeId",""+i),o=o.append("notificationModes",""+n)),this.httpClient.get(this.baseUrl+"/notifications/alert/settings",{params:o})}copyNotificationTemplates(e){return this.httpClient.post(this.baseUrl+"/notifications/templates/copy/contents",e)}getNotificationLogs(e){let t=new l.f;return t=t.append("fromDate",""+e.fromDate),t=t.append("toDate",""+e.toDate),t=t.append("status",""+e.statusId),t=t.append("mode",""+e.modeId),t=t.append("clientId",""+e.clientId),this.httpClient.get(this.baseUrl+"/notifications/logs",{params:t})}createSLDMaster(e){return this.httpClient.post(this.baseUrl+"/notifications/sld/master",e)}updateSLDMaster(e){return this.httpClient.put(this.baseUrl+"/notifications/sld/master",e)}getSLDMaster(e,t){let i=new l.f;return i=i.append("masterId",""+e),i=i.append("clientId",""+t),this.httpClient.get(this.baseUrl+"/notifications/sld/master",{params:i})}getClientAlertSettings(e){let t=new l.f;return e&&(t=t.append("clientId",""+e)),this.httpClient.get(this.baseUrl+"/notifications/client/alert/settings",{params:t})}}return e.\u0275fac=function(t){return new(t||e)(o.Xb(l.c),o.Xb(n.a))},e.\u0275prov=o.Jb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},"RNk+":function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var l=i("sXtk"),n=i("fXoL"),o=i("tk/3");let a=(()=>{class e{constructor(e,t){this.http=e,this.envService=t,this.baseUrl="",this.baseUrl=t.backend}emailInvoiceTemplate(e){return this.http.post(this.baseUrl+"/template/invoice",e.billMasterDetails)}emailReceiptTemplate(e){return this.http.post(this.baseUrl+"/template/receipt",e)}emailCustomTemplate(e){return this.http.post(this.baseUrl+"/template/customized",e)}}return e.\u0275fac=function(t){return new(t||e)(n.Xb(o.c),n.Xb(l.a))},e.\u0275prov=n.Jb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},Vvus:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var l=i("tk/3"),n=i("sXtk"),o=i("fXoL");let a=(()=>{class e{constructor(e,t){this.http=e,this.envService=t,this.baseUrl="",this.baseUrl=t.backend}getOwners(){return this.http.get(this.baseUrl+"/owners")}getclientOwners(e){return this.http.get(this.baseUrl+"/owners/GetAllClientOwners/"+e)}getNewlyRegisteredUsers(e){return this.http.get(this.baseUrl+"/owners/newlyRegisteredOwners/"+e)}getUnits(e){return this.http.get(this.baseUrl+"/owners/"+e+"/GetUnits")}createOwner(e){return this.http.post(this.baseUrl+"/owners",e)}updateOwnerById(e,t){return this.http.put(this.baseUrl+"/owners/"+e,t)}deleteOwnerById(e){return this.http.delete(this.baseUrl+"/owners/"+e)}uploadLogo(e){const t=new FormData;t.append("file",e);const i={headers:new l.e({"Content-Type":"application/json"}),body:t};return this.http.post(this.baseUrl+"/upload",i)}getMovedOutTenants(e){return this.http.get(this.baseUrl+"/owners/movedOutTenants/clientId/"+e)}registerOwner(e){return this.http.post(this.baseUrl+"/owners/register",e)}getUserDeatils(e){let t=new l.f;return e&&(t=t.append("userId",e)),this.http.get(this.baseUrl+"/owners/user/details",{params:t})}checkTRNDuplication(e,t,i){let n=new l.f;return n=n.append("queryType",e),n=n.append("tRNNumber",t),n=n.append("id",i),this.http.get(this.baseUrl+"/owners/TRNNumber",{params:n})}}return e.\u0275fac=function(t){return new(t||e)(o.Xb(l.c),o.Xb(n.a))},e.\u0275prov=o.Jb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},xPwF:function(e,t,i){"use strict";i.r(t),i.d(t,"BillsModule",(function(){return Wn}));var l=i("3Pt+"),n=i("9xt4"),o=i("y/v/"),a=i("ofXK"),s=i("tyNb"),r=i("mrSG"),c=i("lW2b"),u=i("Ku73"),d=i("nStZ"),m=i("fXoL"),h=i("0IaG"),b=i("KHMF"),p=i("sXtk"),f=i("4FRi"),g=i("+WJP");let v=(()=>{class e{constructor(e,t,i,l){var n,o,a;this.data=e,this.dialogRef=t,this.currencyPipe=i,this.envService=l,this.accountHeadData=[],this.columns=[],this.identifierColumnName="#",this.accountHeadColumnName="Account Head",this.amountColumnName="Amount",this.discountAmountColumnName="Discount Amount",this.format="",this.currency="",this.roundFormat="",this.format=null!==(n=Object(b.e)("DateFormat"))&&void 0!==n?n:l.dateFormat,this.currency=null!==(o=Object(b.e)("Currency"))&&void 0!==o?o:l.currencyFormat,this.roundFormat=null!==(a=Object(b.e)("RoundOff"))&&void 0!==a?a:l.roundOffFormat}ngOnInit(){this.createGridColumns(),this.onGetAccountHeads(this.data)}createGridColumns(){this.columns=[{name:this.identifierColumnName,property:"rowNumber",visible:!0,isModelProperty:!0},{name:this.accountHeadColumnName,property:"accountHeadName",visible:!0,isModelProperty:!0},{name:this.amountColumnName,property:"fixedAmountLocal",visible:!0,isModelProperty:!0,columnAlign:{"text-align":"right"}},{name:this.discountAmountColumnName,property:"discountAmountLocal",visible:!0,isModelProperty:!0,columnAlign:{"text-align":"right"}}]}onGetAccountHeads(e){if(this.accountHeadData=[],e&&(e.bills&&e.bills.length&&e.bills.forEach(e=>{e.billTransactions&&e.billTransactions.length&&e.billTransactions.forEach(e=>{let t=null;if(this.accountHeadData&&this.accountHeadData.length&&(t=this.accountHeadData.find(t=>t.accountHeadName.trim().toLowerCase()===e.headDisplay.trim().toLowerCase())),t)t.fixedAmount+=e.headAmount,t.fixedAmountLocal=this.currencyPipe.transform(t.fixedAmount,this.currency.toString(),!0,this.roundFormat);else{const t={rowNumber:this.accountHeadData.length+1,accountHeadName:e.headDisplay,billHeadId:e.billHeadId,fixedAmount:e.headAmount,position:e.position,fixedAmountLocal:this.currencyPipe.transform(e.headAmount,this.currency.toString(),!0,this.roundFormat)};this.accountHeadData.push(t)}})}),e.billCharges&&e.billCharges.length&&e.billCharges.forEach(e=>{let t=null;if(this.accountHeadData&&this.accountHeadData.length&&(t=this.accountHeadData.find(t=>t.accountHeadName.trim().toLowerCase()===e.headDisplay.trim().toLowerCase())),t)t.fixedAmount+=e.headAmount,t.fixedAmountLocal=this.currencyPipe.transform(t.fixedAmount,this.currency.toString(),!0,this.roundFormat);else{const t={rowNumber:this.accountHeadData.length+1,accountHeadName:e.headDisplay,fixedAmount:e.headAmount,billHeadId:e.billHeadId,position:e.position,fixedAmountLocal:this.currencyPipe.transform(e.headAmount,this.currency.toString(),!0,this.roundFormat)};this.accountHeadData.push(t)}}),e.billTaxDetails&&e.billTaxDetails.length&&e.billTaxDetails.forEach(e=>{var t,i;let l=null,n=0;if(this.accountHeadData&&this.accountHeadData.length&&(n=null!==(i=null===(t=this.accountHeadData.sort((e,t)=>e.position-t.position)[this.accountHeadData.length-1])||void 0===t?void 0:t.position)&&void 0!==i?i:0),this.accountHeadData&&this.accountHeadData.length&&(l=this.accountHeadData.find(t=>t.accountHeadName.trim().toLowerCase()===e.taxDisplayName.trim().toLowerCase())),l)l.fixedAmount+=e.taxAmount,l.fixedAmountLocal=this.currencyPipe.transform(l.fixedAmount,this.currency.toString(),!0,this.roundFormat);else{const t={rowNumber:this.accountHeadData.length+1,accountHeadName:e.taxDisplayName,fixedAmount:e.taxAmount,position:n+1,fixedAmountLocal:this.currencyPipe.transform(e.taxAmount,this.currency.toString(),!0,this.roundFormat)};this.accountHeadData.push(t)}}),e.billDiscounts&&e.billDiscounts.length&&e.billDiscounts.forEach(e=>{var t;let i=null;this.accountHeadData&&this.accountHeadData.length&&(i=this.accountHeadData.find(t=>t.billHeadId===e.billHeadId)),i&&(i.discountAmount=(null!==(t=null==i?void 0:i.discountAmount)&&void 0!==t?t:0)+e.headAmount,i.discountAmountLocal=this.currencyPipe.transform(i.discountAmount,this.currency.toString(),!0,this.roundFormat))}),this.accountHeadData&&this.accountHeadData.length)){this.accountHeadData=this.accountHeadData.sort((e,t)=>e.position-t.position);for(let e=0;e<this.accountHeadData.length;++e)this.accountHeadData[e].rowNumber=e+1}}}return e.\u0275fac=function(t){return new(t||e)(m.Nb(h.a),m.Nb(h.h),m.Nb(a.d),m.Nb(p.a))},e.\u0275cmp=m.Hb({type:e,selectors:[["app-account-head-details"]],decls:6,vars:2,consts:[[1,"person"],[3,"tableData","columns"]],template:function(e,t){1&e&&(m.Tb(0,"fury-card-header"),m.Tb(1,"fury-card-header-heading"),m.Rc(2,"Account Heads"),m.Sb(),m.Sb(),m.Tb(3,"mat-dialog-content"),m.Tb(4,"div",0),m.Ob(5,"app-table-structure",1),m.Sb(),m.Sb()),2&e&&(m.Cb(5),m.mc("tableData",t.accountHeadData)("columns",t.columns))},directives:[f.d,f.g,h.f,g.a],styles:[""]}),e})();var y=i("Nm8O"),C=i("b6Qw"),S=i("XiUz"),T=i("uxLP"),P=i("bTqV"),D=i("Qu3c"),w=i("NFeN");function N(e,t){if(1&e){const e=m.Ub();m.Tb(0,"div",6),m.Tb(1,"button",7),m.bc("click",(function(){return m.Ec(e),m.fc().onSave()})),m.Tb(2,"mat-icon"),m.Rc(3,"launch"),m.Sb(),m.Sb(),m.Sb()}}function x(e,t){if(1&e&&(m.Tb(0,"div",8),m.Tb(1,"ul"),m.Tb(2,"li"),m.Tb(3,"div",9),m.Tb(4,"label"),m.Rc(5,"Succeed"),m.Sb(),m.Ob(6,"div",10),m.Tb(7,"label"),m.Rc(8),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Tb(9,"ul"),m.Tb(10,"li"),m.Tb(11,"div",9),m.Tb(12,"label"),m.Rc(13,"Failed"),m.Sb(),m.Ob(14,"div",11),m.Tb(15,"label"),m.Rc(16),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb()),2&e){const e=m.fc();m.Cb(8),m.Sc(e.succeedCount),m.Cb(8),m.Sc(e.failedCount)}}let A=(()=>{class e{constructor(e,t,i,l,n,o,a){var s,r,c,u;this.date=e,this.currencyPipe=t,this.dialog=i,this.jwtHelperService=l,this.cookieService=n,this.decimalPipe=o,this.envService=a,this.columns=[],this.innerColumns=[],this.columnNames=[],this.unBilledConsumptions=[],this.selectedRows=[],this.innerTableName="bills",this.banks=[],this.paymentModes=[],this.isHide=!0,this.hideHeader=!0,this.format="",this.currency="",this.roundFormat="",this.consumptionRoundOffFormat="",this.saveClicked=new m.o,this.printDataRows=new m.o,this.role="",this.succeedCount="",this.failedCount="",this.cssStyledColumn="status",this.billNumberCoulmnName="Bill Number",this.accountNumberColumnName="Account Number",this.billDateCoulmnName="BillDate",this.tenantNameColumnName="Tenant Name",this.unitColumnName="Unit",this.fromDateColumnName="From Date",this.toDateColumnName="To Date",this.dueDateColumnName="Due Date",this.billAmountColumnName="Bill Amount",this.utilityTypeCoulmnNmae="Utility Type",this.meterNumberCoulmnNmae="Meter Number",this.previousReadingColumnName="Previous",this.presentReadingColumnName="Present",this.currentConsumptionColumnName="Cur-Consumption",this.consumptionChargeColumnName="Consumption Charge",this.format=null!==(s=Object(b.e)("DateFormat"))&&void 0!==s?s:a.dateFormat,this.currency=null!==(r=Object(b.e)("Currency"))&&void 0!==r?r:a.currencyFormat,this.roundFormat=null!==(c=Object(b.e)("RoundOff"))&&void 0!==c?c:a.roundOffFormat,this.consumptionRoundOffFormat=null!==(u=Object(b.e)("ConsumptionRoundOff"))&&void 0!==u?u:a.consumptionRoundOffFormat}set dataSource(e){var t,i;if(e&&e.unbBilledConsumptions){this.unBilledConsumptions=this.updateDataFormats(e.unbBilledConsumptions);const l=null!==(t=this.unBilledConsumptions.filter(e=>"Succeed"===e.status).length)&&void 0!==t?t:0,n=null!==(i=this.unBilledConsumptions.filter(e=>"Failed"===e.status).length)&&void 0!==i?i:0;l>0||n>0?(this.succeedCount=" - "+l.toString(),this.failedCount=" - "+n.toString()):(this.succeedCount="",this.failedCount="")}}ngOnInit(){let e=this.cookieService.get("access_token");const t=this.jwtHelperService.decodeToken(e);t&&(this.role=t["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"]),this.createColumnNames(),this.createGridColumns(),this.createInnerGridColumns(),this.isHide&&this.updateTableColumns()}createGridColumns(){this.columns=["select","accountNumber","ownerName","unitNumber","fromDateLocal","toDateLocal","dueDateLocal","billAmountLocal","button","print"]}createInnerGridColumns(){this.innerColumns=["utilityType","deviceName","previousReadingLocal","presentReadingLocal","consumptionLocal","consumptionCharge"]}createColumnNames(){this.columnNames=[{name:this.billNumberCoulmnName,property:"billNumber"},{name:this.accountNumberColumnName,property:"accountNumber"},{name:this.billDateCoulmnName,property:"billDate"},{name:this.tenantNameColumnName,property:"ownerName"},{name:this.unitColumnName,property:"unitNumber"},{name:this.fromDateColumnName,property:"fromDateLocal"},{name:this.toDateColumnName,property:"toDateLocal"},{name:this.dueDateColumnName,property:"dueDateLocal"},{name:this.billAmountColumnName,property:"billAmountLocal",columnAlign:{"text-align":"right"}},{name:this.utilityTypeCoulmnNmae,property:"utilityType"},{name:this.meterNumberCoulmnNmae,property:"deviceName"},{name:this.previousReadingColumnName,property:"previousReadingLocal"},{name:this.presentReadingColumnName,property:"presentReadingLocal"},{name:this.currentConsumptionColumnName,property:"consumptionLocal"},{name:this.consumptionChargeColumnName,property:"consumptionCharge",columnAlign:{"text-align":"right"}}]}updateTableColumns(){this.columns.splice(0,1)}onSave(){this.saveClicked.emit(!0)}onSelectedRows(e){this.selectedRows=[],this.selectedRows=e}onViewDataRow(e){this.dialog.open(v,{data:e}).afterClosed().subscribe()}onPrintRows(e){this.printDataRows.emit(e)}updateDataFormats(e){return e&&(this.format=Object(b.e)("DateFormat"),this.roundFormat=Object(b.e)("RoundOff"),this.currency=Object(b.e)("Currency"),e.forEach(e=>{e.fromDateLocal=this.date.transform(e.fromDate.toString(),this.format.toString()),e.toDateLocal=this.date.transform(e.toDate.toString(),this.format.toString()),e.dueDateLocal=this.date.transform(e.dueDate.toString(),this.format.toString()),e.billAmountLocal=this.currencyPipe.transform(e.billAmount,this.currency.toString(),!0,this.roundFormat),e.bills.forEach(e=>{var t;this.consumptionRoundOffFormat=null!==(t=Object(b.e)("ConsumptionRoundOff",e.utilityTypeId))&&void 0!==t?t:this.envService.consumptionRoundOffFormat,e.previousReadingLocal=this.decimalPipe.transform(e.previousReading,this.consumptionRoundOffFormat),e.presentReadingLocal=this.decimalPipe.transform(e.presentReading,this.consumptionRoundOffFormat),e.consumptionLocal=this.decimalPipe.transform(e.consumption,this.consumptionRoundOffFormat),e.billAmountLocal=e.consumptionCharge=this.currencyPipe.transform(e.billAmount,this.currency.toString(),!0,this.roundFormat)})})),e}}return e.\u0275fac=function(t){return new(t||e)(m.Nb(a.f),m.Nb(a.d),m.Nb(h.b),m.Nb(y.a),m.Nb(C.a),m.Nb(a.g),m.Nb(p.a))},e.\u0275cmp=m.Hb({type:e,selectors:[["app-unbilled-consumption"]],inputs:{banks:"banks",paymentModes:"paymentModes",isHide:"isHide",hideHeader:"hideHeader",dataSource:"dataSource"},outputs:{saveClicked:"saveClicked",printDataRows:"printDataRows"},decls:7,vars:10,consts:[[1,"person"],["fxLayout","column","fxLayout","row","fxLayoutGap.gt-sm","24px"],[1,"mat-table"],[3,"tableData","columnsToDisplay","innerDisplayedColumns","columnNames","innerTableName","hideHeader","cssStyledColumn","role","selectedRows","viewDataRow","printDataRow"],["class","fury-flex-form-field",4,"ngIf"],["class","result","fxLayout.gt-sm","row","fxLayout","column","fxLayoutAlign","end end","fxLayoutGap.gt-sm","12px",4,"ngIf"],[1,"fury-flex-form-field"],["matTooltip","Generate & Save Bill","mat-icon-button","","aria-label","Example icon-button with menu icon",1,"example-icon",3,"click"],["fxLayout.gt-sm","row","fxLayout","column","fxLayoutAlign","end end","fxLayoutGap.gt-sm","12px",1,"result"],[1,"label-color"],[1,"color-box",2,"background-color","rgb(152, 197, 171)"],[1,"color-box",2,"background-color","rgb(206, 120, 152)"]],template:function(e,t){1&e&&(m.Tb(0,"mat-dialog-content"),m.Tb(1,"div",0),m.Tb(2,"div",1),m.Tb(3,"div",2),m.Tb(4,"fury-expandable-table-structure",3),m.bc("selectedRows",(function(e){return t.onSelectedRows(e)}))("viewDataRow",(function(e){return t.onViewDataRow(e)}))("printDataRow",(function(e){return t.onPrintRows(e)})),m.Sb(),m.Sb(),m.Pc(5,N,4,0,"div",4),m.Sb(),m.Pc(6,x,17,2,"div",5),m.Sb(),m.Sb()),2&e&&(m.Cb(4),m.mc("tableData",t.unBilledConsumptions)("columnsToDisplay",t.columns)("innerDisplayedColumns",t.innerColumns)("columnNames",t.columnNames)("innerTableName",t.innerTableName)("hideHeader",t.hideHeader)("cssStyledColumn",t.cssStyledColumn)("role",t.role),m.Cb(1),m.mc("ngIf",t.isHide),m.Cb(1),m.mc("ngIf","External"!=t.role))},directives:[h.f,S.d,S.e,T.a,a.o,P.a,D.a,w.a,S.c],styles:[".form-control[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .form-control[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-control[_ngcontent-%COMP%]   label[_ngcontent-%COMP%], .form-control[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{display:block;display:inline}ul[_ngcontent-%COMP%]{margin:20px}.label-color[_ngcontent-%COMP%]{position:relative}.label-color[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{padding-left:20px}.label-color[_ngcontent-%COMP%]   .color-box[_ngcontent-%COMP%]{width:10px;height:10px;display:inline-block;background-color:#ccc;position:absolute;left:5px;top:5px}.mat-table[_ngcontent-%COMP%]{width:100%;overflow-x:scroll}"]}),e})();var F=i("7d4Y"),R=i("wd/R"),k=i("dNgK"),I=i("kmnG"),O=i("d3UM"),W=i("qFsG"),M=i("f0Cb"),L=i("FKr1"),B=i("iadO");const z=["allTenantsSelected"],U=["tenantSelect"];function E(e,t){if(1&e&&(m.Tb(0,"mat-option",19),m.Rc(1),m.Sb()),2&e){const e=t.$implicit;m.mc("value",e.value),m.Cb(1),m.Tc("",e.label," ")}}function j(e,t){if(1&e){const e=m.Ub();m.Tb(0,"mat-option",9),m.bc("click",(function(){m.Ec(e);const t=m.fc(),i=m.Ac(18);return t.toggleTenantsPerOne(i.viewValue)})),m.Rc(1),m.Sb()}if(2&e){const e=t.$implicit;m.mc("value",e.id),m.Cb(1),m.Tc(" ",e.ownerName," ")}}function H(e,t){if(1&e){const e=m.Ub();m.Tb(0,"mat-form-field",20),m.Tb(1,"mat-label"),m.Rc(2,"From Date"),m.Sb(),m.Tb(3,"input",21),m.bc("click",(function(){return m.Ec(e),m.Ac(6).open()}))("ngModelChange",(function(t){return m.Ec(e),m.fc().fromDate=t}))("focus",(function(){return m.Ec(e),m.Ac(6).open()})),m.Sb(),m.Ob(4,"mat-datepicker-toggle",14),m.Ob(5,"mat-datepicker",22,23),m.Sb()}if(2&e){const e=m.Ac(6),t=m.fc();m.Cb(3),m.mc("ngModel",t.fromDate)("matDatepicker",e),m.Cb(1),m.mc("for",e)}}function Y(e,t){if(1&e){const e=m.Ub();m.Tb(0,"mat-form-field",20),m.Tb(1,"mat-label"),m.Rc(2,"To Date"),m.Sb(),m.Tb(3,"input",24),m.bc("click",(function(){return m.Ec(e),m.Ac(6).open()}))("ngModelChange",(function(t){return m.Ec(e),m.fc().toDate=t}))("focus",(function(){return m.Ec(e),m.Ac(6).open()})),m.Sb(),m.Ob(4,"mat-datepicker-toggle",14),m.Ob(5,"mat-datepicker",22,25),m.Sb()}if(2&e){const e=m.Ac(6),t=m.fc();m.Cb(3),m.mc("ngModel",t.toDate)("matDatepicker",e),m.Cb(1),m.mc("for",e)}}let V=(()=>{class e{constructor(e,t){this.snackbar=e,this.cookieService=t,this.utilityTypeId=0,this.billPeriodId=0,this.fromDate=Date.UTC.toString(),this.toDate=Date.UTC.toString(),this.billDate="",this.isHide=!0,this.selectedTenants=[],this.maxDate=new Date,this.manageParams={},this.utilityTypes=[],this.billPeriods=[],this.filteredTenants=[],this.data=[],this.filterClicked=new m.o,this.saveClicked=new m.o}get tenants(){return this.data}set tenants(e){this.filteredTenants=this.data=e}ngOnInit(){this.clientId=parseInt(this.cookieService.get("globalClientId"))}onChangeUtilityType(e){this.utilityTypeId=e}onChangeBillPeriod(e){if(this.isHide=!0,this.billPeriodId=e,this.billPeriodId){const e=this.billPeriods.find(e=>e.value===this.billPeriodId);e&&(this.isHide=!1,this.fromDate=""===e.fromDate?"":R(e.fromDate).format("YYYY-MM-DD"),this.toDate=""===e.toDate?"":R(e.toDate).format("YYYY-MM-DD"))}}onGenerate(){0!==this.utilityTypeId||0!==this.billPeriodId?(this.manageParams={utilityTypeId:""+this.utilityTypeId,billPeriodId:""+this.billPeriodId,clientId:this.clientId,processDate:this.billDate?""+R(this.billDate).format("YYYY-MM-DD"):null},this.selectedTenants&&this.selectedTenants.length&&(this.manageParams.tenantIds=this.selectedTenants.filter(e=>0!=e)),this.filterClicked.emit(this.manageParams)):this.snackbar.open("Invalid search parameters",null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:["yellow-snackbar"]})}toggleTenantsAllSelection(){this.selectedTenants=[],this.allTenantsSelected.selected?(this.selectedTenants=this.filteredTenants.map(e=>e.id),this.select.options.forEach(e=>e.select())):(this.select.options.forEach(e=>e.deselect()),this.selectedTenants=[])}toggleTenantsPerOne(){if(this.allTenantsSelected.selected)return this.allTenantsSelected.deselect(),!1;this.data.length<=this.selectedTenants.length&&this.allTenantsSelected.select()}searchTenants(e){let t=this.selectTenants(e.toLowerCase());this.filteredTenants=t}selectTenants(e){let t=[];if(e)for(let i of this.data)i.ownerName.toLowerCase().indexOf(e)>-1&&t.push(i);else t=this.filteredTenants=this.data;return t}handleInput(e){e.stopPropagation()}}return e.\u0275fac=function(t){return new(t||e)(m.Nb(k.b),m.Nb(C.a))},e.\u0275cmp=m.Hb({type:e,selectors:[["app-create-bill-toolbar"]],viewQuery:function(e,t){var i;1&e&&(m.Vc(z,!0),m.Vc(U,!0)),2&e&&(m.zc(i=m.cc())&&(t.allTenantsSelected=i.first),m.zc(i=m.cc())&&(t.select=i.first))},inputs:{utilityTypes:"utilityTypes",billPeriods:"billPeriods",tenants:"tenants"},outputs:{filterClicked:"filterClicked",saveClicked:"saveClicked"},decls:34,vars:11,consts:[[1,"person"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","6px"],["color","primary",1,"result"],["id","BillPeriod","name","BillPeriod",3,"value","selectionChange","valueChange"],[3,"value",4,"ngFor","ngForOf"],["multiple","","placeholder","Select a tenant","id","tenant","name","tenant",1,"multiSelectCustom",3,"ngModel","ngModelChange"],["tenantSelect",""],["matInput","","focused","'true'","type","text","autocomplete","off","placeholder","search",1,"myInput",3,"keydown","keyup"],["myInput",""],[3,"value","click"],["allTenantsSelected",""],[3,"value","click",4,"ngFor","ngForOf"],["color","primary",1,"result",2,"width","180px"],["id","BillDate","name","BillDate","matInput","",3,"ngModel","matDatepicker","max","click","ngModelChange","focus"],["matSuffix","",3,"for"],["formDatepickerRef3",""],[1,"fury-flex-form-field"],["matTooltip","Generate Bills","color","primary","mat-icon-button","",3,"click"],["class","result","color","primary","style","width: 150px;",4,"ngIf"],[3,"value"],["color","primary",1,"result",2,"width","150px"],["id","FromDate","name","FromDate","matInput","","readonly","",3,"ngModel","matDatepicker","click","ngModelChange","focus"],["disabled","true"],["formDatepickerRef1",""],["id","ToDate","name","ToDate","matInput","","readonly","",3,"ngModel","matDatepicker","click","ngModelChange","focus"],["formDatepickerRef2",""]],template:function(e,t){if(1&e){const e=m.Ub();m.Tb(0,"mat-dialog-content"),m.Tb(1,"div",0),m.Tb(2,"form"),m.Tb(3,"div",1),m.Tb(4,"mat-form-field",2),m.Tb(5,"mat-label"),m.Rc(6,"Bill Period"),m.Sb(),m.Tb(7,"mat-select",3),m.bc("selectionChange",(function(e){return t.onChangeBillPeriod(e.value)}))("valueChange",(function(e){return t.billPeriodId=e})),m.Pc(8,E,2,2,"mat-option",4),m.Sb(),m.Sb(),m.Tb(9,"mat-form-field",2),m.Tb(10,"mat-label"),m.Rc(11,"Tenant Name"),m.Sb(),m.Tb(12,"mat-select",5,6),m.bc("ngModelChange",(function(e){return t.selectedTenants=e})),m.Tb(14,"input",7,8),m.bc("keydown",(function(e){return t.handleInput(e)}))("keyup",(function(e){return t.searchTenants(e.target.value)})),m.Sb(),m.Ob(16,"mat-divider"),m.Tb(17,"mat-option",9,10),m.bc("click",(function(){return t.toggleTenantsAllSelection()})),m.Rc(19,"Select All"),m.Sb(),m.Pc(20,j,2,2,"mat-option",11),m.Sb(),m.Sb(),m.Tb(21,"mat-form-field",12),m.Tb(22,"mat-label"),m.Rc(23,"Bill Date"),m.Sb(),m.Tb(24,"input",13),m.bc("click",(function(){return m.Ec(e),m.Ac(27).open()}))("ngModelChange",(function(e){return t.billDate=e}))("focus",(function(){return m.Ec(e),m.Ac(27).open()})),m.Sb(),m.Ob(25,"mat-datepicker-toggle",14),m.Ob(26,"mat-datepicker",null,15),m.Sb(),m.Tb(28,"div",16),m.Tb(29,"button",17),m.bc("click",(function(){return t.onGenerate()})),m.Tb(30,"mat-icon"),m.Rc(31,"launch"),m.Sb(),m.Sb(),m.Sb(),m.Pc(32,H,7,3,"mat-form-field",18),m.Pc(33,Y,7,3,"mat-form-field",18),m.Sb(),m.Sb(),m.Sb(),m.Sb()}if(2&e){const e=m.Ac(27);m.Cb(7),m.mc("value",t.billPeriodId),m.Cb(1),m.mc("ngForOf",t.billPeriods),m.Cb(4),m.mc("ngModel",t.selectedTenants),m.Cb(5),m.mc("value",0),m.Cb(3),m.mc("ngForOf",t.filteredTenants),m.Cb(4),m.mc("ngModel",t.billDate)("matDatepicker",e)("max",t.maxDate),m.Cb(1),m.mc("for",e),m.Cb(7),m.mc("ngIf",!t.isHide),m.Cb(1),m.mc("ngIf",!t.isHide)}},directives:[h.f,l.z,l.r,l.s,S.d,S.e,I.d,I.h,O.a,a.n,l.q,l.t,W.b,M.a,L.n,l.c,B.b,B.d,I.j,B.a,P.a,D.a,w.a,a.o],styles:[".myInput[_ngcontent-%COMP%]{height:50px!important;padding:10px!important}"]}),e})();var _=i("a8hA"),G=i("4Zil"),X=i("xBcV"),$=i("rvYj"),q=i("/t3+");let J=(()=>{class e{constructor(){}ngOnInit(){}onExport(){}onPrint(){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=m.Hb({type:e,selectors:[["app-create-bill-footer-toolbar"]],decls:4,vars:0,consts:[[1,"person"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutAlign","end end","fxLayoutGap.gt-sm","24px"]],template:function(e,t){1&e&&(m.Tb(0,"mat-dialog-content"),m.Tb(1,"div",0),m.Tb(2,"form"),m.Ob(3,"div",1),m.Sb(),m.Sb(),m.Sb())},directives:[h.f,l.z,l.r,l.s,S.d,S.c,S.e],styles:[""]}),e})();var Q=i("Xa2L");function K(e,t){1&e&&(m.Tb(0,"div",13),m.Ob(1,"mat-progress-spinner",14),m.Sb())}let Z=(()=>{class e{constructor(e,t,i,l,n){this.billService=e,this.billSettlementService=t,this.snackbar=i,this.clientSelectionService=l,this.cookieService=n,this._gap=16,this.gap=this._gap+"px",this.col2=`1 1 calc(50% - ${this._gap/2}px)`,this.col3=`1 1 calc(33.3333% - ${this._gap/1.5}px)`,this.utilityTypes=[{label:"Select",value:0}],this.billPeriods=[{label:"Select",value:0}],this.tenants=[],this.showSpinner=!1,this.billSettlement={unbBilledConsumptions:[]}}ngOnInit(){this.clientSelectionService.setIsClientVisible(!0),this.clientId=parseInt(this.cookieService.get("globalClientId")),this.getTenants(),this.getUtilityTypes(),this.getBillPeriods()}getTenants(){this.tenants=[],this.billSettlementService.getTenantsDetails(this.clientId).subscribe(e=>{this.tenants=e})}onSaveBills(e){this.showSpinner=!0;let t=[];t=this.unbilledConsumptionComponent.selectedRows,null!=t&&t.length?this.billSettlementService.saveUnBilledConsumptions(t).subscribe({next:e=>{e?(this.showSpinner=!1,this.notificationMessage("Bill saved successfully","green-snackbar"),this.reset(!1,t)):(this.showSpinner=!1,this.notificationMessage("Bill save failed","red-snackbar"))},error:e=>{this.showSpinner=!1}}):(this.showSpinner=!1,this.notificationMessage("Please select bills","red-snackbar"))}reset(e=!0,t=[]){let i=this.unbilledConsumptionComponent.unBilledConsumptions;!e&&i&&i.length?(t.forEach(e=>{i=i.filter(t=>t.unitId!=e.unitId)}),this.unbilledConsumptionComponent.unBilledConsumptions=i):(e||i&&t&&i.length==t.length)&&(this.unbilledConsumptionComponent.unBilledConsumptions=[],this.createBillToolbarComponent.billPeriodId=0,this.createBillToolbarComponent.utilityTypeId=0,this.unbilledConsumptionComponent.failedCount="",this.unbilledConsumptionComponent.succeedCount="",this.createBillToolbarComponent.isHide=!0)}getUtilityTypes(){this.utilityTypes=[{label:"Select",value:0}],this.billService.getUtilityTypes().subscribe(e=>{e.forEach(e=>{this.utilityTypes.push({label:e.description,value:e.id})})})}getBillPeriods(){this.billPeriods=[{label:"Select",value:0,fromDate:Date.now.toString(),ToDate:Date.now.toString()}],this.billService.getBillPeriods(this.clientId).subscribe(e=>{e.forEach(e=>{this.billPeriods.push({label:e.periodDescription,value:e.id,fromDate:e.periodStart,toDate:e.periodEnd})})})}onGenerate(e){const t={billPeriodId:Number(e.billPeriodId),unitNumber:e.unitNumber,settlementDate:e.settlementDate,billDate:e.processDate,billType:e.billType?e.billType:b.a.NormalBill,clientId:e.clientId,tenantIds:e.tenantIds};this.showSpinner=!0,this.billSettlementService.generateBillDetails(t).subscribe({next:e=>{this.showSpinner=!1,this.billSettlement={},this.billSettlement.unbBilledConsumptions=e},error:e=>{this.showSpinner=!1,this.notificationMessage(e,"red-snackbar")}})}notificationMessage(e,t){this.snackbar.open(e,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[t]})}invoiceView(e){this.billService.invoicePreview(e).subscribe({next:e=>{e?this.downloadFile(e):this.notificationMessage("No data to print","red-snackbar")},error:e=>{this.notificationMessage("No data to print","red-snackbar")}})}downloadFile(e){return Object(r.a)(this,void 0,void 0,(function*(){const t=yield G.PDFDocument.create();for(const o of e){const e=yield G.PDFDocument.load(o);(yield t.copyPages(e,e.getPageIndices())).forEach(e=>{t.addPage(e)})}const i=yield t.save(),l=new Blob([i],{type:"application/pdf"}),n=window.URL.createObjectURL(l);window.open(n)}))}}return e.\u0275fac=function(t){return new(t||e)(m.Nb(c.a),m.Nb(F.a),m.Nb(k.b),m.Nb(_.a),m.Nb(C.a))},e.\u0275cmp=m.Hb({type:e,selectors:[["app-create-bill"]],viewQuery:function(e,t){var i;1&e&&(m.Jc(A,!0),m.Jc(V,!0)),2&e&&(m.zc(i=m.cc())&&(t.unbilledConsumptionComponent=i.first),m.zc(i=m.cc())&&(t.createBillToolbarComponent=i.first))},decls:30,vars:16,consts:[["mode","card",2,"margin-top","20px"],["class","loading-indicator",4,"ngIf"],["fxLayout","column"],["color","primary",1,"position-fixed"],["src","assets/img/fav-icon.png",1,"img-style"],[1,"toolbar-spacer"],["matTooltip","Reset","mat-icon-button","","aria-label","Example icon-button with menu icon",1,"example-icon",3,"click"],["matTooltip","Save","mat-icon-button","","aria-label","Example icon-button with menu icon",1,"example-icon",3,"click"],["fxFlex","noshrink","fxLayout","column","fxLayout.gt-sm","row","fxLayoutAlign.gt-sm","start stretch",3,"fxLayoutGap"],["fxFlex","grow",1,"basic-forms","route-animations-elements",3,"fxFlex.gt-sm"],["fxLayout","column",1,"result"],[3,"tenants","utilityTypes","billPeriods","filterClicked"],[3,"dataSource","isHide","hideHeader","printDataRows"],[1,"loading-indicator"],["mode","indeterminate","color","accent"]],template:function(e,t){1&e&&(m.Tb(0,"fury-page-layout",0),m.Pc(1,K,2,0,"div",1),m.Tb(2,"fury-page-layout-content",2),m.Tb(3,"mat-toolbar",3),m.Ob(4,"img",4),m.Tb(5,"span"),m.Rc(6,"Generate Bills"),m.Sb(),m.Ob(7,"span",5),m.Tb(8,"button",6),m.bc("click",(function(){return t.reset()})),m.Tb(9,"mat-icon"),m.Rc(10,"refresh"),m.Sb(),m.Sb(),m.Tb(11,"button",7),m.bc("click",(function(e){return t.onSaveBills(e)})),m.Tb(12,"mat-icon"),m.Rc(13,"save"),m.Sb(),m.Sb(),m.Sb(),m.Tb(14,"div",8),m.Tb(15,"fury-card",9),m.Ob(16,"fury-card-header"),m.Tb(17,"fury-card-content",2),m.Tb(18,"div",10),m.Tb(19,"app-create-bill-toolbar",11),m.bc("filterClicked",(function(e){return t.onGenerate(e)})),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Tb(20,"div",8),m.Tb(21,"fury-card",9),m.Tb(22,"fury-card-content",2),m.Tb(23,"div",10),m.Tb(24,"app-unbilled-consumption",12),m.bc("printDataRows",(function(e){return t.invoiceView(e)})),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Tb(25,"div",8),m.Tb(26,"fury-card",9),m.Tb(27,"fury-card-content",2),m.Tb(28,"div",10),m.Ob(29,"app-create-bill-footer-toolbar"),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb()),2&e&&(m.Cb(1),m.mc("ngIf",t.showSpinner),m.Cb(13),m.mc("fxLayoutGap",t.gap),m.Cb(1),m.mc("fxFlex.gt-sm",t.col2)("@fadeInUp",void 0),m.Cb(4),m.mc("tenants",t.tenants)("utilityTypes",t.utilityTypes)("billPeriods",t.billPeriods),m.Cb(1),m.mc("fxLayoutGap",t.gap),m.Cb(1),m.mc("fxFlex.gt-sm",t.col2)("@fadeInUp",void 0),m.Cb(3),m.mc("dataSource",t.billSettlement)("isHide",!1)("hideHeader",!1),m.Cb(1),m.mc("fxLayoutGap",t.gap),m.Cb(1),m.mc("fxFlex.gt-sm",t.col2)("@fadeInUp",void 0))},directives:[X.a,a.o,$.a,S.d,q.a,P.a,D.a,w.a,S.b,S.c,S.e,f.a,f.d,f.c,V,A,J,Q.a],styles:['.toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.img-style[_ngcontent-%COMP%]{width:32px}.loading-indicator[_ngcontent-%COMP%]{position:fixed;z-index:999;height:2em;width:2em;overflow:show;margin:auto;top:0;left:0;bottom:0;right:0}.loading-indicator[_ngcontent-%COMP%]:before{content:"";display:block;position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.3)}.position-fixed[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;top:0;z-index:5}'],data:{animation:[d.a,u.a]}}),e})();function ee(e,t){if(1&e&&(m.Tb(0,"mat-option",13),m.Rc(1),m.Sb()),2&e){const e=t.$implicit;m.mc("value",e.value),m.Cb(1),m.Tc("",e.label," ")}}function te(e,t){1&e&&(m.Tb(0,"mat-hint",14),m.Rc(1,"Select payment mode"),m.Sb())}function ie(e,t){if(1&e&&(m.Tb(0,"mat-option",13),m.Rc(1),m.Sb()),2&e){const e=t.$implicit;m.mc("value",e.value),m.Cb(1),m.Tc("",e.label," ")}}function le(e,t){1&e&&(m.Tb(0,"mat-hint",14),m.Rc(1,"Select bank"),m.Sb())}function ne(e,t){1&e&&(m.Tb(0,"mat-hint",14),m.Rc(1,"Select payment date"),m.Sb())}let oe=(()=>{class e{constructor(e){this.datePipe=e,this.banks=[],this.paymentModes=[],this.isShowValidation=!1,this.paymentModeId=0,this.bankId=0,this.paymentDate=this.datePipe.transform(new Date,"yyyy-MM-dd"),this.refNumber="",this.remarks="",this.disableBank=!1,this.validate=new m.o}ngOnInit(){}onChangeBank(e){this.bankId=e,this.validateControls()}onChangePaymentMode(e){this.paymentModeId=e;const t=this.paymentModes.find(t=>t.value==e);t&&(this.disableBank="Cash- Billing Collection"===t.label,this.bankId=0),this.validateControls()}validateControls(){let e=!0;(this.disableBank||this.bankId)&&this.paymentModeId&&this.paymentDate||(e=!1),this.validate.emit(e)}onDateChange(e){this.validateControls()}}return e.\u0275fac=function(t){return new(t||e)(m.Nb(a.f))},e.\u0275cmp=m.Hb({type:e,selectors:[["app-payment-details"]],inputs:{banks:"banks",paymentModes:"paymentModes",isShowValidation:"isShowValidation"},outputs:{validate:"validate"},decls:33,vars:13,consts:[[1,"person"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","24px"],[1,"result",2,"width","50%"],["id","PaymentMode","name","PaymentMode",3,"value","selectionChange","valueChange"],[3,"value",4,"ngFor","ngForOf"],["class","small",4,"ngIf"],["id","Bank","name","Bank",3,"disabled","value","selectionChange","valueChange"],["type","text","id","ReferenceNumber","name","ReferenceNumber","matInput","",3,"ngModel","ngModelChange"],["id","PaymentDate","name","PaymentDate","matInput","","readonly","",3,"ngModel","matDatepicker","click","ngModelChange","focus","dateInput"],["matSuffix","",3,"for"],["formDatepickerRef",""],["fxFlex","grow"],["type","text","id","Remarks","name","Remarks","matInput","",3,"ngModel","ngModelChange"],[3,"value"],[1,"small"]],template:function(e,t){if(1&e){const e=m.Ub();m.Tb(0,"mat-dialog-content"),m.Tb(1,"div",0),m.Tb(2,"div",1),m.Tb(3,"mat-form-field",2),m.Tb(4,"mat-label"),m.Rc(5,"Payment Mode"),m.Sb(),m.Tb(6,"mat-select",3),m.bc("selectionChange",(function(e){return t.onChangePaymentMode(e.value)}))("valueChange",(function(e){return t.paymentModeId=e})),m.Pc(7,ee,2,2,"mat-option",4),m.Sb(),m.Pc(8,te,2,0,"mat-hint",5),m.Sb(),m.Tb(9,"mat-form-field",2),m.Tb(10,"mat-label"),m.Rc(11,"Bank"),m.Sb(),m.Tb(12,"mat-select",6),m.bc("selectionChange",(function(e){return t.onChangeBank(e.value)}))("valueChange",(function(e){return t.bankId=e})),m.Pc(13,ie,2,2,"mat-option",4),m.Sb(),m.Pc(14,le,2,0,"mat-hint",5),m.Sb(),m.Sb(),m.Tb(15,"div",1),m.Tb(16,"mat-form-field",2),m.Tb(17,"mat-label"),m.Rc(18,"Ref Number"),m.Sb(),m.Tb(19,"input",7),m.bc("ngModelChange",(function(e){return t.refNumber=e})),m.Sb(),m.Sb(),m.Tb(20,"mat-form-field",2),m.Tb(21,"mat-label"),m.Rc(22,"Payment Date"),m.Sb(),m.Tb(23,"input",8),m.bc("click",(function(){return m.Ec(e),m.Ac(26).open()}))("ngModelChange",(function(e){return t.paymentDate=e}))("focus",(function(){return m.Ec(e),m.Ac(26).open()}))("dateInput",(function(e){return t.onDateChange(e)})),m.Sb(),m.Ob(24,"mat-datepicker-toggle",9),m.Ob(25,"mat-datepicker",null,10),m.Pc(27,ne,2,0,"mat-hint",5),m.Sb(),m.Sb(),m.Tb(28,"div",1),m.Tb(29,"mat-form-field",11),m.Tb(30,"mat-label"),m.Rc(31,"Remarks"),m.Sb(),m.Tb(32,"textarea",12),m.bc("ngModelChange",(function(e){return t.remarks=e})),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb()}if(2&e){const e=m.Ac(26);m.Cb(6),m.mc("value",t.paymentModeId),m.Cb(1),m.mc("ngForOf",t.paymentModes),m.Cb(1),m.mc("ngIf",t.isShowValidation&&!t.paymentModeId),m.Cb(4),m.mc("disabled",t.disableBank)("value",t.bankId),m.Cb(1),m.mc("ngForOf",t.banks),m.Cb(1),m.mc("ngIf",t.isShowValidation&&!t.disableBank&&!t.bankId),m.Cb(5),m.mc("ngModel",t.refNumber),m.Cb(4),m.mc("ngModel",t.paymentDate)("matDatepicker",e),m.Cb(1),m.mc("for",e),m.Cb(3),m.mc("ngIf",t.isShowValidation&&!t.paymentDate),m.Cb(5),m.mc("ngModel",t.remarks)}},directives:[h.f,S.d,S.e,I.d,I.h,O.a,a.n,a.o,W.b,l.c,l.q,l.t,B.b,B.d,I.j,B.a,S.b,L.n,I.g],styles:[".small[_ngcontent-%COMP%]{color:red}"]}),e})();function ae(e,t){if(1&e&&(m.Tb(0,"mat-option",9),m.Rc(1),m.Sb()),2&e){const e=t.$implicit;m.mc("value",e.value),m.Cb(1),m.Tc(" ",e.label," ")}}let se=(()=>{class e{constructor(e,t){this.data=e,this.dialogRef=t,this.accountHeadItems=[],this.accountHeadName="",this.accountHeadId=0,this.amount=0}ngOnInit(){this.onGetAccountHeads(this.data)}onGetAccountHeads(e){this.accountHeadItems=[{label:"Select",value:0}],e.forEach(e=>{this.accountHeadItems.push({label:e.accountHeadName,value:e.id})})}onChangeAccountHeads(e){this.accountHeadId=e;const t=this.data.find(e=>e.id===this.accountHeadId);t&&(this.accountHeadName=t.accountHeadName,this.amount=t.fixedAmount)}onAddNewItem(){this.dialogRef.close({id:this.accountHeadId,accountHeadName:this.accountHeadName,fixedAmount:this.amount})}}return e.\u0275fac=function(t){return new(t||e)(m.Nb(h.a),m.Nb(h.h))},e.\u0275cmp=m.Hb({type:e,selectors:[["app-add-new-account-head"]],decls:19,vars:3,consts:[[1,"person"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","24px"],[1,"result"],["id","AccountHeads","name","AccountHeads",3,"value","selectionChange","valueChange"],[3,"value",4,"ngFor","ngForOf"],["color","primary",1,"result"],["type","text","id","Amount","name","Amount","matInput","",3,"ngModel","ngModelChange"],[1,"fury-flex-form-field"],["color","primary","mat-raised-button","",3,"click"],[3,"value"]],template:function(e,t){1&e&&(m.Tb(0,"fury-card-header"),m.Tb(1,"fury-card-header-heading"),m.Rc(2,"Add Account Heads"),m.Sb(),m.Sb(),m.Tb(3,"mat-dialog-content"),m.Tb(4,"div",0),m.Tb(5,"div",1),m.Tb(6,"mat-form-field",2),m.Tb(7,"mat-label"),m.Rc(8,"Account Head"),m.Sb(),m.Tb(9,"mat-select",3),m.bc("selectionChange",(function(e){return t.onChangeAccountHeads(e.value)}))("valueChange",(function(e){return t.accountHeadId=e})),m.Pc(10,ae,2,2,"mat-option",4),m.Sb(),m.Sb(),m.Tb(11,"mat-form-field",5),m.Tb(12,"mat-label"),m.Rc(13,"Amount"),m.Sb(),m.Tb(14,"input",6),m.bc("ngModelChange",(function(e){return t.amount=e})),m.Sb(),m.Sb(),m.Tb(15,"div",7),m.Tb(16,"button",8),m.bc("click",(function(){return t.onAddNewItem()})),m.Tb(17,"span"),m.Rc(18,"ADD"),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb()),2&e&&(m.Cb(9),m.mc("value",t.accountHeadId),m.Cb(1),m.mc("ngForOf",t.accountHeadItems),m.Cb(4),m.mc("ngModel",t.amount))},directives:[f.d,f.g,h.f,S.d,S.e,I.d,I.h,O.a,a.n,W.b,l.c,l.q,l.t,P.a,L.n],styles:[""]}),e})();var re=i("+0xr"),ce=i("6GKC"),ue=i("dUAH");function de(e,t){if(1&e&&(m.Tb(0,"div",1),m.Tb(1,"mat-form-field",2),m.Tb(2,"mat-label"),m.Rc(3),m.Sb(),m.Ob(4,"input",9),m.gc(5,"noComma"),m.gc(6,"number"),m.Sb(),m.Sb()),2&e){const e=m.fc();m.Cb(3),m.Sc(e.labelName),m.Cb(1),m.mc("ngModel",m.hc(5,2,m.ic(6,4,e.excessAmount,e.roundFormat)))}}let me=(()=>{class e{constructor(e,t){this.dialog=e,this.decimalPipe=t,this.accountHeads=[],this.accountHeadData=[],this.dateFormat=Object(b.e)("DateFormat"),this.currencyFormat=Object(b.e)("Currency",0),this.roundFormat=Object(b.e)("RoundOff"),this.amountdecimalPlaces=parseInt(this.roundFormat.substring(this.roundFormat.indexOf("-")+1,this.roundFormat.length)),this.isAdjustWithAdvance=!0,this.labelName="Excess Amount",this.isDisable=!1,this.isHide=!1,this.isValidPayment=new m.o,this.billAmount=0,this.total=0,this.roundOff=0,this.toPay="0",this.vatAmount=0,this.excessAmount=0,this.previousAdvanceAmount=0,this.advanceAdjusted=0,this.columns=[],this.identifierColumnNmae="#",this.accountHeadColumnName="Account Head",this.amountColumnName="Amount"}set dataSource(e){this.dateFormat=Object(b.e)("DateFormat"),this.roundFormat=Object(b.e)("RoundOff"),this.currencyFormat=Object(b.e)("Currency",0),e&&!this.isHide?(e.accountHeads&&e.accountHeads.length&&(this.accountHeads=e.accountHeads,this.accountHeadData=e.accountHeads.filter(e=>"VAT"!==e.accountHeadName)),e.outstandingBills&&e.outstandingBills.length?(this.billAmount=0,e.outstandingBills.forEach(e=>this.billAmount+=Number(e.toPay)),this.toPay=this.decimalPipe.transform(this.billAmount,this.roundFormat.toString()).replace(/,/g,""),this.roundOff=this.total=this.billAmount=Number(this.decimalPipe.transform(this.billAmount,this.roundFormat.toString()).replace(/,/g,""))):(this.toPay="0",this.advanceAdjusted=this.excessAmount=this.roundOff=this.total=this.billAmount=0)):(this.toPay="0",this.advanceAdjusted=this.excessAmount=this.roundOff=this.total=this.billAmount=0),this.previousAdvanceAmount=e&&e.advance?e.advance.advanceAmount:0,e&&e.openingBalance?(this.billAmount=e.openingBalance.amount,this.total+=this.billAmount,this.total>this.previousAdvanceAmount?(this.advanceAdjusted=this.previousAdvanceAmount,this.toPay=this.decimalPipe.transform(this.total-this.previousAdvanceAmount,this.roundFormat.toString()).replace(/,/g,"")):this.total<this.previousAdvanceAmount&&(this.advanceAdjusted=this.total,this.toPay="0")):this.billAmount=0,this.advanceAdjusted>0&&Number(this.toPay)>=0||Number(this.toPay)>0?this.isValidPayment.emit(!0):this.isValidPayment.emit(!1),this.toPay=this.decimalPipe.transform(this.toPay,this.roundFormat.toString()).replace(/,/g,"")}set selectedRows(e){e&&e.length?(this.total=this.excessAmount=0,this.dateFormat=Object(b.e)("DateFormat"),this.roundFormat=Object(b.e)("RoundOff"),this.currencyFormat=Object(b.e)("Currency",0),e.forEach(e=>this.total+=Number(e.toPay)),this.total&&(this.previousAdvanceAmount>0?(this.roundOff=this.total=Number(this.decimalPipe.transform(this.total+this.billAmount,this.roundFormat.toString()).replace(/,/g,"")),this.total>this.previousAdvanceAmount?(this.advanceAdjusted=this.previousAdvanceAmount,this.toPay=this.decimalPipe.transform(this.total-this.previousAdvanceAmount,this.roundFormat.toString()).replace(/,/g,"")):(this.advanceAdjusted=this.total,this.toPay="0")):(this.toPay=this.decimalPipe.transform(this.total+this.billAmount,this.roundFormat.toString()).replace(/,/g,""),this.roundOff=this.total=Number(this.decimalPipe.transform(this.total+this.billAmount,this.roundFormat.toString()).replace(/,/g,"")),this.advanceAdjusted=0))):(this.total=this.excessAmount=0,this.total+=this.billAmount,this.total>this.previousAdvanceAmount?(this.advanceAdjusted=this.previousAdvanceAmount,this.toPay=this.decimalPipe.transform(this.total-this.previousAdvanceAmount,this.roundFormat.toString()).replace(/,/g,"")):this.total<this.previousAdvanceAmount?(this.advanceAdjusted=this.total,this.toPay="0"):(this.advanceAdjusted=0,this.toPay=this.decimalPipe.transform(this.billAmount,this.roundFormat.toString()).replace(/,/g,""),this.roundOff=this.total=this.billAmount)),this.advanceAdjusted>0&&Number(this.toPay)>=0||Number(this.toPay)>0?this.isValidPayment.emit(!0):this.isValidPayment.emit(!1)}ngOnInit(){this.createGridColumns()}createGridColumns(){this.columns=[{name:this.accountHeadColumnName,property:"accountHeadName",visible:!0,isModelProperty:!0},{name:this.amountColumnName,property:"fixedAmount",visible:!0,isModelProperty:!0}]}addNewItem(){this.dialog.open(se,{data:this.accountHeadData}).afterClosed().subscribe(e=>{e&&(e.rowNumber=this.accountHeads.length+1,this.accountHeads.push(e),this.accountHeads&&(this.tableStructureComponent.dataSource=new re.k,this.tableStructureComponent.dataSource.data=this.accountHeads,this.accountHeads.forEach(e=>this.total+=e.fixedAmount),this.roundOff=this.total,this.toPay=this.decimalPipe.transform(this.total,this.roundFormat.toString()).replace(/,/g,"")))})}onAdvanceAdjustedChange(e){Number(this.toPay)>this.total?(this.labelName="Excess Amount",this.excessAmount=Number(this.decimalPipe.transform(Number(this.toPay)-this.total,this.roundFormat.toString()).replace(/,/g,""))):(this.labelName="Balance Amount",this.excessAmount=Number(this.decimalPipe.transform(this.total-Number(this.toPay),this.roundFormat.toString()).replace(/,/g,"")))}onToPayAmountChange(e){this.advanceAdjusted>0&&Number(this.toPay)>=0||Number(this.toPay)>0?this.isValidPayment.emit(!0):this.isValidPayment.emit(!1),Object(b.c)(this.toPay)+Object(b.c)(this.advanceAdjusted)>Object(b.c)(this.total)?(this.labelName="Excess Amount",this.excessAmount=Number(this.decimalPipe.transform(Object(b.c)(this.toPay)+Object(b.c)(this.advanceAdjusted)-Object(b.c)(this.total),this.roundFormat.toString()).replace(/,/g,""))):(this.labelName="Balance Amount",this.excessAmount=Number(this.decimalPipe.transform(Object(b.c)(this.total)-Object(b.c)(this.toPay)-Object(b.c)(this.advanceAdjusted),this.roundFormat.toString()).replace(/,/g,"")))}onRoundOffAmountChange(e){e>0?this.toPay=this.decimalPipe.transform(Number(this.total)+Number(e),this.roundFormat.toString()).replace(/,/g,""):(this.roundOff=0,this.toPay=this.decimalPipe.transform(this.total,this.roundFormat.toString()).replace(/,/g,""))}onCalculateVAT(e){if(e&&e.length){const t=e.find(e=>"VAT"===e.accountHeadName);t&&("GrandTotal"===t.formulaDescription&&"Percentage"===t.operatorDescription?this.vatAmount=Number(this.decimalPipe.transform(Number(this.toPay)*Number(t.fixedAmount)/100,this.roundFormat)):"GrandTotal"===t.formulaDescription&&"Add"===t.operatorDescription&&(this.vatAmount=Number(this.decimalPipe.transform(Number(this.toPay)+Number(t.fixedAmount),this.roundFormat))),"GrandTotal"===t.formulaDescription&&"Multiply"===t.operatorDescription&&(this.vatAmount=Number(this.decimalPipe.transform(Number(this.toPay)*Number(t.fixedAmount),this.roundFormat))),"GrandTotal"===t.formulaDescription&&"Subtract"===t.operatorDescription&&(this.vatAmount=Number(this.decimalPipe.transform(Number(this.toPay)-Number(t.fixedAmount),this.roundFormat))),"GrandTotal"===t.formulaDescription&&"Divide"===t.operatorDescription&&(this.vatAmount=Number(this.decimalPipe.transform(Number(this.toPay)/Number(t.fixedAmount),this.roundFormat))))}this.toPay=this.decimalPipe.transform(Number(this.toPay)+this.vatAmount,this.roundFormat)}onChangeAdjustWithAdvance(e){if(this.isAdjustWithAdvance=e.checked,this.isAdjustWithAdvance)if(this.total>=this.previousAdvanceAmount){const e=Number(this.total),t=Number(this.previousAdvanceAmount);this.toPay=this.decimalPipe.transform(Number(e-t),this.roundFormat.toString()).replace(/,/g,"")}else this.toPay="0";else this.toPay=this.decimalPipe.transform(Number(this.total),this.roundFormat.toString()).replace(/,/g,"")}}return e.\u0275fac=function(t){return new(t||e)(m.Nb(h.b),m.Nb(a.g))},e.\u0275cmp=m.Hb({type:e,selectors:[["app-bill-amount-details"]],viewQuery:function(e,t){var i;1&e&&m.Vc(g.a,!0),2&e&&m.zc(i=m.cc())&&(t.tableStructureComponent=i.first)},inputs:{isDisable:"isDisable",isHide:"isHide",dataSource:"dataSource",selectedRows:"selectedRows"},outputs:{isValidPayment:"isValidPayment"},decls:36,vars:27,consts:[[1,"person"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","8px"],["color","primary",2,"width","100%"],["type","text","id","OutstandingBillAmount","name","OutstandingBillAmount","readonly","","matInput","",2,"text-align","right",3,"ngModel"],["id","Total","name","Total","matInput","","readonly","",2,"text-align","right",3,"ngModel"],["id","PreviousAdvance","name","PreviousAdvance","matInput","","readonly","",2,"text-align","right",3,"ngModel"],["id","ToPay","name","ToPay","matInput","","autofocus","","furyValidateDecimalPlacesDirective","",2,"text-align","right",3,"ngModel","disabled","ngModelChange","input"],["id","advanceAdjusted","name","advanceAdjusted","matInput","","readonly","",2,"text-align","right",3,"ngModel","input"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","8px",4,"ngIf"],["id","ExcessAmount","name","ExcessAmount","matInput","","furyValidateDecimalPlacesDirective","",2,"text-align","right",3,"ngModel"]],template:function(e,t){1&e&&(m.Tb(0,"mat-dialog-content"),m.Tb(1,"div",0),m.Tb(2,"div",1),m.Tb(3,"mat-form-field",2),m.Tb(4,"mat-label"),m.Rc(5,"Opening Due Amount"),m.Sb(),m.Ob(6,"input",3),m.gc(7,"noComma"),m.gc(8,"number"),m.Sb(),m.Sb(),m.Tb(9,"div",1),m.Tb(10,"mat-form-field",2),m.Tb(11,"mat-label"),m.Rc(12,"Total"),m.Sb(),m.Ob(13,"input",4),m.gc(14,"noComma"),m.gc(15,"number"),m.Sb(),m.Sb(),m.Tb(16,"div",1),m.Tb(17,"mat-form-field",2),m.Tb(18,"mat-label"),m.Rc(19,"Previous Advance"),m.Sb(),m.Ob(20,"input",5),m.gc(21,"noComma"),m.gc(22,"number"),m.Sb(),m.Sb(),m.Tb(23,"div",1),m.Tb(24,"mat-form-field",2),m.Tb(25,"mat-label"),m.Rc(26,"To Pay"),m.Sb(),m.Tb(27,"input",6),m.bc("ngModelChange",(function(e){return t.toPay=e}))("input",(function(e){return t.onToPayAmountChange(e.target.value)})),m.Sb(),m.Sb(),m.Sb(),m.Tb(28,"div",1),m.Tb(29,"mat-form-field",2),m.Tb(30,"mat-label"),m.Rc(31,"Advance Adjusted"),m.Sb(),m.Tb(32,"input",7),m.bc("input",(function(e){return t.onAdvanceAdjustedChange(e.target.value)})),m.gc(33,"noComma"),m.gc(34,"number"),m.Sb(),m.Sb(),m.Sb(),m.Pc(35,de,7,7,"div",8),m.Sb(),m.Sb()),2&e&&(m.Cb(6),m.mc("ngModel",m.hc(7,7,m.ic(8,9,t.billAmount,t.roundFormat))),m.Cb(7),m.mc("ngModel",m.hc(14,12,m.ic(15,14,t.total,t.roundFormat))),m.Cb(7),m.mc("ngModel",m.hc(21,17,m.ic(22,19,t.previousAdvanceAmount,t.roundFormat))),m.Cb(7),m.mc("ngModel",t.toPay)("disabled",t.isDisable),m.Cb(5),m.mc("ngModel",m.hc(33,22,m.ic(34,24,t.advanceAdjusted,t.roundFormat))),m.Cb(3),m.mc("ngIf",t.isHide))},directives:[h.f,S.d,S.e,I.d,I.h,W.b,l.c,l.q,l.t,ce.a,a.o],pipes:[ue.a,a.g],styles:[".small[_ngcontent-%COMP%]{color:red}"]}),e})(),he=(()=>{class e{constructor(e,t,i){var l,n,o;this.date=e,this.currencyPipe=t,this.envService=i,this.outStandingBills=[],this.selectedRows=[],this.columns=[],this.dateColumnName="Date",this.billNumberConsumptionColumnName="Bill No",this.unitColumnName="Unit",this.consumptionColumnName="Consumption",this.amountColumnName="Net Amount",this.creditNoteAmount="Credit Note Amount",this.paidColumnName="Paid",this.toPayColumnName="To Pay",this.format="",this.currency="",this.roundFormat="",this.isHide=!0,this.isAutoSelect=!1,this.disableCheckBox=!1,this.rowsSelected=new m.o,this.format=null!==(l=Object(b.e)("DateFormat"))&&void 0!==l?l:i.dateFormat,this.currency=null!==(n=Object(b.e)("Currency"))&&void 0!==n?n:i.currencyFormat,this.roundFormat=null!==(o=Object(b.e)("RoundOff"))&&void 0!==o?o:i.roundOffFormat}set dataSource(e){e&&(this.outStandingBills=e.outstandingBills&&e.outstandingBills.length?this.updateDataFormats(e.outstandingBills):[])}ngOnInit(){this.createGridColumns(),this.isHide&&this.updateTableColumns()}createGridColumns(){this.columns=[{name:"Checkbox",property:"checkbox",visible:!0},{name:this.dateColumnName,property:"billDateLocal",visible:!0,isModelProperty:!0},{name:this.billNumberConsumptionColumnName,property:"billNumber",visible:!0,isModelProperty:!0},{name:this.unitColumnName,property:"unitNumber",visible:!0,isModelProperty:!0},{name:this.amountColumnName,property:"netAmountLocal",visible:!0,isModelProperty:!0,columnAlign:{"text-align":"right"}},{name:this.paidColumnName,property:"paidLocal",visible:!0,isModelProperty:!0,columnAlign:{"text-align":"right"}},{name:this.toPayColumnName,property:"toPayLocal",visible:!0,isModelProperty:!0,columnAlign:{"text-align":"right"}}]}updateTableColumns(){this.columns.splice(0,1)}onSelectedRows(e){this.selectedRows=[],this.selectedRows=e,this.rowsSelected.emit(this.selectedRows)}updateDataFormats(e){return e&&(this.format=Object(b.e)("DateFormat"),this.roundFormat=Object(b.e)("RoundOff"),this.currency=Object(b.e)("Currency"),e.forEach(e=>{e.billDateLocal=this.date.transform(e.billDate.toString(),this.format.toString()),e.billAmountLocal=this.currencyPipe.transform(e.billAmount,this.currency.toString(),!0,this.roundFormat),e.netAmountLocal=this.currencyPipe.transform(e.billAmount-e.creditNoteAmount,this.currency.toString(),!0,this.roundFormat),e.creditNoteAmountLocal=this.currencyPipe.transform(e.creditNoteAmount,this.currency.toString(),!0,this.roundFormat),e.toPayLocal=this.currencyPipe.transform(e.toPay,this.currency.toString(),!0,this.roundFormat),e.paidLocal=this.currencyPipe.transform(e.paid,this.currency.toString(),!0,this.roundFormat)})),e}}return e.\u0275fac=function(t){return new(t||e)(m.Nb(a.f),m.Nb(a.d),m.Nb(p.a))},e.\u0275cmp=m.Hb({type:e,selectors:[["app-outstanding-bills"]],inputs:{isHide:"isHide",isAutoSelect:"isAutoSelect",disableCheckBox:"disableCheckBox",dataSource:"dataSource"},outputs:{rowsSelected:"rowsSelected"},decls:5,vars:4,consts:[[1,"person"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","1px"],[1,"fury-flex-form-field"],[3,"isAutoSelect","tableData","columns","disableCheckBox","selectedRows"]],template:function(e,t){1&e&&(m.Tb(0,"mat-dialog-content"),m.Tb(1,"div",0),m.Tb(2,"div",1),m.Tb(3,"div",2),m.Tb(4,"app-table-structure",3),m.bc("selectedRows",(function(e){return t.onSelectedRows(e)})),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb()),2&e&&(m.Cb(4),m.mc("isAutoSelect",t.isAutoSelect)("tableData",t.outStandingBills)("columns",t.columns)("disableCheckBox",t.disableCheckBox))},directives:[h.f,S.d,S.e,g.a],styles:[""]}),e})();var be=i("AJS6"),pe=i("RNk+"),fe=i("i680");let ge=(()=>{class e{constructor(){this.saveClicked=new m.o,this.printClicked=new m.o,this.isDisabled=!1,this.isPrintDisable=!0}ngOnInit(){}onSave(){this.saveClicked.emit(!0)}onPrint(){this.printClicked.emit(!0)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=m.Hb({type:e,selectors:[["app-final-bill-settlement-footer-toolbar"]],inputs:{isDisabled:"isDisabled",isPrintDisable:"isPrintDisable"},outputs:{saveClicked:"saveClicked",printClicked:"printClicked"},decls:9,vars:2,consts:[[1,"person"],["matTooltip","Save","mat-icon-button","","aria-label","Example icon-button with menu icon",1,"example-icon",3,"disabled","click"],["matTooltip","Print","mat-icon-button","","aria-label","Example icon-button with menu icon",1,"example-icon",3,"disabled","click"]],template:function(e,t){1&e&&(m.Tb(0,"mat-dialog-content"),m.Tb(1,"div",0),m.Tb(2,"form"),m.Tb(3,"button",1),m.bc("click",(function(){return t.onSave()})),m.Tb(4,"mat-icon"),m.Rc(5,"save"),m.Sb(),m.Sb(),m.Tb(6,"button",2),m.bc("click",(function(){return t.onPrint()})),m.Tb(7,"mat-icon"),m.Rc(8,"print"),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb()),2&e&&(m.Cb(3),m.mc("disabled",t.isDisabled),m.Cb(3),m.mc("disabled",t.isPrintDisable))},directives:[h.f,l.z,l.r,l.s,P.a,D.a,w.a],styles:[""]}),e})();var ve=i("znSr"),ye=i("/1cH"),Ce=i("QibW");function Se(e,t){if(1&e){const e=m.Ub();m.Tb(0,"mat-radio-button",19),m.bc("change",(function(t){return m.Ec(e),m.fc(2).radioChange(t)})),m.Tb(1,"div",20),m.Rc(2),m.Sb(),m.Sb()}if(2&e){const e=t.$implicit;m.mc("value",e),m.Cb(2),m.Tc(" ",e.label," ")}}function Te(e,t){if(1&e){const e=m.Ub();m.Tb(0,"div",16),m.Tb(1,"mat-radio-group",17),m.bc("ngModelChange",(function(t){return m.Ec(e),m.fc().selectedOption=t})),m.Pc(2,Se,3,2,"mat-radio-button",18),m.Sb(),m.Sb()}if(2&e){const e=m.fc();m.Cb(1),m.mc("ngModel",e.selectedOption),m.Cb(1),m.mc("ngForOf",e.options)}}function Pe(e,t){if(1&e&&(m.Tb(0,"mat-option",21),m.Rc(1),m.Sb()),2&e){const e=t.$implicit;m.mc("value",e.ownerName),m.Cb(1),m.Tc(" ",e.ownerName," ")}}function De(e,t){1&e&&(m.Tb(0,"mat-hint"),m.Rc(1,"Please select Tenant"),m.Sb())}function we(e,t){if(1&e&&(m.Tb(0,"mat-option",21),m.Rc(1),m.Sb()),2&e){const e=t.$implicit;m.mc("value",e.unitNumber),m.Cb(1),m.Tc(" ",e.unitNumber," ")}}function Ne(e,t){1&e&&(m.Tb(0,"mat-hint"),m.Rc(1,"Please select Unit"),m.Sb())}function xe(e,t){if(1&e&&(m.Tb(0,"mat-option",21),m.Rc(1),m.Sb()),2&e){const e=t.$implicit;m.mc("value",e.description),m.Cb(1),m.Tc(" ",e.description," ")}}function Ae(e,t){1&e&&(m.Tb(0,"mat-hint"),m.Rc(1,"Please select Account Number"),m.Sb())}const Fe=function(e){return{width:e}};function Re(e,t){if(1&e){const e=m.Ub();m.Tb(0,"mat-form-field",4),m.Tb(1,"mat-label"),m.Rc(2,"Account Number"),m.Sb(),m.Tb(3,"input",22),m.bc("input",(function(t){return m.Ec(e),m.fc().filterAccountNumber(t.target.value)})),m.Sb(),m.Tb(4,"mat-autocomplete",6,23),m.bc("optionSelected",(function(t){return m.Ec(e),m.fc().selectAccountNumber(t)})),m.Pc(6,xe,2,2,"mat-option",8),m.Sb(),m.Pc(7,Ae,2,0,"mat-hint",9),m.Sb()}if(2&e){const e=m.Ac(5),t=m.fc();m.mc("ngStyle",m.rc(4,Fe,t.isHide?"220px":"180px")),m.Cb(3),m.mc("matAutocomplete",e),m.Cb(3),m.mc("ngForOf",t.filteredAccountNumbers),m.Cb(1),m.mc("ngIf",3==(null==t.selectedOption?null:t.selectedOption.value))}}function ke(e,t){if(1&e&&(m.Tb(0,"mat-option",21),m.Rc(1),m.Sb()),2&e){const e=t.$implicit;m.mc("value",e.value),m.Cb(1),m.Tc("",e.label," ")}}function Ie(e,t){if(1&e){const e=m.Ub();m.Tb(0,"mat-form-field",24),m.Tb(1,"mat-label"),m.Rc(2,"Bill Period"),m.Sb(),m.Tb(3,"mat-select",25),m.bc("selectionChange",(function(t){return m.Ec(e),m.fc().onChangeBillPeriod(t.value)}))("valueChange",(function(t){return m.Ec(e),m.fc().billPeriodId=t})),m.Pc(4,ke,2,2,"mat-option",8),m.Sb(),m.Sb()}if(2&e){const e=m.fc();m.Cb(3),m.mc("value",e.billPeriodId),m.Cb(1),m.mc("ngForOf",e.billPeriods)}}const Oe=function(){return{standalone:!0}};function We(e,t){if(1&e){const e=m.Ub();m.Tb(0,"mat-form-field",24),m.Tb(1,"mat-label"),m.Rc(2,"settlement Date"),m.Sb(),m.Tb(3,"input",26),m.bc("click",(function(){return m.Ec(e),m.Ac(6).open()}))("ngModelChange",(function(t){return m.Ec(e),m.fc().settlementDate=t}))("focus",(function(){return m.Ec(e),m.Ac(6).open()})),m.Sb(),m.Ob(4,"mat-datepicker-toggle",27),m.Ob(5,"mat-datepicker",null,28),m.Sb()}if(2&e){const e=m.Ac(6),t=m.fc();m.Cb(3),m.mc("ngModel",t.settlementDate)("matDatepicker",e)("ngModelOptions",m.qc(4,Oe)),m.Cb(1),m.mc("for",e)}}let Me=(()=>{class e{constructor(e,t,i,l,n){this.fb=e,this.snackbar=t,this.billSettlementService=i,this.datePipe=l,this.cookieService=n,this.unitId=0,this.unitNumber="",this.tenantId=0,this.accountNumber="",this.billPeriodId=0,this.settlementDate=R(new Date).format("YYYY-MM-DD"),this.filteredTenants=[],this.filteredUnits=[],this.filteredAccountNumbers=[],this.data=[],this.selectedOption=null,this.manageParams={},this.options=[],this.billPeriods=[],this.isHide=!0,this.isVisible=!0,this.searchClicked=new m.o}get tenants(){return this.data}set tenants(e){this.filteredTenants=this.data=e}get selectedTenant(){return this.tenantId}set selectedTenant(e){this.tenantId=e,this.setTenantNameValue(e)}ngOnInit(){this.clientId=parseInt(this.cookieService.get("globalClientId")),this.filteredTenants=this.tenants,this.billSettlementService.getUnits(this.clientId).subscribe(e=>{this.units=e,this.filteredUnits=e}),this.billSettlementService.getAccountNumbers(this.clientId).subscribe(e=>{this.accountNumbers=e,this.filteredAccountNumbers=e}),null==this.selectedOption&&(this.selectedOption=this.options[0]),this.form=this.fb.group({option:[null],tenantName:[""],unitNumber:[""],accountNumber:[""]}),this.radioChange(null),this.form.controls.unitNumber.valueChanges.subscribe(e=>{this.filteredUnits=this.filterUnit(e)}),this.form.controls.accountNumber.valueChanges.subscribe(e=>{this.filteredAccountNumbers=this.filterAccountNumber(e)})}onSearch(){this.unitNumber||this.tenantId||this.billPeriodId?(this.manageParams={unitNumber:this.unitNumber,tenantId:""+(this.tenantId?this.tenantId:"0"),billPeriodId:""+(this.billPeriodId?this.billPeriodId:"0"),settlementDate:""==this.settlementDate?"":R(this.settlementDate).format("YYYY-MM-DD"),billType:2,clientId:this.clientId},this.searchClicked.emit(this.manageParams)):this.snackbar.open("Invalid search parameters",null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:["yellow-snackbar"]})}selectTenant(e){this.tenants.forEach(t=>{t.ownerName===e.option.value&&(this.tenantId=t.id)})}selectUnit(e){this.units.forEach(t=>{t.unitNumber===e.option.value&&(this.unitId=t.id,this.unitNumber=t.unitNumber,this.tenantId=t.tenantId)})}selectAccountNumber(e){this.accountNumbers.forEach(t=>{t.description===e.option.value&&(this.tenantId=t.id,this.accountNumber=t.description)})}onChangeBillPeriod(e){this.billPeriodId=e}filterTenant(e){this.filteredTenants=this.data.filter(t=>0===t.ownerName.toLowerCase().indexOf(e.toLowerCase()))}filterUnit(e){return this.filteredUnits=e&&""!=e?this.units.filter(t=>0===t.unitNumber.toLowerCase().indexOf(e.toLowerCase())):this.units,this.filteredUnits}filterAccountNumber(e){return this.filteredAccountNumbers=e&&""!=e?this.accountNumbers.filter(t=>0===t.description.toLowerCase().indexOf(e.toLowerCase())):this.accountNumbers,this.filteredAccountNumbers}radioChange(e){null!=e&&(this.selectedOption=e.value),1==this.selectedOption.value?(this.form.controls.tenantName.enable(),this.form.controls.unitNumber.setValue(""),this.form.controls.unitNumber.disable(),this.unitId=0,this.unitNumber="",this.form.controls.accountNumber.setValue(""),this.form.controls.accountNumber.disable()):2==this.selectedOption.value?(this.tenantId=0,this.form.controls.tenantName.setValue(""),this.form.controls.tenantName.disable(),this.form.controls.unitNumber.enable(),this.form.controls.accountNumber.setValue(""),this.form.controls.accountNumber.disable()):(this.form.controls.tenantName.setValue(""),this.form.controls.tenantName.disable(),this.unitId=0,this.unitNumber="",this.form.controls.unitNumber.setValue(""),this.form.controls.unitNumber.disable(),this.form.controls.accountNumber.enable())}setTenantNameValue(e){const t=this.data.find(t=>t.id===e);t&&this.form.controls.tenantName.setValue(t.ownerName)}searchTenant(e){let t=this.selectOwnerTenant(e.toLowerCase());this.filteredTenants=t}selectOwnerTenant(e){let t=[];if(!e)return this.data;for(let i of this.data)i.ownerName.toLowerCase().indexOf(e)>-1&&t.push(i);return t}handleInput(e){e.stopPropagation()}}return e.\u0275fac=function(t){return new(t||e)(m.Nb(l.f),m.Nb(k.b),m.Nb(F.a),m.Nb(a.f),m.Nb(C.a))},e.\u0275cmp=m.Hb({type:e,selectors:[["app-final-bill-settlement-toolbar"]],inputs:{settlementDate:"settlementDate",tenants:"tenants",selectedTenant:"selectedTenant",options:"options",billPeriods:"billPeriods",isHide:"isHide",isVisible:"isVisible"},outputs:{searchClicked:"searchClicked"},decls:28,vars:18,consts:[[1,"person"],[3,"formGroup"],["fxLayout","row",4,"ngIf"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","20px",1,"padding-top"],["color","primary",1,"result",3,"ngStyle"],["type","text","formControlName","tenantName","id","TenantName","name","TenantName","matInput","",3,"matAutocomplete","keyup","keydown"],[3,"optionSelected"],["tenant","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["type","text","id","unitNumber","matInput","","formControlName","unitNumber",3,"matAutocomplete","input"],["unit","matAutocomplete"],["class","result","color","primary",3,"ngStyle",4,"ngIf"],["class","result","color","primary","style","width: 150px;",4,"ngIf"],[1,"fury-flex-form-field"],["mat-icon-button","","aria-label","Example icon-button with menu icon",1,"example-icon",3,"disabled","click"],["fxLayout","row"],["aria-labelledby","example-radio-group-label","formControlName","option",1,"example-radio-group",3,"ngModel","ngModelChange"],["class","example-radio-button marginRadioButton",3,"value","change",4,"ngFor","ngForOf"],[1,"example-radio-button","marginRadioButton",3,"value","change"],["fxLayout","row",2,"margin-right","30px"],[3,"value"],["type","text","matInput","","formControlName","accountNumber",3,"matAutocomplete","input"],["accountNumber","matAutocomplete"],["color","primary",1,"result",2,"width","150px"],["id","BillPeriod","name","BillPeriod",3,"value","selectionChange","valueChange"],["id","settlementDate","name","settlementDate","matInput","","readonly","",3,"ngModel","matDatepicker","ngModelOptions","click","ngModelChange","focus"],["matSuffix","",3,"for"],["formDatepickerRef",""]],template:function(e,t){if(1&e&&(m.Tb(0,"mat-dialog-content"),m.Tb(1,"div",0),m.Tb(2,"form",1),m.Pc(3,Te,3,2,"div",2),m.Tb(4,"div",3),m.Tb(5,"mat-form-field",4),m.Tb(6,"mat-label"),m.Rc(7,"Tenant Name"),m.Sb(),m.Tb(8,"input",5),m.bc("keyup",(function(e){return t.searchTenant(e.target.value)}))("keydown",(function(e){return t.handleInput(e)})),m.Sb(),m.Tb(9,"mat-autocomplete",6,7),m.bc("optionSelected",(function(e){return t.selectTenant(e)})),m.Pc(11,Pe,2,2,"mat-option",8),m.Sb(),m.Pc(12,De,2,0,"mat-hint",9),m.Sb(),m.Tb(13,"mat-form-field",4),m.Tb(14,"mat-label"),m.Rc(15,"Unit Number"),m.Sb(),m.Tb(16,"input",10),m.bc("input",(function(e){return t.filterUnit(e.target.value)})),m.Sb(),m.Tb(17,"mat-autocomplete",6,11),m.bc("optionSelected",(function(e){return t.selectUnit(e)})),m.Pc(19,we,2,2,"mat-option",8),m.Sb(),m.Pc(20,Ne,2,0,"mat-hint",9),m.Sb(),m.Pc(21,Re,8,6,"mat-form-field",12),m.Pc(22,Ie,5,2,"mat-form-field",13),m.Pc(23,We,7,5,"mat-form-field",13),m.Tb(24,"div",14),m.Tb(25,"button",15),m.bc("click",(function(){return t.onSearch()})),m.Tb(26,"mat-icon"),m.Rc(27,"search"),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb()),2&e){const e=m.Ac(10),i=m.Ac(18);m.Cb(2),m.mc("formGroup",t.form),m.Cb(1),m.mc("ngIf",!t.isVisible),m.Cb(2),m.mc("ngStyle",m.rc(14,Fe,t.isHide?"400px":"320px")),m.Cb(3),m.mc("matAutocomplete",e),m.Cb(3),m.mc("ngForOf",t.filteredTenants),m.Cb(1),m.mc("ngIf",1==(null==t.selectedOption?null:t.selectedOption.value)),m.Cb(1),m.mc("ngStyle",m.rc(16,Fe,t.isHide?"220px":"180px")),m.Cb(3),m.mc("matAutocomplete",i),m.Cb(3),m.mc("ngForOf",t.filteredUnits),m.Cb(1),m.mc("ngIf",2==(null==t.selectedOption?null:t.selectedOption.value)),m.Cb(1),m.mc("ngIf",!t.isVisible&&t.options&&t.options.length>2),m.Cb(1),m.mc("ngIf",!t.isHide),m.Cb(1),m.mc("ngIf",!t.isHide),m.Cb(2),m.mc("disabled",t.options&&t.options.length>0&&!t.selectedOption)}},directives:[h.f,l.z,l.r,l.k,a.o,S.d,S.e,I.d,a.p,ve.c,I.h,l.c,W.b,ye.c,l.q,l.i,ye.a,a.n,P.a,w.a,Ce.b,Ce.a,L.n,I.g,O.a,B.b,l.t,B.d,I.j,B.a],styles:[""]}),e})();function Le(e,t){1&e&&(m.Tb(0,"div",17),m.Ob(1,"mat-progress-spinner",18),m.Sb())}let Be=(()=>{class e{constructor(e,t,i,l,n,o,a,s,r,c,u,d){var m,h,p;this.billSettlementService=e,this.snackbar=t,this.billService=i,this.date=l,this.cookieService=n,this.currency=o,this.templatesService=a,this.templateService=s,this.decimalPipe=r,this.clientSelectionService=c,this.route=u,this.envService=d,this._gap=16,this.gap=this._gap+"px",this.col2=`1 1 calc(50% - ${this._gap/2}px)`,this.col3=`1 1 calc(33.3333% - ${this._gap/1.5}px)`,this.billPeriods=[{label:"Select",value:0}],this.paymentModes=[{label:"Select",value:0}],this.banks=[{label:"Select",value:0}],this.tenants=[],this.billSettlement={},this.finalBill={},this.billPayment={},this.manageParams={},this.selectedRows=[],this.advanceAmount=0,this.openingBalanceAmount=0,this.outStandingAmount=0,this.advanceAdjusted=0,this.isAdjustWithAdvance=!1,this.bankId=0,this.remarks="",this.paymentModeId=0,this.payments=[],this.refNumber="",this.paymentAmount=0,this.tenantId=0,this.showSpinner=!1,this.isPrintDisable=!0,this.searchByTenant={label:"Search By Tenant",value:1},this.searchByUnit={label:"Search By Unit",value:2},this.searchByAccountNumber={label:"Search By Account Number",value:3},this.options=[this.searchByTenant,this.searchByUnit,this.searchByAccountNumber],this.isData=!1,this.settlementDate="",this.dateFormat="",this.currencyFormat="",this.roundOffFormat="",this.filePath="",this.filePath=d.backendForFiles,this.dateFormat=null!==(m=Object(b.e)("DateFormat"))&&void 0!==m?m:d.dateFormat,this.currencyFormat=null!==(h=Object(b.e)("Currency"))&&void 0!==h?h:d.currencyFormat,this.roundOffFormat=null!==(p=Object(b.e)("RoundOff"))&&void 0!==p?p:d.roundOffFormat}ngOnInit(){this.clientSelectionService.setIsClientVisible(!0),this.clientId=parseInt(this.cookieService.get("globalClientId")),this.getBillPeriods();let e="";this.route.queryParams.subscribe(t=>{if(t.id&&t.unit&&t.settlement_date){e=t.id;const i=t.unit;this.settlementDate=t.settlement_date,this.manageParams={unitNumber:i,tenantId:t.id,billPeriodId:"0",settlementDate:t.settlement_date,billType:b.a.FinalBill,clientId:this.clientId},this.onGetBillSettlementDetails(this.manageParams)}}),this.onGetTenants(e)}onGetTenants(e){this.billSettlementService.getTenantsDetails(this.clientId).subscribe(t=>{this.tenants=t,this.tenants&&e&&(this.tenantId=parseInt(e))})}onGetPaymentModes(){this.paymentModes=[{label:"Select",value:0}],this.billSettlementService.getPaymentModes().subscribe(e=>{e.forEach(e=>{this.paymentModes.push({label:e.description,value:e.id})})})}onGetBanks(e){this.banks=[{label:"Select",value:0}],this.billSettlementService.getBanks(e).subscribe(e=>{e.forEach(e=>{this.banks.push({label:e.description,value:e.id})})})}getBillPeriods(){this.billPeriods=[{label:"Select",value:0,fromDate:Date.now.toString(),ToDate:Date.now.toString()}],this.billService.getBillPeriods(this.clientId).subscribe(e=>{e.forEach(e=>{this.billPeriods.push({label:e.periodDescription,value:e.id,fromDate:e.periodStart,toDate:e.periodEnd})})})}onGetBillSettlementDetails(e){this.showSpinner=!0,this.manageParams=e,this.isPrintDisable=!0,this.onGetPaymentModes(),this.onGetBanks(e),this.billSettlementService.getBillSettlementDetails(e).subscribe({next:e=>{this.showSpinner=!1,this.billSettlement=e,this.isData=!(!e.outstandingBills||!e.outstandingBills.length)},error:e=>{this.showSpinner=!1}})}onGetOutStandingBillDetails(e){this.isData=!1,this.manageParams=e,this.billSettlementService.getOutStandingBillDetails(e).subscribe(e=>{this.billSettlement=e,this.isData=!(!e.outstandingBills||!e.outstandingBills.length)})}onSaveUnbilledConsumption(e){const t=this.billSettlement.unbBilledConsumptions;t&&t.length&&t.forEach(e=>e.isApproved=!0),this.billSettlementService.saveUnBilledConsumptions(t).subscribe({next:e=>{e?(this.notificationMessage("Bill saved successfully","green-snackbar"),this.unbilledConsumptionComponent.unBilledConsumptions=[],this.onGetOutStandingBillDetails(this.manageParams)):this.notificationMessage("Bill save failed","red-snackbar")},error:e=>{this.notificationMessage("Bill save failed","red-snackbar")}})}onSaveBillPayment(e){const t=this.billSettlement.outstandingBills;t&&t.length&&(this.onGetValues(),this.updateBillPayments(),this.updatePaymentTransactions(),this.billSettlementService.saveBillPayments(this.billPayment).subscribe({next:e=>{e?(this.reset(),this.onGetPaymentDetail(e),this.notificationMessage("Bill payment saved successfully","green-snackbar")):this.notificationMessage("Bill payment save failed","red-snackbar")},error:e=>{this.notificationMessage("Bill payment save failed","red-snackbar")}}))}onGetPaymentDetail(e){this.payments=[],this.isPrintDisable=!0;const t=Number(this.cookieService.get("globalClientId"));this.dateFormat=Object(b.e)("DateFormat"),this.roundOffFormat=Object(b.e)("RoundOff"),this.currencyFormat=Object(b.e)("Currency"),this.billService.getPaymentDetail(e,t).subscribe(t=>{t.forEach(e=>{e.paymentDateLocal=this.date.transform(e.paymentDate.toString(),this.dateFormat.toString()),e.referenceDateLocal=this.date.transform(e.referenceDate.toString(),this.dateFormat.toString()),e.paymentAmountLocal=this.currency.transform(e.paymentAmount,this.currencyFormat.toString(),!0,this.roundOffFormat),e.advanceAmountLocal=this.currency.transform(e.advanceAmount,this.currencyFormat.toString(),!0,this.roundOffFormat),e.billMasters.forEach(e=>{e.billDateLocal=this.date.transform(e.billDate.toString(),this.dateFormat.toString()),e.billAmountLocal=this.currency.transform(e.billAmount,this.currencyFormat.toString(),!0,this.roundOffFormat),e.fromDateLocal=this.date.transform(e.fromDate.toString(),this.dateFormat.toString()),e.toDateLocal=this.date.transform(e.toDate.toString(),this.dateFormat.toString()),e.dueDateLocal=this.date.transform(e.dueDate.toString(),this.dateFormat.toString()),e.paidLocal=this.currency.transform(e.paid.toString(),this.currencyFormat.toString(),!0,this.roundOffFormat)})}),this.payments=t,this.isPrintDisable=!1,this.getClientAlertSettings(e)})}getClientAlertSettings(e){this.templatesService.getClientAlertSettings(this.clientId).subscribe({next:e=>{if(e){const t=e.filter(e=>e.notificationCategory&&e.notificationCategory.toLowerCase()==="Payments".toLowerCase()&&e.condition&&e.condition.toLowerCase()=="After Payment Made".toLowerCase()&&1==e.isEnableAutoSend);t&&(this.reset(),this.notificationMessage("Bill payment saved successfully","green-snackbar"),t.forEach(e=>{this.onSendReceipt(e.notificationType)}))}else this.reset(),this.notificationMessage("Bill payment saved successfully","green-snackbar"),this.notificationMessage("No notification found to send.","red-snackbar")},error:e=>{this.notificationMessage("Notifications send failed","red-snackbar")}})}onSendReceipt(e){this.billPayment?this.templateService.emailCustomTemplate({clientId:this.clientId,templateName:e,notificationType:e,payments:this.payments}).subscribe({next:e=>{e&&e.status?this.notificationMessage("Notifications send failed."+e.status,"red-snackbar"):e&&e.isSuccess?this.notificationMessage("Notifications send successfully.\nTotal Requests : "+(null==e?void 0:e.totalRequests)+"\nSuccessfull Requests : "+(null==e?void 0:e.successFullRequests)+"\nFailed Requests : "+(null==e?void 0:e.failedRequests),"green-snackbar"):this.notificationMessage("Notifications send failed.\nTotal Requests : "+(e?e.totalRequests:"0")+"\nSuccessfull Requests : "+(e?e.successFullRequests:"0")+"\nFailed Requests : "+(e?e.failedRequests:"0"),"red-snackbar")},error:e=>{this.notificationMessage("Notifications send failed.","red-snackbar")}}):this.notificationMessage("Notifications send failed.","red-snackbar")}updatePaymentTransactions(){let e=[],t=[];e=this.billSettlement.outstandingBills;let i=0,l=0;if(this.openingBalanceAmount>0){if(this.isAdjustWithAdvance&&this.advanceAmount){const e=Number(this.advanceAmount)-Number(this.openingBalanceAmount);e>=0?(l=this.openingBalanceAmount,i=0,this.advanceAmount=e):(l=this.advanceAmount,i=this.openingBalanceAmount-this.advanceAmount,this.advanceAmount=0)}else{const e=Number(this.paymentAmount)-Number(this.openingBalanceAmount);e>=0?(i=this.openingBalanceAmount,l=0,this.paymentAmount=e):(i=this.paymentAmount,l=0,this.paymentAmount=0)}const e={billId:0,paidAmount:Number(i),advanceAmount:Number(l)};t.push(e)}e&&e.length&&e.forEach(e=>{if(this.isAdjustWithAdvance&&this.advanceAmount){const t=Number(this.advanceAmount)-Number(e.toPay);t>=0?(l=e.toPay,i=0,this.advanceAmount=t):(l=this.advanceAmount,i=Number(e.toPay)-Number(this.advanceAmount),this.advanceAmount=0)}else{const t=Number(this.paymentAmount)-Number(e.toPay);t>=0?(i=e.toPay,l=0,this.paymentAmount=t):(i=this.paymentAmount,l=0,this.paymentAmount=0)}const n={billId:e.id,paidAmount:Number(i),advanceAmount:Number(l)};t.push(n)}),this.billPayment.paymentTransactions=t}onGetValues(){this.bankId=this.paymentDetailsComponent.bankId,this.remarks=this.paymentDetailsComponent.remarks,this.paymentModeId=this.paymentDetailsComponent.paymentModeId,this.paymentDate=new Date(this.paymentDetailsComponent.paymentDate),this.refNumber=this.paymentDetailsComponent.refNumber,this.paymentAmount=Number(this.billAmountDetailsComponent.toPay),this.isAdjustWithAdvance=this.billAmountDetailsComponent.isAdjustWithAdvance,this.advanceAmount=this.billAmountDetailsComponent.previousAdvanceAmount,this.openingBalanceAmount=this.billAmountDetailsComponent.billAmount,this.outStandingAmount=this.billAmountDetailsComponent.total,this.advanceAdjusted=this.billAmountDetailsComponent.advanceAdjusted}updateBillPayments(){var e;this.billPayment={paymentDate:this.date.transform(this.paymentDate,"yyyy-MM-dd"),paymentAmount:Number(this.paymentAmount),billType:2,modeofPayment:this.paymentModeId,paymentReference:this.refNumber,bankId:this.bankId,remarks:this.remarks,outStandingAmount:Number(this.outStandingAmount)-Number(this.advanceAdjusted),clientId:Number(this.cookieService.get("globalClientId")),ownerId:null===(e=this.outstandingBillsComponent.outStandingBills[0])||void 0===e?void 0:e.ownerId}}notificationMessage(e,t){this.snackbar.open(e,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[t]})}reset(){this.bankId=this.paymentDetailsComponent.bankId=0,this.remarks=this.paymentDetailsComponent.remarks="",this.paymentModeId=this.paymentDetailsComponent.paymentModeId=0,this.paymentDate=new Date(Date.now.toString()),this.refNumber=this.paymentDetailsComponent.refNumber="",this.billAmountDetailsComponent.billAmount=0,this.billAmountDetailsComponent.total=0,this.paymentAmount=0,this.billAmountDetailsComponent.toPay="0",this.billSettlement={unbBilledConsumptions:[],outstandingBills:[]},this.isData=!1}updateOutstandingBills(){this.billSettlement.outstandingBills&&(this.finalBill={ownerId:this.billSettlement.outstandingBills[0].ownerId,unitId:this.billSettlement.outstandingBills[0].unitId,bankId:this.bankId,billDate:new Date,paymentDate:this.paymentDate,paymentAmount:this.paymentAmount,remarks:this.remarks,modeofPayment:this.paymentModeId,paymentReference:this.refNumber,finalBillTransactions:[]}),this.billAmountDetailsComponent.accountHeads&&this.billAmountDetailsComponent.accountHeads.forEach(e=>{this.finalBill.finalBillTransactions.push({billHeadId:e.id,headDisplay:e.accountHeadName,headAmount:e.fixedAmount})})}onSelectedRows(e){this.selectedRows=[],this.selectedRows=e}downloadReport(e){let t=[],i=[],l="",n="";const o=Array.from(new Set(e.billMasters.map(e=>e.billNumber))),a=Array.from(new Set(e.billMasters.map(e=>e.unitNumber)));o&&o.length&&o.forEach(e=>{l+=e+","}),a&&a.length&&a.forEach(e=>{n+=e+","}),i.push({label:"Receipt Number:",value:e.paymentNumber},{label:"Receipt Date:",value:e.paymentDateLocal},{label:"Account Number:",value:e.accountNumber},{label:"Invoice Number:",value:0===l.trim().indexOf(",")?l.trim().slice(1).slice(0,-1):l.trim().slice(0,-1)},{label:"Unit Number:",value:0===n.trim().indexOf(",")?n.trim().slice(1).slice(0,-1):n.trim().slice(0,-1)},{label:"Mode of payment:",value:e.paymentMode});let s=0;e.billMasters.forEach(e=>{s+=e.paid});const r=s>e.outStandingAmount?0:e.outStandingAmount-s;t.push({label:"Total Outstanding Amount :",value:this.currency.transform(e.outStandingAmount,this.currencyFormat.toString(),!0,this.roundOffFormat)},{label:"Received Payments :",value:e.paymentAmountLocal},{label:"",value:""},{label:"Balance Outstanding :",value:this.currency.transform(r,this.currencyFormat.toString(),!0,this.roundOffFormat)}),this.getReport(e,t,i)}addImage(e,t){var i;try{if(t&&t.billMasters&&t.billMasters.length&&t.billMasters[0]&&t.billMasters[0].client&&t.billMasters[0].client.imageProperties&&t.billMasters[0].client.imageProperties.length){const n=t.billMasters[0].client.imageProperties.find(e=>"receipt"===e.imageType.trim().toLowerCase());if(n){var l=new Image;l.src=this.filePath+"/uploads/"+(null===(i=null==t?void 0:t.billMasters[0].client)||void 0===i?void 0:i.photo),l.onload=function(){e.addImage(l,n.imgX,n.imgY,n.imgW,n.imgH)}}else this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar")}else this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar")}catch(n){this.notificationMessage("Image not found.","red-snackbar")}return e}onPrintBillPayment(e){this.payments&&this.payments.length?this.receiptView(this.payments):this.notificationMessage("No data to print.","yellow-snackbar")}receiptView(e){this.billService.receiptView(e).subscribe({next:e=>{e?this.downloadFile(e):this.notificationMessage("No data to print","red-snackbar")},error:e=>{this.notificationMessage("No data to print","red-snackbar")}})}downloadFile(e){return Object(r.a)(this,void 0,void 0,(function*(){const t=yield G.PDFDocument.create();for(const o of e){const e=yield G.PDFDocument.load(o);(yield t.copyPages(e,e.getPageIndices())).forEach(e=>{t.addPage(e)})}const i=yield t.save(),l=new Blob([i],{type:"application/pdf"}),n=window.URL.createObjectURL(l);window.open(n)}))}getReport(e,t,i){var l,n,o,a,s,r,c,u,d,m,h,p,f,g,v,y,C,S,T,P,D,w,N,x,A,F,R,k,I,O,W,M,L,B,z,U,E,j,H,Y,V,_,G,X,$,q;let J=new fe.default({orientation:"portrait",unit:"pt",format:"letter"}),Q=Object(b.f)(null===(n=null===(l=null==e?void 0:e.billMasters[0])||void 0===l?void 0:l.client)||void 0===n?void 0:n.website).split(".")[1];J.rect(5,5,J.internal.pageSize.width-10,J.internal.pageSize.height-10,"S"),J.setFontSize(30),this.addImage(J,e),J.setTextColor(0,0,0),J.setFontSize(14),J.setFont("Cambria","bold"),J.text("PAYMENT RECEIPT",260,30),J.setFont("Cambria","normal"),J.setFontSize(14),J.text(Object(b.f)(null===(a=null===(o=null==e?void 0:e.billMasters[0])||void 0===o?void 0:o.client)||void 0===a?void 0:a.clientName).toUpperCase(),10,50),J.setFontSize(10),J.text("TRN: "+Object(b.f)(null===(r=null===(s=null==e?void 0:e.billMasters[0])||void 0===s?void 0:s.client)||void 0===r?void 0:r.trnNo),10,60),J.text("PO Box "+Object(b.f)(null===(d=null===(u=null===(c=null==e?void 0:e.billMasters[0])||void 0===c?void 0:c.client)||void 0===u?void 0:u.addresses[0])||void 0===d?void 0:d.zipPostalCode),10,70),J.text(Object(b.f)(null===(p=null===(h=null===(m=null==e?void 0:e.billMasters[0])||void 0===m?void 0:m.client)||void 0===h?void 0:h.addresses[0])||void 0===p?void 0:p.location,",")+Object(b.f)(null===(v=null===(g=null===(f=null==e?void 0:e.billMasters[0])||void 0===f?void 0:f.client)||void 0===g?void 0:g.addresses[0])||void 0===v?void 0:v.city,",")+Object(b.f)(null===(S=null===(C=null===(y=null==e?void 0:e.billMasters[0])||void 0===y?void 0:y.client)||void 0===C?void 0:C.addresses[0])||void 0===S?void 0:S.country,","),10,80),J.text("Phone: "+Object(b.f)(null===(P=null===(T=null==e?void 0:e.billMasters[0])||void 0===T?void 0:T.client)||void 0===P?void 0:P.phoneNo),10,90),J.text("Email: "+Object(b.f)(null===(w=null===(D=null==e?void 0:e.billMasters[0])||void 0===D?void 0:D.client)||void 0===w?void 0:w.email),10,100),J.text("Web: "+Object(b.f)(null===(x=null===(N=null==e?void 0:e.billMasters[0])||void 0===N?void 0:N.client)||void 0===x?void 0:x.website),10,110),J.setFillColor(241,241,244),J.setDrawColor(206,203,203),J.rect(10,120,250,90,"FD"),J.setTextColor(0,0,0),J.setFontSize(12),J.text(Object(b.f)(null==e?void 0:e.tenantName).toUpperCase(),20,135),J.text("CUSTOMER TRN: "+Object(b.f)(null==e?void 0:e.trn),20,155),J.text("unit #"+Object(b.f)(null===(A=null==e?void 0:e.billMasters[0])||void 0===A?void 0:A.unitNumber),20,170),J.setFontSize(10),J.text(Object(b.f)(null===(F=null==e?void 0:e.billMasters[0])||void 0===F?void 0:F.clientName),20,185),J.text(Object(b.f)(null===(k=null===(R=null==e?void 0:e.billMasters[0].client)||void 0===R?void 0:R.addresses[0])||void 0===k?void 0:k.city,",")+Object(b.f)(null===(W=null===(O=null===(I=null==e?void 0:e.billMasters[0])||void 0===I?void 0:I.client)||void 0===O?void 0:O.addresses[0])||void 0===W?void 0:W.country,","),20,200),J.setFontSize(9),J.autoTable("",i,{startX:210,startY:120,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:400},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:100,halign:"right"}},didParseCell:function(e){const t=e.column.index;0!=t&&1!=t||(e.cell.styles.rowHeight=1)},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});const K=Number(this.decimalPipe.transform(J.autoTable.previous.finalY,"1.0-0"));J.setLineWidth(.1),J.line(5,K+10,607,K+10),J.setTextColor(0,0,0),J.setFontSize(10),J.text("Thank you for using "+Q+" payment services.",20,K+30),J.text("We confirm receipt of your payment.",20,K+40),J.text("Please see the below details for your reference.",20,K+50),J.setTextColor(0,0,0),J.autoTable("",t,{startX:300,startY:K+60,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:110},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:180,halign:"left"},1:{cellWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"}}),J.setTextColor(0,0,0);const Z=Number(this.decimalPipe.transform(J.autoTable.previous.finalY,"1.0-0"));J.setTextColor(255,0,0),J.setFontSize(9),J.text(`Note: A Late Fee will be applied after the due date. A Default Payment \nPenalty will be added to any unit that is ${null===(M=null==e?void 0:e.billMasters[0])||void 0===M?void 0:M.penaltyAfter} days or more in arrears.`,320,Z+20),J.setTextColor(25,118,210),J.setFontSize(12),J.text("USAGE TIPS to reduce consumption:",10,Z+80),J.text("Please Try to:",10,Z+100),J.setTextColor(0,0,0),J.setFontSize(9),J.text("- Keep filters clean",30,Z+110),J.text("- Set thermostats between 23C and 25C",30,Z+120),J.text("- Keep vents unblocked",30,Z+130),J.text("- Keep doors and windows closed",30,Z+140),J.text("- Undertake regular maintenance of the system",30,Z+150),J.setTextColor(25,118,210),J.setFontSize(12),J.text("Please Do Not:",10,Z+170),J.setTextColor(0,0,0),J.setFontSize(9),J.text("- Set thermostats to 20C or lower",30,Z+180),J.text("- Block vents",30,Z+190),J.text("- Leave doors and windows open",30,Z+200),J.text("- Leave heat producing appliances near thermostats",30,Z+210),J.setFillColor(119,183,11);var ee=J.internal.pageSize.height||J.internal.pageSize.getHeight();J.rect(320,Z+60,280,ee-80-(Z+60),"FD"),J.setFont("Comic Sans"),J.setTextColor(255,255,255),J.setFontSize(16),J.text("ADVERTISE WITH US",360,Z+80);const te=J.getTextWidth("ADVERTISE WITH US");J.setLineWidth(.1),J.line(360,Z+85,360+te,Z+85),J.setFontSize(9),J.text("For advertisement, contact at",390,Z+95),J.text(Object(b.f)(null===(B=null===(L=null==e?void 0:e.billMasters[0])||void 0===L?void 0:L.client)||void 0===B?void 0:B.phoneNo),390,Z+105),J.text(Object(b.f)(null===(U=null===(z=null==e?void 0:e.billMasters[0])||void 0===z?void 0:z.client)||void 0===U?void 0:U.email),390,Z+115),J.text(Object(b.f)(null===(j=null===(E=null==e?void 0:e.billMasters[0])||void 0===E?void 0:E.client)||void 0===j?void 0:j.website),390,Z+125),J.setTextColor(0,0,0),J.setLineWidth(.1),J.line(5,ee-70,607,ee-70),J.text(null!==(X=null!==(V="For any enquiries, write to us "+(null===(Y=null===(H=null==e?void 0:e.billMasters[0])||void 0===H?void 0:H.client)||void 0===Y?void 0:Y.email))&&void 0!==V?V:"\n or Logon to "+(null===(G=null===(_=e.billMasters[0])||void 0===_?void 0:_.client)||void 0===G?void 0:G.website))&&void 0!==X?X:"",10,ee-60),J.setTextColor(255,0,0),J.setFont("bold");const ie=J.getTextWidth("Notice:");J.text("Notice:",340,ee-60),J.setFont("none"),J.setTextColor(0,0,0),J.text("Pay your bills before due date to avoid late payment surcharge",340+ie,ee-60),J.text("and disconnection.",340,ee-50),J.text("You can log onto "+(null===(q=null===($=null==e?void 0:e.billMasters[0])||void 0===$?void 0:$.client)||void 0===q?void 0:q.website)+" to pay your invoices \nTerms & Conditions for Supply of Utility Services",340,ee-40),"function"==typeof J.putTotalPages&&J.putTotalPages("1");var le=J.output("blob");window.open(URL.createObjectURL(le))}invoiceView(e){this.billService.invoicePreview(e).subscribe({next:e=>{e?this.downloadFile(e):this.notificationMessage("No data to print","red-snackbar")},error:e=>{this.notificationMessage("No data to print","red-snackbar")}})}}return e.\u0275fac=function(t){return new(t||e)(m.Nb(F.a),m.Nb(k.b),m.Nb(c.a),m.Nb(a.f),m.Nb(C.a),m.Nb(a.d),m.Nb(be.a),m.Nb(pe.a),m.Nb(a.g),m.Nb(_.a),m.Nb(s.a),m.Nb(p.a))},e.\u0275cmp=m.Hb({type:e,selectors:[["final-bill-settlement"]],viewQuery:function(e,t){var i;1&e&&(m.Jc(oe,!0),m.Jc(me,!0),m.Jc(A,!0),m.Jc(he,!0)),2&e&&(m.zc(i=m.cc())&&(t.paymentDetailsComponent=i.first),m.zc(i=m.cc())&&(t.billAmountDetailsComponent=i.first),m.zc(i=m.cc())&&(t.unbilledConsumptionComponent=i.first),m.zc(i=m.cc())&&(t.outstandingBillsComponent=i.first))},decls:39,vars:31,consts:[["mode","card",2,"margin-top","20px"],["class","loading-indicator",4,"ngIf"],["fxLayout","column"],["color","primary",1,"position-fixed"],["src","assets/img/fav-icon.png",1,"img-style"],[1,"toolbar-spacer"],[3,"isPrintDisable","isDisabled","printClicked","saveClicked"],["fxFlex","noshrink","fxLayout","column","fxLayout.gt-sm","row","fxLayoutAlign.gt-sm","start stretch",3,"fxLayoutGap"],["fxFlex","grow",1,"basic-forms","route-animations-elements",3,"fxFlex.gt-sm"],["fxLayout","column",1,"result","padding-top"],[3,"tenants","billPeriods","settlementDate","selectedTenant","options","isHide","isVisible","searchClicked"],[1,"header"],["fxLayout","column",1,"result"],[3,"dataSource","printDataRows","saveClicked"],[3,"dataSource","rowsSelected"],[3,"banks","paymentModes"],[3,"dataSource","selectedRows","isDisable"],[1,"loading-indicator"],["mode","indeterminate","color","accent"]],template:function(e,t){1&e&&(m.Tb(0,"fury-page-layout",0),m.Pc(1,Le,2,0,"div",1),m.Tb(2,"fury-page-layout-content",2),m.Tb(3,"mat-toolbar",3),m.Ob(4,"img",4),m.Tb(5,"span"),m.Rc(6,"Final Bill Settlement"),m.Sb(),m.Ob(7,"span",5),m.Tb(8,"app-final-bill-settlement-footer-toolbar",6),m.bc("printClicked",(function(e){return t.onPrintBillPayment(e)}))("saveClicked",(function(e){return t.onSaveBillPayment(e)})),m.Sb(),m.Sb(),m.Tb(9,"div",7),m.Tb(10,"fury-card",8),m.Tb(11,"fury-card-content",2),m.Tb(12,"div",9),m.Tb(13,"app-final-bill-settlement-toolbar",10),m.bc("searchClicked",(function(e){return t.onGetBillSettlementDetails(e)})),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Tb(14,"div",7),m.Tb(15,"fury-card",8),m.Tb(16,"fury-card-header",11),m.Tb(17,"fury-card-header-heading"),m.Rc(18,"Unbilled consumption"),m.Sb(),m.Sb(),m.Tb(19,"fury-card-content",2),m.Tb(20,"div",12),m.Tb(21,"app-unbilled-consumption",13),m.bc("printDataRows",(function(e){return t.invoiceView(e)}))("saveClicked",(function(e){return t.onSaveUnbilledConsumption(e)})),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Tb(22,"div",7),m.Tb(23,"fury-card",8),m.Tb(24,"fury-card-header",11),m.Tb(25,"fury-card-header-heading"),m.Rc(26,"Outstanding bills"),m.Sb(),m.Sb(),m.Tb(27,"fury-card-content",2),m.Tb(28,"div",12),m.Tb(29,"app-outstanding-bills",14),m.bc("rowsSelected",(function(e){return t.onSelectedRows(e)})),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Tb(30,"div",7),m.Tb(31,"fury-card",8),m.Tb(32,"fury-card-content",2),m.Tb(33,"div",12),m.Ob(34,"app-payment-details",15),m.Sb(),m.Sb(),m.Sb(),m.Tb(35,"fury-card",8),m.Tb(36,"fury-card-content",2),m.Tb(37,"div",12),m.Ob(38,"app-bill-amount-details",16),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb()),2&e&&(m.Cb(1),m.mc("ngIf",t.showSpinner),m.Cb(7),m.mc("isPrintDisable",t.isPrintDisable)("isDisabled",!t.isData),m.Cb(1),m.mc("fxLayoutGap",t.gap),m.Cb(1),m.mc("fxFlex.gt-sm",t.col2)("@fadeInUp",void 0),m.Cb(3),m.mc("tenants",t.tenants)("billPeriods",t.billPeriods)("settlementDate",t.settlementDate)("selectedTenant",t.tenantId)("options",t.options)("isHide",!1)("isVisible",!1),m.Cb(1),m.mc("fxLayoutGap",t.gap),m.Cb(1),m.mc("fxFlex.gt-sm",t.col2)("@fadeInUp",void 0),m.Cb(6),m.mc("dataSource",t.billSettlement),m.Cb(1),m.mc("fxLayoutGap",t.gap),m.Cb(1),m.mc("fxFlex.gt-sm",t.col2)("@fadeInUp",void 0),m.Cb(6),m.mc("dataSource",t.billSettlement),m.Cb(1),m.mc("fxLayoutGap",t.gap),m.Cb(1),m.mc("fxFlex.gt-sm",t.col2)("@fadeInUp",void 0),m.Cb(3),m.mc("banks",t.banks)("paymentModes",t.paymentModes),m.Cb(1),m.mc("fxFlex.gt-sm",t.col2)("@fadeInUp",void 0),m.Cb(3),m.mc("dataSource",t.billSettlement)("selectedRows",t.selectedRows)("isDisable",!0))},directives:[X.a,a.o,$.a,S.d,q.a,ge,S.b,S.c,S.e,f.a,f.c,Me,f.d,f.g,A,he,oe,me,Q.a],styles:['.toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.header[_ngcontent-%COMP%]{color:#1976d2}.img-style[_ngcontent-%COMP%]{width:32px}.position-fixed[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;top:0;z-index:5}.loading-indicator[_ngcontent-%COMP%]{position:fixed;z-index:999;height:2em;width:2em;overflow:show;margin:auto;top:0;left:0;bottom:0;right:0}.loading-indicator[_ngcontent-%COMP%]:before{content:"";display:block;position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.3)}'],data:{animation:[d.a,u.a]}}),e})();i("DaQG");let ze=(()=>{class e{constructor(e,t,i,l,n,o,a,s,r,c,u){this.billSettlementService=e,this.billService=t,this.snackbar=i,this.decimalPipe=l,this.date=n,this.currency=o,this.cookieService=a,this.templateService=s,this.clientSelectionService=r,this.templatesService=c,this.envService=u,this._gap=12,this.gap=this._gap+"px",this.col2=`1 1 calc(76% - ${this._gap/2}px)`,this.col3=`1 1 calc(24% - ${this._gap/1}px)`,this.billPeriods=[{label:"Select",value:0}],this.billSettlement={outstandingBills:[]},this.paymentModes=[{label:"Select",value:0}],this.banks=[{label:"Select",value:0}],this.tenants=[],this.manageParams={},this.billPayment={},this.selectedRows=[],this.paymentId=0,this.bankId=0,this.remarks="",this.paymentModeId=0,this.paymentDate=new Date,this.refNumber="",this.paymentAmount=0,this.excessAmount=0,this.advanceAmount=0,this.openingBalanceAmount=0,this.outStandingAmount=0,this.advanceAdjusted=0,this.isAdjustWithAdvance=!1,this.payments=[],this.dateFormat=Object(b.e)("DateFormat"),this.currencyFormat=Object(b.e)("Currency"),this.roundOffFormat=Object(b.e)("RoundOff"),this.filePath="",this.labelName="",this.isData=!1,this.isValid=!1,this.isValidPayment=!1,this.isPrintDisable=!0,this.isAutoSelect=!1,this.disableCheckBox=!0,this.searchByTenant={label:"Search By Tenant",value:1},this.searchByUnit={label:"Search By Unit",value:2},this.searchByAccountNumber={label:"Search By Account Number",value:3},this.options=[this.searchByTenant,this.searchByUnit,this.searchByAccountNumber],this.filePath=u.backendForFiles}ngOnInit(){this.clientSelectionService.setIsClientVisible(!0),this.clientId=parseInt(this.cookieService.get("globalClientId")),this.onGetTenants()}onGetTenants(){this.billSettlementService.getTenantsDetails(this.clientId).subscribe(e=>{this.tenants=e})}onGetPaymentModes(){this.paymentModes=[{label:"Select",value:0}],this.billSettlementService.getPaymentModes().subscribe(e=>{e.forEach(e=>{this.paymentModes.push({label:e.description,value:e.id})})})}getBillPeriods(){this.billPeriods=[{label:"Select",value:0,fromDate:Date.now.toString(),ToDate:Date.now.toString()}],this.billService.getBillPeriods(this.clientId).subscribe(e=>{e.forEach(e=>{this.billPeriods.push({label:e.periodDescription,value:e.id,fromDate:e.periodStart,toDate:e.periodEnd})})})}onGetBanks(e){this.banks=[{label:"Select",value:0}],this.billSettlementService.getBanks(e).subscribe(e=>{e.forEach(e=>{this.banks.push({label:e.description,value:e.id})})})}onGetBillDetails(e){this.isAutoSelect=!1,this.disableCheckBox=!1,this.manageParams=e,this.manageParams.billType=1,this.onGetPaymentModes(),this.onGetBanks(e),this.billSettlement={},this.isPrintDisable=!0,e.clientId=this.clientId,this.billSettlementService.getOutStandingBillDetails(e).subscribe(e=>{this.billSettlement=e,this.isAutoSelect=!0,this.disableCheckBox=!0})}onSaveBillPayment(e){this.onGetValues(),this.updateBillPayments(),this.updatePaymentTransactions(),this.billSettlementService.saveBillPayments(this.billPayment).subscribe({next:e=>{e?"Excess Amount"===this.labelName&&this.excessAmount>0&&0!==e?this.saveAdvancePaymentDetails(e):this.onGetPaymentDetail(e):this.notificationMessage("Bill payment save failed","red-snackbar")},error:e=>{this.notificationMessage("Bill payment save failed","red-snackbar")}})}getClientAlertSettings(e){this.templatesService.getClientAlertSettings(this.clientId).subscribe({next:e=>{if(e){const t=e.filter(e=>e.notificationCategory&&e.notificationCategory.toLowerCase()==="Payments".toLowerCase()&&e.condition&&e.condition.toLowerCase()=="After Payment Made".toLowerCase()&&1==e.isEnableAutoSend);t&&(this.reset(),this.notificationMessage("Bill payment saved successfully","green-snackbar"),t.forEach(e=>{this.onSendReceipt(e.notificationType)}))}else this.reset(),this.notificationMessage("Bill payment saved successfully","green-snackbar"),this.notificationMessage("No notification found to send.","red-snackbar")},error:e=>{this.notificationMessage("Notifications send failed","red-snackbar")}})}onSendReceipt(e){this.billPayment?this.templateService.emailCustomTemplate({clientId:this.clientId,templateName:e,notificationType:e,payments:this.payments}).subscribe({next:e=>{e&&e.status?this.notificationMessage("Notifications send failed."+e.status,"red-snackbar"):e&&e.isSuccess?this.notificationMessage("Notifications send successfully.\nTotal Requests : "+(null==e?void 0:e.totalRequests)+"\nSuccessfull Requests : "+(null==e?void 0:e.successFullRequests)+"\nFailed Requests : "+(null==e?void 0:e.failedRequests),"green-snackbar"):this.notificationMessage("Notifications send failed.\nTotal Requests : "+(e?e.totalRequests:"0")+"\nSuccessfull Requests : "+(e?e.successFullRequests:"0")+"\nFailed Requests : "+(e?e.failedRequests:"0"),"red-snackbar")},error:e=>{this.notificationMessage("Notifications send failed.","red-snackbar")}}):this.notificationMessage("Notifications send failed.","red-snackbar")}updatePaymentTransactions(){let e=[],t=[];if(e=this.outstandingBillsComponent.selectedRows,this.openingBalanceAmount>0){let e=0,i=0;if(this.advanceAdjusted>0&&0==this.paymentAmount){const t=Number(this.advanceAdjusted)-Number(this.openingBalanceAmount);t>=0?(i=this.openingBalanceAmount,e=0,this.advanceAdjusted=t):(i=this.advanceAdjusted,e=0,this.advanceAmount=0)}else if(this.advanceAdjusted>0&&this.paymentAmount>0){const t=Number(this.advanceAdjusted)-Number(this.openingBalanceAmount);t>=0?(i=this.openingBalanceAmount,e=0,this.advanceAdjusted=t):Number(this.advanceAdjusted)+Number(this.paymentAmount)-Number(this.openingBalanceAmount)>=0?(i=this.advanceAdjusted,e=Number(this.openingBalanceAmount)-Number(this.advanceAdjusted),this.advanceAdjusted=0,this.paymentAmount=Number(this.paymentAmount)-Number(e)):(i=this.advanceAdjusted,e=this.paymentAmount,this.advanceAmount=0,this.paymentAmount=0)}else if(0==this.advanceAdjusted&&this.paymentAmount>0){const t=Number(this.paymentAmount)-Number(this.openingBalanceAmount);t>=0?(e=this.openingBalanceAmount,i=0,this.paymentAmount=t):(e=this.paymentAmount,i=0,this.paymentAmount=0)}if(e>0||i>0){const l={billId:0,paidAmount:Number(e),advanceAmount:Number(i)};t.push(l),e=0,i=0}}if(e&&e.length>0){let i=0,l=0;e.forEach(e=>{if(this.advanceAdjusted>0&&0==this.paymentAmount){const t=Number(this.advanceAdjusted)-Number(e.toPay);t>=0?(l=e.toPay,i=0,this.advanceAdjusted=t):(l=this.advanceAdjusted,i=0,this.advanceAmount=0)}else if(this.advanceAdjusted>0&&this.paymentAmount>0){const t=Number(this.advanceAdjusted)-Number(e.toPay);t>=0?(l=e.toPay,i=0,this.advanceAdjusted=t):Number(this.advanceAdjusted)+Number(this.paymentAmount)-Number(e.toPay)>=0?(l=this.advanceAdjusted,i=Number(e.toPay)-Number(this.advanceAdjusted),this.advanceAdjusted=0,this.paymentAmount=Number(this.paymentAmount)-Number(i)):(l=this.advanceAdjusted,i=this.paymentAmount,this.advanceAmount=0,this.paymentAmount=0)}else if(0==this.advanceAdjusted&&this.paymentAmount>0){const t=Number(this.paymentAmount)-Number(e.toPay);t>=0?(i=e.toPay,l=0,this.paymentAmount=t):(i=this.paymentAmount,l=0,this.paymentAmount=0)}if(i>0||l>0){const n={billId:e.id,paidAmount:Number(i),advanceAmount:Number(l)};t.push(n),i=0,l=0}})}if("Excess Amount"===this.labelName&&this.excessAmount>0){const e={billId:0,paidAmount:Number(this.excessAmount),advanceAmount:0,isAdvanceAmount:!0};t.push(e)}this.billPayment.paymentTransactions=t}onGetValues(){this.bankId=this.paymentDetailsComponent.bankId,this.remarks=this.paymentDetailsComponent.remarks,this.paymentModeId=this.paymentDetailsComponent.paymentModeId,this.paymentDate=new Date(this.paymentDetailsComponent.paymentDate),this.refNumber=this.paymentDetailsComponent.refNumber,this.paymentAmount=Number(this.billAmountDetailsComponent.toPay),this.excessAmount=Number(0==this.billAmountDetailsComponent.excessAmount?0:this.billAmountDetailsComponent.excessAmount),this.labelName=this.billAmountDetailsComponent.labelName,this.isAdjustWithAdvance=this.billAmountDetailsComponent.isAdjustWithAdvance,this.advanceAmount=this.billAmountDetailsComponent.previousAdvanceAmount,this.openingBalanceAmount=this.billAmountDetailsComponent.billAmount,this.outStandingAmount=this.billAmountDetailsComponent.total,this.advanceAdjusted=this.billAmountDetailsComponent.advanceAdjusted}updateBillPayments(){let e=0;e=this.outstandingBillsComponent&&this.outstandingBillsComponent.selectedRows&&this.outstandingBillsComponent.selectedRows.length?this.outstandingBillsComponent.selectedRows[0].ownerId:Number(this.manageParams.tenantId),this.billPayment={paymentDate:this.date.transform(this.paymentDate,"yyyy-MM-dd"),paymentAmount:Number(this.paymentAmount),clientId:Number(this.cookieService.get("globalClientId")),billType:1,ownerId:e,modeofPayment:this.paymentModeId,paymentReference:this.refNumber,bankId:this.bankId,remarks:this.remarks,outStandingAmount:Number(this.outStandingAmount)-Number(this.advanceAdjusted)}}notificationMessage(e,t){this.snackbar.open(e,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[t]})}onSelectedRows(e){this.isData=!1,this.selectedRows=[],this.selectedRows=e,this.selectedRows&&this.selectedRows.length&&(this.isData=!0)}saveAdvancePaymentDetails(e){let t=0;t=this.outstandingBillsComponent&&this.outstandingBillsComponent.selectedRows&&this.outstandingBillsComponent.selectedRows.length?this.outstandingBillsComponent.selectedRows[0].ownerId:Number(this.manageParams.tenantId);const i={advanceDate:this.paymentDate,paymentId:e,ownerId:t,advanceAmount:Number(this.excessAmount)};this.billService.saveAdvancePayment(i).subscribe({next:t=>{t?this.onGetPaymentDetail(e):this.notificationMessage("Bill payment save failed","red-snackbar")},error:e=>{this.notificationMessage("Bill payment save failed","red-snackbar")}})}reset(){this.bankId=this.paymentDetailsComponent.bankId=0,this.remarks=this.paymentDetailsComponent.remarks="",this.paymentModeId=this.paymentDetailsComponent.paymentModeId=0,this.paymentDate=new Date(Date.now.toString()),this.refNumber=this.paymentDetailsComponent.refNumber="",this.billAmountDetailsComponent.billAmount=0,this.billAmountDetailsComponent.total=0,this.paymentAmount=0,this.billAmountDetailsComponent.toPay="0",this.excessAmount=this.billAmountDetailsComponent.excessAmount=0,this.advanceAdjusted=this.billAmountDetailsComponent.advanceAdjusted=0,this.billSettlement={outstandingBills:[]},this.outstandingBillsComponent.selectedRows=[],this.isData=!1,this.isValid=!1}onPrintBillPayment(e){this.payments&&this.payments.length?this.receiptView(this.payments):this.notificationMessage("No data to print","yellow-snackbar")}receiptView(e){this.billService.receiptView(e).subscribe({next:e=>{e?this.downloadPdfFile(e):this.notificationMessage("No data to print","red-snackbar")},error:e=>{this.notificationMessage("No data to print","red-snackbar")}})}downloadPdfFile(e){e&&e.forEach(t=>{var i=this.base64ToArrayBuffer(e),l=new Blob([i],{type:"application/pdf"}),n=window.URL.createObjectURL(l);window.open(n)})}base64ToArrayBuffer(e){for(var t=window.atob(e),i=t.length,l=new Uint8Array(i),n=0;n<i;n++)l[n]=t.charCodeAt(n);return l.buffer}onGetPaymentDetail(e){this.payments=[],this.isPrintDisable=!0;const t=Number(this.cookieService.get("globalClientId"));this.billService.getPaymentDetail(e,t).subscribe({next:t=>{t.forEach(e=>{e.paymentDateLocal=this.date.transform(e.paymentDate.toString(),this.dateFormat.toString()),e.referenceDateLocal=this.date.transform(e.referenceDate.toString(),this.dateFormat.toString()),e.paymentAmountLocal=this.currency.transform(e.paymentAmount,this.currencyFormat.toString(),!0,this.roundOffFormat),e.advanceAmountLocal=this.currency.transform(e.advanceAmount,this.currencyFormat.toString(),!0,this.roundOffFormat),e.billMasters&&e.billMasters.length&&e.billMasters.forEach(e=>{var t,i,l,n,o;e.billDateLocal=this.date.transform(null===(t=null==e?void 0:e.billDate)||void 0===t?void 0:t.toString(),this.dateFormat.toString()),e.billAmountLocal=this.currency.transform(null==e?void 0:e.billAmount,this.currencyFormat.toString(),!0,this.roundOffFormat),e.fromDateLocal=this.date.transform(null===(i=null==e?void 0:e.fromDate)||void 0===i?void 0:i.toString(),this.dateFormat.toString()),e.toDateLocal=this.date.transform(null===(l=null==e?void 0:e.toDate)||void 0===l?void 0:l.toString(),this.dateFormat.toString()),e.dueDateLocal=this.date.transform(null===(n=null==e?void 0:e.dueDate)||void 0===n?void 0:n.toString(),this.dateFormat.toString()),e.paidLocal=this.currency.transform(null===(o=null==e?void 0:e.paid)||void 0===o?void 0:o.toString(),this.currencyFormat.toString(),!0,this.roundOffFormat)})}),this.payments=t,this.isPrintDisable=!1,this.getClientAlertSettings(e)},error:()=>{this.isPrintDisable=!0}})}downloadReport(e){let t=[],i=[],l="",n="";const o=Array.from(new Set(e.billMasters.map(e=>e.billNumber))),a=Array.from(new Set(e.billMasters.map(e=>e.unitNumber)));o&&o.length&&o.forEach(e=>{l+=e+","}),a&&a.length&&a.forEach(e=>{n+=e+","}),i.push({label:"Receipt Number:",value:e.paymentNumber},{label:"Receipt Date:",value:e.paymentDateLocal},{label:"Account Number:",value:e.accountNumber},{label:"Invoice Number:",value:0===l.trim().indexOf(",")?l.trim().slice(1).slice(0,-1):l.trim().slice(0,-1)},{label:"Unit Number:",value:0===n.trim().indexOf(",")?n.trim().slice(1).slice(0,-1):n.trim().slice(0,-1)},{label:"Mode of payment:",value:e.paymentMode});let s=0;e.billMasters.forEach(e=>{s+=e.paid});const r=e.outStandingAmount-s;t.push({label:"Total Outstanding Amount :",value:this.currency.transform(e.outStandingAmount,this.currencyFormat.toString(),!0,this.roundOffFormat)},{label:"Received Payments :",value:e.paymentAmountLocal},{label:"",value:""},{label:"Balance Outstanding :",value:this.currency.transform(r,this.currencyFormat.toString(),!0,this.roundOffFormat)}),this.getReport(e,t,i)}addImage(e,t){var i;try{if(t&&t.billMasters&&t.billMasters.length&&t.billMasters[0]&&t.billMasters[0].client&&t.billMasters[0].client.imageProperties&&t.billMasters[0].client.imageProperties.length){const n=t.billMasters[0].client.imageProperties.find(e=>"receipt"===e.imageType.trim().toLowerCase());if(n){var l=new Image;l.src=this.filePath+"/uploads/"+(null===(i=null==t?void 0:t.billMasters[0].client)||void 0===i?void 0:i.photo),l.onload=function(){e.addImage(l,n.imgX,n.imgY,n.imgW,n.imgH)}}else this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar")}else this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar")}catch(n){this.notificationMessage("Image not found.","red-snackbar")}return e}getReport(e,t,i){var l,n,o,a,s,r,c,u,d,m,h,p,f,g,v,y,C,S,T,P,D,w,N,x,A,F,R,k,I,O,W,M,L,B,z,U,E,j,H,Y,V,_,G,X,$,q;let J=new fe.default({orientation:"portrait",unit:"pt",format:"letter"}),Q=Object(b.f)(null===(n=null===(l=null==e?void 0:e.billMasters[0])||void 0===l?void 0:l.client)||void 0===n?void 0:n.website).split(".")[1];J.rect(5,5,J.internal.pageSize.width-10,J.internal.pageSize.height-10,"S"),J.setFontSize(30),this.addImage(J,e),J.setTextColor(0,0,0),J.setFontSize(14),J.setFont("Cambria","bold"),J.text("PAYMENT RECEIPT",260,30),J.setFont("Cambria","normal"),J.setFontSize(14),J.text(Object(b.f)(null===(a=null===(o=null==e?void 0:e.billMasters[0])||void 0===o?void 0:o.client)||void 0===a?void 0:a.clientName).toUpperCase(),10,50),J.setFontSize(10),J.text("TRN: "+Object(b.f)(null===(r=null===(s=null==e?void 0:e.billMasters[0])||void 0===s?void 0:s.client)||void 0===r?void 0:r.trnNo),10,60),J.text("PO Box "+Object(b.f)(null===(d=null===(u=null===(c=null==e?void 0:e.billMasters[0])||void 0===c?void 0:c.client)||void 0===u?void 0:u.addresses[0])||void 0===d?void 0:d.zipPostalCode),10,70),J.text(Object(b.f)(null===(p=null===(h=null===(m=null==e?void 0:e.billMasters[0])||void 0===m?void 0:m.client)||void 0===h?void 0:h.addresses[0])||void 0===p?void 0:p.location,",")+Object(b.f)(null===(v=null===(g=null===(f=null==e?void 0:e.billMasters[0])||void 0===f?void 0:f.client)||void 0===g?void 0:g.addresses[0])||void 0===v?void 0:v.city,",")+Object(b.f)(null===(S=null===(C=null===(y=null==e?void 0:e.billMasters[0])||void 0===y?void 0:y.client)||void 0===C?void 0:C.addresses[0])||void 0===S?void 0:S.country,","),10,80),J.text("Phone: "+Object(b.f)(null===(P=null===(T=null==e?void 0:e.billMasters[0])||void 0===T?void 0:T.client)||void 0===P?void 0:P.phoneNo),10,90),J.text("Email: "+Object(b.f)(null===(w=null===(D=null==e?void 0:e.billMasters[0])||void 0===D?void 0:D.client)||void 0===w?void 0:w.email),10,100),J.text("Web: "+Object(b.f)(null===(x=null===(N=null==e?void 0:e.billMasters[0])||void 0===N?void 0:N.client)||void 0===x?void 0:x.website),10,110),J.setFillColor(241,241,244),J.setDrawColor(206,203,203),J.rect(10,120,250,90,"FD"),J.setTextColor(0,0,0),J.setFontSize(12),J.text(Object(b.f)(null==e?void 0:e.tenantName).toUpperCase(),20,135),J.text("CUSTOMER TRN: "+Object(b.f)(null==e?void 0:e.trn),20,155),J.text("unit #"+Object(b.f)(null===(A=null==e?void 0:e.billMasters[0])||void 0===A?void 0:A.unitNumber),20,170),J.setFontSize(10),J.text(Object(b.f)(null===(F=null==e?void 0:e.billMasters[0])||void 0===F?void 0:F.clientName),20,185),J.text(Object(b.f)(null===(k=null===(R=null==e?void 0:e.billMasters[0].client)||void 0===R?void 0:R.addresses[0])||void 0===k?void 0:k.city,",")+Object(b.f)(null===(W=null===(O=null===(I=null==e?void 0:e.billMasters[0])||void 0===I?void 0:I.client)||void 0===O?void 0:O.addresses[0])||void 0===W?void 0:W.country,","),20,200),J.setFontSize(9),J.autoTable("",i,{startX:210,startY:120,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:400},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:100,halign:"right"}},didParseCell:function(e){const t=e.column.index;0!=t&&1!=t||(e.cell.styles.rowHeight=1)},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});const K=Number(this.decimalPipe.transform(J.autoTable.previous.finalY,"1.0-0"));J.setLineWidth(.1),J.line(5,K+10,607,K+10),J.setTextColor(0,0,0),J.setFontSize(10),J.text("Thank you for using "+Q+" payment services.",20,K+30),J.text("We confirm receipt of your payment.",20,K+40),J.text("Please see the below details for your reference.",20,K+50),J.setTextColor(0,0,0),J.autoTable("",t,{startX:300,startY:K+60,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:110},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:180,halign:"left"},1:{cellWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"}}),J.setTextColor(0,0,0);const Z=Number(this.decimalPipe.transform(J.autoTable.previous.finalY,"1.0-0"));J.setTextColor(255,0,0),J.setFontSize(9),J.text(`Note: A Late Fee will be applied after the due date. A Default Payment \nPenalty will be added to any unit that is ${null===(M=null==e?void 0:e.billMasters[0])||void 0===M?void 0:M.penaltyAfter} days or more in arrears.`,320,Z+20),J.setTextColor(25,118,210),J.setFontSize(12),J.text("USAGE TIPS to reduce consumption:",10,Z+80),J.text("Please Try to:",10,Z+100),J.setTextColor(0,0,0),J.setFontSize(9),J.text("- Keep filters clean",30,Z+110),J.text("- Set thermostats between 23C and 25C",30,Z+120),J.text("- Keep vents unblocked",30,Z+130),J.text("- Keep doors and windows closed",30,Z+140),J.text("- Undertake regular maintenance of the system",30,Z+150),J.setTextColor(25,118,210),J.setFontSize(12),J.text("Please Do Not:",10,Z+170),J.setTextColor(0,0,0),J.setFontSize(9),J.text("- Set thermostats to 20C or lower",30,Z+180),J.text("- Block vents",30,Z+190),J.text("- Leave doors and windows open",30,Z+200),J.text("- Leave heat producing appliances near thermostats",30,Z+210),J.setFillColor(119,183,11);var ee=J.internal.pageSize.height||J.internal.pageSize.getHeight();J.rect(320,Z+60,280,ee-80-(Z+60),"FD"),J.setFont("Comic Sans"),J.setTextColor(255,255,255),J.setFontSize(16),J.text("ADVERTISE WITH US",360,Z+80);const te=J.getTextWidth("ADVERTISE WITH US");J.setLineWidth(.1),J.line(360,Z+85,360+te,Z+85),J.setFontSize(9),J.text("For advertisement, contact at",390,Z+95),J.text(Object(b.f)(null===(B=null===(L=null==e?void 0:e.billMasters[0])||void 0===L?void 0:L.client)||void 0===B?void 0:B.phoneNo),390,Z+105),J.text(Object(b.f)(null===(U=null===(z=null==e?void 0:e.billMasters[0])||void 0===z?void 0:z.client)||void 0===U?void 0:U.email),390,Z+115),J.text(Object(b.f)(null===(j=null===(E=null==e?void 0:e.billMasters[0])||void 0===E?void 0:E.client)||void 0===j?void 0:j.website),390,Z+125),J.setTextColor(0,0,0),J.setLineWidth(.1),J.line(5,ee-70,607,ee-70),J.text(null!==(X=null!==(V="For any enquiries, write to us "+(null===(Y=null===(H=null==e?void 0:e.billMasters[0])||void 0===H?void 0:H.client)||void 0===Y?void 0:Y.email))&&void 0!==V?V:"\n or Logon to "+(null===(G=null===(_=e.billMasters[0])||void 0===_?void 0:_.client)||void 0===G?void 0:G.website))&&void 0!==X?X:"",10,ee-60),J.setTextColor(255,0,0),J.setFont("bold");const ie=J.getTextWidth("Notice:");J.text("Notice:",340,ee-60),J.setFont("none"),J.setTextColor(0,0,0),J.text("Pay your bills before due date to avoid late payment surcharge",340+ie,ee-60),J.text("and disconnection.",340,ee-50),J.text("You can log onto "+(null===(q=null===($=null==e?void 0:e.billMasters[0])||void 0===$?void 0:$.client)||void 0===q?void 0:q.website)+" to pay your invoices \nTerms & Conditions for Supply of Utility Services",340,ee-40),"function"==typeof J.putTotalPages&&J.putTotalPages("1");var le=J.output("blob");window.open(URL.createObjectURL(le))}onValidation(e){this.isValid=e}onValidatePayment(e){this.isValidPayment=e}}return e.\u0275fac=function(t){return new(t||e)(m.Nb(F.a),m.Nb(c.a),m.Nb(k.b),m.Nb(a.g),m.Nb(a.f),m.Nb(a.d),m.Nb(C.a),m.Nb(pe.a),m.Nb(_.a),m.Nb(be.a),m.Nb(p.a))},e.\u0275cmp=m.Hb({type:e,selectors:[["app-create-bill-payment"]],viewQuery:function(e,t){var i;1&e&&(m.Jc(oe,!0),m.Jc(he,!0),m.Jc(me,!0)),2&e&&(m.zc(i=m.cc())&&(t.paymentDetailsComponent=i.first),m.zc(i=m.cc())&&(t.outstandingBillsComponent=i.first),m.zc(i=m.cc())&&(t.billAmountDetailsComponent=i.first))},decls:35,vars:25,consts:[["mode","card",2,"margin-top","20px"],["fxLayout","column"],["color","primary",1,"position-fixed"],["src","assets/img/fav-icon.png",1,"img-style"],[1,"toolbar-spacer"],[3,"isDisabled","isPrintDisable","saveClicked","printClicked"],["fxFlex","noshrink","fxLayout","column","fxLayout.gt-sm","row","fxLayoutAlign.gt-sm","start stretch",3,"fxLayoutGap"],["fxFlex","grow",1,"basic-forms","route-animations-elements",3,"fxFlex.gt-sm"],["fxLayout","column",1,"result","padding-top"],[3,"tenants","options","isHide","isVisible","saveClicked","searchClicked"],["fxFlex","noshrink","fxLayout","column","fxLayout.gt-sm","row","fxLayoutAlign.gt-sm","start stretch",1,"padding-top",3,"fxLayoutGap"],["fxLayout","column",1,"result"],[3,"isAutoSelect","dataSource","disableCheckBox","isHide","rowsSelected"],[3,"banks","paymentModes","isShowValidation","validate"],[3,"dataSource","selectedRows","isHide","isValidPayment"]],template:function(e,t){1&e&&(m.Tb(0,"fury-page-layout",0),m.Tb(1,"fury-page-layout-content",1),m.Tb(2,"mat-toolbar",2),m.Ob(3,"img",3),m.Tb(4,"span"),m.Rc(5,"Bill Payment"),m.Sb(),m.Ob(6,"span",4),m.Tb(7,"app-final-bill-settlement-footer-toolbar",5),m.bc("saveClicked",(function(e){return t.onSaveBillPayment(e)}))("printClicked",(function(e){return t.onPrintBillPayment(e)})),m.Sb(),m.Sb(),m.Tb(8,"div",6),m.Tb(9,"fury-card",7),m.Tb(10,"fury-card-content",1),m.Tb(11,"div",8),m.Tb(12,"app-final-bill-settlement-toolbar",9),m.bc("saveClicked",(function(e){return t.onSaveBillPayment(e)}))("searchClicked",(function(e){return t.onGetBillDetails(e)})),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Tb(13,"div",10),m.Tb(14,"fury-card",7),m.Tb(15,"fury-card-header"),m.Tb(16,"fury-card-header-heading"),m.Rc(17,"Outstanding Bills"),m.Sb(),m.Sb(),m.Tb(18,"fury-card-content",1),m.Tb(19,"div",11),m.Tb(20,"app-outstanding-bills",12),m.bc("rowsSelected",(function(e){return t.onSelectedRows(e)})),m.Sb(),m.Sb(),m.Sb(),m.Tb(21,"fury-card-header"),m.Tb(22,"fury-card-header-heading"),m.Rc(23,"Payment Details"),m.Sb(),m.Sb(),m.Tb(24,"fury-card-content",1),m.Tb(25,"div",11),m.Tb(26,"app-payment-details",13),m.bc("validate",(function(e){return t.onValidation(e)})),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Tb(27,"fury-card",7),m.Tb(28,"fury-card-header"),m.Tb(29,"fury-card-header-heading"),m.Rc(30,"Bill Amount Details"),m.Sb(),m.Sb(),m.Tb(31,"fury-card-content",1),m.Tb(32,"div",11),m.Tb(33,"app-bill-amount-details",14),m.bc("isValidPayment",(function(e){return t.onValidatePayment(e)})),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Ob(34,"div",10),m.Sb(),m.Sb()),2&e&&(m.Cb(7),m.mc("isDisabled",!(t.isValid&&t.isData&&t.isValidPayment||t.isValid&&t.isValidPayment))("isPrintDisable",t.isPrintDisable),m.Cb(1),m.mc("fxLayoutGap",t.gap),m.Cb(1),m.mc("fxFlex.gt-sm",t.col2)("@fadeInUp",void 0),m.Cb(3),m.mc("tenants",t.tenants)("options",t.options)("isHide",!0)("isVisible",!1),m.Cb(1),m.mc("fxLayoutGap",t.gap),m.Cb(1),m.mc("fxFlex.gt-sm",t.col2)("@fadeInUp",void 0),m.Cb(6),m.mc("isAutoSelect",t.isAutoSelect)("dataSource",t.billSettlement)("disableCheckBox",t.disableCheckBox)("isHide",!1),m.Cb(6),m.mc("banks",t.banks)("paymentModes",t.paymentModes)("isShowValidation",t.isData),m.Cb(1),m.mc("fxFlex.gt-sm",t.col3)("@fadeInUp",void 0),m.Cb(6),m.mc("dataSource",t.billSettlement)("selectedRows",t.selectedRows)("isHide",!0),m.Cb(1),m.mc("fxLayoutGap",t.gap))},directives:[X.a,$.a,S.d,q.a,ge,S.b,S.c,S.e,f.a,f.c,Me,f.d,f.g,he,oe,me],styles:[".toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.img-style[_ngcontent-%COMP%]{width:32px}.position-fixed[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;top:0;z-index:5}"],data:{animation:[d.a,u.a]}}),e})();var Ue=i("MutI");let Ee=(()=>{class e{constructor(e,t,i,l,n,o){this.data=e,this.dialogRef=t,this.billService=i,this.billSettlementService=l,this.fb=n,this.snackbar=o,this.formHeading="",this.buttonName="CANCEL BILL",this.buttonName="Cancel"===this.data.type?"CANCEL BILL":"REJECT BILL"}ngOnInit(){this.formHeading=this.data.type+" Bill",this.form=this.fb.group({remarks:[this.data.remarks||""]})}cancelBillHistory(e){this.data.cancelRemarks=this.form.get("remarks").value,this.data&&this.data.paid>0?this.notificationMessage("Already payment has done against this invoice.So cancel the payment first before continue","yellow-snackbar"):(this.billService.cancelBillHistory(e).subscribe({next:e=>{e?this.notificationMessage("Invoice cancelled successfully","green-snackbar"):this.notificationMessage("Invoice cancel failed","red-snackbar")},error:e=>{this.notificationMessage("Invoice cancel failed","red-snackbar")}}),this.dialogRef.close())}rejectBillMaster(e){e.rejectedRemarks=this.form.get("remarks").value,this.billSettlementService.updatBillMasterRejectedStatus([e]).subscribe({next:e=>{e?this.notificationMessage("Invoice rejected successfully","green-snackbar"):this.notificationMessage("Invoice reject failed","red-snackbar")},error:e=>{this.notificationMessage("Invoice reject failed","red-snackbar")}}),this.dialogRef.close()}notificationMessage(e,t){this.snackbar.open(e,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[t]})}save(){"Cancel"===this.data.type?this.cancelBillHistory(this.data):this.rejectBillMaster(this.data)}close(){this.dialogRef.close()}}return e.\u0275fac=function(t){return new(t||e)(m.Nb(h.a),m.Nb(h.h),m.Nb(c.a),m.Nb(F.a),m.Nb(l.f),m.Nb(k.b))},e.\u0275cmp=m.Hb({type:e,selectors:[["fury-bill-cancel"]],decls:20,vars:8,consts:[["mat-dialog-title",""],["role","toolbar",1,"task-header"],[1,"fx-spacer"],["mat-icon-button","",3,"click"],["mat-list-icon",""],[3,"formGroup","ngSubmit"],[1,"person"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","12px"],["fxFlex",""],["formControlName","remarks","matInput",""],[3,"ctrl"],["fxLayout","row","fxLayoutAlign","end center"],["mat-button",""]],template:function(e,t){1&e&&(m.Tb(0,"h4",0),m.Tb(1,"mat-toolbar",1),m.Tb(2,"span"),m.Rc(3),m.Sb(),m.Ob(4,"span",2),m.Tb(5,"button",3),m.bc("click",(function(){return t.close()})),m.Tb(6,"mat-icon",4),m.Rc(7,"close"),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Tb(8,"form",5),m.bc("ngSubmit",(function(){return t.save()})),m.Tb(9,"mat-dialog-content"),m.Tb(10,"div",6),m.Tb(11,"div",7),m.Tb(12,"mat-form-field",8),m.Tb(13,"mat-label"),m.Rc(14,"Remarks"),m.Sb(),m.Ob(15,"textarea",9),m.Ob(16,"app-show-errors",10),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Tb(17,"mat-dialog-actions",11),m.Tb(18,"button",12),m.Rc(19),m.Sb(),m.Sb(),m.Sb()),2&e&&(m.Cb(3),m.Sc(t.formHeading),m.Cb(5),m.mc("formGroup",t.form),m.Cb(4),m.Mc("width",327,"px")("height",100,"px"),m.Cb(4),m.mc("ctrl",t.form.get("remarks")),m.Cb(3),m.Sc(t.buttonName))},directives:[h.i,q.a,P.a,w.a,Ue.c,l.z,l.r,l.k,h.f,S.d,S.e,I.d,S.b,I.h,l.c,W.b,l.q,l.i,h.c,S.c],styles:[".task-header[_ngcontent-%COMP%]{background-color:transparent;padding:0 5px;height:20px}.fx-spacer[_ngcontent-%COMP%]{flex:1 1 auto}"]}),e})();var je=i("zSPf");const He=["allTenantsSelected"],Ye=["tenantSelect"];function Ve(e,t){1&e&&(m.Tb(0,"small"),m.Rc(1,"To date should be greater than or equal to From date."),m.Sb())}function _e(e,t){if(1&e){const e=m.Ub();m.Tb(0,"mat-form-field",15),m.Tb(1,"mat-label"),m.Rc(2,"Unit Number"),m.Sb(),m.Tb(3,"input",16),m.bc("ngModelChange",(function(t){return m.Ec(e),m.fc(2).unitNumber=t})),m.Sb(),m.Sb()}if(2&e){const e=m.fc(2);m.Cb(3),m.mc("ngModel",e.unitNumber)}}function Ge(e,t){if(1&e&&(m.Tb(0,"mat-option",19),m.Rc(1),m.Sb()),2&e){const e=t.$implicit;m.mc("value",e.value),m.Cb(1),m.Tc("",e.label," ")}}function Xe(e,t){if(1&e){const e=m.Ub();m.Tb(0,"mat-form-field",15),m.Tb(1,"mat-label"),m.Rc(2,"Bill Period"),m.Sb(),m.Tb(3,"mat-select",17),m.bc("selectionChange",(function(t){return m.Ec(e),m.fc(2).onChangeBillPeriod(t.value)}))("valueChange",(function(t){return m.Ec(e),m.fc(2).billPeriodId=t})),m.Pc(4,Ge,2,2,"mat-option",18),m.Sb(),m.Tb(5,"mat-hint"),m.Rc(6,"Please select a Bill period"),m.Sb(),m.Sb()}if(2&e){const e=m.fc(2);m.Cb(3),m.mc("value",e.billPeriodId),m.Cb(1),m.mc("ngForOf",e.billPeriods)}}function $e(e,t){if(1&e){const e=m.Ub();m.Tb(0,"mat-option",24),m.bc("click",(function(){m.Ec(e),m.fc();const t=m.Ac(9);return m.fc(2).toggleTenantsPerOne(t.viewValue)})),m.Rc(1),m.Sb()}if(2&e){const e=t.$implicit;m.mc("value",e.id),m.Cb(1),m.Tc(" ",e.ownerName," ")}}function qe(e,t){if(1&e){const e=m.Ub();m.Tb(0,"mat-form-field",15),m.Tb(1,"mat-label"),m.Rc(2,"Tenant Name"),m.Sb(),m.Tb(3,"mat-select",20,21),m.bc("ngModelChange",(function(t){return m.Ec(e),m.fc(2).selectedTenants=t})),m.Tb(5,"input",22,23),m.bc("keydown",(function(t){return m.Ec(e),m.fc(2).handleInput(t)}))("keyup",(function(t){return m.Ec(e),m.fc(2).searchTenants(t.target.value)})),m.Sb(),m.Ob(7,"mat-divider"),m.Tb(8,"mat-option",24,25),m.bc("click",(function(){return m.Ec(e),m.fc(2).toggleTenantsAllSelection()})),m.Rc(10,"Select All"),m.Sb(),m.Pc(11,$e,2,2,"mat-option",26),m.Sb(),m.Sb()}if(2&e){const e=m.fc(2);m.Cb(3),m.mc("ngModel",e.selectedTenants),m.Cb(5),m.mc("value",0),m.Cb(3),m.mc("ngForOf",e.filteredTenants)}}function Je(e,t){if(1&e&&(m.Tb(0,"mat-option",19),m.Rc(1),m.Sb()),2&e){const e=t.$implicit;m.mc("value",e.value),m.Cb(1),m.Tc("",e.label," ")}}function Qe(e,t){if(1&e){const e=m.Ub();m.Tb(0,"mat-form-field",4),m.Tb(1,"mat-label"),m.Rc(2,"Bill Type"),m.Sb(),m.Tb(3,"mat-select",27),m.bc("selectionChange",(function(t){return m.Ec(e),m.fc(2).onChangeBillType(t.value)}))("valueChange",(function(t){return m.Ec(e),m.fc(2).billTypeId=t})),m.Pc(4,Je,2,2,"mat-option",18),m.Sb(),m.Tb(5,"mat-hint"),m.Rc(6,"Please select a Bill Type"),m.Sb(),m.Sb()}if(2&e){const e=m.fc(2);m.Cb(3),m.mc("value",e.billTypeId),m.Cb(1),m.mc("ngForOf",e.billTypes)}}function Ke(e,t){if(1&e&&(m.Tb(0,"mat-option",19),m.Rc(1),m.Sb()),2&e){const e=t.$implicit;m.mc("value",e.value),m.Cb(1),m.Tc("",e.label," ")}}function Ze(e,t){if(1&e){const e=m.Ub();m.Tb(0,"mat-form-field",4),m.Tb(1,"mat-label"),m.Rc(2,"Bill Status Type"),m.Sb(),m.Tb(3,"mat-select",28),m.bc("selectionChange",(function(t){return m.Ec(e),m.fc(2).onChangeBillFeeType(t.value)}))("valueChange",(function(t){return m.Ec(e),m.fc(2).billFeeTypeId=t})),m.Pc(4,Ke,2,2,"mat-option",18),m.Sb(),m.Tb(5,"mat-hint"),m.Rc(6,"Please select a Bill Status Type"),m.Sb(),m.Sb()}if(2&e){const e=m.fc(2);m.Cb(3),m.mc("value",e.billFeeTypeId),m.Cb(1),m.mc("ngForOf",e.billFeeTypes)}}function et(e,t){if(1&e){const e=m.Ub();m.Tb(0,"div",1),m.Tb(1,"mat-form-field",4),m.Tb(2,"mat-label"),m.Rc(3,"From Date"),m.Sb(),m.Tb(4,"input",5),m.bc("click",(function(){return m.Ec(e),m.Ac(7).open()}))("ngModelChange",(function(t){return m.Ec(e),m.fc().fromDate=t}))("ngModelChange",(function(){return m.Ec(e),m.fc().validateFromDateAndToDate()}))("focus",(function(){return m.Ec(e),m.Ac(7).open()})),m.Sb(),m.Ob(5,"mat-datepicker-toggle",6),m.Ob(6,"mat-datepicker",null,7),m.Sb(),m.Tb(8,"mat-form-field",4),m.Tb(9,"mat-label"),m.Rc(10,"To Date"),m.Sb(),m.Tb(11,"input",8),m.bc("click",(function(){return m.Ec(e),m.Ac(14).open()}))("ngModelChange",(function(t){return m.Ec(e),m.fc().toDate=t}))("ngModelChange",(function(){return m.Ec(e),m.fc().validateFromDateAndToDate()}))("focus",(function(){return m.Ec(e),m.Ac(14).open()})),m.Sb(),m.Ob(12,"mat-datepicker-toggle",6),m.Ob(13,"mat-datepicker",null,9),m.Pc(15,Ve,2,0,"small",10),m.Sb(),m.Pc(16,_e,4,1,"mat-form-field",11),m.Pc(17,Xe,7,2,"mat-form-field",11),m.Pc(18,qe,12,3,"mat-form-field",11),m.Pc(19,Qe,7,2,"mat-form-field",12),m.Pc(20,Ze,7,2,"mat-form-field",12),m.Tb(21,"div",13),m.Tb(22,"button",14),m.bc("click",(function(){return m.Ec(e),m.fc().onSearch()})),m.Tb(23,"mat-icon"),m.Rc(24,"search"),m.Sb(),m.Sb(),m.Sb(),m.Sb()}if(2&e){const e=m.Ac(7),t=m.Ac(14),i=m.fc();m.Cb(4),m.mc("ngModel",i.fromDate)("matDatepicker",e),m.Cb(1),m.mc("for",e),m.Cb(6),m.mc("ngModel",i.toDate)("matDatepicker",t),m.Cb(1),m.mc("for",t),m.Cb(3),m.mc("ngIf",!i.isValidDate),m.Cb(1),m.mc("ngIf",i.isHide),m.Cb(1),m.mc("ngIf","External"!=i.role),m.Cb(1),m.mc("ngIf","External"!=i.role&&1==i.isTenantVisible),m.Cb(1),m.mc("ngIf","External"!=i.role&&!i.isRejectedBills),m.Cb(1),m.mc("ngIf","External"!=i.role&&!i.isApproveBills&&!i.isRejectedBills)}}function tt(e,t){if(1&e&&(m.Tb(0,"mat-option",19),m.Rc(1),m.Sb()),2&e){const e=t.$implicit;m.mc("value",e.description),m.Cb(1),m.Tc("",e.description," ")}}function it(e,t){if(1&e){const e=m.Ub();m.Tb(0,"mat-form-field",4),m.Tb(1,"mat-label"),m.Rc(2,"Months"),m.Sb(),m.Tb(3,"mat-select",31),m.bc("selectionChange",(function(t){return m.Ec(e),m.fc(2).onChangeMonths(t.value)}))("valueChange",(function(t){return m.Ec(e),m.fc(2).monthSelected=t})),m.Pc(4,tt,2,2,"mat-option",18),m.Sb(),m.Tb(5,"mat-hint"),m.Rc(6,"Please select Months"),m.Sb(),m.Sb()}if(2&e){const e=m.fc(2);m.Cb(3),m.mc("value",e.monthSelected),m.Cb(1),m.mc("ngForOf",e.lstMonths)}}function lt(e,t){if(1&e){const e=m.Ub();m.Tb(0,"div",29),m.Pc(1,it,7,2,"mat-form-field",12),m.Tb(2,"div",13),m.Tb(3,"button",30),m.bc("click",(function(){return m.Ec(e),m.fc().onSearch()})),m.Rc(4,"Search"),m.Sb(),m.Sb(),m.Sb()}if(2&e){const e=m.fc();m.Cb(1),m.mc("ngIf",e.ownerId>0&&!e.isApproveBills&&!e.isRejectedBills)}}let nt=(()=>{class e{constructor(e,t,i,l,n){this.snackbar=e,this.date=t,this.masterService=i,this.jwtHelperService=l,this.cookieService=n,this.isValidDate=!0,this.billPeriods=[],this.billFeeTypes=[],this.billTypes=[],this.isHide=!0,this.isApproveBills=!1,this.isRejectedBills=!1,this.isTenantVisible=!1,this.selectedTenants=[],this.filteredTenants=[],this.data=[],this.searchClicked=new m.o,this.billFeeTypeChanged=new m.o,this.manageParams={},this.tenantId=0,this.fromDate="",this.toDate="",this.unitNumber="",this.billPeriodId=0,this.billFeeTypeId=0,this.billFeeType="",this.billTypeId=0,this.billType="",this.role="",this.ownerId=0,this.lstMonths=[],this.monthSelected="3 Months"}get tenants(){return this.data}set tenants(e){this.filteredTenants=this.data=e}ngOnInit(){let e=this.cookieService.get("access_token");const t=this.jwtHelperService.decodeToken(e);t&&(this.role=t["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"]);const i=this.cookieService.get("ownerId");this.ownerId=parseInt(i||"0"),this.ownerId>0&&this.masterService.getSystemMasterdata(81,0).subscribe(e=>{e&&e.length>0&&(this.lstMonths=e,this.monthSelected=this.lstMonths[0].description),this.onSearch()})}getDates(){if(""!=this.monthSelected){let e=this.monthSelected.substr(0,this.monthSelected.indexOf(" "));const t=new Date,i=new Date;i.setMonth(i.getMonth()-parseInt(e)+1),i.setDate(1),this.fromDate=i.toString(),this.toDate=t.toString()}}onSearch(){this.ownerId>0&&this.getDates(),this.fromDate&&this.toDate||this.billPeriodId||this.ownerId>0?(this.manageParams={fromDate:""+(""==this.fromDate?"":R(this.fromDate).format("YYYY-MM-DD")),toDate:""+(""==this.toDate?"":R(this.toDate).format("YYYY-MM-DD")),billPeriodId:""+this.billPeriodId,billFeeType:this.billFeeType,billType:this.billTypeId,tenantId:"External"!=this.role&&this.selectedTenants&&this.selectedTenants.length>0?this.selectedTenants.join(","):this.ownerId.toString()},this.searchClicked.emit(this.manageParams)):this.snackbar.open("Invalid search parameters",null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:["yellow-snackbar"]})}onChangeBillPeriod(e){this.billPeriodId=e}onChangeBillFeeType(e){this.billFeeTypeId=e;const t=this.billFeeTypes.find(t=>t.value===e);t&&(this.billFeeType=t.label),this.billFeeTypeChanged.emit(this.billFeeType)}onChangeBillType(e){this.billTypeId=e;const t=this.billTypes.find(t=>t.value===e);t&&(this.billType=t.label)}selectTenant(e){this.tenants.forEach(t=>{t.ownerName===e.option.value&&(this.tenantId=t.id)})}validateFromDateAndToDate(){if(this.fromDate&&this.toDate){let e=new Date(this.fromDate),t=new Date(this.toDate);this.isValidDate=Object(b.g)(e,t)}}onChangeMonths(e){this.monthSelected=e}toggleTenantsAllSelection(){this.selectedTenants=[],this.allTenantsSelected.selected?(this.selectedTenants=this.filteredTenants.map(e=>e.id),this.select.options.forEach(e=>e.select())):(this.select.options.forEach(e=>e.deselect()),this.selectedTenants=[])}toggleTenantsPerOne(){if(this.allTenantsSelected.selected)return this.allTenantsSelected.deselect(),!1;this.data.length<=this.selectedTenants.length&&this.allTenantsSelected.select()}searchTenants(e){let t=this.selectTenants(e.toLowerCase());this.filteredTenants=t}selectTenants(e){let t=[];if(e)for(let i of this.data)i.ownerName.toLowerCase().indexOf(e)>-1&&t.push(i);else t=this.filteredTenants=this.data;return t}handleInput(e){e.stopPropagation()}}return e.\u0275fac=function(t){return new(t||e)(m.Nb(k.b),m.Nb(a.f),m.Nb(je.a),m.Nb(y.a),m.Nb(C.a))},e.\u0275cmp=m.Hb({type:e,selectors:[["app-bill-history-toolbar"]],viewQuery:function(e,t){var i;1&e&&(m.Vc(He,!0),m.Vc(Ye,!0)),2&e&&(m.zc(i=m.cc())&&(t.allTenantsSelected=i.first),m.zc(i=m.cc())&&(t.select=i.first))},inputs:{billPeriods:"billPeriods",billFeeTypes:"billFeeTypes",billTypes:"billTypes",isHide:"isHide",isApproveBills:"isApproveBills",isRejectedBills:"isRejectedBills",isTenantVisible:"isTenantVisible",tenants:"tenants"},outputs:{searchClicked:"searchClicked",billFeeTypeChanged:"billFeeTypeChanged"},decls:6,vars:2,consts:[[1,"person","padding-bottom"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","8px"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","8px",4,"ngIf"],["fxLayout","row","fxLayoutGap","15px","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","15px",4,"ngIf"],["color","primary",1,"result",2,"width","160px"],["id","fromDate","name","fromDate","matInput","","readonly","",3,"ngModel","matDatepicker","click","ngModelChange","focus"],["matSuffix","",3,"for"],["formDatepickerRef1",""],["id","toDate","name","toDate","matInput","","readonly","",3,"ngModel","matDatepicker","click","ngModelChange","focus"],["formDatepickerRef2",""],[4,"ngIf"],["class","result","color","primary",4,"ngIf"],["class","result","color","primary","style","width: 160px;",4,"ngIf"],[1,"fury-flex-form-field"],["mat-icon-button","",3,"click"],["color","primary",1,"result"],["type","text","id","unitNumber","name","unitNumber","matInput","",3,"ngModel","ngModelChange"],["id","billPeriod","name","billPeriod",3,"value","selectionChange","valueChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["multiple","","placeholder","Select a tenant","id","tenant","name","tenant",1,"multiSelectCustom",3,"ngModel","ngModelChange"],["tenantSelect",""],["matInput","","focused","'true'","type","text","autocomplete","off","placeholder","search",1,"myInput",3,"keydown","keyup"],["myInput",""],[3,"value","click"],["allTenantsSelected",""],[3,"value","click",4,"ngFor","ngForOf"],["id","billType","name","billType",3,"value","selectionChange","valueChange"],["id","billFeeType","name","billFeeType",3,"value","selectionChange","valueChange"],["fxLayout","row","fxLayoutGap","15px","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","15px"],["mat-button","",1,"buttonStyle",3,"click"],["id","months","name","months",3,"value","selectionChange","valueChange"]],template:function(e,t){1&e&&(m.Tb(0,"mat-dialog-content"),m.Tb(1,"div",0),m.Tb(2,"form"),m.Tb(3,"div",1),m.Pc(4,et,25,12,"div",2),m.Sb(),m.Pc(5,lt,5,1,"div",3),m.Sb(),m.Sb(),m.Sb()),2&e&&(m.Cb(4),m.mc("ngIf",0==t.ownerId),m.Cb(1),m.mc("ngIf",t.ownerId>0))},directives:[h.f,l.z,l.r,l.s,S.d,S.e,a.o,I.d,I.h,W.b,l.c,B.b,l.q,l.t,B.d,I.j,B.a,P.a,w.a,O.a,a.n,I.g,L.n,M.a],styles:[".button[_ngcontent-%COMP%]{line-height:50px}small[_ngcontent-%COMP%]{color:red}.buttonStyle[_ngcontent-%COMP%]{background:#f5f5f5;margin-top:15px}.myInput[_ngcontent-%COMP%]{height:50px!important;padding:10px!important}"]}),e})();var ot=i("Ytuj");function at(e,t){if(1&e){const e=m.Ub();m.Tb(0,"div",3),m.Tb(1,"button",5),m.bc("click",(function(){return m.Ec(e),m.fc().onSendNotifications()})),m.Tb(2,"mat-icon"),m.Rc(3,"textsms"),m.Sb(),m.Sb(),m.Sb()}}function st(e,t){if(1&e){const e=m.Ub();m.Tb(0,"button",6),m.bc("click",(function(){return m.Ec(e),m.fc().onPrint()})),m.Tb(1,"mat-icon"),m.Rc(2,"print"),m.Sb(),m.Sb()}}function rt(e,t){if(1&e){const e=m.Ub();m.Tb(0,"div",3),m.Tb(1,"button",7),m.bc("click",(function(){return m.Ec(e),m.fc().onPrintSummary("Normal")})),m.Tb(2,"mat-icon"),m.Rc(3,"assignment"),m.Sb(),m.Sb(),m.Sb()}}function ct(e,t){if(1&e){const e=m.Ub();m.Tb(0,"div",3),m.Tb(1,"button",8),m.bc("click",(function(){return m.Ec(e),m.fc().onApprove()})),m.Tb(2,"mat-icon"),m.Rc(3,"verified_user"),m.Sb(),m.Sb(),m.Sb()}if(2&e){const e=m.fc();m.Cb(1),m.mc("disabled",!e.showAprrovedButton)}}function ut(e,t){if(1&e){const e=m.Ub();m.Tb(0,"div",3),m.Tb(1,"button",9),m.bc("click",(function(){return m.Ec(e),m.fc().onRegenerate()})),m.Tb(2,"mat-icon"),m.Rc(3,"build"),m.Sb(),m.Sb(),m.Sb()}if(2&e){const e=m.fc();m.Cb(1),m.mc("disabled",e.disable)}}function dt(e,t){if(1&e){const e=m.Ub();m.Tb(0,"div",3),m.Tb(1,"button",10),m.bc("click",(function(){return m.Ec(e),m.fc().onExcelExport()})),m.Tb(2,"mat-icon"),m.Rc(3,"import_export"),m.Sb(),m.Sb(),m.Sb()}}function mt(e,t){if(1&e){const e=m.Ub();m.Tb(0,"div",3),m.Tb(1,"button",11),m.bc("click",(function(){return m.Ec(e),m.fc().onBillConsumptionExcelExport()})),m.Tb(2,"mat-icon"),m.Rc(3,"table_chart"),m.Sb(),m.Sb(),m.Sb()}}let ht=(()=>{class e{constructor(e,t){this.jwtHelperService=e,this.cookieService=t,this.role="",this.showAprrovedButton=!1,this.actions=[],this.ownerId=0,this.billFeeType="",this.isApproveBills=!1,this.isRejectedBills=!1,this.parameterValue=!1,this.sendInvoiceClicked=new m.o,this.printClicked=new m.o,this.sendNotificationsClicked=new m.o,this.printSummaryClicked=new m.o,this.approveClickedClicked=new m.o,this.regenerateClicked=new m.o,this.excelExportClicked=new m.o,this.billConsumptionExcelExportClicked=new m.o}get userActions(){return this.actions}set userActions(e){if(this.actions=e,this.actions&&this.actions.length){const e=this.actions.find(e=>"Bill Approval"===e.actionName);this.showAprrovedButton=!!e}}ngOnInit(){let e=this.cookieService.get("access_token");const t=this.jwtHelperService.decodeToken(e);t&&(this.role=t["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"]),this.ownerId=parseInt(this.cookieService.get("ownerId"))}onSendInvoice(e){this.sendInvoiceClicked.emit(e)}onPrint(){this.printClicked.emit()}onPrintSummary(e){this.printSummaryClicked.emit(e)}onApprove(){this.approveClickedClicked.emit()}onRegenerate(){this.regenerateClicked.emit()}onSendNotifications(){this.sendNotificationsClicked.emit()}onExcelExport(){this.excelExportClicked.emit()}onBillConsumptionExcelExport(){this.billConsumptionExcelExportClicked.emit()}}return e.\u0275fac=function(t){return new(t||e)(m.Nb(y.a),m.Nb(C.a))},e.\u0275cmp=m.Hb({type:e,selectors:[["fury-bill-history-footer-toolbar"]],inputs:{disable:"disable",userActions:"userActions",isApproveBills:"isApproveBills",isRejectedBills:"isRejectedBills",parameterValue:"parameterValue"},outputs:{sendInvoiceClicked:"sendInvoiceClicked",printClicked:"printClicked",sendNotificationsClicked:"sendNotificationsClicked",printSummaryClicked:"printSummaryClicked",approveClickedClicked:"approveClickedClicked",regenerateClicked:"regenerateClicked",excelExportClicked:"excelExportClicked",billConsumptionExcelExportClicked:"billConsumptionExcelExportClicked"},decls:12,vars:7,consts:[[1,"person"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutAlign","end end","fxLayoutGap.gt-sm","24px"],["class","fury-flex-form-field",4,"ngIf"],[1,"fury-flex-form-field"],["matTooltip","Print","mat-icon-button","","class","example-icon",3,"click",4,"ngIf"],["matTooltip","Notifications","mat-icon-button","",1,"material-icons",3,"click"],["matTooltip","Print","mat-icon-button","",1,"example-icon",3,"click"],["matTooltip","Summary","mat-icon-button","",1,"material-icons",3,"click"],["matTooltip","Approve","mat-icon-button","",1,"material-icons",3,"disabled","click"],["matTooltip","Regenerate","mat-icon-button","",1,"material-icons",3,"disabled","click"],["matTooltip","Export","mat-icon-button","","aria-label","Example icon-button with menu icon",1,"example-icon",3,"click"],["matTooltip","Detailed Bill Summary","mat-icon-button","","aria-label","Example icon-button with menu icon",1,"example-icon",3,"click"]],template:function(e,t){1&e&&(m.Tb(0,"mat-dialog-content"),m.Tb(1,"div",0),m.Tb(2,"form"),m.Tb(3,"div",1),m.Pc(4,at,4,0,"div",2),m.Tb(5,"div",3),m.Pc(6,st,3,0,"button",4),m.Sb(),m.Pc(7,rt,4,0,"div",2),m.Pc(8,ct,4,1,"div",2),m.Pc(9,ut,4,1,"div",2),m.Pc(10,dt,4,0,"div",2),m.Pc(11,mt,4,0,"div",2),m.Sb(),m.Sb(),m.Sb(),m.Sb()),2&e&&(m.Cb(4),m.mc("ngIf",t.parameterValue&&0==t.ownerId&&!t.isApproveBills&&!t.isRejectedBills),m.Cb(2),m.mc("ngIf",0==t.ownerId),m.Cb(1),m.mc("ngIf",0==t.ownerId&&!t.isApproveBills&&!t.isRejectedBills),m.Cb(1),m.mc("ngIf",0==t.ownerId&&t.isApproveBills&&!t.isRejectedBills),m.Cb(1),m.mc("ngIf",0==t.ownerId&&!t.isApproveBills&&t.isRejectedBills),m.Cb(1),m.mc("ngIf",0==t.ownerId&&!t.isRejectedBills),m.Cb(1),m.mc("ngIf",0==t.ownerId&&!t.isRejectedBills))},directives:[h.f,l.z,l.r,l.s,S.d,S.c,S.e,a.o,P.a,D.a,w.a],styles:[".button[_ngcontent-%COMP%]{line-height:50px}"]}),e})(),bt=(()=>{class e{constructor(e,t,i,l,n,o,a,s){var r,c;this.data=e,this.dialogRef=t,this.currencyPipe=i,this.billSettlementService=l,this.snackbar=n,this.cookieService=o,this.decimalPipe=a,this.envService=s,this._gap=16,this.gap=this._gap+"px",this.col2=`1 1 calc(50% - ${this._gap/2}px)`,this.col3=`1 1 calc(33.3333% - ${this._gap/1.5}px)`,this.creditNoteTransactions=[],this.columns=[],this.identifierColumnName="#",this.accountHeadColumnName="Account Head",this.amountColumnName="Amount",this.creditNoteAmountColumnName="Credit Note Amount",this.accountHeadAmount="",this.creditNoteAmount="",this.viewMode="Edit",this.format="",this.currency="",this.roundFormat=Object(b.e)("RoundOff"),this.clientId=0,this.disableSave=!1,this.format=null!==(r=Object(b.e)("DateFormat"))&&void 0!==r?r:s.dateFormat,this.currency=null!==(c=Object(b.e)("Currency"))&&void 0!==c?c:s.currencyFormat}ngOnInit(){this.clientId=parseInt(this.cookieService.get("globalClientId")),this.createGridColumns(),this.onGetAccountHeads(this.data)}createGridColumns(){this.columns=[{name:this.identifierColumnName,property:"rowNumber",visible:!0,isModelProperty:!0},{name:this.accountHeadColumnName,property:"headDisplay",visible:!0,isModelProperty:!0},{name:this.amountColumnName,property:"fixedAmountLocal",visible:!0,isModelProperty:!0,columnAlign:{"text-align":"right"}},{name:this.creditNoteAmountColumnName,property:"creditNoteAmountLocal",visible:!0,isModelProperty:!1,columnAlign:{"text-align":"right"}}],"View"===this.data.transactionMode&&(this.viewMode=this.data.transactionMode,this.columns.splice(-1,1),this.columns.push({name:this.creditNoteAmountColumnName,property:"creditNoteAmountLocal",visible:!0,isModelProperty:!0}))}onGetAccountHeads(e){this.creditNoteTransactions=e.creditNoteTransactions;let t=0,i=0;this.creditNoteTransactions.forEach(e=>{t+=Number(e.fixedAmount),i+=Number(e.creditNoteAmount),e.creditNoteAmountLocal=this.decimalPipe.transform(e.creditNoteAmount,this.roundFormat.toString()).replace(/,/g,""),e.fixedAmountLocal=this.currencyPipe.transform(e.fixedAmount,this.currency.toString(),!0,this.roundFormat.toString())}),this.accountHeadAmount=this.currencyPipe.transform(t,this.currency.toString(),!0,this.roundFormat),this.creditNoteAmount=this.currencyPipe.transform(i,this.currency.toString(),!0,this.roundFormat)}onSave(){const e=this.tableStructureComponent.dataSource;let t=0,i=[];if(e&&e.filteredData&&e.filteredData.length&&e.filteredData.forEach(e=>{if(Number(e.creditNoteAmountLocal.replace(/,/g,""))>0){const t={billHeadId:Number(e.billHeadId),headDisplay:e.headDisplay,creditNoteAmount:Number(e.creditNoteAmountLocal.replace(/,/g,"")),taxId:Number(e.taxId)};i.push(t)}t+=Number(e.creditNoteAmountLocal.replace(/,/g,""))}),i&&!i.length)return void this.notificationMessage("Credit note save failed","red-snackbar");const l={clientId:this.clientId,ownerId:this.data.ownerId,billMasterId:Number(this.data.billMasterId),creditNoteAmount:Number(t),creditNoteTransactions:i};this.billSettlementService.saveCreditNote(l).subscribe({next:e=>{e?(this.dialogRef.close(!0),this.notificationMessage("Credit note saved successfully","green-snackbar")):this.notificationMessage("Credit note save failed","red-snackbar")},error:e=>{this.notificationMessage("Credit note save failed","red-snackbar")}})}notificationMessage(e,t){this.snackbar.open(e,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[t]})}onChangedRow(){this.disableSave=!1;let e=0;const t=this.tableStructureComponent.dataSource;if(t&&(t.filteredData.forEach(e=>{if(e.creditNoteAmountLocal&&e.fixedAmount&&Number(e.creditNoteAmountLocal)>e.fixedAmount)return this.notificationMessage("Credit note amount should be less than Head amount","yellow-snackbar"),void(this.disableSave=!0);""!==e.creditNoteAmountLocal&&""!==e.fixedAmount||(this.disableSave=!0)}),!this.disableSave)){const i=t.filteredData.filter(e=>e.disabled&&e.value>0);i&&i.length&&i.forEach(e=>{e.creditNoteAmountLocal=this.decimalPipe.transform(0,this.roundFormat)}),t.filteredData.forEach(t=>{e+=Number(this.decimalPipe.transform(t.creditNoteAmountLocal.replace(",",""),this.roundFormat).replace(",","")),t.isVAT&&i&&i.length&&i.forEach(e=>{if("Percentage"===e.formulaFieldName){const i=Number(this.decimalPipe.transform(t.creditNoteAmountLocal.replace(",",""),this.roundFormat).replace(",",""))*Number(this.decimalPipe.transform(e.value,this.roundFormat).replace(",",""))/100;e.creditNoteAmount+=Number(this.decimalPipe.transform(i,this.roundFormat).replace(",",""))}e.creditNoteAmountLocal=this.decimalPipe.transform(e.creditNoteAmount,this.roundFormat)})}),this.creditNoteAmount=this.currencyPipe.transform(e,this.currency.toString(),!0,this.roundFormat)}}}return e.\u0275fac=function(t){return new(t||e)(m.Nb(h.a),m.Nb(h.h),m.Nb(a.d),m.Nb(F.a),m.Nb(k.b),m.Nb(C.a),m.Nb(a.g),m.Nb(p.a))},e.\u0275cmp=m.Hb({type:e,selectors:[["app-credit-note-details"]],viewQuery:function(e,t){var i;1&e&&m.Jc(g.a,!0),2&e&&m.zc(i=m.cc())&&(t.tableStructureComponent=i.first)},decls:26,vars:9,consts:[[1,"removePadding"],["color","primary"],["src","assets/img/fav-icon.png",1,"img-style"],[1,"toolbar-spacer"],[1,"fury-flex-form-field"],["matTooltip","Save","mat-icon-button","","aria-label","Example icon-button with menu icon",1,"example-icon",3,"disabled","click"],[1,"topPadding"],["fxLayout","column",1,"removePadding",3,"fxLayoutGap"],["fxFlex","noshrink","fxLayout","column","fxLayout.gt-sm","row","fxLayoutAlign.gt-sm","start stretch",3,"fxLayoutGap"],["fxFlex","grow",1,"basic-forms","route-animations-elements",3,"fxFlex.gt-sm"],["fxLayout","column",1,"removePadding"],["fxLayout","column",1,"result","divScroll"],[3,"tableData","columns","changedRow"],["fxLayout.gt-sm","row","fxLayout","column","fxLayoutAlign","end center","fxLayoutGap.gt-sm","12px",1,"person","padding-top"],["color","primary",1,"result"],["type","text","id","accountHeadAmount","name","accountHeadAmount","readonly","","matInput","",2,"text-align","right",3,"ngModel","ngModelChange"],["color","primary",1,"result",2,"padding-top","10px"],["type","text","id","creditNoteAmount","name","creditNoteAmount","readonly","","matInput","",2,"text-align","right",3,"ngModel","ngModelChange"]],template:function(e,t){1&e&&(m.Tb(0,"fury-card-header",0),m.Tb(1,"mat-toolbar",1),m.Ob(2,"img",2),m.Tb(3,"span"),m.Rc(4,"Credit Note"),m.Sb(),m.Ob(5,"span",3),m.Tb(6,"div",4),m.Tb(7,"button",5),m.bc("click",(function(){return t.onSave()})),m.Tb(8,"mat-icon"),m.Rc(9,"save"),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Ob(10,"div",6),m.Tb(11,"fury-page-layout-content",7),m.Tb(12,"div",8),m.Tb(13,"fury-card",9),m.Tb(14,"fury-card-content",10),m.Tb(15,"div",11),m.Tb(16,"app-table-structure",12),m.bc("changedRow",(function(){return t.onChangedRow()})),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Tb(17,"div",13),m.Tb(18,"mat-form-field",14),m.Tb(19,"mat-label"),m.Rc(20,"Account Head Amount"),m.Sb(),m.Tb(21,"input",15),m.bc("ngModelChange",(function(e){return t.accountHeadAmount=e})),m.Sb(),m.Sb(),m.Tb(22,"mat-form-field",16),m.Tb(23,"mat-label"),m.Rc(24,"Credit Note Amount"),m.Sb(),m.Tb(25,"input",17),m.bc("ngModelChange",(function(e){return t.creditNoteAmount=e})),m.Sb(),m.Sb(),m.Sb()),2&e&&(m.Cb(7),m.mc("disabled",t.disableSave||"View"===t.viewMode),m.Cb(4),m.mc("fxLayoutGap",t.gap),m.Cb(1),m.mc("fxLayoutGap",t.gap),m.Cb(1),m.mc("fxFlex.gt-sm",t.col2)("@fadeInUp",void 0),m.Cb(3),m.mc("tableData",t.creditNoteTransactions)("columns",t.columns),m.Cb(5),m.mc("ngModel",t.accountHeadAmount),m.Cb(4),m.mc("ngModel",t.creditNoteAmount))},directives:[f.d,q.a,P.a,D.a,w.a,$.a,S.d,S.e,S.b,S.c,f.a,f.c,g.a,I.d,I.h,W.b,l.c,l.q,l.t],styles:[".button[_ngcontent-%COMP%]{line-height:50px}.toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.img-style[_ngcontent-%COMP%]{width:32px}.removePadding[_ngcontent-%COMP%]{padding:0}.topPadding[_ngcontent-%COMP%]{padding-top:25px}.divScroll[_ngcontent-%COMP%]{height:310px;overflow-y:auto}"],data:{animation:[d.a,u.a]}}),e})(),pt=(()=>{class e{constructor(e,t){this.dialogRef=e,this.item=t,this.data={},this.data=t}ngOnInit(){}close(){this.dialogRef.close()}save(){}}return e.\u0275fac=function(t){return new(t||e)(m.Nb(h.h),m.Nb(h.a))},e.\u0275cmp=m.Hb({type:e,selectors:[["fury-view-remarks-dialog"]],decls:4,vars:2,consts:[[1,"heading"],[1,"mat-dlg-content","contentStyle"]],template:function(e,t){1&e&&(m.Tb(0,"div",0),m.Rc(1),m.Sb(),m.Tb(2,"div",1),m.Rc(3),m.Sb()),2&e&&(m.Cb(1),m.Tc(" ",t.data.label," "),m.Cb(2),m.Sc(t.data.value))},styles:[".buttonStyle[_ngcontent-%COMP%]{background:#1976d2;color:#fff;padding-right:10px}.heading[_ngcontent-%COMP%]{font-size:large;font-weight:700;margin-top:10px}.contentStyle[_ngcontent-%COMP%]{padding-top:40px;padding-bottom:30px;padding-right:30px}.rightAlign[_ngcontent-%COMP%]{text-align:right}.bottomPadding[_ngcontent-%COMP%]{padding-bottom:20px}"]}),e})();function ft(e,t){if(1&e&&(m.Tb(0,"mat-option",12),m.Rc(1),m.Sb()),2&e){const e=t.$implicit;m.mc("value",e.notificationType),m.Cb(1),m.Tc(" ",e.notificationType," ")}}let gt=(()=>{class e{constructor(e,t,i){this.fb=e,this.dialogRef=t,this.data=i,this.notificationType="",this.options=[],this.billMasters=[],this.notificationLabel="",t.disableClose=!0}ngOnInit(){this.options=this.data.alertSettings,this.billMasters=this.data.billMasters}close(){this.notificationType="",this.dialogRef.close()}send(e=!1){this.dialogRef.close({notificationType:this.notificationType,isSkipExisting:e})}onChangeTemplate(e){this.notificationType=e;let t=[];if(this.billMasters&&this.billMasters.length){const e=this.billMasters.filter(e=>e.notificationLogs&&e.notificationLogs.length>0);e&&e.length&&e.forEach(e=>{const i=e.notificationLogs.find(e=>e.notificationType===this.notificationType);i&&t.push(i)})}this.notificationLabel=`Total requests :${this.billMasters.length} \n New requests: ${this.billMasters.length-t.length} \n Already send requests : ${t.length}`}}return e.\u0275fac=function(t){return new(t||e)(m.Nb(l.f),m.Nb(h.h),m.Nb(h.a))},e.\u0275cmp=m.Hb({type:e,selectors:[["fury-notifications-send-dialog"]],decls:24,vars:3,consts:[["mat-dialog-title",""],["role","toolbar",1,"task-header"],[1,"fx-spacer"],["mat-icon-button","",3,"click"],["title","Close","mat-list-icon",""],[1,"mat-dlg-content"],["fxLayout","column",1,"content"],["color","primary",1,"result"],["id","template","name","template",3,"value","selectionChange","valueChange"],[3,"value",4,"ngFor","ngForOf"],["fxLayout","row","fxLayoutAlign","end center"],["mat-button","",3,"click"],[3,"value"]],template:function(e,t){1&e&&(m.Tb(0,"h4",0),m.Tb(1,"mat-toolbar",1),m.Tb(2,"span"),m.Rc(3,"Send Notifications"),m.Sb(),m.Ob(4,"span",2),m.Tb(5,"button",3),m.bc("click",(function(){return t.close()})),m.Tb(6,"mat-icon",4),m.Rc(7,"close"),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Tb(8,"mat-dialog-content",5),m.Tb(9,"div",6),m.Tb(10,"mat-form-field",7),m.Tb(11,"mat-label"),m.Rc(12,"Select Template"),m.Sb(),m.Tb(13,"mat-select",8),m.bc("selectionChange",(function(e){return t.onChangeTemplate(e.value)}))("valueChange",(function(e){return t.notificationType=e})),m.Pc(14,ft,2,2,"mat-option",9),m.Sb(),m.Tb(15,"mat-hint"),m.Rc(16,"Please select a template"),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Rc(17),m.Ob(18,"mat-dialog-content"),m.Tb(19,"mat-dialog-actions",10),m.Tb(20,"button",11),m.bc("click",(function(){return t.send(!1)})),m.Rc(21,"Resend"),m.Sb(),m.Tb(22,"button",11),m.bc("click",(function(){return t.send(!0)})),m.Rc(23,"Send"),m.Sb(),m.Sb()),2&e&&(m.Cb(13),m.mc("value",t.notificationType),m.Cb(1),m.mc("ngForOf",t.options),m.Cb(3),m.Tc("\n",t.notificationLabel,"\n"))},directives:[h.i,q.a,P.a,w.a,Ue.c,h.f,S.d,I.d,I.h,O.a,a.n,I.g,h.c,S.c,L.n],styles:[".myInput[_ngcontent-%COMP%]{height:50px!important;padding:10px!important}.task-header[_ngcontent-%COMP%]{background-color:transparent;padding:0 5px;height:20px}.fx-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.content[_ngcontent-%COMP%]{width:480px;height:150px;padding-top:20px}.buttonStyle[_ngcontent-%COMP%]{background:#1976d2;color:#fff;padding-right:10px}.marginRadioButton[_ngcontent-%COMP%]{margin-left:10px;margin-bottom:15px}"]}),e})();var vt=i("EUZL"),yt=i("M9IT"),Ct=i("Dh3D"),St=i("a+RD");const Tt=["htmlData"];function Pt(e,t){1&e&&(m.Tb(0,"span"),m.Rc(1,"Approve Bills"),m.Sb())}function Dt(e,t){1&e&&(m.Tb(0,"span"),m.Rc(1,"Bill History"),m.Sb())}function wt(e,t){1&e&&(m.Tb(0,"span"),m.Rc(1,"Rejected Bills"),m.Sb())}function Nt(e,t){if(1&e){const e=m.Ub();m.Tb(0,"div",14),m.Tb(1,"fury-expandable-table-structure",15),m.bc("selectedRows",(function(t){return m.Ec(e),m.fc().onSelectedRows(t)}))("viewDataRow",(function(t){return m.Ec(e),m.fc().onViewDataRow(t)}))("printDataRow",(function(t){return m.Ec(e),m.fc().downloadReport(t)}))("deleteDataRow",(function(t){return m.Ec(e),m.fc().onDeleteDataRow(t)}))("rejectDataRow",(function(t){return m.Ec(e),m.fc().onRejectDataRow(t)}))("failDataRow",(function(t){return m.Ec(e),m.fc().onFailDataRow(t)}))("updateRow",(function(t){return m.Ec(e),m.fc().onUpdateRow(t)}))("remarksDataRow",(function(t){return m.Ec(e),m.fc().onRemarksDataRow(t)}))("filterDataRow",(function(t){return m.Ec(e),m.fc().onFilterDataRow(t)})),m.Sb(),m.Sb()}if(2&e){const e=m.fc();m.Cb(1),m.mc("tableData",e.billMasterDetails)("columnsToDisplay",e.columns)("innerDisplayedColumns",e.innerColumns)("columnNames",e.columnNames)("hideHeader",!1)("cssStyledColumn",e.cssStyledColumn)("visibleButtons",e.visibleButtons)("role",e.role)("buttonName",e.buttonName)("disableColumn",e.disableColumn)("buttonDisableColumn",e.buttonDisableColumn)}}function xt(e,t){if(1&e&&(m.Tb(0,"th",32),m.Rc(1),m.Sb()),2&e){const e=m.fc(2).$implicit;m.Cb(1),m.Tc(" ",e.name,"")}}function At(e,t){if(1&e&&(m.Tb(0,"td",33),m.Rc(1),m.Sb()),2&e){const e=t.$implicit,i=m.fc(2).$implicit;m.Cb(1),m.Tc(" ",e[i.property]," ")}}function Ft(e,t){if(1&e&&(m.Rb(0,29),m.Pc(1,xt,2,1,"th",30),m.Pc(2,At,2,1,"td",31),m.Qb()),2&e){const e=m.fc().$implicit;m.mc("matColumnDef",e.property)}}function Rt(e,t){if(1&e&&(m.Rb(0),m.Pc(1,Ft,3,1,"ng-container",28),m.Qb()),2&e){const e=t.$implicit;m.Cb(1),m.mc("ngIf",e.isModelProperty)}}function kt(e,t){1&e&&(m.Tb(0,"th",34),m.Rc(1,"NET AMOUNT"),m.Sb())}function It(e,t){if(1&e&&(m.Tb(0,"td",35),m.Rc(1),m.Sb()),2&e){const e=t.$implicit;m.Cb(1),m.Tc(" ",e.netAmountLocal," ")}}function Ot(e,t){1&e&&m.Ob(0,"th",36)}function Wt(e,t){if(1&e){const e=m.Ub();m.Tb(0,"td",37),m.Tb(1,"button",38),m.bc("click",(function(){m.Ec(e);const i=t.$implicit;return m.fc(2).downloadReport(i)})),m.Tb(2,"mat-icon"),m.Rc(3,"print"),m.Sb(),m.Sb(),m.Sb()}}function Mt(e,t){1&e&&m.Ob(0,"tr",39)}function Lt(e,t){1&e&&m.Ob(0,"tr",40)}function Bt(e,t){if(1&e){const e=m.Ub();m.Tb(0,"div",14),m.Tb(1,"fury-list",16),m.bc("filterChange",(function(t){return m.Ec(e),m.fc().onFilterChange(t)})),m.Tb(2,"table",17),m.Pc(3,Rt,2,1,"ng-container",18),m.Rb(4,19),m.Pc(5,kt,2,0,"th",20),m.Pc(6,It,2,1,"td",21),m.Qb(),m.Rb(7,22),m.Pc(8,Ot,1,0,"th",23),m.Pc(9,Wt,4,0,"td",24),m.Qb(),m.Pc(10,Mt,1,0,"tr",25),m.Pc(11,Lt,1,0,"tr",26),m.Sb(),m.Ob(12,"mat-paginator",27),m.Sb(),m.Sb()}if(2&e){const e=m.fc();m.Cb(1),m.mc("columns",e.displayedColumns),m.Cb(1),m.mc("dataSource",e.dataSource),m.Cb(1),m.mc("ngForOf",e.displayedColumns),m.Cb(7),m.mc("matHeaderRowDef",e.visibleColumns),m.Cb(1),m.mc("matRowDefColumns",e.visibleColumns),m.Cb(1),m.mc("pageSize",e.pageSize)}}function zt(e,t){if(1&e&&(m.Tb(0,"ul"),m.Tb(1,"li"),m.Tb(2,"div",45),m.Tb(3,"label"),m.Rc(4,"Approved"),m.Sb(),m.Ob(5,"div",46),m.Tb(6,"label"),m.Rc(7),m.Sb(),m.Sb(),m.Sb(),m.Tb(8,"li"),m.Tb(9,"div",45),m.Tb(10,"label"),m.Rc(11,"Rejected"),m.Sb(),m.Ob(12,"div",47),m.Tb(13,"label"),m.Rc(14),m.Sb(),m.Sb(),m.Sb(),m.Sb()),2&e){const e=m.fc(2);m.Cb(7),m.Sc(e.approvedCount),m.Cb(7),m.Sc(e.rejectedCount)}}function Ut(e,t){if(1&e){const e=m.Ub();m.Tb(0,"mat-form-field",42),m.Tb(1,"mat-label"),m.Rc(2,"Credit Note Amount"),m.Sb(),m.Tb(3,"input",48),m.bc("ngModelChange",(function(t){return m.Ec(e),m.fc(2).creditNoteAmount=t})),m.Sb(),m.Sb()}if(2&e){const e=m.fc(2);m.Cb(3),m.mc("ngModel",e.creditNoteAmount)}}function Et(e,t){if(1&e){const e=m.Ub();m.Tb(0,"mat-form-field",42),m.Tb(1,"mat-label"),m.Rc(2,"Net Bill Amount"),m.Sb(),m.Tb(3,"input",49),m.bc("ngModelChange",(function(t){return m.Ec(e),m.fc(2).netAmount=t})),m.Sb(),m.Sb()}if(2&e){const e=m.fc(2);m.Cb(3),m.mc("ngModel",e.netAmount)}}function jt(e,t){if(1&e){const e=m.Ub();m.Tb(0,"mat-form-field",42),m.Tb(1,"mat-label"),m.Rc(2,"Paid Amount"),m.Sb(),m.Tb(3,"input",50),m.bc("ngModelChange",(function(t){return m.Ec(e),m.fc(2).receivedAmount=t})),m.Sb(),m.Sb()}if(2&e){const e=m.fc(2);m.Cb(3),m.mc("ngModel",e.receivedAmount)}}function Ht(e,t){if(1&e){const e=m.Ub();m.Tb(0,"mat-form-field",42),m.Tb(1,"mat-label"),m.Rc(2,"Balance Amount"),m.Sb(),m.Tb(3,"input",51),m.bc("ngModelChange",(function(t){return m.Ec(e),m.fc(2).balanceAmount=t})),m.Sb(),m.Sb()}if(2&e){const e=m.fc(2);m.Cb(3),m.mc("ngModel",e.balanceAmount)}}function Yt(e,t){if(1&e){const e=m.Ub();m.Tb(0,"div",41),m.Pc(1,zt,15,2,"ul",4),m.Tb(2,"mat-form-field",42),m.Tb(3,"mat-label"),m.Rc(4,"Bill Amount"),m.Sb(),m.Tb(5,"input",43),m.bc("ngModelChange",(function(t){return m.Ec(e),m.fc().billAmount=t})),m.Sb(),m.Sb(),m.Pc(6,Ut,4,1,"mat-form-field",44),m.Pc(7,Et,4,1,"mat-form-field",44),m.Pc(8,jt,4,1,"mat-form-field",44),m.Pc(9,Ht,4,1,"mat-form-field",44),m.Sb()}if(2&e){const e=m.fc();m.Cb(1),m.mc("ngIf",e.isRejectedBills&&e.isApproveBills),m.Cb(4),m.mc("ngModel",e.billAmount),m.Cb(1),m.mc("ngIf",!e.isRejectedBills&&!e.isApproveBills),m.Cb(1),m.mc("ngIf",!e.isRejectedBills&&!e.isApproveBills),m.Cb(1),m.mc("ngIf",!e.isRejectedBills&&!e.isApproveBills),m.Cb(1),m.mc("ngIf",!e.isRejectedBills&&!e.isApproveBills)}}let Vt=(()=>{class e{constructor(e,t,i,l,n,o,a,s,r,c,u,d,m,h,p,f,g){var v,y,C,S;this.billService=e,this.billSettlementService=t,this.date=i,this.currencyPipe=l,this.decimalPipe=n,this.dialog=o,this.templateService=a,this.jwtHelperService=s,this.snackbar=r,this.masterService=c,this.registerService=u,this.cookieService=d,this.router=m,this.clientSelectionService=h,this.templatesService=p,this.ref=f,this.envService=g,this.role="",this._gap=16,this.gap=this._gap+"px",this.col2=`1 1 calc(50% - ${this._gap/2}px)`,this.col3=`1 1 calc(33.3333% - ${this._gap/1.5}px)`,this.tenants=[],this.billPeriods=[],this.billFeeTypes=[],this.billTypes=[],this.selectedRows=[],this.visibleButtons=[],this.columns=[],this.innerColumns=[],this.columnNames=[],this.billMasterDetails=[],this.billMasterToUpdateIsBillFailed=[],this.manageParams={},this.userActions=[],this.billFeeType="",this.billAmount="",this.receivedAmount="",this.creditNoteAmount="",this.netAmount="",this.balanceAmount="",this.parameterValue=!1,this.filePath="",this.userId="",this.disable=!1,this.disableColumn="paid",this.billNumberConsumptionColumnName="Bill No",this.buildingColumnName="Building",this.unitNumberColumnName="Unit Number",this.smsColumnName="SMS",this.emailColumnName="Email",this.watsappColumnName="Watsapp",this.dateFormat="",this.currency="",this.roundFormat="",this.consumptionRoundOffFormat="",this.billNumberColumnName="Bill Number",this.accountNumberColumnName="Account Number",this.tenantNameColumnName="Tenant Name",this.entityTypeColumnName="Owner/Tenant",this.unitColumnName="Unit",this.billDateColumnName="Bill Date",this.fromDateColumnName="From Date",this.toDateColumnName="To Date",this.dueDateColumnName="Due Date",this.billAmountColumnName="Bill Amount",this.creditNoteAmountColumnName="Credit Note Amount",this.netAmountColumnName="Net Bill Amount",this.paidColumnName="Paid",this.balanceAmountColumnName="Balance Amount",this.cancelColumnName="Cancel",this.utilityTypeCoulmnNmae="Utility Type",this.meterNumberCoulmnNmae="Meter Number",this.previousReadingColumnName="Previous",this.presentReadingColumnName="Present",this.currentConsumptionColumnName="Cur-Consumption",this.consumptionChargeColumnName="Consumption Charge",this.cssStyledColumn="status",this.buttonDisableColumn="isLatestBill",this.buttonName="Credit Note",this.approvedCount="",this.rejectedCount="",this.fineCount="",this.penalityCount="",this.pdfsToMerge=[],this.isApproveBills=!1,this.isRejectedBills=!1,this.pageSize=10,this.dataSource=new re.k([]),this.displayedColumns=[{name:this.billDateColumnName,property:"billDateLocal",visible:!0,isModelProperty:!0},{name:this.billNumberColumnName,property:"billNumber",visible:!0,isModelProperty:!0},{name:this.unitNumberColumnName,property:"unitNumber",visible:!0,isModelProperty:!0},{name:this.netAmountColumnName,property:"netAmountLocal",visible:!0,isModelProperty:!1},{name:"Actions",property:"actions",visible:!0}],this.filePath=g.backendForFiles,this.dateFormat=null!==(v=Object(b.e)("DateFormat"))&&void 0!==v?v:g.dateFormat,this.currency=null!==(y=Object(b.e)("Currency"))&&void 0!==y?y:g.currencyFormat,this.roundFormat=null!==(C=Object(b.e)("RoundOff"))&&void 0!==C?C:g.roundOffFormat,this.consumptionRoundOffFormat=null!==(S=Object(b.e)("ConsumptionRoundOff"))&&void 0!==S?S:g.consumptionRoundOffFormat}set content(e){this.sort=e,this.dataSource&&this.sort&&(this.dataSource.sort=this.sort)}get visibleColumns(){return this.displayedColumns.filter(e=>e.visible).map(e=>e.property)}ngOnInit(){this.columnsProps=this.displayedColumns.map(e=>e.property),this.clientId=parseInt(this.cookieService.get("globalClientId")),this.router.snapshot.url.toString().includes("approve-bills")?this.isApproveBills=!0:this.router.snapshot.url.toString().includes("rejected-bills")&&(this.isRejectedBills=!0);let e=this.cookieService.get("access_token");const t=this.jwtHelperService.decodeToken(e);t&&(this.role=t["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"],this.userId=t["http://schemas.xmlsoap.org/ws/2005/05/identity/claims/sid"],this.getUserEnabledActions()),this.masterService.getParameterValue("BillHistoryNotifications").subscribe(e=>{this.parameterValue=e}),this.ownerId=parseInt(this.cookieService.get("ownerId")),this.ownerId>0?(this.clientSelectionService.setIsClientVisible(!1),this.onGetBillsHistory(this.manageParams)):this.clientSelectionService.setIsClientVisible(!0),this.getTenants(),this.getBillPeriods(),this.getBillFeeTypes(),this.getBillTypes(),this.createColumnNames(),this.createGridColumns(),this.createInnerGridColumns(),this.addVisibleButtons()}createGridColumns(){this.columns=0!=this.ownerId||this.isRejectedBills||this.isApproveBills?0==this.ownerId&&(this.isRejectedBills||this.isApproveBills)?["select","billDateLocal","billNumber","accountNumber","ownerName","unitNumber","fromDateLocal","toDateLocal","dueDateLocal","billAmountLocal","button","action"]:["select","billDateLocal","billNumber","unitNumber","netAmountLocal","action"]:["select","billDateLocal","billNumber","accountNumber","ownerName","unitNumber","fromDateLocal","toDateLocal","dueDateLocal","billAmountLocal","creditNoteAmountLocal","netAmountLocal","paidLocal","balanceAmountLocal","button","action"]}createInnerGridColumns(){this.innerColumns=["utilityType","deviceName","previousReadingLocal","presentReadingLocal","consumptionLocal","consumptionCharge"]}createColumnNames(){this.columnNames=[{name:this.billNumberColumnName,property:"billNumber",visible:!0,isModelProperty:!0},{name:this.accountNumberColumnName,property:"accountNumber",visible:!0,isModelProperty:!0},{name:this.tenantNameColumnName,property:"ownerName",visible:!0,isModelProperty:!0},{name:this.entityTypeColumnName,property:"entityType",visible:!0,isModelProperty:!0},{name:this.unitColumnName,property:"unitNumber",visible:!0,isModelProperty:!0},{name:this.fromDateColumnName,property:"fromDateLocal",visible:!0,isModelProperty:!0},{name:this.toDateColumnName,property:"toDateLocal",visible:!0,isModelProperty:!0},{name:this.dueDateColumnName,property:"dueDateLocal",visible:!0,isModelProperty:!0},{name:this.billDateColumnName,property:"billDateLocal",visible:!0,isModelProperty:!0},{name:this.billAmountColumnName,property:"billAmountLocal",visible:!0,isModelProperty:!0,columnAlign:{"text-align":"right"}},{name:this.paidColumnName,property:"paidLocal",visible:!0,isModelProperty:!0,columnAlign:{"text-align":"right"}},{name:this.utilityTypeCoulmnNmae,property:"utilityType",visible:!0,isModelProperty:!1},{name:this.meterNumberCoulmnNmae,property:"deviceName",visible:!0,isModelProperty:!1},{name:this.previousReadingColumnName,property:"previousReadingLocal",visible:!0,isModelProperty:!1},{name:this.presentReadingColumnName,property:"presentReadingLocal",visible:!0,isModelProperty:!1},{name:this.currentConsumptionColumnName,property:"consumptionLocal",visible:!0,isModelProperty:!1,columnAlign:{"text-align":"right"}},{name:this.billAmountColumnName,property:"amountLocal",visible:!0,isModelProperty:!1,columnAlign:{"text-align":"right"}},{name:this.creditNoteAmountColumnName,property:"creditNoteAmountLocal",visible:!0,isModelProperty:!1,columnAlign:{"text-align":"right"}},{name:this.netAmountColumnName,property:"netAmountLocal",visible:!0,isModelProperty:!1,columnAlign:{"text-align":"right"}},{name:this.consumptionChargeColumnName,property:"consumptionCharge",visible:!0,isModelProperty:!1,columnAlign:{"text-align":"right"}},{name:this.balanceAmountColumnName,property:"balanceAmountLocal",visible:!0,isModelProperty:!1,columnAlign:{"text-align":"right"}}]}addVisibleButtons(){this.visibleButtons=[],this.visibleButtons=this.isApproveBills?[{property:"print"},{property:"reject"},{property:"fail"}]:this.isRejectedBills?[{property:"print"},{property:"remarks"}]:[{property:"modify"},{property:"print"},{property:"cancel"}]}getUserEnabledActions(){this.userActions=[],this.registerService.getUserEnabledActions(this.userId).subscribe({next:e=>{this.userActions=e},error:e=>{this.notificationMessage("User Actions not found","red-snackbar")}})}onGetBillsHistory(e){this.manageParams=e,this.billMasterDetails=[],this.billAmount="",this.receivedAmount="",this.rejectedCount="",this.approvedCount="",this.fineCount="",this.penalityCount="";let t=0,i=0,l=0,n=0,o=0;e.fromDate=""==e.fromDate?"":R(e.fromDate).format("YYYY-MM-DD"),e.toDate=""==e.toDate?"":R(e.toDate).format("YYYY-MM-DD"),e.tenantId="External"==this.role?this.ownerId.toString():e.tenantId,e.clientId=this.clientId,this.billService.getBillHistory(e).subscribe(e=>{var a,s,r,c;if(e=e.filter(e=>null!=e.billNumber&&""!=e.billNumber),this.isApproveBills&&!this.isRejectedBills?e=e.filter(e=>!1===e.isApproved&&!1===e.isRejected):this.isApproveBills||this.isRejectedBills?this.isRejectedBills&&(e=e.filter(e=>!0===e.isRejected)):e=e.filter(e=>!0===e.isApproved&&!1===e.isRejected),e=e.filter(e=>!1===e.isBillFailed),this.dateFormat=Object(b.e)("DateFormat"),this.roundFormat=Object(b.e)("RoundOff"),this.currency=Object(b.e)("Currency"),e.forEach(e=>{e.billDateLocal=this.date.transform(e.billDate.toString(),this.dateFormat.toString()),e.fromDateLocal=this.date.transform(e.fromDate.toString(),this.dateFormat.toString()),e.toDateLocal=this.date.transform(e.toDate.toString(),this.dateFormat.toString()),e.dueDateLocal=this.date.transform(e.dueDate.toString(),this.dateFormat.toString()),e.billAmountLocal=this.currencyPipe.transform(e.billAmount,this.currency.toString(),!0,this.roundFormat),e.paidLocal=this.currencyPipe.transform(e.paid,this.currency.toString(),!0,this.roundFormat),e.creditNoteAmountLocal=this.currencyPipe.transform(e.creditNoteAmount,this.currency.toString(),!0,this.roundFormat),e.netAmountLocal=this.currencyPipe.transform(e.netAmount,this.currency.toString(),!0,this.roundFormat),e.balanceAmountLocal=this.currencyPipe.transform(e.balanceAmount,this.currency.toString(),!0,this.roundFormat),e.bills.forEach(e=>{this.consumptionRoundOffFormat=Object(b.e)("ConsumptionRoundOff",e.utilityTypeId),e.previousReadingLocal=this.decimalPipe.transform(e.previousReading,this.consumptionRoundOffFormat),e.presentReadingLocal=this.decimalPipe.transform(e.presentReading,this.consumptionRoundOffFormat),e.consumptionLocal=this.decimalPipe.transform(e.consumption,this.consumptionRoundOffFormat),e.billAmountLocal=e.consumptionCharge=this.currencyPipe.transform(e.billAmount,this.currency.toString(),!0,this.roundFormat)}),(this.isApproveBills||this.isRejectedBills)&&(e.status="Normal"),t+=e.billAmount,l+=e.creditNoteAmount,n+=e.netAmount,i+=e.paid,o+=e.balanceAmount}),this.billMasterDetails=e,this.dataSource=new re.k(this.billMasterDetails),this.ref.detectChanges(),this.dataSource&&(this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort),this.billAmount=this.currencyPipe.transform(t,this.currency.toString(),!0,this.roundFormat),this.creditNoteAmount=this.currencyPipe.transform(l,this.currency.toString(),!0,this.roundFormat),this.netAmount=this.currencyPipe.transform(n,this.currency.toString(),!0,this.roundFormat),this.receivedAmount=this.currencyPipe.transform(i,this.currency.toString(),!0,this.roundFormat),this.balanceAmount=this.currencyPipe.transform(o,this.currency.toString(),!0,this.roundFormat),this.billMasterDetails&&this.billMasterDetails.length){const e=null!==(a=this.billMasterDetails.filter(e=>"Approved"===e.status).length)&&void 0!==a?a:0;this.approvedCount="- "+e.toString();const t=null!==(s=this.billMasterDetails.filter(e=>"Rejected"===e.status).length)&&void 0!==s?s:0;this.rejectedCount="- "+t.toString();const i=null!==(r=this.billMasterDetails.filter(e=>"Fine"===e.status).length)&&void 0!==r?r:0;this.fineCount="- "+i.toString();const l=null!==(c=this.billMasterDetails.filter(e=>"Penalty"===e.status).length)&&void 0!==c?c:0;this.penalityCount="- "+l.toString()}})}onSelectedRows(e){this.selectedRows=[],this.selectedRows=e,this.disable=!1,this.selectedRows&&this.selectedRows.length&&this.selectedRows.find(e=>1==e.isApproved)&&(this.disable=!0)}getBillPeriods(){this.billPeriods=[{label:"Select",value:0}],this.billService.getBillPeriods(this.clientId).subscribe(e=>{e.forEach(e=>{this.billPeriods.push({label:e.periodDescription,value:e.id})})})}getTenants(){this.billSettlementService.getTenantsDetails(this.clientId).subscribe(e=>{this.tenants=e})}getBillFeeTypes(){this.billFeeTypes=[{label:"Select",value:0}],this.masterService.getSystemMasterdata(64,0).subscribe(e=>{e.forEach(e=>{this.billFeeTypes.push({label:e.description,value:e.id})})})}getBillTypes(){this.billTypes=[{label:"Select",value:0}],this.masterService.getSystemMasterdata(29,0).subscribe(e=>{e.forEach(e=>{this.billTypes.push({label:e.description,value:Number(e.defaultValue)})})})}onBillFeeTypeChange(e){this.billHistoryFooterToolbarComponent&&(this.billHistoryFooterToolbarComponent.billFeeType=e)}onViewDataRow(e){this.dialog.open(v,{data:e}).afterClosed().subscribe()}onDeleteDataRow(e){e.type="Cancel",e.contractNotExist?this.notificationMessage("Can't cancel this Bill due to corresponding contract is suspended or closed","red-snackbar"):e.creditNoteAmount>0?this.notificationMessage("Can't cancel this Bill due to credit note exist","red-snackbar"):this.dialog.open(Ee,{data:e}).afterClosed().subscribe(()=>{e&&this.onGetBillsHistory(this.manageParams)})}onSendNotifications(){this.getClientAlertSettings()}onPrintPdf(){return Object(r.a)(this,void 0,void 0,(function*(){this.selectedRows&&this.selectedRows.length?this.invoiceView(this.selectedRows):this.notificationMessage("Please select Bills.","red-snackbar")}))}invoiceView(e){this.billService.invoiceView(e).subscribe({next:e=>{e?this.downloadFile(e):this.notificationMessage("No data to print","red-snackbar")},error:e=>{this.notificationMessage("No data to print","red-snackbar")}})}base64ToArrayBuffer(e){for(var t=window.atob(e),i=t.length,l=new Uint8Array(i),n=0;n<i;n++)l[n]=t.charCodeAt(n);return l.buffer}downloadReport(e){return Object(r.a)(this,void 0,void 0,(function*(){this.invoiceView([e])}))}downloadFile(e){return Object(r.a)(this,void 0,void 0,(function*(){const t=yield G.PDFDocument.create();for(const o of e){const e=yield G.PDFDocument.load(o);(yield t.copyPages(e,e.getPageIndices())).forEach(e=>{t.addPage(e)})}const i=yield t.save(),l=new Blob([i],{type:"application/pdf"}),n=window.URL.createObjectURL(l);window.open(n)}))}downloadBillReport(e){let t=[],i=[],l=[],n=[],o=[];if(e.bills.forEach(l=>{l.billTransactions&&l.billTransactions.length&&l.billTransactions.forEach(n=>{t.push(n.headDisplay),t.push(e.fromDateLocal),t.push(e.toDateLocal),"BTU"===l.utilityType&&n.measuringUnitId&&2===n.measuringUnitId?(t.push(this.decimalPipe.transform(.284345*l.previousReading,this.roundFormat)+" TR-HR"),t.push(this.decimalPipe.transform(.284345*l.presentReading,this.roundFormat)+" TR-HR"),t.push(this.decimalPipe.transform(.284345*l.consumption,this.roundFormat)+" TR-HR")):(t.push(l.previousReading+" "+l.measuringUnit),t.push(l.presentReading+" "+l.measuringUnit),t.push(l.consumption+" "+l.measuringUnit)),t.push(n.rate),t.push(this.decimalPipe.transform(n.headAmount,this.roundFormat)),i.push(t),t=[]})}),e.billCharges&&e.billCharges.length){e.billCharges.sort((e,t)=>e.position-t.position).forEach(e=>{if("VAT"!==e.headDisplay){const t=l.find(t=>t.label===e.headDisplay);t?t.value+=e.headAmount:l.push({label:e.headDisplay,value:e.headAmount})}});for(let e=0;e<l.length;e++)t.push(l[e].label),t.push(""),t.push(""),t.push(""),t.push(""),t.push(""),t.push(""),t.push(this.decimalPipe.transform(l[e].value,this.roundFormat)),i.push(t),t=[]}let a="";e.bills.forEach(e=>{a+=e.deviceName+","}),n.push({label:"Account Number:",value:e.accountNumber},{label:"Meter Number:",value:a.slice(0,-1)},{label:"Unit Number:",value:e.unitNumber},{label:"Billing Date:",value:e.billDateLocal},{label:"Due Date:",value:e.dueDateLocal},{label:"Bill Period",value:`${Object(b.f)(e.fromDateLocal)} - ${Object(b.f)(e.toDateLocal)} `});let s=0;if(i.forEach(e=>{s+=Number(e[7].replace(",",""))}),o.push({label:"Current Month Total:",value:this.currencyPipe.transform(s,this.currency.toString(),!0,this.roundFormat)}),e.billDiscounts&&e.billDiscounts.length){let t=0;e.billDiscounts.forEach(e=>{t+=e.headAmount}),o.push({label:"Total Discount",value:this.currencyPipe.transform(t,this.currency.toString(),!0,this.roundFormat)})}e.billTaxDetails&&e.billTaxDetails.length?e.billTaxDetails.forEach(e=>{o.push({label:e.taxDisplayName,value:this.currencyPipe.transform(e.taxAmount,this.currency.toString(),!0,this.roundFormat)})}):o.push({label:"TAX:",value:this.currencyPipe.transform(0,this.currency.toString(),!0,this.roundFormat)}),o.push({label:"Current Month + TAX:",value:e.billAmountLocal},{label:"Previous Bill Outstanding Balance:",value:this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)},{label:"Total Due incl TAX:",value:this.currencyPipe.transform(e.billAmount+e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)}),this.getBillReport(e,["Services Description","From","To","Previous","Current","Consumption","Rate ","Charges"],i,l,["Customer Id","Billing Period","Total for current period"],[],[{value:"",value1:"Bill Period",value2:"Meter Reading",value3:"",value4:""}],n,o,"Invoice")}addImage(e,t){var i;try{if(t&&t.client&&t.client.imageProperties&&t.client.imageProperties.length){const n=t.client.imageProperties.find(e=>"invoice"===e.imageType.trim().toLowerCase());if(n){var l=new Image;l.src=this.filePath+"/uploads/"+(null===(i=null==t?void 0:t.client)||void 0===i?void 0:i.photo),l.onload=function(){e.addImage(l,n.imgX,n.imgY,n.imgW,n.imgH)}}else this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar")}else this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar")}catch(n){this.notificationMessage("Image not found.","red-snackbar")}return e}getBillReport(e,t,i,l,n,o,a,s,r,c){var u,d,m,h,p,f,g,v,y,C,S,T,P,D,w,N,x,A,F,R,k,I,O,W,M;let L=new fe.default({orientation:"portrait",unit:"pt",format:"letter"});L.rect(5,5,L.internal.pageSize.width-10,L.internal.pageSize.height-10,"S"),L.setFontSize(30),L=this.addImage(L,e),L.setTextColor(0,0,0),L.setFontSize(16),L.setFont("Cambria","bold"),L.text("Tax Invoice",260,30),L.setFontSize(13),L.setFont("Cambria","normal"),L.text(e.client.clientName.toUpperCase(),10,60),L.setFontSize(10),L.setFont("Cambria"),L.text("TRN: "+e.client.trnNo,10,70),L.text("PO Box "+e.client.addresses[0].zipPostalCode,10,80),L.text(e.client.addresses[0].address1+","+e.client.addresses[0].country,10,90),L.text("Phone: "+e.client.phoneNo,10,100),L.text("Email: "+e.client.email+", Web: "+e.client.website,10,110),L.setFillColor(241,241,244),L.setDrawColor(206,203,203),L.rect(10,120,350,90,"FD"),L.setTextColor(0,0,0),L.setFontSize(12),L.text(null==e?void 0:e.ownerName.toUpperCase(),20,135),L.text("CUSTOMER TRN: "+e.trn,20,155),L.text("unit #"+e.unitNumber,20,170),L.setFontSize(10),L.text(e.clientName,20,185),L.text(Object(b.f)(null===(u=null==e?void 0:e.client)||void 0===u?void 0:u.buildingName,",")+Object(b.f)(null===(m=null===(d=null==e?void 0:e.client)||void 0===d?void 0:d.addresses[0])||void 0===m?void 0:m.location,",")+Object(b.f)(null===(p=null===(h=null==e?void 0:e.client)||void 0===h?void 0:h.addresses[0])||void 0===p?void 0:p.city,",")+Object(b.f)(null===(g=null===(f=null==e?void 0:e.client)||void 0===f?void 0:f.addresses[0])||void 0===g?void 0:g.country,","),20,200),L.setFontSize(9),L.setLineWidth(.1),L.line(5,265,607,265),L.setFontSize(10),L.setFont("bold"),L.text("Invoice#: ".toUpperCase(),390,110),L.setTextColor(25,118,210);const B=L.getTextWidth("Invoice#: ");let z="";(null==e?void 0:e.billNumber)&&(z=null===(v=e.billNumber)||void 0===v?void 0:v.toUpperCase()),L.text(z,410+B,110),L.setFont("none"),L.setTextColor(0,0,0),L.setFontSize(9),L.autoTable("",s,{startX:210,startY:120,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:390},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:80,halign:"left"},1:{cellWidth:130,halign:"right"}},didParseCell:function(e){const t=e.column.index;0!=t&&1!=t||(e.cell.styles.rowHeight=1)},headStyles:{lineWidth:.1,lineColor:[0,0,0]}}),L.autoTable("",a,{startX:10,startY:220,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:220,left:10},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,fontStyle:"bold",halign:"center"},1:{cellWidth:160,fontStyle:"bold",halign:"center"},2:{cellWidth:120,fontStyle:"bold",halign:"center"},3:{cellWidth:75,fontStyle:"bold",halign:"center"},4:{cellWidth:135,fontStyle:"bold",halign:"center"}},didParseCell:function(e){const t=e.column.index;0!=t&&1!=t||(e.cell.styles.rowHeight=1)},headStyles:{lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]}});const U=Number(this.decimalPipe.transform(L.autoTable.previous.finalY,"1.0-0"));L.autoTable(t,i,{startX:10,startY:U,didDrawPage:function(e){var t="Page "+e.pageCount;"function"==typeof L.putTotalPages&&(t+=" of 1",L.rect(5,5,L.internal.pageSize.width-10,L.internal.pageSize.height-10,"S")),L.setFontSize(9);var i=L.internal.pageSize.height||L.internal.pageSize.getHeight();L.text(t,e.settings.margin.left,i-10)},styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:U,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:80,halign:"center"},2:{cellWidth:80,halign:"center"},3:{cellWidth:60,halign:"center"},4:{cellWidth:60,halign:"center"},5:{cellWidth:75,halign:"center"},6:{cellWidth:60,halign:"right"},7:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=s.length>12?1.5:2}}),L.setTextColor(0,0,0);const E=Number(this.decimalPipe.transform(L.autoTable.previous.finalY,"1.0-0"));L.setTextColor(25,118,210),L.setFontSize(12),L.text("Bank Payment Account Details",10,E+20),L.setTextColor(0,0,0),L.setFontSize(9),L.text("Account Title: "+Object(b.f)(null===(C=null===(y=null==e?void 0:e.client)||void 0===y?void 0:y.bankDetails[0])||void 0===C?void 0:C.accountName),10,E+40),L.text("Account #: "+Object(b.f)(null===(T=null===(S=null==e?void 0:e.client)||void 0===S?void 0:S.bankDetails[0])||void 0===T?void 0:T.accountNo),10,E+50),L.text("IBAN #: "+Object(b.f)(null===(D=null===(P=null==e?void 0:e.client)||void 0===P?void 0:P.bankDetails[0])||void 0===D?void 0:D.ibanNumber),10,E+60),L.text("Bank Name: "+Object(b.f)(null===(N=null===(w=null==e?void 0:e.client)||void 0===w?void 0:w.bankDetails[0])||void 0===N?void 0:N.bankName),10,E+70),L.text("Swift Code: "+ +Object(b.f)(null===(A=null===(x=null==e?void 0:e.client)||void 0===x?void 0:x.bankDetails[0])||void 0===A?void 0:A.swiftCode),10,E+80),L.setFontSize(9),L.autoTable("",r,{startX:300,startY:E+20,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:320},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:180,halign:"left"},1:{cellWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"}});const j=Number(this.decimalPipe.transform(L.autoTable.previous.finalY,"1.0-0"));L.setTextColor(255,0,0),L.text(`Note: A Late Fee will be applied after the due date. A Default Payment \nPenalty will be added to any unit that is ${Object(b.f)(null===(F=null==e?void 0:e.penaltyAfter)||void 0===F?void 0:F.toString())} days or more in arrears.`,320,j+10),L.setTextColor(25,118,210),L.setFontSize(12),L.text("USAGE TIPS to reduce consumption:",10,j+10),L.text("Please Try to:",10,j+30),L.setTextColor(0,0,0),L.setFontSize(9),L.text("- Keep filters clean",30,j+40),L.text("- Set thermostats between 23C and 25C",30,j+50),L.text("- Keep vents unblocked",30,j+60),L.text("- Keep doors and windows closed",30,j+70),L.text("- Undertake regular maintenance of the system",30,j+80),L.setTextColor(25,118,210),L.setFontSize(12),L.text("Please Do Not:",10,j+100),L.setTextColor(0,0,0),L.setFontSize(9),L.text("- Set thermostats to 20C or lower",30,j+110),L.text("- Block vents",30,j+120),L.text("- Leave doors and windows open",30,j+130),L.text("- Leave heat producing appliances near thermostats",30,j+140),L.setFillColor(119,183,11);var H=L.internal.pageSize.height||L.internal.pageSize.getHeight();L.rect(320,j+30,280,H-80-(j+30),"FD"),L.setFont("Comic Sans"),L.setTextColor(255,255,255),L.setFontSize(16),L.text("ADVERTISE WITH US",360,j+50);const Y=L.getTextWidth("ADVERTISE WITH US");L.setLineWidth(.1),L.line(360,j+55,360+Y,j+55),L.setFontSize(9),L.text("For advertisement, contact at",390,j+65),L.text(Object(b.f)(null===(R=null==e?void 0:e.client)||void 0===R?void 0:R.phoneNo),390,j+75),L.text(Object(b.f)(null===(k=null==e?void 0:e.client)||void 0===k?void 0:k.email),390,j+85),L.text(Object(b.f)(null===(I=null==e?void 0:e.client)||void 0===I?void 0:I.website),390,j+95),L.setTextColor(0,0,0),L.setLineWidth(.1),L.line(5,H-70,607,H-70),L.text(`For any enquiries, write to us ${Object(b.f)(null===(O=null==e?void 0:e.client)||void 0===O?void 0:O.email)} \nor Logon to ${Object(b.f)(null===(W=null==e?void 0:e.client)||void 0===W?void 0:W.website)}`,10,H-60),L.setTextColor(255,0,0),L.setFont("bold");const V=L.getTextWidth("Notice:");L.text("Notice:",340,H-60),L.setFont("none"),L.setTextColor(0,0,0),L.text("Pay your bills before due date to avoid late payment surcharge",340+V,H-60),L.text("and disconnection.",340,H-50),L.text(`You can log onto ${Object(b.f)(null===(M=null==e?void 0:e.client)||void 0===M?void 0:M.website)} to pay your invoices \nTerms & Conditions for Supply of Utility Services`,340,H-40);var _=L.output("datauristring");this.pdfsToMerge.push(_)}downloadBillTaiffDetailsReport(e){var t,i,l,n,o,a;let s=[],r=[],c=[],u=[],d=[],m=[];for(let g=0;g<e.bills.length;g++)if(this.consumptionRoundOffFormat=null!==(t=Object(b.e)("ConsumptionRoundOff",e.bills[g].utilityTypeId))&&void 0!==t?t:this.envService.consumptionRoundOffFormat,s.push(e.bills[g].utilityType+"-"+e.bills[g].deviceName),s.push(e.fromDateLocal+" - "+e.toDateLocal),s.push(this.decimalPipe.transform(e.bills[g].previousReading,this.consumptionRoundOffFormat)),s.push(this.decimalPipe.transform(e.bills[g].presentReading,this.consumptionRoundOffFormat)),s.push(e.bills[g].billAmount),r.push(s),s=[],e.bills[g].billTariffDetails&&e.bills[g].billTariffDetails.length){s.push("Week Type"),s.push("Peak Type"),s.push("Consumption (KWH)"),s.push("Rate"),s.push("Amount"),r.push(s),s=[];const t=e.bills[g].billTariffDetails;for(let e=0;e<t.length;e++)s.push(null===(i=t[e])||void 0===i?void 0:i.weekType),s.push(null===(l=t[e])||void 0===l?void 0:l.peakType),s.push(null===(n=t[e])||void 0===n?void 0:n.consumption),s.push(null===(o=t[e])||void 0===o?void 0:o.rate),s.push(null===(a=t[e])||void 0===a?void 0:a.amount),r.push(s),s=[]}if(e.bills.forEach(e=>{if(e.billTransactions&&e.billTransactions.length){const t=["consumption","consumptioncharge"];e.billTransactions.forEach(e=>{if(!t.includes(e.headDisplay.toLowerCase())){const t=c.find(t=>t.label===e.headDisplay);t?t.value+=e.headAmount:c.push({label:e.headDisplay,value:e.headAmount})}})}}),e.billCharges&&e.billCharges.length){e.billCharges.sort((e,t)=>e.position-t.position).forEach(e=>{if("VAT"!==e.headDisplay){const t=c.find(t=>t.label===e.headDisplay);t?t.value+=e.headAmount:c.push({label:e.headDisplay,value:e.headAmount})}});for(let e=0;e<c.length;e++)s.push(c[e].label),s.push(""),s.push(""),s.push(""),s.push(this.decimalPipe.transform(c[e].value,this.roundFormat)),r.push(s),s=[]}u.push({label:"Billing Period",value:"Meter Reading"});let h="";e.bills.forEach(e=>{h+=e.deviceName+","}),d.push({label:"Account Number:",value:e.accountNumber},{label:"Meter Number:",value:h.slice(0,-1)},{label:"Unit Number:",value:e.unitNumber},{label:"Billing Date:",value:e.billDateLocal},{label:"Due Date:",value:e.dueDateLocal},{label:"Bill Period",value:`${Object(b.f)(e.fromDateLocal)} - ${Object(b.f)(e.toDateLocal)} `});const p=e.billCharges.find(e=>"VAT"===e.headDisplay);let f=0;r.forEach(e=>{f+=Number(e[7].replace(",",""))}),m.push({label:"Current Month Total:",value:this.currencyPipe.transform(f,this.currency.toString(),!0,this.roundFormat)},{label:"VAT 5%:",value:this.currencyPipe.transform(null==p?void 0:p.headAmount,this.currency.toString(),!0,this.roundFormat)},{label:"Current Month + VAT:",value:e.billAmountLocal},{label:"Previous Bill Outstanding Balance:",value:this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)},{label:"Total Due incl VAT:",value:this.currencyPipe.transform(e.billAmount+e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)}),this.getBillTaiffDetailsReport(e,["Services Description","From - To","Previous","Current","Charges"],r,c,["Customer Id","Billing Period","Total for current period"],[],u,d,m,"Invoice")}getBillTaiffDetailsReport(e,t,i,l,n,o,a,s,r,c){var u,d=new Image;d.src=this.filePath+"/uploads/"+e.client.photo;var m=new Image;m.src="assets/img/lu.JPG";let h=new fe.default({orientation:"portrait",unit:"pt",format:"letter"});h.rect(5,5,h.internal.pageSize.width-10,h.internal.pageSize.height-10,"S"),h.setFontSize(30),h.addImage(d,"png",5,5,190,d.height),h.addImage(m,"png",547,10,56,56),h.setTextColor(0,0,0),h.setFontSize(14),h.setFont("Cambria"),h.text("Tax Invoice",260,30),h.setFontSize(9),h.setTextColor(25,118,210),h.setFont("Cambria","bold"),h.text(e.client.clientName,10,60),h.setFont("Cambria","normal"),h.text("TRN: "+e.client.trnNo,10,70),h.text("PO Box "+e.client.addresses[0].zipPostalCode,10,80),h.text(e.client.addresses[0].address1+","+e.client.addresses[0].country,10,90),h.text("Phone: "+e.client.phoneNo,10,100),h.text("Email: "+e.client.email+", Web: "+e.client.website,10,110),h.setFillColor(241,241,244),h.setDrawColor(206,203,203),h.rect(10,120,300,90,"FD"),h.setTextColor(0,0,0),h.setFontSize(12),h.text(null==e?void 0:e.ownerName.toUpperCase(),20,135),h.text("CUSTOMER TRN: "+e.trn,20,155),h.text("unit #"+e.unitNumber,20,170),h.setFontSize(10),h.text(e.clientName,20,185),h.text("Al Barsha 1, Dubai, UAE",20,200),h.setFontSize(9),h.setLineWidth(.1),h.line(5,265,607,265),h.setFontSize(10),h.setFont("bold"),h.text("Invoice#: ".toUpperCase(),390,110),h.setTextColor(25,118,210);const b=h.getTextWidth("Invoice#: ");let p="";(null==e?void 0:e.billNumber)&&(p=null===(u=e.billNumber)||void 0===u?void 0:u.toUpperCase()),h.text(p,410+b,110),h.setFont("none"),h.setTextColor(0,0,0),h.setFontSize(9),h.autoTable("",s,{startX:210,startY:120,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:390},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:80,halign:"left"},1:{cellWidth:130,halign:"right"}},didParseCell:function(e){const t=e.column.index;0!=t&&1!=t||(e.cell.styles.rowHeight=1)},headStyles:{lineWidth:.1,lineColor:[0,0,0]}}),h.autoTable("",a,{startX:10,startY:220,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:220,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:500,fontStyle:"bold"},1:{cellWidth:90,fontStyle:"bold",halign:"right"}},didParseCell:function(e){const t=e.column.index;0!=t&&1!=t||(e.cell.styles.rowHeight=1)},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});const f=Number(this.decimalPipe.transform(h.autoTable.previous.finalY,"1.0-0"));h.autoTable(t,i,{startX:10,startY:f,didDrawPage:function(e){var t="Page "+e.pageCount;"function"==typeof h.putTotalPages&&(t+=" of 1",h.rect(5,5,h.internal.pageSize.width-10,h.internal.pageSize.height-10,"S")),h.setFontSize(9);var i=h.internal.pageSize.height||h.internal.pageSize.getHeight();h.text(t,e.settings.margin.left,i-10)},styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:f,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:150,halign:"center"},1:{cellWidth:150,halign:"center"},2:{cellWidth:100,halign:"right"},3:{cellWidth:100,halign:"right"},4:{cellWidth:90,halign:"right"}},didParseCell:function(e){const t=e.cell.raw;"Week Type"!==t&&"Peak Type"!==t&&"Consumption (KWH)"!==t&&"Rate"!==t&&"Amount"!==t||(e.cell.styles.fontStyle="bold",e.cell.styles.textColor=[255,255,255],e.cell.styles.fillColor=[25,118,210])},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]}}),h.setTextColor(0,0,0);const g=Number(this.decimalPipe.transform(h.autoTable.previous.finalY,"1.0-0"));h.setTextColor(25,118,210),h.setFontSize(12),h.text("Bank Payment Account Details",10,g+20),h.setTextColor(0,0,0),h.setFontSize(9),h.text("Account Title: LOGIC UTILITIES DISTRICT COOLING SERVICES L.L.C",10,g+40),h.text("Account #: 019100074892",10,g+50),h.text("IBAN #: AE54 0330 0000 1910 0074 892",10,g+60),h.text("Bank Name: MASHREQ BANK - DUBAI MALL BRANCH",10,g+70),h.text("Swift Code: BOMLAEAD",10,g+80),h.setFontSize(9),h.autoTable("",r,{startX:300,startY:g+20,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:320},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:180,halign:"left"},1:{cellWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"}});const v=Number(this.decimalPipe.transform(h.autoTable.previous.finalY,"1.0-0"));h.setTextColor(255,0,0),h.text(`Note: A Late Fee will be applied after the due date. A Default Payment \nPenalty will be added to any unit that is ${e.penaltyAfter} days or more in arrears.`,320,v+10),h.setTextColor(25,118,210),h.setFontSize(12),h.text("USAGE TIPS to reduce consumption:",10,v+10),h.text("Please Try to:",10,v+30),h.setTextColor(0,0,0),h.setFontSize(9),h.text("- Keep filters clean",30,v+40),h.text("- Set thermostats between 23C and 25C",30,v+50),h.text("- Keep vents unblocked",30,v+60),h.text("- Keep doors and windows closed",30,v+70),h.text("- Undertake regular maintenance of the system",30,v+80),h.setTextColor(25,118,210),h.setFontSize(12),h.text("Please Do Not:",10,v+100),h.setTextColor(0,0,0),h.setFontSize(9),h.text("- Set thermostats to 20C or lower",30,v+110),h.text("- Block vents",30,v+120),h.text("- Leave doors and windows open",30,v+130),h.text("- Leave heat producing appliances near thermostats",30,v+140),h.setFillColor(119,183,11);var y=h.internal.pageSize.height||h.internal.pageSize.getHeight();h.rect(320,v+30,280,y-80-(v+30),"FD"),h.setFont("Comic Sans"),h.setTextColor(255,255,255),h.setFontSize(16),h.text("ADVERTISE WITH US",360,v+50);const C=h.getTextWidth("ADVERTISE WITH US");h.setLineWidth(.1),h.line(360,v+55,360+C,v+55),h.setFontSize(9),h.text("For advertisement, contact at",390,v+65),h.text("800 Logic (56442)",390,v+75),h.text("enquiry@logicutilities.com",390,v+85),h.text("www.logicutilities.com",390,v+95),h.setTextColor(0,0,0),h.setLineWidth(.1),h.line(5,y-70,607,y-70),h.text("For any enquiries, write to us enquiry@logicutilities.com \nor Logon to www.logicutilites.com",10,y-60),h.setTextColor(255,0,0),h.setFont("bold");const S=h.getTextWidth("Notice:");h.text("Notice:",340,y-60),h.setFont("none"),h.setTextColor(0,0,0),h.text("Pay your bills before due date to avoid late payment surcharge",340+S,y-60),h.text("and disconnection.",340,y-50),h.text("You can log onto www.logicutilites.com to pay your invoices \nTerms & Conditions for Supply of Utility Services",340,y-40);var T=h.output("datauristring");this.pdfsToMerge.push(T)}onPrintSummary(e){this.selectedRows&&this.selectedRows.length?"Normal"===e?this.billSummaryView(this.selectedRows):this.downloadDetailsSummary(this.selectedRows):this.notificationMessage("Please select Bills.","red-snackbar")}billSummaryView(e){this.billService.billSummaryView(e).subscribe({next:e=>{e?this.downloadSingelFile(e):this.notificationMessage("No data to print","red-snackbar")},error:e=>{this.notificationMessage("No data to print","red-snackbar")}})}downloadSingelFile(e){return Object(r.a)(this,void 0,void 0,(function*(){const t=yield G.PDFDocument.create(),i=yield G.PDFDocument.load(e);(yield t.copyPages(i,i.getPageIndices())).forEach(e=>{t.addPage(e)});const l=yield t.save(),n=new Blob([l],{type:"application/pdf"}),o=window.URL.createObjectURL(n);window.open(o)}))}downloadSummary(e){let t=[],i=[],l=[],n=0,o=0;for(let a=0;a<e.length;a++)t.push(e[a].billNumber),t.push(e[a].accountNumber),t.push(e[a].ownerName),t.push(e[a].entityType),t.push(e[a].unitNumber),t.push(e[a].fromDateLocal),t.push(e[a].toDateLocal),t.push(e[a].dueDateLocal),t.push(e[a].billAmountLocal),t.push(e[a].paidLocal),i.push(t),n+=e[a].billAmount,o+=e[a].paid,t=[];l.push({label:"Total Amount",value1:n,value2:o});for(let a=0;a<l.length;a++)t.push(""),t.push(""),t.push(""),t.push(""),t.push(""),t.push(""),t.push(""),t.push(l[a].label),t.push(this.currencyPipe.transform(l[a].value1,this.currency.toString(),!0,this.roundFormat)),t.push(this.currencyPipe.transform(l[a].value2,this.currency.toString(),!0,this.roundFormat)),i.push(t),t=[];this.getSummaryReport(this.billMasterDetails,["Bill Number","Account Number","Tenant Name","Owner/Tenant","Unit","From Date","To Date ","Due Date ","Bill Amount","Paid"],i,"Bill History")}getSummaryReport(e,t,i,l){var n,o;const a=e.length%15;var s=new Image;s.src=this.filePath+"/uploads/"+(null===(o=null===(n=e[0])||void 0===n?void 0:n.client)||void 0===o?void 0:o.photo);let r=new fe.default({orientation:"landscape",unit:"pt",format:"letter"});const c=R().format("M/D/YYYY hh:mm:ss a");Number(this.decimalPipe.transform(r.autoTable.previous.finalY,"1.0-0")),r.autoTable(t,i,{startX:10,startY:110,didDrawPage:function(t){var i,l,n,o;if(r.setFontSize(30),r.setFontSize(30),s&&e[0]&&e[0].client&&e[0].client.imageProperties&&e[0].client.imageProperties.length){const t=null===(l=null===(i=e[0])||void 0===i?void 0:i.client)||void 0===l?void 0:l.imageProperties.find(e=>"landscape"===e.imageType.trim().toLowerCase());t&&(s.onload=function(){r.addImage(s,t.imgX,t.imgY,t.imgW,t.imgH)})}r.setTextColor(25,118,210),r.setFontSize(9),r.setFont("Cambria"),r.setTextColor(0,0,0),r.text("Print Date: "+c,r.internal.pageSize.width-150,20),r.setFontSize(14),r.text("Summary Report From "+Object(b.f)(null===(n=e[0])||void 0===n?void 0:n.fromDateLocal)+" To "+Object(b.f)(null===(o=e[0])||void 0===o?void 0:o.toDateLocal),r.internal.pageSize.width/2-140,90),r.setFontSize(9);var u="Page "+t.pageCount;"function"==typeof r.putTotalPages&&(r.setTextColor(0,0,0),r.rect(5,5,r.internal.pageSize.width-10,r.internal.pageSize.height-10,"S"),u=u+" of "+a),r.setFontSize(9);var d=r.internal.pageSize.height||r.internal.pageSize.getHeight();r.text(u,t.settings.margin.left,d-10)},styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:100,left:20},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:70,halign:"left"},1:{cellWidth:80,halign:"center"},2:{cellWidth:160,halign:"left"},3:{cellWidth:45,halign:"center"},4:{cellWidth:60,halign:"center"},5:{cellWidth:65,halign:"center"},6:{cellWidth:65,halign:"center"},7:{cellWidth:65,halign:"center"},8:{cellWidth:75,halign:"right"},9:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]}});var u=r.output("blob");window.open(URL.createObjectURL(u))}downloadDetailsSummary(e){let t=[],i=[],l=["Bill Number","Bill Date","Account Number","Tenant Name"],n=[],o=[];e.forEach(e=>{e.bills&&e.bills.length&&e.bills.forEach(e=>{e.billTransactions&&e.billTransactions.length&&e.billTransactions.forEach(e=>{n.includes(e.headDisplay)||n.push(e.headDisplay)})}),e.billCharges&&e.billCharges.length&&e.billCharges.forEach(e=>{o.includes(e.headDisplay)||o.push(e.headDisplay)})}),n.forEach(e=>{l.push(e)}),o.forEach(e=>{l.push(e)}),l.push("Bill Amount ","Paid ");let a=0,s=0;for(let r=0;r<e.length;r++)t.push(e[r].billNumber),t.push(e[r].billDateLocal),t.push(e[r].accountNumber),t.push(e[r].ownerName),n.forEach(i=>{if(e[r].bills&&e[r].bills.length){const l=e[r].bills.filter(e=>1==e.isDifferentiateBill);if(l&&l.length&&e[r].bills.length==l.length)if(l[l.length-1].billTransactions&&l[l.length-1].billTransactions.length){const e=l[l.length-1].billTransactions.find(e=>e.headDisplay.toLowerCase()===i.toLowerCase());t.push(this.currencyPipe.transform(e?e.headAmount:0,this.currency.toString(),!0,this.roundFormat))}else t.push(this.currencyPipe.transform(0,this.currency.toString(),!0,this.roundFormat));else if(e[r].isGroupBill){let l=0;e[r].bills.forEach(e=>{if(e.billTransactions&&e.billTransactions.length){const t=e.billTransactions.find(e=>e.headDisplay.toLowerCase()===i.toLowerCase());t&&(l+=t.headAmount)}}),t.push(this.currencyPipe.transform(l>0?l:0,this.currency.toString(),!0,this.roundFormat))}else e[r].bills.forEach(e=>{if(e.billTransactions&&e.billTransactions.length){const l=e.billTransactions.find(e=>e.headDisplay.toLowerCase()===i.toLowerCase());t.push(this.currencyPipe.transform(l?l.headAmount:0,this.currency.toString(),!0,this.roundFormat))}else t.push(this.currencyPipe.transform(0,this.currency.toString(),!0,this.roundFormat))})}else t.push(this.currencyPipe.transform(0,this.currency.toString(),!0,this.roundFormat))}),o.forEach(i=>{if(e[r].isGroupBill){let l=0;if(e[r].billCharges&&e[r].billCharges.length){const t=e[r].billCharges.filter(e=>e.headDisplay.toLowerCase()===i.toLowerCase());t&&t.length&&t.forEach(e=>{l+=Number(e.headAmount)})}t.push(this.currencyPipe.transform(l>0?l:0,this.currency.toString(),!0,this.roundFormat))}else if(e[r].billCharges&&e[r].billCharges.length){const l=e[r].billCharges.find(e=>e.headDisplay.toLowerCase()===i.toLowerCase());t.push(this.currencyPipe.transform(l?l.headAmount:0,this.currency.toString(),!0,this.roundFormat))}else t.push(this.currencyPipe.transform(0,this.currency.toString(),!0,this.roundFormat))}),t.push(this.currencyPipe.transform(e[r].billAmount,this.currency.toString(),!0,this.roundFormat)),t.push(this.currencyPipe.transform(e[r].paid,this.currency.toString(),!0,this.roundFormat)),i.push(t),a+=e[r].billAmount,s+=e[r].paid,t=[];t=[];for(let r=0;r<l.length-2;r++)t.push("");t.push(this.currencyPipe.transform(a,this.currency.toString(),!0,this.roundFormat)),t.push(this.currencyPipe.transform(s,this.currency.toString(),!0,this.roundFormat)),i.push(t),this.getSummaryDetailsReport(this.billMasterDetails,l,i,"Bill History")}getSummaryDetailsReport(e,t,i,l){var n,o,a=new Image;a.src=this.filePath+"/uploads/"+(null===(o=null===(n=e[0])||void 0===n?void 0:n.client)||void 0===o?void 0:o.photo);let s=new fe.default({orientation:"landscape",unit:"pt",format:"letter"});const r=R().format("M/D/YYYY hh:mm:ss a");Number(this.decimalPipe.transform(s.autoTable.previous.finalY,"1.0-0")),s.autoTable(t,i,{startX:10,startY:110,didDrawPage:function(t){var i,l,n,o;if(s.setFontSize(30),a&&e[0]&&e[0].client&&e[0].client.imageProperties&&e[0].client.imageProperties.length){const t=null===(l=null===(i=e[0])||void 0===i?void 0:i.client)||void 0===l?void 0:l.imageProperties.find(e=>"landscape"===e.imageType.trim().toLowerCase());t&&(a.onload=function(){s.addImage(a,t.imgX,t.imgY,t.imgW,t.imgH)})}s.setTextColor(25,118,210),s.setFontSize(9),s.setFont("Cambria"),s.setTextColor(0,0,0),s.text("Print Date: "+r,s.internal.pageSize.width-150,20),s.setFontSize(14),s.text("Bill History From "+Object(b.f)(null===(n=e[0])||void 0===n?void 0:n.fromDateLocal)+" To "+Object(b.f)(null===(o=e[0])||void 0===o?void 0:o.toDateLocal),s.internal.pageSize.width/2-140,90),s.setFontSize(9);var c="Page "+t.pageCount;"function"==typeof s.putTotalPages&&(s.setTextColor(0,0,0),s.rect(5,5,s.internal.pageSize.width-10,s.internal.pageSize.height-10,"S"),c=c),s.setFontSize(9);var u=s.internal.pageSize.height||s.internal.pageSize.getHeight();s.text(c,t.settings.margin.left,u-10)},styles:{overflow:"linebreak",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:100,left:20},theme:"grid",tableWidth:"auto",columnStyles:{0:{cellWidth:t.length>10?"40":"wrap",halign:"center"},1:{cellWidth:t.length>10?"40":"wrap",halign:"center"},2:{cellWidth:t.length>10?"40":"wrap",halign:"center"},3:{cellWidth:t.length>10?"60":"wrap",halign:"center"},4:{cellWidth:"wrap",halign:"right"},5:{cellWidth:"wrap",halign:"right"},6:{cellWidth:"wrap",halign:"right"},7:{cellWidth:"wrap",halign:"right"},8:{cellWidth:"wrap",halign:"right"},9:{cellWidth:"wrap",halign:"right"},10:{cellWidth:"wrap",halign:"right"},11:{cellWidth:"wrap",halign:"right"},12:{cellWidth:"wrap",halign:"right"},13:{cellWidth:"wrap",halign:"right"},14:{cellWidth:"wrap",halign:"right"},15:{cellWidth:"wrap",halign:"right"},16:{cellWidth:"wrap",halign:"right"},17:{cellWidth:"wrap",halign:"right"},18:{cellWidth:"wrap",halign:"right"},19:{cellWidth:"wrap",halign:"right"},20:{cellWidth:"wrap",halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){const t=e.column.index;if(0==t){let i=!1;if(e.table&&e.table.body&&e.table.body.length)for(let l=0;l<e.table.body.length;l++){const n=e.table.body[l].raw[t];if(n&&(i=n.length>30),i)break}i&&(e.cell.styles.cellWidth="5")}}});var c=s.output("blob");window.open(URL.createObjectURL(c))}onSendInvoice(e,t=!0,i=!1){this.selectedRows&&this.selectedRows.length?this.templateService.emailCustomTemplate({clientId:this.clientId,templateName:e.notificationType,notificationType:e.notificationType,billMasterDetails:this.selectedRows,isManual:t,isSkipExisting:e.isSkipExisting}).subscribe({next:e=>{e&&e.status?this.notificationMessage("Notifications send failed."+e.status,"red-snackbar"):e&&e.isSuccess&&this.notificationMessage("Notifications initiated,Please check notification logs.","green-snackbar"),i&&(this.reset(),this.onGetBillsHistory(this.manageParams))},error:e=>{this.notificationMessage("Notifications send failed.","red-snackbar")}}):this.notificationMessage("Please select Bills.","red-snackbar")}onApprove(){this.selectedRows&&this.selectedRows.length?this.billSettlementService.updateBillMasterApprovedStatus(this.selectedRows).subscribe({next:e=>{e?(this.notificationMessage("Invoice approved successfully","green-snackbar"),this.generateInvoice()):this.notificationMessage("Invoice approve failed","red-snackbar")},error:e=>{this.notificationMessage("Invoice approve failed","red-snackbar")}}):this.notificationMessage("Please select Bills","red-snackbar")}getClientAlertSettings(e=""){this.templatesService.getClientAlertSettings(this.clientId).subscribe({next:t=>{if(t)if("Approval"===e){const e=t.filter(e=>e.notificationCategory&&e.notificationCategory.toLowerCase()==="bills".toLowerCase()&&e.condition&&e.condition.toLowerCase()=="After Invoice Approval".toLowerCase()&&1==e.isEnableAutoSend);if(e&&e.length){let t=0;e.forEach(i=>{this.onSendInvoice({notificationType:i.notificationType,isSkipExisting:!1},!1,t==e.length-1),t+=1})}else this.reset(),this.onGetBillsHistory(this.manageParams)}else{const e=t.filter(e=>e.notificationCategory&&e.notificationCategory.toLowerCase()==="bills".toLowerCase()),i={alertSettings:e,billMasters:this.selectedRows};e?this.dialog.open(gt,{data:i}).afterClosed().subscribe(e=>{e&&this.onSendInvoice(e)}):(this.reset(),this.onGetBillsHistory(this.manageParams))}else this.notificationMessage("Invoice approved successfully.","green-snackbar"),this.reset(),this.onGetBillsHistory(this.manageParams),this.notificationMessage("No notification found to send.","red-snackbar")},error:e=>{this.notificationMessage("Invoice approved successfully.","green-snackbar"),this.reset(),this.onGetBillsHistory(this.manageParams),this.notificationMessage("Notifications send failed","red-snackbar")}})}generateInvoice(){this.billSettlementService.invoiceGeneration(this.selectedRows).subscribe({next:e=>{e&&e.isSuccess&&(this.notificationMessage("Invoice generation started successfully.","green-snackbar"),this.getClientAlertSettings("Approval"))},error:e=>{this.notificationMessage("Invoice generation failed.","red-snackbar")}})}reset(){this.rejectedCount="",this.approvedCount="",this.fineCount="",this.penalityCount=""}notificationMessage(e,t){this.snackbar.open(e,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[t]})}onRejectDataRow(e){e.type="Reject",this.dialog.open(Ee,{data:e}).afterClosed().subscribe(()=>{e&&this.onGetBillsHistory(this.manageParams)})}onFailDataRow(e){e.isBillFailed=!0,this.billService.updateIsFailedStatusInBills(e.bills).subscribe({next:t=>{t?this.billService.UpdateIsBillFailedStatusInBillMaster(e).subscribe({next:e=>{e?(this.onGetBillsHistory(this.manageParams),this.notificationMessage("Moved to Failed Bills successfully","green-snackbar")):this.notificationMessage("Unable to fail the bill","red-snackbar")},error:e=>{this.notificationMessage("Unable to fail the bill","red-snackbar")}}):this.notificationMessage("Unable to fail the bill","red-snackbar")},error:e=>{this.notificationMessage("Unable to fail the bill","red-snackbar")}})}onRegenerate(){this.selectedRows&&this.selectedRows.length?this.billSettlementService.regenerateRejectedBillMasters(this.selectedRows).subscribe({next:e=>{e?(this.notificationMessage("Invoice regenerated successfully","green-snackbar"),this.reset(),this.onGetBillsHistory(this.manageParams)):this.notificationMessage("Invoice regeneration failed","red-snackbar")},error:e=>{this.notificationMessage("Invoice regeneration failed","red-snackbar")}}):this.notificationMessage("Please select Bills","red-snackbar")}onUpdateRow(e){if(e.billAmount==e.creditNoteAmount)return void this.notificationMessage("Credit note amount can not be more than Bill amount","red-snackbar");let t={billMasterId:e.id,vat:e.vat,vatAccountHeadId:e.vatAccountHeadId,ownerId:e.ownerId},i=[];if(e&&(e.bills.forEach(t=>{t.billTransactions&&t.billTransactions.length&&t.billTransactions.forEach(l=>{if(t.isDifferentiateBill){let t=null;if(i&&i.length){if(t=i.find(e=>e.headDisplay.trim().toLowerCase()===l.headDisplay.toLowerCase()),t&&0==t.fixedAmount){const e=i.indexOf(t);e>-1&&i.splice(e,1);const n={rowNumber:i.length+1,billHeadId:l.billHeadId,taxId:0,headDisplay:l.headDisplay,fixedAmount:l.headAmount,fixedAmountLocal:this.currencyPipe.transform(l.headAmount,this.currency.toString(),!0,this.roundFormat),creditNoteAmount:0,isVAT:l.isVAT,position:l.position};i.push(n)}}else if(l.isDiscount){let t=null;e.billDiscounts&&e.billDiscounts.length&&(t=e.billDiscounts.find(e=>e.billHeadId===l.billHeadId));const n=i.find(e=>e.billHeadId===l.billHeadId);if(n&&t)n.fixedAmount=l.headAmount-t.headAmount,n.fixedAmountLocal=this.currencyPipe.transform(n.fixedAmount,this.currency.toString(),!0,this.roundFormat);else if(t){const e=l.headAmount-t.headAmount,n={rowNumber:i.length+1,billHeadId:l.billHeadId,taxId:0,headDisplay:l.headDisplay,fixedAmount:e,fixedAmountLocal:this.currencyPipe.transform(e,this.currency.toString(),!0,this.roundFormat),creditNoteAmount:0,isVAT:l.isVAT,position:l.position};i.push(n)}}else{const e={rowNumber:i.length+1,billHeadId:l.billHeadId,taxId:0,headDisplay:l.headDisplay,fixedAmount:l.headAmount,fixedAmountLocal:this.currencyPipe.transform(l.headAmount,this.currency.toString(),!0,this.roundFormat),creditNoteAmount:0,isVAT:l.isVAT,position:l.position};i.push(e)}}else if(l.isDiscount){let t=null;e.billDiscounts&&e.billDiscounts.length&&(t=e.billDiscounts.find(e=>e.billHeadId===l.billHeadId));const n=i.find(e=>e.billHeadId===l.billHeadId);if(n&&t)n.fixedAmount=n.fixedAmount-t.headAmount,n.fixedAmountLocal=this.currencyPipe.transform(n.fixedAmount,this.currency.toString(),!0,this.roundFormat);else if(t){const e=l.headAmount-t.headAmount,n={rowNumber:i.length+1,billHeadId:l.billHeadId,taxId:0,headDisplay:l.headDisplay,fixedAmount:e,fixedAmountLocal:this.currencyPipe.transform(e,this.currency.toString(),!0,this.roundFormat),creditNoteAmount:0,isVAT:l.isVAT,position:l.position};i.push(n)}}else{const e={rowNumber:i.length+1,billHeadId:l.billHeadId,taxId:0,headDisplay:l.headDisplay,fixedAmount:l.headAmount,fixedAmountLocal:this.currencyPipe.transform(l.headAmount,this.currency.toString(),!0,this.roundFormat),creditNoteAmount:0,isVAT:l.isVAT,position:l.position};i.push(e)}})}),e.billCharges.forEach(t=>{if(t.isDiscount){let l=null;e.billDiscounts&&e.billDiscounts.length&&(l=e.billDiscounts.find(e=>e.billHeadId===t.billHeadId));const n=i.find(e=>e.billHeadId===t.billHeadId);if(n&&l)n.fixedAmount=n.fixedAmount-l.headAmount,n.fixedAmountLocal=this.currencyPipe.transform(n.fixedAmount,this.currency.toString(),!0,this.roundFormat);else if(l){const e=t.headAmount-l.headAmount,n={rowNumber:i.length+1,billHeadId:t.billHeadId,taxId:0,headDisplay:t.headDisplay,fixedAmount:e,fixedAmountLocal:this.currencyPipe.transform(e,this.currency.toString(),!0,this.roundFormat),creditNoteAmount:0,isVAT:t.isVAT,position:t.position};i.push(n)}}else{const e={rowNumber:i.length+1,billHeadId:t.billHeadId,taxId:0,headDisplay:t.headDisplay,fixedAmount:t.headAmount,fixedAmountLocal:this.currencyPipe.transform(t.headAmount,this.currency.toString(),!0,this.roundFormat),creditNoteAmount:0,isVAT:t.isVAT,position:t.position};i.push(e)}}),e.billTaxDetails&&e.billTaxDetails.length&&e.billTaxDetails.forEach(e=>{var t,l;let n=0;i&&i.length&&(n=null!==(l=null===(t=i.sort((e,t)=>e.position-t.position)[i.length-1])||void 0===t?void 0:t.position)&&void 0!==l?l:0);const o={rowNumber:i.length+1,billHeadId:0,taxId:e.taxId,headDisplay:e.taxDisplayName,fixedAmount:e.taxAmount,fixedAmountLocal:this.currencyPipe.transform(e.taxAmount,this.currency.toString(),!0,this.roundFormat),creditNoteAmount:0,isVAT:!1,formulaFieldName:e.computationTypeName,position:n,disabled:!0,value:e.taxValue};i.push(o)})),i&&i.length){i=i.sort((e,t)=>e.position-t.position);for(let e=0;e<i.length;++e)i[e].rowNumber=e+1}t.creditNoteTransactions=i,e.creditNotes&&e.creditNotes.length&&e.creditNotes.forEach(e=>{e.creditNoteTransactions.forEach(e=>{const i=t.creditNoteTransactions.find(t=>t.billHeadId===e.billHeadId);i&&(i.fixedAmount=i.fixedAmount-e.creditNoteAmount,i.fixedAmountLocal=this.currencyPipe.transform(i.fixedAmount,this.currency.toString(),!0,this.roundFormat))})}),this.dialog.open(bt,{height:"550px",data:t}).afterClosed().subscribe(e=>{e&&this.onGetBillsHistory(this.manageParams)})}downloadBillFormat2LargeReport(e){var t,i,l,n,o,a,s,r,c,u,d,m,h,p,f,g,v,y,C,S;let T=[],P=[],D=[],w=[],N=[],x=[],A=[],F=[],R=[],k=[],I=["Unit No","Meter No","Previous Reading","Present Reading","Consumption"],O=["Bill No","Meter No","Charges","Consumption","Measuring Unit","Tariff","Total"];N.push({label:"Bill No",value:null!==(t=null==e?void 0:e.billNumber)&&void 0!==t?t:""},{label:"Date of issue",value:null!==(i=null==e?void 0:e.billDateLocal)&&void 0!==i?i:""},{label:"Due Date",value:null!==(l=null==e?void 0:e.dueDateLocal)&&void 0!==l?l:""}),x.push({label:"Customer Name",value:null!==(n=null==e?void 0:e.ownerName)&&void 0!==n?n:""},{label:"Customer AccountNumber",value:null!==(o=null==e?void 0:e.accountNumber)&&void 0!==o?o:""},{label:"Unit No",value:null!==(a=null==e?void 0:e.unitNumber)&&void 0!==a?a:""},{label:"Address",value:null!==(r=null===(s=null==e?void 0:e.receiverDetails[0])||void 0===s?void 0:s.address1)&&void 0!==r?r:""},{label:"City",value:null!==(u=null===(c=null==e?void 0:e.receiverDetails[0])||void 0===c?void 0:c.city)&&void 0!==u?u:""},{label:"P.O Box",value:null!==(m=null===(d=null==e?void 0:e.receiverDetails[0])||void 0===d?void 0:d.zipPostalCode)&&void 0!==m?m:""},{label:"Phone number",value:null!==(p=null===(h=null==e?void 0:e.receiverDetails[0])||void 0===h?void 0:h.phoneNumber)&&void 0!==p?p:""},{label:"Fax Number",value:""},{label:"Client",value:null!==(g=null===(f=null==e?void 0:e.client)||void 0===f?void 0:f.clientName)&&void 0!==g?g:""},{label:"Client TRN",value:null!==(y=null===(v=null==e?void 0:e.client)||void 0===v?void 0:v.trnNo)&&void 0!==y?y:""});let W=!1,M=!1,L=!1,B=!1;if(e&&e.bills&&e.bills.length){const t=Array.from(new Set(e.bills.map(e=>e.billNumber))),i=Array.from(new Set(e.bills.map(e=>e.unitNumber))),l=Array.from(new Set(e.bills.map(e=>e.deviceName)));if(W=!!(t&&t.length>1),M=!!(i&&i.length>1),B=!!(l&&l.length>1),!B){const e=O.findIndex(e=>"Meter No"===e);e>-1&&O.splice(e,1)}if(W?N.splice(0,1):O.splice(0,1),M){const e=x.findIndex(e=>"Unit No"===e.label);x.splice(e,1)}else I.splice(0,1);const n=Array.from(new Set(e.bills.filter(e=>e.billTariffDetails&&e.billTariffDetails.length))),o=Array.from(new Set(e.bills.filter(e=>!e.billTariffDetails||0===e.billTariffDetails.length)));if(o&&o.length&&o&&o.length&&(L=!0),o&&o.length&&!n&&(L=!0),n&&n.length&&(!o||0==o.length))for(let e=0;e<n.length;e++)if(n[e].billTransactions.find(e=>!e.tariffId)){L=!0;break}}if(!L){const e=O.findIndex(e=>"Tariff"===e);e&&O.splice(e,1)}for(let H=0;H<e.bills.length;H++){if(this.consumptionRoundOffFormat=null!==(C=Object(b.e)("ConsumptionRoundOff",e.bills[H].utilityTypeId))&&void 0!==C?C:this.envService.consumptionRoundOffFormat,M&&T.push(e.bills[H].unitNumber),T.push(e.bills[H].deviceName),T.push(this.decimalPipe.transform(e.bills[H].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[H].measuringUnit),T.push(this.decimalPipe.transform(e.bills[H].presentReading,this.consumptionRoundOffFormat)+" "+e.bills[H].measuringUnit),e.bills[H].isDifferentiateBill){if(B){B=!1;const e=O.findIndex(e=>"Meter No"===e);e>-1&&O.splice(e,1)}T.push(this.decimalPipe.transform(e.bills[H].presentReading-e.bills[H].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[H].measuringUnit)}else T.push(this.decimalPipe.transform(e.bills[H].consumption,this.consumptionRoundOffFormat)+" "+e.bills[H].measuringUnit);"BTU"===e.bills[H].utilityType&&e.bills[H].billTransactions&&e.bills[H].billTransactions.length&&e.bills[H].billTransactions.findIndex(e=>e.measuringUnitId&&2===e.measuringUnitId)>-1&&(0==H&&I.push("Consumption TR-HR"),T.push(this.decimalPipe.transform(.284345*e.bills[H].consumption,this.consumptionRoundOffFormat))),P.push(T),T=[]}let z=0;for(let H=0;H<e.bills.length;H++){const t=e.bills[H];this.consumptionRoundOffFormat=null!==(S=Object(b.e)("ConsumptionRoundOff",e.bills[H].utilityTypeId))&&void 0!==S?S:this.envService.consumptionRoundOffFormat;for(let e=0;e<t.billTransactions.length;e++)W&&T.push(t.billNumber),B&&T.push(t.deviceName),T.push(t.billTransactions[e].headDisplay),"BTU"===t.utilityType&&t.billTransactions&&t.billTransactions.length&&t.billTransactions[e]&&t.billTransactions[e].measuringUnitId&&2===t.billTransactions[e].measuringUnitId?(T.push(this.decimalPipe.transform(.284345*t.consumption,this.consumptionRoundOffFormat)),T.push("TR-HR"),L&&t.billTariffDetails&&t.billTariffDetails.length&&t.billTransactions[e].tariffId?T.push("-"):L&&T.push(t.billTransactions[e].rate)):(T.push(this.decimalPipe.transform(t.consumption,this.consumptionRoundOffFormat)),T.push(t.measuringUnit),L&&t.billTariffDetails&&t.billTariffDetails.length&&t.billTransactions[e].tariffId?T.push("-"):L&&T.push(t.billTransactions[e].rate)),T.push(this.currencyPipe.transform(t.billTransactions[e].headAmount,this.currency.toString(),!0,this.roundFormat)),F.push(T),T=[],z+=t.billTransactions[e].headAmount}if(T.push(e.accountNumber),T.push(e.fromDateLocal+"-"+e.toDateLocal),T.push(this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)),T.push(e.billAmountLocal),w.push(T),e.billCharges&&e.billCharges.length&&(e.billCharges.sort((e,t)=>e.position-t.position).forEach(e=>{if("VAT"!==e.headDisplay){const t=D.find(t=>t.label===e.headDisplay);t?t.value+=e.headAmount:D.push({label:e.headDisplay,value:e.headAmount})}}),D.forEach(e=>{R.push({label:e.label,value:this.currencyPipe.transform(e.value,this.currency.toString(),!0,this.roundFormat)}),z+=e.value})),R.push({label:"Total Charges for Current Period",value:this.currencyPipe.transform(z,this.currency.toString(),!0,this.roundFormat)}),e.billDiscounts&&e.billDiscounts.length){let t=0;e.billDiscounts.forEach(e=>{t+=e.headAmount}),R.push({label:"Total Discount",value:this.currencyPipe.transform(t,this.currency.toString(),!0,this.roundFormat)})}e.billTaxDetails.forEach(e=>{const t=R.find(t=>t.label===e.taxDisplayName);if(t){const i=Number(t.value.replace(this.currency,"").trim())+Number(e.taxAmount);t.value=this.currencyPipe.transform(i,this.currency.toString(),!0,this.roundFormat)}else R.push({label:e.taxDisplayName,value:this.currencyPipe.transform(e.taxAmount,this.currency.toString(),!0,this.roundFormat)})}),R.push({label:"Previous Outstanding Amount",value:this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)},{label:"Total Amount Due",value:this.currencyPipe.transform(e.billAmount+e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)}),A.push({firstItem:"Billing period",secondItem:"From:",thirdItem:e.fromDateLocal,fourthItem:"To:",fifthItem:e.toDateLocal});Array.from(new Set(e.bills.map(e=>e.billTariffDetails)));let U=[],E=[],j=!1;T=[],e&&e.bills&&e.bills.length&&e.bills.forEach(e=>{this.consumptionRoundOffFormat=Object(b.e)("ConsumptionRoundOff",e.utilityTypeId),E=[];let t="Unit Number : "+e.unitNumber+" - Meter Number : "+e.deviceName;if(e.billTariffDetails&&e.billTariffDetails.length)for(let i=0;i<e.billTariffDetails.length;i++){if(e.billTariffDetails[i].slabSettingsId&&e.billTariffDetails[i].slabSettingsId>0){let l=e.billTariffDetails[i].season;Number(e.billTariffDetails[i].peakType)<Number(e.billTariffDetails[i].consumption)&&(l=e.billTariffDetails[i].peakType+" - "+e.billTariffDetails[i].consumption),0==i&&(j=!0,U=["Slab","Consumption","Rate","Amount "]),E&&E.length?E.find(e=>e===t)||this.createUnitMeterNumberRow(t,U.length,k):(E.push(t),this.createUnitMeterNumberRow(t,U.length,k)),T.push(l),T.push(this.decimalPipe.transform(e.billTariffDetails[i].consumption,this.consumptionRoundOffFormat)),T.push(e.billTariffDetails[i].rate),T.push(this.currencyPipe.transform(e.billTariffDetails[i].amount,this.currency.toString(),!0,this.roundFormat))}else 0==e.billTariffDetails[i].slabSettingsId&&(0==i&&(U=["Season","Week Type","Peak Type","Consumption","Rate","Amount "]),E&&E.length?E.find(e=>e===t)||this.createUnitMeterNumberRow(t,U.length,k):(E.push(t),this.createUnitMeterNumberRow(t,U.length,k)),T.push(e.billTariffDetails[i].season),T.push(e.billTariffDetails[i].weekType),T.push(e.billTariffDetails[i].peakType),T.push(this.decimalPipe.transform(e.billTariffDetails[i].consumption,this.consumptionRoundOffFormat)),T.push(e.billTariffDetails[i].rate),T.push(this.currencyPipe.transform(e.billTariffDetails[i].amount,this.currency.toString(),!0,this.roundFormat)));k.push(T),T=[]}}),this.getBillFormat2LargeReport(I,P,D,["Customer AccountNumber","Billing Period","Previous Due","Total for current period"],w,N,x,A,"Bill History",O,F,e,R,U,k,j)}getBillFormat2LargeReport(e,t,i,l,n,o,a,s,r,c,u,d,m,h,b,p=!1){var f,g,v,y,C,S,T;(new Image).src=this.filePath+"/uploads/"+(null===(f=null==d?void 0:d.client)||void 0===f?void 0:f.photo);let P=new fe.default({orientation:"portrait",unit:"pt",format:"letter"});const D=null!==(v=null===(g=null==d?void 0:d.client)||void 0===g?void 0:g.clientName)&&void 0!==v?v:"",w=P.getTextWidth(D.trim())+4;P.setTextColor(0,0,0),P.setFontSize(17),P.setFont("Cambria"),P.text(D,Number(P.internal.pageSize.width/2)-Number(0!=w?w/2:0),23),P.setDrawColor(0,0,0),P.line(Number(P.internal.pageSize.width/2)-Number(0!=w?w/2:0),26,Number(P.internal.pageSize.width/2)-Number(0!=w?w/2:0)+w,26),P.setFont("Cambria","normal"),P.setFontSize(14),P.text("Billing Statement",35,46),this.addImage(P,d),P.autoTable("",o,{startX:10,startY:55,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:35},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:150,halign:"left"},1:{cellWidth:190,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"},didParseCell:function(e){e.cell.styles.cellPadding=1}});const N=Math.round(P.autoTable.previous.finalY);P.autoTable("",s,{startX:10,startY:N,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:35},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:150,halign:"left"},1:{cellWidth:95,halign:"center"},2:{cellWidth:95,halign:"center"},3:{cellWidth:97,halign:"center"},4:{cellWidth:97,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0]},didParseCell:function(e){e.cell.styles.cellPadding=1}});const x=Math.round(P.autoTable.previous.finalY);P.autoTable("",a,{startX:10,startY:x,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:35},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:150,halign:"left"},1:{cellWidth:384,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0]},didParseCell:function(e){e.cell.styles.cellPadding=1}});var A=function(e){var t="Page "+e.pageCount;"function"==typeof P.putTotalPages&&(t=t),P.setFontSize(9)};const F=Math.round(P.autoTable.previous.finalY);P.setFont("Cambria"),P.setFontSize(10),P.text("Meter Read-Outs".toUpperCase(),35,F+20),P.autoTable(e,t,{startX:10,startY:F+40,showHead:"everyPage",didDrawPage:A,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:35},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:6==e.length?100:4==e.length?182:150,halign:"center"},1:{cellWidth:6==e.length?95:4==e.length?142:120,halign:"center"},2:{cellWidth:4==e.length?105:95,halign:"center"},3:{cellWidth:4==e.length?105:95,halign:"center"},4:{cellWidth:74,halign:"center"},5:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}});const R=Number(this.decimalPipe.transform(P.autoTable.previous.finalY,"1.0-0"));u&&u.length&&(P.setFontSize(10),P.text("Charges Breakdown".toUpperCase(),35,R+20),P.autoTable(c,u,{startX:10,startY:R+40,showHead:"everyPage",didDrawPage:A,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:35},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{columnWidth:6==c.length?80:4==c.length?214:7==c.length?75:215,halign:"center"},1:{columnWidth:6==c.length?145:4==c.length?160:7==c.length?75:85,halign:"center"},2:{cellWidth:85,halign:"center"},3:{cellWidth:75,halign:4==c.length?"right":"center"},4:{cellWidth:74,halign:6==c.length||7==c.length?"center":"right"},5:{cellWidth:75,halign:"center"},6:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}));const k=Number(this.decimalPipe.transform(P.autoTable.previous.finalY,"1.0-0"));let I=k;p?(P.autoTable(h,b,{startX:40,startY:k+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{columnWidth:4===h.length?200:110,halign:"center"},1:{columnWidth:4===h.length?117:140,halign:"center"},2:{columnWidth:4===h.length?117:97,halign:"center"},3:{columnWidth:4===h.length?100:97,halign:4===h.length?"right":"center"},4:{columnWidth:90,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}),I=Number(this.decimalPipe.transform(P.autoTable.previous.finalY,"1.0-0"))):(P.autoTable(h,b,{startX:40,startY:k+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{columnWidth:6===h.length?130:85,halign:"center"},1:{columnWidth:6===h.length?85:75,halign:"center"},2:{columnWidth:6===h.length?85:75,halign:"center"},3:{columnWidth:6===h.length?85:75,halign:"center"},4:{columnWidth:74,halign:"center"},5:{columnWidth:75,halign:6===h.length?"right":"center"},6:{columnWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1;const t=e.cell.raw;t&&"string"==typeof t&&t.startsWith("Unit")&&(e.cell.styles.fontStyle="bold",e.cell.colSpan=h.length,e.cell.styles.halign="left")}}),I=Number(this.decimalPipe.transform(P.autoTable.previous.finalY,"1.0-0")));let O=P.internal.pageSize.height;O-I<200&&(P.addPage(),I=N,O=370+N),P.autoTable("",m,{startX:10,startY:I+20,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{bottom:40,left:250},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:244,fontStyle:"italic"},1:{cellWidth:75}},didParseCell:function(e){1==e.column.index&&(e.cell.styles.halign="right"),e.cell.styles.cellPadding=1},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});let W=Number(this.decimalPipe.transform(P.autoTable.previous.finalY,"1.0-0"));if((null===(C=null===(y=null==d?void 0:d.client)||void 0===y?void 0:y.termsConditions[0])||void 0===C?void 0:C.termsAndCondition)&&(P.setFillColor(241,241,244),P.rect(35,W+20,535,80,"FD"),P.setFillColor(0,0,0),P.setFontSize(9),P.text(null===(T=null===(S=null==d?void 0:d.client)||void 0===S?void 0:S.termsConditions[0])||void 0===T?void 0:T.termsAndCondition.replace("{{ClientName}}",d.client.clientName).replace("{{TRNNumber}}",d.client.trnNo).replace("{{Currency}}",this.currency),65,W+30)),P.setTextColor(0,0,0),P.line(5,W+105,607,W+105),W>O-190){P.addPage();var M="Page "+P.getNumberOfPages();P.setFontSize(10),P.text(M,10,O-10),O=150}P.text("Notice :- Please tear and attach the slip  along with your payment",35,O-80),P.autoTable(l,n,{startX:10,startY:O-70,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:35},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:120,halign:"center"},1:{cellWidth:200,halign:"center"},2:{cellWidth:100,halign:"right"},3:{cellWidth:120,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}});var L=P.output("datauristring");this.pdfsToMerge.push(L)}downloadBillFormat2Report(e){var t,i,l,n,o,a,s,r,c,u,d,m,h,p,f,g,v,y,C,S;let T=[],P=[],D=[],w=[],N=[],x=[],A=[],F=[],R=[],k=[],I=["Unit No","Meter No","Previous Reading","Present Reading","Consumption"],O=["Bill No","Meter No","Charges","Consumption","Measuring Unit","Tariff","Total"];N.push({label:"Bill No",value:null!==(t=null==e?void 0:e.billNumber)&&void 0!==t?t:""},{label:"Date of issue",value:null!==(i=null==e?void 0:e.billDateLocal)&&void 0!==i?i:""},{label:"Due Date",value:null!==(l=null==e?void 0:e.dueDateLocal)&&void 0!==l?l:""}),x.push({label:"Customer Name",value:null!==(n=null==e?void 0:e.ownerName)&&void 0!==n?n:""},{label:"Customer AccountNumber",value:null!==(o=null==e?void 0:e.accountNumber)&&void 0!==o?o:""},{label:"Unit No",value:null!==(a=null==e?void 0:e.unitNumber)&&void 0!==a?a:""},{label:"Address",value:null!==(r=null===(s=null==e?void 0:e.receiverDetails[0])||void 0===s?void 0:s.address1)&&void 0!==r?r:""},{label:"City",value:null!==(u=null===(c=null==e?void 0:e.receiverDetails[0])||void 0===c?void 0:c.city)&&void 0!==u?u:""},{label:"P.O Box",value:null!==(m=null===(d=null==e?void 0:e.receiverDetails[0])||void 0===d?void 0:d.zipPostalCode)&&void 0!==m?m:""},{label:"Phone number",value:null!==(p=null===(h=null==e?void 0:e.receiverDetails[0])||void 0===h?void 0:h.phoneNumber)&&void 0!==p?p:""},{label:"Fax Number",value:""},{label:"Client",value:null!==(g=null===(f=null==e?void 0:e.client)||void 0===f?void 0:f.clientName)&&void 0!==g?g:""},{label:"Client TRN",value:null!==(y=null===(v=null==e?void 0:e.client)||void 0===v?void 0:v.trnNo)&&void 0!==y?y:""});let W=!1,M=!1,L=!1,B=!1;if(e&&e.bills&&e.bills.length){const t=Array.from(new Set(e.bills.map(e=>e.billNumber))),i=Array.from(new Set(e.bills.map(e=>e.unitNumber))),l=Array.from(new Set(e.bills.map(e=>e.deviceName)));if(W=!!(t&&t.length>1),M=!!(i&&i.length>1),B=!!(l&&l.length>1),!B){const e=O.findIndex(e=>"Meter No"===e);e>-1&&O.splice(e,1)}if(W?N.splice(0,1):O.splice(0,1),M){const e=x.findIndex(e=>"Unit No"===e.label);x.splice(e,1)}else I.splice(0,1);const n=Array.from(new Set(e.bills.filter(e=>e.billTariffDetails&&e.billTariffDetails.length))),o=Array.from(new Set(e.bills.filter(e=>!e.billTariffDetails||0===e.billTariffDetails.length)));if(o&&o.length&&o&&o.length&&(L=!0),o&&o.length&&!n&&(L=!0),n&&n.length&&(!o||0==o.length))for(let e=0;e<n.length;e++)if(n[e].billTransactions.find(e=>!e.tariffId)){L=!0;break}}if(!L){const e=O.findIndex(e=>"Tariff"===e);e&&O.splice(e,1)}for(let H=0;H<e.bills.length;H++){if(this.consumptionRoundOffFormat=null!==(C=Object(b.e)("ConsumptionRoundOff",e.bills[H].utilityTypeId))&&void 0!==C?C:this.envService.consumptionRoundOffFormat,M&&T.push(e.unitNumber),T.push(e.bills[H].deviceName),T.push(this.decimalPipe.transform(e.bills[H].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[H].measuringUnit),T.push(this.decimalPipe.transform(e.bills[H].presentReading,this.consumptionRoundOffFormat)+" "+e.bills[H].measuringUnit),e.bills[H].isDifferentiateBill){if(B){B=!1;const e=O.findIndex(e=>"Meter No"===e);e>-1&&O.splice(e,1)}T.push(this.decimalPipe.transform(e.bills[H].presentReading-e.bills[H].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[H].measuringUnit)}else T.push(this.decimalPipe.transform(e.bills[H].consumption,this.consumptionRoundOffFormat)+" "+e.bills[H].measuringUnit);"BTU"===e.bills[H].utilityType&&e.bills[H].billTransactions&&e.bills[H].billTransactions.length&&e.bills[H].billTransactions.findIndex(e=>e.measuringUnitId&&2===e.measuringUnitId)>-1&&(0==H&&I.push("Consumption TR-HR"),T.push(this.decimalPipe.transform(.284345*e.bills[H].consumption,this.consumptionRoundOffFormat))),P.push(T),T=[]}let z=0;for(let H=0;H<e.bills.length;H++){const t=e.bills[H];this.consumptionRoundOffFormat=null!==(S=Object(b.e)("ConsumptionRoundOff",e.bills[H].utilityTypeId))&&void 0!==S?S:this.envService.consumptionRoundOffFormat;for(let e=0;e<t.billTransactions.length;e++)W&&T.push(t.billNumber),B&&T.push(t.deviceName),T.push(t.billTransactions[e].headDisplay),"BTU"===t.utilityType&&t.billTransactions&&t.billTransactions.length&&t.billTransactions[e]&&t.billTransactions[e].measuringUnitId&&2===t.billTransactions[e].measuringUnitId?(T.push(this.decimalPipe.transform(.284345*t.consumption,this.consumptionRoundOffFormat)),T.push("TR-HR"),L&&t.billTariffDetails&&t.billTariffDetails.length&&t.billTransactions[e].tariffId?T.push("-"):L&&T.push(t.billTransactions[e].rate)):(T.push(this.decimalPipe.transform(t.consumption,this.consumptionRoundOffFormat)),T.push(t.measuringUnit),L&&t.billTariffDetails&&t.billTariffDetails.length&&t.billTransactions[e].tariffId?T.push("-"):L&&T.push(t.billTransactions[e].rate)),T.push(this.currencyPipe.transform(t.billTransactions[e].headAmount,this.currency.toString(),!0,this.roundFormat)),F.push(T),T=[],z+=t.billTransactions[e].headAmount}if(T.push(e.accountNumber),T.push(e.fromDateLocal+"-"+e.toDateLocal),T.push(this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)),T.push(e.billAmountLocal),w.push(T),e.billCharges&&e.billCharges.length&&(e.billCharges.sort((e,t)=>e.position-t.position).forEach(e=>{if("VAT"!==e.headDisplay){const t=D.find(t=>t.label===e.headDisplay);t?t.value+=e.headAmount:D.push({label:e.headDisplay,value:e.headAmount})}}),D.forEach(e=>{R.push({label:e.label,value:this.currencyPipe.transform(e.value,this.currency.toString(),!0,this.roundFormat)})})),e.billCharges.find(e=>"VAT"===e.headDisplay),R.push({label:"Total consumption charge for Current Period",value:this.currencyPipe.transform(z,this.currency.toString(),!0,this.roundFormat)}),e.billDiscounts&&e.billDiscounts.length){let t=0;e.billDiscounts.forEach(e=>{t+=e.headAmount}),R.push({label:"Total Discount",value:this.currencyPipe.transform(t,this.currency.toString(),!0,this.roundFormat)})}e.billTaxDetails.forEach(e=>{const t=R.find(t=>t.label===e.taxDisplayName);if(t){const i=Number(t.value.replace(this.currency,"").trim())+Number(e.taxAmount);t.value=this.currencyPipe.transform(i,this.currency.toString(),!0,this.roundFormat)}else R.push({label:e.taxDisplayName,value:this.currencyPipe.transform(e.taxAmount,this.currency.toString(),!0,this.roundFormat)})}),R.push({label:"Previous Outstanding Amount",value:this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)},{label:"Total Amount Due",value:this.currencyPipe.transform(e.billAmount+e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)}),A.push({firstItem:"Billing period",secondItem:"From:",thirdItem:e.fromDateLocal,fourthItem:"To:",fifthItem:e.toDateLocal});Array.from(new Set(e.bills.map(e=>e.billTariffDetails)));let U=[],E=!1,j=[];T=[],e&&e.bills&&e.bills.length&&e.bills.forEach(e=>{var t;this.consumptionRoundOffFormat=null!==(t=Object(b.e)("ConsumptionRoundOff",e.utilityTypeId))&&void 0!==t?t:this.envService.consumptionRoundOffFormat,j=[];let i="Unit Number : "+e.unitNumber+" - Meter Number : "+e.deviceName;if(e.billTariffDetails&&e.billTariffDetails.length)for(let l=0;l<e.billTariffDetails.length;l++){if(e.billTariffDetails[l].slabSettingsId&&e.billTariffDetails[l].slabSettingsId>0){let t=e.billTariffDetails[l].season;Number(e.billTariffDetails[l].peakType)<Number(e.billTariffDetails[l].consumption)&&(t=e.billTariffDetails[l].peakType+" - "+e.billTariffDetails[l].consumption),0==l&&(E=!0,U=["Slab","Consumption","Rate","Amount "]),j&&j.length?j.find(e=>e===i)||this.createUnitMeterNumberRow(i,U.length,k):(j.push(i),this.createUnitMeterNumberRow(i,U.length,k)),T.push(t),T.push(this.decimalPipe.transform(e.billTariffDetails[l].consumption,this.consumptionRoundOffFormat)),T.push(e.billTariffDetails[l].rate),T.push(this.currencyPipe.transform(e.billTariffDetails[l].amount,this.currency.toString(),!0,this.roundFormat))}else 0==e.billTariffDetails[l].slabSettingsId&&(0==l&&(U=["Season","Week Type","Peak Type","Consumption","Rate","Amount "]),j&&j.length?j.find(e=>e===i)||this.createUnitMeterNumberRow(i,U.length,k):(j.push(i),this.createUnitMeterNumberRow(i,U.length,k)),T.push(e.billTariffDetails[l].season),T.push(e.billTariffDetails[l].weekType),T.push(e.billTariffDetails[l].peakType),T.push(this.decimalPipe.transform(e.billTariffDetails[l].consumption,this.consumptionRoundOffFormat)),T.push(e.billTariffDetails[l].rate),T.push(this.currencyPipe.transform(e.billTariffDetails[l].amount,this.currency.toString(),!0,this.roundFormat)));k.push(T),T=[]}}),this.getBillFormat2Report(I,P,D,["Customer AccountNumber","Billing Period","Previous Due","Total for current period"],w,N,x,A,"Sample Report",O,F,e,R,U,k,E)}getBillFormat2Report(e,t,i,l,n,o,a,s,r,c,u,d,m,h,b,p=!1){var f,g,v,y,C,S;let T=new fe.default({orientation:"portrait",unit:"pt",format:"letter"});const P=null!==(g=null===(f=null==d?void 0:d.client)||void 0===f?void 0:f.clientName)&&void 0!==g?g:"",D=T.getTextWidth(P.trim());T.setTextColor(0,0,0),T.setFontSize(17),T.setFont("Cambria"),T.text(P,Number(T.internal.pageSize.width/2)-Number(0!=D?D/2:0),18),this.addImage(T,d),T.setLineWidth(.1),T.line(Number(T.internal.pageSize.width/2)-Number(0!=D?D/2:0),21,Number(T.internal.pageSize.width/2)-Number(0!=D?D/2:0)+D,21),T.setFontSize(13),T.setLineWidth(.1),T.setFontSize(14),T.text("Billing Statement",30,41),T.autoTable("",o,{startX:10,startY:50,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:150,halign:"left"},1:{cellWidth:190,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"},didParseCell:function(e){e.cell.styles.cellPadding=1}});const w=Number(this.decimalPipe.transform(T.autoTable.previous.finalY,"1.0-0"));T.autoTable("",s,{startX:10,startY:w,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:150,halign:"left"},1:{cellWidth:95,halign:"center"},2:{cellWidth:95,halign:"center"},3:{cellWidth:97,halign:"center"},4:{cellWidth:97,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0]},didParseCell:function(e){e.cell.styles.cellPadding=1}});const N=Number(this.decimalPipe.transform(T.autoTable.previous.finalY,"1.0-0"));T.autoTable("",a,{startX:10,startY:N,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:150,halign:"left"},1:{cellWidth:384,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0]},didParseCell:function(e){e.cell.styles.cellPadding=1}});const x=Number(this.decimalPipe.transform(T.autoTable.previous.finalY,"1.0-0"));T.setFont("Cambria"),T.setFontSize(10),T.text("Meter Read-Outs".toUpperCase(),30,x+15),T.autoTable(e,t,{startX:10,startY:x+30,didDrawPage:function(e){var t="Page "+e.pageCount;T.setFontSize(10);var i=T.internal.pageSize.height||T.internal.pageSize.getHeight();T.text(t,e.settings.margin.left,i-10)},styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:6==e.length?100:4==e.length?182:150,halign:"center"},1:{cellWidth:6==e.length?95:4==e.length?142:120,halign:"center"},2:{cellWidth:4==e.length?105:95,halign:"center"},3:{cellWidth:4==e.length?105:95,halign:"center"},4:{cellWidth:74,halign:"center"},5:{cellWidth:75,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}});const A=Number(this.decimalPipe.transform(T.autoTable.previous.finalY,"1.0-0"));u&&u.length&&(T.setFontSize(10),T.text("Charges Breakdown".toUpperCase(),30,A+15),T.autoTable(c,u,{startX:10,startY:A+30,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{columnWidth:6==c.length?80:4==c.length?214:7==c.length?75:215,halign:"center"},1:{columnWidth:6==c.length?145:4==c.length?160:7==c.length?75:85,halign:"center"},2:{cellWidth:85,halign:"center"},3:{cellWidth:75,halign:4==c.length?"right":"center"},4:{cellWidth:74,halign:6==c.length||7==c.length?"center":"right"},5:{cellWidth:75,halign:"right"},6:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}));const F=Number(this.decimalPipe.transform(T.autoTable.previous.finalY,"1.0-0"));let R=F;p?(T.autoTable(h,b,{startX:10,startY:F+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{columnWidth:4===h.length?200:110,halign:"center"},1:{columnWidth:4===h.length?117:140,halign:"center"},2:{columnWidth:4===h.length?117:97,halign:"center"},3:{columnWidth:4===h.length?100:97,halign:4===h.length?"right":"center"},4:{columnWidth:90,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1;const t=e.cell.raw;t&&"string"==typeof t&&t.startsWith("Unit")&&(e.cell.styles.fontStyle="bold",e.cell.colSpan=h.length,e.cell.styles.halign="left")}}),R=Number(this.decimalPipe.transform(T.autoTable.previous.finalY,"1.0-0"))):(T.autoTable(h,b,{startX:10,startY:F+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{columnWidth:6===h.length?130:85,halign:"center"},1:{columnWidth:6===h.length?85:75,halign:"center"},2:{columnWidth:6===h.length?85:75,halign:"center"},3:{columnWidth:6===h.length?85:75,halign:"center"},4:{columnWidth:74,halign:"center"},5:{columnWidth:75,halign:6===h.length?"right":"center"},6:{columnWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1;const t=e.cell.raw;t&&"string"==typeof t&&t.startsWith("Unit")&&(e.cell.styles.fontStyle="bold",e.cell.colSpan=h.length,e.cell.styles.halign="left")}}),R=Number(this.decimalPipe.transform(T.autoTable.previous.finalY,"1.0-0"))),T.autoTable("",m,{startX:10,startY:R+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{bottom:35,left:230},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:235,fontStyle:"italic"},1:{cellWidth:100}},didParseCell:function(e){1==e.column.index&&(e.cell.styles.halign="right"),e.cell.styles.cellPadding=1},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});const k=Number(this.decimalPipe.transform(T.autoTable.previous.finalY,"1.0-0"));(null===(y=null===(v=null==d?void 0:d.client)||void 0===v?void 0:v.termsConditions[0])||void 0===y?void 0:y.termsAndCondition)&&(T.setFillColor(241,241,244),T.rect(30,k+20,535,80,"FD"),T.setFillColor(0,0,0),T.setFontSize(9),T.text(null===(S=null===(C=null==d?void 0:d.client)||void 0===C?void 0:C.termsConditions[0])||void 0===S?void 0:S.termsAndCondition.replace("{{ClientName}}",d.client.clientName).replace("{{TRNNumber}}",d.client.trnNo).replace("{{Currency}}",this.currency),60,k+30)),T.setTextColor(0,0,0),T.line(5,k+110,607,k+110);let I=T.internal.pageSize.height;if(k>I-190){T.addPage();var O="Page "+T.getNumberOfPages();T.setFontSize(10),T.text(O,10,I-10),I=150}T.text("Notice :- Please tear and attach the slip  along with your payment",30,I-90),T.autoTable(l,n,{startX:10,startY:I-80,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:120,halign:"center"},1:{cellWidth:200,halign:"center"},2:{cellWidth:100,halign:"right"},3:{cellWidth:120,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}});var W=T.output("datauristring");this.pdfsToMerge.push(W)}downloadBillNewFormatReport(e){var t,i,l,n,o,a,s,r,c,u,d;let m=[],h=[],p=[],f=[],g=[],v=[],y=[],C=[],S=["Meter No","Tarif","Previous Reading","Present Reading","Consumption","Unit Rate "+this.currency+"/TR-HR","Amount "];for(let D=0;D<e.bills.length;D++)this.consumptionRoundOffFormat=null!==(t=Object(b.e)("ConsumptionRoundOff",e.bills[D].utilityTypeId))&&void 0!==t?t:this.envService.consumptionRoundOffFormat,m.push(e.bills[D].deviceName),m.push(e.bills[D].utilityType),"BTU"===e.bills[D].utilityType&&e.bills[D].billTransactions&&e.bills[D].billTransactions.length&&e.bills[D].billTransactions.findIndex(e=>e.measuringUnitId&&2===e.measuringUnitId)>-1?(m.push(this.decimalPipe.transform(.284345*e.bills[D].previousReading,this.roundFormat)+" TR-HR"),m.push(this.decimalPipe.transform(.284345*e.bills[D].presentReading,this.roundFormat)+" TR-HR"),m.push(this.decimalPipe.transform(.284345*e.bills[D].consumption,this.roundFormat)+" TR-HR")):(m.push(this.decimalPipe.transform(e.bills[D].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[D].measuringUnit),m.push(this.decimalPipe.transform(e.bills[D].presentReading,this.consumptionRoundOffFormat)+" "+e.bills[D].measuringUnit),m.push(this.decimalPipe.transform(e.bills[D].consumption,this.consumptionRoundOffFormat)+" "+e.bills[D].measuringUnit)),m.push(e.bills[D].consumptionRate),m.push(e.bills[D].billAmountLocal),h.push(m),m=[];for(let D=0;D<e.bills.length;D++){const t=e.bills[D];this.consumptionRoundOffFormat=null!==(i=Object(b.e)("ConsumptionRoundOff",e.bills[D].utilityTypeId))&&void 0!==i?i:this.envService.consumptionRoundOffFormat;for(let e=0;e<t.billTransactions.length;e++)m.push(t.utilityType+"-"+t.billTransactions[e].headDisplay),m.push(this.decimalPipe.transform(t.consumption,this.consumptionRoundOffFormat)),m.push(t.consumptionUnit),m.push(t.billTransactions[e].rate),m.push(this.currencyPipe.transform(t.billTransactions[e].headAmount,this.currency.toString(),!0,this.roundFormat)),y.push(m),m=[]}m.push(e.accountNumber),m.push(e.fromDateLocal+"-"+e.toDateLocal),m.push(e.billAmountLocal),f.push(m);let T=[];e.bills.forEach(e=>{if(e.billTransactions&&e.billTransactions.length){const t=["consumption","consumptioncharge"];e.billTransactions.forEach(e=>{if(!t.includes(e.headDisplay.toLowerCase())){const t=T.find(t=>t.label===e.headDisplay);t?t.value+=e.headAmount:T.push({label:e.headDisplay,value:e.headAmount})}})}}),e.billCharges&&e.billCharges.length&&e.billCharges.sort((e,t)=>e.position-t.position).forEach(e=>{if("VAT"!==e.headDisplay){const t=T.find(t=>t.label===e.headDisplay);t?t.value+=e.headAmount:T.push({label:e.headDisplay,value:e.headAmount})}});let P=0;if(T.forEach(e=>{p.push({label:e.label,value:this.currencyPipe.transform(e.value,this.currency.toString(),!0,this.roundFormat)}),P+=Number(e.value)}),e.billTaxDetails&&e.billTaxDetails.length&&(e.billTaxDetails.forEach(e=>{p.push({label:e.taxDisplayName,value:this.currencyPipe.transform(e.taxAmount,this.currency.toString(),!0,this.roundFormat)}),P+=Number(e.taxAmount)}),e.billDiscounts&&e.billDiscounts.length)){let t=0;e.billDiscounts.forEach(e=>{t+=e.headAmount}),C.push({label:"Total Discount",value:this.currencyPipe.transform(t,this.currency.toString(),!0,this.roundFormat)})}C.push({label:"Total for Current Period",value:this.currencyPipe.transform(e.billAmount+e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)}),g.push({label:"Bill No",value:": "+Object(b.f)(e.billNumber)},{label:"Date of issue",value:": "+Object(b.f)(e.billDateLocal)},{label:"Due Date",value:": "+Object(b.f)(e.dueDateLocal)}),v.push({label:"Billing period",value:`:  From: ${Object(b.f)(e.fromDateLocal)} To: ${Object(b.f)(e.toDateLocal)} `},{label:"Customer Account",value:": "+Object(b.f)(e.accountNumber)},{label:"Customer Name",value:": "+Object(b.f)(e.ownerName)},{label:"Unit No",value:": "+Object(b.f)(e.unitNumber)},{label:"Address",value:": "+Object(b.f)(null===(n=null===(l=null==e?void 0:e.client)||void 0===l?void 0:l.addresses[0])||void 0===n?void 0:n.address1)},{label:"City",value:": "+Object(b.f)(null===(a=null===(o=null==e?void 0:e.client)||void 0===o?void 0:o.addresses[0])||void 0===a?void 0:a.city)},{label:"P.O Box",value:": "+Object(b.f)(null===(r=null===(s=null==e?void 0:e.client)||void 0===s?void 0:s.addresses[0])||void 0===r?void 0:r.zipPostalCode)},{label:"Phone number",value:": "+Object(b.f)(null===(c=null==e?void 0:e.receiverDetails[0])||void 0===c?void 0:c.phoneNumber)},{label:"Fax Number",value:": "},{label:"Client",value:": "+Object(b.f)(null===(u=null==e?void 0:e.client)||void 0===u?void 0:u.clientName)},{label:"Client TRN",value:": "+Object(b.f)(null===(d=null==e?void 0:e.client)||void 0===d?void 0:d.trnNo)}),this.getNewBillFormatReport(S,h,p,["Customer Number","Billing Period","Total for current period"],f,g,v,[],"Sample Report",["Charges","Consumption","Measuring Unit","Tariff","Total"],y,e,C)}getNewBillFormatReport(e,t,i,l,n,o,a,s,r,c,u,d,m){var h,b,p,f;let g=new fe.default({orientation:"portrait",unit:"pt",format:"letter"});g.rect(5,5,g.internal.pageSize.width-10,g.internal.pageSize.height-10,"S"),g.setTextColor(0,0,0),g.setFontSize(11),g.setFont("Cambria"),g.text("Billing Statement".toUpperCase(),10,20),this.addImage(g,d),g.setLineWidth(.1),g.autoTable("",o,{startX:10,startY:35,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:15},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:190,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"},didParseCell:function(e){e.cell.styles.cellPadding=1.5}});const v=Number(this.decimalPipe.transform(g.autoTable.previous.finalY,"1.0-0"));g.autoTable("",a,{startX:10,startY:v,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:15},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:380,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0]},didParseCell:function(e){e.cell.styles.cellPadding=1.5}});const y=Number(this.decimalPipe.transform(g.autoTable.previous.finalY,"1.0-0"));g.setFont("Cambria"),g.text("Meter Read-Out".toUpperCase(),10,y+15),g.autoTable(e,t,{startX:10,startY:y+30,didDrawPage:function(e){var t="Page "+e.pageCount;g.setFontSize(10);var i=g.internal.pageSize.height||g.internal.pageSize.getHeight();g.text(t,e.settings.margin.left,i-10)},styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:15},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:70,halign:"center"},1:{cellWidth:100,halign:"center"},2:{cellWidth:90,halign:"center"},3:{cellWidth:90,halign:"center"},4:{cellWidth:80,halign:"center"},5:{cellWidth:73,halign:"center"},6:{cellWidth:73,halign:"center"},7:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1.5}});const C=Number(this.decimalPipe.transform(g.autoTable.previous.finalY,"1.0-0"));g.autoTable("",i,{startX:10,startY:C+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{bottom:35,left:250},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:250,fontStyle:"italic"},1:{cellWidth:90}},didParseCell:function(e){1==e.column.index&&(e.cell.styles.halign="right"),e.cell.styles.cellPadding=1.5},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});const S=Number(this.decimalPipe.transform(g.autoTable.previous.finalY,"1.0-0"));g.line(5,S+10,607,S+10),g.autoTable("",m,{startX:10,startY:S+20,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{bottom:35,left:250},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:250,fontStyle:"italic"},1:{cellWidth:90}},didParseCell:function(e){1==e.column.index&&(e.cell.styles.halign="right"),e.cell.styles.cellPadding=1.5},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});const T=Number(this.decimalPipe.transform(g.autoTable.previous.finalY,"1.0-0"));g.line(5,T+10,607,T+10),(null===(b=null===(h=null==d?void 0:d.client)||void 0===h?void 0:h.termsConditions[0])||void 0===b?void 0:b.termsAndCondition)&&g.text(null===(f=null===(p=null==d?void 0:d.client)||void 0===p?void 0:p.termsConditions[0])||void 0===f?void 0:f.termsAndCondition.replace("{{ClientName}}",d.client.clientName).replace("{{TRNNumber}}",d.client.trnNo).replace("{{Currency}}",this.currency),10,T+30);var P=g.internal.pageSize.height||g.internal.pageSize.getHeight();g.text("Notice :- Please tear and attach the slip  along with your payment",10,P-60),g.autoTable(l,n,{startX:10,startY:P-40,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:15},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"center"},1:{cellWidth:340,halign:"center"},2:{cellWidth:140,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1.5}});var D=g.output("datauristring");this.pdfsToMerge.push(D)}onRemarksDataRow(e){this.dialog.open(pt,{data:{label:"Rejected Remarks",value:e.rejectedRemarks}}).afterClosed().subscribe(()=>{e&&this.onGetBillsHistory(this.manageParams)})}onFilterDataRow(e){let t=0,i=0,l=0,n=0,o=0;e&&e.length&&e.forEach(e=>{t+=e.billAmount,l+=e.creditNoteAmount,n+=e.netAmount,i+=e.paid,o+=e.balanceAmount}),this.billAmount=this.currencyPipe.transform(t,this.currency.toString(),!0,this.roundFormat),this.creditNoteAmount=this.currencyPipe.transform(l,this.currency.toString(),!0,this.roundFormat),this.netAmount=this.currencyPipe.transform(n,this.currency.toString(),!0,this.roundFormat),this.receivedAmount=this.currencyPipe.transform(i,this.currency.toString(),!0,this.roundFormat),this.balanceAmount=this.currencyPipe.transform(o,this.currency.toString(),!0,this.roundFormat)}onExcelExport(){if(this.billMasterDetails&&this.billMasterDetails.length>0){const e=this.getData(this.billMasterDetails);if(e&&e.length){const t=vt.utils.aoa_to_sheet(e),i=vt.utils.book_new();vt.utils.book_append_sheet(i,t,"Sheet1"),vt.writeFile(i,this.isApproveBills&&!this.isRejectedBills?"ApproveBills.xlsx":"BillHistory.xlsx")}}else this.notificationMessage("No Data to Export","yellow-snackbar")}getData(e){let t=[],i=[],l=[],n=["Bill Number","Bill Date","Account Number","Tenant Name"],o=[],a=[];e.forEach(e=>{e.bills&&e.bills.length&&e.bills.forEach(e=>{e.billTransactions&&e.billTransactions.length&&e.billTransactions.forEach(e=>{o.includes(e.headDisplay)||o.push(e.headDisplay)})}),e.billCharges&&e.billCharges.length&&e.billCharges.forEach(e=>{a.includes(e.headDisplay)||a.push(e.headDisplay)})}),o.forEach(e=>{n.push(e)}),a.forEach(e=>{n.push(e)}),n.push("Bill Amount ","Paid ");let s=0,r=0;for(let c=0;c<e.length;c++)i.push(e[c].billNumber),i.push(e[c].billDateLocal),i.push(e[c].accountNumber),i.push(e[c].ownerName),o.forEach(t=>{if(e[c].bills&&e[c].bills.length){const l=e[c].bills.filter(e=>1==e.isDifferentiateBill);if(l&&l.length&&e[c].bills.length==l.length)if(l[l.length-1].billTransactions&&l[l.length-1].billTransactions.length){const e=l[l.length-1].billTransactions.find(e=>e.headDisplay.toLowerCase()===t.toLowerCase());i.push(this.currencyPipe.transform(e?e.headAmount:0,this.currency.toString(),!0,this.roundFormat))}else i.push(this.currencyPipe.transform(0,this.currency.toString(),!0,this.roundFormat));else if(e[c].isGroupBill){let l=0;e[c].bills.forEach(e=>{if(e.billTransactions&&e.billTransactions.length){const i=e.billTransactions.find(e=>e.headDisplay.toLowerCase()===t.toLowerCase());i&&(l+=i.headAmount)}}),i.push(this.currencyPipe.transform(l>0?l:0,this.currency.toString(),!0,this.roundFormat))}else{let l=0;e[c].bills.forEach(e=>{if(e.billTransactions&&e.billTransactions.length){const i=e.billTransactions.find(e=>e.headDisplay.toLowerCase()===t.toLowerCase());i&&(l+=i.headAmount)}}),i.push(this.currencyPipe.transform(l>0?l:0,this.currency.toString(),!0,this.roundFormat))}}else i.push(this.currencyPipe.transform(0,this.currency.toString(),!0,this.roundFormat))}),a.forEach(t=>{if(e[c].isGroupBill){let l=0;if(e[c].billCharges&&e[c].billCharges.length){const i=e[c].billCharges.filter(e=>e.headDisplay.toLowerCase()===t.toLowerCase());i&&i.length&&i.forEach(e=>{l+=Number(e.headAmount)})}i.push(this.currencyPipe.transform(l>0?l:0,this.currency.toString(),!0,this.roundFormat))}else if(e[c].billCharges&&e[c].billCharges.length){const l=e[c].billCharges.find(e=>e.headDisplay.toLowerCase()===t.toLowerCase());i.push(this.currencyPipe.transform(l?l.headAmount:0,this.currency.toString(),!0,this.roundFormat))}else i.push(this.currencyPipe.transform(0,this.currency.toString(),!0,this.roundFormat))}),i.push(this.currencyPipe.transform(e[c].billAmount,this.currency.toString(),!0,this.roundFormat)),i.push(this.currencyPipe.transform(e[c].paid,this.currency.toString(),!0,this.roundFormat)),l.push(i),s+=e[c].billAmount,r+=e[c].paid,i=[];for(let c=0;c<n.length-2;c++)i.push("");return i.push(this.currencyPipe.transform(s,this.currency.toString(),!0,this.roundFormat)),i.push(this.currencyPipe.transform(r,this.currency.toString(),!0,this.roundFormat)),l.push(i),i=[],n.forEach(e=>{i.push(e)}),t.push(i),l.forEach(e=>{t.push(e)}),t}downloadBillFormat1Report(e){var t,i;let l=[],n=[],o=[],a=[],s=[],r=[],c=[],u=[],d=["Unit No","Meter No","Previous Reading","Present Reading","Consumption"],m=["Bill No","Meter No","Charges","Consumption","Measuring Unit","Tariff","Total"],h="";e.bills.forEach(e=>{h+=e.deviceName+","}),s.push({label:"Account Number:",value:e.accountNumber},{label:"Meter Number:",value:h.slice(0,-1)},{label:"Unit Number:",value:e.unitNumber},{label:"Billing Date:",value:e.billDateLocal},{label:"Due Date:",value:e.dueDateLocal},{label:"Bill Period",value:`${Object(b.f)(e.fromDateLocal)} - ${Object(b.f)(e.toDateLocal)} `});let p=!1,f=!1,g=!1,v=!1;if(e&&e.bills&&e.bills.length){const t=Array.from(new Set(e.bills.map(e=>e.billNumber))),i=Array.from(new Set(e.bills.map(e=>e.unitNumber))),l=Array.from(new Set(e.bills.map(e=>e.deviceName)));if(p=!!(t&&t.length>1),f=!!(i&&i.length>1),g=!!(l&&l.length>1),!g){const e=m.findIndex(e=>"Meter No"===e);e>-1&&m.splice(e,1)}if(p||m.splice(0,1),f){const e=s.findIndex(e=>"Unit Number:"===e.label);s.splice(e,1)}else d.splice(0,1);const n=Array.from(new Set(e.bills.filter(e=>e.billTariffDetails&&e.billTariffDetails.length))),o=Array.from(new Set(e.bills.filter(e=>!e.billTariffDetails||0===e.billTariffDetails.length)));if(o&&o.length&&o&&o.length&&(v=!0),o&&o.length&&!n&&(v=!0),n&&n.length&&(!o||0==o.length))for(let e=0;e<n.length;e++)if(n[e].billTransactions.find(e=>!e.tariffId)){v=!0;break}}if(!v){const e=m.findIndex(e=>"Tariff"===e);e&&m.splice(e,1)}for(let P=0;P<e.bills.length;P++){if(this.consumptionRoundOffFormat=null!==(t=Object(b.e)("ConsumptionRoundOff",e.bills[P].utilityTypeId))&&void 0!==t?t:this.envService.consumptionRoundOffFormat,f&&l.push(e.unitNumber),l.push(e.bills[P].deviceName),l.push(this.decimalPipe.transform(e.bills[P].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[P].measuringUnit),l.push(this.decimalPipe.transform(e.bills[P].presentReading,this.consumptionRoundOffFormat)+" "+e.bills[P].measuringUnit),e.bills[P].isDifferentiateBill){if(g){g=!1;const e=m.findIndex(e=>"Meter No"===e);e>-1&&m.splice(e,1)}l.push(this.decimalPipe.transform(e.bills[P].presentReading-e.bills[P].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[P].measuringUnit)}else l.push(this.decimalPipe.transform(e.bills[P].consumption,this.consumptionRoundOffFormat)+" "+e.bills[P].measuringUnit);"BTU"===e.bills[P].utilityType&&e.bills[P].billTransactions&&e.bills[P].billTransactions.length&&e.bills[P].billTransactions.findIndex(e=>e.measuringUnitId&&2===e.measuringUnitId)>-1&&(0==P&&d.push("Consumption TR-HR"),l.push(this.decimalPipe.transform(.284345*e.bills[P].consumption,this.consumptionRoundOffFormat))),n.push(l),l=[]}let y=0;for(let P=0;P<e.bills.length;P++){const t=e.bills[P];this.consumptionRoundOffFormat=null!==(i=Object(b.e)("ConsumptionRoundOff",e.bills[P].utilityTypeId))&&void 0!==i?i:this.envService.consumptionRoundOffFormat;for(let e=0;e<t.billTransactions.length;e++)p&&l.push(t.billNumber),l.push(t.deviceName),l.push(t.billTransactions[e].headDisplay),"BTU"===t.utilityType&&t.billTransactions&&t.billTransactions.length&&t.billTransactions[e]&&t.billTransactions[e].measuringUnitId&&2===t.billTransactions[e].measuringUnitId?(l.push(this.decimalPipe.transform(.284345*t.consumption,this.consumptionRoundOffFormat)),l.push("TR-HR"),v&&t.billTariffDetails&&t.billTariffDetails.length&&t.billTransactions[e].tariffId?l.push("-"):v&&l.push(t.billTransactions[e].rate)):(l.push(this.decimalPipe.transform(t.consumption,this.consumptionRoundOffFormat)),l.push(t.measuringUnit),v&&t.billTariffDetails&&t.billTariffDetails.length&&t.billTransactions[e].tariffId?l.push("-"):v&&l.push(t.billTransactions[e].rate)),l.push(this.currencyPipe.transform(t.billTransactions[e].headAmount,this.currency.toString(),!0,this.roundFormat)),c.push(l),l=[],y+=t.billTransactions[e].headAmount}if(l.push(e.accountNumber),l.push(e.fromDateLocal+"-"+e.toDateLocal),l.push(this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)),l.push(e.billAmountLocal),a.push(l),e.billCharges&&e.billCharges.length&&(e.billCharges.sort((e,t)=>e.position-t.position).forEach(e=>{if("VAT"!==e.headDisplay){const t=o.find(t=>t.label===e.headDisplay);t?t.value+=e.headAmount:o.push({label:e.headDisplay,value:e.headAmount})}}),o.forEach(e=>{r.push({label:e.label,value:this.currencyPipe.transform(e.value,this.currency.toString(),!0,this.roundFormat)})})),r.push({label:"Current Month Total Consumption Charge:",value:this.currencyPipe.transform(y,this.currency.toString(),!0,this.roundFormat)}),e.billDiscounts&&e.billDiscounts.length){let t=0;e.billDiscounts.forEach(e=>{t+=e.headAmount}),r.push({label:"Total Discount",value:this.currencyPipe.transform(t,this.currency.toString(),!0,this.roundFormat)})}e.billTaxDetails&&e.billTaxDetails.length?e.billTaxDetails.forEach(e=>{r.push({label:e.taxDisplayName,value:this.currencyPipe.transform(e.taxAmount,this.currency.toString(),!0,this.roundFormat)})}):r.push({label:"TAX:",value:this.currencyPipe.transform(0,this.currency.toString(),!0,this.roundFormat)}),r.push({label:"Current Month + TAX:",value:e.billAmountLocal},{label:"Previous Bill Outstanding Balance:",value:this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)},{label:"Total Due incl TAX:",value:this.currencyPipe.transform(e.billAmount+e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)});Array.from(new Set(e.bills.map(e=>e.billTariffDetails)));let C=[],S=!1,T=[];l=[],e&&e.bills&&e.bills.length&&e.bills.forEach(e=>{var t;this.consumptionRoundOffFormat=null!==(t=Object(b.e)("ConsumptionRoundOff",e.utilityTypeId))&&void 0!==t?t:this.envService.consumptionRoundOffFormat,T=[];let i="Unit Number : "+e.unitNumber+" - Meter Number : "+e.deviceName;if(e.billTariffDetails&&e.billTariffDetails.length)for(let n=0;n<e.billTariffDetails.length;n++){if(e.billTariffDetails[n].slabSettingsId&&e.billTariffDetails[n].slabSettingsId>0){let t=e.billTariffDetails[n].season;Number(e.billTariffDetails[n].peakType)<Number(e.billTariffDetails[n].consumption)&&(t=e.billTariffDetails[n].peakType+" - "+e.billTariffDetails[n].consumption),0==n&&(S=!0,C=["Slab","Consumption","Rate","Amount "]),T&&T.length?T.find(e=>e===i)||this.createUnitMeterNumberRow(i,C.length,u):(T.push(i),this.createUnitMeterNumberRow(i,C.length,u)),l.push(t),l.push(this.decimalPipe.transform(e.billTariffDetails[n].consumption,this.consumptionRoundOffFormat)),l.push(e.billTariffDetails[n].rate),l.push(this.currencyPipe.transform(e.billTariffDetails[n].amount,this.currency.toString(),!0,this.roundFormat))}else 0==e.billTariffDetails[n].slabSettingsId&&(0==n&&(C=["Season","Week Type","Peak Type","Consumption","Rate","Amount "]),T&&T.length?T.find(e=>e===i)||this.createUnitMeterNumberRow(i,C.length,u):(T.push(i),this.createUnitMeterNumberRow(i,C.length,u)),l.push(e.billTariffDetails[n].season),l.push(e.billTariffDetails[n].weekType),l.push(e.billTariffDetails[n].peakType),l.push(this.decimalPipe.transform(e.billTariffDetails[n].consumption,this.consumptionRoundOffFormat)),l.push(e.billTariffDetails[n].rate),l.push(this.currencyPipe.transform(e.billTariffDetails[n].amount,this.currency.toString(),!0,this.roundFormat)));u.push(l),l=[]}}),this.getNewBillFormat1Report(d,n,o,["Customer AccountNumber","Billing Period","Previous Due","Total for current period"],a,[],s,r,"Invoice",m,c,e,[],C,u,S)}getNewBillFormat1Report(e,t,i,l,n,o,a,s,r,c,u,d,m,h,p,f=!1){var g,v,y,C,S,T,P,D,w,N,x,A,F,R,k,I,O,W,M,L,B,z;let U=new fe.default({orientation:"portrait",unit:"pt",format:"letter"});U.rect(5,5,U.internal.pageSize.width-10,U.internal.pageSize.height-10,"S"),U.setFontSize(30),U=this.addImage(U,d),U.setTextColor(0,0,0),U.setFontSize(16),U.setFont("Cambria","bold"),U.text("Tax Invoice",260,30),U.setFontSize(13),U.setFont("Cambria","normal"),U.text(d.client.clientName.toUpperCase(),10,60),U.setFontSize(10),U.setFont("Cambria"),U.text("TRN: "+d.client.trnNo,10,70),U.text("PO Box "+d.client.addresses[0].zipPostalCode,10,80),U.text(d.client.addresses[0].address1+","+d.client.addresses[0].country,10,90),U.text("Phone: "+d.client.phoneNo,10,100),U.text("Email: "+d.client.email+", Web: "+d.client.website,10,110),U.setFontSize(10),U.setFont("bold"),U.text("Invoice#: ".toUpperCase(),370,110),U.setTextColor(25,118,210);const E=U.getTextWidth("Invoice#: ");let j="";(null==d?void 0:d.billNumber)&&(j=null===(g=d.billNumber)||void 0===g?void 0:g.toUpperCase()),U.text(j,380+E,110),U.setFont("none"),U.setTextColor(0,0,0),U.setFontSize(9),U.autoTable("",a,{startY:120,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:370},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:80,halign:"left"},1:{cellWidth:150,halign:"right"}},didParseCell:function(e){e.cell.styles.cellPadding=6===e.length?1.8:2.7},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});const H=Number(this.decimalPipe.transform(U.autoTable.previous.finalY,"1.0-0"));if(U.setLineWidth(.1),U.line(5,H+5,607,H+5),U.setFont("Cambria"),U.setFillColor(241,241,244),U.setDrawColor(206,203,203),U.rect(10,120,340,H-120,"FD"),U.setTextColor(0,0,0),U.setFontSize(12),U.text(null==d?void 0:d.ownerName.toUpperCase(),20,135),U.text("CUSTOMER TRN: "+d.trn,20,150),U.text("unit #"+d.unitNumber,20,165),U.setFontSize(10),U.text(d.clientName,20,180),U.text(Object(b.f)(null===(v=null==d?void 0:d.client)||void 0===v?void 0:v.buildingName,",")+Object(b.f)(null===(C=null===(y=null==d?void 0:d.client)||void 0===y?void 0:y.addresses[0])||void 0===C?void 0:C.location,",")+Object(b.f)(null===(T=null===(S=null==d?void 0:d.client)||void 0===S?void 0:S.addresses[0])||void 0===T?void 0:T.city,",")+Object(b.f)(null===(D=null===(P=null==d?void 0:d.client)||void 0===P?void 0:P.addresses[0])||void 0===D?void 0:D.country,","),20,195),U.setFontSize(10),U.text("Meter Read-Outs".toUpperCase(),10,H+20),U.autoTable(e,t,{startX:10,startY:H+35,didDrawPage:function(e){var t="Page "+e.pageCount;U.setFontSize(10);var i=U.internal.pageSize.height||U.internal.pageSize.getHeight();U.text(t,e.settings.margin.left,i-10)},styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:6==e.length?120:4==e.length?200:155,halign:"center"},1:{cellWidth:6==e.length?100:4==e.length?135:125,halign:"center"},2:{cellWidth:6==e.length?100:4==e.length?135:125,halign:"center"},3:{cellWidth:4==e.length?120:100,halign:"center"},4:{cellWidth:85,halign:"center"},5:{cellWidth:85,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}),u&&u.length){const e=Number(this.decimalPipe.transform(U.autoTable.previous.finalY,"1.0-0"));U.setFontSize(10),U.text("Charges Breakdown".toUpperCase(),10,e+15),U.autoTable(c,u,{startX:10,startY:e+30,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{columnWidth:6==c.length?80:4==c.length?230:7==c.length?70:200,halign:"center"},1:{columnWidth:6==c.length?180:4==c.length?130:7==c.length?70:100,halign:"center"},2:{columnWidth:6==c.length?90:4==c.length?130:7==c.length?140:100,halign:"center"},3:{columnWidth:6==c.length||4==c.length?90:7==c.length?70:100,halign:4==c.length?"right":"center"},4:{cellWidth:75,halign:6==c.length||7==c.length?"center":"right"},5:{cellWidth:75,halign:7==c.length?"center":"right"},6:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}})}const Y=Number(this.decimalPipe.transform(U.autoTable.previous.finalY,"1.0-0"));let V=Y;f?(U.autoTable(h,p,{startX:10,startY:Y+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{columnWidth:4===h.length?250:120,halign:"center"},1:{columnWidth:4===h.length?120:150,halign:"center"},2:{columnWidth:120,halign:"center"},3:{columnWidth:100,halign:4===h.length?"right":"center"},4:{columnWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1;const t=e.cell.raw;t&&"string"==typeof t&&t.startsWith("Unit")&&(e.cell.styles.fontStyle="bold",e.cell.colSpan=h.length,e.cell.styles.halign="left")}}),V=Number(this.decimalPipe.transform(U.autoTable.previous.finalY,"1.0-0"))):(U.autoTable(h,p,{startX:10,startY:Y+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{columnWidth:6===h.length?140:100,halign:"center"},1:{columnWidth:100,halign:"center"},2:{columnWidth:6===h.length?100:80,halign:"center"},3:{columnWidth:6===h.length?100:80,halign:"center"},4:{columnWidth:75,halign:"center"},5:{columnWidth:75,halign:6===h.length?"right":"center"},6:{columnWidth:80,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1;const t=e.cell.raw;t&&"string"==typeof t&&t.startsWith("Unit")&&(e.cell.styles.fontStyle="bold",e.cell.colSpan=h.length,e.cell.styles.halign="left")}}),V=Number(this.decimalPipe.transform(U.autoTable.previous.finalY,"1.0-0"))),U.setTextColor(25,118,210),U.setFontSize(12),U.text("Bank Payment Account Details",10,V+20),U.setTextColor(0,0,0),U.setFontSize(9),U.text("Account Title: "+Object(b.f)(null===(N=null===(w=null==d?void 0:d.client)||void 0===w?void 0:w.bankDetails[0])||void 0===N?void 0:N.accountName),10,V+40),U.text("Account #: "+Object(b.f)(null===(A=null===(x=null==d?void 0:d.client)||void 0===x?void 0:x.bankDetails[0])||void 0===A?void 0:A.accountNo),10,V+50),U.text("IBAN #: "+Object(b.f)(null===(R=null===(F=null==d?void 0:d.client)||void 0===F?void 0:F.bankDetails[0])||void 0===R?void 0:R.ibanNumber),10,V+60),U.text("Bank Name: "+Object(b.f)(null===(I=null===(k=null==d?void 0:d.client)||void 0===k?void 0:k.bankDetails[0])||void 0===I?void 0:I.bankName),10,V+70),U.text("Swift Code: "+ +Object(b.f)(null===(W=null===(O=null==d?void 0:d.client)||void 0===O?void 0:O.bankDetails[0])||void 0===W?void 0:W.swiftCode),10,V+80),U.setFontSize(9),U.autoTable("",s,{startX:300,startY:V+20,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:320},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:180,halign:"left"},1:{cellWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"},didParseCell:function(e){e.cell.styles.cellPadding=1.8}});const _=Number(this.decimalPipe.transform(U.autoTable.previous.finalY,"1.0-0"));let G=U.internal.pageSize.height;if(_+110>G-190){U.addPage(),U.rect(5,5,U.internal.pageSize.width-10,U.internal.pageSize.height-10,"S");var X="Page "+U.getNumberOfPages();U.setFontSize(10),U.text(X,10,G-10),G=230}(null===(L=null===(M=null==d?void 0:d.client)||void 0===M?void 0:M.termsConditions[0])||void 0===L?void 0:L.termsAndCondition)&&(U.setFillColor(241,241,244),U.rect(10,G-190,590,90,"FD"),U.setFillColor(0,0,0),U.setFontSize(9),U.text(null===(z=null===(B=null==d?void 0:d.client)||void 0===B?void 0:B.termsConditions[0])||void 0===z?void 0:z.termsAndCondition.replace("{{ClientName}}",d.client.clientName).replace("{{TRNNumber}}",d.client.trnNo).replace("{{Currency}}",this.currency),40,G-175)),U.setTextColor(0,0,0),U.line(5,G-95,607,G-95),U.text("Notice :- Please tear and attach the slip  along with your payment",10,G-60),U.autoTable(l,n,{startX:10,startY:G-65,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:130,halign:"center"},1:{cellWidth:210,halign:"center"},2:{cellWidth:110,halign:"right"},3:{cellWidth:140,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}});var $=U.output("datauristring");this.pdfsToMerge.push($)}downloadBillFormat3Report(e){var t,i,l,n,o,a,s,r,c,u,d;let m=[],h=[],p=[],f=[],g=[],v=[],y=[],C=[],S=[],T=["Unit No","Meter No","Previous Reading","Present Reading","Consumption"],P=["Bill No","Meter No","Charges","Consumption","Measuring Unit","Tariff","Total"];g.push({label:"Bill No",value:": "+Object(b.f)(e.billNumber)},{label:"Date of issue",value:": "+Object(b.f)(e.billDateLocal)},{label:"Due Date",value:": "+Object(b.f)(e.dueDateLocal)}),v.push({label:"Billing period",value:`: From: ${Object(b.f)(e.fromDateLocal)} To: ${Object(b.f)(e.toDateLocal)} `},{label:"Customer Account",value:": "+Object(b.f)(e.accountNumber)},{label:"Customer Name",value:": "+Object(b.f)(e.ownerName)},{label:"Unit No",value:": "+Object(b.f)(e.unitNumber)},{label:"Address",value:": "+Object(b.f)(null===(i=null===(t=null==e?void 0:e.client)||void 0===t?void 0:t.addresses[0])||void 0===i?void 0:i.address1)},{label:"City",value:": "+Object(b.f)(null===(n=null===(l=null==e?void 0:e.client)||void 0===l?void 0:l.addresses[0])||void 0===n?void 0:n.city)},{label:"P.O Box",value:": "+Object(b.f)(null===(a=null===(o=null==e?void 0:e.client)||void 0===o?void 0:o.addresses[0])||void 0===a?void 0:a.zipPostalCode)},{label:"Phone number",value:": "+Object(b.f)(null===(s=null==e?void 0:e.receiverDetails[0])||void 0===s?void 0:s.phoneNumber)},{label:"Fax Number",value:": "},{label:"Client",value:": "+Object(b.f)(null===(r=null==e?void 0:e.client)||void 0===r?void 0:r.clientName)},{label:"Client TRN",value:": "+Object(b.f)(null===(c=null==e?void 0:e.client)||void 0===c?void 0:c.trnNo)});let D=!1,w=!1,N=!1,x=!1;if(e&&e.bills&&e.bills.length){const t=Array.from(new Set(e.bills.map(e=>e.billNumber))),i=Array.from(new Set(e.bills.map(e=>e.unitNumber))),l=Array.from(new Set(e.bills.map(e=>e.deviceName)));if(D=!!(t&&t.length>1),w=!!(i&&i.length>1),x=!!(l&&l.length>1),!x){const e=P.findIndex(e=>"Meter No"===e);e>-1&&P.splice(e,1)}if(D?g.splice(0,1):P.splice(0,1),w){const e=v.findIndex(e=>"Unit No"===e.label);v.splice(e,1)}else T.splice(0,1);const n=Array.from(new Set(e.bills.filter(e=>e.billTariffDetails&&e.billTariffDetails.length))),o=Array.from(new Set(e.bills.filter(e=>!e.billTariffDetails||0===e.billTariffDetails.length)));if(o&&o.length&&o&&o.length&&(N=!0),o&&o.length&&!n&&(N=!0),n&&n.length&&(!o||0==o.length))for(let e=0;e<n.length;e++)if(n[e].billTransactions.find(e=>!e.tariffId)){N=!0;break}}if(!N){const e=P.findIndex(e=>"Tariff"===e);e&&P.splice(e,1)}for(let W=0;W<e.bills.length;W++){if(this.consumptionRoundOffFormat=null!==(u=Object(b.e)("ConsumptionRoundOff",e.bills[W].utilityTypeId))&&void 0!==u?u:this.envService.consumptionRoundOffFormat,w&&m.push(e.unitNumber),m.push(e.bills[W].deviceName),m.push(this.decimalPipe.transform(e.bills[W].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[W].measuringUnit),m.push(this.decimalPipe.transform(e.bills[W].presentReading,this.consumptionRoundOffFormat)+" "+e.bills[W].measuringUnit),e.bills[W].isDifferentiateBill){if(x){x=!1;const e=P.findIndex(e=>"Meter No"===e);e>-1&&P.splice(e,1)}m.push(this.decimalPipe.transform(e.bills[W].presentReading-e.bills[W].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[W].measuringUnit)}else m.push(this.decimalPipe.transform(e.bills[W].consumption,this.consumptionRoundOffFormat)+" "+e.bills[W].measuringUnit);"BTU"===e.bills[W].utilityType&&e.bills[W].billTransactions&&e.bills[W].billTransactions.length&&e.bills[W].billTransactions.findIndex(e=>e.measuringUnitId&&2===e.measuringUnitId)>-1&&(0==W&&T.push("Consumption TR-HR"),m.push(this.decimalPipe.transform(.284345*e.bills[W].consumption,this.consumptionRoundOffFormat))),h.push(m),m=[]}let A=0;for(let W=0;W<e.bills.length;W++){const t=e.bills[W];this.consumptionRoundOffFormat=null!==(d=Object(b.e)("ConsumptionRoundOff",e.bills[W].utilityTypeId))&&void 0!==d?d:this.envService.consumptionRoundOffFormat;for(let e=0;e<t.billTransactions.length;e++)D&&m.push(t.billNumber),x&&m.push(t.deviceName),m.push(t.billTransactions[e].headDisplay),"BTU"===t.utilityType&&t.billTransactions&&t.billTransactions.length&&t.billTransactions[e]&&t.billTransactions[e].measuringUnitId&&2===t.billTransactions[e].measuringUnitId?(m.push(this.decimalPipe.transform(.284345*t.consumption,this.consumptionRoundOffFormat)),m.push("TR-HR"),N&&t.billTariffDetails&&t.billTariffDetails.length&&t.billTransactions[e].tariffId?m.push("-"):N&&m.push(t.billTransactions[e].rate)):(m.push(this.decimalPipe.transform(t.consumption,this.consumptionRoundOffFormat)),m.push(t.measuringUnit),N&&t.billTariffDetails&&t.billTariffDetails.length&&t.billTransactions[e].tariffId?m.push("-"):N&&m.push(t.billTransactions[e].rate)),m.push(this.currencyPipe.transform(t.billTransactions[e].headAmount,this.currency.toString(),!0,this.roundFormat)),y.push(m),m=[],A+=t.billTransactions[e].headAmount}m.push(e.accountNumber),m.push(e.fromDateLocal+"-"+e.toDateLocal),m.push(this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)),m.push(e.billAmountLocal),f.push(m);let F="";e.bills.forEach(e=>{F+=e.deviceName+","});Array.from(new Set(e.bills.map(e=>e.billTariffDetails)));let R=[],k=!1,I=[];m=[],e&&e.bills&&e.bills.length&&e.bills.forEach(e=>{var t;this.consumptionRoundOffFormat=null!==(t=Object(b.e)("ConsumptionRoundOff",e.utilityTypeId))&&void 0!==t?t:this.envService.consumptionRoundOffFormat,I=[];let i="Unit Number : "+e.unitNumber+" - Meter Number : "+e.deviceName;if(e.billTariffDetails&&e.billTariffDetails.length)for(let l=0;l<e.billTariffDetails.length;l++){if(e.billTariffDetails[l].slabSettingsId&&e.billTariffDetails[l].slabSettingsId>0){let t=e.billTariffDetails[l].season;Number(e.billTariffDetails[l].peakType)<Number(e.billTariffDetails[l].consumption)&&(t=e.billTariffDetails[l].peakType+" - "+e.billTariffDetails[l].consumption),0==l&&(k=!0,R=["Slab","Consumption","Rate","Amount "]),I&&I.length?I.find(e=>e===i)||this.createUnitMeterNumberRow(i,R.length,S):(I.push(i),this.createUnitMeterNumberRow(i,R.length,S)),m.push(t),m.push(this.decimalPipe.transform(e.billTariffDetails[l].consumption,this.consumptionRoundOffFormat)),m.push(e.billTariffDetails[l].rate),m.push(this.currencyPipe.transform(e.billTariffDetails[l].amount,this.currency.toString(),!0,this.roundFormat))}else 0==e.billTariffDetails[l].slabSettingsId&&(0==l&&(R=["Season","Week Type","Peak Type","Consumption","Rate","Amount "]),I&&I.length?I.find(e=>e===i)||this.createUnitMeterNumberRow(i,R.length,S):(I.push(i),this.createUnitMeterNumberRow(i,R.length,S)),m.push(e.billTariffDetails[l].season),m.push(e.billTariffDetails[l].weekType),m.push(e.billTariffDetails[l].peakType),m.push(this.decimalPipe.transform(e.billTariffDetails[l].consumption,this.consumptionRoundOffFormat)),m.push(e.billTariffDetails[l].rate),m.push(this.currencyPipe.transform(e.billTariffDetails[l].amount,this.currency.toString(),!0,this.roundFormat)));S.push(m),m=[]}});let O=[];if(e.billCharges&&e.billCharges.length&&e.billCharges.sort((e,t)=>e.position-t.position).forEach(e=>{if("VAT"!==e.headDisplay){const t=O.find(t=>t.label===e.headDisplay);t?t.value+=e.headAmount:O.push({label:e.headDisplay,value:e.headAmount})}}),O.forEach(e=>{p.push({label:e.label,value:this.currencyPipe.transform(e.value,this.currency.toString(),!0,this.roundFormat)})}),e.billTaxDetails&&e.billTaxDetails.length&&e.billTaxDetails.forEach(e=>{p.push({label:e.taxDisplayName,value:this.currencyPipe.transform(e.taxAmount,this.currency.toString(),!0,this.roundFormat)})}),p.push({label:"Total consumption charge for Current Period",value:this.currencyPipe.transform(A,this.currency.toString(),!0,this.roundFormat)}),e.billDiscounts&&e.billDiscounts.length){let t=0;e.billDiscounts.forEach(e=>{t+=e.headAmount}),p.push({label:"Total Discount",value:this.currencyPipe.transform(t,this.currency.toString(),!0,this.roundFormat)})}p.push({label:"Previous Outstanding Amount",value:this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)}),C.push({label:"Total for Current Period",value:this.currencyPipe.transform(e.billAmount+e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)}),this.getNewBillFormat3Report(T,h,p,["Customer AccountNumber","Billing Period","Previous Due","Total for current period"],f,g,v,[],"Invoice",P,y,e,C,R,S,k)}getNewBillFormat3Report(e,t,i,l,n,o,a,s,r,c,u,d,m,h,b,p=!1){var f,g,v,y;let C=new fe.default({orientation:"portrait",unit:"pt",format:"letter"});C.rect(5,5,C.internal.pageSize.width-10,C.internal.pageSize.height-10,"S"),C.setTextColor(0,0,0),C.setFontSize(11),C.setFont("Cambria"),C.text("Billing Statement".toUpperCase(),10,20),this.addImage(C,d),C.setLineWidth(.1),C.autoTable("",o,{startX:10,startY:35,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:15},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:190,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"},didParseCell:function(e){e.cell.styles.cellPadding=1.5}});const S=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"));C.autoTable("",a,{startX:10,startY:S,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:15},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:380,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0]},didParseCell:function(e){e.cell.styles.cellPadding=1.5}});const T=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"));C.setFont("Cambria"),C.setFontSize(10),C.text("Meter Read-Outs".toUpperCase(),10,T+15),C.autoTable(e,t,{startX:10,startY:T+30,didDrawPage:function(e){var t="Page "+e.pageCount;"function"==typeof C.putTotalPages&&(t+=" of 1",C.rect(5,5,C.internal.pageSize.width-10,C.internal.pageSize.height-10,"S")),C.setFontSize(9);var i=C.internal.pageSize.height||C.internal.pageSize.getHeight();C.text(t,e.settings.margin.left,i-10)},styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:6==e.length?120:4==e.length?200:155,halign:"center"},1:{cellWidth:6==e.length?100:4==e.length?135:125,halign:"center"},2:{cellWidth:6==e.length?100:4==e.length?135:125,halign:"center"},3:{cellWidth:4==e.length?120:100,halign:"center"},4:{cellWidth:85,halign:"center"},5:{cellWidth:85,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}});const P=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"));u&&u.length&&(C.setFontSize(10),C.text("Charges Breakdown".toUpperCase(),10,P+15),C.autoTable(c,u,{startX:10,startY:P+30,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{columnWidth:6==c.length?80:4==c.length?230:7===c.length?70:200,halign:"center"},1:{columnWidth:6==c.length?180:4==c.length?130:7===c.length?70:100,halign:"center"},2:{columnWidth:6==c.length?90:4==c.length?130:7===c.length?140:100,halign:"center"},3:{columnWidth:6==c.length?90:4==c.length?100:7===c.length?70:100,halign:4==c.length?"right":"center"},4:{cellWidth:5==c.length?90:65,halign:6==c.length||7==c.length?"center":"right"},5:{cellWidth:50,halign:7==c.length?"center":"right"},6:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}));const D=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"));let w=D;p?(C.autoTable(h,b,{startX:10,startY:D+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:20},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{columnWidth:4===h.length?250:120,halign:"center"},1:{columnWidth:4===h.length?120:150,halign:"center"},2:{columnWidth:120,halign:"center"},3:{columnWidth:100,halign:4===h.length?"right":"center"},4:{columnWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1;const t=e.cell.raw;t&&"string"==typeof t&&t.startsWith("Unit")&&(e.cell.styles.fontStyle="bold",e.cell.colSpan=h.length,e.cell.styles.halign="left")}}),w=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"))):(C.autoTable(h,b,{startX:10,startY:D+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{columnWidth:6===h.length?140:100,halign:"center"},1:{columnWidth:100,halign:"center"},2:{columnWidth:6===h.length?100:80,halign:"center"},3:{columnWidth:6===h.length?100:80,halign:"center"},4:{columnWidth:75,halign:"center"},5:{columnWidth:75,halign:6===h.length?"right":"center"},6:{columnWidth:80,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1;const t=e.cell.raw;t&&"string"==typeof t&&t.startsWith("Unit")&&(e.cell.styles.fontStyle="bold",e.cell.colSpan=h.length,e.cell.styles.halign="left")}}),w=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"))),C.autoTable("",i,{startX:10,startY:w+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{bottom:35,left:250},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:250,fontStyle:"italic"},1:{cellWidth:90}},didParseCell:function(e){1==e.column.index&&(e.cell.styles.halign="right"),e.cell.styles.cellPadding=1.5},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});const N=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"));C.line(5,N+10,607,N+10),C.autoTable("",m,{startX:10,startY:N+20,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{bottom:35,left:250},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:250,fontStyle:"italic"},1:{cellWidth:90}},didParseCell:function(e){1==e.column.index&&(e.cell.styles.halign="right"),e.cell.styles.cellPadding=1.5},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});const x=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"));C.line(5,x+10,607,x+10);let A=C.internal.pageSize.height;x+110>A-190&&(C.addPage(),C.rect(5,5,C.internal.pageSize.width-10,C.internal.pageSize.height-10,"S"),A=230),(null===(g=null===(f=null==d?void 0:d.client)||void 0===f?void 0:f.termsConditions[0])||void 0===g?void 0:g.termsAndCondition)&&(C.setFillColor(241,241,244),C.rect(10,A-190,590,90,"FD"),C.setFillColor(0,0,0),C.setFontSize(9),C.text(null===(y=null===(v=null==d?void 0:d.client)||void 0===v?void 0:v.termsConditions[0])||void 0===y?void 0:y.termsAndCondition.replace("{{ClientName}}",d.client.clientName).replace("{{TRNNumber}}",d.client.trnNo).replace("{{Currency}}",this.currency),30,A-175)),C.setTextColor(0,0,0),C.line(5,A-95,607,A-95),C.text("Notice :- Please tear and attach the slip  along with your payment",10,A-80),C.autoTable(l,n,{startX:10,startY:A-65,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:130,halign:"center"},1:{cellWidth:210,halign:"center"},2:{cellWidth:110,halign:"right"},3:{cellWidth:140,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}});var F=C.output("datauristring");this.pdfsToMerge.push(F)}downloadBillFormat1LargeReport(e){var t,i;let l=[],n=[],o=[],a=[],s=[],r=[],c=[],u=[],d=["Unit No","Meter No","Previous Reading","Present Reading","Consumption"],m=["Bill No","Meter No","Charges","Consumption","Measuring Unit","Tariff","Total"],h="";e.bills.forEach(e=>{h+=e.deviceName+","}),s.push({label:"Account Number:",value:e.accountNumber},{label:"Meter Number:",value:h.slice(0,-1)},{label:"Unit Number:",value:e.unitNumber},{label:"Billing Date:",value:e.billDateLocal},{label:"Due Date:",value:e.dueDateLocal},{label:"Bill Period",value:`${Object(b.f)(e.fromDateLocal)} - ${Object(b.f)(e.toDateLocal)} `});let p=!1,f=!1,g=!1,v=!1;if(e&&e.bills&&e.bills.length){const t=Array.from(new Set(e.bills.map(e=>e.billNumber))),i=Array.from(new Set(e.bills.map(e=>e.unitNumber))),l=Array.from(new Set(e.bills.map(e=>e.deviceName)));if(p=!!(t&&t.length>1),f=!!(i&&i.length>1),v=!!(l&&l.length>1),!v){const e=m.findIndex(e=>"Meter No"===e);e>-1&&m.splice(e,1)}if(p||m.splice(0,1),f){const e=s.findIndex(e=>"Unit Number:"===e.label);s.splice(e,1)}else d.splice(0,1);const n=Array.from(new Set(e.bills.filter(e=>e.billTariffDetails&&e.billTariffDetails.length))),o=Array.from(new Set(e.bills.filter(e=>!e.billTariffDetails||0===e.billTariffDetails.length)));if(o&&o.length&&o&&o.length&&(g=!0),o&&o.length&&!n&&(g=!0),n&&n.length&&(!o||0==o.length))for(let e=0;e<n.length;e++)if(n[e].billTransactions.find(e=>!e.tariffId)){g=!0;break}}if(!g){const e=m.findIndex(e=>"Tariff"===e);e&&m.splice(e,1)}for(let P=0;P<e.bills.length;P++){if(this.consumptionRoundOffFormat=null!==(t=Object(b.e)("ConsumptionRoundOff",e.bills[P].utilityTypeId))&&void 0!==t?t:this.envService.consumptionRoundOffFormat,f&&l.push(e.bills[P].unitNumber),l.push(e.bills[P].deviceName),l.push(this.decimalPipe.transform(e.bills[P].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[P].measuringUnit),l.push(this.decimalPipe.transform(e.bills[P].presentReading,this.consumptionRoundOffFormat)+" "+e.bills[P].measuringUnit),e.bills[P].isDifferentiateBill){if(v){v=!1;const e=m.findIndex(e=>"Meter No"===e);e>-1&&m.splice(e,1)}l.push(this.decimalPipe.transform(e.bills[P].presentReading-e.bills[P].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[P].measuringUnit)}else l.push(this.decimalPipe.transform(e.bills[P].consumption,this.consumptionRoundOffFormat)+" "+e.bills[P].measuringUnit);"BTU"===e.bills[P].utilityType&&e.bills[P].billTransactions&&e.bills[P].billTransactions.length&&e.bills[P].billTransactions.findIndex(e=>e.measuringUnitId&&2===e.measuringUnitId)>-1&&(0==P&&d.push("Consumption TR-HR"),l.push(this.decimalPipe.transform(.284345*e.bills[P].consumption,this.consumptionRoundOffFormat))),n.push(l),l=[]}let y=0;for(let P=0;P<e.bills.length;P++){const t=e.bills[P];this.consumptionRoundOffFormat=null!==(i=Object(b.e)("ConsumptionRoundOff",e.bills[P].utilityTypeId))&&void 0!==i?i:this.envService.consumptionRoundOffFormat;for(let e=0;e<t.billTransactions.length;e++)p&&l.push(t.billNumber),v&&l.push(t.deviceName),l.push(t.billTransactions[e].headDisplay),"BTU"===t.utilityType&&t.billTransactions&&t.billTransactions.length&&t.billTransactions[e]&&t.billTransactions[e].measuringUnitId&&2===t.billTransactions[e].measuringUnitId?(l.push(this.decimalPipe.transform(.284345*t.consumption,this.consumptionRoundOffFormat)),l.push("TR-HR"),g&&t.billTariffDetails&&t.billTariffDetails.length&&t.billTransactions[e].tariffId?l.push("-"):g&&l.push(t.billTransactions[e].rate)):(l.push(this.decimalPipe.transform(t.consumption,this.consumptionRoundOffFormat)),l.push(t.measuringUnit),g&&t.billTariffDetails&&t.billTariffDetails.length&&t.billTransactions[e].tariffId?l.push("-"):g&&l.push(t.billTransactions[e].rate)),l.push(this.currencyPipe.transform(t.billTransactions[e].headAmount,this.currency.toString(),!0,this.roundFormat)),c.push(l),l=[],y+=t.billTransactions[e].headAmount}if(l.push(e.accountNumber),l.push(e.fromDateLocal+"-"+e.toDateLocal),l.push(this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)),l.push(e.billAmountLocal),a.push(l),e.billCharges&&e.billCharges.length&&(e.billCharges.sort((e,t)=>e.position-t.position).forEach(e=>{if("VAT"!==e.headDisplay){const t=o.find(t=>t.label===e.headDisplay);t?t.value+=e.headAmount:o.push({label:e.headDisplay,value:e.headAmount})}}),o.forEach(e=>{r.push({label:e.label,value:this.currencyPipe.transform(e.value,this.currency.toString(),!0,this.roundFormat)})})),r.push({label:"Current Month Total Consumption Charge:",value:this.currencyPipe.transform(y,this.currency.toString(),!0,this.roundFormat)}),e.billDiscounts&&e.billDiscounts.length){let t=0;e.billDiscounts.forEach(e=>{t+=e.headAmount}),r.push({label:"Total Discount",value:this.currencyPipe.transform(t,this.currency.toString(),!0,this.roundFormat)})}e.billTaxDetails&&e.billTaxDetails.length?e.billTaxDetails.forEach(e=>{r.push({label:e.taxDisplayName,value:this.currencyPipe.transform(e.taxAmount,this.currency.toString(),!0,this.roundFormat)})}):r.push({label:"TAX:",value:this.currencyPipe.transform(0,this.currency.toString(),!0,this.roundFormat)}),r.push({label:"Current Month + TAX:",value:e.billAmountLocal},{label:"Previous Bill Outstanding Balance:",value:this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)},{label:"Total Due incl TAX:",value:this.currencyPipe.transform(e.billAmount+e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)});Array.from(new Set(e.bills.map(e=>e.billTariffDetails)));let C=[],S=!1,T=[];l=[],e&&e.bills&&e.bills.length&&e.bills.forEach(e=>{var t;this.consumptionRoundOffFormat=null!==(t=Object(b.e)("ConsumptionRoundOff",e.utilityTypeId))&&void 0!==t?t:this.envService.consumptionRoundOffFormat,T=[];let i="Unit Number : "+e.unitNumber+" - Meter Number : "+e.deviceName;if(e.billTariffDetails&&e.billTariffDetails.length)for(let n=0;n<e.billTariffDetails.length;n++){if(e.billTariffDetails[n].slabSettingsId&&e.billTariffDetails[n].slabSettingsId>0){let t=e.billTariffDetails[n].season;Number(e.billTariffDetails[n].peakType)<Number(e.billTariffDetails[n].consumption)&&(t=e.billTariffDetails[n].peakType+" - "+e.billTariffDetails[n].consumption),0==n&&(S=!0,C=["Slab","Consumption","Rate","Amount "]),T&&T.length?T.find(e=>e===i)||this.createUnitMeterNumberRow(i,C.length,u):(T.push(i),this.createUnitMeterNumberRow(i,C.length,u)),l.push(t),l.push(this.decimalPipe.transform(e.billTariffDetails[n].consumption,this.consumptionRoundOffFormat)),l.push(e.billTariffDetails[n].rate),l.push(this.currencyPipe.transform(e.billTariffDetails[n].amount,this.currency.toString(),!0,this.roundFormat))}else 0==e.billTariffDetails[n].slabSettingsId&&(0==n&&(C=["Season","Week Type","Peak Type","Consumption","Rate","Amount "]),T&&T.length?T.find(e=>e===i)||this.createUnitMeterNumberRow(i,C.length,u):(T.push(i),this.createUnitMeterNumberRow(i,C.length,u)),l.push(e.billTariffDetails[n].season),l.push(e.billTariffDetails[n].weekType),l.push(e.billTariffDetails[n].peakType),l.push(this.decimalPipe.transform(e.billTariffDetails[n].consumption,this.consumptionRoundOffFormat)),l.push(e.billTariffDetails[n].rate),l.push(this.currencyPipe.transform(e.billTariffDetails[n].amount,this.currency.toString(),!0,this.roundFormat)));u.push(l),l=[]}}),this.getNewBillFormat1LargeReport(d,n,o,["Customer AccountNumber","Billing Period","Previous Due","Total for current period"],a,[],s,r,"Invoice",m,c,e,[],C,u,S)}getNewBillFormat1LargeReport(e,t,i,l,n,o,a,s,r,c,u,d,m,h,p,f=!1){var g,v,y,C,S,T,P,D,w,N,x,A,F,R,k,I,O,W,M,L,B,z;let U=new fe.default({orientation:"portrait",unit:"pt",format:"letter"});U.rect(5,5,U.internal.pageSize.width-10,U.internal.pageSize.height-10,"S"),U.setFontSize(30),U=this.addImage(U,d),U.setTextColor(0,0,0),U.setFontSize(16),U.setFont("Cambria","bold"),U.text("Tax Invoice",260,30),U.setFontSize(13),U.setFont("Cambria","normal"),U.text(d.client.clientName.toUpperCase(),10,60),U.setFontSize(10),U.setFont("Cambria"),U.text("TRN: "+d.client.trnNo,10,70),U.text("PO Box "+d.client.addresses[0].zipPostalCode,10,80),U.text(d.client.addresses[0].address1+","+d.client.addresses[0].country,10,90),U.text("Phone: "+d.client.phoneNo,10,100),U.text("Email: "+d.client.email+", Web: "+d.client.website,10,110),U.setFontSize(10),U.setFont("bold"),U.text("Invoice#: ".toUpperCase(),370,110),U.setTextColor(25,118,210);const E=U.getTextWidth("Invoice#: ");let j="";(null==d?void 0:d.billNumber)&&(j=null===(g=d.billNumber)||void 0===g?void 0:g.toUpperCase()),U.text(j,380+E,110),U.setFont("none"),U.setTextColor(0,0,0),U.setFontSize(9),U.autoTable("",a,{startY:120,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:370},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:80,halign:"left"},1:{cellWidth:150,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0]},didParseCell:function(e){e.cell.styles.cellPadding=6===e.length?1.8:2.7}});const H=Number(this.decimalPipe.transform(U.autoTable.previous.finalY,"1.0-0"));U.setLineWidth(.1),U.line(5,H+5,607,H+5),U.setFont("Cambria"),U.setFillColor(241,241,244),U.setDrawColor(206,203,203),U.rect(10,120,340,H-120,"FD"),U.setTextColor(0,0,0),U.setFontSize(12),U.text(null==d?void 0:d.ownerName.toUpperCase(),20,135),U.text("CUSTOMER TRN: "+d.trn,20,150),U.text("unit #"+d.unitNumber,20,165),U.setFontSize(10),U.text(d.clientName,20,180),U.text(Object(b.f)(null===(v=null==d?void 0:d.client)||void 0===v?void 0:v.buildingName,",")+Object(b.f)(null===(C=null===(y=null==d?void 0:d.client)||void 0===y?void 0:y.addresses[0])||void 0===C?void 0:C.location,",")+Object(b.f)(null===(T=null===(S=null==d?void 0:d.client)||void 0===S?void 0:S.addresses[0])||void 0===T?void 0:T.city,",")+Object(b.f)(null===(D=null===(P=null==d?void 0:d.client)||void 0===P?void 0:P.addresses[0])||void 0===D?void 0:D.country,","),20,195),U.setFontSize(10),U.text("Meter Read-Outs".toUpperCase(),10,H+20);var Y=function(e){};if(U.autoTable(e,t,{startX:10,startY:H+35,showHead:"everyPage",didDrawPage:Y,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:6==e.length?120:4==e.length?200:155,halign:"center"},1:{cellWidth:6==e.length?100:4==e.length?135:125,halign:"center"},2:{cellWidth:6==e.length?100:4==e.length?135:125,halign:"center"},3:{cellWidth:4==e.length?120:100,halign:"center"},4:{cellWidth:85,halign:"center"},5:{cellWidth:85,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}),u&&u.length){const e=Number(this.decimalPipe.transform(U.autoTable.previous.finalY,"1.0-0"));U.setFontSize(10),U.text("Charges Breakdown".toUpperCase(),10,e+15),U.autoTable(c,u,{startX:10,startY:e+30,showHead:"everyPage",didDrawPage:Y,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{columnWidth:6==c.length?80:4==c.length?230:7==c.length?70:200,halign:"center"},1:{columnWidth:6==c.length?180:4==c.length?130:7==c.length?70:100,halign:"center"},2:{columnWidth:6==c.length?90:4==c.length?130:7==c.length?140:100,halign:"center"},3:{columnWidth:6==c.length?90:4==c.length?100:7==c.length?70:100,halign:4==c.length?"right":"center"},4:{cellWidth:75,halign:6==c.length||7==c.length?"center":"right"},5:{cellWidth:75,halign:7==c.length?"center":"right"},6:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}})}let V=Number(this.decimalPipe.transform(U.autoTable.previous.finalY,"1.0-0")),_=U.internal.pageSize.height,G=V;f?(U.autoTable(h,p,{startX:10,startY:G+10,showHead:"everyPage",didDrawPage:Y,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{columnWidth:4===h.length?250:120,halign:"center"},1:{columnWidth:4===h.length?120:150,halign:"center"},2:{columnWidth:120,halign:"center"},3:{columnWidth:100,halign:4===h.length?"right":"center"},4:{columnWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1;const t=e.cell.raw;t&&"string"==typeof t&&t.startsWith("Unit")&&(e.cell.styles.fontStyle="bold",e.cell.colSpan=h.length,e.cell.styles.halign="left")}}),G=Number(this.decimalPipe.transform(U.autoTable.previous.finalY,"1.0-0"))):(U.autoTable(h,p,{startX:10,startY:V+10,showHead:"everyPage",didDrawPage:Y,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{columnWidth:6===h.length?140:100,halign:"center"},1:{columnWidth:100,halign:"center"},2:{columnWidth:6===h.length?100:80,halign:"center"},3:{columnWidth:6===h.length?100:80,halign:"center"},4:{columnWidth:75,halign:"center"},5:{columnWidth:75,halign:6===h.length?"right":"center"},6:{columnWidth:80,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1;const t=e.cell.raw;t&&"string"==typeof t&&t.startsWith("Unit")&&(e.cell.styles.fontStyle="bold",e.cell.colSpan=h.length,e.cell.styles.halign="left")}}),G=Number(this.decimalPipe.transform(U.autoTable.previous.finalY,"1.0-0"))),_-G<200&&(U.addPage(),U.setTextColor(25,118,210),U.rect(5,5,U.internal.pageSize.width-10,U.internal.pageSize.height-10,"S"),G=10),U.setTextColor(25,118,210),U.setFontSize(12),U.text("Bank Payment Account Details",10,G+20),U.setTextColor(0,0,0),U.setFontSize(9),U.text("Account Title: "+Object(b.f)(null===(N=null===(w=null==d?void 0:d.client)||void 0===w?void 0:w.bankDetails[0])||void 0===N?void 0:N.accountName),10,G+40),U.text("Account #: "+Object(b.f)(null===(A=null===(x=null==d?void 0:d.client)||void 0===x?void 0:x.bankDetails[0])||void 0===A?void 0:A.accountNo),10,G+50),U.text("IBAN #: "+Object(b.f)(null===(R=null===(F=null==d?void 0:d.client)||void 0===F?void 0:F.bankDetails[0])||void 0===R?void 0:R.ibanNumber),10,G+60),U.text("Bank Name: "+Object(b.f)(null===(I=null===(k=null==d?void 0:d.client)||void 0===k?void 0:k.bankDetails[0])||void 0===I?void 0:I.bankName),10,G+70),U.text("Swift Code: "+ +Object(b.f)(null===(W=null===(O=null==d?void 0:d.client)||void 0===O?void 0:O.bankDetails[0])||void 0===W?void 0:W.swiftCode),10,G+80),U.setFontSize(9),U.autoTable("",s,{startX:300,startY:G+20,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:320},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:180,halign:"left"},1:{cellWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"},didParseCell:function(e){e.cell.styles.cellPadding=1.8}}),Number(this.decimalPipe.transform(U.autoTable.previous.finalY,"1.0-0"))+110>_-190&&(U.addPage(),U.rect(5,5,U.internal.pageSize.width-10,U.internal.pageSize.height-10,"S"),_=230),(null===(L=null===(M=null==d?void 0:d.client)||void 0===M?void 0:M.termsConditions[0])||void 0===L?void 0:L.termsAndCondition)&&(U.setFillColor(241,241,244),U.rect(10,_-190,590,90,"FD"),U.setFillColor(0,0,0),U.setFontSize(9),U.text(null===(z=null===(B=null==d?void 0:d.client)||void 0===B?void 0:B.termsConditions[0])||void 0===z?void 0:z.termsAndCondition.replace("{{ClientName}}",d.client.clientName).replace("{{TRNNumber}}",d.client.trnNo).replace("{{Currency}}",this.currency),40,_-175)),U.setTextColor(0,0,0),U.line(5,_-95,607,_-95),U.text("Notice :- Please tear and attach the slip  along with your payment",10,_-60),U.autoTable(l,n,{startX:10,startY:_-45,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:130,halign:"center"},1:{cellWidth:210,halign:"center"},2:{cellWidth:110,halign:"right"},3:{cellWidth:140,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}});var X=U.output("datauristring");this.pdfsToMerge.push(X)}downloadBillFormat3LargeReport(e){var t,i,l,n,o,a,s,r,c,u,d;let m=[],h=[],p=[],f=[],g=[],v=[],y=[],C=[],S=[],T=["Unit No","Meter No","Previous Reading","Present Reading","Consumption"],P=["Bill No","Meter No","Charges","Consumption","Measuring Unit","Tariff","Total"];g.push({label:"Bill No",value:": "+Object(b.f)(e.billNumber)},{label:"Date of issue",value:": "+Object(b.f)(e.billDateLocal)},{label:"Due Date",value:": "+Object(b.f)(e.dueDateLocal)}),v.push({label:"Billing period",value:`: From: ${Object(b.f)(e.fromDateLocal)} To: ${Object(b.f)(e.toDateLocal)} `},{label:"Customer Account",value:": "+Object(b.f)(e.accountNumber)},{label:"Customer Name",value:": "+Object(b.f)(e.ownerName)},{label:"Address",value:": "+Object(b.f)(null===(i=null===(t=null==e?void 0:e.client)||void 0===t?void 0:t.addresses[0])||void 0===i?void 0:i.address1)},{label:"City",value:": "+Object(b.f)(null===(n=null===(l=null==e?void 0:e.client)||void 0===l?void 0:l.addresses[0])||void 0===n?void 0:n.city)},{label:"P.O Box",value:": "+Object(b.f)(null===(a=null===(o=null==e?void 0:e.client)||void 0===o?void 0:o.addresses[0])||void 0===a?void 0:a.zipPostalCode)},{label:"Phone number",value:": "+Object(b.f)(null===(s=null==e?void 0:e.receiverDetails[0])||void 0===s?void 0:s.phoneNumber)},{label:"Fax Number",value:": "},{label:"Client",value:": "+Object(b.f)(null===(r=null==e?void 0:e.client)||void 0===r?void 0:r.clientName)},{label:"Client TRN",value:": "+Object(b.f)(null===(c=null==e?void 0:e.client)||void 0===c?void 0:c.trnNo)});let D=!1,w=!1,N=!1,x=!1;if(e&&e.bills&&e.bills.length){const t=Array.from(new Set(e.bills.map(e=>e.billNumber))),i=Array.from(new Set(e.bills.map(e=>e.unitNumber))),l=Array.from(new Set(e.bills.map(e=>e.deviceName)));if(D=!!(t&&t.length>1),w=!!(i&&i.length>1),x=!!(l&&l.length>1),!x){const e=P.findIndex(e=>"Meter No"===e);e>-1&&P.splice(e,1)}if(D?g.splice(0,1):P.splice(0,1),w){const e=v.findIndex(e=>"Unit No"===e.label);v.splice(e,1)}else T.splice(0,1);const n=Array.from(new Set(e.bills.filter(e=>e.billTariffDetails&&e.billTariffDetails.length))),o=Array.from(new Set(e.bills.filter(e=>!e.billTariffDetails||0===e.billTariffDetails.length)));if(o&&o.length&&o&&o.length&&(N=!0),o&&o.length&&!n&&(N=!0),n&&n.length&&(!o||0==o.length))for(let e=0;e<n.length;e++)if(n[e].billTransactions.find(e=>!e.tariffId)){N=!0;break}}if(!N){const e=P.findIndex(e=>"Tariff"===e);e&&P.splice(e,1)}for(let W=0;W<e.bills.length;W++){if(this.consumptionRoundOffFormat=null!==(u=Object(b.e)("ConsumptionRoundOff",e.bills[W].utilityTypeId))&&void 0!==u?u:this.envService.consumptionRoundOffFormat,w&&m.push(e.bills[W].unitNumber),m.push(e.bills[W].deviceName),m.push(this.decimalPipe.transform(e.bills[W].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[W].measuringUnit),m.push(this.decimalPipe.transform(e.bills[W].presentReading,this.consumptionRoundOffFormat)+" "+e.bills[W].measuringUnit),e.bills[W].isDifferentiateBill){if(x){x=!1;const e=P.findIndex(e=>"Meter No"===e);e>-1&&P.splice(e,1)}m.push(this.decimalPipe.transform(e.bills[W].presentReading-e.bills[W].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[W].measuringUnit)}else m.push(this.decimalPipe.transform(e.bills[W].consumption,this.consumptionRoundOffFormat)+" "+e.bills[W].measuringUnit);"BTU"===e.bills[W].utilityType&&e.bills[W].billTransactions&&e.bills[W].billTransactions.length&&e.bills[W].billTransactions.findIndex(e=>e.measuringUnitId&&2===e.measuringUnitId)>-1&&(0==W&&T.push("Consumption TR-HR"),m.push(this.decimalPipe.transform(.284345*e.bills[W].consumption,this.consumptionRoundOffFormat))),h.push(m),m=[]}let A=0;for(let W=0;W<e.bills.length;W++){const t=e.bills[W];this.consumptionRoundOffFormat=null!==(d=Object(b.e)("ConsumptionRoundOff",e.bills[W].utilityTypeId))&&void 0!==d?d:this.envService.consumptionRoundOffFormat;for(let e=0;e<t.billTransactions.length;e++)D&&m.push(t.billNumber),x&&m.push(t.deviceName),m.push(t.billTransactions[e].headDisplay),"BTU"===t.utilityType&&t.billTransactions&&t.billTransactions.length&&t.billTransactions[e]&&t.billTransactions[e].measuringUnitId&&2===t.billTransactions[e].measuringUnitId?(m.push(this.decimalPipe.transform(.284345*t.consumption,this.consumptionRoundOffFormat)),m.push("TR-HR"),N&&t.billTariffDetails&&t.billTariffDetails.length&&t.billTransactions[e].tariffId?m.push("-"):N&&m.push(t.billTransactions[e].rate)):(m.push(this.decimalPipe.transform(t.consumption,this.consumptionRoundOffFormat)),m.push(t.measuringUnit),N&&t.billTariffDetails&&t.billTariffDetails.length&&t.billTransactions[e].tariffId?m.push("-"):N&&m.push(t.billTransactions[e].rate)),m.push(this.currencyPipe.transform(t.billTransactions[e].headAmount,this.currency.toString(),!0,this.roundFormat)),y.push(m),m=[],A+=t.billTransactions[e].headAmount}m.push(e.accountNumber),m.push(e.fromDateLocal+"-"+e.toDateLocal),m.push(this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)),m.push(e.billAmountLocal),f.push(m);let F="";e.bills.forEach(e=>{F+=e.deviceName+","});Array.from(new Set(e.bills.map(e=>e.billTariffDetails)));let R=[],k=!1,I=[];m=[],e&&e.bills&&e.bills.length&&e.bills.forEach(e=>{var t;this.consumptionRoundOffFormat=null!==(t=Object(b.e)("ConsumptionRoundOff",e.utilityTypeId))&&void 0!==t?t:this.envService.consumptionRoundOffFormat,I=[];let i="Unit Number : "+e.unitNumber+" - Meter Number : "+e.deviceName;if(e.billTariffDetails&&e.billTariffDetails.length)for(let l=0;l<e.billTariffDetails.length;l++){if(e.billTariffDetails[l].slabSettingsId&&e.billTariffDetails[l].slabSettingsId>0){let t=e.billTariffDetails[l].season;Number(e.billTariffDetails[l].peakType)<Number(e.billTariffDetails[l].consumption)&&(t=e.billTariffDetails[l].peakType+" - "+e.billTariffDetails[l].consumption),0==l&&(k=!0,R=["Slab","Consumption","Rate","Amount "]),I&&I.length?I.find(e=>e===i)||this.createUnitMeterNumberRow(i,R.length,S):(I.push(i),this.createUnitMeterNumberRow(i,R.length,S)),m.push(t),m.push(this.decimalPipe.transform(e.billTariffDetails[l].consumption,this.consumptionRoundOffFormat)),m.push(e.billTariffDetails[l].rate),m.push(this.currencyPipe.transform(e.billTariffDetails[l].amount,this.currency.toString(),!0,this.roundFormat))}else 0==e.billTariffDetails[l].slabSettingsId&&(0==l&&(R=["Season","Week Type","Peak Type","Consumption","Rate","Amount "]),I&&I.length?I.find(e=>e===i)||this.createUnitMeterNumberRow(i,R.length,S):(I.push(i),this.createUnitMeterNumberRow(i,R.length,S)),m.push(e.billTariffDetails[l].season),m.push(e.billTariffDetails[l].weekType),m.push(e.billTariffDetails[l].peakType),m.push(this.decimalPipe.transform(e.billTariffDetails[l].consumption,this.consumptionRoundOffFormat)),m.push(e.billTariffDetails[l].rate),m.push(this.currencyPipe.transform(e.billTariffDetails[l].amount,this.currency.toString(),!0,this.roundFormat)));S.push(m),m=[]}});let O=[];if(e.billCharges&&e.billCharges.length&&e.billCharges.sort((e,t)=>e.position-t.position).forEach(e=>{if("VAT"!==e.headDisplay){const t=O.find(t=>t.label===e.headDisplay);t?t.value+=e.headAmount:O.push({label:e.headDisplay,value:e.headAmount})}}),O.forEach(e=>{p.push({label:e.label,value:this.currencyPipe.transform(e.value,this.currency.toString(),!0,this.roundFormat)})}),e.billTaxDetails&&e.billTaxDetails.length&&e.billTaxDetails.forEach(e=>{p.push({label:e.taxDisplayName,value:this.currencyPipe.transform(e.taxAmount,this.currency.toString(),!0,this.roundFormat)})}),p.push({label:"Total consumption charge for Current Period",value:this.currencyPipe.transform(A,this.currency.toString(),!0,this.roundFormat)}),e.billDiscounts&&e.billDiscounts.length){let t=0;e.billDiscounts.forEach(e=>{t+=e.headAmount}),p.push({label:"Total Discount",value:this.currencyPipe.transform(t,this.currency.toString(),!0,this.roundFormat)})}p.push({label:"Previous Outstanding Amount",value:this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)}),C.push({label:"Total for Current Period",value:this.currencyPipe.transform(e.billAmount+e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)}),this.getNewBillFormat3LargeReport(T,h,p,["Customer AccountNumber","Billing Period","Previous Due","Total for current period"],f,g,v,[],"Invoice",P,y,e,C,R,S,k)}getNewBillFormat3LargeReport(e,t,i,l,n,o,a,s,r,c,u,d,m,h,b,p=!1){var f,g,v,y;let C=new fe.default({orientation:"portrait",unit:"pt",format:"letter"});C.rect(5,5,C.internal.pageSize.width-10,C.internal.pageSize.height-10,"S"),C.setTextColor(0,0,0),C.setFontSize(11),C.setFont("Cambria"),C.text("Billing Statement".toUpperCase(),10,20),this.addImage(C,d),C.setLineWidth(.1),C.autoTable("",o,{startX:10,startY:35,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:15},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:190,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"},didParseCell:function(e){e.cell.styles.cellPadding=1.5}});const S=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"));C.autoTable("",a,{startX:10,startY:S,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:15},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:380,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0]},didParseCell:function(e){e.cell.styles.cellPadding=1.5}});var T=function(e){};const P=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"));C.setFont("Cambria"),C.setFontSize(10),C.text("Meter Read-Outs".toUpperCase(),10,P+15),C.autoTable(e,t,{startX:10,startY:P+30,didDrawPage:T,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:6==e.length?120:4==e.length?200:155,halign:"center"},1:{cellWidth:6==e.length?100:4==e.length?135:125,halign:"center"},2:{cellWidth:6==e.length?100:4==e.length?135:125,halign:"center"},3:{cellWidth:4==e.length?120:100,halign:"center"},4:{cellWidth:85,halign:"center"},5:{cellWidth:85,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}});const D=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"));u&&u.length&&(C.setFontSize(10),C.text("Charges Breakdown".toUpperCase(),10,D+15),C.autoTable(c,u,{startX:10,startY:D+30,showHead:"everyPage",didDrawPage:T,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:6===c.length?80:4==c.length?230:7===c.length?70:200,halign:"center"},1:{cellWidth:6===c.length?180:4==c.length?130:7===c.length?70:100,halign:"center"},2:{cellWidth:6===c.length?90:4==c.length?130:7===c.length?140:100,halign:6===c.length?"":"center"},3:{cellWidth:6===c.length?90:4==c.length?100:7===c.length?85:100,halign:4==c.length?"right":"center"},4:{cellWidth:75,halign:6==c.length||7==c.length?"center":"right"},5:{cellWidth:75,halign:6==c.length?"right":"center"},6:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}));let w=C.internal.pageSize.height;const N=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"));let x=N;p?(C.autoTable(h,b,{startX:10,startY:N+10,showHead:"everyPage",didDrawPage:T,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{columnWidth:4===h.length?250:120,halign:"center"},1:{columnWidth:4===h.length?120:150,halign:"center"},2:{columnWidth:120,halign:"center"},3:{columnWidth:100,halign:4===h.length?"right":"center"},4:{columnWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1;const t=e.cell.raw;t&&"string"==typeof t&&t.startsWith("Unit")&&(e.cell.styles.fontStyle="bold",e.cell.colSpan=h.length,e.cell.styles.halign="left")}}),x=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"))):(C.autoTable(h,b,{startX:10,startY:N+10,showHead:"everyPage",didDrawPage:T,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{columnWidth:6===h.length?140:100,halign:"center"},1:{columnWidth:100,halign:"center"},2:{columnWidth:6===h.length?100:80,halign:"center"},3:{columnWidth:6===h.length?100:80,halign:"center"},4:{columnWidth:75,halign:"center"},5:{columnWidth:75,halign:6===h.length?"right":"center"},6:{columnWidth:80,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1;const t=e.cell.raw;t&&"string"==typeof t&&t.startsWith("Unit")&&(e.cell.styles.fontStyle="bold",e.cell.colSpan=h.length,e.cell.styles.halign="left")}}),x=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"))),w-x<200&&(C.addPage(),C.setTextColor(25,118,210),C.rect(5,5,C.internal.pageSize.width-10,C.internal.pageSize.height-10,"S"),x=10),C.autoTable("",i,{startX:10,startY:x+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{bottom:35,left:250},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:250,fontStyle:"italic"},1:{cellWidth:90}},didParseCell:function(e){1==e.column.index&&(e.cell.styles.halign="right"),e.cell.styles.cellPadding=1.5},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});const A=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"));C.line(5,A+10,607,A+10),C.autoTable("",m,{startX:10,startY:A+20,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{bottom:35,left:250},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:250,fontStyle:"italic"},1:{cellWidth:90}},didParseCell:function(e){1==e.column.index&&(e.cell.styles.halign="right"),e.cell.styles.cellPadding=1.5},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});const F=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"));C.line(5,F+10,607,F+10),w=C.internal.pageSize.height,F>w-180&&(C.addPage(),C.rect(5,5,C.internal.pageSize.width-10,C.internal.pageSize.height-10,"S"),w=230),(null===(g=null===(f=null==d?void 0:d.client)||void 0===f?void 0:f.termsConditions[0])||void 0===g?void 0:g.termsAndCondition)&&(C.setFillColor(241,241,244),C.rect(10,w-190,590,90,"FD"),C.setFillColor(0,0,0),C.setFontSize(9),C.text(null===(y=null===(v=null==d?void 0:d.client)||void 0===v?void 0:v.termsConditions[0])||void 0===y?void 0:y.termsAndCondition.replace("{{ClientName}}",d.client.clientName).replace("{{TRNNumber}}",d.client.trnNo).replace("{{Currency}}",this.currency),30,w-175)),C.setTextColor(0,0,0),C.line(5,w-95,607,w-95),C.text("Notice :- Please tear and attach the slip  along with your payment",10,w-75),C.autoTable(l,n,{startX:10,startY:w-70,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:130,halign:"center"},1:{cellWidth:210,halign:"center"},2:{cellWidth:110,halign:"right"},3:{cellWidth:140,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}});var R=C.output("datauristring");this.pdfsToMerge.push(R)}createUnitMeterNumberRow(e,t,i){let l=[];for(let n=0;n<t-1;n++)l.push(0===n?e:"");i.push(l)}onFilterChange(e){this.dataSource&&(e=(e=e.trim()).toLowerCase(),this.dataSource.filter=e)}billConsumptionExcelExport(){this.billService.billConsumptionDetails(this.manageParams,!this.isApproveBills).subscribe({next:e=>{e&&e.length?this.excelDynamicExport(e):this.notificationMessage("No data to print","red-snackbar")},error:e=>{this.notificationMessage("No data to print","red-snackbar")}})}excelDynamicExport(e){if(e&&e.length){const t=vt.utils.json_to_sheet(e),i=vt.utils.book_new();vt.utils.book_append_sheet(i,t,"Sheet1"),vt.writeFile(i,"DetailedBillSummary.xlsx")}else this.notificationMessage("No Data to Export","yellow-snackbar")}}return e.\u0275fac=function(t){return new(t||e)(m.Nb(c.a),m.Nb(F.a),m.Nb(a.f),m.Nb(a.d),m.Nb(a.g),m.Nb(h.b),m.Nb(pe.a),m.Nb(y.a),m.Nb(k.b),m.Nb(je.a),m.Nb(ot.a),m.Nb(C.a),m.Nb(s.a),m.Nb(_.a),m.Nb(be.a),m.Nb(m.h),m.Nb(p.a))},e.\u0275cmp=m.Hb({type:e,selectors:[["app-bill-history"]],viewQuery:function(e,t){var i;1&e&&(m.Vc(yt.a,!0),m.Vc(Ct.a,!0),m.Vc(Tt,!0),m.Jc(nt,!0),m.Jc(ht,!0)),2&e&&(m.zc(i=m.cc())&&(t.paginator=i.first),m.zc(i=m.cc())&&(t.content=i.first),m.zc(i=m.cc())&&(t.htmlData=i.first),m.zc(i=m.cc())&&(t.billHistoryToolbarComponent=i.first),m.zc(i=m.cc())&&(t.billHistoryFooterToolbarComponent=i.first))},inputs:{displayedColumns:"displayedColumns"},decls:18,vars:22,consts:[["mode","card"],["fxLayout","column",1,"content"],["color","primary",1,"position-fixed"],["src","assets/img/fav-icon.png",1,"img-style"],[4,"ngIf"],[1,"example-spacer"],[3,"userActions","isApproveBills","isRejectedBills","parameterValue","disable","sendNotificationsClicked","printClicked","printSummaryClicked","approveClickedClicked","excelExportClicked","billConsumptionExcelExportClicked","regenerateClicked"],["fxFlex","noshrink","fxLayout","column","fxLayout.gt-sm","row","fxLayoutAlign.gt-sm","start stretch",3,"fxLayoutGap"],["fxFlex","grow",1,"basic-forms","route-animations-elements",3,"fxFlex.gt-sm"],["fxLayout","column"],["fxLayout","column",1,"result"],[3,"tenants","billPeriods","isHide","billTypes","billFeeTypes","isTenantVisible","isRejectedBills","isApproveBills","billFeeTypeChanged","searchClicked"],["class","padding","fxLayout","column",4,"ngIf"],["class","result","fxLayout.gt-sm","row","fxLayout","column","fxLayoutAlign","end end","fxLayoutGap.gt-sm","12px",4,"ngIf"],["fxLayout","column",1,"padding"],[3,"tableData","columnsToDisplay","innerDisplayedColumns","columnNames","hideHeader","cssStyledColumn","visibleButtons","role","buttonName","disableColumn","buttonDisableColumn","selectedRows","viewDataRow","printDataRow","deleteDataRow","rejectDataRow","failDataRow","updateRow","remarksDataRow","filterDataRow"],[3,"columns","filterChange"],["mat-table","","matSort","",2,"text-align","center",3,"dataSource"],[4,"ngFor","ngForOf"],["matColumnDef","netAmountLocal"],["mat-header-cell","","class","header-align-right",4,"matHeaderCellDef"],["mat-cell","","class","header-align-right",4,"matCellDef"],["matColumnDef","actions"],["class","actions-cell","mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["class","actions-cell","mat-cell","",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["class","clickable route-animations-elements","mat-row","",4,"matRowDef","matRowDefColumns"],[1,"paginator",3,"pageSize"],[3,"matColumnDef",4,"ngIf"],[3,"matColumnDef"],["mat-header-cell","","mat-sort-header","","class","header-align-left",4,"matHeaderCellDef"],["mat-cell","","class","header-align-left",4,"matCellDef"],["mat-header-cell","","mat-sort-header","",1,"header-align-left"],["mat-cell","",1,"header-align-left"],["mat-header-cell","",1,"header-align-right"],["mat-cell","",1,"header-align-right"],["mat-header-cell","","mat-sort-header","",1,"actions-cell"],["mat-cell","",1,"actions-cell"],["matTooltip","Print","mat-icon-button","",1,"example-icon",3,"click"],["mat-header-row",""],["mat-row","",1,"clickable","route-animations-elements"],["fxLayout.gt-sm","row","fxLayout","column","fxLayoutAlign","end end","fxLayoutGap.gt-sm","12px",1,"result"],["color","primary",1,"result",2,"width","150px"],["type","text","id","billAmount","name","billAmount","matInput","",2,"text-align","right",3,"ngModel","ngModelChange"],["class","result","style","width: 150px;","color","primary",4,"ngIf"],[1,"label-color"],[1,"color-box",2,"background-color","rgb(152, 197, 171)"],[1,"color-box",2,"background-color","rgb(206, 120, 152)"],["type","text","id","creditNoteAmount","name","creditNoteAmount","matInput","",2,"text-align","right",3,"ngModel","ngModelChange"],["type","text","id","netAmount","name","netAmount","matInput","",2,"text-align","right",3,"ngModel","ngModelChange"],["type","text","id","receivedAmount","name","receivedAmount","matInput","",2,"text-align","right",3,"ngModel","ngModelChange"],["type","text","id","balanceAmount","name","balanceAmount","matInput","",2,"text-align","right",3,"ngModel","ngModelChange"]],template:function(e,t){1&e&&(m.Tb(0,"fury-page-layout",0),m.Tb(1,"fury-page-layout-content",1),m.Tb(2,"mat-toolbar",2),m.Ob(3,"img",3),m.Pc(4,Pt,2,0,"span",4),m.Pc(5,Dt,2,0,"span",4),m.Pc(6,wt,2,0,"span",4),m.Ob(7,"span",5),m.Tb(8,"fury-bill-history-footer-toolbar",6),m.bc("sendNotificationsClicked",(function(){return t.onSendNotifications()}))("printClicked",(function(){return t.onPrintPdf()}))("printSummaryClicked",(function(e){return t.onPrintSummary(e)}))("approveClickedClicked",(function(){return t.onApprove()}))("excelExportClicked",(function(){return t.onExcelExport()}))("billConsumptionExcelExportClicked",(function(){return t.billConsumptionExcelExport()}))("regenerateClicked",(function(){return t.onRegenerate()})),m.Sb(),m.Sb(),m.Tb(9,"div",7),m.Tb(10,"fury-card",8),m.Ob(11,"fury-card-header"),m.Tb(12,"fury-card-content",9),m.Tb(13,"div",10),m.Tb(14,"app-bill-history-toolbar",11),m.bc("billFeeTypeChanged",(function(e){return t.onBillFeeTypeChange(e)}))("searchClicked",(function(e){return t.onGetBillsHistory(e)})),m.Sb(),m.Sb(),m.Pc(15,Nt,2,11,"div",12),m.Pc(16,Bt,13,6,"div",12),m.Pc(17,Yt,10,6,"div",13),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb()),2&e&&(m.Cb(4),m.mc("ngIf",t.isApproveBills&&!t.isRejectedBills),m.Cb(1),m.mc("ngIf",!t.isApproveBills&&!t.isRejectedBills),m.Cb(1),m.mc("ngIf",t.isRejectedBills),m.Cb(2),m.mc("userActions",t.userActions)("isApproveBills",t.isApproveBills)("isRejectedBills",t.isRejectedBills)("parameterValue",t.parameterValue)("disable",t.disable),m.Cb(1),m.mc("fxLayoutGap",t.gap),m.Cb(1),m.mc("fxFlex.gt-sm",t.col2)("@fadeInUp",void 0),m.Cb(4),m.mc("tenants",t.tenants)("billPeriods",t.billPeriods)("isHide",!1)("billTypes",t.billTypes)("billFeeTypes",t.billFeeTypes)("isTenantVisible",!0)("isRejectedBills",t.isRejectedBills)("isApproveBills",t.isApproveBills),m.Cb(1),m.mc("ngIf",0==t.ownerId),m.Cb(1),m.mc("ngIf",t.ownerId>0),m.Cb(1),m.mc("ngIf",0==t.ownerId))},directives:[X.a,$.a,S.d,q.a,a.o,ht,S.b,S.c,S.e,f.a,f.d,f.c,nt,T.a,St.a,re.j,Ct.a,a.n,re.c,re.e,re.b,re.g,re.i,yt.a,re.d,Ct.b,re.a,P.a,D.a,w.a,re.f,re.h,I.d,I.h,W.b,l.c,l.q,l.t],styles:[".padding[_ngcontent-%COMP%]{padding:0 0 24px}.example-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.content[_ngcontent-%COMP%]{margin-top:2%}.img-style[_ngcontent-%COMP%]{width:32px}ul[_ngcontent-%COMP%]{margin:20px}.label-color[_ngcontent-%COMP%]{position:relative}.label-color[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{padding-left:20px}.label-color[_ngcontent-%COMP%]   .color-box[_ngcontent-%COMP%]{width:10px;height:10px;display:inline-block;background-color:#ccc;position:absolute;left:5px;top:5px}.position-fixed[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;top:0;z-index:5}.header-align-right[_ngcontent-%COMP%]{text-align:right}.header-align-left[_ngcontent-%COMP%]{text-align:left}"],data:{animation:[d.a,u.a]}}),e})(),_t=(()=>{class e{constructor(e,t,i,l,n,o){this.data=e,this.dialogRef=t,this.billService=i,this.fb=l,this.cookieService=n,this.snackbar=o}ngOnInit(){this.clientId=parseInt(this.cookieService.get("globalClientId")),this.form=this.fb.group({cancelReason:[this.data.cancelReason||""]})}notificationMessage(e,t){this.snackbar.open(e,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[t]})}cancelPaymentHistory(e){this.data.cancelReason=this.form.get("cancelReason").value,this.data.clientId=this.clientId,this.billService.cancelPaymentHistory(e).subscribe({next:e=>{e?(this.notificationMessage("Payment cancelled successfully","green-snackbar"),this.dialogRef.close()):this.notificationMessage("Payment cancel failed","red-snackbar")},error:e=>{this.notificationMessage("Payment cancel failed","red-snackbar")}}),this.dialogRef.close()}save(){this.cancelPaymentHistory(this.data)}}return e.\u0275fac=function(t){return new(t||e)(m.Nb(h.a),m.Nb(h.h),m.Nb(c.a),m.Nb(l.f),m.Nb(C.a),m.Nb(k.b))},e.\u0275cmp=m.Hb({type:e,selectors:[["fury-payment-cancel"]],decls:15,vars:2,consts:[["mat-dialog-title",""],[3,"formGroup","ngSubmit"],[1,"person"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","48px"],["fxFlex",""],["type","text","formControlName","cancelReason","matInput",""],[3,"ctrl"],["fxLayout","row","fxLayoutAlign","end center"],["mat-button",""]],template:function(e,t){1&e&&(m.Tb(0,"div",0),m.Rc(1,"Cancel Payment"),m.Sb(),m.Tb(2,"form",1),m.bc("ngSubmit",(function(){return t.save()})),m.Tb(3,"mat-dialog-content"),m.Tb(4,"fury-card"),m.Tb(5,"div",2),m.Tb(6,"div",3),m.Tb(7,"mat-form-field",4),m.Tb(8,"mat-label"),m.Rc(9,"Remarks"),m.Sb(),m.Ob(10,"input",5),m.Ob(11,"app-show-errors",6),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Tb(12,"mat-dialog-actions",7),m.Tb(13,"button",8),m.Rc(14,"CANCEL PAYMENT"),m.Sb(),m.Sb(),m.Sb()),2&e&&(m.Cb(2),m.mc("formGroup",t.form),m.Cb(9),m.mc("ctrl",t.form.get("cancelReason")))},directives:[h.i,l.z,l.r,l.k,h.f,f.a,S.d,S.e,I.d,S.b,I.h,l.c,W.b,l.q,l.i,h.c,S.c,P.a],styles:[""]}),e})();var Gt=i("bSwM");const Xt=["allSelected"];function $t(e,t){if(1&e){const e=m.Ub();m.Tb(0,"div",6),m.Tb(1,"mat-checkbox",7),m.bc("change",(function(t){return m.Ec(e),m.fc().changeViewSecurityDeposit(t)})),m.Rc(2," Fetch Only Security Deposit Transactions"),m.Sb(),m.Sb()}}function qt(e,t){1&e&&(m.Tb(0,"small"),m.Rc(1,"To date should be greater than or equal to From date."),m.Sb())}function Jt(e,t){if(1&e){const e=m.Ub();m.Tb(0,"mat-option",22),m.bc("click",(function(){m.Ec(e),m.fc();const t=m.Ac(21);return m.fc().togglePerOne(t.viewValue)})),m.Rc(1),m.Sb()}if(2&e){const e=t.$implicit;m.mc("value",e.value)("optionSelected",e.selected),m.Cb(1),m.Tc(" ",e.label," ")}}const Qt=function(){return{standalone:!0}};function Kt(e,t){if(1&e){const e=m.Ub();m.Tb(0,"div",3),m.Tb(1,"mat-form-field",8),m.Tb(2,"mat-label"),m.Rc(3,"From Date"),m.Sb(),m.Tb(4,"input",9),m.bc("click",(function(){return m.Ec(e),m.Ac(7).open()}))("ngModelChange",(function(t){return m.Ec(e),m.fc().fromDate=t}))("ngModelChange",(function(){return m.Ec(e),m.fc().validateFromDateAndToDate()}))("focus",(function(){return m.Ec(e),m.Ac(7).open()})),m.Sb(),m.Ob(5,"mat-datepicker-toggle",10),m.Ob(6,"mat-datepicker",null,11),m.Sb(),m.Tb(8,"mat-form-field",8),m.Tb(9,"mat-label"),m.Rc(10,"To Date"),m.Sb(),m.Tb(11,"input",12),m.bc("click",(function(){return m.Ec(e),m.Ac(14).open()}))("ngModelChange",(function(t){return m.Ec(e),m.fc().toDate=t}))("focus",(function(){return m.Ec(e),m.Ac(14).open()}))("ngModelChange",(function(){return m.Ec(e),m.fc().validateFromDateAndToDate()})),m.Sb(),m.Ob(12,"mat-datepicker-toggle",10),m.Ob(13,"mat-datepicker",null,13),m.Pc(15,qt,2,0,"small",14),m.Sb(),m.Tb(16,"mat-form-field",15),m.Tb(17,"mat-label"),m.Rc(18,"Payment Mode"),m.Sb(),m.Tb(19,"mat-select",16),m.bc("ngModelChange",(function(t){return m.Ec(e),m.fc().paymentMode=t})),m.Tb(20,"mat-option",17,18),m.bc("click",(function(){return m.Ec(e),m.fc().toggleAllSelection()})),m.Rc(22,"Select All"),m.Sb(),m.Pc(23,Jt,2,3,"mat-option",19),m.Sb(),m.Sb(),m.Tb(24,"div",20),m.Tb(25,"button",21),m.bc("click",(function(){return m.Ec(e),m.fc().onSearch()})),m.Tb(26,"mat-icon"),m.Rc(27,"search"),m.Sb(),m.Sb(),m.Sb(),m.Sb()}if(2&e){const e=m.Ac(7),t=m.Ac(14),i=m.fc();m.Cb(4),m.mc("ngModelOptions",m.qc(12,Qt))("ngModel",i.fromDate)("matDatepicker",e),m.Cb(1),m.mc("for",e),m.Cb(6),m.mc("ngModelOptions",m.qc(13,Qt))("ngModel",i.toDate)("matDatepicker",t),m.Cb(1),m.mc("for",t),m.Cb(3),m.mc("ngIf",!i.isValidDate),m.Cb(4),m.mc("ngModel",i.paymentMode),m.Cb(1),m.mc("value",0),m.Cb(3),m.mc("ngForOf",i.paymentModes)}}function Zt(e,t){if(1&e&&(m.Tb(0,"mat-option",28),m.Rc(1),m.Sb()),2&e){const e=t.$implicit;m.mc("value",e.description),m.Cb(1),m.Tc("",e.description," ")}}function ei(e,t){if(1&e){const e=m.Ub();m.Tb(0,"div",23),m.Tb(1,"mat-form-field",24),m.Tb(2,"mat-label"),m.Rc(3,"Months"),m.Sb(),m.Tb(4,"mat-select",25),m.bc("selectionChange",(function(t){return m.Ec(e),m.fc().onChangeMonths(t.value)}))("valueChange",(function(t){return m.Ec(e),m.fc().monthSelected=t})),m.Pc(5,Zt,2,2,"mat-option",26),m.Sb(),m.Tb(6,"mat-hint"),m.Rc(7,"Please select Months"),m.Sb(),m.Sb(),m.Tb(8,"div",20),m.Tb(9,"button",27),m.bc("click",(function(){return m.Ec(e),m.fc().onSearch()})),m.Rc(10,"Search"),m.Sb(),m.Sb(),m.Sb()}if(2&e){const e=m.fc();m.Cb(4),m.mc("value",e.monthSelected),m.Cb(1),m.mc("ngForOf",e.lstMonths)}}let ti=(()=>{class e{constructor(e,t,i,l,n){this.snackbar=e,this.datePipe=t,this.masterService=i,this.fb=l,this.cookieService=n,this.paymentModes=[],this.searchClicked=new m.o,this.manageParams={},this.fromDate="",this.toDate="",this.paymentMode=[],this.isViewSecurityDeposit=!1,this.ownerId=0,this.clientId=0,this.role="",this.isValidDate=!0,this.lstMonths=[],this.monthSelected="3 Months"}ngOnInit(){this.ownerId=parseInt(this.cookieService.get("ownerId")),this.paymentModes.splice(0,1),this.ownerId>0&&this.masterService.getSystemMasterdata(81,0).subscribe(e=>{e&&e.length>0&&(this.lstMonths=e,this.monthSelected=this.lstMonths[0].description),this.onSearch()}),this.form=this.fb.group({paymentMode:[""]})}getDates(){if(this.lstMonths!=[]&&""!=this.monthSelected){let e=this.monthSelected.substr(0,this.monthSelected.indexOf(" "));const t=new Date,i=new Date;i.setMonth(i.getMonth()-parseInt(e)+1),i.setDate(1),this.fromDate=i.toString(),this.toDate=t.toString()}}onSearch(){if(this.ownerId>0&&this.getDates(),this.ownerId=parseInt(this.cookieService.get("ownerId")),this.clientId=parseInt(this.cookieService.get("globalClientId")),this.fromDate&&this.toDate||this.paymentMode.length>0||this.ownerId>0){let e=this.paymentMode.findIndex(e=>0==e);e>=0&&this.paymentMode.splice(e,1);let t=this.paymentMode.join(",");this.manageParams={fromDate:this.fromDate?""+this.datePipe.transform(this.fromDate,"yyyy-MM-dd"):"",toDate:this.toDate?""+this.datePipe.transform(this.toDate,"yyyy-MM-dd"):"",paymentMode:""+t,paymentId:0,tenantId:this.ownerId.toString(),clientId:this.clientId,billType:this.isViewSecurityDeposit?3:0},this.searchClicked.emit(this.manageParams)}else this.snackbar.open("Invalid search parameters",null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:["yellow-snackbar"]})}onChangePaymentMode(e){this.paymentMode=e}toggleAllSelection(){this.form.controls.paymentMode.patchValue(this.allSelected.selected?[...this.paymentModes.map(e=>e.value),0]:[])}togglePerOne(e){if(this.allSelected.selected)return this.allSelected.deselect(),!1;this.form.controls.paymentMode.value.length==this.paymentModes.length&&this.allSelected.select()}changeViewSecurityDeposit(e){this.isViewSecurityDeposit=e.checked}validateFromDateAndToDate(){if(this.fromDate&&this.toDate){let e=new Date(this.fromDate),t=new Date(this.toDate);this.isValidDate=Object(b.g)(e,t)}}onChangeMonths(e){this.monthSelected=e}}return e.\u0275fac=function(t){return new(t||e)(m.Nb(k.b),m.Nb(a.f),m.Nb(je.a),m.Nb(l.f),m.Nb(C.a))},e.\u0275cmp=m.Hb({type:e,selectors:[["app-payment-history-toolbar"]],viewQuery:function(e,t){var i;1&e&&m.Vc(Xt,!0),2&e&&m.zc(i=m.cc())&&(t.allSelected=i.first)},inputs:{paymentModes:"paymentModes",role:"role"},outputs:{searchClicked:"searchClicked"},decls:7,vars:4,consts:[[1,"person","bottom-padding"],[3,"formGroup"],["fxLayout","column","fxLayout.gt-sm","column","fxLayoutGap.gt-sm","8px","style","padding-bottom: 20px;",4,"ngIf"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","8px"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","8px",4,"ngIf"],["fxLayout","row","fxLayoutGap","15px","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","15px",4,"ngIf"],["fxLayout","column","fxLayout.gt-sm","column","fxLayoutGap.gt-sm","8px",2,"padding-bottom","20px"],["color","primary",1,"isViewSecurityDeposit",3,"change"],["color","primary",1,"result",2,"width","180px"],["id","fromDate","name","fromDate","matInput","","readonly","",3,"ngModelOptions","ngModel","matDatepicker","click","ngModelChange","focus"],["matSuffix","",3,"for"],["formDatepickerRef1",""],["id","toDate","name","toDate","matInput","","readonly","",3,"ngModelOptions","ngModel","matDatepicker","click","ngModelChange","focus"],["formDatepickerRef2",""],[4,"ngIf"],[1,"result",2,"width","220px"],["id","PaymentMode","name","PaymentMode","multiple","","formControlName","paymentMode",3,"ngModel","ngModelChange"],[3,"value","click"],["allSelected",""],[3,"value","optionSelected","click",4,"ngFor","ngForOf"],[1,"fury-flex-form-field"],["mat-icon-button","","aria-label","Example icon-button with menu icon",1,"example-icon",3,"click"],[3,"value","optionSelected","click"],["fxLayout","row","fxLayoutGap","15px","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","15px"],["color","primary",1,"result",2,"width","160px"],["id","months","name","months",3,"value","selectionChange","valueChange"],[3,"value",4,"ngFor","ngForOf"],["mat-button","",1,"buttonStyle",3,"click"],[3,"value"]],template:function(e,t){1&e&&(m.Tb(0,"mat-dialog-content"),m.Tb(1,"div",0),m.Tb(2,"form",1),m.Pc(3,$t,3,0,"div",2),m.Tb(4,"div",3),m.Pc(5,Kt,28,14,"div",4),m.Pc(6,ei,11,2,"div",5),m.Sb(),m.Sb(),m.Sb(),m.Sb()),2&e&&(m.Cb(2),m.mc("formGroup",t.form),m.Cb(1),m.mc("ngIf",0==t.ownerId),m.Cb(2),m.mc("ngIf",0==t.ownerId),m.Cb(1),m.mc("ngIf",t.ownerId>0))},directives:[h.f,l.z,l.r,l.k,a.o,S.d,S.e,Gt.a,I.d,I.h,W.b,l.c,B.b,l.q,l.t,B.d,I.j,B.a,O.a,l.i,L.n,a.n,P.a,w.a,I.g],styles:[".button[_ngcontent-%COMP%]{line-height:50px}small[_ngcontent-%COMP%]{color:red}.buttonStyle[_ngcontent-%COMP%]{background:#f5f5f5;margin-top:15px}"]}),e})();var ii=i("HDyx");function li(e,t){if(1&e){const e=m.Ub();m.Tb(0,"fury-payment-history-footer-toolbar",13),m.bc("sendReceiptClicked",(function(){return m.Ec(e),m.fc().onSendReceipt()}))("printClicked",(function(){return m.Ec(e),m.fc().onPrintPdf()}))("exportClicked",(function(){return m.Ec(e),m.fc().onExport()})),m.Sb()}2&e&&m.mc("show",!1)}function ni(e,t){if(1&e){const e=m.Ub();m.Tb(0,"div",14),m.Tb(1,"fury-expandable-table-structure",15),m.bc("selectedRows",(function(t){return m.Ec(e),m.fc().onSelectedRows(t)}))("printDataRow",(function(t){return m.Ec(e),m.fc().downloadReport(t)}))("viewDataRow",(function(t){return m.Ec(e),m.fc().onViewDataRow(t)}))("deleteDataRow",(function(t){return m.Ec(e),m.fc().onDeleteDataRow(t)}))("filterDataRow",(function(t){return m.Ec(e),m.fc().onFilterDataRow(t)})),m.Sb(),m.Sb()}if(2&e){const e=m.fc();m.Cb(1),m.mc("tableData",e.payments)("columnsToDisplay",e.columns)("innerDisplayedColumns",e.innerColumns)("columnNames",e.columnNames)("innerTableName",e.innerTableName)("visibleButtons",e.visibleButtons)("hideHeader",!1)("viewButtonColumn",e.viewButtonColumn)("cssStyledColumn",e.cssStyledColumn)("role",e.role)("buttonDisableColumn",e.buttonDisableColumn)}}function oi(e,t){if(1&e&&(m.Tb(0,"th",33),m.Rc(1),m.Sb()),2&e){const e=m.fc(2).$implicit;m.Cb(1),m.Tc(" ",e.name,"")}}function ai(e,t){if(1&e&&(m.Tb(0,"td",34),m.Rc(1),m.Sb()),2&e){const e=t.$implicit,i=m.fc(2).$implicit;m.Cb(1),m.Tc(" ",e[i.property]," ")}}function si(e,t){if(1&e&&(m.Rb(0,30),m.Pc(1,oi,2,1,"th",31),m.Pc(2,ai,2,1,"td",32),m.Qb()),2&e){const e=m.fc().$implicit;m.mc("matColumnDef",e.property)}}function ri(e,t){if(1&e&&(m.Rb(0),m.Pc(1,si,3,1,"ng-container",29),m.Qb()),2&e){const e=t.$implicit;m.Cb(1),m.mc("ngIf",e.isModelProperty)}}function ci(e,t){1&e&&(m.Tb(0,"th",35),m.Rc(1,"RECEIVED AMOUNT"),m.Sb())}function ui(e,t){if(1&e&&(m.Tb(0,"td",36),m.Rc(1),m.Sb()),2&e){const e=t.$implicit;m.Cb(1),m.Tc(" ",e.paymentAmountLocal," ")}}function di(e,t){1&e&&m.Ob(0,"th",37)}function mi(e,t){if(1&e){const e=m.Ub();m.Tb(0,"td",38),m.Tb(1,"button",39),m.bc("click",(function(){m.Ec(e);const i=t.$implicit;return m.fc(2).downloadReport(i)})),m.Tb(2,"mat-icon"),m.Rc(3,"print"),m.Sb(),m.Sb(),m.Sb()}}function hi(e,t){1&e&&m.Ob(0,"tr",40)}function bi(e,t){1&e&&m.Ob(0,"tr",41)}function pi(e,t){if(1&e){const e=m.Ub();m.Tb(0,"div",16),m.Tb(1,"fury-list",17),m.bc("filterChange",(function(t){return m.Ec(e),m.fc().onFilterChange(t)})),m.Tb(2,"table",18),m.Pc(3,ri,2,1,"ng-container",19),m.Rb(4,20),m.Pc(5,ci,2,0,"th",21),m.Pc(6,ui,2,1,"td",22),m.Qb(),m.Rb(7,23),m.Pc(8,di,1,0,"th",24),m.Pc(9,mi,4,0,"td",25),m.Qb(),m.Pc(10,hi,1,0,"tr",26),m.Pc(11,bi,1,0,"tr",27),m.Sb(),m.Ob(12,"mat-paginator",28),m.Sb(),m.Sb()}if(2&e){const e=m.fc();m.Cb(1),m.mc("columns",e.displayedColumns),m.Cb(1),m.mc("dataSource",e.dataSource),m.Cb(1),m.mc("ngForOf",e.displayedColumns),m.Cb(7),m.mc("matHeaderRowDef",e.visibleColumns),m.Cb(1),m.mc("matRowDefColumns",e.visibleColumns),m.Cb(1),m.mc("pageSize",e.pageSize)}}function fi(e,t){if(1&e){const e=m.Ub();m.Tb(0,"div",42),m.Tb(1,"mat-form-field",43),m.Tb(2,"mat-label"),m.Rc(3,"Advance Adjusted"),m.Sb(),m.Tb(4,"input",44),m.bc("ngModelChange",(function(t){return m.Ec(e),m.fc().advanceAmount=t})),m.Sb(),m.Sb(),m.Tb(5,"mat-form-field",43),m.Tb(6,"mat-label"),m.Rc(7,"Received Amount"),m.Sb(),m.Tb(8,"input",45),m.bc("ngModelChange",(function(t){return m.Ec(e),m.fc().receivedAmount=t})),m.Sb(),m.Sb(),m.Sb()}if(2&e){const e=m.fc();m.Cb(4),m.mc("ngModel",e.advanceAmount),m.Cb(4),m.mc("ngModel",e.receivedAmount)}}let gi=(()=>{class e{constructor(e,t,i,l,n,o,a,s,r,c,u,d,m){var h,p,f;this.billService=e,this.billSettlementService=t,this.date=i,this.currency=l,this.decimalPipe=n,this.dialog=o,this.templateService=a,this.jwtHelperService=s,this.snackbar=r,this.clientSelectionService=c,this.cookieService=u,this.envService=d,this.ref=m,this._gap=16,this.gap=this._gap+"px",this.col2=`1 1 calc(50% - ${this._gap/2}px)`,this.col3=`1 1 calc(33.3333% - ${this._gap/1.5}px)`,this.columns=[],this.innerColumns=[],this.columnNames=[],this.payments=[],this.paymentModes=[{label:"Select",value:0}],this.selectedRows=[],this.manageParams={},this.innerTableName="billMasters",this.visibleButtons=[],this.viewButtonColumn="billDateLocal",this.buttonDisableColumn="isLatestBill",this.receivedAmount="",this.advanceAmount="",this.cssStyledColumn="status",this.dateFormat="",this.currencyFormat="",this.roundOffFormat="",this.filePath="",this.paymentNumberColumnName="Payment No",this.paymentDateColumnName="Payment Date",this.paymentModeColumnName="Payment Mode",this.refNoColumnName="Ref No",this.accountNumberColumnName="Account Number",this.tenantColumnName="Customer Name",this.receivedAmountColumnName="Received Amount",this.adjustWithAdvanceColumnName="Advance Adjusted",this.billNumberColumnName="Bill No",this.billDateCoulmnName="BillDate",this.tenantNameColumnName="Tenant Name",this.unitColumnName="Unit",this.fromDateColumnName="From Date",this.toDateColumnName="To Date",this.dueDateColumnName="Due Date",this.billAmountColumnName="Net Bill Amount",this.billDateColumnName="BillDate",this.paidAmountColumnName="Received Amount",this.pageSize=10,this.dataSource=new re.k([]),this.displayedColumns=[{name:this.paymentDateColumnName,property:"paymentDateLocal",visible:!0,isModelProperty:!0},{name:this.paymentNumberColumnName,property:"paymentNumber",visible:!0,isModelProperty:!0},{name:this.paymentModeColumnName,property:"paymentMode",visible:!0,isModelProperty:!0},{name:this.receivedAmountColumnName,property:"paymentAmountLocal",visible:!0,isModelProperty:!1},{name:"Actions",property:"actions",visible:!0}],this.fullyPaidCount="",this.partialyPaidCount="",this.role="",this.pdfsToMerge=[],this.roundFormat=Object(b.e)("RoundOff"),this.filePath=d.backendForFiles,this.dateFormat=null!==(h=Object(b.e)("DateFormat"))&&void 0!==h?h:d.dateFormat,this.currencyFormat=null!==(p=Object(b.e)("Currency"))&&void 0!==p?p:d.currencyFormat,this.roundOffFormat=null!==(f=Object(b.e)("RoundOff"))&&void 0!==f?f:d.roundOffFormat}set content(e){this.sort=e,this.dataSource&&this.sort&&(this.dataSource.sort=this.sort)}get visibleColumns(){return this.displayedColumns.filter(e=>e.visible).map(e=>e.property)}ngOnInit(){var e;this.columnsProps=this.displayedColumns.map(e=>e.property),this.clientSelectionService.setIsClientVisible(!0);let t=this.cookieService.get("access_token");this.clientId=parseInt(this.cookieService.get("globalClientId"));const i=this.jwtHelperService.decodeToken(t);i&&(this.role=i["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"]),this.ownerId=null!==(e=parseInt(this.cookieService.get("ownerId")))&&void 0!==e?e:0,this.onGetPaymentModes(),this.createColumnNames(),this.createGridColumns(),this.createInnerGridColumns(),this.addVisibleButtons(),this.ownerId>0?(this.manageParams.fromDate=""==this.manageParams.fromDate?"":R(this.manageParams.fromDate).format("YYYY-MM-DD"),this.manageParams.toDate=""==this.manageParams.toDate?"":R(this.manageParams.toDate).format("YYYY-MM-DD"),this.manageParams.tenantId=this.ownerId.toString(),this.manageParams.clientId=this.clientId,this.manageParams.paymentMode="",this.manageParams.paymentId=0,this.clientSelectionService.setIsClientVisible(!1),this.onGetPaymentHistory(this.manageParams)):this.clientSelectionService.setIsClientVisible(!0)}createGridColumns(){this.columns=0==this.ownerId?["select","paymentDateLocal","paymentNumber","accountNumber","tenantName","paymentReference","paymentMode","paymentAmountLocal","advanceAmountLocal","action"]:["paymentDateLocal","paymentNumber","paymentMode","paymentAmountLocal","action"]}createInnerGridColumns(){this.innerColumns=["billNumber","billDateLocal","unitNumber","fromDateLocal","toDateLocal","dueDateLocal","billAmountLocal","paidLocal","balanceAmountLocal","button"]}createColumnNames(){this.columnNames=[{name:this.paymentNumberColumnName,property:"paymentNumber"},{name:this.paymentDateColumnName,property:"paymentDateLocal"},{name:this.refNoColumnName,property:"paymentReference"},{name:this.paymentModeColumnName,property:"paymentMode"},{name:this.accountNumberColumnName,property:"accountNumber"},{name:this.tenantColumnName,property:"tenantName"},{name:this.receivedAmountColumnName,property:"paymentAmountLocal",columnAlign:{"text-align":"right"}},{name:this.billNumberColumnName,property:"billNumber"},{name:this.billDateColumnName,property:"billDateLocal"},{name:this.unitColumnName,property:"unitNumber"},{name:this.fromDateColumnName,property:"fromDateLocal"},{name:this.toDateColumnName,property:"toDateLocal"},{name:this.dueDateColumnName,property:"dueDateLocal"},{name:this.billAmountColumnName,property:"billAmountLocal",columnAlign:{"text-align":"right"}},{name:this.paidAmountColumnName,property:"paidLocal",columnAlign:{"text-align":"right"}},{name:this.adjustWithAdvanceColumnName,property:"advanceAmountLocal",columnAlign:{"text-align":"right"}},{name:this.adjustWithAdvanceColumnName,property:"balanceAmountLocal",columnAlign:{"text-align":"right"}}]}addVisibleButtons(){this.visibleButtons=[{property:"cancel"}]}onGetPaymentHistory(e){this.manageParams=e,this.payments=[],this.receivedAmount="",this.fullyPaidCount="",this.partialyPaidCount="";let t=0,i=0;new Map,this.billService.getPaymentHistory(e).subscribe(l=>{var n,o;if(this.dateFormat=Object(b.e)("DateFormat"),this.roundOffFormat=Object(b.e)("RoundOff"),this.currencyFormat=Object(b.e)("Currency"),3==e.billType?l=l.filter(t=>t.billType==e.billType):0==this.ownerId&&(l=l.filter(e=>3!=e.billType)),l&&l.length&&l.forEach(e=>{e.paymentDateLocal=this.date.transform(e.paymentDate.toString(),this.dateFormat.toString()),e.referenceDateLocal=this.date.transform(e.referenceDate.toString(),this.dateFormat.toString()),e.paymentAmountLocal=this.currency.transform(e.paymentAmount,this.currencyFormat.toString(),!0,this.roundOffFormat),e.advanceAmountLocal=this.currency.transform(e.advanceAmount,this.currencyFormat.toString(),!0,this.roundOffFormat),e.billMasters.forEach(e=>{e.billDateLocal=e.billDate?this.date.transform(e.billDate.toString(),this.dateFormat.toString()):"",e.billAmountLocal=this.currency.transform(e.billAmount-e.creditNoteAmount,this.currencyFormat.toString(),!0,this.roundOffFormat),e.fromDateLocal=e.fromDate?this.date.transform(e.fromDate.toString(),this.dateFormat.toString()):"",e.toDateLocal=e.toDate?this.date.transform(e.toDate.toString(),this.dateFormat.toString()):"",e.dueDateLocal=e.dueDate?this.date.transform(e.dueDate.toString(),this.dateFormat.toString()):"",e.paidLocal=this.currency.transform(e.paid.toString(),this.currencyFormat.toString(),!0,this.roundOffFormat),e.creditNoteAmountLocal=this.currency.transform(e.creditNoteAmount.toString(),this.currencyFormat.toString(),!0,this.roundOffFormat),e.balanceAmountLocal=this.currency.transform(e.balanceAmount.toString(),this.currencyFormat.toString(),!0,this.roundOffFormat)}),t+=e.paymentAmount,i+=e.advanceAmount}),this.payments=l,this.dataSource=new re.k(this.payments),this.ref.detectChanges(),this.dataSource&&(this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort),this.receivedAmount=this.currency.transform(t,this.currencyFormat.toString(),!0,this.roundOffFormat),this.advanceAmount=this.currency.transform(i,this.currencyFormat.toString(),!0,this.roundOffFormat),this.payments&&this.payments.length){const e=null!==(n=this.payments.filter(e=>"Full"===e.status).length)&&void 0!==n?n:0;this.fullyPaidCount=" - "+e.toString();const t=null!==(o=this.payments.filter(e=>"Partial"===e.status).length)&&void 0!==o?o:0;this.partialyPaidCount=" - "+t.toString()}})}onGetPaymentModes(){this.paymentModes=[{label:"Select",value:0}],this.billSettlementService.getPaymentModes().subscribe(e=>{e.forEach(e=>{this.paymentModes.push({label:e.description,value:e.id})})})}onPrintPdf(){return Object(r.a)(this,void 0,void 0,(function*(){if(this.selectedRows&&this.selectedRows.length){const e=this.selectedRows.filter(e=>3==e.billType),t=this.selectedRows.filter(e=>3!=e.billType);e&&e.length&&this.sdReceiptView(e),t&&t.length&&this.receiptView(t)}else this.notificationMessage("Please select Bills.","red-snackbar")}))}receiptView(e,t=null){this.billService.receiptView(e).subscribe({next:e=>{t&&t.length?this.sdReceiptView(t,e):e?this.downloadFile(e):this.notificationMessage("No data to print","red-snackbar")},error:e=>{this.notificationMessage("No data to print","red-snackbar")}})}downloadFile(e){return Object(r.a)(this,void 0,void 0,(function*(){const t=yield G.PDFDocument.create();for(const o of e){const e=yield G.PDFDocument.load(o);(yield t.copyPages(e,e.getPageIndices())).forEach(e=>{t.addPage(e)})}const i=yield t.save(),l=new Blob([i],{type:"application/pdf"}),n=window.URL.createObjectURL(l);window.open(n)}))}base64ToArrayBuffer(e){for(var t=window.atob(e),i=t.length,l=new Uint8Array(i),n=0;n<i;n++)l[n]=t.charCodeAt(n);return l.buffer}downloadReport(e){const t=[e];3==e.billType?this.sdReceiptView(t):this.receiptView(t)}addImage(e,t){var i;try{if(t&&t.billMasters&&t.billMasters.length&&t.billMasters[0]&&t.billMasters[0].client&&t.billMasters[0].client.imageProperties&&t.billMasters[0].client.imageProperties.length){const n=t.billMasters[0].client.imageProperties.find(e=>"receipt"===e.imageType.trim().toLowerCase());if(n){var l=new Image;l.src=this.filePath+"/uploads/"+(null===(i=null==t?void 0:t.billMasters[0].client)||void 0===i?void 0:i.photo),l.onload=function(){e.addImage(l,n.imgX,n.imgY,n.imgW,n.imgH)}}else this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar")}else this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar")}catch(n){this.notificationMessage("Image not found.","red-snackbar")}return e}getReport(e,t,i){var l,n,o,a,s,r,c,u,d,m,h,p,f,g,v,y,C,S,T,P,D,w,N,x,A,F,R,k,I,O,W,M,L,B,z,U,E,j,H,Y,V,_,G,X,$,q;let J=new fe.default({orientation:"portrait",unit:"pt",format:"letter"}),Q=Object(b.f)(null===(n=null===(l=null==e?void 0:e.billMasters[0])||void 0===l?void 0:l.client)||void 0===n?void 0:n.website).split(".")[1];J.rect(5,5,J.internal.pageSize.width-10,J.internal.pageSize.height-10,"S"),J.setFontSize(30),this.addImage(J,e),J.setTextColor(0,0,0),J.setFontSize(14),J.setFont("Cambria","bold"),J.text("PAYMENT RECEIPT",260,30),J.setFont("Cambria","normal"),J.setFontSize(14),J.text(Object(b.f)(null===(a=null===(o=null==e?void 0:e.billMasters[0])||void 0===o?void 0:o.client)||void 0===a?void 0:a.clientName).toUpperCase(),10,50),J.setFontSize(10),J.text("TRN: "+Object(b.f)(null===(r=null===(s=null==e?void 0:e.billMasters[0])||void 0===s?void 0:s.client)||void 0===r?void 0:r.trnNo),10,60),J.text("PO Box "+Object(b.f)(null===(d=null===(u=null===(c=null==e?void 0:e.billMasters[0])||void 0===c?void 0:c.client)||void 0===u?void 0:u.addresses[0])||void 0===d?void 0:d.zipPostalCode),10,70),J.text(Object(b.f)(null===(p=null===(h=null===(m=null==e?void 0:e.billMasters[0])||void 0===m?void 0:m.client)||void 0===h?void 0:h.addresses[0])||void 0===p?void 0:p.location,",")+Object(b.f)(null===(v=null===(g=null===(f=null==e?void 0:e.billMasters[0])||void 0===f?void 0:f.client)||void 0===g?void 0:g.addresses[0])||void 0===v?void 0:v.city,",")+Object(b.f)(null===(S=null===(C=null===(y=null==e?void 0:e.billMasters[0])||void 0===y?void 0:y.client)||void 0===C?void 0:C.addresses[0])||void 0===S?void 0:S.country,","),10,80),J.text("Phone: "+Object(b.f)(null===(P=null===(T=null==e?void 0:e.billMasters[0])||void 0===T?void 0:T.client)||void 0===P?void 0:P.phoneNo),10,90),J.text("Email: "+Object(b.f)(null===(w=null===(D=null==e?void 0:e.billMasters[0])||void 0===D?void 0:D.client)||void 0===w?void 0:w.email),10,100),J.text("Web: "+Object(b.f)(null===(x=null===(N=null==e?void 0:e.billMasters[0])||void 0===N?void 0:N.client)||void 0===x?void 0:x.website),10,110),J.setFillColor(241,241,244),J.setDrawColor(206,203,203),J.rect(10,120,250,90,"FD"),J.setTextColor(0,0,0),J.setFontSize(12),J.text(Object(b.f)(null==e?void 0:e.tenantName).toUpperCase(),20,135),J.text("CUSTOMER TRN: "+Object(b.f)(null==e?void 0:e.trn),20,155),J.text("unit #"+Object(b.f)(null===(A=null==e?void 0:e.billMasters[0])||void 0===A?void 0:A.unitNumber),20,170),J.setFontSize(10),J.text(Object(b.f)(null===(F=null==e?void 0:e.billMasters[0])||void 0===F?void 0:F.clientName),20,185),J.text(Object(b.f)(null===(k=null===(R=null==e?void 0:e.billMasters[0].client)||void 0===R?void 0:R.addresses[0])||void 0===k?void 0:k.city,",")+Object(b.f)(null===(W=null===(O=null===(I=null==e?void 0:e.billMasters[0])||void 0===I?void 0:I.client)||void 0===O?void 0:O.addresses[0])||void 0===W?void 0:W.country,","),20,200),J.setFontSize(9),J.autoTable("",i,{startX:210,startY:120,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:400},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:100,halign:"right"}},didParseCell:function(e){const t=e.column.index;0!=t&&1!=t||(e.cell.styles.rowHeight=1)},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});const K=Number(this.decimalPipe.transform(J.autoTable.previous.finalY,"1.0-0"));J.setLineWidth(.1),J.line(5,K+10,607,K+10),J.setTextColor(0,0,0),J.setFontSize(10),J.text("Thank you for using "+Q+" payment services.",20,K+30),J.text("We confirm receipt of your payment.",20,K+40),J.text("Please see the below details for your reference.",20,K+50),J.setTextColor(0,0,0),J.autoTable("",t,{startX:300,startY:K+60,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:110},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:180,halign:"left"},1:{cellWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"}}),J.setTextColor(0,0,0);const Z=Number(this.decimalPipe.transform(J.autoTable.previous.finalY,"1.0-0"));J.setTextColor(255,0,0),J.setFontSize(9),J.text(`Note: A Late Fee will be applied after the due date. A Default Payment \nPenalty will be added to any unit that is ${null===(M=null==e?void 0:e.billMasters[0])||void 0===M?void 0:M.penaltyAfter} days or more in arrears.`,320,Z+20),J.setTextColor(25,118,210),J.setFontSize(12),J.text("USAGE TIPS to reduce consumption:",10,Z+80),J.text("Please Try to:",10,Z+100),J.setTextColor(0,0,0),J.setFontSize(9),J.text("- Keep filters clean",30,Z+110),J.text("- Set thermostats between 23C and 25C",30,Z+120),J.text("- Keep vents unblocked",30,Z+130),J.text("- Keep doors and windows closed",30,Z+140),J.text("- Undertake regular maintenance of the system",30,Z+150),J.setTextColor(25,118,210),J.setFontSize(12),J.text("Please Do Not:",10,Z+170),J.setTextColor(0,0,0),J.setFontSize(9),J.text("- Set thermostats to 20C or lower",30,Z+180),J.text("- Block vents",30,Z+190),J.text("- Leave doors and windows open",30,Z+200),J.text("- Leave heat producing appliances near thermostats",30,Z+210),J.setFillColor(119,183,11);var ee=J.internal.pageSize.height||J.internal.pageSize.getHeight();J.rect(320,Z+60,280,ee-80-(Z+60),"FD"),J.setFont("Comic Sans"),J.setTextColor(255,255,255),J.setFontSize(16),J.text("ADVERTISE WITH US",360,Z+80);const te=J.getTextWidth("ADVERTISE WITH US");J.setLineWidth(.1),J.line(360,Z+85,360+te,Z+85),J.setFontSize(9),J.text("For advertisement, contact at",390,Z+95),J.text(Object(b.f)(null===(B=null===(L=null==e?void 0:e.billMasters[0])||void 0===L?void 0:L.client)||void 0===B?void 0:B.phoneNo),390,Z+105),J.text(Object(b.f)(null===(U=null===(z=null==e?void 0:e.billMasters[0])||void 0===z?void 0:z.client)||void 0===U?void 0:U.email),390,Z+115),J.text(Object(b.f)(null===(j=null===(E=null==e?void 0:e.billMasters[0])||void 0===E?void 0:E.client)||void 0===j?void 0:j.website),390,Z+125),J.setTextColor(0,0,0),J.setLineWidth(.1),J.line(5,ee-70,607,ee-70),J.text(null!==(X=null!==(V="For any enquiries, write to us "+(null===(Y=null===(H=null==e?void 0:e.billMasters[0])||void 0===H?void 0:H.client)||void 0===Y?void 0:Y.email))&&void 0!==V?V:"\n or Logon to "+(null===(G=null===(_=e.billMasters[0])||void 0===_?void 0:_.client)||void 0===G?void 0:G.website))&&void 0!==X?X:"",10,ee-60),J.setTextColor(255,0,0),J.setFont("bold");const ie=J.getTextWidth("Notice:");J.text("Notice:",340,ee-60),J.setFont("none"),J.setTextColor(0,0,0),J.text("Pay your bills before due date to avoid late payment surcharge",340+ie,ee-60),J.text("and disconnection.",340,ee-50),J.text("You can log onto "+(null===(q=null===($=null==e?void 0:e.billMasters[0])||void 0===$?void 0:$.client)||void 0===q?void 0:q.website)+" to pay your invoices \nTerms & Conditions for Supply of Utility Services",340,ee-40),"function"==typeof J.putTotalPages&&J.putTotalPages("1");var le=J.output("datauristring");this.pdfsToMerge.push(le)}onSendReceipt(){this.selectedRows&&this.selectedRows.length?this.templateService.emailCustomTemplate({clientId:this.clientId,templateName:"Receipt",notificationType:"Receipt",payments:this.selectedRows}).subscribe({next:e=>{e&&e.status?this.notificationMessage("Notifications send failed. "+e.status,"red-snackbar"):e&&e.isSuccess?this.notificationMessage("Notifications send successfully.\nTotal Requests : "+(null==e?void 0:e.totalRequests)+"\nSuccessfull Requests : "+(null==e?void 0:e.successFullRequests)+"\nFailed Requests : "+(null==e?void 0:e.failedRequests),"green-snackbar"):this.notificationMessage("Notifications send failed.\nTotal Requests : "+(e?e.totalRequests:"0")+"\nSuccessfull Requests : "+(e?e.successFullRequests:"0")+"\nFailed Requests : "+(e?e.failedRequests:"0"),"red-snackbar")},error:()=>{this.notificationMessage("Notifications send failed.","red-snackbar")}}):this.notificationMessage("Please select Bills.","red-snackbar")}notificationMessage(e,t){this.snackbar.open(e,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[t]})}onDeleteDataRow(e){e.contractNotExist?this.notificationMessage("Contract against this payment is in suspended or closed state, Hence payment can't be cancelled","red-snackbar"):e.refundAmount>0?this.notificationMessage("Can't cancel this payment,refund exist against this payment","red-snackbar"):this.dialog.open(_t,{data:e}).afterClosed().subscribe(()=>{e&&this.onGetPaymentHistory(this.manageParams)})}onSelectedRows(e){this.selectedRows=[],this.selectedRows=e}onViewDataRow(e){this.dialog.open(v,{data:e}).afterClosed().subscribe()}getJsonData(){this.tableData=[],null!=this.payments&&this.payments.forEach(e=>{let t={PaymentDate:this.date.transform(e.paymentDate,"yyyy-MM-dd"),PaymentNo:e.paymentNumber,AccountNumber:e.accountNumber,CustomerName:e.tenantName,RefNo:e.paymentReference,PaymentMode:e.paymentMode,ReceivedAmount:e.paymentAmountLocal};this.tableData.push(t)})}onExport(){if(this.payments&&this.payments.length>0){if(this.getJsonData(),null!=this.tableData){const e=vt.utils.json_to_sheet(this.tableData),t=vt.utils.book_new();vt.utils.book_append_sheet(t,e,"Sheet1"),vt.writeFile(t,"Payment History.xlsx")}}else this.notificationMessage("No Data to Export","yellow-snackbar")}onFilterDataRow(e){let t=0,i=0;e&&e.length&&e.forEach(e=>{t+=e.paymentAmount,i+=e.advanceAmount}),this.receivedAmount=this.currency.transform(t,this.currencyFormat.toString(),!0,this.roundOffFormat),this.advanceAmount=this.currency.transform(i,this.currencyFormat.toString(),!0,this.roundOffFormat)}onFilterChange(e){this.dataSource&&(e=(e=e.trim()).toLowerCase(),this.dataSource.filter=e)}onGetPaymentDetail(e,t=0){const i=Number(this.cookieService.get("globalClientId"));this.billService.getPaymentDetail(e,i).subscribe({next:e=>{e.forEach(e=>{e.paymentDateLocal=this.date.transform(e.paymentDate.toString(),this.dateFormat.toString()),e.referenceDateLocal=this.date.transform(e.referenceDate.toString(),this.dateFormat.toString()),e.paymentAmountLocal=this.currency.transform(e.paymentAmount,this.currency.toString(),!0,this.roundFormat),e.advanceAmountLocal=this.currency.transform(e.advanceAmount,this.currency.toString(),!0,this.roundFormat),e.billMasters&&e.billMasters.length&&e.billMasters.forEach(e=>{var t,i,l,n,o;e.billDateLocal=this.date.transform(null===(t=null==e?void 0:e.billDate)||void 0===t?void 0:t.toString(),this.dateFormat.toString()),e.billAmountLocal=this.currency.transform(null==e?void 0:e.billAmount,this.currency.toString(),!0,this.roundFormat),e.fromDateLocal=this.date.transform(null===(i=null==e?void 0:e.fromDate)||void 0===i?void 0:i.toString(),this.dateFormat.toString()),e.toDateLocal=this.date.transform(null===(l=null==e?void 0:e.toDate)||void 0===l?void 0:l.toString(),this.dateFormat.toString()),e.dueDateLocal=this.date.transform(null===(n=null==e?void 0:e.dueDate)||void 0===n?void 0:n.toString(),this.dateFormat.toString()),e.paidLocal=this.currency.transform(null===(o=null==e?void 0:e.paid)||void 0===o?void 0:o.toString(),this.currency.toString(),!0,this.roundFormat)})}),this.sdReceiptView(e)},error:()=>{this.notificationMessage("Payment details not found","red-snackbar")}})}sdReceiptView(e,t=null){this.billService.sdReceiptView(e).subscribe({next:e=>{t&&t.length&&(e.forEach(e=>{t.push(e)}),e=t),e?this.downloadFile(e):this.notificationMessage("No data to print","red-snackbar")},error:e=>{this.notificationMessage("No data to print","red-snackbar")}})}}return e.\u0275fac=function(t){return new(t||e)(m.Nb(c.a),m.Nb(F.a),m.Nb(a.f),m.Nb(a.d),m.Nb(a.g),m.Nb(h.b),m.Nb(pe.a),m.Nb(y.a),m.Nb(k.b),m.Nb(_.a),m.Nb(C.a),m.Nb(p.a),m.Nb(m.h))},e.\u0275cmp=m.Hb({type:e,selectors:[["app-payment-history"]],viewQuery:function(e,t){var i;1&e&&(m.Vc(yt.a,!0),m.Vc(Ct.a,!0)),2&e&&(m.zc(i=m.cc())&&(t.paginator=i.first),m.zc(i=m.cc())&&(t.content=i.first))},inputs:{displayedColumns:"displayedColumns"},decls:17,vars:9,consts:[["mode","card",2,"margin-top","20px"],["fxLayout","column"],["color","primary",1,"position-fixed"],["src","assets/img/fav-icon.png",1,"img-style"],[1,"toolbar-spacer"],[3,"show","sendReceiptClicked","printClicked","exportClicked",4,"ngIf"],["fxFlex","noshrink","fxLayout","column","fxLayout.gt-sm","row","fxLayoutAlign.gt-sm","start stretch",3,"fxLayoutGap"],["fxFlex","grow",1,"basic-forms","route-animations-elements",3,"fxFlex.gt-sm"],["fxLayout","column",1,"result"],[3,"paymentModes","role","searchClicked"],["class","padding","fxLayout","column","style","overflow:auto",4,"ngIf"],["class","padding","fxLayout","column",4,"ngIf"],["class","result","fxLayout.gt-sm","row","fxLayout","column","fxLayoutAlign","end center","fxLayoutGap.gt-sm","12px",4,"ngIf"],[3,"show","sendReceiptClicked","printClicked","exportClicked"],["fxLayout","column",1,"padding",2,"overflow","auto"],[3,"tableData","columnsToDisplay","innerDisplayedColumns","columnNames","innerTableName","visibleButtons","hideHeader","viewButtonColumn","cssStyledColumn","role","buttonDisableColumn","selectedRows","printDataRow","viewDataRow","deleteDataRow","filterDataRow"],["fxLayout","column",1,"padding"],[3,"columns","filterChange"],["mat-table","","matSort","",2,"text-align","center",3,"dataSource"],[4,"ngFor","ngForOf"],["matColumnDef","paymentAmountLocal"],["mat-header-cell","","class","header-align-right",4,"matHeaderCellDef"],["mat-cell","","class","header-align-right",4,"matCellDef"],["matColumnDef","actions"],["class","actions-cell","mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["class","actions-cell","mat-cell","",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["class","clickable route-animations-elements","mat-row","",4,"matRowDef","matRowDefColumns"],[1,"paginator",3,"pageSize"],[3,"matColumnDef",4,"ngIf"],[3,"matColumnDef"],["mat-header-cell","","mat-sort-header","","class","header-align-left",4,"matHeaderCellDef"],["mat-cell","","class","header-align-left",4,"matCellDef"],["mat-header-cell","","mat-sort-header","",1,"header-align-left"],["mat-cell","",1,"header-align-left"],["mat-header-cell","",1,"header-align-right"],["mat-cell","",1,"header-align-right"],["mat-header-cell","","mat-sort-header","",1,"actions-cell"],["mat-cell","",1,"actions-cell"],["matTooltip","Print","mat-icon-button","",1,"example-icon",3,"click"],["mat-header-row",""],["mat-row","",1,"clickable","route-animations-elements"],["fxLayout.gt-sm","row","fxLayout","column","fxLayoutAlign","end center","fxLayoutGap.gt-sm","12px",1,"result"],["color","primary","fxFlex","15%",1,"result"],["type","text","id","advanceAmount","name","advanceAmount","matInput","",2,"text-align","right",3,"ngModel","ngModelChange"],["type","text","id","receivedAmount","name","receivedAmount","matInput","",2,"text-align","right",3,"ngModel","ngModelChange"]],template:function(e,t){1&e&&(m.Tb(0,"fury-page-layout",0),m.Tb(1,"fury-page-layout-content",1),m.Tb(2,"mat-toolbar",2),m.Ob(3,"img",3),m.Tb(4,"span"),m.Rc(5,"Payment History"),m.Sb(),m.Ob(6,"span",4),m.Pc(7,li,1,1,"fury-payment-history-footer-toolbar",5),m.Sb(),m.Tb(8,"div",6),m.Tb(9,"fury-card",7),m.Ob(10,"fury-card-header"),m.Tb(11,"fury-card-content",1),m.Tb(12,"div",8),m.Tb(13,"app-payment-history-toolbar",9),m.bc("searchClicked",(function(e){return t.onGetPaymentHistory(e)})),m.Sb(),m.Sb(),m.Pc(14,ni,2,11,"div",10),m.Pc(15,pi,13,6,"div",11),m.Pc(16,fi,9,2,"div",12),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb()),2&e&&(m.Cb(7),m.mc("ngIf",0==t.ownerId),m.Cb(1),m.mc("fxLayoutGap",t.gap),m.Cb(1),m.mc("fxFlex.gt-sm",t.col2)("@fadeInUp",void 0),m.Cb(4),m.mc("paymentModes",t.paymentModes)("role",t.role),m.Cb(1),m.mc("ngIf",0==t.ownerId),m.Cb(1),m.mc("ngIf",t.ownerId>0),m.Cb(1),m.mc("ngIf",0==t.ownerId))},directives:[X.a,$.a,S.d,q.a,a.o,S.b,S.c,S.e,f.a,f.d,f.c,ti,ii.a,T.a,St.a,re.j,Ct.a,a.n,re.c,re.e,re.b,re.g,re.i,yt.a,re.d,Ct.b,re.a,P.a,D.a,w.a,re.f,re.h,I.d,I.h,W.b,l.c,l.q,l.t],styles:[".padding[_ngcontent-%COMP%]{padding:0 0 24px}.toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.img-style[_ngcontent-%COMP%]{width:32px}ul[_ngcontent-%COMP%]{margin:20px}.label-color[_ngcontent-%COMP%]{position:relative}.label-color[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{padding-left:20px}.label-color[_ngcontent-%COMP%]   .color-box[_ngcontent-%COMP%]{width:10px;height:10px;display:inline-block;background-color:#ccc;position:absolute;left:5px;top:5px}.position-fixed[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;top:0;z-index:5}.header-align-right[_ngcontent-%COMP%]{text-align:right}.header-align-left[_ngcontent-%COMP%]{text-align:left}"],data:{animation:[d.a,u.a]}}),e})();const vi=["htmlData"];let yi=(()=>{class e{constructor(e,t,i,l,n,o,a,s){var r,c,u,d;this.route=e,this.router=t,this.date=i,this.currencyPipe=l,this.decimalPipe=n,this.billSettlementService=o,this.snackbar=a,this.envService=s,this.dateFormat="",this.currency="",this.roundFormat="",this.consumptionRoundOffFormat="",this.filePath="",this.filePath=s.backendForFiles,this.dateFormat=null!==(r=Object(b.e)("DateFormat"))&&void 0!==r?r:s.dateFormat,this.currency=null!==(c=Object(b.e)("Currency"))&&void 0!==c?c:s.currencyFormat,this.roundFormat=null!==(u=Object(b.e)("RoundOff"))&&void 0!==u?u:s.roundOffFormat,this.consumptionRoundOffFormat=null!==(d=Object(b.e)("ConsumptionRoundOff"))&&void 0!==d?d:s.consumptionRoundOffFormat}ngOnInit(){this.route&&this.route.paramMap.subscribe(e=>{e&&(this.id=e.get("id"),this.type=e.get("type"))}),this.type&&"invoice"===this.type&&this.onGetInvoiceBillDetails(this.id),this.type&&"receipt"===this.type&&this.onGetReceiptDetails(this.id)}onGetInvoiceBillDetails(e){this.billSettlementService.getInvoiceBillDetails(e).subscribe(e=>{e.billDateLocal=this.date.transform(e.billDate.toString(),this.dateFormat.toString()),e.fromDateLocal=this.date.transform(e.fromDate.toString(),this.dateFormat.toString()),e.toDateLocal=this.date.transform(e.toDate.toString(),this.dateFormat.toString()),e.dueDateLocal=this.date.transform(e.toDate.toString(),this.dateFormat.toString()),e.billAmountLocal=this.currencyPipe.transform(e.billAmount,this.currency.toString(),!0,this.roundFormat),e.paidLocal=this.currencyPipe.transform(e.paid,this.currency.toString(),!0,this.roundFormat),e.bills.forEach(e=>{e.billAmountLocal=this.currencyPipe.transform(e.billAmount,this.currency.toString(),!0,this.roundFormat)}),"Bill Format 1"===e.billFormat?this.downloadBillReport(e):"Bill Format 2"===e.billFormat?e.bills&&e.bills.length>3?this.downloadLargeBillNewReport(e):this.downloadBillNewReport(e):"Bill Format 3"===e.billFormat&&this.downloadBillNewFormatReport(e)})}downloadLargeBillNewReport(e){var t,i,l,n,o,a,s,r,c,u,d,m,h,p,f,g,v,y;let C=[],S=[],T=[],P=[],D=[],w=[],N=[],x=[],A=[],F=[];for(let I=0;I<e.bills.length;I++)this.consumptionRoundOffFormat=null!==(t=Object(b.e)("ConsumptionRoundOff",e.bills[I].utilityTypeId))&&void 0!==t?t:this.envService.consumptionRoundOffFormat,C.push(e.bills[I].unitNumber),C.push(e.bills[I].deviceName),C.push(this.decimalPipe.transform(e.bills[I].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[I].measuringUnit),C.push(this.decimalPipe.transform(e.bills[I].presentReading,this.consumptionRoundOffFormat)+" "+e.bills[I].measuringUnit),C.push(e.bills[I].isDifferentiateBill?this.decimalPipe.transform(e.bills[I].presentReading-e.bills[I].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[I].measuringUnit:this.decimalPipe.transform(e.bills[I].consumption,this.consumptionRoundOffFormat)+" "+e.bills[I].measuringUnit),"BTU"===e.bills[I].utilityType&&e.bills[I].billTransactions&&e.bills[I].billTransactions.length&&e.bills[I].billTransactions.findIndex(e=>e.measuringUnitId&&2===e.measuringUnitId)>-1?C.push(this.decimalPipe.transform(.284345*e.bills[I].consumption,this.consumptionRoundOffFormat)):C.push(0),S.push(C),C=[];let R=0;for(let I=0;I<e.bills.length;I++){this.consumptionRoundOffFormat=null!==(i=Object(b.e)("ConsumptionRoundOff",e.bills[I].utilityTypeId))&&void 0!==i?i:this.envService.consumptionRoundOffFormat;const t=e.bills[I];for(let e=0;e<t.billTransactions.length;e++)t.billTransactions[e].headAmount&&(C.push(t.billNumber),C.push(t.billTransactions[e].headDisplay),"BTU"===t.utilityType&&t.billTransactions&&t.billTransactions.length&&t.billTransactions[e]&&t.billTransactions[e].measuringUnitId&&2===t.billTransactions[e].measuringUnitId?(C.push(this.decimalPipe.transform(.284345*t.consumption,this.consumptionRoundOffFormat)),C.push("TR-HR"),C.push(t.consumptionRate)):(C.push(this.decimalPipe.transform(t.consumption,this.consumptionRoundOffFormat)),C.push(t.measuringUnit),C.push(t.consumptionRate)),C.push(this.decimalPipe.transform(t.billTransactions[e].headAmount,this.roundFormat)),x.push(C),C=[],R+=t.billTransactions[e].headAmount)}C.push(e.accountNumber),C.push(e.fromDateLocal+"-"+e.toDateLocal),C.push(this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)),C.push(e.billAmountLocal),P.push(C),e.billCharges.forEach(e=>{if("VAT"!==e.headDisplay){const t=T.find(t=>t.label===e.headDisplay);t?t.value+=e.headAmount:T.push({label:e.headDisplay,value:e.headAmount})}}),T.forEach(e=>{A.push({label:e.label,value:this.currencyPipe.transform(e.value,this.currency.toString(),!0,this.roundFormat)}),R+=e.value}),A.push({label:"Total Charges for Current Period",value:this.currencyPipe.transform(R,this.currency.toString(),!0,this.roundFormat)}),e.billTaxDetails.forEach(e=>{const t=A.find(t=>t.label===e.taxDisplayName);if(t){const i=Number(t.value.replace(this.currency,"").trim())+Number(e.taxAmount);t.value=this.currencyPipe.transform(i,this.currency.toString(),!0,this.roundFormat)}else A.push({label:e.taxDisplayName,value:this.currencyPipe.transform(e.taxAmount,this.currency.toString(),!0,this.roundFormat)})}),A.push({label:"Previous Outstanding Amount",value:this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)},{label:"Total Amount Due",value:this.currencyPipe.transform(e.billAmount+e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)}),D.push({label:"Date of issue",value:null!==(l=null==e?void 0:e.billDateLocal)&&void 0!==l?l:""},{label:"Due Date",value:null!==(n=null==e?void 0:e.dueDateLocal)&&void 0!==n?n:""}),w.push({label:"Customer Name",value:null!==(o=null==e?void 0:e.ownerName)&&void 0!==o?o:""},{label:"Customer AccountNumber",value:null!==(a=null==e?void 0:e.accountNumber)&&void 0!==a?a:""},{label:"Address",value:null!==(r=null===(s=null==e?void 0:e.receiverDetails[0])||void 0===s?void 0:s.address1)&&void 0!==r?r:""},{label:"City",value:null!==(u=null===(c=null==e?void 0:e.receiverDetails[0])||void 0===c?void 0:c.city)&&void 0!==u?u:""},{label:"P.O Box",value:null!==(m=null===(d=null==e?void 0:e.receiverDetails[0])||void 0===d?void 0:d.zipPostalCode)&&void 0!==m?m:""},{label:"Phone number",value:null!==(p=null===(h=null==e?void 0:e.receiverDetails[0])||void 0===h?void 0:h.phoneNumber)&&void 0!==p?p:""},{label:"Fax Number",value:""},{label:"Client",value:null!==(g=null===(f=null==e?void 0:e.client)||void 0===f?void 0:f.clientName)&&void 0!==g?g:""},{label:"Client TRN",value:null!==(y=null===(v=null==e?void 0:e.client)||void 0===v?void 0:v.trnNo)&&void 0!==y?y:""}),N.push({firstItem:"Billing period",secondItem:"From:",thirdItem:e.fromDateLocal,fourthItem:"To:",fifthItem:e.toDateLocal});let k=[];C=[],e&&e.bills&&e.bills.length&&e.bills.forEach(e=>{if(e.billTariffDetails&&e.billTariffDetails.length)for(let t=0;t<e.billTariffDetails.length;t++)e.billTariffDetails[t].slabSettingsId&&e.billTariffDetails[t].slabSettingsId>0&&0==t?k=["Slab","Min Consumption","Max Consumption","Consumption","Rate","Amount"]:0==e.billTariffDetails[t].slabSettingsId&&0==t&&(k=["Season","Week Type","Peak Type","Consumption","Rate","Amount"]),C.push(e.billTariffDetails[t].season),C.push(e.billTariffDetails[t].weekType),C.push(e.billTariffDetails[t].peakType),C.push(e.billTariffDetails[t].consumption),C.push(e.billTariffDetails[t].rate),C.push(e.billTariffDetails[t].amount),F.push(C),C=[]}),this.getNewLargeBillReport(["Unit No","Meter No","Previous Reading","Present Reading","Consumption","Consumption TR-HR"],S,T,["Customer AccountNumber","Billing Period","Previous Due","Total for current period"],P,D,w,N,"Sample Report",["Bill No","Charges","Consumption","Measuring Unit","Tariff","Total"],x,e,A,k,F)}addImage(e,t){var i;try{if(t&&t.client&&t.client.imageProperties&&t.client.imageProperties.length){const n=t.client.imageProperties.find(e=>"invoice"===e.imageType.trim().toLowerCase());if(n){var l=new Image;l.src=this.filePath+"/uploads/"+(null===(i=null==t?void 0:t.client)||void 0===i?void 0:i.photo),l.onload=function(){e.addImage(l,n.imgX,n.imgY,n.imgW,n.imgH)}}else this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar")}else this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar")}catch(n){this.notificationMessage("Image not found.","red-snackbar")}return e}getNewLargeBillReport(e,t,i,l,n,o,a,s,r,c,u,d,m,h,b){var p,f,g,v,y;(new Image).src=this.filePath+"/uploads/"+(null===(p=null==d?void 0:d.client)||void 0===p?void 0:p.photo);let C=new fe.default({orientation:"portrait",unit:"pt",format:"letter"});const S=null!==(g=null===(f=null==d?void 0:d.client)||void 0===f?void 0:f.clientName)&&void 0!==g?g:"",T=C.getTextWidth(S.trim())+4;C.setTextColor(0,0,0),C.setFontSize(17),C.setFont("Cambria"),C.text(S,Number(C.internal.pageSize.width/2)-Number(0!=T?T/2:0),23),C.setDrawColor(0,0,0),C.line(Number(C.internal.pageSize.width/2)-Number(0!=T?T/2:0),26,Number(C.internal.pageSize.width/2)-Number(0!=T?T/2:0)+T,26),C.setFont("Cambria","normal"),C.setFontSize(14),C.text("Billing Statement",35,46),this.addImage(C,d),C.autoTable("",o,{startX:10,startY:55,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:35},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:150,halign:"left"},1:{cellWidth:190,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"},didParseCell:function(e){e.cell.styles.cellPadding=1}});const P=Math.round(C.autoTable.previous.finalY);C.autoTable("",s,{startX:10,startY:P,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:35},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:150,halign:"left"},1:{cellWidth:95,halign:"center"},2:{cellWidth:95,halign:"center"},3:{cellWidth:95,halign:"center"},4:{cellWidth:95,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0]},didParseCell:function(e){e.cell.styles.cellPadding=1}});const D=Math.round(C.autoTable.previous.finalY);C.autoTable("",a,{startX:10,startY:D,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:35},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:150,halign:"left"},1:{cellWidth:380,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0]},didParseCell:function(e){e.cell.styles.cellPadding=1}});var w=function(e){var t="Page "+e.pageCount;"function"==typeof C.putTotalPages&&(t=t),C.setFontSize(9)};const N=Math.round(C.autoTable.previous.finalY);C.setFont("Cambria"),C.setFontSize(10),C.text("Meter Read-Outs".toUpperCase(),35,N+20),C.autoTable(e,t,{startX:10,startY:N+40,showHead:"everyPage",didDrawPage:w,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:35},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"center"},1:{cellWidth:95,halign:"center"},2:{cellWidth:95,halign:"center"},3:{cellWidth:95,halign:"center"},4:{cellWidth:74,halign:"center"},5:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}});const x=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"));C.setFontSize(10),C.text("Charges Breakdown".toUpperCase(),35,x+20),C.autoTable(c,u,{startX:10,startY:x+40,showHead:"everyPage",didDrawPage:w,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:35},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:60,halign:"center"},1:{cellWidth:155,halign:"center"},2:{cellWidth:85,halign:"center"},3:{cellWidth:85,halign:"center"},4:{cellWidth:74,halign:"center"},5:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}});const A=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"));C.autoTable(h,b,{startX:10,startY:A+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:130,halign:"center"},1:{cellWidth:85,halign:"center"},2:{cellWidth:85,halign:"center"},3:{cellWidth:85,halign:"center"},4:{cellWidth:74,halign:"center"},5:{cellWidth:75,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}});let F=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0")),R=C.internal.pageSize.height;R-F<200&&(C.addPage(),F=P,R=370+P),C.autoTable("",m,{startX:10,startY:F+20,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{bottom:40,left:250},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:244,fontStyle:"italic"},1:{cellWidth:75}},didParseCell:function(e){1==e.column.index&&(e.cell.styles.halign="right"),e.cell.styles.cellPadding=1},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});let k=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"));C.setFillColor(241,241,244),C.rect(35,k+20,535,80,"FD"),C.setFillColor(0,0,0),C.setFontSize(9),C.text(null===(y=null===(v=null==d?void 0:d.client)||void 0===v?void 0:v.termsConditions[0])||void 0===y?void 0:y.termsAndCondition.replace("{{ClientName}}",d.client.clientName).replace("{{TRNNumber}}",d.client.trnNo).replace("{{Currency}}",this.currency),65,k+30),C.setTextColor(0,0,0),C.line(5,k+110,607,k+110),C.text("Notice :- Please tear and attach the slip  along with your payment",35,R-80),C.autoTable(l,n,{startX:10,startY:R-70,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:35},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:120,halign:"center"},1:{cellWidth:200,halign:"center"},2:{cellWidth:100,halign:"right"},3:{cellWidth:120,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}});var I=C.output("blob");window.open(URL.createObjectURL(I))}onGetReceiptDetails(e){this.billSettlementService.getReceiptDetails(e).subscribe(e=>{e.paymentDateLocal=this.date.transform(e.paymentDate.toString(),this.dateFormat.toString()),e.referenceDateLocal=this.date.transform(e.referenceDate.toString(),this.dateFormat.toString()),e.paymentAmountLocal=this.currencyPipe.transform(e.paymentAmount,this.currency.toString(),!0,this.roundFormat),e.advanceAmountLocal=this.currencyPipe.transform(e.advanceAmount,this.currency.toString(),!0,this.roundFormat),e.billMasters.forEach(e=>{e.billDateLocal=this.date.transform(e.billDate.toString(),this.dateFormat.toString()),e.billAmountLocal=this.currencyPipe.transform(e.billAmount,this.currency.toString(),!0,this.roundFormat),e.fromDateLocal=this.date.transform(e.fromDate.toString(),this.dateFormat.toString()),e.toDateLocal=this.date.transform(e.toDate.toString(),this.dateFormat.toString()),e.dueDateLocal=this.date.transform(e.dueDate.toString(),this.dateFormat.toString()),e.paidLocal=this.currencyPipe.transform(e.paid.toString(),this.currency.toString(),!0,this.roundFormat)}),this.downloadReport(e)})}downloadBillReport(e){let t=[],i=[],l=[],n=[],o=[];e.bills.forEach(l=>{l.billTransactions&&l.billTransactions.length&&l.billTransactions.forEach(n=>{t.push(n.headDisplay),t.push(e.fromDateLocal),t.push(e.toDateLocal),"BTU"===l.utilityType&&n.measuringUnitId&&2===n.measuringUnitId?(t.push(this.decimalPipe.transform(.284345*l.previousReading,this.roundFormat)+" TR-HR"),t.push(this.decimalPipe.transform(.284345*l.presentReading,this.roundFormat)+" TR-HR"),t.push(this.decimalPipe.transform(.284345*l.consumption,this.roundFormat)+" TR-HR")):(t.push(l.previousReading+" "+l.measuringUnit),t.push(l.presentReading+" "+l.measuringUnit),t.push(l.consumption+" "+l.measuringUnit)),t.push(l.consumptionRate),t.push(this.decimalPipe.transform(n.headAmount,this.roundFormat)),i.push(t),t=[]})}),e.billCharges.forEach(e=>{if("VAT"!==e.headDisplay){const t=l.find(t=>t.label===e.headDisplay);t?t.value+=e.headAmount:l.push({label:e.headDisplay,value:e.headAmount})}});for(let r=0;r<l.length;r++)t.push(l[r].label),t.push(""),t.push(""),t.push(""),t.push(""),t.push(""),t.push(""),t.push(this.decimalPipe.transform(l[r].value,this.roundFormat)),i.push(t),t=[];let a="";e.bills.forEach(e=>{a+=e.deviceName+","}),n.push({label:"Account Number:",value:e.accountNumber},{label:"Meter Number:",value:a.slice(0,-1)},{label:"Unit Number:",value:e.unitNumber},{label:"Billing Date:",value:e.billDateLocal},{label:"Due Date:",value:e.dueDateLocal});let s=0;i.forEach(e=>{s+=Number(e[7].replace(",",""))}),o.push({label:"Current Month Total:",value:this.currencyPipe.transform(s,this.currency.toString(),!0,this.roundFormat)}),e.billTaxDetails&&e.billTaxDetails.length?e.billTaxDetails.forEach(e=>{o.push({label:e.taxDisplayName,value:this.currencyPipe.transform(e.taxAmount,this.currency.toString(),!0,this.roundFormat)})}):o.push({label:"TAX:",value:this.currencyPipe.transform(0,this.currency.toString(),!0,this.roundFormat)}),o.push({label:"Current Month + TAX:",value:e.billAmountLocal},{label:"Previous Bill Outstanding Balance:",value:this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)},{label:"Total Due incl TAX:",value:this.currencyPipe.transform(e.billAmount+e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)}),this.getBillReport(e,["Services Description","From","To","Previous","Current","Consumption","Rate ","Charges"],i,l,["Customer Id","Billing Period","Total for current period"],[],[{value:"",value1:"Bill Period",value2:"Meter Reading",value3:"",value4:""}],n,o,"Invoice")}getBillReport(e,t,i,l,n,o,a,s,r,c){var u,d,m,h,p,f,g,v,y,C,S,T,P,D,w,N,x,A,F,R,k,I,O,W,M,L,B;let z=new fe.default({orientation:"portrait",unit:"pt",format:"letter"});z.rect(5,5,z.internal.pageSize.width-10,z.internal.pageSize.height-10,"S"),z.setFontSize(30),z=this.addInvoiceImage(z,e),z.setTextColor(0,0,0),z.setFontSize(16),z.setFont("Cambria","bold"),z.text("Tax Invoice",260,30),z.setFontSize(13),z.setFont("Cambria","normal"),z.text(null===(d=null===(u=null==e?void 0:e.client)||void 0===u?void 0:u.clientName)||void 0===d?void 0:d.toUpperCase(),10,60),z.setFontSize(10),z.setFont("Cambria"),z.text("TRN: "+e.client.trnNo,10,70),z.text("PO Box "+e.client.addresses[0].zipPostalCode,10,80),z.text(e.client.addresses[0].address1+","+e.client.addresses[0].country,10,90),z.text("Phone: "+e.client.phoneNo,10,100),z.text("Email: "+e.client.email+", Web: "+e.client.website,10,110),z.setFillColor(241,241,244),z.setDrawColor(206,203,203),z.rect(10,120,350,90,"FD"),z.setTextColor(0,0,0),z.setFontSize(12),z.text(null==e?void 0:e.ownerName.toUpperCase(),20,135),z.text("CUSTOMER TRN: "+e.trn,20,155),z.text("unit #"+e.unitNumber,20,170),z.setFontSize(10),z.text(e.clientName,20,185),z.text(Object(b.f)(null===(m=null==e?void 0:e.client)||void 0===m?void 0:m.buildingName,",")+Object(b.f)(null===(p=null===(h=null==e?void 0:e.client)||void 0===h?void 0:h.addresses[0])||void 0===p?void 0:p.location,",")+Object(b.f)(null===(g=null===(f=null==e?void 0:e.client)||void 0===f?void 0:f.addresses[0])||void 0===g?void 0:g.city,",")+Object(b.f)(null===(y=null===(v=null==e?void 0:e.client)||void 0===v?void 0:v.addresses[0])||void 0===y?void 0:y.country,","),20,200),z.setFontSize(9),z.setLineWidth(.1),z.line(5,265,607,265),z.setFontSize(10),z.setFont("bold"),z.text("Invoice#: ".toUpperCase(),400,110),z.setTextColor(25,118,210);const U=z.getTextWidth("Invoice#: ");let E="";(null==e?void 0:e.billNumber)&&(E=null===(C=e.billNumber)||void 0===C?void 0:C.toUpperCase()),z.text(E,410+U,110),z.setFont("none"),z.setTextColor(0,0,0),z.setFontSize(9),z.autoTable("",s,{startX:210,startY:120,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:400},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:100,halign:"right"}},didParseCell:function(e){const t=e.column.index;0!=t&&1!=t||(e.cell.styles.rowHeight=1)},headStyles:{lineWidth:.1,lineColor:[0,0,0]}}),z.autoTable("",a,{startX:10,startY:220,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:220,left:10},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,fontStyle:"bold",halign:"center"},1:{cellWidth:160,fontStyle:"bold",halign:"center"},2:{cellWidth:120,fontStyle:"bold",halign:"center"},3:{cellWidth:75,fontStyle:"bold",halign:"center"},4:{cellWidth:135,fontStyle:"bold",halign:"center"}},didParseCell:function(e){const t=e.column.index;0!=t&&1!=t||(e.cell.styles.rowHeight=1)},headStyles:{lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]}});const j=Number(this.decimalPipe.transform(z.autoTable.previous.finalY,"1.0-0"));z.autoTable(t,i,{startX:10,startY:j,didDrawPage:function(e){var t="Page "+e.pageCount;"function"==typeof z.putTotalPages&&(t+=" of 1",z.rect(5,5,z.internal.pageSize.width-10,z.internal.pageSize.height-10,"S")),z.setFontSize(9);var i=z.internal.pageSize.height||z.internal.pageSize.getHeight();z.text(t,e.settings.margin.left,i-10)},styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:j,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:80,halign:"center"},2:{cellWidth:80,halign:"center"},3:{cellWidth:60,halign:"center"},4:{cellWidth:60,halign:"center"},5:{cellWidth:75,halign:"center"},6:{cellWidth:60,halign:"right"},7:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=s.length>12?1.5:2}}),z.setTextColor(0,0,0);const H=Number(this.decimalPipe.transform(z.autoTable.previous.finalY,"1.0-0"));z.setTextColor(25,118,210),z.setFontSize(12),z.text("Bank Payment Account Details",10,H+20),z.setTextColor(0,0,0),z.setFontSize(9),z.text("Account Title: "+Object(b.f)(null===(T=null===(S=null==e?void 0:e.client)||void 0===S?void 0:S.bankDetails[0])||void 0===T?void 0:T.accountName),10,H+40),z.text("Account #: "+Object(b.f)(null===(D=null===(P=null==e?void 0:e.client)||void 0===P?void 0:P.bankDetails[0])||void 0===D?void 0:D.accountNo),10,H+50),z.text("IBAN #: "+Object(b.f)(null===(N=null===(w=null==e?void 0:e.client)||void 0===w?void 0:w.bankDetails[0])||void 0===N?void 0:N.ibanNumber),10,H+60),z.text("Bank Name: "+Object(b.f)(null===(A=null===(x=null==e?void 0:e.client)||void 0===x?void 0:x.bankDetails[0])||void 0===A?void 0:A.bankName),10,H+70),z.text("Swift Code: "+ +Object(b.f)(null===(R=null===(F=null==e?void 0:e.client)||void 0===F?void 0:F.bankDetails[0])||void 0===R?void 0:R.swiftCode),10,H+80),z.setFontSize(9),z.autoTable("",r,{startX:300,startY:H+20,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:320},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:180,halign:"left"},1:{cellWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"}});const Y=Number(this.decimalPipe.transform(z.autoTable.previous.finalY,"1.0-0"));z.setTextColor(255,0,0),z.text(`Note: A Late Fee will be applied after the due date. A Default Payment \nPenalty will be added to any unit that is ${Object(b.f)(null===(k=null==e?void 0:e.penaltyAfter)||void 0===k?void 0:k.toString())} days or more in arrears.`,320,Y+10),z.setTextColor(25,118,210),z.setFontSize(12),z.text("USAGE TIPS to reduce consumption:",10,Y+10),z.text("Please Try to:",10,Y+30),z.setTextColor(0,0,0),z.setFontSize(9),z.text("- Keep filters clean",30,Y+40),z.text("- Set thermostats between 23C and 25C",30,Y+50),z.text("- Keep vents unblocked",30,Y+60),z.text("- Keep doors and windows closed",30,Y+70),z.text("- Undertake regular maintenance of the system",30,Y+80),z.setTextColor(25,118,210),z.setFontSize(12),z.text("Please Do Not:",10,Y+100),z.setTextColor(0,0,0),z.setFontSize(9),z.text("- Set thermostats to 20C or lower",30,Y+110),z.text("- Block vents",30,Y+120),z.text("- Leave doors and windows open",30,Y+130),z.text("- Leave heat producing appliances near thermostats",30,Y+140),z.setFillColor(119,183,11);var V=z.internal.pageSize.height||z.internal.pageSize.getHeight();z.rect(320,Y+30,280,V-80-(Y+30),"FD"),z.setFont("Comic Sans"),z.setTextColor(255,255,255),z.setFontSize(16),z.text("ADVERTISE WITH US",360,Y+50);const _=z.getTextWidth("ADVERTISE WITH US");z.setLineWidth(.1),z.line(360,Y+55,360+_,Y+55),z.setFontSize(9),z.text("For advertisement, contact at",390,Y+65),z.text(Object(b.f)(null===(I=null==e?void 0:e.client)||void 0===I?void 0:I.phoneNo),390,Y+75),z.text(Object(b.f)(null===(O=null==e?void 0:e.client)||void 0===O?void 0:O.email),390,Y+85),z.text(Object(b.f)(null===(W=null==e?void 0:e.client)||void 0===W?void 0:W.website),390,Y+95),z.setTextColor(0,0,0),z.setLineWidth(.1),z.line(5,V-70,607,V-70),z.text(`For any enquiries, write to us ${Object(b.f)(null===(M=null==e?void 0:e.client)||void 0===M?void 0:M.email)} \nor Logon to ${Object(b.f)(null===(L=null==e?void 0:e.client)||void 0===L?void 0:L.website)}`,10,V-60),z.setTextColor(255,0,0),z.setFont("bold");const G=z.getTextWidth("Notice:");z.text("Notice:",340,V-60),z.setFont("none"),z.setTextColor(0,0,0),z.text("Pay your bills before due date to avoid late payment surcharge",340+G,V-60),z.text("and disconnection.",340,V-50),z.text(`You can log onto ${Object(b.f)(null===(B=null==e?void 0:e.client)||void 0===B?void 0:B.website)} to pay your invoices \nTerms & Conditions for Supply of Utility Services`,340,V-40),"function"==typeof z.putTotalPages&&z.putTotalPages("1");var X=z.output("blob");window.open(URL.createObjectURL(X))}downloadReport(e){let t=[],i=[],l="",n="";const o=Array.from(new Set(e.billMasters.map(e=>e.billNumber))),a=Array.from(new Set(e.billMasters.map(e=>e.unitNumber)));o&&o.length&&o.forEach(e=>{l+=e+","}),a&&a.length&&a.forEach(e=>{n+=e+","}),i.push({label:"Receipt Number:",value:e.paymentNumber},{label:"Receipt Date:",value:e.paymentDateLocal},{label:"Account Number:",value:e.accountNumber},{label:"Invoice Number:",value:0===l.trim().indexOf(",")?l.trim().slice(1).slice(0,-1):l.trim().slice(0,-1)},{label:"Unit Number:",value:0===n.trim().indexOf(",")?n.trim().slice(1).slice(0,-1):n.trim().slice(0,-1)},{label:"Mode of payment:",value:e.paymentMode});let s=0;e.billMasters.forEach(e=>{s+=e.paid});const r=e.outStandingAmount-s;t.push({label:"Total Outstanding Amount :",value:this.currencyPipe.transform(e.outStandingAmount,this.currency.toString(),!0,this.roundFormat)},{label:"Received Payments :",value:e.paymentAmountLocal},{label:"",value:""},{label:"Balance Outstanding :",value:this.currencyPipe.transform(r,this.currency.toString(),!0,this.roundFormat)}),this.getReport(e,t,i)}addReceiptImage(e,t){var i;try{if(t&&t.billMasters&&t.billMasters.length&&t.billMasters[0]&&t.billMasters[0].client&&t.billMasters[0].client.imageProperties&&t.billMasters[0].client.imageProperties.length){const n=t.billMasters[0].client.imageProperties.find(e=>"receipt"===e.imageType.trim().toLowerCase());if(n){var l=new Image;l.src=this.filePath+"/uploads/"+(null===(i=null==t?void 0:t.billMasters[0].client)||void 0===i?void 0:i.photo),l.onload=function(){e.addImage(l,n.imgX,n.imgY,n.imgW,n.imgH)}}else this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar")}else this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar")}catch(n){this.notificationMessage("Image not found.","red-snackbar")}return e}notificationMessage(e,t){this.snackbar.open(e,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[t]})}getReport(e,t,i){var l,n,o,a,s,r,c,u,d,m,h,p,f,g,v,y,C,S,T,P,D,w,N,x,A,F,R,k,I,O,W,M,L,B,z,U,E,j,H,Y,V,_,G,X,$,q;let J=new fe.default({orientation:"portrait",unit:"pt",format:"letter"}),Q=Object(b.f)(null===(n=null===(l=null==e?void 0:e.billMasters[0])||void 0===l?void 0:l.client)||void 0===n?void 0:n.website).split(".")[1];J.rect(5,5,J.internal.pageSize.width-10,J.internal.pageSize.height-10,"S"),J.setFontSize(30),this.addReceiptImage(J,e),J.setTextColor(0,0,0),J.setFontSize(14),J.setFont("Cambria","bold"),J.text("PAYMENT RECEIPT",260,30),J.setFont("Cambria","normal"),J.setFontSize(14),J.text(Object(b.f)(null===(a=null===(o=null==e?void 0:e.billMasters[0])||void 0===o?void 0:o.client)||void 0===a?void 0:a.clientName).toUpperCase(),10,50),J.setFontSize(10),J.text("TRN: "+Object(b.f)(null===(r=null===(s=null==e?void 0:e.billMasters[0])||void 0===s?void 0:s.client)||void 0===r?void 0:r.trnNo),10,60),J.text("PO Box "+Object(b.f)(null===(d=null===(u=null===(c=null==e?void 0:e.billMasters[0])||void 0===c?void 0:c.client)||void 0===u?void 0:u.addresses[0])||void 0===d?void 0:d.zipPostalCode),10,70),J.text(Object(b.f)(null===(p=null===(h=null===(m=null==e?void 0:e.billMasters[0])||void 0===m?void 0:m.client)||void 0===h?void 0:h.addresses[0])||void 0===p?void 0:p.location,",")+Object(b.f)(null===(v=null===(g=null===(f=null==e?void 0:e.billMasters[0])||void 0===f?void 0:f.client)||void 0===g?void 0:g.addresses[0])||void 0===v?void 0:v.city,",")+Object(b.f)(null===(S=null===(C=null===(y=null==e?void 0:e.billMasters[0])||void 0===y?void 0:y.client)||void 0===C?void 0:C.addresses[0])||void 0===S?void 0:S.country,","),10,80),J.text("Phone: "+Object(b.f)(null===(P=null===(T=null==e?void 0:e.billMasters[0])||void 0===T?void 0:T.client)||void 0===P?void 0:P.phoneNo),10,90),J.text("Email: "+Object(b.f)(null===(w=null===(D=null==e?void 0:e.billMasters[0])||void 0===D?void 0:D.client)||void 0===w?void 0:w.email),10,100),J.text("Web: "+Object(b.f)(null===(x=null===(N=null==e?void 0:e.billMasters[0])||void 0===N?void 0:N.client)||void 0===x?void 0:x.website),10,110),J.setFillColor(241,241,244),J.setDrawColor(206,203,203),J.rect(10,120,250,90,"FD"),J.setTextColor(0,0,0),J.setFontSize(12),J.text(Object(b.f)(null==e?void 0:e.tenantName).toUpperCase(),20,135),J.text("CUSTOMER TRN: "+Object(b.f)(null==e?void 0:e.trn),20,155),J.text("unit #"+Object(b.f)(null===(A=null==e?void 0:e.billMasters[0])||void 0===A?void 0:A.unitNumber),20,170),J.setFontSize(10),J.text(Object(b.f)(null===(F=null==e?void 0:e.billMasters[0])||void 0===F?void 0:F.clientName),20,185),J.text(Object(b.f)(null===(k=null===(R=null==e?void 0:e.billMasters[0].client)||void 0===R?void 0:R.addresses[0])||void 0===k?void 0:k.city,",")+Object(b.f)(null===(W=null===(O=null===(I=null==e?void 0:e.billMasters[0])||void 0===I?void 0:I.client)||void 0===O?void 0:O.addresses[0])||void 0===W?void 0:W.country,","),20,200),J.setFontSize(9),J.autoTable("",i,{startX:210,startY:120,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:400},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:100,halign:"right"}},didParseCell:function(e){const t=e.column.index;0!=t&&1!=t||(e.cell.styles.rowHeight=1)},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});const K=Number(this.decimalPipe.transform(J.autoTable.previous.finalY,"1.0-0"));J.setLineWidth(.1),J.line(5,K+10,607,K+10),J.setTextColor(0,0,0),J.setFontSize(10),J.text("Thank you for using "+Q+" payment services.",20,K+30),J.text("We confirm receipt of your payment.",20,K+40),J.text("Please see the below details for your reference.",20,K+50),J.setTextColor(0,0,0),J.autoTable("",t,{startX:300,startY:K+60,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:110},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:180,halign:"left"},1:{cellWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"}}),J.setTextColor(0,0,0);const Z=Number(this.decimalPipe.transform(J.autoTable.previous.finalY,"1.0-0"));J.setTextColor(255,0,0),J.setFontSize(9),J.text(`Note: A Late Fee will be applied after the due date. A Default Payment \nPenalty will be added to any unit that is ${null===(M=null==e?void 0:e.billMasters[0])||void 0===M?void 0:M.penaltyAfter} days or more in arrears.`,320,Z+20),J.setTextColor(25,118,210),J.setFontSize(12),J.text("USAGE TIPS to reduce consumption:",10,Z+80),J.text("Please Try to:",10,Z+100),J.setTextColor(0,0,0),J.setFontSize(9),J.text("- Keep filters clean",30,Z+110),J.text("- Set thermostats between 23C and 25C",30,Z+120),J.text("- Keep vents unblocked",30,Z+130),J.text("- Keep doors and windows closed",30,Z+140),J.text("- Undertake regular maintenance of the system",30,Z+150),J.setTextColor(25,118,210),J.setFontSize(12),J.text("Please Do Not:",10,Z+170),J.setTextColor(0,0,0),J.setFontSize(9),J.text("- Set thermostats to 20C or lower",30,Z+180),J.text("- Block vents",30,Z+190),J.text("- Leave doors and windows open",30,Z+200),J.text("- Leave heat producing appliances near thermostats",30,Z+210),J.setFillColor(119,183,11);var ee=J.internal.pageSize.height||J.internal.pageSize.getHeight();J.rect(320,Z+60,280,ee-80-(Z+60),"FD"),J.setFont("Comic Sans"),J.setTextColor(255,255,255),J.setFontSize(16),J.text("ADVERTISE WITH US",360,Z+80);const te=J.getTextWidth("ADVERTISE WITH US");J.setLineWidth(.1),J.line(360,Z+85,360+te,Z+85),J.setFontSize(9),J.text("For advertisement, contact at",390,Z+95),J.text(Object(b.f)(null===(B=null===(L=null==e?void 0:e.billMasters[0])||void 0===L?void 0:L.client)||void 0===B?void 0:B.phoneNo),390,Z+105),J.text(Object(b.f)(null===(U=null===(z=null==e?void 0:e.billMasters[0])||void 0===z?void 0:z.client)||void 0===U?void 0:U.email),390,Z+115),J.text(Object(b.f)(null===(j=null===(E=null==e?void 0:e.billMasters[0])||void 0===E?void 0:E.client)||void 0===j?void 0:j.website),390,Z+125),J.setTextColor(0,0,0),J.setLineWidth(.1),J.line(5,ee-70,607,ee-70),J.text(null!==(X=null!==(V="For any enquiries, write to us "+(null===(Y=null===(H=null==e?void 0:e.billMasters[0])||void 0===H?void 0:H.client)||void 0===Y?void 0:Y.email))&&void 0!==V?V:"\n or Logon to "+(null===(G=null===(_=e.billMasters[0])||void 0===_?void 0:_.client)||void 0===G?void 0:G.website))&&void 0!==X?X:"",10,ee-60),J.setTextColor(255,0,0),J.setFont("bold");const ie=J.getTextWidth("Notice:");J.text("Notice:",340,ee-60),J.setFont("none"),J.setTextColor(0,0,0),J.text("Pay your bills before due date to avoid late payment surcharge",340+ie,ee-60),J.text("and disconnection.",340,ee-50),J.text("You can log onto "+(null===(q=null===($=null==e?void 0:e.billMasters[0])||void 0===$?void 0:$.client)||void 0===q?void 0:q.website)+" to pay your invoices \nTerms & Conditions for Supply of Utility Services",340,ee-40),"function"==typeof J.putTotalPages&&J.putTotalPages("1");var le=J.output("blob");window.open(URL.createObjectURL(le))}downloadBillNewReport(e){var t,i,l,n,o,a,s,r,c,u,d,m,h,p,f,g,v,y,C,S;let T=[],P=[],D=[],w=[],N=[],x=[],A=[],F=[],R=[],k=[];for(let W=0;W<e.bills.length;W++)this.consumptionRoundOffFormat=null!==(t=Object(b.e)("ConsumptionRoundOff",e.bills[W].utilityTypeId))&&void 0!==t?t:this.consumptionRoundOffFormat,T.push(e.unitNumber),T.push(e.bills[W].deviceName),T.push(this.decimalPipe.transform(e.bills[W].previousReading,this.consumptionRoundOffFormat)),T.push(this.decimalPipe.transform(e.bills[W].presentReading,this.consumptionRoundOffFormat)),T.push(e.bills[W].isDifferentiateBill?this.decimalPipe.transform(e.bills[W].presentReading-e.bills[W].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[W].measuringUnit:this.decimalPipe.transform(e.bills[W].consumption,this.consumptionRoundOffFormat)+" "+e.bills[W].measuringUnit),"BTU"===e.bills[W].utilityType&&e.bills[W].billTransactions&&e.bills[W].billTransactions.length&&e.bills[W].billTransactions.findIndex(e=>e.measuringUnitId&&2===e.measuringUnitId)>-1?T.push(this.decimalPipe.transform(.284345*e.bills[W].consumption,this.consumptionRoundOffFormat)):T.push(0),P.push(T),T=[];let I=0;for(let W=0;W<e.bills.length;W++){const t=e.bills[W];this.consumptionRoundOffFormat=null!==(i=Object(b.e)("ConsumptionRoundOff",e.bills[W].utilityTypeId))&&void 0!==i?i:this.consumptionRoundOffFormat;for(let e=0;e<t.billTransactions.length;e++)t.billTransactions[e].headAmount&&(T.push(t.billNumber),T.push(t.billTransactions[e].headDisplay),"BTU"===t.utilityType&&t.billTransactions&&t.billTransactions.length&&t.billTransactions[e]&&t.billTransactions[e].measuringUnitId&&2===t.billTransactions[e].measuringUnitId?(T.push(this.decimalPipe.transform(.284345*t.consumption,this.consumptionRoundOffFormat)),T.push("TR-HR"),T.push(t.consumptionRate)):(T.push(this.decimalPipe.transform(t.consumption,this.consumptionRoundOffFormat)),T.push(t.measuringUnit),T.push(t.consumptionRate)),T.push(this.decimalPipe.transform(t.billTransactions[e].headAmount,this.roundFormat)),F.push(T),T=[],I+=t.billTransactions[e].headAmount)}T.push(e.accountNumber),T.push(e.fromDateLocal+"-"+e.toDateLocal),T.push(this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)),T.push(e.billAmountLocal),w.push(T),e.billCharges.forEach(e=>{if("VAT"!==e.headDisplay){const t=D.find(t=>t.label===e.headDisplay);t?t.value+=e.headAmount:D.push({label:e.headDisplay,value:e.headAmount})}}),D.forEach(e=>{R.push({label:e.label,value:this.currencyPipe.transform(e.value,this.currency.toString(),!0,this.roundFormat)}),I+=e.value}),R.push({label:"Total Charges for Current Period",value:this.currencyPipe.transform(I,this.currency.toString(),!0,this.roundFormat)}),e.billTaxDetails.forEach(e=>{const t=R.find(t=>t.label===e.taxDisplayName);if(t){const i=Number(t.value.replace(this.currency,"").trim())+Number(e.taxAmount);t.value=this.currencyPipe.transform(i,this.currency.toString(),!0,this.roundFormat)}else R.push({label:e.taxDisplayName,value:this.currencyPipe.transform(e.taxAmount,this.currency.toString(),!0,this.roundFormat)})}),R.push({label:"Previous Outstanding Amount",value:this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)},{label:"Total Amount Due",value:this.currencyPipe.transform(e.billAmount+e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)}),N.push({label:"Bill No",value:null!==(l=null==e?void 0:e.billNumber)&&void 0!==l?l:""},{label:"Date of issue",value:null!==(n=null==e?void 0:e.billDateLocal)&&void 0!==n?n:""},{label:"Due Date",value:null!==(o=null==e?void 0:e.dueDateLocal)&&void 0!==o?o:""}),x.push({label:"Customer Name",value:null!==(a=null==e?void 0:e.ownerName)&&void 0!==a?a:""},{label:"Customer AccountNumber",value:null!==(s=null==e?void 0:e.accountNumber)&&void 0!==s?s:""},{label:"Unit No",value:null!==(r=null==e?void 0:e.unitNumber)&&void 0!==r?r:""},{label:"Address",value:null!==(u=null===(c=null==e?void 0:e.receiverDetails[0])||void 0===c?void 0:c.address1)&&void 0!==u?u:""},{label:"City",value:null!==(m=null===(d=null==e?void 0:e.receiverDetails[0])||void 0===d?void 0:d.city)&&void 0!==m?m:""},{label:"P.O Box",value:null!==(p=null===(h=null==e?void 0:e.receiverDetails[0])||void 0===h?void 0:h.zipPostalCode)&&void 0!==p?p:""},{label:"Phone number",value:null!==(g=null===(f=null==e?void 0:e.receiverDetails[0])||void 0===f?void 0:f.phoneNumber)&&void 0!==g?g:""},{label:"Fax Number",value:""},{label:"Client",value:null!==(y=null===(v=null==e?void 0:e.client)||void 0===v?void 0:v.clientName)&&void 0!==y?y:""},{label:"Client TRN",value:null!==(S=null===(C=null==e?void 0:e.client)||void 0===C?void 0:C.trnNo)&&void 0!==S?S:""}),A.push({firstItem:"Billing period",secondItem:"From:",thirdItem:e.fromDateLocal,fourthItem:"To:",fifthItem:e.toDateLocal});let O=[];T=[],e&&e.bills&&e.bills.length&&e.bills.forEach(e=>{if(e.billTariffDetails&&e.billTariffDetails.length)for(let t=0;t<e.billTariffDetails.length;t++)e.billTariffDetails[t].slabSettingsId&&e.billTariffDetails[t].slabSettingsId>0&&0==t?O=["Slab","Min Consumption","Max Consumption","Consumption","Rate","Amount"]:0==e.billTariffDetails[t].slabSettingsId&&0==t&&(O=["Season","Week Type","Peak Type","Consumption","Rate","Amount"]),T.push(e.billTariffDetails[t].season),T.push(e.billTariffDetails[t].weekType),T.push(e.billTariffDetails[t].peakType),T.push(e.billTariffDetails[t].consumption),T.push(e.billTariffDetails[t].rate),T.push(e.billTariffDetails[t].amount),k.push(T),T=[]}),this.getNewBillReport(["Unit No","Meter No","Previous Reading","Present Reading","Consumption","Consumption TR-HR"],P,D,["Customer AccountNumber","Billing Period","Previous Due","Total for current period"],w,N,x,A,"Sample Report",["Charges","Consumption","Measuring Unit","Tariff","Total"],F,e,R,O,k)}addInvoiceImage(e,t){var i;try{if(t&&t.client&&t.client.imageProperties&&t.client.imageProperties.length){const n=t.client.imageProperties.find(e=>"invoice"===e.imageType.trim().toLowerCase());if(n){var l=new Image;l.src=this.filePath+"/uploads/"+(null===(i=null==t?void 0:t.client)||void 0===i?void 0:i.photo),l.onload=function(){e.addImage(l,n.imgX,n.imgY,n.imgW,n.imgH)}}else this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar")}else this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar")}catch(n){this.notificationMessage("Image not found.","red-snackbar")}return e}getNewBillReport(e,t,i,l,n,o,a,s,r,c,u,d,m,h,b){var p,f,g,v,y,C,S,T;let P=new fe.default({orientation:"portrait",unit:"pt",format:"letter"});const D=null!==(f=null===(p=null==d?void 0:d.client)||void 0===p?void 0:p.clientName)&&void 0!==f?f:"",w=P.getTextWidth(D.trim());P.setTextColor(0,0,0),P.setFontSize(17),P.setFont("Cambria"),P.text(D,Number(P.internal.pageSize.width/2)-Number(0!=w?w/2:0),18),this.addInvoiceImage(P,d),P.setLineWidth(.1),P.line(Number(P.internal.pageSize.width/2)-Number(0!=w?w/2:0),21,Number(P.internal.pageSize.width/2)-Number(0!=w?w/2:0)+w,21),P.setFontSize(13);let N="";d&&d.client&&d.client.addresses[0]&&(N=null!==(C=null!==(v=null===(g=d.client.addresses[0].address1)||void 0===g?void 0:g.toLowerCase())&&void 0!==v?v:","+(null===(y=d.client.addresses[0].city)||void 0===y?void 0:y.toLowerCase()))&&void 0!==C?C:"",","==N.trim()&&(N="")),P.text(N,Number(P.internal.pageSize.width/2)-Number(0!=w?w/2:0)+5,30),P.setLineWidth(.1),P.setFontSize(14),P.text("Billing Statement",30,41),P.autoTable("",o,{startX:10,startY:50,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:150,halign:"left"},1:{cellWidth:190,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"},didParseCell:function(e){e.cell.styles.cellPadding=1}});const x=Number(this.decimalPipe.transform(P.autoTable.previous.finalY,"1.0-0"));P.autoTable("",s,{startX:10,startY:x,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:150,halign:"left"},1:{cellWidth:95,halign:"center"},2:{cellWidth:95,halign:"center"},3:{cellWidth:95,halign:"center"},4:{cellWidth:95,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0]},didParseCell:function(e){e.cell.styles.cellPadding=1}});const A=Number(this.decimalPipe.transform(P.autoTable.previous.finalY,"1.0-0"));P.autoTable("",a,{startX:10,startY:A,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:150,halign:"left"},1:{cellWidth:380,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0]},didParseCell:function(e){e.cell.styles.cellPadding=1}});const F=Number(this.decimalPipe.transform(P.autoTable.previous.finalY,"1.0-0"));P.setFont("Cambria"),P.setFontSize(10),P.text("Meter Read-Outs".toUpperCase(),30,F+15),P.autoTable(e,t,{startX:10,startY:F+30,didDrawPage:function(e){var t="Page "+e.pageCount;P.setFontSize(10);var i=P.internal.pageSize.height||P.internal.pageSize.getHeight();P.text(t,e.settings.margin.left,i-10)},styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"center"},1:{cellWidth:95,halign:"center"},2:{cellWidth:95,halign:"center"},3:{cellWidth:95,halign:"center"},4:{cellWidth:74,halign:"center"},5:{cellWidth:75,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}});const R=Number(this.decimalPipe.transform(P.autoTable.previous.finalY,"1.0-0"));P.setFontSize(10),P.text("Charges Breakdown".toUpperCase(),30,R+15),P.autoTable(c,u,{startX:10,startY:R+30,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:60,halign:"center"},1:{cellWidth:155,halign:"center"},2:{cellWidth:85,halign:"center"},3:{cellWidth:85,halign:"center"},4:{cellWidth:74,halign:"center"},5:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}});const k=Number(this.decimalPipe.transform(P.autoTable.previous.finalY,"1.0-0"));P.autoTable(h,b,{startX:10,startY:k+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:130,halign:"center"},1:{cellWidth:85,halign:"center"},2:{cellWidth:85,halign:"center"},3:{cellWidth:85,halign:"center"},4:{cellWidth:74,halign:"center"},5:{cellWidth:75,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}});const I=Number(this.decimalPipe.transform(P.autoTable.previous.finalY,"1.0-0"));P.autoTable("",m,{startX:10,startY:I+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{bottom:35,left:230},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:235,fontStyle:"italic"},1:{cellWidth:100}},didParseCell:function(e){1==e.column.index&&(e.cell.styles.halign="right"),e.cell.styles.cellPadding=1},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});const O=Number(this.decimalPipe.transform(P.autoTable.previous.finalY,"1.0-0"));P.setFillColor(241,241,244),P.rect(30,O+20,535,80,"FD"),P.setFillColor(0,0,0),P.setFontSize(9),P.text(null===(T=null===(S=null==d?void 0:d.client)||void 0===S?void 0:S.termsConditions[0])||void 0===T?void 0:T.termsAndCondition.replace("{{ClientName}}",d.client.clientName).replace("{{TRNNumber}}",d.client.trnNo).replace("{{Currency}}",this.currency),60,O+30),P.setTextColor(0,0,0),P.line(5,O+110,607,O+110);const W=P.internal.pageSize.height;P.text("Notice :- Please tear and attach the slip  along with your payment",30,W-90),P.autoTable(l,n,{startX:10,startY:W-80,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:120,halign:"center"},1:{cellWidth:200,halign:"center"},2:{cellWidth:100,halign:"right"},3:{cellWidth:120,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}),"function"==typeof P.putTotalPages&&P.putTotalPages("1");var M=P.output("blob");window.open(URL.createObjectURL(M))}downloadBillNewFormatReport(e){var t,i,l,n,o,a,s,r,c,u,d;let m=[],h=[],p=[],f=[],g=[],v=[],y=[],C=[],S=["Meter No","Tarif","Previous Reading","Present Reading","Consumption","Unit Rate "+this.currency+"/TR-HR","Amount"];for(let D=0;D<e.bills.length;D++)this.consumptionRoundOffFormat=null!==(t=Object(b.e)("ConsumptionRoundOff",e.bills[D].utilityTypeId))&&void 0!==t?t:this.envService.consumptionRoundOffFormat,m.push(e.bills[D].deviceName),m.push(e.bills[D].utilityType),"BTU"===e.bills[D].utilityType&&e.bills[D].billTransactions&&e.bills[D].billTransactions.length&&e.bills[D].billTransactions.findIndex(e=>e.measuringUnitId&&2===e.measuringUnitId)>-1?(m.push(this.decimalPipe.transform(.284345*e.bills[D].previousReading,this.roundFormat)+" TR-HR"),m.push(this.decimalPipe.transform(.284345*e.bills[D].presentReading,this.roundFormat)+" TR-HR"),m.push(this.decimalPipe.transform(.284345*e.bills[D].consumption,this.roundFormat)+" TR-HR")):(m.push(this.decimalPipe.transform(e.bills[D].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[D].measuringUnit),m.push(this.decimalPipe.transform(e.bills[D].presentReading,this.consumptionRoundOffFormat)+" "+e.bills[D].measuringUnit),m.push(this.decimalPipe.transform(e.bills[D].consumption,this.consumptionRoundOffFormat)+" "+e.bills[D].measuringUnit)),m.push(e.bills[D].consumptionRate),m.push(e.bills[D].billAmountLocal),h.push(m),m=[];for(let D=0;D<e.bills.length;D++){this.consumptionRoundOffFormat=null!==(i=Object(b.e)("ConsumptionRoundOff",e.bills[D].utilityTypeId))&&void 0!==i?i:this.envService.consumptionRoundOffFormat;const t=e.bills[D];for(let e=0;e<t.billTransactions.length;e++)m.push(t.utilityType+"-"+t.billTransactions[e].headDisplay),m.push(this.decimalPipe.transform(t.consumption,this.consumptionRoundOffFormat)),m.push(t.consumptionUnit),m.push(t.consumptionRate),m.push(this.decimalPipe.transform(t.billTransactions[e].headAmount,this.roundFormat)),y.push(m),m=[]}m.push(e.accountNumber),m.push(e.fromDateLocal+"-"+e.toDateLocal),m.push(e.billAmountLocal),f.push(m);let T=[];e.bills.forEach(e=>{if(e.billTransactions&&e.billTransactions.length){const t=["consumption","consumptioncharge"];e.billTransactions.forEach(e=>{if(!t.includes(e.headDisplay.toLowerCase())){const t=T.find(t=>t.label===e.headDisplay);t?t.value+=e.headAmount:T.push({label:e.headDisplay,value:e.headAmount})}})}}),e.billCharges.forEach(e=>{if("VAT"!==e.headDisplay){const t=T.find(t=>t.label===e.headDisplay);t?t.value+=e.headAmount:T.push({label:e.headDisplay,value:e.headAmount})}});let P=0;T.forEach(e=>{p.push({label:e.label,value:this.currencyPipe.transform(e.value,this.currency.toString(),!0,this.roundFormat)}),P+=Number(e.value)}),e.billTaxDetails&&e.billTaxDetails.length&&e.billTaxDetails.forEach(e=>{p.push({label:e.taxDisplayName,value:this.currencyPipe.transform(e.taxAmount,this.currency.toString(),!0,this.roundFormat)}),P+=Number(e.taxAmount)}),C.push({label:"Total for Current Period",value:this.currencyPipe.transform(e.billAmount+e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)}),g.push({label:"Bill No",value:": "+Object(b.f)(e.billNumber)},{label:"Date of issue",value:": "+Object(b.f)(e.billDateLocal)},{label:"Due Date",value:": "+Object(b.f)(e.dueDateLocal)}),v.push({label:"Billing period",value:`:  From: ${Object(b.f)(e.fromDateLocal)} To: ${Object(b.f)(e.toDateLocal)} `},{label:"Customer Account",value:": "+Object(b.f)(e.accountNumber)},{label:"Customer Name",value:": "+Object(b.f)(e.ownerName)},{label:"Unit No",value:": "+Object(b.f)(e.unitNumber)},{label:"Address",value:": "+Object(b.f)(null===(n=null===(l=null==e?void 0:e.client)||void 0===l?void 0:l.addresses[0])||void 0===n?void 0:n.address1)},{label:"City",value:": "+Object(b.f)(null===(a=null===(o=null==e?void 0:e.client)||void 0===o?void 0:o.addresses[0])||void 0===a?void 0:a.city)},{label:"P.O Box",value:": "+Object(b.f)(null===(r=null===(s=null==e?void 0:e.client)||void 0===s?void 0:s.addresses[0])||void 0===r?void 0:r.zipPostalCode)},{label:"Phone number",value:": "+Object(b.f)(null===(c=null==e?void 0:e.receiverDetails[0])||void 0===c?void 0:c.phoneNumber)},{label:"Fax Number",value:": "},{label:"Client",value:": "+Object(b.f)(null===(u=null==e?void 0:e.client)||void 0===u?void 0:u.clientName)},{label:"Client TRN",value:": "+Object(b.f)(null===(d=null==e?void 0:e.client)||void 0===d?void 0:d.trnNo)}),this.getNewBillFormatReport(S,h,p,["Customer Number","Billing Period","Total for current period"],f,g,v,[],"Sample Report",["Charges","Consumption","Measuring Unit","Tariff","Total"],y,e,C)}getNewBillFormatReport(e,t,i,l,n,o,a,s,r,c,u,d,m){var h,b;let p=new fe.default({orientation:"portrait",unit:"pt",format:"letter"});p.rect(5,5,p.internal.pageSize.width-10,p.internal.pageSize.height-10,"S"),p.setTextColor(0,0,0),p.setFontSize(11),p.setFont("Cambria"),p.text("Billing Statement".toUpperCase(),10,20),this.addInvoiceImage(p,d),p.setLineWidth(.1),p.autoTable("",o,{startX:10,startY:35,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:15},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:190,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"},didParseCell:function(e){e.cell.styles.cellPadding=1.5}});const f=Number(this.decimalPipe.transform(p.autoTable.previous.finalY,"1.0-0"));p.autoTable("",a,{startX:10,startY:f,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:15},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:380,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0]},didParseCell:function(e){e.cell.styles.cellPadding=1.5}});const g=Number(this.decimalPipe.transform(p.autoTable.previous.finalY,"1.0-0"));p.setFont("Cambria"),p.text("Meter Read-Out".toUpperCase(),10,g+15),p.autoTable(e,t,{startX:10,startY:g+30,didDrawPage:function(e){var t="Page "+e.pageCount;p.setFontSize(10);var i=p.internal.pageSize.height||p.internal.pageSize.getHeight();p.text(t,e.settings.margin.left,i-10)},styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:15},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:70,halign:"center"},1:{cellWidth:100,halign:"center"},2:{cellWidth:90,halign:"center"},3:{cellWidth:90,halign:"center"},4:{cellWidth:80,halign:"center"},5:{cellWidth:73,halign:"center"},6:{cellWidth:73,halign:"center"},7:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1.5}});const v=Number(this.decimalPipe.transform(p.autoTable.previous.finalY,"1.0-0"));p.autoTable("",i,{startX:10,startY:v+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{bottom:35,left:250},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:250,fontStyle:"italic"},1:{cellWidth:100}},didParseCell:function(e){1==e.column.index&&(e.cell.styles.halign="right"),e.cell.styles.cellPadding=1.5},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});const y=Number(this.decimalPipe.transform(p.autoTable.previous.finalY,"1.0-0"));p.line(5,y+10,607,y+10),p.autoTable("",m,{startX:10,startY:y+20,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{bottom:35,left:250},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:250,fontStyle:"italic"},1:{cellWidth:100}},didParseCell:function(e){1==e.column.index&&(e.cell.styles.halign="right"),e.cell.styles.cellPadding=1.5},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});const C=Number(this.decimalPipe.transform(p.autoTable.previous.finalY,"1.0-0"));p.line(5,C+10,607,C+10),p.text(null===(b=null===(h=null==d?void 0:d.client)||void 0===h?void 0:h.termsConditions[0])||void 0===b?void 0:b.termsAndCondition.replace("{{ClientName}}",d.client.clientName).replace("{{TRNNumber}}",d.client.trnNo).replace("{{Currency}}",this.currency),10,C+30);var S=p.internal.pageSize.height||p.internal.pageSize.getHeight();p.text("Notice :- Please tear and attach the slip  along with your payment",10,S-90),p.autoTable(l,n,{startX:10,startY:S-70,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:15},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"center"},1:{cellWidth:340,halign:"center"},2:{cellWidth:150,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1.5}}),"function"==typeof p.putTotalPages&&p.putTotalPages("1");var T=p.output("blob");window.open(URL.createObjectURL(T))}}return e.\u0275fac=function(t){return new(t||e)(m.Nb(s.a),m.Nb(s.f),m.Nb(a.f),m.Nb(a.d),m.Nb(a.g),m.Nb(F.a),m.Nb(k.b),m.Nb(p.a))},e.\u0275cmp=m.Hb({type:e,selectors:[["fury-email-pdf-report"]],viewQuery:function(e,t){var i;1&e&&m.Vc(vi,!0),2&e&&m.zc(i=m.cc())&&(t.htmlData=i.first)},decls:0,vars:0,template:function(e,t){},styles:[""]}),e})();const Ci=["htmlData"];let Si=(()=>{class e{constructor(e,t,i,l,n,o,a,s,r,c,u,d){var m,h,p,f;this.billService=e,this.masterService=t,this.billSettlementService=i,this.date=l,this.currencyPipe=n,this.decimalPipe=o,this.dialog=a,this.templateService=s,this.cookieService=r,this.clientSelectionService=c,this.snackbar=u,this.envService=d,this._gap=16,this.gap=this._gap+"px",this.col2=`1 1 calc(50% - ${this._gap/2}px)`,this.col3=`1 1 calc(33.3333% - ${this._gap/1.5}px)`,this.tenants=[],this.billPeriods=[],this.billTypes=[],this.selectedRows=[],this.columns=[],this.innerColumns=[],this.columnNames=[],this.billMasterDetails=[],this.manageParams={},this.pdfsToMerge=[],this.billAmount="",this.receivedAmount="",this.billNumberConsumptionColumnName="Bill No",this.buildingColumnName="Building",this.unitNumberColumnName="Unit Number",this.smsColumnName="SMS",this.emailColumnName="Email",this.watsappColumnName="Watsapp",this.dateFormat="",this.currency="",this.roundFormat="",this.consumptionRoundOffFormat="",this.filePath="",this.billNumberColumnName="Bill Number",this.accountNumberColumnName="Account Number",this.billDateColumnName="BillDate",this.tenantNameColumnName="Tenant Name",this.entityTypeColumnName="Owner/Tenant",this.unitColumnName="Unit",this.fromDateColumnName="From Date",this.toDateColumnName="To Date",this.dueDateColumnName="Due Date",this.billAmountColumnName="Bill Amount",this.paidColumnName="Paid",this.reasonColumnName="Reason",this.utilityTypeCoulmnNmae="Utility Type",this.meterNumberCoulmnNmae="Meter Number",this.previousReadingColumnName="Previous",this.presentReadingColumnName="Present",this.currentConsumptionColumnName="Cur-Consumption",this.filePath=d.backendForFiles,this.dateFormat=null!==(m=Object(b.e)("DateFormat"))&&void 0!==m?m:d.dateFormat,this.currency=null!==(h=Object(b.e)("Currency"))&&void 0!==h?h:d.currencyFormat,this.roundFormat=null!==(p=Object(b.e)("RoundOff"))&&void 0!==p?p:d.roundOffFormat,this.consumptionRoundOffFormat=null!==(f=Object(b.e)("ConsumptionRoundOff"))&&void 0!==f?f:d.consumptionRoundOffFormat}ngOnInit(){this.clientSelectionService.setIsClientVisible(!0),this.clientId=parseInt(this.cookieService.get("globalClientId")),this.onGetTenants(),this.getBillPeriods(),this.getBillTypes(),this.createColumnNames(),this.createGridColumns(),this.createInnerGridColumns()}createGridColumns(){this.columns=["select","accountNumber","ownerName","entityType","unitNumber","fromDateLocal","toDateLocal","dueDateLocal","billAmountLocal","paidLocal","cancelRemarks","button"]}createInnerGridColumns(){this.innerColumns=["utilityType","deviceName","previousReadingLocal","presentReadingLocal","consumptionLocal","billAmountLocal"]}createColumnNames(){this.columnNames=[{name:this.billNumberColumnName,property:"billNumber"},{name:this.accountNumberColumnName,property:"accountNumber"},{name:this.billDateColumnName,property:"billDate"},{name:this.tenantNameColumnName,property:"ownerName"},{name:this.entityTypeColumnName,property:"entityType"},{name:this.unitColumnName,property:"unitNumber"},{name:this.fromDateColumnName,property:"fromDateLocal"},{name:this.toDateColumnName,property:"toDateLocal"},{name:this.dueDateColumnName,property:"dueDateLocal"},{name:this.billAmountColumnName,property:"billAmountLocal",columnAlign:{"text-align":"right"}},{name:this.paidColumnName,property:"paidLocal",columnAlign:{"text-align":"right"}},{name:this.reasonColumnName,property:"cancelRemarks"},{name:this.utilityTypeCoulmnNmae,property:"utilityType"},{name:this.meterNumberCoulmnNmae,property:"deviceName"},{name:this.previousReadingColumnName,property:"previousReadingLocal"},{name:this.presentReadingColumnName,property:"presentReadingLocal"},{name:this.currentConsumptionColumnName,property:"consumptionLocal"},{name:this.billAmountColumnName,property:"amountLocal",columnAlign:{"text-align":"right"}}]}onGetBillsHistory(e){this.manageParams=e,this.billMasterDetails=[],this.billAmount="";let t=0;this.receivedAmount="";let i=0;e.fromDate=""==e.fromDate?"":R(e.fromDate).format("YYYY-MM-DD"),e.toDate=""==e.toDate?"":R(e.toDate).format("YYYY-MM-DD"),e.clientId=this.clientId,this.billService.getBillCancelledHistory(e).subscribe(e=>{this.dateFormat=Object(b.e)("DateFormat"),this.roundFormat=Object(b.e)("RoundOff"),this.currency=Object(b.e)("Currency"),e.forEach(e=>{e.billDateLocal=this.date.transform(e.billDate.toString(),this.dateFormat.toString()),e.fromDateLocal=this.date.transform(e.fromDate.toString(),this.dateFormat.toString()),e.toDateLocal=this.date.transform(e.toDate.toString(),this.dateFormat.toString()),e.dueDateLocal=this.date.transform(e.toDate.toString(),this.dateFormat.toString()),e.billAmountLocal=this.currencyPipe.transform(e.billAmount,this.currency.toString(),!0,this.roundFormat),e.paidLocal=this.currencyPipe.transform(e.paid,this.currency.toString(),!0,this.roundFormat),e.bills.forEach(e=>{var t;this.consumptionRoundOffFormat=null!==(t=Object(b.e)("ConsumptionRoundOff",e.utilityTypeId))&&void 0!==t?t:this.envService.consumptionRoundOffFormat,e.previousReadingLocal=this.decimalPipe.transform(e.previousReading,this.consumptionRoundOffFormat),e.presentReadingLocal=this.decimalPipe.transform(e.presentReading,this.consumptionRoundOffFormat),e.consumptionLocal=this.decimalPipe.transform(e.consumption,this.consumptionRoundOffFormat),e.billAmountLocal=this.currencyPipe.transform(e.billAmount,this.currency.toString(),!0,this.roundFormat)}),t+=e.billAmount,i+=e.paid}),this.billMasterDetails=e,this.billAmount=this.currencyPipe.transform(t,this.currency.toString(),!0,this.roundFormat),this.receivedAmount=this.currencyPipe.transform(i,this.currency.toString(),!0,this.roundFormat)})}onSelectedRows(e){this.selectedRows=[],this.selectedRows=e}getBillPeriods(){this.billPeriods=[{label:"Select",value:0}],this.billService.getBillPeriods(this.clientId).subscribe(e=>{e.forEach(e=>{this.billPeriods.push({label:e.periodDescription,value:e.id})})})}getBillTypes(){this.billTypes=[{label:"Select",value:0}],this.masterService.getSystemMasterdata(64,0).subscribe(e=>{e.forEach(e=>{this.billTypes.push({label:e.description,value:e.id})})})}onGetTenants(){this.billSettlementService.getTenantsDetails(this.clientId).subscribe(e=>{this.tenants=e})}onViewDataRow(e){this.dialog.open(v,{data:e}).afterClosed().subscribe()}downloadReport(e){var t;let i=[],l=[],n=[],o=[],a=[],s=[],r=[];for(let u=0;u<e.bills.length;u++)this.consumptionRoundOffFormat=null!==(t=Object(b.e)("ConsumptionRoundOff",e.bills[u].utilityTypeId))&&void 0!==t?t:this.envService.consumptionRoundOffFormat,i.push(e.bills[u].deviceName),i.push(this.decimalPipe.transform(e.bills[u].previousReading,this.consumptionRoundOffFormat)),i.push(this.decimalPipe.transform(e.bills[u].presentReading,this.consumptionRoundOffFormat)),i.push(e.bills[u].measuringUnit),i.push(this.decimalPipe.transform(e.bills[u].consumption,this.consumptionRoundOffFormat)),i.push(e.bills[u].consumptionRate),i.push(e.bills[u].billAmountLocal),l.push(i),i=[];i.push(e.ownerId),i.push(e.fromDateLocal+"-"+e.toDateLocal),i.push(e.billAmountLocal),o.push(i),e.bills.forEach(e=>{e.billTransactions&&e.billTransactions.length&&e.billTransactions.forEach(e=>{const t=n.find(t=>t.label===e.headDisplay);t?t.value+=e.headAmount:n.push({label:e.headDisplay,value:e.headAmount})})}),e.billCharges.forEach(e=>{const t=n.find(t=>t.label===e.headDisplay);t?t.value+=e.headAmount:n.push({label:e.headDisplay,value:e.headAmount})});let c=0;n.forEach(e=>{c+=Number(e.value)}),n.push({label:"Total",value:c}),a.push({label:"Bill No",value:e.billNumber},{label:"Date of issue",value:e.billDateLocal},{label:"Due Date",value:e.dueDateLocal}),s.push({label:"Customer Name",value:e.ownerName},{label:"Customer Id",value:e.ownerId},{label:"Unit No",value:e.unitNumber},{label:"Address",value:""},{label:"City",value:""},{label:"P.O Box",value:""},{label:"Phone number",value:""}),r.push({firstItem:"Billing period",secondItem:"From:",thirdItem:e.fromDateLocal,fourthItem:"To:",fifthItem:e.toDateLocal}),this.getReport(["Meter Type","Previous Reading","Present Reading","Measuring Unit","Consumption","Unit Rate","Amount"],l,n,["Customer Id","Billing Period","Total for current period"],o,a,s,r,"Bill History")}getReport(e,t,i,l,n,o,a,s,r){var c=new Image;c.src="assets/img/logo_dark.png";let u=new fe.default({orientation:"portrait",unit:"pt",format:"letter"});u.rect(5,5,u.internal.pageSize.width-10,u.internal.pageSize.height-10,"S"),u.setFontSize(14),u.text("BOULEVARD TOWER",u.internal.pageSize.width/2-30-50,30);const d=u.getTextWidth("BOULEVARD TOWER");u.setLineWidth(.1),u.line(u.internal.pageSize.width/2-30-50,33,u.internal.pageSize.width/2-30-50+d,33),u.text("Muscat Hills",u.internal.pageSize.width/2-60,50),u.setFontSize(10),u.setLineWidth(.1),u.line(5,55,607,55),u.autoTable("",o,{startX:10,startY:60,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100},1:{cellWidth:245}},didParseCell:function(e){const t=e.column.index;0!=t&&1!=t||(e.cell.styles.rowHeight=1)},headStyles:{lineWidth:.1,lineColor:[0,0,0]}}),u.autoTable("",s,{startX:10,startY:115,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100},1:{cellWidth:50},2:{cellWidth:195},3:{cellWidth:50},4:{cellWidth:195}},didParseCell:function(e){const t=e.column.index;0!=t&&1!=t&&2!=t&&3!=t&&4!=t||(e.cell.styles.rowHeight=1)},headStyles:{lineWidth:.1,lineColor:[0,0,0]}}),u.autoTable("",a,{startX:10,startY:132,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100},1:{cellWidth:490}},didParseCell:function(e){const t=e.column.index;0!=t&&1!=t||(e.cell.styles.rowHeight=1)},headStyles:{lineWidth:.1,lineColor:[0,0,0]}}),u.addImage(c,"png",400,60,120,55),u.setLineWidth(.1),u.line(5,265,607,265),u.setFont("bold"),u.text("Meter Read-Outs".toUpperCase(),10,290),u.setFont("none"),u.autoTable(e,t,{startX:10,startY:310,didDrawPage:function(e){var t="Page "+e.pageCount;"function"==typeof u.putTotalPages&&(t+=" of 1"),u.setFontSize(10);var i=u.internal.pageSize.height||u.internal.pageSize.getHeight();u.text(t,e.settings.margin.left,i-10)},styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:80,halign:"center"},1:{cellWidth:95,halign:"center"},2:{cellWidth:95,halign:"center"},3:{cellWidth:95,halign:"center"},4:{cellWidth:74,halign:"center"},5:{cellWidth:75,halign:"center"},6:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"}}),u.setTextColor(0,0,0);const m=Number(this.decimalPipe.transform(u.autoTable.previous.finalY,"1.0-0"));u.setLineWidth(.1),u.line(5,m+10,607,m+10),u.autoTable("",i,{startX:10,startY:m+20,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{bottom:50,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:490,fontStyle:"italic"},1:{cellWidth:100}},didParseCell:function(e){1==e.column.index&&(e.cell.styles.halign="right")},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});const h=Number(this.decimalPipe.transform(u.autoTable.previous.finalY,"1.0-0"));u.setFillColor(255,255,200),u.rect(10,h+20,590,80,"FD"),u.setFillColor(0,0,0),u.text("Notes :-",50,h+30),u.text("Payment should be ade within 15 days",50,h+40),u.text("1. Cash / Cheque",50,h+50),u.text("2. Tax Registeration Number",50,h+60),u.text("3. Minimum charges payable",50,h+70),u.text(`4. Late fee of ${this.currency} 50 /- will be levied, if payments are made by the due date`,50,h+80),u.text("5. Late payment fee of 1 % per month will be calculated on the over due amount from the origional date of payment",50,h+90),u.setTextColor(0,0,0),u.line(5,h+110,607,h+110),u.text("Notice :- Please tear and attach the slip  along with your payment",50,h+130),u.autoTable(l,n,{startX:10,startY:h+150,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{bottom:110,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"center"},1:{cellWidth:340,halign:"center"},2:{cellWidth:150,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"}}),"function"==typeof u.putTotalPages&&u.putTotalPages("1");var b=u.output("blob");window.open(URL.createObjectURL(b))}onSendEmail(){this.selectedRows&&this.templateService.emailInvoiceTemplate({notificationType:"EMAIL",templateType:"Invoice",templateName:"Custom",billMasterDetails:this.selectedRows}).subscribe({next:e=>{},error:e=>{}})}invoiceView(e){this.billService.invoiceView(e).subscribe({next:e=>{e?this.downloadFile(e):this.notificationMessage("No data to print","red-snackbar")},error:e=>{this.notificationMessage("No data to print","red-snackbar")}})}downloadFile(e){return Object(r.a)(this,void 0,void 0,(function*(){const t=yield G.PDFDocument.create();for(const o of e){const e=yield G.PDFDocument.load(o);(yield t.copyPages(e,e.getPageIndices())).forEach(e=>{t.addPage(e)})}const i=yield t.save(),l=new Blob([i],{type:"application/pdf"}),n=window.URL.createObjectURL(l);window.open(n)}))}onPrintPdf(){return Object(r.a)(this,void 0,void 0,(function*(){this.selectedRows&&this.selectedRows.length?this.invoiceView(this.selectedRows):this.notificationMessage("Please select Bills.","red-snackbar")}))}downloadBillFormat1LargeReport(e){var t,i;let l=[],n=[],o=[],a=[],s=[],r=[],c=[],u=[],d=["Unit No","Meter No","Previous Reading","Present Reading","Consumption"],m=["Bill No","Charges","Consumption","Measuring Unit","Tariff","Total"],h="";e.bills.forEach(e=>{h+=e.deviceName+","}),s.push({label:"Account Number:",value:e.accountNumber},{label:"Meter Number:",value:h.slice(0,-1)},{label:"Unit Number:",value:e.unitNumber},{label:"Billing Date:",value:e.billDateLocal},{label:"Due Date:",value:e.dueDateLocal},{label:"Bill Period",value:`${Object(b.f)(e.fromDateLocal)} - ${Object(b.f)(e.toDateLocal)} `});let p=!1,f=!1;if(e&&e.bills&&e.bills.length){const t=Array.from(new Set(e.bills.map(e=>e.billNumber))),i=Array.from(new Set(e.bills.map(e=>e.unitNumber)));if(p=!!(t&&t.length>1),f=!!(i&&i.length>1),p||m.splice(0,1),f){const e=s.findIndex(e=>"Unit Number:"===e.label);s.splice(e,1)}else d.splice(0,1)}for(let C=0;C<e.bills.length;C++)this.consumptionRoundOffFormat=null!==(t=Object(b.e)("ConsumptionRoundOff",e.bills[C].utilityTypeId))&&void 0!==t?t:this.envService.consumptionRoundOffFormat,f&&l.push(e.bills[C].unitNumber),l.push(e.bills[C].deviceName),l.push(this.decimalPipe.transform(e.bills[C].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[C].measuringUnit),l.push(this.decimalPipe.transform(e.bills[C].presentReading,this.consumptionRoundOffFormat)+" "+e.bills[C].measuringUnit),l.push(e.bills[C].isDifferentiateBill?this.decimalPipe.transform(e.bills[C].presentReading-e.bills[C].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[C].measuringUnit:this.decimalPipe.transform(e.bills[C].consumption,this.consumptionRoundOffFormat)+" "+e.bills[C].measuringUnit),"BTU"===e.bills[C].utilityType&&e.bills[C].billTransactions&&e.bills[C].billTransactions.length&&e.bills[C].billTransactions.findIndex(e=>e.measuringUnitId&&2===e.measuringUnitId)>-1&&(0==C&&d.push("Consumption TR-HR"),l.push(this.decimalPipe.transform(.284345*e.bills[C].consumption,this.consumptionRoundOffFormat))),n.push(l),l=[];let g=0;for(let C=0;C<e.bills.length;C++){this.consumptionRoundOffFormat=null!==(i=Object(b.e)("ConsumptionRoundOff",e.bills[C].utilityTypeId))&&void 0!==i?i:this.envService.consumptionRoundOffFormat;const t=e.bills[C];for(let e=0;e<t.billTransactions.length;e++)p&&l.push(t.billNumber),l.push(t.billTransactions[e].headDisplay),"BTU"===t.utilityType&&t.billTransactions&&t.billTransactions.length&&t.billTransactions[e]&&t.billTransactions[e].measuringUnitId&&2===t.billTransactions[e].measuringUnitId?(l.push(this.decimalPipe.transform(.284345*t.consumption,this.consumptionRoundOffFormat)),l.push("TR-HR"),l.push(t.billTransactions[e].rate)):(l.push(this.decimalPipe.transform(t.consumption,this.consumptionRoundOffFormat)),l.push(t.measuringUnit),l.push(t.billTransactions[e].rate)),l.push(this.currencyPipe.transform(t.billTransactions[e].headAmount,this.currency.toString(),!0,this.roundFormat)),c.push(l),l=[],g+=t.billTransactions[e].headAmount}l.push(e.accountNumber),l.push(e.fromDateLocal+"-"+e.toDateLocal),l.push(this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)),l.push(e.billAmountLocal),a.push(l),e.billCharges&&e.billCharges.length&&(e.billCharges.sort((e,t)=>e.position-t.position).forEach(e=>{if("VAT"!==e.headDisplay){const t=o.find(t=>t.label===e.headDisplay);t?t.value+=e.headAmount:o.push({label:e.headDisplay,value:e.headAmount})}}),o.forEach(e=>{r.push({label:e.label,value:this.currencyPipe.transform(e.value,this.currency.toString(),!0,this.roundFormat)})})),r.push({label:"Current Month Total Consumption Charge:",value:this.currencyPipe.transform(g,this.currency.toString(),!0,this.roundFormat)}),e.billTaxDetails&&e.billTaxDetails.length?e.billTaxDetails.forEach(e=>{r.push({label:e.taxDisplayName,value:this.currencyPipe.transform(e.taxAmount,this.currency.toString(),!0,this.roundFormat)})}):r.push({label:"TAX:",value:this.currencyPipe.transform(0,this.currency.toString(),!0,this.roundFormat)}),r.push({label:"Current Month + TAX:",value:e.billAmountLocal},{label:"Previous Bill Outstanding Balance:",value:this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)},{label:"Total Due incl TAX:",value:this.currencyPipe.transform(e.billAmount+e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)});let v=[],y=!1;l=[],e&&e.bills&&e.bills.length&&e.bills.forEach(e=>{var t;if(this.consumptionRoundOffFormat=null!==(t=Object(b.e)("ConsumptionRoundOff",e.utilityTypeId))&&void 0!==t?t:this.envService.consumptionRoundOffFormat,e.billTariffDetails&&e.billTariffDetails.length)for(let i=0;i<e.billTariffDetails.length;i++){if(e.billTariffDetails[i].slabSettingsId&&e.billTariffDetails[i].slabSettingsId>0){let t=e.billTariffDetails[i].season;Number(e.billTariffDetails[i].peakType)<Number(e.billTariffDetails[i].consumption)&&(t=e.billTariffDetails[i].peakType+" - "+e.billTariffDetails[i].consumption),0==i&&(y=!0,v=["Slab","Consumption","Rate","Amount"]),l.push(t),l.push(this.decimalPipe.transform(e.billTariffDetails[i].consumption,this.consumptionRoundOffFormat)),l.push(e.billTariffDetails[i].rate),l.push(this.currencyPipe.transform(e.billTariffDetails[i].amount,this.currency.toString(),!0,this.roundFormat))}else 0==e.billTariffDetails[i].slabSettingsId&&(0==i&&(v=["Season","Week Type","Peak Type","Consumption","Rate","Amount"]),l.push(e.billTariffDetails[i].season),l.push(e.billTariffDetails[i].weekType),l.push(e.billTariffDetails[i].peakType),l.push(this.decimalPipe.transform(e.billTariffDetails[i].consumption,this.consumptionRoundOffFormat)),l.push(e.billTariffDetails[i].rate),l.push(this.currencyPipe.transform(e.billTariffDetails[i].amount,this.currency.toString(),!0,this.roundFormat)));u.push(l),l=[]}}),this.getNewBillFormat1LargeReport(d,n,o,["Customer AccountNumber","Billing Period","Previous Due","Total for current period"],a,[],s,r,"Invoice",m,c,e,[],v,u,y)}getNewBillFormat1LargeReport(e,t,i,l,n,o,a,s,r,c,u,d,m,h,p,f=!1){var g,v,y,C,S,T,P,D,w,N,x,A,F,R,k,I,O,W,M,L,B,z;let U=new fe.default({orientation:"portrait",unit:"pt",format:"letter"});U.rect(5,5,U.internal.pageSize.width-10,U.internal.pageSize.height-10,"S"),U.setFontSize(30),U=this.addImage(U,d),U.setTextColor(0,0,0),U.setFontSize(16),U.setFont("Cambria","bold"),U.text("Tax Invoice",260,30),U.setFontSize(13),U.setFont("Cambria","normal"),U.text(d.client.clientName.toUpperCase(),10,60),U.setFontSize(10),U.setFont("Cambria"),U.text("TRN: "+d.client.trnNo,10,70),U.text("PO Box "+d.client.addresses[0].zipPostalCode,10,80),U.text(d.client.addresses[0].address1+","+d.client.addresses[0].country,10,90),U.text("Phone: "+d.client.phoneNo,10,100),U.text("Email: "+d.client.email+", Web: "+d.client.website,10,110),U.setFontSize(10),U.setFont("bold"),U.text("Invoice#: ".toUpperCase(),370,110),U.setTextColor(25,118,210);const E=U.getTextWidth("Invoice#: ");let j="";(null==d?void 0:d.billNumber)&&(j=null===(g=d.billNumber)||void 0===g?void 0:g.toUpperCase()),U.text(j,380+E,110),U.setFont("none"),U.setTextColor(0,0,0),U.setFontSize(9),U.autoTable("",a,{startY:120,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:370},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:80,halign:"left"},1:{cellWidth:150,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0]},didParseCell:function(e){e.cell.styles.cellPadding=6===e.length?1.8:2.7}});const H=Number(this.decimalPipe.transform(U.autoTable.previous.finalY,"1.0-0"));U.setLineWidth(.1),U.line(5,H+5,607,H+5),U.setFont("Cambria"),U.setFillColor(241,241,244),U.setDrawColor(206,203,203),U.rect(10,120,340,H-120,"FD"),U.setTextColor(0,0,0),U.setFontSize(12),U.text(null==d?void 0:d.ownerName.toUpperCase(),20,135),U.text("CUSTOMER TRN: "+d.trn,20,150),U.text("unit #"+d.unitNumber,20,165),U.setFontSize(10),U.text(Object(b.f)(null==d?void 0:d.clientName,""),20,180),U.text(Object(b.f)(null===(v=null==d?void 0:d.client)||void 0===v?void 0:v.buildingName,",")+Object(b.f)(null===(C=null===(y=null==d?void 0:d.client)||void 0===y?void 0:y.addresses[0])||void 0===C?void 0:C.location,",")+Object(b.f)(null===(T=null===(S=null==d?void 0:d.client)||void 0===S?void 0:S.addresses[0])||void 0===T?void 0:T.city,",")+Object(b.f)(null===(D=null===(P=null==d?void 0:d.client)||void 0===P?void 0:P.addresses[0])||void 0===D?void 0:D.country,","),20,195),U.setFontSize(10),U.text("Meter Read-Outs".toUpperCase(),10,H+20);var Y=function(e){};if(U.autoTable(e,t,{startX:10,startY:H+35,showHead:"everyPage",didDrawPage:Y,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:6==e.length?120:4==e.length?200:155,halign:"center"},1:{cellWidth:6==e.length?100:4==e.length?135:125,halign:"center"},2:{cellWidth:6==e.length?100:4==e.length?135:125,halign:"center"},3:{cellWidth:4==e.length?120:100,halign:"center"},4:{cellWidth:85,halign:"center"},5:{cellWidth:85,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}),u&&u.length){const e=Number(this.decimalPipe.transform(U.autoTable.previous.finalY,"1.0-0"));U.setFontSize(10),U.text("Charges Breakdown".toUpperCase(),10,e+15),U.autoTable(c,u,{startX:10,startY:e+30,showHead:"everyPage",didDrawPage:Y,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:6==c.length?80:200,halign:"center"},1:{cellWidth:6==c.length?180:100,halign:"center"},2:{cellWidth:6==c.length?90:100,halign:"center"},3:{cellWidth:6==c.length?90:100,halign:"center"},4:{cellWidth:6==c.length?75:90,halign:"right"},5:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}})}let V=Number(this.decimalPipe.transform(U.autoTable.previous.finalY,"1.0-0")),_=U.internal.pageSize.height,G=V;f?(U.autoTable(h,p,{startX:10,startY:G+10,showHead:"everyPage",didDrawPage:Y,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:250,halign:"center"},1:{cellWidth:120,halign:"center"},2:{cellWidth:120,halign:"center"},3:{cellWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}),G=Number(this.decimalPipe.transform(U.autoTable.previous.finalY,"1.0-0"))):(U.autoTable(h,p,{startX:10,startY:V+10,showHead:"everyPage",didDrawPage:Y,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:140,halign:"center"},1:{cellWidth:100,halign:"center"},2:{cellWidth:100,halign:"center"},3:{cellWidth:100,halign:"center"},4:{cellWidth:75,halign:"center"},5:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}),G=Number(this.decimalPipe.transform(U.autoTable.previous.finalY,"1.0-0"))),_-G<200&&(U.addPage(),U.setTextColor(25,118,210),U.rect(5,5,U.internal.pageSize.width-10,U.internal.pageSize.height-10,"S"),G=10),U.setTextColor(25,118,210),U.setFontSize(12),U.text("Bank Payment Account Details",10,G+20),U.setTextColor(0,0,0),U.setFontSize(9),U.text("Account Title: "+Object(b.f)(null===(N=null===(w=null==d?void 0:d.client)||void 0===w?void 0:w.bankDetails[0])||void 0===N?void 0:N.accountName),10,G+40),U.text("Account #: "+Object(b.f)(null===(A=null===(x=null==d?void 0:d.client)||void 0===x?void 0:x.bankDetails[0])||void 0===A?void 0:A.accountNo),10,G+50),U.text("IBAN #: "+Object(b.f)(null===(R=null===(F=null==d?void 0:d.client)||void 0===F?void 0:F.bankDetails[0])||void 0===R?void 0:R.ibanNumber),10,G+60),U.text("Bank Name: "+Object(b.f)(null===(I=null===(k=null==d?void 0:d.client)||void 0===k?void 0:k.bankDetails[0])||void 0===I?void 0:I.bankName),10,G+70),U.text("Swift Code: "+ +Object(b.f)(null===(W=null===(O=null==d?void 0:d.client)||void 0===O?void 0:O.bankDetails[0])||void 0===W?void 0:W.swiftCode),10,G+80),U.setFontSize(9),U.autoTable("",s,{startX:300,startY:G+20,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:320},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:180,halign:"left"},1:{cellWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"},didParseCell:function(e){e.cell.styles.cellPadding=1.8}}),Number(this.decimalPipe.transform(U.autoTable.previous.finalY,"1.0-0"))>_-190&&(U.addPage(),U.rect(5,5,U.internal.pageSize.width-10,U.internal.pageSize.height-10,"S"),_=400),(null===(L=null===(M=null==d?void 0:d.client)||void 0===M?void 0:M.termsConditions[0])||void 0===L?void 0:L.termsAndCondition)&&(U.setFillColor(241,241,244),U.rect(10,_-190,590,90,"FD"),U.setFillColor(0,0,0),U.setFontSize(9),U.text(null===(z=null===(B=null==d?void 0:d.client)||void 0===B?void 0:B.termsConditions[0])||void 0===z?void 0:z.termsAndCondition.replace("{{ClientName}}",d.client.clientName).replace("{{TRNNumber}}",d.client.trnNo).replace("{{Currency}}",this.currency),40,_-175)),U.setTextColor(0,0,0),U.line(5,_-95,607,_-95),U.text("Notice :- Please tear and attach the slip  along with your payment",10,_-80),U.autoTable(l,n,{startX:10,startY:_-65,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:130,halign:"center"},1:{cellWidth:210,halign:"center"},2:{cellWidth:110,halign:"right"},3:{cellWidth:140,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}});var X=U.output("datauristring");this.pdfsToMerge.push(X)}downloadBillFormat3LargeReport(e){var t,i,l,n,o,a,s,r,c,u,d;let m=[],h=[],p=[],f=[],g=[],v=[],y=[],C=[],S=[],T=["Unit No","Meter No","Previous Reading","Present Reading","Consumption"],P=["Bill No","Charges","Consumption","Measuring Unit","Tariff","Total"];g.push({label:"Bill No",value:": "+Object(b.f)(e.billNumber)},{label:"Date of issue",value:": "+Object(b.f)(e.billDateLocal)},{label:"Due Date",value:": "+Object(b.f)(e.dueDateLocal)}),v.push({label:"Billing period",value:`: From: ${Object(b.f)(e.fromDateLocal)} To: ${Object(b.f)(e.toDateLocal)} `},{label:"Customer Account",value:": "+Object(b.f)(e.accountNumber)},{label:"Customer Name",value:": "+Object(b.f)(e.ownerName)},{label:"Address",value:": "+Object(b.f)(null===(i=null===(t=null==e?void 0:e.client)||void 0===t?void 0:t.addresses[0])||void 0===i?void 0:i.address1)},{label:"City",value:": "+Object(b.f)(null===(n=null===(l=null==e?void 0:e.client)||void 0===l?void 0:l.addresses[0])||void 0===n?void 0:n.city)},{label:"P.O Box",value:": "+Object(b.f)(null===(a=null===(o=null==e?void 0:e.client)||void 0===o?void 0:o.addresses[0])||void 0===a?void 0:a.zipPostalCode)},{label:"Phone number",value:": "+Object(b.f)(null===(s=null==e?void 0:e.receiverDetails[0])||void 0===s?void 0:s.phoneNumber)},{label:"Fax Number",value:": "},{label:"Client",value:": "+Object(b.f)(null===(r=null==e?void 0:e.client)||void 0===r?void 0:r.clientName)},{label:"Client TRN",value:": "+Object(b.f)(null===(c=null==e?void 0:e.client)||void 0===c?void 0:c.trnNo)});let D=!1,w=!1;if(e&&e.bills&&e.bills.length){const t=Array.from(new Set(e.bills.map(e=>e.billNumber))),i=Array.from(new Set(e.bills.map(e=>e.unitNumber)));if(D=!!(t&&t.length>1),w=!!(i&&i.length>1),D?g.splice(0,1):P.splice(0,1),w){const e=v.findIndex(e=>"Unit No"===e.label);v.splice(e,1)}else T.splice(0,1)}for(let k=0;k<e.bills.length;k++)this.consumptionRoundOffFormat=null!==(u=Object(b.e)("ConsumptionRoundOff",e.bills[k].utilityTypeId))&&void 0!==u?u:this.envService.consumptionRoundOffFormat,w&&m.push(e.bills[k].unitNumber),m.push(e.bills[k].deviceName),m.push(this.decimalPipe.transform(e.bills[k].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[k].measuringUnit),m.push(this.decimalPipe.transform(e.bills[k].presentReading,this.consumptionRoundOffFormat)+" "+e.bills[k].measuringUnit),m.push(e.bills[k].isDifferentiateBill?this.decimalPipe.transform(e.bills[k].presentReading-e.bills[k].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[k].measuringUnit:this.decimalPipe.transform(e.bills[k].consumption,this.consumptionRoundOffFormat)+" "+e.bills[k].measuringUnit),"BTU"===e.bills[k].utilityType&&e.bills[k].billTransactions&&e.bills[k].billTransactions.length&&e.bills[k].billTransactions.findIndex(e=>e.measuringUnitId&&2===e.measuringUnitId)>-1&&(0==k&&T.push("Consumption TR-HR"),m.push(this.decimalPipe.transform(.284345*e.bills[k].consumption,this.consumptionRoundOffFormat))),h.push(m),m=[];let N=0;for(let k=0;k<e.bills.length;k++){this.consumptionRoundOffFormat=null!==(d=Object(b.e)("ConsumptionRoundOff",e.bills[k].utilityTypeId))&&void 0!==d?d:this.envService.consumptionRoundOffFormat;const t=e.bills[k];for(let e=0;e<t.billTransactions.length;e++)D&&m.push(t.billNumber),m.push(t.billTransactions[e].headDisplay),"BTU"===t.utilityType&&t.billTransactions&&t.billTransactions.length&&t.billTransactions[e]&&t.billTransactions[e].measuringUnitId&&2===t.billTransactions[e].measuringUnitId?(m.push(this.decimalPipe.transform(.284345*t.consumption,this.consumptionRoundOffFormat)),m.push("TR-HR"),m.push(t.billTransactions[e].rate)):(m.push(this.decimalPipe.transform(t.consumption,this.consumptionRoundOffFormat)),m.push(t.measuringUnit),m.push(t.billTransactions[e].rate)),m.push(this.currencyPipe.transform(t.billTransactions[e].headAmount,this.currency.toString(),!0,this.roundFormat)),y.push(m),m=[],N+=t.billTransactions[e].headAmount}m.push(e.accountNumber),m.push(e.fromDateLocal+"-"+e.toDateLocal),m.push(this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)),m.push(e.billAmountLocal),f.push(m);let x="";e.bills.forEach(e=>{x+=e.deviceName+","});let A=[],F=!1;m=[],e&&e.bills&&e.bills.length&&e.bills.forEach(e=>{var t;if(this.consumptionRoundOffFormat=null!==(t=Object(b.e)("ConsumptionRoundOff",e.utilityTypeId))&&void 0!==t?t:this.envService.consumptionRoundOffFormat,e.billTariffDetails&&e.billTariffDetails.length)for(let i=0;i<e.billTariffDetails.length;i++){if(e.billTariffDetails[i].slabSettingsId&&e.billTariffDetails[i].slabSettingsId>0){let t=e.billTariffDetails[i].season;Number(e.billTariffDetails[i].peakType)<Number(e.billTariffDetails[i].consumption)&&(t=e.billTariffDetails[i].peakType+" - "+e.billTariffDetails[i].consumption),0==i&&(F=!0,A=["Slab","Consumption","Rate","Amount"]),m.push(t),m.push(this.decimalPipe.transform(e.billTariffDetails[i].consumption,this.consumptionRoundOffFormat)),m.push(e.billTariffDetails[i].rate),m.push(this.currencyPipe.transform(e.billTariffDetails[i].amount,this.currency.toString(),!0,this.roundFormat))}else 0==e.billTariffDetails[i].slabSettingsId&&(0==i&&(A=["Season","Week Type","Peak Type","Consumption","Rate","Amount"]),m.push(e.billTariffDetails[i].season),m.push(e.billTariffDetails[i].weekType),m.push(e.billTariffDetails[i].peakType),m.push(this.decimalPipe.transform(e.billTariffDetails[i].consumption,this.consumptionRoundOffFormat)),m.push(e.billTariffDetails[i].rate),m.push(this.currencyPipe.transform(e.billTariffDetails[i].amount,this.currency.toString(),!0,this.roundFormat)));S.push(m),m=[]}});let R=[];e.bills.forEach(e=>{var t;if(this.consumptionRoundOffFormat=null!==(t=Object(b.e)("ConsumptionRoundOff",e.utilityTypeId))&&void 0!==t?t:this.envService.consumptionRoundOffFormat,e.billTransactions&&e.billTransactions.length){const t=["consumption","consumptioncharge"];e.billTransactions.forEach(e=>{if(!t.includes(e.headDisplay.toLowerCase())){const t=R.find(t=>t.label===e.headDisplay);t?t.value+=e.headAmount:R.push({label:e.headDisplay,value:e.headAmount})}})}}),e.billCharges&&e.billCharges.length&&e.billCharges.sort((e,t)=>e.position-t.position).forEach(e=>{if("VAT"!==e.headDisplay){const t=R.find(t=>t.label===e.headDisplay);t?t.value+=e.headAmount:R.push({label:e.headDisplay,value:e.headAmount})}}),R.forEach(e=>{p.push({label:e.label,value:this.currencyPipe.transform(e.value,this.currency.toString(),!0,this.roundFormat)}),N+=Number(e.value)}),e.billTaxDetails&&e.billTaxDetails.length&&e.billTaxDetails.forEach(e=>{p.push({label:e.taxDisplayName,value:this.currencyPipe.transform(e.taxAmount,this.currency.toString(),!0,this.roundFormat)}),N+=Number(e.taxAmount)}),C.push({label:"Total for Current Period",value:this.currencyPipe.transform(e.billAmount+e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)}),this.getNewBillFormat3LargeReport(T,h,p,["Customer AccountNumber","Billing Period","Previous Due","Total for current period"],f,g,v,[],"Invoice",P,y,e,C,A,S,F)}getNewBillFormat3LargeReport(e,t,i,l,n,o,a,s,r,c,u,d,m,h,b,p=!1){var f,g,v,y;let C=new fe.default({orientation:"portrait",unit:"pt",format:"letter"});C.rect(5,5,C.internal.pageSize.width-10,C.internal.pageSize.height-10,"S"),C.setTextColor(0,0,0),C.setFontSize(11),C.setFont("Cambria"),C.text("Billing Statement".toUpperCase(),10,20),this.addImage(C,d),C.setLineWidth(.1),C.autoTable("",o,{startX:10,startY:35,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:15},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:190,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"},didParseCell:function(e){e.cell.styles.cellPadding=1.5}});const S=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"));C.autoTable("",a,{startX:10,startY:S,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:15},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:380,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0]},didParseCell:function(e){e.cell.styles.cellPadding=1.5}});var T=function(e){};const P=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"));C.setFont("Cambria"),C.setFontSize(10),C.text("Meter Read-Outs".toUpperCase(),10,P+15),C.autoTable(e,t,{startX:10,startY:P+30,didDrawPage:T,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:6==e.length?120:4==e.length?200:155,halign:"center"},1:{cellWidth:6==e.length?100:4==e.length?135:125,halign:"center"},2:{cellWidth:6==e.length?100:4==e.length?135:125,halign:"center"},3:{cellWidth:4==e.length?120:100,halign:"center"},4:{cellWidth:85,halign:"center"},5:{cellWidth:85,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}});const D=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"));u&&u.length&&(C.setFontSize(10),C.text("Charges Breakdown".toUpperCase(),10,D+15),C.autoTable(c,u,{startX:10,startY:D+30,showHead:"everyPage",didDrawPage:T,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:6===c.length?80:200,halign:"center"},1:{cellWidth:6===c.length?180:100,halign:"center"},2:{cellWidth:6===c.length?90:100,halign:"center"},3:{cellWidth:6===c.length?90:100,halign:"center"},4:{cellWidth:6===c.length?75:90,halign:"right"},5:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}));let w=C.internal.pageSize.height;const N=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"));let x=N;p?(C.autoTable(h,b,{startX:10,startY:N+10,showHead:"everyPage",didDrawPage:T,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:250,halign:"center"},1:{cellWidth:120,halign:"center"},2:{cellWidth:120,halign:"center"},3:{cellWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}),x=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"))):(C.autoTable(h,b,{startX:10,startY:N+10,showHead:"everyPage",didDrawPage:T,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:140,halign:"center"},1:{cellWidth:100,halign:"center"},2:{cellWidth:100,halign:"center"},3:{cellWidth:100,halign:"center"},4:{cellWidth:75,halign:"center"},5:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}),x=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"))),w-x<200&&(C.addPage(),C.setTextColor(25,118,210),C.rect(5,5,C.internal.pageSize.width-10,C.internal.pageSize.height-10,"S"),x=10),C.autoTable("",i,{startX:10,startY:x+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{bottom:35,left:250},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:250,fontStyle:"italic"},1:{cellWidth:90}},didParseCell:function(e){1==e.column.index&&(e.cell.styles.halign="right"),e.cell.styles.cellPadding=1.5},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});const A=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"));C.line(5,A+10,607,A+10),C.autoTable("",m,{startX:10,startY:A+20,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{bottom:35,left:250},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:250,fontStyle:"italic"},1:{cellWidth:90}},didParseCell:function(e){1==e.column.index&&(e.cell.styles.halign="right"),e.cell.styles.cellPadding=1.5},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});const F=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"));C.line(5,F+10,607,F+10),w=C.internal.pageSize.height,F>w-190&&(C.addPage(),C.rect(5,5,C.internal.pageSize.width-10,C.internal.pageSize.height-10,"S"),w=400),(null===(g=null===(f=null==d?void 0:d.client)||void 0===f?void 0:f.termsConditions[0])||void 0===g?void 0:g.termsAndCondition)&&(C.setFillColor(241,241,244),C.rect(10,w-190,590,90,"FD"),C.setFillColor(0,0,0),C.setFontSize(9),C.text(null===(y=null===(v=null==d?void 0:d.client)||void 0===v?void 0:v.termsConditions[0])||void 0===y?void 0:y.termsAndCondition.replace("{{ClientName}}",d.client.clientName).replace("{{TRNNumber}}",d.client.trnNo).replace("{{Currency}}",this.currency),30,w-175)),C.setTextColor(0,0,0),C.line(5,w-95,607,w-95),C.text("Notice :- Please tear and attach the slip  along with your payment",10,w-80),C.autoTable(l,n,{startX:10,startY:w-65,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:130,halign:"center"},1:{cellWidth:210,halign:"center"},2:{cellWidth:110,halign:"right"},3:{cellWidth:140,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}});var R=C.output("datauristring");this.pdfsToMerge.push(R)}downloadBillFormat2Report(e){var t,i,l,n,o,a,s,r,c,u,d,m,h,p,f,g,v,y,C,S;let T=[],P=[],D=[],w=[],N=[],x=[],A=[],F=[],R=[],k=[],I=["Unit No","Meter No","Previous Reading","Present Reading","Consumption"],O=["Bill No","Charges","Consumption","Measuring Unit","Tariff","Total"],W=!1,M=!1;if(e&&e.bills&&e.bills.length){const t=Array.from(new Set(e.bills.map(e=>e.billNumber))),i=Array.from(new Set(e.bills.map(e=>e.unitNumber)));W=!!(t&&t.length>1),M=!!(i&&i.length>1),W||O.splice(0,1),M||I.splice(0,1)}for(let U=0;U<e.bills.length;U++)this.consumptionRoundOffFormat=null!==(t=Object(b.e)("ConsumptionRoundOff",e.bills[U].utilityTypeId))&&void 0!==t?t:this.envService.consumptionRoundOffFormat,M&&T.push(e.unitNumber),T.push(e.bills[U].deviceName),T.push(this.decimalPipe.transform(e.bills[U].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[U].measuringUnit),T.push(this.decimalPipe.transform(e.bills[U].presentReading,this.consumptionRoundOffFormat)+" "+e.bills[U].measuringUnit),T.push(e.bills[U].isDifferentiateBill?this.decimalPipe.transform(e.bills[U].presentReading-e.bills[U].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[U].measuringUnit:this.decimalPipe.transform(e.bills[U].consumption,this.consumptionRoundOffFormat)+" "+e.bills[U].measuringUnit),"BTU"===e.bills[U].utilityType&&e.bills[U].billTransactions&&e.bills[U].billTransactions.length&&e.bills[U].billTransactions.findIndex(e=>e.measuringUnitId&&2===e.measuringUnitId)>-1&&(0==U&&I.push("Consumption TR-HR"),T.push(this.decimalPipe.transform(.284345*e.bills[U].consumption,this.consumptionRoundOffFormat))),P.push(T),T=[];let L=0;for(let U=0;U<e.bills.length;U++){this.consumptionRoundOffFormat=null!==(i=Object(b.e)("ConsumptionRoundOff",e.bills[U].utilityTypeId))&&void 0!==i?i:this.envService.consumptionRoundOffFormat;const t=e.bills[U];for(let e=0;e<t.billTransactions.length;e++)W&&T.push(t.billNumber),T.push(t.billTransactions[e].headDisplay),"BTU"===t.utilityType&&t.billTransactions&&t.billTransactions.length&&t.billTransactions[e]&&t.billTransactions[e].measuringUnitId&&2===t.billTransactions[e].measuringUnitId?(T.push(this.decimalPipe.transform(.284345*t.consumption,this.consumptionRoundOffFormat)),T.push("TR-HR"),T.push(t.billTransactions[e].rate)):(T.push(this.decimalPipe.transform(t.consumption,this.consumptionRoundOffFormat)),T.push(t.measuringUnit),T.push(t.billTransactions[e].rate)),T.push(this.currencyPipe.transform(t.billTransactions[e].headAmount,this.currency.toString(),!0,this.roundFormat)),F.push(T),T=[],L+=t.billTransactions[e].headAmount}T.push(e.accountNumber),T.push(e.fromDateLocal+"-"+e.toDateLocal),T.push(this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)),T.push(e.billAmountLocal),w.push(T),e.billCharges&&e.billCharges.length&&(e.billCharges.sort((e,t)=>e.position-t.position).forEach(e=>{if("VAT"!==e.headDisplay){const t=D.find(t=>t.label===e.headDisplay);t?t.value+=e.headAmount:D.push({label:e.headDisplay,value:e.headAmount})}}),D.forEach(e=>{R.push({label:e.label,value:this.currencyPipe.transform(e.value,this.currency.toString(),!0,this.roundFormat)})})),e.billCharges.find(e=>"VAT"===e.headDisplay),R.push({label:"Total consumption charge for Current Period",value:this.currencyPipe.transform(L,this.currency.toString(),!0,this.roundFormat)}),e.billTaxDetails.forEach(e=>{const t=R.find(t=>t.label===e.taxDisplayName);if(t){const i=Number(t.value.replace(this.currency,"").trim())+Number(e.taxAmount);t.value=this.currencyPipe.transform(i,this.currency.toString(),!0,this.roundFormat)}else R.push({label:e.taxDisplayName,value:this.currencyPipe.transform(e.taxAmount,this.currency.toString(),!0,this.roundFormat)})}),R.push({label:"Previous Outstanding Amount",value:this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)},{label:"Total Amount Due",value:this.currencyPipe.transform(e.billAmount+e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)}),N.push({label:"Bill No",value:null!==(l=null==e?void 0:e.billNumber)&&void 0!==l?l:""},{label:"Date of issue",value:null!==(n=null==e?void 0:e.billDateLocal)&&void 0!==n?n:""},{label:"Due Date",value:null!==(o=null==e?void 0:e.dueDateLocal)&&void 0!==o?o:""}),x.push({label:"Customer Name",value:null!==(a=null==e?void 0:e.ownerName)&&void 0!==a?a:""},{label:"Customer AccountNumber",value:null!==(s=null==e?void 0:e.accountNumber)&&void 0!==s?s:""},{label:"Unit No",value:null!==(r=null==e?void 0:e.unitNumber)&&void 0!==r?r:""},{label:"Address",value:null!==(u=null===(c=null==e?void 0:e.receiverDetails[0])||void 0===c?void 0:c.address1)&&void 0!==u?u:""},{label:"City",value:null!==(m=null===(d=null==e?void 0:e.receiverDetails[0])||void 0===d?void 0:d.city)&&void 0!==m?m:""},{label:"P.O Box",value:null!==(p=null===(h=null==e?void 0:e.receiverDetails[0])||void 0===h?void 0:h.zipPostalCode)&&void 0!==p?p:""},{label:"Phone number",value:null!==(g=null===(f=null==e?void 0:e.receiverDetails[0])||void 0===f?void 0:f.phoneNumber)&&void 0!==g?g:""},{label:"Fax Number",value:""},{label:"Client",value:null!==(y=null===(v=null==e?void 0:e.client)||void 0===v?void 0:v.clientName)&&void 0!==y?y:""},{label:"Client TRN",value:null!==(S=null===(C=null==e?void 0:e.client)||void 0===C?void 0:C.trnNo)&&void 0!==S?S:""}),A.push({firstItem:"Billing period",secondItem:"From:",thirdItem:e.fromDateLocal,fourthItem:"To:",fifthItem:e.toDateLocal});let B=[],z=!1;T=[],e&&e.bills&&e.bills.length&&e.bills.forEach(e=>{var t;if(this.consumptionRoundOffFormat=null!==(t=Object(b.e)("ConsumptionRoundOff",e.utilityTypeId))&&void 0!==t?t:this.envService.consumptionRoundOffFormat,e.billTariffDetails&&e.billTariffDetails.length)for(let i=0;i<e.billTariffDetails.length;i++){if(e.billTariffDetails[i].slabSettingsId&&e.billTariffDetails[i].slabSettingsId>0){let t=e.billTariffDetails[i].season;Number(e.billTariffDetails[i].peakType)<Number(e.billTariffDetails[i].consumption)&&(t=e.billTariffDetails[i].peakType+" - "+e.billTariffDetails[i].consumption),0==i&&(z=!0,B=["Slab","Consumption","Rate","Amount"]),T.push(t),T.push(this.decimalPipe.transform(e.billTariffDetails[i].consumption,this.consumptionRoundOffFormat)),T.push(e.billTariffDetails[i].rate),T.push(this.currencyPipe.transform(e.billTariffDetails[i].amount,this.currency.toString(),!0,this.roundFormat))}else 0==e.billTariffDetails[i].slabSettingsId&&(0==i&&(B=["Season","Week Type","Peak Type","Consumption","Rate","Amount"]),T.push(e.billTariffDetails[i].season),T.push(e.billTariffDetails[i].weekType),T.push(e.billTariffDetails[i].peakType),T.push(this.decimalPipe.transform(e.billTariffDetails[i].consumption,this.consumptionRoundOffFormat)),T.push(e.billTariffDetails[i].rate),T.push(this.currencyPipe.transform(e.billTariffDetails[i].amount,this.currency.toString(),!0,this.roundFormat)));k.push(T),T=[]}}),this.getBillFormat2Report(I,P,D,["Customer AccountNumber","Billing Period","Previous Due","Total for current period"],w,N,x,A,"Cancelled Bill Report",O,F,e,R,B,k,z)}getBillFormat2Report(e,t,i,l,n,o,a,s,r,c,u,d,m,h,b,p=!1){var f,g,v,y,C,S;let T=new fe.default({orientation:"portrait",unit:"pt",format:"letter"});const P=null!==(g=null===(f=null==d?void 0:d.client)||void 0===f?void 0:f.clientName)&&void 0!==g?g:"",D=T.getTextWidth(P.trim());T.setTextColor(0,0,0),T.setFontSize(17),T.setFont("Cambria"),T.text(P,Number(T.internal.pageSize.width/2)-Number(0!=D?D/2:0),18),this.addImage(T,d),T.setLineWidth(.1),T.line(Number(T.internal.pageSize.width/2)-Number(0!=D?D/2:0),21,Number(T.internal.pageSize.width/2)-Number(0!=D?D/2:0)+D,21),T.setFontSize(13),T.setLineWidth(.1),T.setFontSize(14),T.text("Billing Statement",30,41),T.autoTable("",o,{startX:10,startY:50,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:150,halign:"left"},1:{cellWidth:190,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"},didParseCell:function(e){e.cell.styles.cellPadding=1}});const w=Number(this.decimalPipe.transform(T.autoTable.previous.finalY,"1.0-0"));T.autoTable("",s,{startX:10,startY:w,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:150,halign:"left"},1:{cellWidth:95,halign:"center"},2:{cellWidth:95,halign:"center"},3:{cellWidth:97,halign:"center"},4:{cellWidth:97,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0]},didParseCell:function(e){e.cell.styles.cellPadding=1}});const N=Number(this.decimalPipe.transform(T.autoTable.previous.finalY,"1.0-0"));T.autoTable("",a,{startX:10,startY:N,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:150,halign:"left"},1:{cellWidth:384,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0]},didParseCell:function(e){e.cell.styles.cellPadding=1}});const x=Number(this.decimalPipe.transform(T.autoTable.previous.finalY,"1.0-0"));T.setFont("Cambria"),T.setFontSize(10),T.text("Meter Read-Outs".toUpperCase(),30,x+15),T.autoTable(e,t,{startX:10,startY:x+30,didDrawPage:function(e){var t="Page "+e.pageCount;T.setFontSize(10);var i=T.internal.pageSize.height||T.internal.pageSize.getHeight();T.text(t,e.settings.margin.left,i-10)},styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:6==e.length?100:4==e.length?182:150,halign:"center"},1:{cellWidth:6==e.length?95:4==e.length?142:120,halign:"center"},2:{cellWidth:4==e.length?105:95,halign:"center"},3:{cellWidth:4==e.length?105:95,halign:"center"},4:{cellWidth:74,halign:"center"},5:{cellWidth:75,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}});const A=Number(this.decimalPipe.transform(T.autoTable.previous.finalY,"1.0-0"));u&&u.length&&(T.setFontSize(10),T.text("Charges Breakdown".toUpperCase(),30,A+15),T.autoTable(c,u,{startX:10,startY:A+30,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:6==c.length?80:215,halign:"center"},1:{cellWidth:6==c.length?145:85,halign:"center"},2:{cellWidth:85,halign:"center"},3:{cellWidth:75,halign:"center"},4:{cellWidth:74,halign:"right"},5:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}));const F=Number(this.decimalPipe.transform(T.autoTable.previous.finalY,"1.0-0"));let R=F;p?(T.autoTable(h,b,{startX:10,startY:F+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:200,halign:"center"},1:{cellWidth:117,halign:"center"},2:{cellWidth:117,halign:"center"},3:{cellWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}),R=Number(this.decimalPipe.transform(T.autoTable.previous.finalY,"1.0-0"))):(T.autoTable(h,b,{startX:10,startY:F+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:130,halign:"center"},1:{cellWidth:85,halign:"center"},2:{cellWidth:85,halign:"center"},3:{cellWidth:85,halign:"center"},4:{cellWidth:74,halign:"center"},5:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}),R=Number(this.decimalPipe.transform(T.autoTable.previous.finalY,"1.0-0"))),T.autoTable("",m,{startX:10,startY:R+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{bottom:35,left:230},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:235,fontStyle:"italic"},1:{cellWidth:100}},didParseCell:function(e){1==e.column.index&&(e.cell.styles.halign="right"),e.cell.styles.cellPadding=1},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});const k=Number(this.decimalPipe.transform(T.autoTable.previous.finalY,"1.0-0"));(null===(y=null===(v=null==d?void 0:d.client)||void 0===v?void 0:v.termsConditions[0])||void 0===y?void 0:y.termsAndCondition)&&(T.setFillColor(241,241,244),T.rect(30,k+20,535,80,"FD"),T.setFillColor(0,0,0),T.setFontSize(9),T.text(null===(S=null===(C=null==d?void 0:d.client)||void 0===C?void 0:C.termsConditions[0])||void 0===S?void 0:S.termsAndCondition.replace("{{ClientName}}",d.client.clientName).replace("{{TRNNumber}}",d.client.trnNo).replace("{{Currency}}",this.currency),60,k+30)),T.setTextColor(0,0,0),T.line(5,k+110,607,k+110);const I=T.internal.pageSize.height;T.text("Notice :- Please tear and attach the slip  along with your payment",30,I-90),T.autoTable(l,n,{startX:10,startY:I-80,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:120,halign:"center"},1:{cellWidth:200,halign:"center"},2:{cellWidth:100,halign:"right"},3:{cellWidth:120,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}),"function"==typeof T.putTotalPages&&T.putTotalPages("1");var O=T.output("datauristring");this.pdfsToMerge.push(O)}downloadBillFormat1Report(e){var t,i;let l=[],n=[],o=[],a=[],s=[],r=[],c=[],u=[],d=["Unit No","Meter No","Previous Reading","Present Reading","Consumption"],m=["Bill No","Charges","Consumption","Measuring Unit","Tariff","Total"],h="";e.bills.forEach(e=>{h+=e.deviceName+","}),s.push({label:"Account Number:",value:e.accountNumber},{label:"Meter Number:",value:h.slice(0,-1)},{label:"Unit Number:",value:e.unitNumber},{label:"Billing Date:",value:e.billDateLocal},{label:"Due Date:",value:e.dueDateLocal},{label:"Bill Period",value:`${Object(b.f)(e.fromDateLocal)} - ${Object(b.f)(e.toDateLocal)} `});let p=!1,f=!1;if(e&&e.bills&&e.bills.length){const t=Array.from(new Set(e.bills.map(e=>e.billNumber))),i=Array.from(new Set(e.bills.map(e=>e.unitNumber)));if(p=!!(t&&t.length>1),f=!!(i&&i.length>1),p||d.splice(0,1),f){const e=s.findIndex(e=>"Unit Number:"===e.label);s.splice(e,1)}else m.splice(0,1)}for(let C=0;C<e.bills.length;C++)this.consumptionRoundOffFormat=null!==(t=Object(b.e)("ConsumptionRoundOff",e.bills[C].utilityTypeId))&&void 0!==t?t:this.envService.consumptionRoundOffFormat,f&&l.push(e.unitNumber),l.push(e.bills[C].deviceName),l.push(this.decimalPipe.transform(e.bills[C].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[C].measuringUnit),l.push(this.decimalPipe.transform(e.bills[C].presentReading,this.consumptionRoundOffFormat)+" "+e.bills[C].measuringUnit),l.push(e.bills[C].isDifferentiateBill?this.decimalPipe.transform(e.bills[C].presentReading-e.bills[C].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[C].measuringUnit:this.decimalPipe.transform(e.bills[C].consumption,this.consumptionRoundOffFormat)+" "+e.bills[C].measuringUnit),"BTU"===e.bills[C].utilityType&&e.bills[C].billTransactions&&e.bills[C].billTransactions.length&&e.bills[C].billTransactions.findIndex(e=>e.measuringUnitId&&2===e.measuringUnitId)>-1&&(0==C&&d.push("Consumption TR-HR"),l.push(this.decimalPipe.transform(.284345*e.bills[C].consumption,this.consumptionRoundOffFormat))),n.push(l),l=[];let g=0;for(let C=0;C<e.bills.length;C++){this.consumptionRoundOffFormat=null!==(i=Object(b.e)("ConsumptionRoundOff",e.bills[C].utilityTypeId))&&void 0!==i?i:this.envService.consumptionRoundOffFormat;const t=e.bills[C];for(let e=0;e<t.billTransactions.length;e++)p&&l.push(t.billNumber),l.push(t.billTransactions[e].headDisplay),"BTU"===t.utilityType&&t.billTransactions&&t.billTransactions.length&&t.billTransactions[e]&&t.billTransactions[e].measuringUnitId&&2===t.billTransactions[e].measuringUnitId?(l.push(this.decimalPipe.transform(.284345*t.consumption,this.consumptionRoundOffFormat)),l.push("TR-HR"),l.push(t.billTransactions[e].rate)):(l.push(this.decimalPipe.transform(t.consumption,this.consumptionRoundOffFormat)),l.push(t.measuringUnit),l.push(t.billTransactions[e].rate)),l.push(this.currencyPipe.transform(t.billTransactions[e].headAmount,this.currency.toString(),!0,this.roundFormat)),c.push(l),l=[],g+=t.billTransactions[e].headAmount}l.push(e.accountNumber),l.push(e.fromDateLocal+"-"+e.toDateLocal),l.push(this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)),l.push(e.billAmountLocal),a.push(l),e.billCharges&&e.billCharges.length&&(e.billCharges.sort((e,t)=>e.position-t.position).forEach(e=>{if("VAT"!==e.headDisplay){const t=o.find(t=>t.label===e.headDisplay);t?t.value+=e.headAmount:o.push({label:e.headDisplay,value:e.headAmount})}}),o.forEach(e=>{r.push({label:e.label,value:this.currencyPipe.transform(e.value,this.currency.toString(),!0,this.roundFormat)})})),r.push({label:"Current Month Total Consumption Charge:",value:this.currencyPipe.transform(g,this.currency.toString(),!0,this.roundFormat)}),e.billTaxDetails&&e.billTaxDetails.length?e.billTaxDetails.forEach(e=>{r.push({label:e.taxDisplayName,value:this.currencyPipe.transform(e.taxAmount,this.currency.toString(),!0,this.roundFormat)})}):r.push({label:"TAX:",value:this.currencyPipe.transform(0,this.currency.toString(),!0,this.roundFormat)}),r.push({label:"Current Month + TAX:",value:e.billAmountLocal},{label:"Previous Bill Outstanding Balance:",value:this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)},{label:"Total Due incl TAX:",value:this.currencyPipe.transform(e.billAmount+e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)});let v=[],y=!1;l=[],e&&e.bills&&e.bills.length&&e.bills.forEach(e=>{var t;if(this.consumptionRoundOffFormat=null!==(t=Object(b.e)("ConsumptionRoundOff",e.utilityTypeId))&&void 0!==t?t:this.envService.consumptionRoundOffFormat,e.billTariffDetails&&e.billTariffDetails.length)for(let i=0;i<e.billTariffDetails.length;i++){if(e.billTariffDetails[i].slabSettingsId&&e.billTariffDetails[i].slabSettingsId>0){let t=e.billTariffDetails[i].season;Number(e.billTariffDetails[i].peakType)<Number(e.billTariffDetails[i].consumption)&&(t=e.billTariffDetails[i].peakType+" - "+e.billTariffDetails[i].consumption),0==i&&(y=!0,v=["Slab","Consumption","Rate","Amount"]),l.push(t),l.push(this.decimalPipe.transform(e.billTariffDetails[i].consumption,this.consumptionRoundOffFormat)),l.push(e.billTariffDetails[i].rate),l.push(this.currencyPipe.transform(e.billTariffDetails[i].amount,this.currency.toString(),!0,this.roundFormat))}else 0==e.billTariffDetails[i].slabSettingsId&&(0==i&&(v=["Season","Week Type","Peak Type","Consumption","Rate","Amount"]),l.push(e.billTariffDetails[i].season),l.push(e.billTariffDetails[i].weekType),l.push(e.billTariffDetails[i].peakType),l.push(this.decimalPipe.transform(e.billTariffDetails[i].consumption,this.consumptionRoundOffFormat)),l.push(e.billTariffDetails[i].rate),l.push(this.currencyPipe.transform(e.billTariffDetails[i].amount,this.currency.toString(),!0,this.roundFormat)));u.push(l),l=[]}}),this.getNewBillFormat1Report(d,n,o,["Customer AccountNumber","Billing Period","Previous Due","Total for current period"],a,[],s,r,"Invoice",m,c,e,[],v,u,y)}getNewBillFormat1Report(e,t,i,l,n,o,a,s,r,c,u,d,m,h,p,f=!1){var g,v,y,C,S,T,P,D,w,N,x,A,F,R,k,I,O,W,M,L,B,z;let U=new fe.default({orientation:"portrait",unit:"pt",format:"letter"});U.rect(5,5,U.internal.pageSize.width-10,U.internal.pageSize.height-10,"S"),U.setFontSize(30),U=this.addImage(U,d),U.setTextColor(0,0,0),U.setFontSize(16),U.setFont("Cambria","bold"),U.text("Tax Invoice",260,30),U.setFontSize(13),U.setFont("Cambria","normal"),U.text(d.client.clientName.toUpperCase(),10,60),U.setFontSize(10),U.setFont("Cambria"),U.text("TRN: "+d.client.trnNo,10,70),U.text("PO Box "+d.client.addresses[0].zipPostalCode,10,80),U.text(d.client.addresses[0].address1+","+d.client.addresses[0].country,10,90),U.text("Phone: "+d.client.phoneNo,10,100),U.text("Email: "+d.client.email+", Web: "+d.client.website,10,110),U.setFontSize(10),U.setFont("bold"),U.text("Invoice#: ".toUpperCase(),370,110),U.setTextColor(25,118,210);const E=U.getTextWidth("Invoice#: ");let j="";(null==d?void 0:d.billNumber)&&(j=null===(g=d.billNumber)||void 0===g?void 0:g.toUpperCase()),U.text(j,380+E,110),U.setFont("none"),U.setTextColor(0,0,0),U.setFontSize(9),U.autoTable("",a,{startY:120,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:370},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:80,halign:"left"},1:{cellWidth:150,halign:"right"}},didParseCell:function(e){e.cell.styles.cellPadding=6===e.length?1.8:2.7},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});const H=Number(this.decimalPipe.transform(U.autoTable.previous.finalY,"1.0-0"));if(U.setLineWidth(.1),U.line(5,H+5,607,H+5),U.setFont("Cambria"),U.setFillColor(241,241,244),U.setDrawColor(206,203,203),U.rect(10,120,340,H-120,"FD"),U.setTextColor(0,0,0),U.setFontSize(12),U.text(null==d?void 0:d.ownerName.toUpperCase(),20,135),U.text("CUSTOMER TRN: "+d.trn,20,150),U.text("unit #"+d.unitNumber,20,165),U.setFontSize(10),U.text(d.clientName,20,180),U.text(Object(b.f)(null===(v=null==d?void 0:d.client)||void 0===v?void 0:v.buildingName,",")+Object(b.f)(null===(C=null===(y=null==d?void 0:d.client)||void 0===y?void 0:y.addresses[0])||void 0===C?void 0:C.location,",")+Object(b.f)(null===(T=null===(S=null==d?void 0:d.client)||void 0===S?void 0:S.addresses[0])||void 0===T?void 0:T.city,",")+Object(b.f)(null===(D=null===(P=null==d?void 0:d.client)||void 0===P?void 0:P.addresses[0])||void 0===D?void 0:D.country,","),20,195),U.setFontSize(10),U.text("Meter Read-Outs".toUpperCase(),10,H+20),U.autoTable(e,t,{startX:10,startY:H+35,didDrawPage:function(e){var t="Page "+e.pageCount;U.setFontSize(10);var i=U.internal.pageSize.height||U.internal.pageSize.getHeight();U.text(t,e.settings.margin.left,i-10)},styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:6==e.length?120:4==e.length?200:155,halign:"center"},1:{cellWidth:6==e.length?100:4==e.length?135:125,halign:"center"},2:{cellWidth:6==e.length?100:4==e.length?135:125,halign:"center"},3:{cellWidth:4==e.length?120:100,halign:"center"},4:{cellWidth:85,halign:"center"},5:{cellWidth:85,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}),u&&u.length){const e=Number(this.decimalPipe.transform(U.autoTable.previous.finalY,"1.0-0"));U.setFontSize(10),U.text("Charges Breakdown".toUpperCase(),10,e+15),U.autoTable(c,u,{startX:10,startY:e+30,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:6==c.length?80:200,halign:"center"},1:{cellWidth:6==c.length?180:100,halign:"center"},2:{cellWidth:6==c.length?90:100,halign:"center"},3:{cellWidth:6==c.length?90:100,halign:"center"},4:{cellWidth:6==c.length?75:90,halign:"right"},5:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}})}const Y=Number(this.decimalPipe.transform(U.autoTable.previous.finalY,"1.0-0"));let V=Y;f?(U.autoTable(h,p,{startX:10,startY:Y+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:250,halign:"center"},1:{cellWidth:120,halign:"center"},2:{cellWidth:120,halign:"center"},3:{cellWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}),V=Number(this.decimalPipe.transform(U.autoTable.previous.finalY,"1.0-0"))):(U.autoTable(h,p,{startX:10,startY:Y+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:140,halign:"center"},1:{cellWidth:100,halign:"center"},2:{cellWidth:100,halign:"center"},3:{cellWidth:100,halign:"center"},4:{cellWidth:75,halign:"center"},5:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}),V=Number(this.decimalPipe.transform(U.autoTable.previous.finalY,"1.0-0"))),U.setTextColor(25,118,210),U.setFontSize(12),U.text("Bank Payment Account Details",10,V+20),U.setTextColor(0,0,0),U.setFontSize(9),U.text("Account Title: "+Object(b.f)(null===(N=null===(w=null==d?void 0:d.client)||void 0===w?void 0:w.bankDetails[0])||void 0===N?void 0:N.accountName),10,V+40),U.text("Account #: "+Object(b.f)(null===(A=null===(x=null==d?void 0:d.client)||void 0===x?void 0:x.bankDetails[0])||void 0===A?void 0:A.accountNo),10,V+50),U.text("IBAN #: "+Object(b.f)(null===(R=null===(F=null==d?void 0:d.client)||void 0===F?void 0:F.bankDetails[0])||void 0===R?void 0:R.ibanNumber),10,V+60),U.text("Bank Name: "+Object(b.f)(null===(I=null===(k=null==d?void 0:d.client)||void 0===k?void 0:k.bankDetails[0])||void 0===I?void 0:I.bankName),10,V+70),U.text("Swift Code: "+ +Object(b.f)(null===(W=null===(O=null==d?void 0:d.client)||void 0===O?void 0:O.bankDetails[0])||void 0===W?void 0:W.swiftCode),10,V+80),U.setFontSize(9),U.autoTable("",s,{startX:300,startY:V+20,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:320},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:180,halign:"left"},1:{cellWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"},didParseCell:function(e){e.cell.styles.cellPadding=1.8}});const _=Number(this.decimalPipe.transform(U.autoTable.previous.finalY,"1.0-0"));let G=U.internal.pageSize.height;if(_>G-190){U.addPage(),U.rect(5,5,U.internal.pageSize.width-10,U.internal.pageSize.height-10,"S");var X="Page "+U.getNumberOfPages();U.setFontSize(10),U.text(X,10,G-10),G=230}(null===(L=null===(M=null==d?void 0:d.client)||void 0===M?void 0:M.termsConditions[0])||void 0===L?void 0:L.termsAndCondition)&&(U.setFillColor(241,241,244),U.rect(10,G-190,590,90,"FD"),U.setFillColor(0,0,0),U.setFontSize(9),U.text(null===(z=null===(B=null==d?void 0:d.client)||void 0===B?void 0:B.termsConditions[0])||void 0===z?void 0:z.termsAndCondition.replace("{{ClientName}}",d.client.clientName).replace("{{TRNNumber}}",d.client.trnNo).replace("{{Currency}}",this.currency),40,G-175)),U.setTextColor(0,0,0),U.line(5,G-95,607,G-95),U.text("Notice :- Please tear and attach the slip  along with your payment",10,G-80),U.autoTable(l,n,{startX:10,startY:G-65,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:130,halign:"center"},1:{cellWidth:210,halign:"center"},2:{cellWidth:110,halign:"right"},3:{cellWidth:140,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}});var $=U.output("datauristring");this.pdfsToMerge.push($)}downloadBillFormat3Report(e){var t,i,l,n,o,a,s,r,c,u,d;let m=[],h=[],p=[],f=[],g=[],v=[],y=[],C=[],S=[],T=["Unit No","Meter No","Previous Reading","Present Reading","Consumption"],P=["Bill No","Charges","Consumption","Measuring Unit","Tariff","Total"];g.push({label:"Bill No",value:": "+Object(b.f)(e.billNumber)},{label:"Date of issue",value:": "+Object(b.f)(e.billDateLocal)},{label:"Due Date",value:": "+Object(b.f)(e.dueDateLocal)}),v.push({label:"Billing period",value:`: From: ${Object(b.f)(e.fromDateLocal)} To: ${Object(b.f)(e.toDateLocal)} `},{label:"Customer Account",value:": "+Object(b.f)(e.accountNumber)},{label:"Customer Name",value:": "+Object(b.f)(e.ownerName)},{label:"Unit No",value:": "+Object(b.f)(e.unitNumber)},{label:"Address",value:": "+Object(b.f)(null===(i=null===(t=null==e?void 0:e.client)||void 0===t?void 0:t.addresses[0])||void 0===i?void 0:i.address1)},{label:"City",value:": "+Object(b.f)(null===(n=null===(l=null==e?void 0:e.client)||void 0===l?void 0:l.addresses[0])||void 0===n?void 0:n.city)},{label:"P.O Box",value:": "+Object(b.f)(null===(a=null===(o=null==e?void 0:e.client)||void 0===o?void 0:o.addresses[0])||void 0===a?void 0:a.zipPostalCode)},{label:"Phone number",value:": "+Object(b.f)(null===(s=null==e?void 0:e.receiverDetails[0])||void 0===s?void 0:s.phoneNumber)},{label:"Fax Number",value:": "},{label:"Client",value:": "+Object(b.f)(null===(r=null==e?void 0:e.client)||void 0===r?void 0:r.clientName)},{label:"Client TRN",value:": "+Object(b.f)(null===(c=null==e?void 0:e.client)||void 0===c?void 0:c.trnNo)});let D=!1,w=!1;if(e&&e.bills&&e.bills.length){const t=Array.from(new Set(e.bills.map(e=>e.billNumber))),i=Array.from(new Set(e.bills.map(e=>e.unitNumber)));if(D=!!(t&&t.length>1),w=!!(i&&i.length>1),D?g.splice(0,1):P.splice(0,1),w){const e=v.findIndex(e=>"Unit No"===e.label);v.splice(e,1)}else T.splice(0,1)}for(let k=0;k<e.bills.length;k++)this.consumptionRoundOffFormat=null!==(u=Object(b.e)("ConsumptionRoundOff",e.bills[k].utilityTypeId))&&void 0!==u?u:this.envService.consumptionRoundOffFormat,w&&m.push(e.unitNumber),m.push(e.bills[k].deviceName),m.push(this.decimalPipe.transform(e.bills[k].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[k].measuringUnit),m.push(this.decimalPipe.transform(e.bills[k].presentReading,this.consumptionRoundOffFormat)+" "+e.bills[k].measuringUnit),m.push(e.bills[k].isDifferentiateBill?this.decimalPipe.transform(e.bills[k].presentReading-e.bills[k].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[k].measuringUnit:this.decimalPipe.transform(e.bills[k].consumption,this.consumptionRoundOffFormat)+" "+e.bills[k].measuringUnit),"BTU"===e.bills[k].utilityType&&e.bills[k].billTransactions&&e.bills[k].billTransactions.length&&e.bills[k].billTransactions.findIndex(e=>e.measuringUnitId&&2===e.measuringUnitId)>-1&&(0==k&&T.push("Consumption TR-HR"),m.push(this.decimalPipe.transform(.284345*e.bills[k].consumption,this.consumptionRoundOffFormat))),h.push(m),m=[];let N=0;for(let k=0;k<e.bills.length;k++){this.consumptionRoundOffFormat=null!==(d=Object(b.e)("ConsumptionRoundOff",e.bills[k].utilityTypeId))&&void 0!==d?d:this.envService.consumptionRoundOffFormat;const t=e.bills[k];for(let e=0;e<t.billTransactions.length;e++)D&&m.push(t.billNumber),m.push(t.billTransactions[e].headDisplay),"BTU"===t.utilityType&&t.billTransactions&&t.billTransactions.length&&t.billTransactions[e]&&t.billTransactions[e].measuringUnitId&&2===t.billTransactions[e].measuringUnitId?(m.push(this.decimalPipe.transform(.284345*t.consumption,this.consumptionRoundOffFormat)),m.push("TR-HR"),m.push(t.billTransactions[e].rate)):(m.push(this.decimalPipe.transform(t.consumption,this.consumptionRoundOffFormat)),m.push(t.measuringUnit),m.push(t.billTransactions[e].rate)),m.push(this.currencyPipe.transform(t.billTransactions[e].headAmount,this.currency.toString(),!0,this.roundFormat)),y.push(m),m=[],N+=t.billTransactions[e].headAmount}m.push(e.accountNumber),m.push(e.fromDateLocal+"-"+e.toDateLocal),m.push(this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)),m.push(e.billAmountLocal),f.push(m);let x="";e.bills.forEach(e=>{x+=e.deviceName+","});let A=[],F=!1;m=[],e&&e.bills&&e.bills.length&&e.bills.forEach(e=>{var t;if(this.consumptionRoundOffFormat=null!==(t=Object(b.e)("ConsumptionRoundOff",e.utilityTypeId))&&void 0!==t?t:this.envService.consumptionRoundOffFormat,e.billTariffDetails&&e.billTariffDetails.length)for(let i=0;i<e.billTariffDetails.length;i++){if(e.billTariffDetails[i].slabSettingsId&&e.billTariffDetails[i].slabSettingsId>0){let t=e.billTariffDetails[i].season;Number(e.billTariffDetails[i].peakType)<Number(e.billTariffDetails[i].consumption)&&(t=e.billTariffDetails[i].peakType+" - "+e.billTariffDetails[i].consumption),0==i&&(F=!0,A=["Slab","Consumption","Rate","Amount"]),m.push(t),m.push(this.decimalPipe.transform(e.billTariffDetails[i].consumption,this.consumptionRoundOffFormat)),m.push(e.billTariffDetails[i].rate),m.push(this.currencyPipe.transform(e.billTariffDetails[i].amount,this.currency.toString(),!0,this.roundFormat))}else 0==e.billTariffDetails[i].slabSettingsId&&(0==i&&(A=["Season","Week Type","Peak Type","Consumption","Rate","Amount"]),m.push(e.billTariffDetails[i].season),m.push(e.billTariffDetails[i].weekType),m.push(e.billTariffDetails[i].peakType),m.push(this.decimalPipe.transform(e.billTariffDetails[i].consumption,this.consumptionRoundOffFormat)),m.push(e.billTariffDetails[i].rate),m.push(this.currencyPipe.transform(e.billTariffDetails[i].amount,this.currency.toString(),!0,this.roundFormat)));S.push(m),m=[]}});let R=[];e.bills.forEach(e=>{if(e.billTransactions&&e.billTransactions.length){const t=["consumption","consumptioncharge"];e.billTransactions.forEach(e=>{if(!t.includes(e.headDisplay.toLowerCase())){const t=R.find(t=>t.label===e.headDisplay);t?t.value+=e.headAmount:R.push({label:e.headDisplay,value:e.headAmount})}})}}),e.billCharges&&e.billCharges.length&&e.billCharges.sort((e,t)=>e.position-t.position).forEach(e=>{if("VAT"!==e.headDisplay){const t=R.find(t=>t.label===e.headDisplay);t?t.value+=e.headAmount:R.push({label:e.headDisplay,value:e.headAmount})}}),R.forEach(e=>{p.push({label:e.label,value:this.currencyPipe.transform(e.value,this.currency.toString(),!0,this.roundFormat)}),N+=Number(e.value)}),e.billTaxDetails&&e.billTaxDetails.length&&e.billTaxDetails.forEach(e=>{p.push({label:e.taxDisplayName,value:this.currencyPipe.transform(e.taxAmount,this.currency.toString(),!0,this.roundFormat)}),N+=Number(e.taxAmount)}),C.push({label:"Total for Current Period",value:this.currencyPipe.transform(e.billAmount+e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)}),this.getNewBillFormat3Report(T,h,p,["Customer AccountNumber","Billing Period","Previous Due","Total for current period"],f,g,v,[],"Invoice",P,y,e,C,A,S,F)}addImage(e,t){var i;try{if(t&&t.client&&t.client.imageProperties&&t.client.imageProperties.length){const n=t.client.imageProperties.find(e=>"invoice"===e.imageType.trim().toLowerCase());if(n){var l=new Image;l.src=this.filePath+"/uploads/"+(null===(i=null==t?void 0:t.client)||void 0===i?void 0:i.photo),l.onload=function(){e.addImage(l,n.imgX,n.imgY,n.imgW,n.imgH)}}else this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar")}else this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar")}catch(n){this.notificationMessage("Image not found.","red-snackbar")}return e}notificationMessage(e,t){this.snackbar.open(e,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[t]})}getNewBillFormat3Report(e,t,i,l,n,o,a,s,r,c,u,d,m,h,b,p=!1){var f,g,v,y;let C=new fe.default({orientation:"portrait",unit:"pt",format:"letter"});C.rect(5,5,C.internal.pageSize.width-10,C.internal.pageSize.height-10,"S"),C.setTextColor(0,0,0),C.setFontSize(11),C.setFont("Cambria"),C.text("Billing Statement".toUpperCase(),10,20),this.addImage(C,d),C.setLineWidth(.1),C.autoTable("",o,{startX:10,startY:35,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:15},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:190,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"},didParseCell:function(e){e.cell.styles.cellPadding=1.5}});const S=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"));C.autoTable("",a,{startX:10,startY:S,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:15},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:380,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0]},didParseCell:function(e){e.cell.styles.cellPadding=1.5}});const T=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"));C.setFont("Cambria"),C.setFontSize(10),C.text("Meter Read-Outs".toUpperCase(),10,T+15),C.autoTable(e,t,{startX:10,startY:T+30,didDrawPage:function(e){var t="Page "+e.pageCount;"function"==typeof C.putTotalPages&&(t+=" of 1",C.rect(5,5,C.internal.pageSize.width-10,C.internal.pageSize.height-10,"S")),C.setFontSize(9);var i=C.internal.pageSize.height||C.internal.pageSize.getHeight();C.text(t,e.settings.margin.left,i-10)},styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:6==e.length?120:4==e.length?200:155,halign:"center"},1:{cellWidth:6==e.length?100:4==e.length?135:125,halign:"center"},2:{cellWidth:6==e.length?100:4==e.length?135:125,halign:"center"},3:{cellWidth:4==e.length?120:100,halign:"center"},4:{cellWidth:85,halign:"center"},5:{cellWidth:85,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}});const P=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"));u&&u.length&&(C.setFontSize(10),C.text("Charges Breakdown".toUpperCase(),10,P+15),C.autoTable(c,u,{startX:10,startY:P+30,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:6==c.length?80:200,halign:"center"},1:{cellWidth:6==c.length?180:100,halign:"center"},2:{cellWidth:6==c.length?90:100,halign:"center"},3:{cellWidth:6==c.length?90:100,halign:"center"},4:{cellWidth:6==c.length?75:90,halign:"right"},5:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}));const D=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"));let w=D;p?(C.autoTable(h,b,{startX:10,startY:D+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:250,halign:"center"},1:{cellWidth:120,halign:"center"},2:{cellWidth:120,halign:"center"},3:{cellWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}),w=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"))):(C.autoTable(h,b,{startX:10,startY:D+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:140,halign:"center"},1:{cellWidth:100,halign:"center"},2:{cellWidth:100,halign:"center"},3:{cellWidth:100,halign:"center"},4:{cellWidth:75,halign:"center"},5:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}),w=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"))),C.autoTable("",i,{startX:10,startY:w+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{bottom:35,left:250},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:250,fontStyle:"italic"},1:{cellWidth:90}},didParseCell:function(e){1==e.column.index&&(e.cell.styles.halign="right"),e.cell.styles.cellPadding=1.5},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});const N=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"));C.line(5,N+10,607,N+10),C.autoTable("",m,{startX:10,startY:N+20,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{bottom:35,left:250},theme:"plain",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:250,fontStyle:"italic"},1:{cellWidth:90}},didParseCell:function(e){1==e.column.index&&(e.cell.styles.halign="right"),e.cell.styles.cellPadding=1.5},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});const x=Number(this.decimalPipe.transform(C.autoTable.previous.finalY,"1.0-0"));C.line(5,x+10,607,x+10);let A=C.internal.pageSize.height;T>A-190&&(C.addPage(),C.rect(5,5,C.internal.pageSize.width-10,C.internal.pageSize.height-10,"S"),A=400),(null===(g=null===(f=null==d?void 0:d.client)||void 0===f?void 0:f.termsConditions[0])||void 0===g?void 0:g.termsAndCondition)&&(C.setFillColor(241,241,244),C.rect(10,A-190,590,90,"FD"),C.setFillColor(0,0,0),C.setFontSize(9),C.text(null===(y=null===(v=null==d?void 0:d.client)||void 0===v?void 0:v.termsConditions[0])||void 0===y?void 0:y.termsAndCondition.replace("{{ClientName}}",d.client.clientName).replace("{{TRNNumber}}",d.client.trnNo).replace("{{Currency}}",this.currency),30,A-175)),C.setTextColor(0,0,0),C.line(5,A-95,607,A-95),C.text("Notice :- Please tear and attach the slip  along with your payment",10,A-80),C.autoTable(l,n,{startX:10,startY:A-65,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:130,halign:"center"},1:{cellWidth:210,halign:"center"},2:{cellWidth:110,halign:"right"},3:{cellWidth:140,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}),"function"==typeof C.putTotalPages&&C.putTotalPages("1");var F=C.output("datauristring");this.pdfsToMerge.push(F)}downloadBillFormat2LargeReport(e){var t,i,l,n,o,a,s,r,c,u,d,m,h,p,f,g,v,y,C,S;let T=[],P=[],D=[],w=[],N=[],x=[],A=[],F=[],R=[],k=[],I=["Unit No","Meter No","Previous Reading","Present Reading","Consumption"],O=["Bill No","Charges","Consumption","Measuring Unit","Tariff","Total"];N.push({label:"Bill No",value:null!==(t=null==e?void 0:e.billNumber)&&void 0!==t?t:""},{label:"Date of issue",value:null!==(i=null==e?void 0:e.billDateLocal)&&void 0!==i?i:""},{label:"Due Date",value:null!==(l=null==e?void 0:e.dueDateLocal)&&void 0!==l?l:""}),x.push({label:"Customer Name",value:null!==(n=null==e?void 0:e.ownerName)&&void 0!==n?n:""},{label:"Customer AccountNumber",value:null!==(o=null==e?void 0:e.accountNumber)&&void 0!==o?o:""},{label:"Unit No",value:null!==(a=null==e?void 0:e.unitNumber)&&void 0!==a?a:""},{label:"Address",value:null!==(r=null===(s=null==e?void 0:e.receiverDetails[0])||void 0===s?void 0:s.address1)&&void 0!==r?r:""},{label:"City",value:null!==(u=null===(c=null==e?void 0:e.receiverDetails[0])||void 0===c?void 0:c.city)&&void 0!==u?u:""},{label:"P.O Box",value:null!==(m=null===(d=null==e?void 0:e.receiverDetails[0])||void 0===d?void 0:d.zipPostalCode)&&void 0!==m?m:""},{label:"Phone number",value:null!==(p=null===(h=null==e?void 0:e.receiverDetails[0])||void 0===h?void 0:h.phoneNumber)&&void 0!==p?p:""},{label:"Fax Number",value:""},{label:"Client",value:null!==(g=null===(f=null==e?void 0:e.client)||void 0===f?void 0:f.clientName)&&void 0!==g?g:""},{label:"Client TRN",value:null!==(y=null===(v=null==e?void 0:e.client)||void 0===v?void 0:v.trnNo)&&void 0!==y?y:""});let W=!1,M=!1;if(e&&e.bills&&e.bills.length){const t=Array.from(new Set(e.bills.map(e=>e.billNumber))),i=Array.from(new Set(e.bills.map(e=>e.unitNumber)));if(W=!!(t&&t.length>1),M=!!(i&&i.length>1),W?N.splice(0,1):O.splice(0,1),M){const e=x.findIndex(e=>"Unit No"===e.label);x.splice(e,1)}else I.splice(0,1)}for(let E=0;E<e.bills.length;E++)this.consumptionRoundOffFormat=null!==(C=Object(b.e)("ConsumptionRoundOff",e.bills[E].utilityTypeId))&&void 0!==C?C:this.envService.consumptionRoundOffFormat,M&&T.push(e.bills[E].unitNumber),T.push(e.bills[E].deviceName),T.push(this.decimalPipe.transform(e.bills[E].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[E].measuringUnit),T.push(this.decimalPipe.transform(e.bills[E].presentReading,this.consumptionRoundOffFormat)+" "+e.bills[E].measuringUnit),T.push(e.bills[E].isDifferentiateBill?this.decimalPipe.transform(e.bills[E].presentReading-e.bills[E].previousReading,this.consumptionRoundOffFormat)+" "+e.bills[E].measuringUnit:this.decimalPipe.transform(e.bills[E].consumption,this.consumptionRoundOffFormat)+" "+e.bills[E].measuringUnit),"BTU"===e.bills[E].utilityType&&e.bills[E].billTransactions&&e.bills[E].billTransactions.length&&e.bills[E].billTransactions.findIndex(e=>e.measuringUnitId&&2===e.measuringUnitId)>-1&&(0==E&&I.push("Consumption TR-HR"),T.push(this.decimalPipe.transform(.284345*e.bills[E].consumption,this.consumptionRoundOffFormat))),P.push(T),T=[];let L=0;for(let E=0;E<e.bills.length;E++){const t=e.bills[E];this.consumptionRoundOffFormat=null!==(S=Object(b.e)("ConsumptionRoundOff",e.bills[E].utilityTypeId))&&void 0!==S?S:this.envService.consumptionRoundOffFormat;for(let e=0;e<t.billTransactions.length;e++)W&&T.push(t.billNumber),T.push(t.billTransactions[e].headDisplay),"BTU"===t.utilityType&&t.billTransactions&&t.billTransactions.length&&t.billTransactions[e]&&t.billTransactions[e].measuringUnitId&&2===t.billTransactions[e].measuringUnitId?(T.push(this.decimalPipe.transform(.284345*t.consumption,this.consumptionRoundOffFormat)),T.push("TR-HR"),T.push(t.billTransactions[e].rate)):(T.push(this.decimalPipe.transform(t.consumption,this.consumptionRoundOffFormat)),T.push(t.measuringUnit),T.push(t.billTransactions[e].rate)),T.push(this.currencyPipe.transform(t.billTransactions[e].headAmount,this.currency.toString(),!0,this.roundFormat)),F.push(T),T=[],L+=t.billTransactions[e].headAmount}T.push(e.accountNumber),T.push(e.fromDateLocal+"-"+e.toDateLocal),T.push(this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)),T.push(e.billAmountLocal),w.push(T),e.billCharges&&e.billCharges.length&&(e.billCharges.sort((e,t)=>e.position-t.position).forEach(e=>{if("VAT"!==e.headDisplay){const t=D.find(t=>t.label===e.headDisplay);t?t.value+=e.headAmount:D.push({label:e.headDisplay,value:e.headAmount})}}),D.forEach(e=>{R.push({label:e.label,value:this.currencyPipe.transform(e.value,this.currency.toString(),!0,this.roundFormat)}),L+=e.value})),R.push({label:"Total Charges for Current Period",value:this.currencyPipe.transform(L,this.currency.toString(),!0,this.roundFormat)}),e.billTaxDetails.forEach(e=>{const t=R.find(t=>t.label===e.taxDisplayName);if(t){const i=Number(t.value.replace(this.currency,"").trim())+Number(e.taxAmount);t.value=this.currencyPipe.transform(i,this.currency.toString(),!0,this.roundFormat)}else R.push({label:e.taxDisplayName,value:this.currencyPipe.transform(e.taxAmount,this.currency.toString(),!0,this.roundFormat)})}),R.push({label:"Previous Outstanding Amount",value:this.currencyPipe.transform(e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)},{label:"Total Amount Due",value:this.currencyPipe.transform(e.billAmount+e.previousDueAmount,this.currency.toString(),!0,this.roundFormat)}),A.push({firstItem:"Billing period",secondItem:"From:",thirdItem:e.fromDateLocal,fourthItem:"To:",fifthItem:e.toDateLocal});let B=[],z=!1,U=[];T=[],e&&e.bills&&e.bills.length&&e.bills.forEach(e=>{var t;this.consumptionRoundOffFormat=null!==(t=Object(b.e)("ConsumptionRoundOff",e.utilityTypeId))&&void 0!==t?t:this.envService.consumptionRoundOffFormat,U=[];let i="Unit Number : "+e.unitNumber+" - Meter Number : "+e.deviceName;if(e.billTariffDetails&&e.billTariffDetails.length)for(let l=0;l<e.billTariffDetails.length;l++){if(e.billTariffDetails[l].slabSettingsId&&e.billTariffDetails[l].slabSettingsId>0){let t=e.billTariffDetails[l].season;Number(e.billTariffDetails[l].peakType)<Number(e.billTariffDetails[l].consumption)&&(t=e.billTariffDetails[l].peakType+" - "+e.billTariffDetails[l].consumption),0==l&&(z=!0,B=["Slab","Consumption","Rate","Amount"]),U&&U.length?U.find(e=>e===i)||this.createUnitMeterNumberRow(i,B.length,k):(U.push(i),this.createUnitMeterNumberRow(i,B.length,k)),T.push(t),T.push(this.decimalPipe.transform(e.billTariffDetails[l].consumption,this.consumptionRoundOffFormat)),T.push(e.billTariffDetails[l].rate),T.push(this.currencyPipe.transform(e.billTariffDetails[l].amount,this.currency.toString(),!0,this.roundFormat))}else 0==e.billTariffDetails[l].slabSettingsId&&(0==l&&(B=["Season","Week Type","Peak Type","Consumption","Rate","Amount"]),T.push(e.billTariffDetails[l].season),T.push(e.billTariffDetails[l].weekType),T.push(e.billTariffDetails[l].peakType),T.push(this.decimalPipe.transform(e.billTariffDetails[l].consumption,this.consumptionRoundOffFormat)),T.push(e.billTariffDetails[l].rate),T.push(this.currencyPipe.transform(e.billTariffDetails[l].amount,this.currency.toString(),!0,this.roundFormat)));k.push(T),T=[]}}),this.getBillFormat2LargeReport(I,P,D,["Customer AccountNumber","Billing Period","Previous Due","Total for current period"],w,N,x,A,"Sample Report",O,F,e,R,B,k,z)}getBillFormat2LargeReport(e,t,i,l,n,o,a,s,r,c,u,d,m,h,b,p=!1){var f,g,v,y,C,S,T;(new Image).src=this.filePath+"/uploads/"+(null===(f=null==d?void 0:d.client)||void 0===f?void 0:f.photo);let P=new fe.default({orientation:"portrait",unit:"pt",format:"letter"});const D=null!==(v=null===(g=null==d?void 0:d.client)||void 0===g?void 0:g.clientName)&&void 0!==v?v:"",w=P.getTextWidth(D.trim())+4;P.setTextColor(0,0,0),P.setFontSize(17),P.setFont("Cambria"),P.text(D,Number(P.internal.pageSize.width/2)-Number(0!=w?w/2:0),23),P.setDrawColor(0,0,0),P.line(Number(P.internal.pageSize.width/2)-Number(0!=w?w/2:0),26,Number(P.internal.pageSize.width/2)-Number(0!=w?w/2:0)+w,26),P.setFont("Cambria","normal"),P.setFontSize(14),P.text("Billing Statement",35,46),this.addImage(P,d),P.autoTable("",o,{startX:10,startY:55,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:35},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:150,halign:"left"},1:{cellWidth:190,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"},didParseCell:function(e){e.cell.styles.cellPadding=1}});const N=Math.round(P.autoTable.previous.finalY);P.autoTable("",s,{startX:10,startY:N,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:35},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:150,halign:"left"},1:{cellWidth:95,halign:"center"},2:{cellWidth:95,halign:"center"},3:{cellWidth:97,halign:"center"},4:{cellWidth:97,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0]},didParseCell:function(e){e.cell.styles.cellPadding=1}});const x=Math.round(P.autoTable.previous.finalY);P.autoTable("",a,{startX:10,startY:x,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:35},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:150,halign:"left"},1:{cellWidth:384,halign:"left"}},headStyles:{lineWidth:.1,lineColor:[0,0,0]},didParseCell:function(e){e.cell.styles.cellPadding=1}});var A=function(e){var t="Page "+e.pageCount;"function"==typeof P.putTotalPages&&(t=t),P.setFontSize(9)};const F=Math.round(P.autoTable.previous.finalY);P.setFont("Cambria"),P.setFontSize(10),P.text("Meter Read-Outs".toUpperCase(),35,F+20),P.autoTable(e,t,{startX:10,startY:F+40,showHead:"everyPage",didDrawPage:A,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:35},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:6==e.length?100:4==e.length?182:150,halign:"center"},1:{cellWidth:6==e.length?95:4==e.length?142:120,halign:"center"},2:{cellWidth:4==e.length?105:95,halign:"center"},3:{cellWidth:4==e.length?105:95,halign:"center"},4:{cellWidth:74,halign:"center"},5:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}});const R=Number(this.decimalPipe.transform(P.autoTable.previous.finalY,"1.0-0"));u&&u.length&&(P.setFontSize(10),P.text("Charges Breakdown".toUpperCase(),35,R+20),P.autoTable(c,u,{startX:10,startY:R+40,showHead:"everyPage",didDrawPage:A,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:35},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:6==c.length?80:215,halign:"center"},1:{cellWidth:6==c.length?145:85,halign:"center"},2:{cellWidth:85,halign:"center"},3:{cellWidth:75,halign:"center"},4:{cellWidth:74,halign:"right"},5:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}));const k=Number(this.decimalPipe.transform(P.autoTable.previous.finalY,"1.0-0"));let I=k;p?(P.autoTable(h,b,{startX:10,startY:k+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:200,halign:"center"},1:{cellWidth:117,halign:"center"},2:{cellWidth:117,halign:"center"},3:{cellWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}),I=Number(this.decimalPipe.transform(P.autoTable.previous.finalY,"1.0-0"))):(P.autoTable(h,b,{startX:10,startY:k+10,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:180,left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:130,halign:"center"},1:{cellWidth:85,halign:"center"},2:{cellWidth:85,halign:"center"},3:{cellWidth:85,halign:"center"},4:{cellWidth:74,halign:"center"},5:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}}),I=Number(this.decimalPipe.transform(P.autoTable.previous.finalY,"1.0-0")));let O=P.internal.pageSize.height;O-I<200&&(P.addPage(),I=N,O=370+N),P.autoTable("",m,{startX:10,startY:I+20,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{bottom:40,left:250},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:244,fontStyle:"italic"},1:{cellWidth:75}},didParseCell:function(e){1==e.column.index&&(e.cell.styles.halign="right"),e.cell.styles.cellPadding=1},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});let W=Number(this.decimalPipe.transform(P.autoTable.previous.finalY,"1.0-0"));(null===(C=null===(y=null==d?void 0:d.client)||void 0===y?void 0:y.termsConditions[0])||void 0===C?void 0:C.termsAndCondition)&&(P.setFillColor(241,241,244),P.rect(35,W+20,535,80,"FD"),P.setFillColor(0,0,0),P.setFontSize(9),P.text(null===(T=null===(S=null==d?void 0:d.client)||void 0===S?void 0:S.termsConditions[0])||void 0===T?void 0:T.termsAndCondition.replace("{{ClientName}}",d.client.clientName).replace("{{TRNNumber}}",d.client.trnNo).replace("{{Currency}}",this.currency),65,W+30)),P.setTextColor(0,0,0),P.line(5,W+110,607,W+110),P.text("Notice :- Please tear and attach the slip  along with your payment",35,O-80),P.autoTable(l,n,{startX:10,startY:O-70,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:35},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:120,halign:"center"},1:{cellWidth:200,halign:"center"},2:{cellWidth:100,halign:"right"},3:{cellWidth:120,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]},didParseCell:function(e){e.cell.styles.cellPadding=1}});var M=P.output("datauristring");this.pdfsToMerge.push(M)}createUnitMeterNumberRow(e,t,i){let l=[];for(let n=0;n<t-1;n++)l.push(0===n?e:"");i.push(l)}}return e.\u0275fac=function(t){return new(t||e)(m.Nb(c.a),m.Nb(je.a),m.Nb(F.a),m.Nb(a.f),m.Nb(a.d),m.Nb(a.g),m.Nb(h.b),m.Nb(pe.a),m.Nb(C.a),m.Nb(_.a),m.Nb(k.b),m.Nb(p.a))},e.\u0275cmp=m.Hb({type:e,selectors:[["app-bill-history-cancel"]],viewQuery:function(e,t){var i;1&e&&m.Vc(Ci,!0),2&e&&m.zc(i=m.cc())&&(t.htmlData=i.first)},decls:27,vars:15,consts:[["mode","card",2,"margin-top","20px"],["fxLayout","column"],["color","primary",1,"position-fixed"],["src","assets/img/fav-icon.png",1,"img-style"],[1,"toolbar-spacer"],["matTooltip","Print","mat-icon-button","","aria-label","Example icon-button with menu icon",1,"example-icon",3,"click"],["fxFlex","noshrink","fxLayout","column","fxLayout.gt-sm","row","fxLayoutAlign.gt-sm","start stretch",3,"fxLayoutGap"],["fxFlex","grow",1,"basic-forms","route-animations-elements",3,"fxFlex.gt-sm"],["fxLayout","column",1,"result"],[3,"tenants","billPeriods","isTenantVisible","billTypes","isHide","searchClicked"],["fxLayout","column",1,"padding"],[3,"tableData","columnsToDisplay","innerDisplayedColumns","columnNames","hideHeader","selectedRows","viewDataRow","printDataRow"],["fxLayout.gt-sm","row","fxLayout","column","fxLayoutAlign","end end","fxLayoutGap.gt-sm","12px",1,"result"],["color","primary",1,"result"],["type","text","id","billAmount","name","billAmount","matInput","",2,"text-align","right",3,"ngModel","ngModelChange"],["type","text","id","receivedAmount","name","receivedAmount","matInput","",2,"text-align","right",3,"ngModel","ngModelChange"]],template:function(e,t){1&e&&(m.Tb(0,"fury-page-layout",0),m.Tb(1,"fury-page-layout-content",1),m.Tb(2,"mat-toolbar",2),m.Ob(3,"img",3),m.Tb(4,"span"),m.Rc(5,"Bill Cancel History"),m.Sb(),m.Ob(6,"span",4),m.Tb(7,"button",5),m.bc("click",(function(){return t.onPrintPdf()})),m.Tb(8,"mat-icon"),m.Rc(9,"print"),m.Sb(),m.Sb(),m.Sb(),m.Tb(10,"div",6),m.Tb(11,"fury-card",7),m.Ob(12,"fury-card-header"),m.Tb(13,"fury-card-content",1),m.Tb(14,"div",8),m.Tb(15,"app-bill-history-toolbar",9),m.bc("searchClicked",(function(e){return t.onGetBillsHistory(e)})),m.Sb(),m.Sb(),m.Tb(16,"div",10),m.Tb(17,"fury-expandable-table-structure",11),m.bc("selectedRows",(function(e){return t.onSelectedRows(e)}))("viewDataRow",(function(e){return t.onViewDataRow(e)}))("printDataRow",(function(e){return t.downloadReport(e)})),m.Sb(),m.Sb(),m.Tb(18,"div",12),m.Tb(19,"mat-form-field",13),m.Tb(20,"mat-label"),m.Rc(21,"Bill Amount"),m.Sb(),m.Tb(22,"input",14),m.bc("ngModelChange",(function(e){return t.billAmount=e})),m.Sb(),m.Sb(),m.Tb(23,"mat-form-field",13),m.Tb(24,"mat-label"),m.Rc(25,"Paid Amount"),m.Sb(),m.Tb(26,"input",15),m.bc("ngModelChange",(function(e){return t.receivedAmount=e})),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb()),2&e&&(m.Cb(10),m.mc("fxLayoutGap",t.gap),m.Cb(1),m.mc("fxFlex.gt-sm",t.col2)("@fadeInUp",void 0),m.Cb(4),m.mc("tenants",t.tenants)("billPeriods",t.billPeriods)("isTenantVisible",!1)("billTypes",t.billTypes)("isHide",!1),m.Cb(2),m.mc("tableData",t.billMasterDetails)("columnsToDisplay",t.columns)("innerDisplayedColumns",t.innerColumns)("columnNames",t.columnNames)("hideHeader",!1),m.Cb(5),m.mc("ngModel",t.billAmount),m.Cb(4),m.mc("ngModel",t.receivedAmount))},directives:[X.a,$.a,S.d,q.a,P.a,D.a,w.a,S.b,S.c,S.e,f.a,f.d,f.c,nt,T.a,I.d,I.h,W.b,l.c,l.q,l.t],styles:[".padding[_ngcontent-%COMP%]{padding:0 0 24px}.toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.img-style[_ngcontent-%COMP%]{width:32px}.position-fixed[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;top:0;z-index:5}"],data:{animation:[d.a,u.a]}}),e})(),Ti=(()=>{class e{constructor(e,t,i,l,n,o,a,s,r,c){var u,d,m;this.billService=e,this.billSettlementService=t,this.date=i,this.currency=l,this.decimalPipe=n,this.cookieService=o,this.snackbar=a,this.clientSelectionService=s,this.templateService=r,this.envService=c,this._gap=16,this.gap=this._gap+"px",this.col2=`1 1 calc(50% - ${this._gap/2}px)`,this.col3=`1 1 calc(33.3333% - ${this._gap/1.5}px)`,this.columns=[],this.innerColumns=[],this.columnNames=[],this.payments=[],this.paymentModes=[{label:"Select",value:0}],this.selectedRows=[],this.manageParams={},this.innerTableName="billMasters",this.billAmount="",this.receivedAmount="",this.filePath="",this.pdfsToMerge=[],this.dateFormat="",this.currencyFormat="",this.roundOffFormat="",this.paymentNumberColumnName="Payment No",this.accountNumberColumnName="Account Number",this.paymentDateColumnName="Payment Date",this.paymentModeColumnName="Payment Mode",this.refNoColumnName="Ref No",this.tenantColumnName="Customer Name",this.receivedAmountColumnName="Received Amount",this.reasonColumnName="Reason",this.billNumberColumnName="Bill No",this.billDateCoulmnName="BillDate",this.tenantNameColumnName="Tenant Name",this.unitColumnName="Unit",this.fromDateColumnName="From Date",this.toDateColumnName="To Date",this.dueDateColumnName="Due Date",this.billAmountColumnName="Bill Amount",this.billDateColumnName="BillDate",this.dateFormat=null!==(u=Object(b.e)("DateFormat"))&&void 0!==u?u:c.dateFormat,this.currencyFormat=null!==(d=Object(b.e)("Currency"))&&void 0!==d?d:c.currencyFormat,this.roundOffFormat=null!==(m=Object(b.e)("RoundOff"))&&void 0!==m?m:c.roundOffFormat}ngOnInit(){this.clientSelectionService.setIsClientVisible(!0),this.clientId=parseInt(this.cookieService.get("globalClientId")),this.onGetPaymentModes(),this.createColumnNames(),this.createGridColumns(),this.createInnerGridColumns()}createGridColumns(){this.columns=["select","paymentNumber","paymentDateLocal","paymentReference","paymentMode","accountNumber","tenantName","paymentAmountLocal","cancelReason"]}createInnerGridColumns(){this.innerColumns=["billNumber","billDateLocal","unitNumber","fromDateLocal","toDateLocal","dueDateLocal","billAmountLocal"]}createColumnNames(){this.columnNames=[{name:this.paymentNumberColumnName,property:"paymentNumber"},{name:this.paymentDateColumnName,property:"paymentDateLocal"},{name:this.refNoColumnName,property:"paymentReference"},{name:this.paymentModeColumnName,property:"paymentMode"},{name:this.accountNumberColumnName,property:"accountNumber"},{name:this.tenantColumnName,property:"tenantName"},{name:this.receivedAmountColumnName,property:"paymentAmountLocal",columnAlign:{"text-align":"right"}},{name:this.reasonColumnName,property:"cancelReason"},{name:this.billNumberColumnName,property:"billNumber"},{name:this.billDateColumnName,property:"billDateLocal"},{name:this.unitColumnName,property:"unitNumber"},{name:this.fromDateColumnName,property:"fromDateLocal"},{name:this.toDateColumnName,property:"toDateLocal"},{name:this.dueDateColumnName,property:"dueDateLocal"},{name:this.billAmountColumnName,property:"billAmountLocal",columnAlign:{"text-align":"right"}}]}onGetPaymentHistory(e){this.manageParams=e,this.payments=[],this.billAmount="",this.receivedAmount="";let t=0,i=0;e.clientId=this.clientId,this.billService.getPaymentCancelHistory(e).subscribe(e=>{this.dateFormat=Object(b.e)("DateFormat"),this.roundOffFormat=Object(b.e)("RoundOff"),this.currencyFormat=Object(b.e)("Currency"),e.forEach(e=>{e.paymentDateLocal=this.date.transform(e.paymentDate.toString(),this.dateFormat.toString()),e.referenceDateLocal=this.date.transform(e.referenceDate.toString(),this.dateFormat.toString()),e.paymentAmountLocal=this.currency.transform(e.paymentAmount,this.currencyFormat.toString(),!0,this.roundOffFormat),e.advanceAmountLocal=this.currency.transform(e.advanceAmount,this.currencyFormat.toString(),!0,this.roundOffFormat),e.billMasters.forEach(e=>{var i;e.billDate&&(e.billDateLocal=this.date.transform(e.billDate.toString(),this.dateFormat.toString())),e.billAmount&&(e.billAmountLocal=this.currency.transform(e.billAmount,this.currencyFormat.toString(),!0,this.roundOffFormat)),e.fromDate&&(e.fromDateLocal=this.date.transform(e.fromDate.toString(),this.dateFormat.toString())),e.toDate&&(e.toDateLocal=this.date.transform(e.toDate.toString(),this.dateFormat.toString())),e.dueDate&&(e.dueDateLocal=this.date.transform(e.dueDate.toString(),this.dateFormat.toString())),e.paid&&(e.paidLocal=this.currency.transform(e.paid.toString(),this.currencyFormat.toString(),!0,this.roundOffFormat)),t=null!==(i=t+e.billAmount)&&void 0!==i?i:0}),i+=e.paymentAmount}),this.payments=e,this.billAmount=this.currency.transform(t,this.currencyFormat.toString(),!0,this.roundOffFormat),this.receivedAmount=this.currency.transform(i,this.currencyFormat.toString(),!0,this.roundOffFormat)})}onGetPaymentModes(){this.paymentModes=[{label:"Select",value:0}],this.billSettlementService.getPaymentModes().subscribe(e=>{e.forEach(e=>{this.paymentModes.push({label:e.description,value:e.id})})})}onPrintPdf(){return Object(r.a)(this,void 0,void 0,(function*(){this.selectedRows&&this.selectedRows.length?this.receiptView(this.selectedRows):this.notificationMessage("Please select Bills.","red-snackbar")}))}receiptView(e){this.billService.receiptView(e).subscribe({next:e=>{e?this.downloadFile(e):this.notificationMessage("No data to print","red-snackbar")},error:e=>{this.notificationMessage("No data to print","red-snackbar")}})}downloadFile(e){return Object(r.a)(this,void 0,void 0,(function*(){const t=yield G.PDFDocument.create();for(const o of e){const e=yield G.PDFDocument.load(o);(yield t.copyPages(e,e.getPageIndices())).forEach(e=>{t.addPage(e)})}const i=yield t.save(),l=new Blob([i],{type:"application/pdf"}),n=window.URL.createObjectURL(l);window.open(n)}))}downloadReport(e){let t=[],i=[],l="",n="";const o=Array.from(new Set(e.billMasters.map(e=>e.billNumber))),a=Array.from(new Set(e.billMasters.map(e=>e.unitNumber)));o&&o.length&&o.forEach(e=>{l+=e+","}),a&&a.length&&a.forEach(e=>{n+=e+","}),i.push({label:"Receipt Number:",value:e.paymentNumber},{label:"Receipt Date:",value:e.paymentDateLocal},{label:"Account Number:",value:e.accountNumber},{label:"Invoice Number:",value:0===l.trim().indexOf(",")?l.trim().slice(1).slice(0,-1):l.trim().slice(0,-1)},{label:"Unit Number:",value:0===n.trim().indexOf(",")?n.trim().slice(1).slice(0,-1):n.trim().slice(0,-1)},{label:"Mode of payment:",value:e.paymentMode});let s=0;e.billMasters.forEach(e=>{s+=e.paid});const r=e.outStandingAmount-s;t.push({label:"Total Outstanding Amount :",value:this.currency.transform(e.outStandingAmount,this.currencyFormat.toString(),!0,this.roundOffFormat)},{label:"Received Payments :",value:e.paymentAmountLocal},{label:"",value:""},{label:"Balance Outstanding :",value:this.currency.transform(r,this.currencyFormat.toString(),!0,this.roundOffFormat)}),this.getReport(e,t,i)}addImage(e,t){var i;try{if(t&&t.billMasters&&t.billMasters.length&&t.billMasters[0]&&t.billMasters[0].client&&t.billMasters[0].client.imageProperties&&t.billMasters[0].client.imageProperties.length){const n=t.billMasters[0].client.imageProperties.find(e=>"receipt"===e.imageType.trim().toLowerCase());if(n){var l=new Image;l.src=this.filePath+"/uploads/"+(null===(i=null==t?void 0:t.billMasters[0].client)||void 0===i?void 0:i.photo),l.onload=function(){e.addImage(l,n.imgX,n.imgY,n.imgW,n.imgH)}}else this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar")}else this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar")}catch(n){this.notificationMessage("Image not found.","red-snackbar")}return e}getReport(e,t,i){var l,n,o,a,s,r,c,u,d,m,h,p,f,g,v,y,C,S,T,P,D,w,N,x,A,F,R,k,I,O,W,M,L,B,z,U,E,j,H,Y,V,_,G,X,$,q;let J=new fe.default({orientation:"portrait",unit:"pt",format:"letter"}),Q=Object(b.f)(null===(n=null===(l=null==e?void 0:e.billMasters[0])||void 0===l?void 0:l.client)||void 0===n?void 0:n.website).split(".")[1];J.rect(5,5,J.internal.pageSize.width-10,J.internal.pageSize.height-10,"S");let K=30;J.setFontSize(30),this.addImage(J,e),J.setTextColor(0,0,0),J.setFontSize(14),J.setFont("Cambria","bold"),J.text("CANCELLED PAYMENT RECEIPT",190,K),J.setFont("Cambria","normal"),J.setFontSize(14),K=37,J.text(Object(b.f)(null===(a=null===(o=null==e?void 0:e.billMasters[0])||void 0===o?void 0:o.client)||void 0===a?void 0:a.clientName).toUpperCase(),10,K+20),K=44,J.setFontSize(10),J.text("TRN: "+Object(b.f)(null===(r=null===(s=null==e?void 0:e.billMasters[0])||void 0===s?void 0:s.client)||void 0===r?void 0:r.trnNo),10,K+30),J.text("PO Box "+Object(b.f)(null===(d=null===(u=null===(c=null==e?void 0:e.billMasters[0])||void 0===c?void 0:c.client)||void 0===u?void 0:u.addresses[0])||void 0===d?void 0:d.zipPostalCode),10,K+40),J.text(Object(b.f)(null===(p=null===(h=null===(m=null==e?void 0:e.billMasters[0])||void 0===m?void 0:m.client)||void 0===h?void 0:h.addresses[0])||void 0===p?void 0:p.location,",")+Object(b.f)(null===(v=null===(g=null===(f=null==e?void 0:e.billMasters[0])||void 0===f?void 0:f.client)||void 0===g?void 0:g.addresses[0])||void 0===v?void 0:v.city,",")+Object(b.f)(null===(S=null===(C=null===(y=null==e?void 0:e.billMasters[0])||void 0===y?void 0:y.client)||void 0===C?void 0:C.addresses[0])||void 0===S?void 0:S.country,","),10,K+50),J.text("Phone: "+Object(b.f)(null===(P=null===(T=null==e?void 0:e.billMasters[0])||void 0===T?void 0:T.client)||void 0===P?void 0:P.phoneNo),10,K+60),J.text("Email: "+Object(b.f)(null===(w=null===(D=null==e?void 0:e.billMasters[0])||void 0===D?void 0:D.client)||void 0===w?void 0:w.email),10,K+70),J.text("Web: "+Object(b.f)(null===(x=null===(N=null==e?void 0:e.billMasters[0])||void 0===N?void 0:N.client)||void 0===x?void 0:x.website),10,K+80),J.setFillColor(241,241,244),J.setDrawColor(206,203,203),J.rect(10,K+90,250,90,"FD"),J.setTextColor(0,0,0),J.setFontSize(12),J.text(Object(b.f)(null==e?void 0:e.tenantName).toUpperCase(),20,K+105),J.setFontSize(11),J.text("CUSTOMER TRN: "+Object(b.f)(null==e?void 0:e.trn),20,K+125),J.text("unit #"+Object(b.f)(null===(A=null==e?void 0:e.billMasters[0])||void 0===A?void 0:A.unitNumber),20,K+140),J.setFontSize(10),J.text(Object(b.f)(null===(F=null==e?void 0:e.billMasters[0])||void 0===F?void 0:F.clientName),20,K+155),J.text(Object(b.f)(null===(k=null===(R=null==e?void 0:e.billMasters[0].client)||void 0===R?void 0:R.addresses[0])||void 0===k?void 0:k.city,",")+Object(b.f)(null===(W=null===(O=null===(I=null==e?void 0:e.billMasters[0])||void 0===I?void 0:I.client)||void 0===O?void 0:O.addresses[0])||void 0===W?void 0:W.country,","),20,K+170),J.setFontSize(9),J.autoTable("",i,{startX:210,startY:K+90,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:400},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:100,halign:"right"}},didParseCell:function(e){const t=e.column.index;0!=t&&1!=t||(e.cell.styles.rowHeight=1)},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});const Z=Number(this.decimalPipe.transform(J.autoTable.previous.finalY,"1.0-0"));J.setLineWidth(.1),J.line(5,Z+10,607,Z+10),J.setTextColor(0,0,0),J.setFontSize(10),J.text("Thank you for using "+Q+" payment services.",20,Z+30),J.text("We confirm receipt of your payment.",20,Z+40),J.text("Please see the below details for your reference.",20,Z+50),J.setTextColor(0,0,0),J.autoTable("",t,{startX:300,startY:Z+60,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:110},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:180,halign:"left"},1:{cellWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"}}),J.setTextColor(0,0,0);const ee=Number(this.decimalPipe.transform(J.autoTable.previous.finalY,"1.0-0"));J.setTextColor(255,0,0),J.setFontSize(9),J.text(`Note: A Late Fee will be applied after the due date. A Default Payment \nPenalty will be added to any unit that is ${null===(M=null==e?void 0:e.billMasters[0])||void 0===M?void 0:M.penaltyAfter} days or more in arrears.`,320,ee+20),J.setTextColor(25,118,210),J.setFontSize(12),J.text("USAGE TIPS to reduce consumption:",10,ee+80),J.text("Please Try to:",10,ee+100),J.setTextColor(0,0,0),J.setFontSize(9),J.text("- Keep filters clean",30,ee+110),J.text("- Set thermostats between 23C and 25C",30,ee+120),J.text("- Keep vents unblocked",30,ee+130),J.text("- Keep doors and windows closed",30,ee+140),J.text("- Undertake regular maintenance of the system",30,ee+150),J.setTextColor(25,118,210),J.setFontSize(12),J.text("Please Do Not:",10,ee+170),J.setTextColor(0,0,0),J.setFontSize(9),J.text("- Set thermostats to 20C or lower",30,ee+180),J.text("- Block vents",30,ee+190),J.text("- Leave doors and windows open",30,ee+200),J.text("- Leave heat producing appliances near thermostats",30,ee+210),J.setFillColor(119,183,11);var te=J.internal.pageSize.height||J.internal.pageSize.getHeight();J.rect(320,ee+60,280,te-80-(ee+60),"FD"),J.setFont("Comic Sans"),J.setTextColor(255,255,255),J.setFontSize(16),J.text("ADVERTISE WITH US",360,ee+80);const ie=J.getTextWidth("ADVERTISE WITH US");J.setLineWidth(.1),J.line(360,ee+85,360+ie,ee+85),J.setFontSize(9),J.text("For advertisement, contact at",390,ee+95),J.text(Object(b.f)(null===(B=null===(L=null==e?void 0:e.billMasters[0])||void 0===L?void 0:L.client)||void 0===B?void 0:B.phoneNo),390,ee+105),J.text(Object(b.f)(null===(U=null===(z=null==e?void 0:e.billMasters[0])||void 0===z?void 0:z.client)||void 0===U?void 0:U.email),390,ee+115),J.text(Object(b.f)(null===(j=null===(E=null==e?void 0:e.billMasters[0])||void 0===E?void 0:E.client)||void 0===j?void 0:j.website),390,ee+125),J.setTextColor(0,0,0),J.setLineWidth(.1),J.line(5,te-70,607,te-70),J.text(null!==(X=null!==(V="For any enquiries, write to us "+(null===(Y=null===(H=null==e?void 0:e.billMasters[0])||void 0===H?void 0:H.client)||void 0===Y?void 0:Y.email))&&void 0!==V?V:"\n or Logon to "+(null===(G=null===(_=e.billMasters[0])||void 0===_?void 0:_.client)||void 0===G?void 0:G.website))&&void 0!==X?X:"",10,te-60),J.setTextColor(255,0,0),J.setFont("bold");const le=J.getTextWidth("Notice:");J.text("Notice:",330,te-60),J.setFont("none"),J.setTextColor(0,0,0),J.text("Pay your bills before due date to avoid late payment surcharge",330+le,te-60),J.text("and disconnection.",330,te-50),J.text("You can log onto "+(null===(q=null===($=null==e?void 0:e.billMasters[0])||void 0===$?void 0:$.client)||void 0===q?void 0:q.website)+" to pay your invoices \nTerms & Conditions for Supply of Utility Services",330,te-40),"function"==typeof J.putTotalPages&&J.putTotalPages("1");var ne=J.output("datauristring");this.pdfsToMerge.push(ne)}notificationMessage(e,t){this.snackbar.open(e,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[t]})}onSendEmail(){this.selectedRows&&this.templateService.emailReceiptTemplate(this.selectedRows).subscribe(e=>{})}onSelectedRows(e){this.selectedRows=[],this.selectedRows=e}}return e.\u0275fac=function(t){return new(t||e)(m.Nb(c.a),m.Nb(F.a),m.Nb(a.f),m.Nb(a.d),m.Nb(a.g),m.Nb(C.a),m.Nb(k.b),m.Nb(_.a),m.Nb(pe.a),m.Nb(p.a))},e.\u0275cmp=m.Hb({type:e,selectors:[["app-payment-history-cancel"]],decls:27,vars:12,consts:[["mode","card",2,"margin-top","20px"],["fxLayout","column"],["color","primary",1,"position-fixed"],["src","assets/img/fav-icon.png",1,"img-style"],[1,"toolbar-spacer"],["matTooltip","Print","mat-icon-button","","aria-label","Example icon-button with menu icon",1,"example-icon",3,"click"],["fxFlex","noshrink","fxLayout","column","fxLayout.gt-sm","row","fxLayoutAlign.gt-sm","start stretch",3,"fxLayoutGap"],["fxFlex","grow",1,"basic-forms","route-animations-elements",3,"fxFlex.gt-sm"],["fxLayout","column",1,"result"],[3,"paymentModes","searchClicked"],["fxLayout","column",1,"padding"],[3,"tableData","columnsToDisplay","innerDisplayedColumns","columnNames","innerTableName","hideHeader","selectedRows","printDataRow"],["fxLayout.gt-sm","row","fxLayout","column","fxLayoutAlign","end end","fxLayoutGap.gt-sm","12px",1,"result"],["color","primary",1,"result"],["type","text","id","billAmount","name","billAmount","matInput","",2,"text-align","right",3,"ngModel","ngModelChange"],["type","text","id","receivedAmount","name","receivedAmount","matInput","",2,"text-align","right",3,"ngModel","ngModelChange"]],template:function(e,t){1&e&&(m.Tb(0,"fury-page-layout",0),m.Tb(1,"fury-page-layout-content",1),m.Tb(2,"mat-toolbar",2),m.Ob(3,"img",3),m.Tb(4,"span"),m.Rc(5,"Payment Cancel History"),m.Sb(),m.Ob(6,"span",4),m.Tb(7,"button",5),m.bc("click",(function(){return t.onPrintPdf()})),m.Tb(8,"mat-icon"),m.Rc(9,"print"),m.Sb(),m.Sb(),m.Sb(),m.Tb(10,"div",6),m.Tb(11,"fury-card",7),m.Ob(12,"fury-card-header"),m.Tb(13,"fury-card-content",1),m.Tb(14,"div",8),m.Tb(15,"app-payment-history-toolbar",9),m.bc("searchClicked",(function(e){return t.onGetPaymentHistory(e)})),m.Sb(),m.Sb(),m.Tb(16,"div",10),m.Tb(17,"fury-expandable-table-structure",11),m.bc("selectedRows",(function(e){return t.onSelectedRows(e)}))("printDataRow",(function(e){return t.downloadReport(e)})),m.Sb(),m.Sb(),m.Tb(18,"div",12),m.Tb(19,"mat-form-field",13),m.Tb(20,"mat-label"),m.Rc(21,"Bill Amount"),m.Sb(),m.Tb(22,"input",14),m.bc("ngModelChange",(function(e){return t.billAmount=e})),m.Sb(),m.Sb(),m.Tb(23,"mat-form-field",13),m.Tb(24,"mat-label"),m.Rc(25,"Received Amount"),m.Sb(),m.Tb(26,"input",15),m.bc("ngModelChange",(function(e){return t.receivedAmount=e})),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb()),2&e&&(m.Cb(10),m.mc("fxLayoutGap",t.gap),m.Cb(1),m.mc("fxFlex.gt-sm",t.col2)("@fadeInUp",void 0),m.Cb(4),m.mc("paymentModes",t.paymentModes),m.Cb(2),m.mc("tableData",t.payments)("columnsToDisplay",t.columns)("innerDisplayedColumns",t.innerColumns)("columnNames",t.columnNames)("innerTableName",t.innerTableName)("hideHeader",!1),m.Cb(5),m.mc("ngModel",t.billAmount),m.Cb(4),m.mc("ngModel",t.receivedAmount))},directives:[X.a,$.a,S.d,q.a,P.a,D.a,w.a,S.b,S.c,S.e,f.a,f.d,f.c,ti,T.a,I.d,I.h,W.b,l.c,l.q,l.t],styles:[".padding[_ngcontent-%COMP%]{padding:0 0 24px}.toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.img-style[_ngcontent-%COMP%]{width:32px}.position-fixed[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;top:0;z-index:5}"],data:{animation:[d.a,u.a]}}),e})(),Pi=(()=>{class e{constructor(e){var t,i,l;this.envService=e,this.columns=[],this.innerColumns=[],this.columnNames=[],this.failedBills=[],this.selectedRows=[],this.innerTableName="bills",this.banks=[],this.paymentModes=[],this.isHide=!0,this.format="",this.currency="",this.roundFormat="",this.hideHeader=!0,this.saveClicked=new m.o,this.rowsSelected=new m.o,this.slNumberColumnName="Sl No.",this.unitNumberCoulmnName="Unit Number",this.deviceNameCoulmnName="Device Name",this.consumptionCoulmnName="First Consumption",this.unitAverageColumnName="Average Consumption",this.differenceColumnName="Difference",this.differencePercenatgeColumnName="Difference [%]",this.format=null!==(t=Object(b.e)("DateFormat"))&&void 0!==t?t:e.dateFormat,this.currency=null!==(i=Object(b.e)("Currency"))&&void 0!==i?i:e.currencyFormat,this.roundFormat=null!==(l=Object(b.e)("RoundOff"))&&void 0!==l?l:e.roundOffFormat}set content(e){this.sort=e,this.sort&&this.dataSource&&(this.dataSource.sort=this.sort)}set dataSource(e){e&&e.length&&(this.failedBills=e)}ngOnInit(){this.createGridColumns(),this.updateTableColumns()}createGridColumns(){this.columns=[{name:"Checkbox",property:"checkbox",visible:!0},{name:this.slNumberColumnName,property:"id",visible:!0,isModelProperty:!0},{name:this.unitNumberCoulmnName,property:"unitNumber",visible:!0,isModelProperty:!0},{name:this.deviceNameCoulmnName,property:"deviceName",visible:!0,isModelProperty:!0},{name:this.consumptionCoulmnName,property:"consumptionLocal",visible:!0,isModelProperty:!0,columnAlign:{"text-align":"right"}},{name:this.unitAverageColumnName,property:"averageConsumptionLocal",visible:!0,isModelProperty:!0,columnAlign:{"text-align":"right"}},{name:this.differenceColumnName,property:"consumptionDifferenceLocal",visible:!0,isModelProperty:!0,columnAlign:{"text-align":"right"}},{name:this.differencePercenatgeColumnName,property:"consumptionDifferencePercentageLocal",visible:!0,isModelProperty:!0,icon:"status",columnAlign:{"text-align":"right"}}]}get visibleColumns(){return this.columns.filter(e=>e.visible).map(e=>e.property)}updateTableColumns(){this.columns.splice(0,1)}onSelectedRows(e){this.selectedRows=[],this.selectedRows=e,this.rowsSelected.emit(this.selectedRows)}updateDataFormats(e){return e&&e.forEach(e=>{}),e}}return e.\u0275fac=function(t){return new(t||e)(m.Nb(p.a))},e.\u0275cmp=m.Hb({type:e,selectors:[["fury-bill-consumption-details"]],viewQuery:function(e,t){var i;1&e&&(m.Jc(yt.a,!0),m.Vc(Ct.a,!0)),2&e&&(m.zc(i=m.cc())&&(t.paginator=i.first),m.zc(i=m.cc())&&(t.content=i.first))},inputs:{banks:"banks",paymentModes:"paymentModes",isHide:"isHide",dataSource:"dataSource",hideHeader:"hideHeader"},outputs:{saveClicked:"saveClicked",rowsSelected:"rowsSelected"},decls:5,vars:4,consts:[[1,"person"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","24px"],["fxFlex","",1,"fury-flex-form-field"],[3,"tableData","columns","buttonVisible","hideHeader","selectedRows"]],template:function(e,t){1&e&&(m.Tb(0,"mat-dialog-content"),m.Tb(1,"div",0),m.Tb(2,"div",1),m.Tb(3,"div",2),m.Tb(4,"app-table-structure",3),m.bc("selectedRows",(function(e){return t.onSelectedRows(e)})),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb()),2&e&&(m.Cb(4),m.mc("tableData",t.failedBills)("columns",t.columns)("buttonVisible",!1)("hideHeader",t.hideHeader))},directives:[h.f,S.d,S.e,S.b,g.a],styles:[""]}),e})();var Di=i("xXXn");function wi(e,t){if(1&e&&(m.Tb(0,"mat-option",13),m.Rc(1),m.Sb()),2&e){const e=t.$implicit;m.mc("value",e.value),m.Cb(1),m.Tc("",e.label," ")}}function Ni(e,t){1&e&&(m.Tb(0,"mat-hint",14),m.Rc(1," Select Consumption Type"),m.Sb())}function xi(e,t){if(1&e&&(m.Tb(0,"mat-option",13),m.Rc(1),m.Sb()),2&e){const e=t.$implicit;m.mc("value",e.value),m.Cb(1),m.Tc("",e.label," ")}}function Ai(e,t){1&e&&(m.Tb(0,"mat-hint",14),m.Rc(1,"Select Utility Type"),m.Sb())}function Fi(e,t){1&e&&(m.Tb(0,"mat-label"),m.Rc(1,"Bill Period"),m.Sb())}function Ri(e,t){1&e&&(m.Tb(0,"mat-label"),m.Rc(1,"Bill Period to compare"),m.Sb())}function ki(e,t){if(1&e&&(m.Tb(0,"mat-option",13),m.Rc(1),m.Sb()),2&e){const e=t.$implicit;m.mc("value",e.value),m.Cb(1),m.Tc("",e.label," ")}}function Ii(e,t){1&e&&(m.Tb(0,"mat-hint",14),m.Rc(1," Select Bill Period to compare"),m.Sb())}function Oi(e,t){if(1&e&&(m.Tb(0,"mat-option",13),m.Rc(1),m.Sb()),2&e){const e=t.$implicit;m.mc("value",e.value),m.Cb(1),m.Tc("",e.label," ")}}function Wi(e,t){1&e&&(m.Tb(0,"mat-hint",14),m.Rc(1," Select Bill Period To be compared with"),m.Sb())}function Mi(e,t){if(1&e){const e=m.Ub();m.Tb(0,"mat-form-field",3),m.Tb(1,"mat-label"),m.Rc(2,"Bill Period To be compared with"),m.Sb(),m.Tb(3,"mat-select",21),m.bc("selectionChange",(function(t){return m.Ec(e),m.fc(2).onChangeToBillPeriod(t)})),m.Pc(4,Oi,2,2,"mat-option",5),m.Sb(),m.Pc(5,Wi,2,0,"mat-hint",6),m.Sb()}if(2&e){const e=m.fc(2);m.Cb(4),m.mc("ngForOf",e.billPeriods),m.Cb(1),m.mc("ngIf",!e.billPeriodForm.controls.toBillPeriodId.value||0==e.billPeriodForm.controls.toBillPeriodId.value)}}function Li(e,t){if(1&e){const e=m.Ub();m.Tb(0,"mat-form-field",3),m.Tb(1,"mat-label"),m.Rc(2,"Threshold [%]"),m.Sb(),m.Tb(3,"input",22),m.bc("ngModelChange",(function(t){return m.Ec(e),m.fc(2).percentageBillPeriod=t})),m.Sb(),m.Sb()}if(2&e){const e=m.fc(2);m.Cb(3),m.mc("ngModel",e.percentageBillPeriod)}}function Bi(e,t){if(1&e){const e=m.Ub();m.Tb(0,"div"),m.Tb(1,"div",1),m.Tb(2,"form",0),m.Tb(3,"div",15),m.Tb(4,"div",2),m.Tb(5,"mat-form-field",3),m.Pc(6,Fi,2,0,"mat-label",11),m.Pc(7,Ri,2,0,"mat-label",11),m.Tb(8,"mat-select",16),m.bc("selectionChange",(function(t){return m.Ec(e),m.fc().onChangeFromBillPeriod(t)})),m.Pc(9,ki,2,2,"mat-option",5),m.Sb(),m.Pc(10,Ii,2,0,"mat-hint",6),m.Sb(),m.Pc(11,Mi,6,2,"mat-form-field",17),m.Pc(12,Li,4,1,"mat-form-field",17),m.Tb(13,"div",3),m.Tb(14,"button",18),m.bc("click",(function(){return m.Ec(e),m.fc().onSearch("BillPeriod")})),m.Tb(15,"mat-icon"),m.Rc(16,"compare"),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Tb(17,"div",19),m.Tb(18,"div",15),m.Tb(19,"app-table-structure",20),m.bc("deleteRow",(function(t){return m.Ec(e),m.fc().onDeleteRow(t)})),m.Sb(),m.Sb(),m.Sb(),m.Sb()}if(2&e){const e=m.fc();m.Cb(2),m.mc("formGroup",e.billPeriodForm),m.Cb(4),m.mc("ngIf","Zero Consumption"===e.consumptionType),m.Cb(1),m.mc("ngIf","Zero Consumption"!==e.consumptionType),m.Cb(2),m.mc("ngForOf",e.billPeriods),m.Cb(1),m.mc("ngIf",!e.billPeriodForm.controls.fromBillPeriodId.value||0==e.billPeriodForm.controls.fromBillPeriodId.value),m.Cb(1),m.mc("ngIf","Zero Consumption"!==e.consumptionType),m.Cb(1),m.mc("ngIf","Zero Consumption"!==e.consumptionType),m.Cb(2),m.mc("disabled",e.disableBillPeriod),m.Cb(5),m.mc("visibleDeleteButton",!0)("tableData",e.consumptionAlerts)("columns",e.columns)("hideHeader",!0)}}function zi(e,t){1&e&&(m.Tb(0,"mat-hint",14),m.Rc(1,"Select Date to compare with"),m.Sb())}function Ui(e,t){1&e&&(m.Tb(0,"mat-hint",14),m.Rc(1,"Select Average consumption From"),m.Sb())}function Ei(e,t){1&e&&(m.Tb(0,"mat-hint",14),m.Rc(1,"Select Average consumption To"),m.Sb())}const ji=function(){return{standalone:!0}};function Hi(e,t){if(1&e){const e=m.Ub();m.Tb(0,"div",1),m.Tb(1,"div",2),m.Tb(2,"mat-form-field"),m.Tb(3,"mat-label"),m.Rc(4,"Date to compare with "),m.Sb(),m.Tb(5,"input",23),m.bc("click",(function(){return m.Ec(e),m.Ac(8).open()}))("ngModelChange",(function(t){return m.Ec(e),m.fc().fromDate=t}))("focus",(function(){return m.Ec(e),m.Ac(8).open()})),m.Sb(),m.Ob(6,"mat-datepicker-toggle",24),m.Ob(7,"mat-datepicker",null,25),m.Pc(9,zi,2,0,"mat-hint",6),m.Sb(),m.Tb(10,"mat-form-field"),m.Tb(11,"mat-label"),m.Rc(12,"Average consumption From"),m.Sb(),m.Tb(13,"input",26),m.bc("click",(function(){return m.Ec(e),m.Ac(16).open()}))("ngModelChange",(function(t){return m.Ec(e),m.fc().startDate=t}))("focus",(function(){return m.Ec(e),m.Ac(16).open()})),m.Sb(),m.Ob(14,"mat-datepicker-toggle",24),m.Ob(15,"mat-datepicker",null,27),m.Pc(17,Ui,2,0,"mat-hint",6),m.Sb(),m.Tb(18,"mat-form-field"),m.Tb(19,"mat-label"),m.Rc(20,"Average consumption To"),m.Sb(),m.Tb(21,"input",28),m.bc("click",(function(){return m.Ec(e),m.Ac(24).open()}))("ngModelChange",(function(t){return m.Ec(e),m.fc().endDate=t}))("focus",(function(){return m.Ec(e),m.Ac(24).open()})),m.Sb(),m.Ob(22,"mat-datepicker-toggle",24),m.Ob(23,"mat-datepicker",null,29),m.Pc(25,Ei,2,0,"mat-hint",6),m.Sb(),m.Tb(26,"mat-form-field",30),m.Tb(27,"mat-label"),m.Rc(28,"Threshold"),m.Sb(),m.Tb(29,"input",31),m.bc("ngModelChange",(function(t){return m.Ec(e),m.fc().percentageDatewise=t})),m.Sb(),m.Sb(),m.Tb(30,"button",18),m.bc("click",(function(){return m.Ec(e),m.fc().onSearch("DateWise")})),m.Tb(31,"mat-icon"),m.Rc(32,"compare"),m.Sb(),m.Sb(),m.Sb(),m.Sb()}if(2&e){const e=m.Ac(8),t=m.Ac(16),i=m.Ac(24),l=m.fc();m.Cb(5),m.mc("ngModel",l.fromDate)("matDatepicker",e)("ngModelOptions",m.qc(17,ji)),m.Cb(1),m.mc("for",e),m.Cb(3),m.mc("ngIf",!l.fromDate||""==l.fromDate),m.Cb(4),m.mc("ngModel",l.startDate)("matDatepicker",t)("ngModelOptions",m.qc(18,ji)),m.Cb(1),m.mc("for",t),m.Cb(3),m.mc("ngIf",!l.startDate||""==l.startDate),m.Cb(4),m.mc("ngModel",l.endDate)("matDatepicker",i)("ngModelOptions",m.qc(19,ji)),m.Cb(1),m.mc("for",i),m.Cb(3),m.mc("ngIf",!l.endDate||""==l.endDate),m.Cb(4),m.mc("ngModel",l.percentageDatewise),m.Cb(1),m.mc("disabled",!(l.formValidation(l.form)&&l.startDate&&l.endDate&&l.fromDate))}}let Yi=(()=>{class e{constructor(e,t,i,l,n){this.snackbar=e,this.billSettlementService=t,this.dialog=i,this.cookieService=l,this.fb=n,this.billPeriods=[],this.utilityTypes=[],this.searchClicked=new m.o,this.saveClicked=new m.o,this.disableSave=new m.o,this.percentageDatewise=0,this.toBillPeriod="",this.fromBillPeriod="",this.consumptionType="",this.utilityType="",this.optionId="1",this.consumptionTypes=[{label:"Select",value:0},{label:"High Consumption",value:1},{label:"Low Consumption",value:2},{label:"Zero Consumption",value:3}],this.alertTypeToCompareCoulmnName="Alert Type",this.utilityTypeToCompareCoulmnName="Utility Type",this.billPeriodToCompareCoulmnName="Bill Period To Compare",this.toBeCompareWithCoulmnName="To Be Compared With",this.percentageDifferenceColumnName="Percentage Difference [%]",this.descriptionColumnName="Description",this.columns=[],this.consumptionAlerts=[],this.consumptionAlertRanges=[],this.filterConsumptionAlerts=[],this.consumptionAlertRange={},this.disableBillPeriod=!0,this.disableDatewise=!0}set consumptionRangeDatas(e){let t=[];e&&e.length&&(e.forEach(e=>{let i="";"High Consumption"===e.consumptionType&&(i=`Threshold set for ${e.consumptionType} for the ${e.fromBillPeriod} bill period is ${e.percentage}% .Bill will be considered in failed state if consumption exceeds the ${e.percentage}%`),"Low Consumption"===e.consumptionType&&(i=`Threshold set for ${e.consumptionType} for the ${e.fromBillPeriod} bill period is ${e.percentage}% .Bill will be considered in failed state if consumption is lower than the ${e.percentage}%`),"Zero Consumption"===e.consumptionType&&(i=`Threshold set for ${e.consumptionType} for the ${e.fromBillPeriod} bill period is ${e.percentage}%`),t.push({id:e.id,fromBillPeriod:e.fromBillPeriod,toBillPeriod:e.toBillPeriod,consumptionType:e.consumptionType,utilityType:e.utilityType,percentage:e.percentage,description:i})}),this.filterConsumptionAlerts=this.consumptionAlerts=t)}ngOnInit(){this.clientId=parseInt(this.cookieService.get("globalClientId")),this.createGridColumns(),this.form=this.fb.group({consumptionTypeId:[this.consumptionAlertRange.consumptionTypeId||0,l.y.required],utilityTypeId:[this.consumptionAlertRange.utilityTypeId||0,l.y.required]}),this.billPeriodForm=this.fb.group({fromBillPeriodId:[this.consumptionAlertRange.fromBillPeriodId||0,l.y.required],toBillPeriodId:[this.consumptionAlertRange.toBillPeriodId||0,l.y.required],percentageBillPeriod:[this.consumptionAlertRange.percentage||0]})}onSearch(e){var t;this.enbaleValidators(e)?("BillPeriod"==e&&this.disableSave.emit(!1),this.manageParams="1"==this.optionId?{consumptionTypeId:this.form.controls.consumptionTypeId.value,consumptionType:this.consumptionType,utilityTypeId:this.form.controls.utilityTypeId.value,utilityType:this.utilityType,fromBillPeriodId:this.billPeriodForm.controls.fromBillPeriodId.value,toBillPeriodId:this.billPeriodForm.controls.toBillPeriodId.value,percentage:null!==(t=this.billPeriodForm.controls.percentageBillPeriod.value)&&void 0!==t?t:0}:{consumptionTypeId:this.form.controls.consumptionTypeId.value,consumptionType:this.consumptionType,utilityTypeId:this.form.controls.utilityTypeId.value,utilityType:this.utilityType,fromDate:""+(void 0===this.fromDate?"":R(this.fromDate).format("YYYY-MM-DD")),startDate:""+(void 0===this.startDate?"":R(this.startDate).format("YYYY-MM-DD")),endDate:""+(void 0===this.endDate?"":R(this.endDate).format("YYYY-MM-DD")),percentage:this.percentageDatewise},this.searchClicked.emit(this.manageParams)):"BillPeriod"==e&&this.disableSave.emit(!0)}enbaleValidators(e){let t=!0;return"BillPeriod"==e?this.formValidation(this.form)&&this.formValidation(this.billPeriodForm)||(t=!1):this.formValidation(this.form)&&this.startDate&&this.endDate&&this.fromDate||(t=!1),t}formValidation(e){let t=!0;const i=e.controls;return Object.keys(i).forEach(e=>{!i[e].validator||i[e].value&&0!=i[e].value||(t=!1)}),t}reset(){"1"==this.optionId?(this.fromDate=this.startDate=this.endDate="",this.disableDatewise=!0):(this.billPeriodForm.reset(),this.consumptionAlerts=[],this.disableDatewise=!0)}createGridColumns(){this.columns=[{name:"Id",property:"id",visible:!1,isModelProperty:!1},{name:this.alertTypeToCompareCoulmnName,property:"consumptionType",visible:!0,isModelProperty:!0},{name:this.utilityTypeToCompareCoulmnName,property:"utilityType",visible:!0,isModelProperty:!0},{name:this.billPeriodToCompareCoulmnName,property:"fromBillPeriod",visible:!0,isModelProperty:!0},{name:this.toBeCompareWithCoulmnName,property:"toBillPeriod",visible:!0,isModelProperty:!0},{name:this.percentageDifferenceColumnName,property:"percentage",visible:!0,isModelProperty:!0},{name:this.descriptionColumnName,property:"description",visible:!0,isModelProperty:!0},{name:"Actions",property:"actions",visible:!0,isModelProperty:!1}]}onChangeFromBillPeriod(e){this.fromBillPeriod=e.source.triggerValue,this.dropDownValidation()}onChangeToBillPeriod(e){this.toBillPeriod=e.source.triggerValue,this.dropDownValidation()}onChangeConsumptionType(e){this.consumptionType=e.source.triggerValue,"Zero Consumption"===this.consumptionType&&this.billPeriodForm.get("toBillPeriodId").clearValidators(),this.dropDownValidation()}onChangeUtilityType(e){this.utilityType=e.source.triggerValue,this.dropDownValidation()}dropDownValidation(){this.filter(),this.formValidation(this.form)&&this.formValidation(this.billPeriodForm)?(this.disableBillPeriod=!1,this.disableSave.emit(!1)):(this.disableBillPeriod=!0,this.disableSave.emit(!0))}onSave(){this.saveClicked.emit()}notificationMessage(e,t){this.snackbar.open(e,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[t]})}optionChange(e){this.optionId=e.value,"2"===this.optionId&&this.disableSave.emit(!0),this.reset()}filter(){this.consumptionAlerts=this.filterConsumptionAlerts,this.consumptionAlerts&&this.consumptionAlerts.length&&(this.consumptionType&&(this.consumptionAlerts=this.consumptionAlerts.filter(e=>e.consumptionType==this.consumptionType)),this.utilityType&&(this.consumptionAlerts=this.consumptionAlerts.filter(e=>e.utilityType==this.utilityType)),this.fromBillPeriod&&(this.consumptionAlerts=this.consumptionAlerts.filter(e=>e.fromBillPeriod==this.fromBillPeriod)),this.toBillPeriod&&(this.consumptionAlerts=this.consumptionAlerts.filter(e=>e.toBillPeriod==this.toBillPeriod)))}getConsumptionAlertRanges(){this.consumptionAlerts=[],this.filterConsumptionAlerts=[];const e={clientId:this.clientId};e&&this.billSettlementService.getConsumptioSavedAlertDetails(e).subscribe(e=>{e&&e.length?this.consumptionAlerts=this.filterConsumptionAlerts=e:(this.consumptionAlerts=[],this.filterConsumptionAlerts=[])})}onDeleteRow(e){this.dialog.open(Di.a,{data:{label:"Are you sure you want to Delete?",selected:!1}}).afterClosed().subscribe(t=>{t&&this.billSettlementService.deleteConsumptionAlert(e.id,e).subscribe({next:e=>{e?(this.getConsumptionAlertRanges(),this.notificationMessage("Consumption Alert deleted successfully.","green-snackbar")):this.notificationMessage("Consumption Alert deletion failed.","red-snackbar")},error:e=>{this.notificationMessage("Consumption Alert deletion failed.","red-snackbar")}})})}}return e.\u0275fac=function(t){return new(t||e)(m.Nb(k.b),m.Nb(F.a),m.Nb(h.b),m.Nb(C.a),m.Nb(l.f))},e.\u0275cmp=m.Hb({type:e,selectors:[["fury-bill-consumption-toolbar"]],inputs:{billPeriods:"billPeriods",utilityTypes:"utilityTypes",consumptionRangeDatas:"consumptionRangeDatas"},outputs:{searchClicked:"searchClicked",saveClicked:"saveClicked",disableSave:"disableSave"},decls:24,vars:8,consts:[[3,"formGroup"],[1,"person"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","20px"],["fxFlex",""],["id","consumptionTypeId","name","consumptionTypeId","formControlName","consumptionTypeId",3,"selectionChange"],[3,"value",4,"ngFor","ngForOf"],["class","small",4,"ngIf"],["id","utilityTypeId","name","utilityTypeId","formControlName","utilityTypeId",3,"selectionChange"],["fxLayout","column","fxLayoutGap","12px",3,"value","change"],["value","1"],["value","2"],[4,"ngIf"],["class","person",4,"ngIf"],[3,"value"],[1,"small"],["fxLayout","column","fxLayout.gt-sm","column"],["id","fromBillPeriodId","name","fromBillPeriodId","formControlName","fromBillPeriodId",3,"selectionChange"],["fxFlex","",4,"ngIf"],["mat-icon-button","","matTooltip","Compare","aria-label","Example icon-button with menu icon",1,"example-icon",3,"disabled","click"],[1,"person","topPadding"],[3,"visibleDeleteButton","tableData","columns","hideHeader","deleteRow"],["id","toBillPeriodId","name","toBillPeriodId","formControlName","toBillPeriodId",3,"selectionChange"],["type","number","id","percentageBillPeriod","name","percentageBillPeriod","formControlName","percentageBillPeriod","matInput","",3,"ngModel","ngModelChange"],["id","fromDate","name","fromDate","matInput","","readonly","",3,"ngModel","matDatepicker","ngModelOptions","click","ngModelChange","focus"],["matSuffix","",3,"for"],["formDatepickerRef1",""],["id","startDate","name","startDate","matInput","","readonly","",3,"ngModel","matDatepicker","ngModelOptions","click","ngModelChange","focus"],["formDatepickerRef2",""],["id","endDate","name","endDate","matInput","","readonly","",3,"ngModel","matDatepicker","ngModelOptions","click","ngModelChange","focus"],["formDatepickerRef3",""],[2,"width","100px"],["type","text","id","percentageDatewise","name","percentageDatewise","matInput","",3,"ngModel","ngModelChange"]],template:function(e,t){1&e&&(m.Tb(0,"mat-dialog-content"),m.Tb(1,"form",0),m.Tb(2,"div",1),m.Tb(3,"div",2),m.Tb(4,"mat-form-field",3),m.Tb(5,"mat-label"),m.Rc(6,"Alert Type"),m.Sb(),m.Tb(7,"mat-select",4),m.bc("selectionChange",(function(e){return t.onChangeConsumptionType(e)})),m.Pc(8,wi,2,2,"mat-option",5),m.Sb(),m.Pc(9,Ni,2,0,"mat-hint",6),m.Sb(),m.Tb(10,"mat-form-field",3),m.Tb(11,"mat-label"),m.Rc(12,"Utility Type"),m.Sb(),m.Tb(13,"mat-select",7),m.bc("selectionChange",(function(e){return t.onChangeUtilityType(e)})),m.Pc(14,xi,2,2,"mat-option",5),m.Sb(),m.Pc(15,Ai,2,0,"mat-hint",6),m.Sb(),m.Tb(16,"div",3),m.Tb(17,"mat-radio-group",8),m.bc("change",(function(e){return t.optionChange(e)})),m.Tb(18,"mat-radio-button",9),m.Rc(19,"Compare based on Bill Period"),m.Sb(),m.Tb(20,"mat-radio-button",10),m.Rc(21," Compare based on Date range"),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Pc(22,Bi,20,12,"div",11),m.Pc(23,Hi,33,20,"div",12),m.Sb()),2&e&&(m.Cb(1),m.mc("formGroup",t.form),m.Cb(7),m.mc("ngForOf",t.consumptionTypes),m.Cb(1),m.mc("ngIf",!t.form.controls.consumptionTypeId.value||0==t.form.controls.consumptionTypeId.value),m.Cb(5),m.mc("ngForOf",t.utilityTypes),m.Cb(1),m.mc("ngIf",!t.form.controls.utilityTypeId.value||0==t.form.controls.utilityTypeId.value),m.Cb(2),m.mc("value",t.optionId),m.Cb(5),m.mc("ngIf","1"==t.optionId),m.Cb(1),m.mc("ngIf","2"==t.optionId))},directives:[h.f,l.z,l.r,l.k,S.d,S.e,I.d,S.b,I.h,O.a,l.q,l.i,a.n,a.o,Ce.b,Ce.a,L.n,I.g,P.a,D.a,w.a,g.a,l.u,l.c,W.b,B.b,l.t,B.d,I.j,B.a],styles:[".blank_row[_ngcontent-%COMP%]{height:16px!important}.small[_ngcontent-%COMP%]{color:red}.hidden[_ngcontent-%COMP%]{display:none}.topPadding[_ngcontent-%COMP%]{padding-top:40px}"]}),e})(),Vi=(()=>{class e{constructor(e,t,i,l,n,o,a,s){var r;this.billService=e,this.billSettlementService=t,this.snackbar=i,this.decimalPipe=l,this.datePipe=n,this.clientSelectionService=o,this.cookieService=a,this.envService=s,this._gap=16,this.gap=this._gap+"px",this.col2=`1 1 calc(50% - ${this._gap/2}px)`,this.col3=`1 1 calc(33.3333% - ${this._gap/1.5}px)`,this.billPeriods=[{label:"Select",value:0}],this.utilityTypes=[],this.failedBills=[],this.consumptionAlerts=[],this.isBillPeriodEnabled=!1,this.roundFormat="",this.consumptionRoundOffFormat=Object(b.e)("ConsumptionRoundOff"),this.tableData=[],this.disableSaveButton=!0,this.isData=!1,this.roundFormat=null!==(r=Object(b.e)("RoundOff"))&&void 0!==r?r:s.roundOffFormat}ngOnInit(){this.clientSelectionService.setIsClientVisible(!0),this.clientId=parseInt(this.cookieService.get("globalClientId")),this.getBillPeriods(),this.getUtilities(),this.getConsumptionAlertRanges()}disable(e){this.disableSaveButton=e}getConsumptionAlertRanges(){this.consumptionAlerts=[];const e={clientId:this.clientId};e&&this.billSettlementService.getConsumptioSavedAlertDetails(e).subscribe(e=>{this.consumptionAlerts=e&&e.length?e:[]})}onSearch(e){e?(this.manageParams=e,this.manageParams.clientId=this.clientId,this.billConsumptionDetailsComponent.failedBills=[],this.isData=!1,this.message="",this.consumptionRoundOffFormat=Object(b.e)("ConsumptionRoundOff",parseInt(e.utilityTypeId)),this.consumptionRoundOffFormat&&""!=this.consumptionRoundOffFormat&&(this.consumptiondecimalPlaces=parseInt(this.consumptionRoundOffFormat.substring(this.consumptionRoundOffFormat.indexOf("-")+1,this.consumptionRoundOffFormat.length))),this.billSettlementService.getConumptionAlertDetails(e).subscribe(t=>{if(t&&t.length){let i=0;t.sort((e,t)=>e.unitNumber.localeCompare(t.unitNumber)),t.forEach(e=>{e.id=i+=1,e.consumption=Number(this.decimalPipe.transform(e.consumption,this.consumptionRoundOffFormat.toString()).replace(",","")),e.consumptionLocal=e.consumption.toFixed(this.consumptiondecimalPlaces)+" "+e.consumptionUnit,e.consumptionDifference=Number(this.decimalPipe.transform(e.consumptionDifference,this.consumptionRoundOffFormat.toString()).replace(",","")),e.consumptionDifferenceLocal=e.consumptionDifference.toFixed(this.consumptiondecimalPlaces)+" "+e.consumptionUnit,e.averageConsumption=Number(this.decimalPipe.transform(e.averageConsumption,this.consumptionRoundOffFormat.toString()).replace(",","")),e.averageConsumptionLocal=e.averageConsumption.toFixed(this.consumptiondecimalPlaces)+" "+e.consumptionUnit,e.consumptionDifferencePercentageLocal=e.consumptionDifferencePercentage.toFixed(this.consumptiondecimalPlaces)}),this.billConsumptionDetailsComponent.failedBills=t,this.isData=!0,this.message=e.consumptionType+" of "+e.utilityType+" in comparison with "+e.percentage+"% buffer"}else this.billConsumptionDetailsComponent.failedBills=[],this.isData=!1})):this.notificationMessage("Invalid Parameters.","yellow-snackbar")}toggleBillPeriodEnabled(e){this.isBillPeriodEnabled=e.checked||!1}getBillPeriods(){this.billPeriods=[{label:"Select",value:0,fromDate:"",ToDate:""}],this.billService.getBillPeriods(this.clientId).subscribe(e=>{e.forEach(e=>{this.billPeriods.push({label:e.periodDescription,value:e.id,fromDate:e.periodStart,toDate:e.periodEnd})})})}getUtilities(){this.utilityTypes=[{label:"Select",value:0}],this.billService.getUtilities(this.clientId).subscribe(e=>{e&&e.forEach(e=>{this.utilityTypes.push({label:e.description,value:e.id})})})}onReset(){this.billConsumptionToolbarComponent.form.reset(),this.billConsumptionToolbarComponent.billPeriodForm.reset(),this.billConsumptionDetailsComponent.failedBills=[],this.billConsumptionToolbarComponent.form.controls.consumptionTypeId.setValue(0),this.billConsumptionToolbarComponent.form.controls.utilityTypeId.setValue(0),this.billConsumptionToolbarComponent.billPeriodForm.controls.fromBillPeriodId.setValue(0),this.billConsumptionToolbarComponent.billPeriodForm.controls.toBillPeriodId.setValue(0),this.getConsumptionAlertRanges()}onSave(){const e=this.billConsumptionToolbarComponent.form.controls.consumptionTypeId.value,t=this.billConsumptionToolbarComponent.form.controls.utilityTypeId.value;let i=0,l=0,n=0,o=null,a=null,s=null;if("1"==this.billConsumptionToolbarComponent.optionId?(i=this.billConsumptionToolbarComponent.billPeriodForm.controls.fromBillPeriodId.value,l=this.billConsumptionToolbarComponent.billPeriodForm.controls.toBillPeriodId.value,n=this.billConsumptionToolbarComponent.billPeriodForm.controls.percentageBillPeriod.value):(o=new Date(this.datePipe.transform(this.billConsumptionToolbarComponent.fromDate,"yyyy-MM-dd")),a=new Date(this.datePipe.transform(this.billConsumptionToolbarComponent.startDate,"yyyy-MM-dd")),s=new Date(this.datePipe.transform(this.billConsumptionToolbarComponent.endDate,"yyyy-MM-dd")),n=this.billConsumptionToolbarComponent.percentageDatewise),e&&t){const r={consumptionTypeId:Number(e),utilityTypeId:Number(t),fromBillPeriodId:Number(i),toBillPeriodId:Number(l),fromDate:o,startDate:a,endDate:s,percentage:Number(null!=n?n:0),clientId:Number(this.clientId)};this.billSettlementService.saveConsumptionRange(r).subscribe({next:e=>{e?(this.notificationMessage("Consumption range saved successfully","green-snackbar"),this.onReset()):this.notificationMessage("Consumption range save failed","red-snackbar")},error:e=>{this.notificationMessage("Consumption range save failed","red-snackbar")}})}}notificationMessage(e,t){this.snackbar.open(e,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[t]})}onPrintSummary(){this.billConsumptionDetailsComponent.failedBills.length>0&&this.downloadSummary(this.billConsumptionDetailsComponent.failedBills)}downloadSummary(e){let t=[],i=[];for(let l=0;l<e.length;l++)t.push(e[l].unitNumber),t.push(e[l].consumptionLocal),t.push(e[l].averageConsumptionLocal),t.push(e[l].consumptionDifferenceLocal),t.push(e[l].consumptionDifferencePercentageLocal),i.push(t),t=[];this.getSummaryReport(e,["Unit Number","First Consumption","Second Consumption","Difference","Difference %"],i,"Consumption Alert Report")}getSummaryReport(e,t,i,l){var n=new Image;n.src="assets/img/logo.png";let o=new fe.default({orientation:"portrait",unit:"pt",format:"letter"});o.rect(5,5,o.internal.pageSize.width-10,o.internal.pageSize.height-10,"S"),o.setFontSize(30),o.addImage(n,"png",5,5,190,n.height),o.setTextColor(25,118,210),o.setFontSize(9),o.setFont("Cambria"),o.text("PO Box 127404",260,20),o.text("Office 201, Al Zarouni Business Centre",260,30),o.text("Al Barsha 1, Dubai, UAE",260,40),o.setTextColor(0,0,0),o.text("Phone:800 Logic (56442)",460,20),o.text("Email: ",460,30),o.setTextColor(25,118,210),o.text("enquiry@logicutilities.com",485,30),o.setTextColor(0,0,0),o.text("Web: ",460,40),o.setTextColor(25,118,210),o.text("www.logicutilities.com",485,40),o.setTextColor(0,0,0),o.setFontSize(12),o.setTextColor(25,118,210),o.text("Logic Utilities District Cooling Services LLC",10,70),o.text("TRN: 100567483100003",10,90),o.setTextColor(0,0,0),o.setFontSize(14),o.text("Consumption Alert Report for "+this.message,50,120),o.setFontSize(9),Number(o.autoTable.previous.finalY),o.autoTable(t,i,{startX:10,startY:140,didDrawPage:function(e){var t="Page "+e.pageCount;"function"==typeof o.putTotalPages&&(t+=" of 1"),o.setFontSize(9);var i=o.internal.pageSize.height||o.internal.pageSize.getHeight();o.text(t,e.settings.margin.left,i-10)},styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:280,left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:110,halign:"center"},1:{cellWidth:110,halign:"center"},2:{cellWidth:110,halign:"center"},3:{cellWidth:110,halign:"center"},4:{cellWidth:110,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]}});var a=o.output("blob");window.open(URL.createObjectURL(a))}getJsonData(){this.tableData=[],null!=this.billConsumptionDetailsComponent.failedBills&&this.billConsumptionDetailsComponent.failedBills.forEach(e=>{this.tableData.push({UnitNumber:e.unitNumber,Consumption:e.consumptionLocal,UnitAverage:e.averageConsumptionLocal,Difference:e.consumptionDifferenceLocal,DifferencePercentage:e.consumptionDifferencePercentageLocal})})}onExport(){if(this.billConsumptionDetailsComponent.failedBills&&this.billConsumptionDetailsComponent.failedBills.length>0){if(this.getJsonData(),null!=this.tableData){const e=vt.utils.json_to_sheet(this.tableData),t=vt.utils.book_new();vt.utils.book_append_sheet(t,e,"Sheet1"),vt.writeFile(t,"Consumption Alert Report.xlsx")}}else this.notificationMessage("No Data to Export","yellow-snackbar")}}return e.\u0275fac=function(t){return new(t||e)(m.Nb(c.a),m.Nb(F.a),m.Nb(k.b),m.Nb(a.g),m.Nb(a.f),m.Nb(_.a),m.Nb(C.a),m.Nb(p.a))},e.\u0275cmp=m.Hb({type:e,selectors:[["fury-bill-consumption"]],viewQuery:function(e,t){var i;1&e&&(m.Jc(Pi,!0),m.Jc(Yi,!0)),2&e&&(m.zc(i=m.cc())&&(t.billConsumptionDetailsComponent=i.first),m.zc(i=m.cc())&&(t.billConsumptionToolbarComponent=i.first))},decls:28,vars:10,consts:[["mode","card",2,"margin-top","20px"],["fxLayout","column"],["color","primary",1,"position-fixed"],["src","assets/img/fav-icon.png",1,"img-style"],[1,"toolbar-spacer"],[1,"fury-flex-form-field"],["matTooltip","Reset","mat-icon-button","","aria-label","Example icon-button with menu icon",1,"example-icon",3,"click"],["matTooltip","Save","mat-icon-button","","aria-label","Example icon-button with menu icon",1,"example-icon",3,"disabled","click"],["matTooltip","Print","mat-icon-button","","aria-label","Example icon-button with menu icon",1,"example-icon",3,"disabled","click"],["matTooltip","Export","mat-icon-button","","aria-label","Example icon-button with menu icon",1,"example-icon",3,"click"],["fxFlex","noshrink","fxLayout","column","fxLayout.gt-sm","row","fxLayoutAlign.gt-sm","start stretch",3,"fxLayoutGap"],["fxFlex","grow",1,"basic-forms","route-animations-elements",3,"fxFlex.gt-sm"],["fxLayout","column",1,"result"],[3,"billPeriods","utilityTypes","consumptionRangeDatas","disableSave","searchClicked"],["fxLayout","column",1,"result","padding-top"],[3,"dataSource","hideHeader"]],template:function(e,t){1&e&&(m.Tb(0,"fury-page-layout",0),m.Tb(1,"fury-page-layout-content",1),m.Tb(2,"mat-toolbar",2),m.Ob(3,"img",3),m.Tb(4,"span"),m.Rc(5,"Consumption Alert"),m.Sb(),m.Ob(6,"span",4),m.Tb(7,"div",5),m.Tb(8,"button",6),m.bc("click",(function(){return t.onReset()})),m.Tb(9,"mat-icon"),m.Rc(10,"refresh"),m.Sb(),m.Sb(),m.Tb(11,"button",7),m.bc("click",(function(){return t.onSave()})),m.Tb(12,"mat-icon"),m.Rc(13,"save"),m.Sb(),m.Sb(),m.Tb(14,"button",8),m.bc("click",(function(){return t.onPrintSummary()})),m.Tb(15,"mat-icon"),m.Rc(16,"print"),m.Sb(),m.Sb(),m.Tb(17,"button",9),m.bc("click",(function(){return t.onExport()})),m.Tb(18,"mat-icon"),m.Rc(19,"import_export"),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Tb(20,"div",10),m.Tb(21,"fury-card",11),m.Ob(22,"fury-card-header"),m.Tb(23,"fury-card-content",1),m.Tb(24,"div",12),m.Tb(25,"fury-bill-consumption-toolbar",13),m.bc("disableSave",(function(e){return t.disable(e)}))("searchClicked",(function(e){return t.onSearch(e)})),m.Sb(),m.Sb(),m.Tb(26,"div",14),m.Ob(27,"fury-bill-consumption-details",15),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb()),2&e&&(m.Cb(11),m.mc("disabled",0==t.isData&&t.disableSaveButton),m.Cb(3),m.mc("disabled",0==t.isData),m.Cb(6),m.mc("fxLayoutGap",t.gap),m.Cb(1),m.mc("fxFlex.gt-sm",t.col2)("@fadeInUp",void 0),m.Cb(4),m.mc("billPeriods",t.billPeriods)("utilityTypes",t.utilityTypes)("consumptionRangeDatas",t.consumptionAlerts),m.Cb(2),m.mc("dataSource",t.failedBills)("hideHeader",!1))},directives:[X.a,$.a,S.d,q.a,P.a,D.a,w.a,S.b,S.c,S.e,f.a,f.d,f.c,Yi,Pi],styles:[".toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.img-style[_ngcontent-%COMP%]{width:32px}.position-fixed[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;top:0;z-index:5}"],data:{animation:[d.a,u.a]}}),e})();var _i=i("Ektq");function Gi(e,t){if(1&e&&(m.Tb(0,"mat-option",15),m.Rc(1),m.Sb()),2&e){const e=t.$implicit;m.mc("value",e.value),m.Cb(1),m.Tc("",e.label," ")}}function Xi(e,t){if(1&e&&(m.Tb(0,"mat-option",15),m.Rc(1),m.Sb()),2&e){const e=t.$implicit;m.mc("value",e.value),m.Cb(1),m.Tc("",e.label," ")}}let $i=(()=>{class e{constructor(e,t,i,l,n,o){this.data=e,this.billSettlementService=t,this.snackbar=i,this.masterService=l,this.variablePayService=n,this.dialogRef=o,this.consumption="",this.accountHeadId=0,this.utilityTypeId=0,this.meterId=0,this.accountHeads=[{label:"Select",value:0}],this.utilityTypes=[{label:"Select",value:0}],this.meterNumbers=[{label:"Select",value:0}]}ngOnInit(){this.getUtilityTypes()}onSave(){if(this.consumption&&this.utilityTypeId){let e=[];const t={utilityTypeId:this.utilityTypeId,amount:Number(this.consumption),billPeriodId:this.data.billPeriodId,tenantId:this.data.ownerId,unitId:this.data.unitId,clientId:this.data.clientId,meterId:this.meterId,isDeduction:!1};e.push(t),this.variablePayService.createOtherTypeConsumptionVariablePay(e,"manual").subscribe({next:e=>{e.isSuccess?this.onSaveOtherTypeConsumptionBills():this.notificationMessage(e.message?e.message:"No consumption to save","red-snackbar")},error:e=>{this.notificationMessage("Manual consumption save failed","red-snackbar")}})}}getUtilityTypes(){this.utilityTypes=[{label:"Select",value:0}],this.masterService.getSystemMasterdata(16,0).subscribe(e=>{if(e){const t=this.data.bills.filter(e=>1==e.isFailed);t&&t.length&&t.forEach(t=>{const i=e.find(e=>e.id===t.utilityTypeId);if(i){let e=this.utilityTypes.find(e=>e.value==i.id);e?e.subListItems.push({description:t.deviceName,id:t.meterId}):this.utilityTypes.push({label:i.description,value:i.id,subListItems:[{description:t.deviceName,id:t.meterId}]})}})}})}notificationMessage(e,t){this.snackbar.open(e,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[t]})}onUtilityChange(e){if(this.utilityTypeId=e,this.meterNumbers=[{label:"Select",value:0}],this.utilityTypeId){const e=this.utilityTypes.find(e=>e.value==this.utilityTypeId);e&&e.subListItems.forEach(e=>{this.meterNumbers.push({label:e.description,value:e.id})})}}onAccountHeadChange(e){var t,i;this.accountHeadId=null!==(i=null===(t=null==e?void 0:e.option)||void 0===t?void 0:t.value)&&void 0!==i?i:e}onSaveOtherTypeConsumptionBills(){const e=[];this.data.billTypeId=b.a.ManualBill,e.push(this.data),this.billSettlementService.updateOtherTypeConsumption(e).subscribe({next:e=>{e&&this.dialogRef.close(!0)},error:e=>{this.notificationMessage("Manual consumption save failed","red-snackbar")}})}close(){this.dialogRef.close(!1)}}return e.\u0275fac=function(t){return new(t||e)(m.Nb(h.a),m.Nb(F.a),m.Nb(k.b),m.Nb(je.a),m.Nb(_i.a),m.Nb(h.h))},e.\u0275cmp=m.Hb({type:e,selectors:[["fury-manual-bill-consumption"]],decls:36,vars:6,consts:[["mat-dialog-title",""],["role","toolbar",1,"task-header"],[1,"fx-spacer"],["mat-icon-button","",3,"click"],["mat-list-icon",""],[1,"person"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","10px"],["fxFlex",""],["name","utilityTypeId","id","utilityTypeId","placeholder","Utility Type",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["name","meterId","id","meterId","placeholder","Meter Number",3,"ngModel","ngModelChange"],["color","primary",1,"result"],["type","text","id","consumption","name","consumption","matInput","",3,"ngModel","ngModelChange"],[1,"fury-flex-form-field"],["mat-icon-button","","aria-label","Example icon-button with menu icon",1,"example-icon",3,"disabled","click"],[3,"value"]],template:function(e,t){1&e&&(m.Tb(0,"h4",0),m.Tb(1,"mat-toolbar",1),m.Tb(2,"span"),m.Rc(3,"Manual Bill"),m.Sb(),m.Ob(4,"span",2),m.Tb(5,"button",3),m.bc("click",(function(){return t.close()})),m.Tb(6,"mat-icon",4),m.Rc(7,"close"),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Tb(8,"mat-dialog-content"),m.Tb(9,"div",5),m.Tb(10,"form"),m.Tb(11,"div",6),m.Tb(12,"mat-form-field",7),m.Tb(13,"mat-label"),m.Rc(14,"Utitlity Type"),m.Sb(),m.Tb(15,"mat-select",8),m.bc("ngModelChange",(function(e){return t.utilityTypeId=e}))("ngModelChange",(function(e){return t.onUtilityChange(e)})),m.Pc(16,Gi,2,2,"mat-option",9),m.Sb(),m.Tb(17,"mat-hint"),m.Rc(18,"Please select an utility Type"),m.Sb(),m.Sb(),m.Sb(),m.Tb(19,"div",6),m.Tb(20,"mat-form-field",7),m.Tb(21,"mat-label"),m.Rc(22,"Meter Number"),m.Sb(),m.Tb(23,"mat-select",10),m.bc("ngModelChange",(function(e){return t.meterId=e})),m.Pc(24,Xi,2,2,"mat-option",9),m.Sb(),m.Tb(25,"mat-hint"),m.Rc(26,"Please select an Meter Number"),m.Sb(),m.Sb(),m.Sb(),m.Tb(27,"div",6),m.Tb(28,"mat-form-field",11),m.Tb(29,"mat-label"),m.Rc(30,"Consumption"),m.Sb(),m.Tb(31,"input",12),m.bc("ngModelChange",(function(e){return t.consumption=e})),m.Sb(),m.Sb(),m.Tb(32,"div",13),m.Tb(33,"button",14),m.bc("click",(function(){return t.onSave()})),m.Tb(34,"mat-icon"),m.Rc(35,"save"),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb()),2&e&&(m.Cb(15),m.mc("ngModel",t.utilityTypeId),m.Cb(1),m.mc("ngForOf",t.utilityTypes),m.Cb(7),m.mc("ngModel",t.meterId),m.Cb(1),m.mc("ngForOf",t.meterNumbers),m.Cb(7),m.mc("ngModel",t.consumption),m.Cb(2),m.mc("disabled",!t.meterId||!t.utilityTypeId||!t.consumption))},directives:[h.i,q.a,P.a,w.a,Ue.c,h.f,l.z,l.r,l.s,S.d,S.e,I.d,S.b,I.h,O.a,l.q,l.t,a.n,I.g,W.b,l.c,L.n],styles:[".task-header[_ngcontent-%COMP%]{background-color:transparent;padding:0 5px;height:20px}.fx-spacer[_ngcontent-%COMP%]{flex:1 1 auto}"]}),e})(),qi=(()=>{class e{constructor(){this.forceVerifyClicked=new m.o,this.averageConsumptionClicked=new m.o}ngOnInit(){}onForceVerify(){this.forceVerifyClicked.emit()}onAverageConsumption(){this.averageConsumptionClicked.emit()}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=m.Hb({type:e,selectors:[["fury-failed-bills-footer-toolbar"]],outputs:{forceVerifyClicked:"forceVerifyClicked",averageConsumptionClicked:"averageConsumptionClicked"},decls:9,vars:0,consts:[[1,"person"],["matTooltip","Force Generate","mat-icon-button","","aria-label","Example icon-button with menu icon",1,"example-icon",3,"click"],["matTooltip","Average Conumption Generate","mat-icon-button","","aria-label","Example icon-button with menu icon",1,"example-icon",3,"click"]],template:function(e,t){1&e&&(m.Tb(0,"mat-dialog-content"),m.Tb(1,"div",0),m.Tb(2,"form"),m.Tb(3,"button",1),m.bc("click",(function(){return t.onForceVerify()})),m.Tb(4,"mat-icon"),m.Rc(5,"launch"),m.Sb(),m.Sb(),m.Tb(6,"button",2),m.bc("click",(function(){return t.onAverageConsumption()})),m.Tb(7,"mat-icon"),m.Rc(8,"save"),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb())},directives:[h.f,l.z,l.r,l.s,P.a,D.a,w.a],styles:[""]}),e})();function Ji(e,t){if(1&e&&(m.Tb(0,"mat-option",13),m.Rc(1),m.Sb()),2&e){const e=t.$implicit;m.mc("value",e.value),m.Cb(1),m.Tc("",e.label," ")}}let Qi=(()=>{class e{constructor(e,t){this.snackbar=e,this.date=t,this.billPeriods=[],this.searchClicked=new m.o,this.manageParams={},this.tenantId=0,this.fromDate="",this.toDate="",this.unitNumber="",this.billPeriodId=0}ngOnInit(){}onSearch(){this.fromDate||this.toDate||this.billPeriodId?(this.manageParams={fromDate:""+(""==this.fromDate?"":R(this.fromDate).format("YYYY-MM-DD")),toDate:""+(""==this.toDate?"":R(this.toDate).format("YYYY-MM-DD")),billPeriodId:""+this.billPeriodId,unitNumber:this.unitNumber,isFine:!1,isPenalty:!1},this.searchClicked.emit(this.manageParams)):this.snackbar.open("Invalid search parameters",null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:["yellow-snackbar"]})}onChangeBillPeriod(e){this.billPeriodId=e}}return e.\u0275fac=function(t){return new(t||e)(m.Nb(k.b),m.Nb(a.f))},e.\u0275cmp=m.Hb({type:e,selectors:[["fury-failed-bills-toolbar"]],inputs:{billPeriods:"billPeriods"},outputs:{searchClicked:"searchClicked"},decls:33,vars:9,consts:[[1,"person"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","8px"],["color","primary",1,"result"],["id","fromDate","name","fromDate","matInput","","readonly","",3,"ngModel","matDatepicker","click","ngModelChange","focus"],["matSuffix","",3,"for"],["formDatepickerRef1",""],["id","toDate","name","toDate","matInput","","readonly","",3,"ngModel","matDatepicker","click","ngModelChange","focus"],["formDatepickerRef2",""],["type","text","id","unitNumber","name","unitNumber","matInput","",3,"ngModel","ngModelChange"],["id","billPeriod","name","billPeriod",3,"value","selectionChange","valueChange"],[3,"value",4,"ngFor","ngForOf"],[1,"fury-flex-form-field"],["mat-icon-button","","aria-label","Example icon-button with menu icon",1,"example-icon",3,"click"],[3,"value"]],template:function(e,t){if(1&e){const e=m.Ub();m.Tb(0,"mat-dialog-content"),m.Tb(1,"div",0),m.Tb(2,"form"),m.Tb(3,"div",1),m.Tb(4,"mat-form-field",2),m.Tb(5,"mat-label"),m.Rc(6,"From Date"),m.Sb(),m.Tb(7,"input",3),m.bc("click",(function(){return m.Ec(e),m.Ac(10).open()}))("ngModelChange",(function(e){return t.fromDate=e}))("focus",(function(){return m.Ec(e),m.Ac(10).open()})),m.Sb(),m.Ob(8,"mat-datepicker-toggle",4),m.Ob(9,"mat-datepicker",null,5),m.Sb(),m.Tb(11,"mat-form-field",2),m.Tb(12,"mat-label"),m.Rc(13,"To Date"),m.Sb(),m.Tb(14,"input",6),m.bc("click",(function(){return m.Ec(e),m.Ac(17).open()}))("ngModelChange",(function(e){return t.toDate=e}))("focus",(function(){return m.Ec(e),m.Ac(17).open()})),m.Sb(),m.Ob(15,"mat-datepicker-toggle",4),m.Ob(16,"mat-datepicker",null,7),m.Sb(),m.Tb(18,"mat-form-field",2),m.Tb(19,"mat-label"),m.Rc(20,"Unit Number"),m.Sb(),m.Tb(21,"input",8),m.bc("ngModelChange",(function(e){return t.unitNumber=e})),m.Sb(),m.Sb(),m.Tb(22,"mat-form-field",2),m.Tb(23,"mat-label"),m.Rc(24,"Bill Period"),m.Sb(),m.Tb(25,"mat-select",9),m.bc("selectionChange",(function(e){return t.onChangeBillPeriod(e.value)}))("valueChange",(function(e){return t.billPeriodId=e})),m.Pc(26,Ji,2,2,"mat-option",10),m.Sb(),m.Tb(27,"mat-hint"),m.Rc(28,"Please select a Bill period"),m.Sb(),m.Sb(),m.Tb(29,"div",11),m.Tb(30,"button",12),m.bc("click",(function(){return t.onSearch()})),m.Tb(31,"mat-icon"),m.Rc(32,"search"),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb()}if(2&e){const e=m.Ac(10),i=m.Ac(17);m.Cb(7),m.mc("ngModel",t.fromDate)("matDatepicker",e),m.Cb(1),m.mc("for",e),m.Cb(6),m.mc("ngModel",t.toDate)("matDatepicker",i),m.Cb(1),m.mc("for",i),m.Cb(6),m.mc("ngModel",t.unitNumber),m.Cb(4),m.mc("value",t.billPeriodId),m.Cb(1),m.mc("ngForOf",t.billPeriods)}},directives:[h.f,l.z,l.r,l.s,S.d,S.e,I.d,I.h,W.b,l.c,B.b,l.q,l.t,B.d,I.j,B.a,O.a,a.n,I.g,P.a,w.a,L.n],styles:[""]}),e})(),Ki=(()=>{class e{constructor(e,t,i,l,n,o,a,s,r,c,u){var d,m,h;this.billService=e,this.billSettlementService=t,this.variablePayService=i,this.date=l,this.currencyPipe=n,this.decimalPipe=o,this.dialog=a,this.snackbar=s,this.clientSelectionService=r,this.cookieService=c,this.envService=u,this._gap=16,this.gap=this._gap+"px",this.col2=`1 1 calc(50% - ${this._gap/2}px)`,this.col3=`1 1 calc(33.3333% - ${this._gap/1.5}px)`,this.billPeriods=[],this.selectedRows=[],this.columns=[],this.innerColumns=[],this.columnNames=[],this.visibleButtons=[],this.billMasterDetails=[],this.manageParams={},this.billAmount="",this.receivedAmount="",this.buttonName="Manual Bill",this.billNumberConsumptionColumnName="Bill No",this.buildingColumnName="Building",this.unitNumberColumnName="Unit Number",this.smsColumnName="SMS",this.emailColumnName="Email",this.watsappColumnName="Watsapp",this.consumptionRoundOffFormat=Object(b.e)("ConsumptionRoundOff"),this.dateFormat="",this.currency="",this.roundFormat="",this.billNumberColumnName="Bill Number",this.accountNumberColumnName="Account Number",this.billDateColumnName="BillDate",this.tenantNameColumnName="Tenant Name",this.entityTypeColumnName="Owner/Tenant",this.unitColumnName="Unit",this.fromDateColumnName="From Date",this.toDateColumnName="To Date",this.dueDateColumnName="Due Date",this.billAmountColumnName="Bill Amount",this.paidColumnName="Paid",this.failedReasonColumnName="Failed Reason",this.cancelColumnName="Cancel",this.utilityTypeCoulmnNmae="Utility Type",this.meterNumberCoulmnNmae="Meter Number",this.previousReadingColumnName="Previous",this.presentReadingColumnName="Present",this.currentConsumptionColumnName="Cur-Consumption",this.dateFormat=null!==(d=Object(b.e)("DateFormat"))&&void 0!==d?d:u.dateFormat,this.currency=null!==(m=Object(b.e)("Currency"))&&void 0!==m?m:u.currencyFormat,this.roundFormat=null!==(h=Object(b.e)("RoundOff"))&&void 0!==h?h:u.roundOffFormat}ngOnInit(){this.clientSelectionService.setIsClientVisible(!0),this.clientId=parseInt(this.cookieService.get("globalClientId")),this.getBillPeriods(),this.createColumnNames(),this.createGridColumns(),this.createInnerGridColumns(),this.addVisibleButtons()}createGridColumns(){this.columns=["select","accountNumber","billNumber","ownerName","entityType","unitNumber","fromDateLocal","toDateLocal","dueDateLocal","billAmountLocal","paidLocal","reasonForFailed","button","action"]}createInnerGridColumns(){this.innerColumns=["utilityType","deviceName","previousReadingLocal","presentReadingLocal","consumptionLocal","billAmountLocal"]}addVisibleButtons(){this.visibleButtons=[{property:"modify"},{property:"print"}]}createColumnNames(){this.columnNames=[{name:this.billNumberColumnName,property:"billNumber"},{name:this.accountNumberColumnName,property:"accountNumber"},{name:this.billDateColumnName,property:"billDate"},{name:this.tenantNameColumnName,property:"ownerName"},{name:this.entityTypeColumnName,property:"entityType"},{name:this.unitColumnName,property:"unitNumber"},{name:this.fromDateColumnName,property:"fromDateLocal"},{name:this.toDateColumnName,property:"toDateLocal"},{name:this.dueDateColumnName,property:"dueDateLocal"},{name:this.billAmountColumnName,property:"billAmountLocal",columnAlign:{"text-align":"right"}},{name:this.paidColumnName,property:"paidLocal",columnAlign:{"text-align":"right"}},{name:this.failedReasonColumnName,property:"reasonForFailed"},{name:this.utilityTypeCoulmnNmae,property:"utilityType"},{name:this.meterNumberCoulmnNmae,property:"deviceName"},{name:this.previousReadingColumnName,property:"previousReadingLocal"},{name:this.presentReadingColumnName,property:"presentReadingLocal"},{name:this.currentConsumptionColumnName,property:"consumptionLocal"},{name:this.billAmountColumnName,property:"amountLocal",columnAlign:{"text-align":"right"}}]}onGetBillsHistory(e,t=null){this.manageParams=e,this.billMasterDetails=[],this.billAmount="",this.receivedAmount="";let i=0,l=0;e.fromDate=""===e.fromDate?"":R(e.fromDate).format("YYYY-MM-DD"),e.toDate=""===e.toDate?"":R(e.toDate).format("YYYY-MM-DD"),e.clientId=this.clientId,this.billService.getBillHistory(e).subscribe(e=>{if(e){const n=e.filter(e=>!0===e.isBillFailed);if(this.dateFormat=Object(b.e)("DateFormat"),this.roundFormat=Object(b.e)("RoundOff"),this.currency=Object(b.e)("Currency"),n.forEach(e=>{e.billDateLocal=this.date.transform(e.billDate.toString(),this.dateFormat.toString()),e.fromDateLocal=this.date.transform(e.fromDate.toString(),this.dateFormat.toString()),e.toDateLocal=this.date.transform(e.toDate.toString(),this.dateFormat.toString()),e.dueDateLocal=this.date.transform(e.toDate.toString(),this.dateFormat.toString()),e.billAmountLocal=this.currencyPipe.transform(e.billAmount,this.currency.toString(),!0,this.roundFormat),e.paidLocal=this.currencyPipe.transform(e.paid,this.currency.toString(),!0,this.roundFormat),e.bills.forEach(e=>{this.consumptionRoundOffFormat=Object(b.e)("ConsumptionRoundOff",e.utilityTypeId),e.previousReadingLocal=this.decimalPipe.transform(e.previousReading,this.consumptionRoundOffFormat),e.presentReadingLocal=this.decimalPipe.transform(e.presentReading,this.consumptionRoundOffFormat),e.consumptionLocal=this.decimalPipe.transform(e.consumption,this.consumptionRoundOffFormat),e.billAmountLocal=this.currencyPipe.transform(e.billAmount,this.currency.toString(),!0,this.roundFormat)}),i+=e.billAmount,l+=e.paid}),this.billMasterDetails=n,this.billAmount=this.currencyPipe.transform(i,this.currency.toString(),!0,this.roundFormat),this.receivedAmount=this.currencyPipe.transform(l,this.currency.toString(),!0,this.roundFormat),null!=t){let e=this.billMasterDetails.find(e=>e.billNumber==t.billNumber);null!=e?e.isBillFailed&&this.notificationMessage("Manual Bill save failed. Please check the consumption entered.","red-snackbar"):this.notificationMessage("Manual Bill saved successfully","green-snackbar")}}})}onSelectedRows(e){this.selectedRows=[],this.selectedRows=e}getBillPeriods(){this.billPeriods=[{label:"Select",value:0}],this.billService.getBillPeriods(this.clientId).subscribe(e=>{e.forEach(e=>{this.billPeriods.push({label:e.periodDescription,value:e.id})})})}onViewDataRow(e){this.dialog.open(v,{data:e}).afterClosed().subscribe()}onDeleteDataRow(e){e.type="Cancel",this.dialog.open(Ee,{data:e}).afterClosed().subscribe(()=>{e&&this.onGetBillsHistory(this.manageParams)})}onForceVerify(){this.selectedRows&&this.selectedRows.length?(this.selectedRows.forEach(e=>{e.isBillFailed=!1}),this.billSettlementService.updateFaileBillsStatus(this.selectedRows).subscribe(e=>{e?this.notificationMessage("Failed bills status updated successfully","green-snackbar"):this.notificationMessage("Failed bills status update failed","red-snackbar"),this.onGetBillsHistory(this.manageParams)})):(this.notificationMessage("Please select Bills.","red-snackbar"),this.onGetBillsHistory(this.manageParams))}notificationMessage(e,t){this.snackbar.open(e,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[t]})}onAverageConsumptionSave(){let e=[];this.selectedRows&&this.selectedRows.length?(this.selectedRows.forEach(t=>{t.bills&&t.bills.length&&(t.billTypeId=b.a.AverageBill,t.bills.forEach(i=>{e.push({billPeriodId:t.billPeriodId,tenantId:t.ownerId,unitId:t.unitId,clientId:t.clientId,isDeduction:!1,utilityTypeId:i.utilityTypeId})}))}),this.variablePayService.createOtherTypeConsumptionVariablePay(e,"average").subscribe({next:e=>{e.isSuccess?this.onSaveAverageConsumptionBills():(this.notificationMessage(e.message?e.message:"No consumption to save","red-snackbar"),this.onGetBillsHistory(this.manageParams))},error:e=>{this.notificationMessage("Average consumption save failed","red-snackbar"),this.onGetBillsHistory(this.manageParams)}})):this.notificationMessage("Please select Bills.","red-snackbar")}onSaveAverageConsumptionBills(){this.billSettlementService.updateOtherTypeConsumption(this.selectedRows).subscribe({next:e=>{e?this.notificationMessage("Average consumption saved successfully","green-snackbar"):this.notificationMessage("Average consumption save failed","red-snackbar"),this.onGetBillsHistory(this.manageParams)},error:e=>{this.notificationMessage("Average consumption save failed","red-snackbar"),this.onGetBillsHistory(this.manageParams)}})}onUpdateRow(e){this.dialog.open($i,{data:e}).afterClosed().subscribe(t=>{t&&this.onGetBillsHistory(this.manageParams,e)})}downloadReport(e){return Object(r.a)(this,void 0,void 0,(function*(){this.invoiceView([e])}))}invoiceView(e){this.billService.invoiceView(e).subscribe({next:e=>{e?this.downloadFile(e):this.notificationMessage("No data to print","red-snackbar")},error:e=>{this.notificationMessage("No data to print","red-snackbar")}})}downloadFile(e){return Object(r.a)(this,void 0,void 0,(function*(){const t=yield G.PDFDocument.create();for(const o of e){const e=yield G.PDFDocument.load(o);(yield t.copyPages(e,e.getPageIndices())).forEach(e=>{t.addPage(e)})}const i=yield t.save(),l=new Blob([i],{type:"application/pdf"}),n=window.URL.createObjectURL(l);window.open(n)}))}}return e.\u0275fac=function(t){return new(t||e)(m.Nb(c.a),m.Nb(F.a),m.Nb(_i.a),m.Nb(a.f),m.Nb(a.d),m.Nb(a.g),m.Nb(h.b),m.Nb(k.b),m.Nb(_.a),m.Nb(C.a),m.Nb(p.a))},e.\u0275cmp=m.Hb({type:e,selectors:[["fury-failed-bills"]],decls:26,vars:13,consts:[["mode","card",2,"margin-top","20px"],["fxLayout","column"],["color","primary",1,"position-fixed"],["src","assets/img/fav-icon.png",1,"img-style"],[1,"toolbar-spacer"],[3,"averageConsumptionClicked","forceVerifyClicked"],["fxFlex","noshrink","fxLayout","column","fxLayout.gt-sm","row","fxLayoutAlign.gt-sm","start stretch",3,"fxLayoutGap"],["fxFlex","grow",1,"basic-forms","route-animations-elements",3,"fxFlex.gt-sm"],["fxLayout","column",1,"result"],[3,"billPeriods","searchClicked"],[3,"tableData","columnsToDisplay","innerDisplayedColumns","columnNames","hideHeader","buttonName","visibleButtons","selectedRows","viewDataRow","printDataRow","updateRow","deleteDataRow"],["fxLayout.gt-sm","row","fxLayout","column","fxLayoutAlign","end end","fxLayoutGap.gt-sm","12px",1,"result"],["color","primary",1,"result"],["type","text","id","billAmount","name","billAmount","matInput","",2,"text-align","right",3,"ngModel","ngModelChange"],["type","text","id","receivedAmount","name","receivedAmount","matInput","",2,"text-align","right",3,"ngModel","ngModelChange"]],template:function(e,t){1&e&&(m.Tb(0,"fury-page-layout",0),m.Tb(1,"fury-page-layout-content",1),m.Tb(2,"mat-toolbar",2),m.Ob(3,"img",3),m.Tb(4,"span"),m.Rc(5,"Failed Bills"),m.Sb(),m.Ob(6,"span",4),m.Tb(7,"fury-failed-bills-footer-toolbar",5),m.bc("averageConsumptionClicked",(function(){return t.onAverageConsumptionSave()}))("forceVerifyClicked",(function(){return t.onForceVerify()})),m.Sb(),m.Sb(),m.Tb(8,"div",6),m.Tb(9,"fury-card",7),m.Ob(10,"fury-card-header"),m.Tb(11,"fury-card-content",1),m.Tb(12,"div",8),m.Tb(13,"fury-failed-bills-toolbar",9),m.bc("searchClicked",(function(e){return t.onGetBillsHistory(e)})),m.Sb(),m.Sb(),m.Sb(),m.Tb(14,"fury-card-content",1),m.Tb(15,"div",8),m.Tb(16,"fury-expandable-table-structure",10),m.bc("selectedRows",(function(e){return t.onSelectedRows(e)}))("viewDataRow",(function(e){return t.onViewDataRow(e)}))("printDataRow",(function(e){return t.downloadReport(e)}))("updateRow",(function(e){return t.onUpdateRow(e)}))("deleteDataRow",(function(e){return t.onDeleteDataRow(e)})),m.Sb(),m.Sb(),m.Tb(17,"div",11),m.Tb(18,"mat-form-field",12),m.Tb(19,"mat-label"),m.Rc(20,"Bill Amount"),m.Sb(),m.Tb(21,"input",13),m.bc("ngModelChange",(function(e){return t.billAmount=e})),m.Sb(),m.Sb(),m.Tb(22,"mat-form-field",12),m.Tb(23,"mat-label"),m.Rc(24,"Paid Amount"),m.Sb(),m.Tb(25,"input",14),m.bc("ngModelChange",(function(e){return t.receivedAmount=e})),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb()),2&e&&(m.Cb(8),m.mc("fxLayoutGap",t.gap),m.Cb(1),m.mc("fxFlex.gt-sm",t.col2)("@fadeInUp",void 0),m.Cb(4),m.mc("billPeriods",t.billPeriods),m.Cb(3),m.mc("tableData",t.billMasterDetails)("columnsToDisplay",t.columns)("innerDisplayedColumns",t.innerColumns)("columnNames",t.columnNames)("hideHeader",!1)("buttonName",t.buttonName)("visibleButtons",t.visibleButtons),m.Cb(5),m.mc("ngModel",t.billAmount),m.Cb(4),m.mc("ngModel",t.receivedAmount))},directives:[X.a,$.a,S.d,q.a,qi,S.b,S.c,S.e,f.a,f.d,f.c,Qi,T.a,I.d,I.h,W.b,l.c,l.q,l.t],styles:[".toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.img-style[_ngcontent-%COMP%]{width:32px}.position-fixed[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;top:0;z-index:5}"],data:{animation:[d.a,u.a]}}),e})();var Zi=i("jtHE"),el=i("pLZG");function tl(e,t){if(1&e){const e=m.Ub();m.Tb(0,"fury-payment-history-footer-toolbar",20),m.bc("exportClicked",(function(){return m.Ec(e),m.fc().onExport()})),m.Sb()}if(2&e){const e=m.fc();m.mc("visible",!1)("hide",e.hasData)("show",!1)}}function il(e,t){if(1&e&&(m.Tb(0,"mat-option",30),m.Rc(1),m.Sb()),2&e){const e=t.$implicit;m.mc("value",e.value),m.Cb(1),m.Tc("",e.label," ")}}function ll(e,t){if(1&e){const e=m.Ub();m.Tb(0,"div",21),m.Tb(1,"div",22),m.Tb(2,"mat-form-field",23),m.Tb(3,"mat-label"),m.Rc(4,"From Date"),m.Sb(),m.Tb(5,"input",24),m.bc("click",(function(){return m.Ec(e),m.Ac(8).open()}))("ngModelChange",(function(t){return m.Ec(e),m.fc().fromDate=t}))("focus",(function(){return m.Ec(e),m.Ac(8).open()})),m.Sb(),m.Ob(6,"mat-datepicker-toggle",25),m.Ob(7,"mat-datepicker",null,26),m.Sb(),m.Tb(9,"mat-form-field",23),m.Tb(10,"mat-label"),m.Rc(11,"To Date"),m.Sb(),m.Tb(12,"input",27),m.bc("click",(function(){return m.Ec(e),m.Ac(15).open()}))("ngModelChange",(function(t){return m.Ec(e),m.fc().toDate=t}))("focus",(function(){return m.Ec(e),m.Ac(15).open()})),m.Sb(),m.Ob(13,"mat-datepicker-toggle",25),m.Ob(14,"mat-datepicker",null,28),m.Sb(),m.Tb(16,"mat-form-field",23),m.Tb(17,"mat-label"),m.Rc(18,"Bill Period"),m.Sb(),m.Tb(19,"mat-select",29),m.bc("selectionChange",(function(t){return m.Ec(e),m.fc().onChangeBillPeriod(t.value)}))("valueChange",(function(t){return m.Ec(e),m.fc().billPeriodId=t})),m.Tb(20,"mat-option",30),m.Rc(21,"Select"),m.Sb(),m.Pc(22,il,2,2,"mat-option",31),m.Sb(),m.Tb(23,"mat-hint"),m.Rc(24,"Please select a Bill period"),m.Sb(),m.Sb(),m.Tb(25,"div",32),m.Tb(26,"button",33),m.bc("click",(function(){return m.Ec(e),m.fc().getPaymentDueReport()})),m.Tb(27,"mat-icon"),m.Rc(28,"search"),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb()}if(2&e){const e=m.Ac(8),t=m.Ac(15),i=m.fc();m.Cb(5),m.mc("ngModel",i.fromDate)("matDatepicker",e),m.Cb(1),m.mc("for",e),m.Cb(6),m.mc("ngModel",i.toDate)("matDatepicker",t),m.Cb(1),m.mc("for",t),m.Cb(6),m.mc("value",i.billPeriodId),m.Cb(1),m.mc("value",0),m.Cb(2),m.mc("ngForOf",i.billPeriods)}}function nl(e,t){if(1&e&&(m.Tb(0,"th",38),m.Rc(1),m.Sb()),2&e){const e=m.fc(2).$implicit;m.Cb(1),m.Tc(" ",e.name,"")}}function ol(e,t){if(1&e&&(m.Tb(0,"td",39),m.Rc(1),m.Sb()),2&e){const e=t.$implicit,i=m.fc(2).$implicit;m.mc("ngStyle",i.columnAlign),m.Cb(1),m.Tc(" ",e[i.property]," ")}}function al(e,t){if(1&e&&(m.Rb(0,35),m.Pc(1,nl,2,1,"th",36),m.Pc(2,ol,2,2,"td",37),m.Qb()),2&e){const e=m.fc().$implicit;m.mc("matColumnDef",e.property)}}function sl(e,t){if(1&e&&(m.Rb(0),m.Pc(1,al,3,1,"ng-container",34),m.Qb()),2&e){const e=t.$implicit;m.Cb(1),m.mc("ngIf",e.isModelProperty)}}function rl(e,t){1&e&&(m.Tb(0,"th",40),m.Rc(1,"BILL AMOUNT"),m.Sb())}function cl(e,t){if(1&e&&(m.Tb(0,"td",41),m.Rc(1),m.Sb()),2&e){const e=t.$implicit;m.Cb(1),m.Tc(" ",e.billAmountLocal," ")}}function ul(e,t){1&e&&(m.Tb(0,"th",40),m.Rc(1,"CREDIT NOTE AMOUNT"),m.Sb())}function dl(e,t){if(1&e&&(m.Tb(0,"td",41),m.Rc(1),m.Sb()),2&e){const e=t.$implicit;m.Cb(1),m.Tc(" ",e.creditNoteAmountLocal," ")}}function ml(e,t){1&e&&(m.Tb(0,"th",40),m.Rc(1,"PAID AMOUNT"),m.Sb())}function hl(e,t){if(1&e&&(m.Tb(0,"td",41),m.Rc(1),m.Sb()),2&e){const e=t.$implicit;m.Cb(1),m.Tc(" ",e.paidLocal," ")}}function bl(e,t){1&e&&(m.Tb(0,"th",40),m.Rc(1,"PAYMENT DUE"),m.Sb())}function pl(e,t){if(1&e&&(m.Tb(0,"td",41),m.Rc(1),m.Sb()),2&e){const e=t.$implicit;m.Cb(1),m.Tc(" ",e.toPayLocal," ")}}function fl(e,t){1&e&&m.Ob(0,"tr",42)}function gl(e,t){1&e&&m.Ob(0,"tr",43)}let vl=(()=>{class e{constructor(e,t,i,l,n,o,a,s,r){var c,u,d;this.billService=e,this.currency=t,this.date=i,this.templateService=l,this.jwtHelperService=n,this.snackbar=o,this.clientSelectionService=a,this.cookieService=s,this.envService=r,this.subject$=new Zi.a(1),this.data$=this.subject$.asObservable(),this.currencyFormat="",this.dateFormat="",this.billPeriodId=0,this.selectedRows=[],this.billPeriods=[],this.roundOffFormat="",this.role="",this.hasData=!1,this.filePath="",this.displayedColumns=[],this.pageSize=8,this.filePath=r.backendForFiles,this.currencyFormat=null!==(c=Object(b.e)("Currency"))&&void 0!==c?c:r.currencyFormat,this.roundOffFormat=null!==(u=Object(b.e)("RoundOff"))&&void 0!==u?u:r.roundOffFormat,this.dateFormat=null!==(d=Object(b.e)("DateFormat"))&&void 0!==d?d:r.dateFormat}createGridColumns(){this.displayedColumns=0==this.ownerId?[{name:"Bill Number",property:"billNumber",visible:!0,isModelProperty:!0},{name:"Owner Name",property:"ownerName",visible:!0,isModelProperty:!0},{name:"Owner/Tenant",property:"entityType",visible:!0,isModelProperty:!0},{name:"Unit",property:"unitNumber",visible:!0,isModelProperty:!0},{name:"From Date",property:"fromDateLocal",visible:!0,isModelProperty:!0},{name:"To Date",property:"toDateLocal",visible:!0,isModelProperty:!0},{name:"Due Date",property:"dueDateLocal",visible:!0,isModelProperty:!0},{name:"Bill Amount",property:"billAmountLocal",visible:!0,isModelProperty:!1},{name:"Credit Note Amount",property:"creditNoteAmountLocal",visible:!0,isModelProperty:!1},{name:"Paid Amount",property:"paidLocal",visible:!0,isModelProperty:!1},{name:"Payment Due",property:"toPayLocal",visible:!0,isModelProperty:!1}]:[{name:"Bill Number",property:"billNumber",visible:!0,isModelProperty:!0},{name:"Bill Date",property:"billDateLocal",visible:!0,isModelProperty:!0},{name:"Unit",property:"unitNumber",visible:!0,isModelProperty:!0},{name:"Due Date",property:"dueDateLocal",visible:!0,isModelProperty:!0},{name:"Payment Due",property:"toPayLocal",visible:!0,isModelProperty:!1}]}set content(e){this.sort=e,this.sort&&this.dataSource&&(this.dataSource.sort=this.sort)}get visibleColumns(){return this.displayedColumns.filter(e=>e.visible).map(e=>e.property)}ngOnInit(){this.columnsProps=this.displayedColumns.map(e=>e.property);let e=this.cookieService.get("access_token");const t=this.jwtHelperService.decodeToken(e);t&&(this.role=t["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"]),this.ownerId=parseInt(this.cookieService.get("ownerId")),this.createGridColumns(),this.ownerId>0?(this.clientSelectionService.setIsClientVisible(!1),this.getPaymentDue()):this.clientSelectionService.setIsClientVisible(!0),this.getBillPeriods()}getBillPeriods(){this.clientId=parseInt(this.cookieService.get("globalClientId")),this.billService.getBillPeriods(this.clientId).subscribe(e=>{e.forEach(e=>{this.billPeriods.push({label:e.periodDescription,value:e.id})})})}getPaymentDueReport(){this.fromDate=null==this.fromDate?"":this.fromDate,this.toDate=null==this.toDate?"":this.toDate,""!=this.fromDate&&""!=this.toDate||this.billPeriodId>0?this.getPaymentDue():this.notificationMessage("Invalid Parameters.","yellow-snackbar")}getPaymentDue(){this.paymentDue=[],this.hasData=!1,this.clientId=parseInt(this.cookieService.get("globalClientId")),this.fromDate=""==this.fromDate?"":R(this.fromDate).format("YYYY-MM-DD"),this.toDate=""==this.toDate?"":R(this.toDate).format("YYYY-MM-DD"),this.billService.GetPaymentDue(this.fromDate,this.toDate,this.billPeriodId,this.ownerId,this.clientId).subscribe(e=>{this.dateFormat=Object(b.e)("DateFormat"),this.roundOffFormat=Object(b.e)("RoundOff"),this.currencyFormat=Object(b.e)("Currency"),e.forEach(e=>{if(e.billAmountLocal=this.currency.transform(e.billAmount,this.currencyFormat.toString(),!0,this.roundOffFormat),e.billDateLocal=this.date.transform(e.billDate.toString(),this.dateFormat.toString()),e.dueDateLocal=this.date.transform(e.dueDate.toString(),this.dateFormat.toString()),e.fromDateLocal=this.date.transform(e.fromDate.toString(),this.dateFormat.toString()),e.toDateLocal=this.date.transform(e.toDate.toString(),this.dateFormat.toString()),e.paidLocal=this.currency.transform(e.paid,this.currencyFormat.toString(),!0,this.roundOffFormat),e.creditNoteAmountLocal=this.currency.transform(e.creditNoteAmount,this.currencyFormat.toString(),!0,this.roundOffFormat),e.toPay.toString().substring(0).includes("-",0)){let t=e.toPay.toString().replace("-","");e.toPayLocal=this.currency.transform(t,this.currencyFormat.toString()+"-",!0,this.roundOffFormat)}else e.toPayLocal=this.currency.transform(e.toPay,this.currencyFormat.toString(),!0,this.roundOffFormat)}),this.paymentDue=e,this.subject$.next(this.paymentDue),this.paymentDue.length>0&&(this.hasData=!0)}),this.dataSource=new re.k(this.paymentDue),this.data$.pipe(Object(el.a)(e=>!!e)).subscribe(e=>{this.paymentDue=e,this.dataSource.data=e}),this.ngAfterViewInit()}ngAfterViewInit(){null!=this.dataSource&&(this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort)}notificationMessage(e,t){this.snackbar.open(e,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[t]})}onChangeBillPeriod(e){this.billPeriodId=e}onSelectedRows(e){this.selectedRows=[],this.selectedRows=e}onSendEmail(){this.paymentDue&&this.templateService.emailInvoiceTemplate({notificationType:"EMAIL",templateType:"Invoice",templateName:"Invoice",billMasterDetails:this.paymentDue}).subscribe(e=>{this.notificationMessage("Email send successfully.","green-snackbar")})}onPrintSummary(){this.downloadSummary(this.paymentDue)}downloadSummary(e){let t=[],i=[],l=[],n=0,o=0,a=0;for(let s=0;s<e.length;s++)t.push(e[s].billNumber),t.push(e[s].ownerName),t.push(e[s].accountNumber),t.push(e[s].unitNumber),t.push(e[s].billDateLocal),t.push(e[s].dueDateLocal),t.push(e[s].billAmountLocal),t.push(e[s].paidLocal),t.push(e[s].toPayLocal),i.push(t),n+=e[s].billAmount,o+=e[s].paid,a+=e[s].toPay,t=[];l.push({label:"Total Amount",value0:n,value1:o,value2:a});for(let s=0;s<l.length;s++)t.push(""),t.push(""),t.push(""),t.push(""),t.push(""),t.push(l[s].label),t.push(this.currency.transform(l[s].value0,this.currencyFormat.toString(),!0,this.roundOffFormat)),t.push(this.currency.transform(l[s].value1,this.currencyFormat.toString(),!0,this.roundOffFormat)),t.push(this.currency.transform(l[s].value2,this.currencyFormat.toString(),!0,this.roundOffFormat)),i.push(t),t=[];this.getSummaryReport(this.paymentDue,["Bill Number","Tenant Name","Account No.","Unit","Bill Date","Due Date","Bill Amount","Paid","Amount Due"],i,"Payment Due Report")}getSummaryReport(e,t,i,l){var n,o,a=new Image;a.src=this.filePath+"/uploads/"+(null===(o=null===(n=e[0])||void 0===n?void 0:n.client)||void 0===o?void 0:o.photo);let s=new fe.default({orientation:"landscape",unit:"pt",format:"letter"});s.rect(5,5,s.internal.pageSize.width-10,s.internal.pageSize.height-10,"S");const r=R().format("M/D/YYYY hh:mm:ss a");s.autoTable(t,i,{startX:10,startY:110,didDrawPage:function(t){var i,l,n,o;if(s.setFontSize(30),a&&e[0]&&e[0].client&&e[0].client.imageProperties&&e[0].client.imageProperties.length){const t=null===(l=null===(i=e[0])||void 0===i?void 0:i.client)||void 0===l?void 0:l.imageProperties.find(e=>"portrait"===e.imageType.trim().toLowerCase());t&&(a.onload=function(){s.addImage(a,t.imgX,t.imgY,t.imgW,t.imgH)})}s.setTextColor(25,118,210),s.setFontSize(9),s.setFont("Cambria"),s.setTextColor(0,0,0),s.text("Print Date: "+r,s.internal.pageSize.width-150,20),s.setFontSize(14),s.text("Payment Dues From "+Object(b.f)(null===(n=e[0])||void 0===n?void 0:n.fromDateLocal)+" To "+Object(b.f)(null===(o=e[0])||void 0===o?void 0:o.toDateLocal),s.internal.pageSize.width/2-140,90),s.setFontSize(9);var c="Page "+t.pageCount;"function"==typeof s.putTotalPages&&(c+=" of 1"),s.setFontSize(9);var u=s.internal.pageSize.height||s.internal.pageSize.getHeight();s.text(c,t.settings.margin.left,u-10)},styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:100,left:15},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:70,halign:"left"},1:{cellWidth:120,halign:"left"},2:{cellWidth:80,halign:"left"},3:{cellWidth:80,halign:"left"},4:{cellWidth:70,halign:"center"},5:{cellWidth:70,halign:"center"},6:{cellWidth:90,halign:"right"},7:{cellWidth:90,halign:"right"},8:{cellWidth:90,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]}});var c=s.output("blob");window.open(URL.createObjectURL(c))}onFilterChange(e){this.dataSource&&(e=(e=e.trim()).toLowerCase(),this.dataSource.filter=e)}getJsonData(){this.tableData=[],null!=this.paymentDue&&this.paymentDue.forEach(e=>{let t={BillNumber:e.billNumber,OwnerName:e.ownerName,AccountNumber:e.accountNumber,EntityType:e.entityType,UnitNumber:e.unitNumber,BillDate:this.date.transform(e.billDate,"yyyy-MM-dd"),DueDate:this.date.transform(e.dueDate,"yyyy-MM-dd"),BillAmount:e.billAmountLocal,CreditNoteAmount:e.creditNoteAmountLocal,PaidAmount:e.paidLocal,PaymentDue:e.toPayLocal};this.tableData.push(t)})}onExport(){if(this.paymentDue&&this.paymentDue.length>0){if(this.getJsonData(),null!=this.tableData){const e=vt.utils.json_to_sheet(this.tableData),t=vt.utils.book_new();vt.utils.book_append_sheet(t,e,"Sheet1"),vt.writeFile(t,"PaymentDue.xlsx")}}else this.notificationMessage("No Data to Export","yellow-snackbar")}}return e.\u0275fac=function(t){return new(t||e)(m.Nb(c.a),m.Nb(a.d),m.Nb(a.f),m.Nb(pe.a),m.Nb(y.a),m.Nb(k.b),m.Nb(_.a),m.Nb(C.a),m.Nb(p.a))},e.\u0275cmp=m.Hb({type:e,selectors:[["fury-create-paymentdue"]],viewQuery:function(e,t){var i;1&e&&(m.Vc(yt.a,!0),m.Vc(Ct.a,!0)),2&e&&(m.zc(i=m.cc())&&(t.paginator=i.first),m.zc(i=m.cc())&&(t.content=i.first))},inputs:{displayedColumns:"displayedColumns"},decls:30,vars:9,consts:[["mode","card",2,"margin-top","20px"],["fxLayout","column",1,"top-padding"],["color","primary",1,"position-fixed"],["src","assets/img/fav-icon.png",1,"img-style"],[1,"toolbar-spacer"],[3,"visible","hide","show","exportClicked",4,"ngIf"],["fxFlex","grow",1,"basic-forms","route-animations-elements"],["class","person bottom-padding",4,"ngIf"],[3,"columns","filterChange"],["mat-table","","matSort","",1,"list",3,"dataSource"],[4,"ngFor","ngForOf"],["matColumnDef","billAmountLocal"],["mat-header-cell","","class","header-align-right",4,"matHeaderCellDef"],["mat-cell","","class","header-align-right",4,"matCellDef"],["matColumnDef","creditNoteAmountLocal"],["matColumnDef","paidLocal"],["matColumnDef","toPayLocal"],["mat-header-row","",4,"matHeaderRowDef"],["class","clickable route-animations-elements","mat-row","",4,"matRowDef","matRowDefColumns"],[1,"paginator",3,"pageSize"],[3,"visible","hide","show","exportClicked"],[1,"person","bottom-padding"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","20px"],["color","primary",1,"result"],["id","FromDate","name","FromDate","matInput","","readonly","",3,"ngModel","matDatepicker","click","ngModelChange","focus"],["matSuffix","",3,"for"],["formDatepickerRef1",""],["id","ToDate","name","ToDate","matInput","","readonly","",3,"ngModel","matDatepicker","click","ngModelChange","focus"],["formDatepickerRef2",""],["id","billPeriod","name","billPeriod",3,"value","selectionChange","valueChange"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],[1,"top-padding"],["color","primary","mat-button","",3,"click"],[3,"matColumnDef",4,"ngIf"],[3,"matColumnDef"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",3,"ngStyle",4,"matCellDef"],["mat-header-cell","","mat-sort-header",""],["mat-cell","",3,"ngStyle"],["mat-header-cell","",1,"header-align-right"],["mat-cell","",1,"header-align-right"],["mat-header-row",""],["mat-row","",1,"clickable","route-animations-elements"]],template:function(e,t){1&e&&(m.Tb(0,"fury-page-layout",0),m.Tb(1,"fury-page-layout-content",1),m.Tb(2,"mat-toolbar",2),m.Ob(3,"img",3),m.Tb(4,"span"),m.Rc(5,"Payment Due"),m.Sb(),m.Ob(6,"span",4),m.Pc(7,tl,1,3,"fury-payment-history-footer-toolbar",5),m.Sb(),m.Tb(8,"fury-card",6),m.Ob(9,"fury-card-header"),m.Tb(10,"fury-card-content"),m.Pc(11,ll,29,9,"div",7),m.Tb(12,"fury-list",8),m.bc("filterChange",(function(e){return t.onFilterChange(e)})),m.Tb(13,"table",9),m.Pc(14,sl,2,1,"ng-container",10),m.Rb(15,11),m.Pc(16,rl,2,0,"th",12),m.Pc(17,cl,2,1,"td",13),m.Qb(),m.Rb(18,14),m.Pc(19,ul,2,0,"th",12),m.Pc(20,dl,2,1,"td",13),m.Qb(),m.Rb(21,15),m.Pc(22,ml,2,0,"th",12),m.Pc(23,hl,2,1,"td",13),m.Qb(),m.Rb(24,16),m.Pc(25,bl,2,0,"th",12),m.Pc(26,pl,2,1,"td",13),m.Qb(),m.Pc(27,fl,1,0,"tr",17),m.Pc(28,gl,1,0,"tr",18),m.Sb(),m.Ob(29,"mat-paginator",19),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb()),2&e&&(m.Cb(7),m.mc("ngIf",0==t.ownerId),m.Cb(1),m.mc("@fadeInUp",void 0),m.Cb(3),m.mc("ngIf",0==t.ownerId),m.Cb(1),m.mc("columns",t.displayedColumns),m.Cb(1),m.mc("dataSource",t.dataSource),m.Cb(1),m.mc("ngForOf",t.displayedColumns),m.Cb(13),m.mc("matHeaderRowDef",t.visibleColumns),m.Cb(1),m.mc("matRowDefColumns",t.visibleColumns),m.Cb(1),m.mc("pageSize",t.pageSize))},directives:[X.a,$.a,S.d,q.a,a.o,f.a,S.b,f.d,f.c,St.a,re.j,Ct.a,a.n,re.c,re.e,re.b,re.g,re.i,yt.a,ii.a,S.e,I.d,I.h,W.b,l.c,B.b,l.q,l.t,B.d,I.j,B.a,O.a,L.n,I.g,P.a,w.a,re.d,Ct.b,re.a,a.p,ve.c,re.f,re.h],styles:[".top-padding[_ngcontent-%COMP%]{padding-top:.7%}.bottom-padding[_ngcontent-%COMP%]{padding-bottom:2%}.toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.img-style[_ngcontent-%COMP%]{width:32px}.position-fixed[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;top:0;z-index:5}.header-align-right[_ngcontent-%COMP%]{text-align:right}"],data:{animation:[d.a,u.a]}}),e})();var yl=i("STbY");function Cl(e,t){if(1&e&&(m.Tb(0,"mat-option",36),m.Rc(1),m.Sb()),2&e){const e=t.$implicit;m.mc("value",e.ownerName),m.Cb(1),m.Tc(" ",e.ownerName," ")}}function Sl(e,t){if(1&e){const e=m.Ub();m.Tb(0,"div",20),m.Tb(1,"div",21),m.Tb(2,"mat-form-field",22),m.Tb(3,"mat-label"),m.Rc(4,"From Date"),m.Sb(),m.Tb(5,"input",23),m.bc("click",(function(){return m.Ec(e),m.Ac(8).open()}))("ngModelChange",(function(t){return m.Ec(e),m.fc().fromDate=t}))("focus",(function(){return m.Ec(e),m.Ac(8).open()})),m.Sb(),m.Ob(6,"mat-datepicker-toggle",24),m.Ob(7,"mat-datepicker",null,25),m.Sb(),m.Tb(9,"mat-form-field",22),m.Tb(10,"mat-label"),m.Rc(11,"To Date"),m.Sb(),m.Tb(12,"input",26),m.bc("click",(function(){return m.Ec(e),m.Ac(15).open()}))("ngModelChange",(function(t){return m.Ec(e),m.fc().toDate=t}))("focus",(function(){return m.Ec(e),m.Ac(15).open()})),m.Sb(),m.Ob(13,"mat-datepicker-toggle",24),m.Ob(14,"mat-datepicker",null,27),m.Sb(),m.Tb(16,"form",28),m.Tb(17,"mat-form-field",29),m.Tb(18,"mat-label"),m.Rc(19,"Tenant Name"),m.Sb(),m.Ob(20,"input",30),m.Tb(21,"mat-autocomplete",31,32),m.bc("optionSelected",(function(t){return m.Ec(e),m.fc().selectTenant(t)})),m.Pc(23,Cl,2,2,"mat-option",33),m.Sb(),m.Tb(24,"mat-hint"),m.Rc(25,"Please select a Tenant Name"),m.Sb(),m.Sb(),m.Sb(),m.Tb(26,"div",34),m.Tb(27,"button",35),m.bc("click",(function(){return m.Ec(e),m.fc().getRefund()})),m.Tb(28,"mat-icon"),m.Rc(29,"search"),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb()}if(2&e){const e=m.Ac(8),t=m.Ac(15),i=m.Ac(22),l=m.fc();m.Cb(5),m.mc("ngModel",l.fromDate)("matDatepicker",e),m.Cb(1),m.mc("for",e),m.Cb(6),m.mc("ngModel",l.toDate)("matDatepicker",t),m.Cb(1),m.mc("for",t),m.Cb(3),m.mc("formGroup",l.form),m.Cb(4),m.mc("matAutocomplete",i),m.Cb(3),m.mc("ngForOf",l.filteredTenants)}}function Tl(e,t){if(1&e&&(m.Tb(0,"th",41),m.Rc(1),m.Sb()),2&e){const e=m.fc(2).$implicit;m.Cb(1),m.Tc(" ",e.name,"")}}function Pl(e,t){if(1&e&&(m.Tb(0,"td",42),m.Rc(1),m.Sb()),2&e){const e=t.$implicit,i=m.fc(2).$implicit;m.Cb(1),m.Tc(" ",e[i.property]," ")}}function Dl(e,t){if(1&e&&(m.Rb(0,38),m.Pc(1,Tl,2,1,"th",39),m.Pc(2,Pl,2,1,"td",40),m.Qb()),2&e){const e=m.fc().$implicit;m.mc("matColumnDef",e.property)}}function wl(e,t){if(1&e&&(m.Rb(0),m.Pc(1,Dl,3,1,"ng-container",37),m.Qb()),2&e){const e=t.$implicit;m.Cb(1),m.mc("ngIf",e.isModelProperty)}}function Nl(e,t){1&e&&(m.Tb(0,"th",43),m.Rc(1,"REFUND AMOUNT"),m.Sb())}function xl(e,t){if(1&e&&(m.Tb(0,"td",44),m.Rc(1),m.Sb()),2&e){const e=t.$implicit;m.Cb(1),m.Tc(" ",e.refundAmountLocal," ")}}function Al(e,t){1&e&&m.Ob(0,"th",45)}function Fl(e,t){if(1&e){const e=m.Ub();m.Tb(0,"td",46),m.Tb(1,"button",47),m.bc("click",(function(t){return m.Ec(e),t.stopPropagation()})),m.Tb(2,"mat-icon"),m.Rc(3,"more_horiz"),m.Sb(),m.Sb(),m.Tb(4,"mat-menu",48,49),m.Tb(6,"button",50),m.bc("click",(function(){m.Ec(e);const i=t.$implicit;return m.fc().onPrintPdf(i)})),m.Tb(7,"span"),m.Rc(8,"Print"),m.Sb(),m.Sb(),m.Tb(9,"button",50),m.bc("click",(function(){m.Ec(e);const i=t.$implicit;return m.fc().deleteVariablePay(i)})),m.Tb(10,"span"),m.Rc(11,"Delete"),m.Sb(),m.Sb(),m.Sb(),m.Sb()}if(2&e){const e=m.Ac(5);m.Cb(1),m.mc("matMenuTriggerFor",e)}}function Rl(e,t){1&e&&m.Ob(0,"tr",51)}function kl(e,t){1&e&&m.Ob(0,"tr",52)}let Il=(()=>{class e{constructor(e,t,i,l,n,o,a,s,r,c,u,d){var m,h,p;this.billService=e,this.billSettlementService=t,this.currency=i,this.date=l,this.route=n,this.fb=o,this.snackbar=a,this.templateService=s,this.decimalPipe=r,this.clientSelectionService=c,this.cookieService=u,this.envService=d,this.subject$=new Zi.a(1),this.data$=this.subject$.asObservable(),this.tenants=[],this.currencyFormat="",this.dateFormat="",this.roundOffFormat="",this.tenantId=0,this.showMoreControls=!1,this.isData=!1,this.displayedColumns=[{name:"Refund Number",property:"refundNumber",visible:!0,isModelProperty:!0},{name:"Refund Date",property:"refundDateLocal",visible:!0,isModelProperty:!0},{name:"Owner Name",property:"ownerName",visible:!0,isModelProperty:!0},{name:"Unit Number",property:"unitNumber",visible:!0,isModelProperty:!0},{name:"Refund Amount",property:"refundAmountLocal",visible:!0,isModelProperty:!1,columnAlign:{"text-align":"right"}},{name:"Remarks",property:"remarks",visible:!0,isModelProperty:!0},{name:"Actions",property:"actions",visible:!0}],this.pageSize=8,this.roundOffFormat=null!==(m=Object(b.e)("RoundOff"))&&void 0!==m?m:d.roundOffFormat,this.currencyFormat=null!==(h=Object(b.e)("Currency"))&&void 0!==h?h:d.currencyFormat,this.dateFormat=null!==(p=Object(b.e)("DateFormat"))&&void 0!==p?p:d.dateFormat}set content(e){this.sort=e,this.sort&&this.dataSource&&(this.dataSource.sort=this.sort)}get visibleColumns(){return this.displayedColumns.filter(e=>e.visible).map(e=>e.property)}ngOnInit(){this.clientSelectionService.setIsClientVisible(!0),this.route.queryParams.subscribe(e=>{e.id&&(this.tenantId=parseInt(e.id))}),this.clientId=parseInt(this.cookieService.get("globalClientId")),this.onGetTenants(),this.ownerId=parseInt(this.cookieService.get("ownerId")),this.ownerId>0&&this.getRefundReport(this.fromDate,this.toDate),this.form=this.fb.group({tenantName:[""]}),this.form.controls.tenantName.valueChanges.subscribe(e=>{this.filteredTenants=this.filterTenant(e)})}filterTenant(e){return""!=e&&null!=e?this.tenants.filter(t=>0===t.ownerName.toLowerCase().indexOf(e.toLowerCase())):this.tenants}getRefundReport(e,t){e=e&&""!==e?R(e).format("YYYY-MM-DD"):"",t=t&&""!==t?R(t).format("YYYY-MM-DD"):"",this.billService.GetRefundReport(e,t,0==this.ownerId?this.tenantId:this.ownerId,this.clientId).subscribe(e=>{this.refunds=e,this.dateFormat=Object(b.e)("DateFormat"),this.roundOffFormat=Object(b.e)("RoundOff"),this.currencyFormat=Object(b.e)("Currency"),e.forEach(e=>{e.refundAmountLocal=this.currency.transform(e.refundAmount.toString(),this.currencyFormat.toString(),!0,this.roundOffFormat),e.refundDateLocal=this.date.transform(e.refundDate.toString(),this.dateFormat.toString()),e.paymentAmountLocal=this.currency.transform(e.paymentAmount,this.currencyFormat.toString(),!0,this.roundOffFormat)}),this.subject$.next(e),this.refunds=e,this.isData=e.length>0}),this.dataSource=new re.k(this.refunds),this.data$.pipe(Object(el.a)(e=>!!e)).subscribe(e=>{this.refunds=e,this.dataSource.data=e}),this.ngAfterViewInit()}onGetTenants(){this.billSettlementService.getTenantsDetails(this.clientId,2).subscribe(e=>{if(this.tenants=e,this.filteredTenants=e,this.tenantId>0&&this.tenants){let e=this.tenants.filter(e=>e.id==this.tenantId);e.length>0&&(this.form.controls.tenantName.setValue(e[0].ownerName),this.getRefundReport(this.fromDate,this.toDate))}})}ngAfterViewInit(){null!=this.dataSource&&(this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort)}notificationMessage(e,t){this.snackbar.open(e,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[t]})}getRefund(){this.clientId=parseInt(this.cookieService.get("globalClientId")),this.fromDate=""==this.fromDate?"":this.fromDate,this.toDate=""==this.toDate?"":this.toDate,""!=this.fromDate&&""!=this.toDate||this.tenantId>0?this.getRefundReport(this.fromDate,this.toDate):this.notificationMessage("Invalid Parameters.","yellow-snackbar")}selectTenant(e){this.tenants.forEach(t=>{t.ownerName===e.option.value&&(this.tenantId=t.id)})}onFilterChange(e){this.dataSource&&(e=(e=e.trim()).toLowerCase(),this.dataSource.filter=e)}onPrintPdf(e){this.downloadReport(e)}downloadReport(e){let t=[],i=[];i.push({label:"Refund Number:",value:e.refundNumber},{label:"Refund Date:",value:e.refundDateLocal},{label:"Account Number:",value:e.accountNumber},{label:"Meter Number:",value:""},{label:"Unit Number:",value:""},{label:"Mode of payment:",value:e.paymentMode}),t.push({label:"Received Payments :",value:e.paymentAmountLocal},{label:"Refund Amount :",value:e.refundAmountLocal},{label:"",value:""},{label:"Balance Amount :",value:this.currency.transform(e.paymentAmount-e.refundAmount,this.currencyFormat.toString(),!0,this.roundOffFormat)}),this.getReport(e,[],[],t,[],[],[],i,[],"Refund")}getReport(e,t,i,l,n,o,a,s,r,c){var u=new Image;u.src="assets/img/"+e.client.photo;var d=new Image;d.src="assets/img/lu.JPG";let m=new fe.default({orientation:"portrait",unit:"pt",format:"letter"});m.rect(5,5,m.internal.pageSize.width-10,m.internal.pageSize.height-10,"S"),m.setFontSize(30),m.addImage(u,"png",5,5,190,u.height),m.addImage(d,"png",547,10,56,56),m.setTextColor(0,0,0),m.setFontSize(14),m.setFont("Cambria"),m.text("REFUND RECEIPT",260,30),m.setFontSize(9),m.setTextColor(25,118,210),m.setFont("Cambria","bold"),m.text(e.client.clientName,10,60),m.setFont("Cambria","normal"),m.text("TRN: "+e.client.trnNo,10,70),m.text("PO Box "+e.client.addresses[0].zipPostalCode,10,80),m.text(e.client.addresses[0].address1+","+e.client.addresses[0].country,10,90),m.text("Phone: "+e.client.phoneNo,10,100),m.text("Email: "+e.client.email+", Web: "+e.client.website,10,110),m.setFillColor(241,241,244),m.setDrawColor(206,203,203),m.rect(10,120,250,90,"FD"),m.setTextColor(0,0,0),m.setFontSize(12),m.text(e.ownerName.toUpperCase(),20,135),m.text("CUSTOMER TRN: ",20,155),m.text("unit #",20,170),m.setFontSize(10),m.text("",20,185),m.text("Al Barsha 1, Dubai, UAE",20,200),m.setFontSize(9),m.autoTable("",s,{startX:210,startY:120,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:400},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:100,halign:"right"}},didParseCell:function(e){const t=e.column.index;0!=t&&1!=t||(e.cell.styles.rowHeight=1)},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});const h=Number(this.decimalPipe.transform(m.autoTable.previous.finalY,"1.0-0"));m.setLineWidth(.1),m.line(5,h+10,607,h+10),m.setTextColor(0,0,0),m.setFontSize(10),m.text("Thank you for using Logic Utilities Payment Services.",20,h+20),m.text("We confirm receipt of your payment.",20,h+30),m.text("Please see the below details for your reference.",20,h+40),m.setTextColor(0,0,0),m.autoTable("",l,{startX:300,startY:h+50,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:110},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:180,halign:"left"},1:{cellWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"}}),m.setTextColor(0,0,0);const b=Number(this.decimalPipe.transform(m.autoTable.previous.finalY,"1.0-0"));m.setTextColor(255,0,0),m.setFontSize(9),m.text("Note: A Late Fee will be applied after the due date. A Default Payment \nPenalty will be added to any unit that is 45 days or more in arrears.",320,b+20),m.setTextColor(25,118,210),m.setFontSize(12),m.text("USAGE TIPS to reduce consumption:",10,b+80),m.text("Please Try to:",10,b+100),m.setTextColor(0,0,0),m.setFontSize(9),m.text("- Keep filters clean",30,b+110),m.text("- Set thermostats between 23C and 25C",30,b+120),m.text("- Keep vents unblocked",30,b+130),m.text("- Keep doors and windows closed",30,b+140),m.text("- Undertake regular maintenance of the system",30,b+150),m.setTextColor(25,118,210),m.setFontSize(12),m.text("Please Do Not:",10,b+170),m.setTextColor(0,0,0),m.setFontSize(9),m.text("- Set thermostats to 20C or lower",30,b+180),m.text("- Block vents",30,b+190),m.text("- Leave doors and windows open",30,b+200),m.text("- Leave heat producing appliances near thermostats",30,b+210),m.setFillColor(119,183,11);var p=m.internal.pageSize.height||m.internal.pageSize.getHeight();m.rect(320,b+60,280,p-80-(b+60),"FD"),m.setFont("Comic Sans"),m.setTextColor(255,255,255),m.setFontSize(16),m.text("ADVERTISE WITH US",360,b+80);const f=m.getTextWidth("ADVERTISE WITH US");m.setLineWidth(.1),m.line(360,b+85,360+f,b+85),m.setFontSize(9),m.text("For advertisement, contact at",390,b+95),m.text("800 Logic (56442)",390,b+105),m.text("enquiry@logicutilities.com",390,b+115),m.text("www.logicutilities.com",390,b+125),m.setTextColor(0,0,0),m.setLineWidth(.1),m.line(5,p-70,607,p-70),m.text("For any enquiries, write to us enquiry@logicutilities.com \nor Logon to www.logicutilites.com",10,p-60),m.setTextColor(255,0,0),m.setFont("bold");const g=m.getTextWidth("Notice:");m.text("Notice:",340,p-60),m.setFont("none"),m.setTextColor(0,0,0),m.text("Pay your bills before due date to avoid late payment surcharge",340+g,p-60),m.text("and disconnection.",340,p-50),m.text("You can log onto www.logicutilites.com to pay your invoices \nTerms & Conditions for Supply of Utility Services",340,p-40),"function"==typeof m.putTotalPages&&m.putTotalPages("1");var v=m.output("blob");window.open(URL.createObjectURL(v))}onSendEmail(){this.refunds||this.notificationMessage("Refund Data not available.","yellow-snackbar")}onPrintSummary(){this.refunds&&this.refunds.length>0?this.downloadSummary(this.refunds):this.notificationMessage("Refund Data not available.","yellow-snackbar")}downloadSummary(e){let t=[],i=[],l=[],n=0;for(let o=0;o<e.length;o++)t.push(e[o].refundNumber),t.push(e[o].refundDateLocal),t.push(e[o].accountNumber),t.push(e[o].unitNumber),t.push(e[o].refundAmountLocal),t.push(e[o].remarks),i.push(t),n+=e[o].refundAmount,t=[];l.push({label:"Total Amount",value0:n});for(let o=0;o<l.length;o++)t.push(""),t.push(""),t.push(""),t.push(l[o].label),t.push(this.currency.transform(l[o].value0,this.currencyFormat.toString(),!0,this.roundOffFormat)),t.push(""),i.push(t),t=[];this.getSummaryReport(this.refunds,["Refund Number","Refund Date","Account No.","Unit","Refund Amount","Remarks"],i,"Refund Report")}getSummaryReport(e,t,i,l){var n=new Image;n.src="assets/img/logo.png";let o=new fe.default({orientation:"portrait",unit:"pt",format:"letter"});o.rect(5,5,o.internal.pageSize.width-10,o.internal.pageSize.height-10,"S"),o.setFontSize(30),o.addImage(n,"png",5,5,190,n.height),o.setTextColor(25,118,210),o.setFontSize(9),o.setFont("Cambria"),o.text("PO Box 127404",260,20),o.text("Office 201, Al Zarouni Business Centre",260,30),o.text("Al Barsha 1, Dubai, UAE",260,40),o.setTextColor(0,0,0),o.text("Phone:800 Logic (56442)",460,20),o.text("Email: ",460,30),o.setTextColor(25,118,210),o.text("enquiry@logicutilities.com",485,30),o.setTextColor(0,0,0),o.text("Web: ",460,40),o.setTextColor(25,118,210),o.text("www.logicutilities.com",485,40),o.setTextColor(0,0,0),o.setFontSize(12),o.setTextColor(25,118,210),o.text("Logic Utilities District Cooling Services LLC",10,70),o.text("TRN: 100567483100003",10,90),o.setTextColor(0,0,0),o.setFontSize(14),""!=this.fromDate&&""!=this.toDate?o.text("Refunds From "+R(this.fromDate).format("YYYY-MM-DD")+" To "+R(this.toDate).format("YYYY-MM-DD"),o.internal.pageSize.width/2-80,110):o.text("Refunds Report",o.internal.pageSize.width/2-20,70),o.setFontSize(9),Number(o.autoTable.previous.finalY),o.autoTable(t,i,{startX:10,startY:110,didDrawPage:function(e){var t="Page "+e.pageCount;"function"==typeof o.putTotalPages&&(t+=" of 1"),o.setFontSize(9);var i=o.internal.pageSize.height||o.internal.pageSize.getHeight();o.text(t,e.settings.margin.left,i-10)},styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:100,left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:80,halign:"left"},1:{cellWidth:80,halign:"center"},2:{cellWidth:80,halign:"center"},3:{cellWidth:80,halign:"center"},4:{cellWidth:100,halign:"right"},5:{cellWidth:120,halign:"center"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]}});var a=o.output("blob");window.open(URL.createObjectURL(a))}getJsonData(){this.tableData=[],null!=this.refunds&&this.refunds.forEach(e=>{let t={RefundNumber:e.refundNumber,RefundDate:this.date.transform(e.refundDate,"yyyy-MM-dd"),OwnerName:e.ownerName,UnitNumber:e.unitNumber,refundAmount:e.refundAmountLocal,Remarks:e.remarks};this.tableData.push(t)})}onExport(){if(this.refunds&&this.refunds.length>0){if(this.getJsonData(),null!=this.tableData){const e=vt.utils.json_to_sheet(this.tableData),t=vt.utils.book_new();vt.utils.book_append_sheet(t,e,"Sheet1"),vt.writeFile(t,"Refund.xlsx")}}else this.notificationMessage("No Data to Export","yellow-snackbar")}}return e.\u0275fac=function(t){return new(t||e)(m.Nb(c.a),m.Nb(F.a),m.Nb(a.d),m.Nb(a.f),m.Nb(s.a),m.Nb(l.f),m.Nb(k.b),m.Nb(pe.a),m.Nb(a.g),m.Nb(_.a),m.Nb(C.a),m.Nb(p.a))},e.\u0275cmp=m.Hb({type:e,selectors:[["fury-create-refund"]],viewQuery:function(e,t){var i;1&e&&(m.Jc(yt.a,!0),m.Vc(Ct.a,!0)),2&e&&(m.zc(i=m.cc())&&(t.paginator=i.first),m.zc(i=m.cc())&&(t.content=i.first))},inputs:{displayedColumns:"displayedColumns"},decls:24,vars:10,consts:[["mode","card",2,"margin-top","20px"],["fxLayout","column"],["color","primary",1,"top-padding","position-fixed"],["src","assets/img/fav-icon.png",1,"img-style"],[1,"toolbar-spacer"],[3,"show","hide","exportClicked","printClicked"],["fxFlex","grow",1,"basic-forms","route-animations-elements"],["class","person bottom-padding",4,"ngIf"],["fxFlex","grow","fxLayout","column",1,"list",3,"hideHeader","filterChange"],["mat-table","","matSort","",1,"list",3,"dataSource"],[4,"ngFor","ngForOf"],["matColumnDef","refundAmountLocal"],["mat-header-cell","","class","header-align-right",4,"matHeaderCellDef"],["mat-cell","","class","header-align-right",4,"matCellDef"],["matColumnDef","actions"],["class","actions-cell","mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["class","actions-cell","mat-cell","",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["class","clickable route-animations-elements","mat-row","",4,"matRowDef","matRowDefColumns"],[1,"paginator",3,"pageSize"],[1,"person","bottom-padding"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","20px"],["color","primary",1,"result"],["id","FromDate","name","FromDate","matInput","","readonly","",3,"ngModel","matDatepicker","click","ngModelChange","focus"],["matSuffix","",3,"for"],["formDatepickerRef1",""],["id","ToDate","name","ToDate","matInput","","readonly","",3,"ngModel","matDatepicker","click","ngModelChange","focus"],["formDatepickerRef2",""],[3,"formGroup"],["color","primary",1,"result",2,"width","400px"],["type","text","formControlName","tenantName","name","tenantName","matInput","",3,"matAutocomplete"],[3,"optionSelected"],["tenant","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[1,"top-padding"],["color","primary","mat-button","",3,"click"],[3,"value"],[3,"matColumnDef",4,"ngIf"],[3,"matColumnDef"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell","",1,"header-align-right"],["mat-cell","",1,"header-align-right"],["mat-header-cell","","mat-sort-header","",1,"actions-cell"],["mat-cell","",1,"actions-cell"],["type","button","mat-icon-button","",3,"matMenuTriggerFor","click"],["yPosition","below","xPosition","before"],["actionsMenu","matMenu"],["mat-menu-item","",3,"click"],["mat-header-row",""],["mat-row","",1,"clickable","route-animations-elements"]],template:function(e,t){1&e&&(m.Tb(0,"fury-page-layout",0),m.Tb(1,"fury-page-layout-content",1),m.Tb(2,"mat-toolbar",2),m.Ob(3,"img",3),m.Tb(4,"span"),m.Rc(5,"Refund Report"),m.Sb(),m.Ob(6,"span",4),m.Tb(7,"fury-payment-history-footer-toolbar",5),m.bc("exportClicked",(function(){return t.onExport()}))("printClicked",(function(){return t.onPrintSummary()})),m.Sb(),m.Sb(),m.Tb(8,"fury-card",6),m.Ob(9,"fury-card-header"),m.Tb(10,"fury-card-content"),m.Pc(11,Sl,30,9,"div",7),m.Tb(12,"fury-list",8),m.bc("filterChange",(function(e){return t.onFilterChange(e)})),m.Tb(13,"table",9),m.Pc(14,wl,2,1,"ng-container",10),m.Rb(15,11),m.Pc(16,Nl,2,0,"th",12),m.Pc(17,xl,2,1,"td",13),m.Qb(),m.Rb(18,14),m.Pc(19,Al,1,0,"th",15),m.Pc(20,Fl,12,1,"td",16),m.Qb(),m.Pc(21,Rl,1,0,"tr",17),m.Pc(22,kl,1,0,"tr",18),m.Sb(),m.Ob(23,"mat-paginator",19),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb()),2&e&&(m.Cb(7),m.mc("show",!1)("hide",t.isData),m.Cb(1),m.mc("@fadeInUp",void 0),m.Cb(3),m.mc("ngIf",0==t.ownerId),m.Cb(1),m.mc("hideHeader",!1),m.Cb(1),m.mc("dataSource",t.dataSource),m.Cb(1),m.mc("ngForOf",t.displayedColumns),m.Cb(7),m.mc("matHeaderRowDef",t.visibleColumns),m.Cb(1),m.mc("matRowDefColumns",t.visibleColumns),m.Cb(1),m.mc("pageSize",t.pageSize))},directives:[X.a,$.a,S.d,q.a,ii.a,f.a,S.b,f.d,f.c,a.o,St.a,re.j,Ct.a,a.n,re.c,re.e,re.b,re.g,re.i,yt.a,S.e,I.d,I.h,W.b,l.c,B.b,l.q,l.t,B.d,I.j,B.a,l.z,l.r,l.k,ye.c,l.i,ye.a,I.g,P.a,w.a,L.n,re.d,Ct.b,re.a,yl.d,yl.e,yl.b,re.f,re.h],styles:[".top-padding[_ngcontent-%COMP%]{padding-top:.7%}.bottom-padding[_ngcontent-%COMP%]{padding-bottom:2%}.toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.img-style[_ngcontent-%COMP%]{width:32px}.position-fixed[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;top:0;z-index:5}.right-margin[_ngcontent-%COMP%]{margin-right:5px}.header-align-right[_ngcontent-%COMP%]{text-align:right}"],data:{animation:[d.a,u.a]}}),e})(),Ol=(()=>{class e{constructor(e,t,i){var l,n,o;this.date=e,this.currencyPipe=t,this.envService=i,this.outStandingBills=[],this.selectedRows=[],this.columns=[],this.dateColumnName="Date",this.billNumberConsumptionColumnName="Bill No",this.unitColumnName="Unit",this.amountColumnName="Amount",this.paidColumnName="Paid",this.toPayColumnName="To Pay",this.format="",this.currency="",this.roundFormat="",this.isHide=!0,this.rowsSelected=new m.o,this.format=null!==(l=Object(b.e)("DateFormat"))&&void 0!==l?l:i.dateFormat,this.currency=null!==(n=Object(b.e)("Currency"))&&void 0!==n?n:i.currencyFormat,this.roundFormat=null!==(o=Object(b.e)("RoundOff"))&&void 0!==o?o:i.roundOffFormat}set dataSource(e){e&&(this.outStandingBills=e.outstandingBills&&e.outstandingBills.length?this.updateDataFormats(e.outstandingBills):[])}ngOnInit(){this.createGridColumns(),this.isHide&&this.updateTableColumns()}createGridColumns(){this.columns=[{name:"Checkbox",property:"checkbox",visible:!0},{name:this.dateColumnName,property:"billDateLocal",visible:!0,isModelProperty:!0},{name:this.billNumberConsumptionColumnName,property:"billNumber",visible:!0,isModelProperty:!0},{name:this.unitColumnName,property:"unitNumber",visible:!0,isModelProperty:!0},{name:this.amountColumnName,property:"billAmountLocal",visible:!0,isModelProperty:!0},{name:this.paidColumnName,property:"paidLocal",visible:!0,isModelProperty:!0},{name:this.toPayColumnName,property:"toPayLocal",visible:!0,isModelProperty:!0}]}updateTableColumns(){this.columns.splice(0,1)}onSelectedRows(e){this.selectedRows=[],this.selectedRows=e,this.rowsSelected.emit(this.selectedRows)}updateDataFormats(e){return e&&e.forEach(e=>{e.billDateLocal=this.date.transform(e.billDate.toString(),this.format.toString()),e.billAmountLocal=this.currencyPipe.transform(e.billAmount,this.currency.toString(),!0,this.roundFormat),e.toPayLocal=this.currencyPipe.transform(e.toPay,this.currency.toString(),!0,this.roundFormat),e.paidLocal=this.currencyPipe.transform(e.paid,this.currency.toString(),!0,this.roundFormat)}),e}}return e.\u0275fac=function(t){return new(t||e)(m.Nb(a.f),m.Nb(a.d),m.Nb(p.a))},e.\u0275cmp=m.Hb({type:e,selectors:[["fury-tenant-outstanding-bills"]],inputs:{isHide:"isHide",dataSource:"dataSource"},outputs:{rowsSelected:"rowsSelected"},decls:5,vars:2,consts:[[1,"person"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","1px"],[1,"fury-flex-form-field"],[3,"tableData","columns","selectedRows"]],template:function(e,t){1&e&&(m.Tb(0,"mat-dialog-content"),m.Tb(1,"div",0),m.Tb(2,"div",1),m.Tb(3,"div",2),m.Tb(4,"app-table-structure",3),m.bc("selectedRows",(function(e){return t.onSelectedRows(e)})),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb()),2&e&&(m.Cb(4),m.mc("tableData",t.outStandingBills)("columns",t.columns))},directives:[h.f,S.d,S.e,g.a],styles:[""]}),e})(),Wl=(()=>{class e{constructor(e,t,i,l,n,o,a){var s;this.billSettlementService=e,this.billService=t,this.snackbar=i,this.decimalPipe=l,this.date=n,this.cookieService=o,this.envService=a,this.totAmt=0,this.tenantId="0",this._gap=16,this.gap=this._gap+"px",this.col2=`1 1 calc(50% - ${this._gap/2}px)`,this.col3=`1 1 calc(33.3333% - ${this._gap/1.5}px)`,this.billPeriods=[{label:"Select",value:0}],this.billSettlement={outstandingBills:[]},this.paymentModes=[{label:"Select",value:0}],this.banks=[{label:"Select",value:0}],this.tenants=[],this.manageParams={},this.billPayment={},this.selectedRows=[],this.bankId=0,this.remarks="",this.paymentModeId=0,this.paymentDate=new Date,this.refNumber="",this.paymentAmount=0,this.excessAmount=0,this.labelName="",this.roundFormat="",this.roundFormat=null!==(s=Object(b.e)("RoundOff"))&&void 0!==s?s:a.roundOffFormat}ngOnInit(){this.clientId=parseInt(this.cookieService.get("globalClientId")),this.onGetBillDetails()}getBillPeriods(){this.billPeriods=[{label:"Select",value:0,fromDate:Date.now.toString(),ToDate:Date.now.toString()}],this.billService.getBillPeriods(this.clientId).subscribe(e=>{e.forEach(e=>{this.billPeriods.push({label:e.periodDescription,value:e.id,fromDate:e.periodStart,toDate:e.periodEnd})})})}onGetBanks(e){this.banks=[{label:"Select",value:0}],this.billSettlementService.getBanks(e).subscribe(e=>{e.forEach(e=>{this.banks.push({label:e.description,value:e.id})})})}onGetBillDetails(){this.tenantId=this.cookieService.get("ownerId"),this.billSettlementService.getTenantBillDetails(this.tenantId).subscribe({next:e=>{this.billSettlement=e},error:e=>{this.notificationMessage("Outstanding Bills Not Found.","yellow-snackbar")}})}onSaveBillPayment(e){const t=this.outstandingBillsComponent.selectedRows;t&&t.length&&(this.onGetValues(),this.updateBillPayments(),this.updatePaymentTransactions(),this.billSettlementService.saveBillPayments(this.billPayment).subscribe({next:e=>{e?"Excess Amount"===this.labelName&&this.excessAmount>0&&0!==e?this.saveAdvancePaymentDetails(e):(this.notificationMessage("Bill payment saved successfully","green-snackbar"),this.reset()):this.notificationMessage("Bill payment save failed","green - snackbar")},error:e=>{this.notificationMessage("Bill payment save failed","red-snackbar")}}))}updatePaymentTransactions(){let e=[],t=[];e=this.outstandingBillsComponent.selectedRows,e=this.outstandingBillsComponent.selectedRows,e&&e.length&&e.forEach(e=>{t.push({billId:e.id,paidAmount:e.billAmount,advanceAmount:0})}),this.billPayment.paymentTransactions=t}onGetValues(){this.bankId=this.paymentDetailsComponent.bankId,this.remarks=this.paymentDetailsComponent.remarks,this.paymentModeId=this.paymentDetailsComponent.paymentModeId,this.paymentDate=new Date(this.paymentDetailsComponent.paymentDate),this.refNumber=this.paymentDetailsComponent.refNumber,this.paymentAmount=Number(this.billAmountDetailsComponent.toPay),this.excessAmount=this.billAmountDetailsComponent.excessAmount,this.labelName=this.billAmountDetailsComponent.labelName}updateBillPayments(){this.billPayment={paymentDate:this.date.transform(this.paymentDate,"yyyy-MM-dd"),paymentAmount:Number(this.paymentAmount),clientId:Number(this.cookieService.get("globalClientId")),billType:1,ownerId:this.outstandingBillsComponent.selectedRows[0].ownerId,modeofPayment:this.paymentModeId,paymentReference:this.refNumber,remarks:this.remarks}}notificationMessage(e,t){this.snackbar.open(e,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[t]})}onSelectedRows(e){this.selectedRows=[],this.selectedRows=e,this.totAmt=0,this.selectedRows&&this.selectedRows.length?this.selectedRows.forEach(e=>{this.totAmt+=e.toPay}):this.totAmt=0,this.totAmt=Number(this.decimalPipe.transform(this.totAmt,this.roundFormat).replace(",",""))}saveAdvancePaymentDetails(e){const t={advanceDate:this.paymentDate,paymentId:e,advanceAmount:Number(this.excessAmount)};this.billService.saveAdvancePayment(t).subscribe(e=>{e?(this.notificationMessage("Bill payment saved successfully","green-snackbar"),this.reset()):this.notificationMessage("Bill payment save failed","green - snackbar")})}reset(){this.bankId=this.paymentDetailsComponent.bankId=0,this.remarks=this.paymentDetailsComponent.remarks="",this.paymentModeId=this.paymentDetailsComponent.paymentModeId=0,this.paymentDate=new Date(Date.now.toString()),this.refNumber=this.paymentDetailsComponent.refNumber="",this.paymentAmount=0,this.billAmountDetailsComponent.toPay="0",this.excessAmount=this.billAmountDetailsComponent.excessAmount=0,this.billSettlement={outstandingBills:[]}}}return e.\u0275fac=function(t){return new(t||e)(m.Nb(F.a),m.Nb(c.a),m.Nb(k.b),m.Nb(a.g),m.Nb(a.f),m.Nb(C.a),m.Nb(p.a))},e.\u0275cmp=m.Hb({type:e,selectors:[["fury-tenant-payment"]],viewQuery:function(e,t){var i;1&e&&(m.Jc(oe,!0),m.Jc(he,!0),m.Jc(me,!0)),2&e&&(m.zc(i=m.cc())&&(t.paymentDetailsComponent=i.first),m.zc(i=m.cc())&&(t.outstandingBillsComponent=i.first),m.zc(i=m.cc())&&(t.billAmountDetailsComponent=i.first))},decls:22,vars:7,consts:[["mode","card"],["color","primary"],["src","assets/img/fav-icon.png",1,"img-style"],[1,"toolbar-spacer"],["fxLayout","column",1,"padding-top",3,"fxLayoutGap"],["fxFlex","noshrink","fxLayout","column","fxLayout.gt-sm","row","fxLayoutAlign.gt-sm","start stretch",3,"fxLayoutGap"],["fxFlex","grow",1,"basic-forms","route-animations-elements",3,"fxFlex.gt-sm"],["fxLayout","row","fxLayoutGap","5%"],["fxLayout","column"],[3,"dataSource","isHide","rowsSelected"],["fxFlex.xs","100%","fxFlex","50%",1,"content"],[2,"width","220px"],["disabled","","type","number","id","totAmtId","name","totAmtNa","matInput","",3,"ngModel","ngModelChange"],["mat-raised-button","","color","primary",1,"button-style"]],template:function(e,t){1&e&&(m.Tb(0,"fury-page-layout",0),m.Tb(1,"mat-toolbar",1),m.Ob(2,"img",2),m.Tb(3,"span"),m.Rc(4,"Tenant Bill Payment"),m.Sb(),m.Ob(5,"span",3),m.Sb(),m.Tb(6,"fury-page-layout-content",4),m.Tb(7,"div",5),m.Tb(8,"fury-card",6),m.Tb(9,"fury-card-header"),m.Tb(10,"fury-card-header-heading"),m.Rc(11,"Outstanding Bills"),m.Sb(),m.Sb(),m.Tb(12,"fury-card-content",7),m.Tb(13,"div",8),m.Tb(14,"fury-tenant-outstanding-bills",9),m.bc("rowsSelected",(function(e){return t.onSelectedRows(e)})),m.Sb(),m.Sb(),m.Tb(15,"div",10),m.Tb(16,"b"),m.Rc(17,"Total Amount"),m.Sb(),m.Tb(18,"mat-form-field",11),m.Tb(19,"input",12),m.bc("ngModelChange",(function(e){return t.totAmt=e})),m.Sb(),m.Sb(),m.Tb(20,"button",13),m.Rc(21,"Proceed To Payment"),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb()),2&e&&(m.Cb(6),m.mc("fxLayoutGap",t.gap),m.Cb(1),m.mc("fxLayoutGap",t.gap),m.Cb(1),m.mc("fxFlex.gt-sm",t.col2)("@fadeInUp",void 0),m.Cb(6),m.mc("dataSource",t.billSettlement)("isHide",!1),m.Cb(5),m.mc("ngModel",t.totAmt))},directives:[X.a,q.a,$.a,S.d,S.e,S.b,S.c,f.a,f.d,f.g,f.c,Ol,I.d,l.u,W.b,l.c,l.q,l.t,P.a],styles:[".toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.img-style[_ngcontent-%COMP%]{width:32px}.button-style[_ngcontent-%COMP%]{align-self:center}"],data:{animation:[d.a,u.a]}}),e})();var Ml=i("nST0");let Ll=(()=>{class e{constructor(){this.printClicked=new m.o}ngOnInit(){}onPrint(){this.printClicked.emit()}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=m.Hb({type:e,selectors:[["fury-invoice-aging-report-footer-toolbar"]],outputs:{printClicked:"printClicked"},decls:5,vars:0,consts:[[1,"person"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutAlign","end end","fxLayoutGap.gt-sm","24px"],[1,"fury-flex-form-field"]],template:function(e,t){1&e&&(m.Tb(0,"mat-dialog-content"),m.Tb(1,"div",0),m.Tb(2,"form"),m.Tb(3,"div",1),m.Ob(4,"div",2),m.Sb(),m.Sb(),m.Sb(),m.Sb())},directives:[h.f,l.z,l.r,l.s,S.d,S.c,S.e],styles:[".button[_ngcontent-%COMP%]{line-height:50px}"]}),e})();const Bl=["htmlData"];function zl(e,t){if(1&e){const e=m.Ub();m.Tb(0,"fury-invoice-aging-report-footer-toolbar",21),m.bc("printClicked",(function(){return m.Ec(e),m.fc().onPrintPdf()})),m.Sb()}}let Ul=(()=>{class e{constructor(e,t,i,l,n,o,a,s,r,c){var u,d,m;this.billService=e,this.date=t,this.decimalPipe=i,this.currencyPipe=l,this.snackbar=n,this.jwtHelperService=o,this.cookieService=a,this.clientSelectionService=s,this.clientService=r,this.envService=c,this.role="",this._gap=16,this.gap=this._gap+"px",this.col2=`1 1 calc(50% - ${this._gap/2}px)`,this.col3=`1 1 calc(33.3333% - ${this._gap/1.5}px)`,this.invoiceAgingReport=[],this.selectedRows=[],this.imageProperties=[],this.columns=[],this.columnNames=[],this.billAmount="",this.billPeriodId=0,this.billPeriods=[{label:"Select",value:0}],this.fromDate="",this.toDate="",this.dateFormat="",this.currency="",this.roundFormat="",this.filePath="",this.ownerId=0,this.billNumberColumnName="Account Number",this.ownerNameColumnName="Owner",this.totalBalanceColumnName="Total Balance",this.balance30ColumnName="30 Days",this.balance60ColumnName="60 Days",this.balance90ColumnName="90 Days",this.balance120ColumnName="180 Days",this.balanceabove120ColumnName="Above 180 Days",this.filePath=c.backendForFiles,this.roundFormat=null!==(u=Object(b.e)("RoundOff"))&&void 0!==u?u:c.roundOffFormat,this.currency=null!==(d=Object(b.e)("Currency"))&&void 0!==d?d:c.currencyFormat,this.dateFormat=null!==(m=Object(b.e)("DateFormat"))&&void 0!==m?m:c.dateFormat}get visibleColumns(){return this.columns.filter(e=>e.visible).map(e=>e.property)}ngOnInit(){var e;this.today=new Date,this.toDate=(new Date).toISOString().substr(0,10),this.clientSelectionService.setIsClientVisible(!0);let t=this.cookieService.get("access_token");const i=this.jwtHelperService.decodeToken(t);i&&(this.role=i["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"]),this.ownerId=parseInt(null!==(e=this.cookieService.get("ownerId"))&&void 0!==e?e:"0"),this.createColumnNames(),this.createGridColumns(),this.clientId=parseInt(this.cookieService.get("globalClientId")),this.getBillPeriods()}createGridColumns(){this.columns=["accountNumber","owner","totalBalancelocal","balance30Local","balance60Local","balance90Local","balance180Local","balanceAbove180Local"]}createColumnNames(){this.columnNames=[{name:this.billNumberColumnName,property:"accountNumber"},{name:this.ownerNameColumnName,property:"owner"},{name:this.totalBalanceColumnName,property:"totalBalancelocal",columnAlign:{"text-align":"right"}},{name:this.balance30ColumnName,property:"balance30Local",columnAlign:{"text-align":"right"}},{name:this.balance60ColumnName,property:"balance60Local",columnAlign:{"text-align":"right"}},{name:this.balance90ColumnName,property:"balance90Local",columnAlign:{"text-align":"right"}},{name:this.balance120ColumnName,property:"balance180Local",columnAlign:{"text-align":"right"}},{name:this.balanceabove120ColumnName,property:"balanceAbove180Local",columnAlign:{"text-align":"right"}}]}ngAfterViewInit(){}getInvoiceAgingReport(){this.billAmount="";let e=0;if(this.toDate){let t=""==this.toDate?"":R(this.toDate).format("YYYY-MM-DD");this.billService.getInvoiceAgingReport(this.clientId,t).subscribe(t=>{this.dateFormat=Object(b.e)("DateFormat"),this.roundFormat=Object(b.e)("RoundOff"),this.currency=Object(b.e)("Currency"),t.forEach(t=>{t.billDatelocal=this.date.transform(t.billDate.toString(),this.dateFormat.toString()),t.totalBalancelocal=this.currencyPipe.transform(t.totalBalance,this.currency.toString(),!0,this.roundFormat),t.balance30Local=this.currencyPipe.transform(t.balance30,this.currency.toString(),!0,this.roundFormat),t.balance60Local=this.currencyPipe.transform(t.balance60,this.currency.toString(),!0,this.roundFormat),t.balance90Local=this.currencyPipe.transform(t.balance90,this.currency.toString(),!0,this.roundFormat),t.balance180Local=this.currencyPipe.transform(t.balance180,this.currency.toString(),!0,this.roundFormat),t.balanceAbove180Local=this.currencyPipe.transform(t.balanceAbove180,this.currency.toString(),!0,this.roundFormat),e+=t.totalBalance}),this.invoiceAgingReport=t,this.billAmount=this.currencyPipe.transform(e,this.currency.toString(),!0,this.roundFormat)})}else this.snackbar.open("Invalid search parameters",null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:["yellow-snackbar"]})}onPrintPdf(){this.getClientImageProperties()}getClientImageProperties(){this.imageProperties=[],this.clientService.getClientImageProperties(this.clientId).subscribe({next:e=>{e&&e.length&&(this.imageProperties=e,this.downloadReport(this.invoiceAgingReport))},error(){this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar"),this.downloadReport(this.invoiceAgingReport)}})}downloadReport(e){let t=[],i=[],l=[],n=0;for(let o=0;o<e.length;o++)t.push(e[o].accountNumber),t.push(e[o].owner),t.push(e[o].totalBalancelocal),t.push(e[o].balance30Local),t.push(e[o].balance60Local),t.push(e[o].balance90Local),t.push(e[o].balance180Local),t.push(e[o].balanceAbove180Local),i.push(t),n+=e[o].totalBalance,t=[];l.push({label:"Total Amount",value1:n});for(let o=0;o<l.length;o++)t.push(""),t.push(l[o].label),t.push(this.currencyPipe.transform(l[o].value1,this.currency.toString(),!0,this.roundFormat)),t.push(""),t.push(""),t.push(""),t.push(""),t.push(""),i.push(t),t=[];this.getSummaryReport(this.invoiceAgingReport,["Account Number","Owner","Total Balance","Balance 30","Balance 60 ","Balance 90 ","Balance 180","Balance Above 180"],i,"Invoice Aging Report")}getSummaryReport(e,t,i,l){var n,o=new Image;o.src=this.filePath+"/uploads/"+(null===(n=this.imageProperties[0])||void 0===n?void 0:n.photo);let a=new fe.default({orientation:"landscape",unit:"pt",format:"letter"});const s=R().format("M/D/YYYY hh:mm:ss a");if(a.rect(5,5,a.internal.pageSize.width-10,a.internal.pageSize.height-10,"S"),a.setFontSize(30),o&&e&&this.imageProperties&&this.imageProperties.length){const e=this.imageProperties.find(e=>"landscape"===e.imageType.trim().toLowerCase());e&&(o.onload=function(){a.addImage(o,e.imgX,e.imgY,e.imgW,e.imgH)})}a.setTextColor(25,118,210),a.setFontSize(9),a.setFont("Cambria"),a.setTextColor(0,0,0),a.text("Print Date: "+s,a.internal.pageSize.width-150,20),a.setFontSize(14),a.text("Invoice Aging Report ",a.internal.pageSize.width/2-50,60),a.setFontSize(9),Number(this.decimalPipe.transform(a.autoTable.previous.finalY,"1.0-0")),a.autoTable(t,i,{startX:10,startY:80,didDrawPage:function(e){var t="Page "+e.pageCount;"function"==typeof a.putTotalPages&&(t+=" of 1"),a.setFontSize(9);var i=a.internal.pageSize.height||a.internal.pageSize.getHeight();a.text(t,e.settings.margin.left,i-10)},styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:100,left:20},theme:"grid",tableWidth:"auto",columnStyles:{0:{cellWidth:"wrap",halign:"left"},1:{cellWidth:100,halign:"left"},2:{cellWidth:"wrap",halign:"right"},3:{cellWidth:"wrap",halign:"right"},4:{cellWidth:"wrap",halign:"right"},5:{cellWidth:"wrap",halign:"right"},6:{cellWidth:"wrap",halign:"right"},7:{cellWidth:"wrap",halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]}});var r=a.output("blob");window.open(URL.createObjectURL(r))}notificationMessage(e,t){this.snackbar.open(e,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[t]})}getJsonData(){this.tableData=[];let e=0;if(null!=this.invoiceAgingReport){this.invoiceAgingReport.forEach(t=>{let i={AccountNumber:t.accountNumber,Owner:t.owner,TotalBalance:t.totalBalancelocal,"30Days":t.balance30Local,"60Days":t.balance60Local,"90Days":t.balance90Local,"180Days":t.balance180Local,Above180Days:t.balanceAbove180Local};e+=Number(i.TotalBalance.replace(/[^0-9\.-]+/g,"")),this.tableData.push(i)});let t={AccountNumber:"",Owner:"Total Amount",TotalBalance:this.currencyPipe.transform(e,this.currency.toString(),!0,this.roundFormat.toString())};this.tableData.push(t)}}onExport(){if(this.invoiceAgingReport&&this.invoiceAgingReport.length>0){if(this.getJsonData(),null!=this.tableData&&this.tableData.length>0){const e=vt.utils.json_to_sheet(this.tableData),t=vt.utils.book_new();vt.utils.book_append_sheet(t,e,"Sheet1"),vt.writeFile(t,"Invoice Aging Report.xlsx")}}else this.notificationMessage("No Data to Export","yellow-snackbar")}getBillPeriods(){this.clientId=parseInt(this.cookieService.get("globalClientId")),this.billPeriods=[{label:"Select",value:0,fromDate:Date.now.toString(),ToDate:Date.now.toString()}],this.billService.getBillPeriods(this.clientId).subscribe(e=>{e.forEach(e=>{this.billPeriods.push({label:e.periodDescription,value:e.id,fromDate:e.periodStart,toDate:e.periodEnd})})})}onChangeBillPeriod(e){this.billPeriodId=e}}return e.\u0275fac=function(t){return new(t||e)(m.Nb(c.a),m.Nb(a.f),m.Nb(a.g),m.Nb(a.d),m.Nb(k.b),m.Nb(y.a),m.Nb(C.a),m.Nb(_.a),m.Nb(Ml.a),m.Nb(p.a))},e.\u0275cmp=m.Hb({type:e,selectors:[["invoice-aging-report"]],viewQuery:function(e,t){var i;1&e&&m.Vc(Bl,!0),2&e&&m.zc(i=m.cc())&&(t.htmlData=i.first)},decls:32,vars:12,consts:[["mode","card",2,"margin-top","27px"],["fxLayout","column",1,"content"],["color","primary",1,"position-fixed"],["src","assets/img/fav-icon.png",1,"img-style"],[1,"example-spacer"],[3,"printClicked",4,"ngIf"],["matTooltip","Export","mat-icon-button","","aria-label","Example icon-button with menu icon",1,"example-icon",3,"click"],["fxFlex","noshrink","fxLayout","column","fxLayout.gt-sm","row","fxLayoutAlign.gt-sm","start stretch",3,"fxLayoutGap"],["fxFlex","grow",1,"basic-forms","route-animations-elements",3,"fxFlex.gt-sm"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","16px",1,"padding-top",2,"padding-left","25px"],["color","primary",1,"result"],["id","toDate","name","toDate","matInput","","readonly","",3,"ngModel","max","matDatepicker","click","ngModelChange","focus"],["matSuffix","",3,"for"],["formDatepickerRef2",""],[1,"fury-flex-form-field","seach-icon"],[3,"click"],["fxLayout","column"],["fxLayout","column",1,"padding-top"],[3,"tableData","columnsToDisplay","columnNames"],["fxLayout.gt-sm","row","fxLayout","column","fxLayoutAlign","center start","fxLayoutGap.gt-sm","12px",1,"result","padding-top"],["type","text","id","billAmount","name","billAmount","matInput","",2,"text-align","right",3,"ngModel","ngModelChange"],[3,"printClicked"]],template:function(e,t){if(1&e){const e=m.Ub();m.Tb(0,"fury-page-layout",0),m.Tb(1,"fury-page-layout-content",1),m.Tb(2,"mat-toolbar",2),m.Ob(3,"img",3),m.Tb(4,"span"),m.Rc(5,"Invoice Aging Report"),m.Sb(),m.Ob(6,"span",4),m.Pc(7,zl,1,0,"fury-invoice-aging-report-footer-toolbar",5),m.Tb(8,"button",6),m.bc("click",(function(){return t.onExport()})),m.Tb(9,"mat-icon"),m.Rc(10,"import_export"),m.Sb(),m.Sb(),m.Sb(),m.Tb(11,"div",7),m.Tb(12,"fury-card",8),m.Tb(13,"div",9),m.Tb(14,"mat-form-field",10),m.Tb(15,"mat-label"),m.Rc(16,"As of Date"),m.Sb(),m.Tb(17,"input",11),m.bc("click",(function(){return m.Ec(e),m.Ac(20).open()}))("ngModelChange",(function(e){return t.toDate=e}))("focus",(function(){return m.Ec(e),m.Ac(20).open()})),m.Sb(),m.Ob(18,"mat-datepicker-toggle",12),m.Ob(19,"mat-datepicker",null,13),m.Sb(),m.Tb(21,"div",14),m.Tb(22,"mat-icon",15),m.bc("click",(function(){return t.getInvoiceAgingReport()})),m.Rc(23,"search"),m.Sb(),m.Sb(),m.Sb(),m.Tb(24,"fury-card-content",16),m.Tb(25,"div",17),m.Ob(26,"fury-expandable-table-structure",18),m.Sb(),m.Tb(27,"div",19),m.Tb(28,"mat-form-field",10),m.Tb(29,"mat-label"),m.Rc(30,"Total"),m.Sb(),m.Tb(31,"input",20),m.bc("ngModelChange",(function(e){return t.billAmount=e})),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb()}if(2&e){const e=m.Ac(20);m.Cb(7),m.mc("ngIf",0==t.ownerId),m.Cb(4),m.mc("fxLayoutGap",t.gap),m.Cb(1),m.mc("fxFlex.gt-sm",t.col2)("@fadeInUp",void 0),m.Cb(5),m.mc("ngModel",t.toDate)("max",t.today)("matDatepicker",e),m.Cb(1),m.mc("for",e),m.Cb(8),m.mc("tableData",t.invoiceAgingReport)("columnsToDisplay",t.columns)("columnNames",t.columnNames),m.Cb(5),m.mc("ngModel",t.billAmount)}},directives:[X.a,$.a,S.d,q.a,a.o,P.a,D.a,w.a,S.b,S.c,S.e,f.a,I.d,I.h,W.b,l.c,B.b,l.q,l.t,B.d,I.j,B.a,f.c,T.a,Ll],styles:[".padding[_ngcontent-%COMP%]{padding:0 0 24px}.example-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.content[_ngcontent-%COMP%]{margin-top:2%}.img-style[_ngcontent-%COMP%]{width:32px}.button[_ngcontent-%COMP%]{line-height:50px}.left-margin[_ngcontent-%COMP%]{margin-left:30px}.seach-icon[_ngcontent-%COMP%]{vertical-align:middle;padding-top:1%;margin-left:1%;cursor:pointer}.position-fixed[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;top:0;z-index:5}"],data:{animation:[d.a,u.a]}}),e})();const El=["TABLE"];function jl(e,t){if(1&e&&(m.Tb(0,"th",9),m.Rc(1),m.Sb()),2&e){const e=m.fc().$implicit,t=m.fc();m.Cb(1),m.Sc(t.capitalize(e))}}function Hl(e,t){if(1&e&&(m.Tb(0,"td",10),m.Rc(1),m.Sb()),2&e){const e=t.$implicit,i=m.fc().$implicit;m.Cb(1),m.Sc(e[i])}}function Yl(e,t){1&e&&(m.Rb(0,6),m.Pc(1,jl,2,1,"th",7),m.Pc(2,Hl,2,1,"td",8),m.Qb()),2&e&&m.mc("matColumnDef",t.$implicit)}function Vl(e,t){1&e&&m.Ob(0,"tr",11)}function _l(e,t){1&e&&m.Ob(0,"tr",12)}let Gl=(()=>{class e{constructor(){this.tableData=[],this.columnNames=[]}ngOnInit(){}capitalize(e){return(e=e.replace("Local","")).charAt(0).toUpperCase()+e.slice(1)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=m.Hb({type:e,selectors:[["fury-dynamic-table-structure"]],viewQuery:function(e,t){var i;1&e&&m.Vc(El,!0),2&e&&m.zc(i=m.cc())&&(t.table=i.first)},inputs:{tableData:"tableData",columnNames:"columnNames"},decls:6,vars:4,consts:[[1,"example-container","mat-elevation-z8"],["TABLE",""],["mat-table","",1,"mat-elevation-z8",3,"dataSource"],[3,"matColumnDef",4,"ngFor","ngForOf"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[3,"matColumnDef"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-cell",""],["mat-cell",""],["mat-header-row",""],["mat-row",""]],template:function(e,t){1&e&&(m.Tb(0,"div",0,1),m.Tb(2,"table",2),m.Pc(3,Yl,3,1,"ng-container",3),m.Pc(4,Vl,1,0,"tr",4),m.Pc(5,_l,1,0,"tr",5),m.Sb(),m.Sb()),2&e&&(m.Cb(2),m.mc("dataSource",t.tableData),m.Cb(1),m.mc("ngForOf",t.columnNames),m.Cb(1),m.mc("matHeaderRowDef",t.columnNames),m.Cb(1),m.mc("matRowDefColumns",t.columnNames))},directives:[re.j,a.n,re.g,re.i,re.c,re.e,re.b,re.d,re.a,re.f,re.h],styles:["h3[_ngcontent-%COMP%]{font-family:Verdana}table[_ngcontent-%COMP%]{width:100%}"]}),e})();function Xl(e,t){if(1&e&&(m.Tb(0,"mat-option",16),m.Rc(1),m.Sb()),2&e){const e=t.$implicit;m.mc("value",e.value),m.Cb(1),m.Tc("",e.label," ")}}function $l(e,t){if(1&e&&(m.Tb(0,"th",27),m.Rc(1),m.Sb()),2&e){const e=m.fc().$implicit;m.Cb(1),m.Tc(" ",e.name,"")}}function ql(e,t){if(1&e&&(m.Tb(0,"td",28),m.Rc(1),m.Sb()),2&e){const e=t.$implicit,i=m.fc().$implicit;m.mc("ngStyle",i.columnAlign),m.Cb(1),m.Tc(" ",e[i.property]," ")}}function Jl(e,t){1&e&&(m.Rb(0,24),m.Pc(1,$l,2,1,"th",25),m.Pc(2,ql,2,2,"td",26),m.Qb()),2&e&&m.mc("matColumnDef",t.$implicit.property)}function Ql(e,t){1&e&&m.Ob(0,"tr",29)}function Kl(e,t){1&e&&m.Ob(0,"tr",30)}function Zl(e,t){if(1&e&&(m.Tb(0,"div",17),m.Tb(1,"fury-list",18),m.Tb(2,"table",19),m.Pc(3,Jl,3,1,"ng-container",20),m.Pc(4,Ql,1,0,"tr",21),m.Pc(5,Kl,1,0,"tr",22),m.Sb(),m.Ob(6,"mat-paginator",23),m.Sb(),m.Sb()),2&e){const e=m.fc();m.Cb(1),m.mc("hideHeader",!0)("hideFilter",!0),m.Cb(1),m.mc("dataSource",e.dataSource),m.Cb(1),m.mc("ngForOf",e.columnNames),m.Cb(1),m.mc("matHeaderRowDef",e.visibleColumns),m.Cb(1),m.mc("matRowDefColumns",e.visibleColumns),m.Cb(1),m.mc("pageSize",e.pageSize)}}function en(e,t){if(1&e){const e=m.Ub();m.Tb(0,"mat-form-field",8),m.Tb(1,"mat-label"),m.Rc(2,"Bill Amount"),m.Sb(),m.Tb(3,"input",31),m.bc("ngModelChange",(function(t){return m.Ec(e),m.fc().billAmount=t})),m.Sb(),m.Sb()}if(2&e){const e=m.fc();m.Cb(3),m.mc("ngModel",e.billAmount)}}let tn=(()=>{class e{constructor(e,t,i,l,n,o,a,s,r,c,u){this.billService=e,this.currency=t,this.decimalPipe=i,this.date=l,this.templateService=n,this.jwtHelperService=o,this.snackbar=a,this.cookieService=s,this.clientSelectionService=r,this.clientService=c,this.envService=u,this.subject$=new Zi.a(1),this.data$=this.subject$.asObservable(),this.selectedRows=[],this.columns=[],this.columnNames=[],this.imageProperties=[],this.currencyFormat=Object(b.e)("Currency"),this.roundOffFormat=Object(b.e)("RoundOff"),this.consumptionRoundOffFormat=Object(b.e)("ConsumptionRoundOff"),this.dateFormat=Object(b.e)("DateFormat"),this.filePath="",this.fromDate=Date.UTC.toString(),this.toDate=Date.UTC.toString(),this.billPeriodId=0,this.billPeriods=[{label:"Select",value:0}],this.billCharges="",this.vatAmount="",this.billAmount="",this.billNumberColumnName="Bill Number",this.billDateLocalColumnName="Bill Date",this.customerNameColumnName="Customer Name",this.unitNumberColumnName="Unit Number",this.meterNumberColumnName="Meter Number",this.consumptionsLocalColumnName="Consumptions",this.consumptionLocalColumnName="Consumption Charge",this.billChargeLocalColumnName="Bill Charge",this.vatLocalColumnName="VAT",this.billAmountLocalColumnName="Bill Amount",this.pageSize=7,this.filePath=u.backendForFiles}createGridColumns(){this.columns=["billNumber","billDateLocal","customerName","unitNumber","meterNumber","consumptions","consumptionLocal","billChargeLocal","vatLocal","billAmountLocal"]}createColumnNames(){}set paginator(e){this.dataSource&&(this.dataSource.paginator=e)}set sort(e){this.dataSource&&(this.dataSource.sort=e)}get visibleColumns(){return this.columnNames.filter(e=>!e.property.includes("Id")).map(e=>e.property)}ngOnInit(){this.clientSelectionService.setIsClientVisible(!0),this.createColumnNames(),this.createGridColumns(),this.getBillPeriods()}getBillPeriods(){this.clientId=parseInt(this.cookieService.get("globalClientId")),this.billPeriods=[{label:"Select",value:0,fromDate:Date.now.toString(),ToDate:Date.now.toString()}],this.billService.getBillPeriods(this.clientId).subscribe(e=>{e.forEach(e=>{this.billPeriods.push({label:e.periodDescription,value:e.id,fromDate:e.periodStart,toDate:e.periodEnd})})})}onChangeBillPeriod(e){if(this.billPeriodId=e,this.billPeriodId){const e=this.billPeriods.find(e=>e.value===this.billPeriodId);e&&(this.fromDate=""===e.fromDate?"":R(e.fromDate).format("YYYY-MM-DD"),this.toDate=""===e.toDate?"":R(e.toDate).format("YYYY-MM-DD"))}}getConsolidatedData(){this.billAmount="",this.billCharges="",this.vatAmount="";let e=0,t=0,i=0;this.consolidatedData=[],this.dateFormat=Object(b.e)("DateFormat"),this.roundOffFormat=Object(b.e)("RoundOff"),this.currencyFormat=Object(b.e)("Currency",0),this.billAmount=this.currency.transform(0,this.currencyFormat.toString(),!0,this.roundOffFormat),this.billCharges=this.currency.transform(0,this.currencyFormat.toString(),!0,this.roundOffFormat),this.vatAmount=this.currency.transform(0,this.currencyFormat.toString(),!0,this.roundOffFormat),this.clientId=parseInt(this.cookieService.get("globalClientId")),this.billService.getConsolidatedData(this.clientId,this.billPeriodId).subscribe(l=>{this.consolidatedData=l,l.forEach(l=>{t+=null==l.Bill_Charge?0:l.Bill_Charge,e+=null==l.Bill_Amount?0:l.Bill_Amount,i+=l.VAT}),this.subject$.next(l),this.consolidatedData=l,this.columnNames=[],Object.keys(l[0]).forEach(e=>{this.columnNames.find(t=>t===e.replace("Local",""))||this.columnNames.push({name:e.replace("Local","").replace("_"," "),property:e,visible:!0,isModelProperty:!0,columnAlign:e.includes("_Amount")?{"text-align":"right"}:{"text-align":"left"}})}),this.billAmount=this.currency.transform(e,this.currencyFormat.toString(),!0,this.roundOffFormat),this.billCharges=this.currency.transform(t,this.currencyFormat.toString(),!0,this.roundOffFormat),this.vatAmount=this.currency.transform(i,this.currencyFormat.toString(),!0,this.roundOffFormat),this.consolidatedData.forEach(e=>{for(let t in e)t.includes("_Amount")&&(e[t]=this.currency.transform(e[t],this.currencyFormat.toString(),!0,this.roundOffFormat));this.consumptionRoundOffFormat=Object(b.e)("ConsumptionRoundOff",e.UtilityTypeId,e.Utility_Type),e.Consumptions=this.decimalPipe.transform(e.Consumptions,this.consumptionRoundOffFormat)});for(let e in this.columnNames)"Bill_Amount"!=this.columnNames[e].name&&this.columnNames[e].name.includes("_Amount")&&(this.columnNames[e].name=this.columnNames[e].name.replace("_Amount","").replace("_"," "));this.dataSource=new re.k(this.consolidatedData),this.data$.pipe(Object(el.a)(e=>!e)).subscribe(e=>{this.consolidatedData=e,this.dataSource.data=e}),this.ngAfterViewInit()})}ngAfterViewInit(){null!=this.dataSource&&(this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort)}notificationMessage(e,t){this.snackbar.open(e,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[t]})}onSelectedRows(e){this.selectedRows=[],this.selectedRows=e}onSendEmail(){this.consolidatedData&&this.templateService.emailCustomTemplate({notificationType:"EMAIL",templateType:"customized",templateName:"customized",billMasterDetails:this.consolidatedData}).subscribe(e=>{this.notificationMessage("Email send successfully.","green-snackbar")})}onPrintSummary(){this.getClientImageProperties()}getClientImageProperties(){this.imageProperties=[],this.clientService.getClientImageProperties(this.clientId).subscribe({next:e=>{e&&e.length&&(this.imageProperties=e,this.downloadSummary(this.consolidatedData))},error(){this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar"),this.downloadSummary(this.consolidatedData)}})}downloadSummary(e){let t=[],i=[],l=[],n=[],o=0,a=0,s=0,r=e[0];for(let c in r)"bill_amount"!=c.toLowerCase()&&(c=c.replace("_Amount","")),c=c.replace("_"," "),n.push(c.replace("_"," "));for(let c=0;c<e.length;c++){for(let i in r)"UtilityTypeId"!=i&&t.push(e[c][i]);i.push(t);let l=0;e[c]&&e[c].Bill_Amount&&(l=Number(e[c].Bill_Amount.replace(/[^0-9.-]+/g,""))),o+=l,a+=e[c].VAT,s+=e[c].BillCharge,t=[]}l.push({label:"Total Amount",value2:o});for(let c=0;c<n.length-4;c++)t.push("");t.push(l[0].label),t.push(this.currency.transform(l[0].value0,this.currencyFormat.toString(),!0,this.roundOffFormat)),t.push(this.currency.transform(l[0].value1,this.currencyFormat.toString(),!0,this.roundOffFormat)),t.push(this.currency.transform(l[0].value2,this.currencyFormat.toString(),!0,this.roundOffFormat)),i.push(t),t=[],this.getSummaryReport(this.consolidatedData,n,i,"Consolidated Report")}getSummaryReport(e,t,i,l){var n,o=new Image;o.src=this.filePath+"/uploads/"+(null===(n=this.imageProperties[0])||void 0===n?void 0:n.photo);let a=new fe.default({orientation:"landscape",unit:"pt",format:"letter"});const s=R().format("M/D/YYYY hh:mm:ss a");if(a.rect(5,5,a.internal.pageSize.width-10,a.internal.pageSize.height-10,"S"),a.setFontSize(30),o&&e&&this.imageProperties&&this.imageProperties.length){const e=this.imageProperties.find(e=>"landscape"===e.imageType.trim().toLowerCase());e&&(o.onload=function(){a.addImage(o,e.imgX,e.imgY,e.imgW,e.imgH)})}a.setTextColor(25,118,210),a.setFontSize(9),a.setFont("Cambria"),a.setTextColor(0,0,0),a.text("Print Date: "+s,a.internal.pageSize.width-150,20),a.setFontSize(14),a.text("Consolidated Report",a.internal.pageSize.width/2-80,70),a.setFontSize(9),Number(a.autoTable.previous.finalY),a.autoTable(t,i,{startX:10,startY:80,didDrawPage:function(e){var t="Page "+e.pageCount;"function"==typeof a.putTotalPages&&(t+=" of 1"),a.setFontSize(9);var i=a.internal.pageSize.height||a.internal.pageSize.getHeight();a.text(t,e.settings.margin.left,i-10)},styles:{overflow:"linebreak",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:100,left:15},theme:"grid",tableWidth:"auto",columnStyles:{0:{cellWidth:"wrap",halign:"left"},1:{cellWidth:"wrap",halign:"center"},2:{cellWidth:"wrap",halign:"left"},3:{cellWidth:"wrap",halign:"center"},4:{cellWidth:"wrap",halign:"center"},5:{cellWidth:"wrap",halign:"right"},6:{cellWidth:"wrap",halign:"right"},7:{cellWidth:"wrap",halign:"right"},8:{cellWidth:"wrap",halign:"right"},9:{cellWidth:"wrap",halign:"right"},10:{cellWidth:"wrap",halign:"right"},11:{cellWidth:"wrap",halign:"center"},12:{cellWidth:"wrap",halign:"center"},13:{cellWidth:"wrap",halign:"right"},14:{cellWidth:"wrap",halign:"right"},15:{cellWidth:"wrap",halign:"right"},16:{cellWidth:"wrap",halign:"right"},17:{cellWidth:"wrap",halign:"right"},18:{cellWidth:"wrap",halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]}});var r=a.output("blob");window.open(URL.createObjectURL(r))}getJsonData(){this.tableData=[],null!=this.consolidatedData&&(this.consolidatedData.forEach(e=>{this.tableData.push(Object.assign({},e))}),this.tableData=this.renameKeysForPassedInObjectWithCustomFilters(this.tableData))}renameKeysForPassedInObjectWithCustomFilters(e){return e.forEach(e=>{for(let t in e){let i=t.replace(/_/g," ");i.includes("Amount")&&"Bill Amount"!==i&&(i=i.replace("Amount","").trim()),e[i]=e[t],delete e[t]}}),e}onExport(){if(this.dataSource.data&&this.dataSource.data.length>0){if(this.getJsonData(),null!=this.tableData){const e=vt.utils.json_to_sheet(this.tableData),t=vt.utils.book_new();vt.utils.book_append_sheet(t,e,"Sheet1"),vt.writeFile(t,"Consolidated Report.xlsx")}}else this.notificationMessage("No Data to Export","yellow-snackbar")}onFilterChange(e){this.dataSource&&(e=(e=e.trim()).toLowerCase(),this.dataSource.filter=e)}}return e.\u0275fac=function(t){return new(t||e)(m.Nb(c.a),m.Nb(a.d),m.Nb(a.g),m.Nb(a.f),m.Nb(pe.a),m.Nb(y.a),m.Nb(k.b),m.Nb(C.a),m.Nb(_.a),m.Nb(Ml.a),m.Nb(p.a))},e.\u0275cmp=m.Hb({type:e,selectors:[["fury-create-consolidated"]],viewQuery:function(e,t){var i;1&e&&(m.Vc(yt.a,!0),m.Vc(Ct.a,!0),m.Vc(Gl,!0)),2&e&&(m.zc(i=m.cc())&&(t.paginator=i.first),m.zc(i=m.cc())&&(t.sort=i.first),m.zc(i=m.cc())&&(t.dynamicTableStructureComponent=i.first))},decls:23,vars:7,consts:[["mode","card",2,"margin-top","27px"],["fxLayout","column"],["color","primary",1,"position-fixed"],["src","assets/img/fav-icon.png",1,"img-style"],[1,"toolbar-spacer"],[3,"show","visible","sendEmailClicked","printClicked","exportClicked"],["fxFlex","grow",1,"basic-forms","route-animations-elements"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","6px",1,"padding-top"],["color","primary",1,"result"],["id","BillPeriod","name","BillPeriod",3,"value","selectionChange","valueChange"],[3,"value",4,"ngFor","ngForOf"],[1,"fury-flex-form-field","seach-icon"],[3,"click"],["class","padding","fxLayout","column",4,"ngIf"],["fxLayout.gt-sm","row","fxLayout","column","fxLayoutAlign","end end","fxLayoutGap.gt-sm","12px",1,"result"],["class","result","color","primary",4,"ngIf"],[3,"value"],["fxLayout","column",1,"padding"],["fxFlex","grow","fxLayout","column",1,"list",2,"display","inline-block",3,"hideHeader","hideFilter"],["mat-table","","matSort","",3,"dataSource"],[3,"matColumnDef",4,"ngFor","ngForOf"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[1,"paginator",3,"pageSize"],[3,"matColumnDef"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",3,"ngStyle",4,"matCellDef"],["mat-header-cell","","mat-sort-header",""],["mat-cell","",3,"ngStyle"],["mat-header-row",""],["mat-row",""],["type","text","id","billAmount","name","billAmount","matInput","",2,"text-align","right",3,"ngModel","ngModelChange"]],template:function(e,t){1&e&&(m.Tb(0,"fury-page-layout",0),m.Tb(1,"fury-page-layout-content",1),m.Tb(2,"mat-toolbar",2),m.Ob(3,"img",3),m.Tb(4,"span"),m.Rc(5,"Consolidated Report"),m.Sb(),m.Ob(6,"span",4),m.Tb(7,"fury-payment-history-footer-toolbar",5),m.bc("sendEmailClicked",(function(){return t.onSendEmail()}))("printClicked",(function(){return t.onPrintSummary()}))("exportClicked",(function(){return t.onExport()})),m.Sb(),m.Sb(),m.Tb(8,"fury-card",6),m.Tb(9,"fury-card-content"),m.Tb(10,"form"),m.Tb(11,"div",7),m.Tb(12,"mat-form-field",8),m.Tb(13,"mat-label"),m.Rc(14,"Bill Period"),m.Sb(),m.Tb(15,"mat-select",9),m.bc("selectionChange",(function(e){return t.onChangeBillPeriod(e.value)}))("valueChange",(function(e){return t.billPeriodId=e})),m.Pc(16,Xl,2,2,"mat-option",10),m.Sb(),m.Sb(),m.Tb(17,"div",11),m.Tb(18,"mat-icon",12),m.bc("click",(function(){return t.getConsolidatedData()})),m.Rc(19,"search"),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Pc(20,Zl,7,7,"div",13),m.Tb(21,"div",14),m.Pc(22,en,4,1,"mat-form-field",15),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb()),2&e&&(m.Cb(7),m.mc("show",!1)("visible",!1),m.Cb(1),m.mc("@fadeInUp",void 0),m.Cb(7),m.mc("value",t.billPeriodId),m.Cb(1),m.mc("ngForOf",t.billPeriods),m.Cb(4),m.mc("ngIf",t.consolidatedData&&t.consolidatedData.length>0),m.Cb(2),m.mc("ngIf",t.consolidatedData&&t.consolidatedData.length))},directives:[X.a,$.a,S.d,q.a,ii.a,f.a,S.b,f.c,l.z,l.r,l.s,S.e,I.d,I.h,O.a,a.n,w.a,a.o,S.c,L.n,St.a,re.j,Ct.a,re.g,re.i,yt.a,re.c,re.e,re.b,re.d,Ct.b,re.a,a.p,ve.c,re.f,re.h,W.b,l.c,l.q,l.t],styles:[".toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.padding[_ngcontent-%COMP%]{padding:20px 0;width:100%;height:100%;overflow:scroll}.seach-icon[_ngcontent-%COMP%]{vertical-align:middle;padding-top:1%;margin-left:1%;cursor:pointer}.img-style[_ngcontent-%COMP%]{width:32px}.position-fixed[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;top:0;z-index:5}"],data:{animation:[d.a,u.a]}}),e})(),ln=(()=>{class e{constructor(){this.printClicked=new m.o,this.exportClicked=new m.o}ngOnInit(){}onPrint(){this.printClicked.emit()}onExport(){this.exportClicked.emit()}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=m.Hb({type:e,selectors:[["fury-credit-note-history-details"]],outputs:{printClicked:"printClicked",exportClicked:"exportClicked"},decls:10,vars:0,consts:[[1,"person"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","10px"],[1,"fury-flex-form-field"],["matTooltip","Print","mat-icon-button","",1,"example-icon",3,"click"],["matTooltip","Export","mat-icon-button","","aria-label","Example icon-button with menu icon",1,"example-icon",3,"click"]],template:function(e,t){1&e&&(m.Tb(0,"mat-dialog-content"),m.Tb(1,"div",0),m.Tb(2,"div",1),m.Tb(3,"div",2),m.Tb(4,"button",3),m.bc("click",(function(){return t.onPrint()})),m.Tb(5,"mat-icon"),m.Rc(6,"print"),m.Sb(),m.Sb(),m.Tb(7,"button",4),m.bc("click",(function(){return t.onExport()})),m.Tb(8,"mat-icon"),m.Rc(9,"import_export"),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb())},directives:[h.f,S.d,S.e,P.a,D.a,w.a],styles:[""]}),e})();function nn(e,t){if(1&e){const e=m.Ub();m.Tb(0,"mat-form-field",2),m.Tb(1,"mat-label"),m.Rc(2,"Unit Number"),m.Sb(),m.Tb(3,"input",11),m.bc("ngModelChange",(function(t){return m.Ec(e),m.fc().unitNumber=t})),m.Sb(),m.Sb()}if(2&e){const e=m.fc();m.Cb(3),m.mc("ngModel",e.unitNumber)}}function on(e,t){if(1&e&&(m.Tb(0,"mat-option",14),m.Rc(1),m.Sb()),2&e){const e=t.$implicit;m.mc("value",e.value),m.Cb(1),m.Tc("",e.label," ")}}function an(e,t){if(1&e){const e=m.Ub();m.Tb(0,"mat-form-field",2),m.Tb(1,"mat-label"),m.Rc(2,"Bill Period"),m.Sb(),m.Tb(3,"mat-select",12),m.bc("selectionChange",(function(t){return m.Ec(e),m.fc().onChangeBillPeriod(t.value)}))("valueChange",(function(t){return m.Ec(e),m.fc().billPeriodId=t})),m.Pc(4,on,2,2,"mat-option",13),m.Sb(),m.Tb(5,"mat-hint"),m.Rc(6,"Please select a Bill period"),m.Sb(),m.Sb()}if(2&e){const e=m.fc();m.Cb(3),m.mc("value",e.billPeriodId),m.Cb(1),m.mc("ngForOf",e.billPeriods)}}let sn=(()=>{class e{constructor(e,t){this.snackbar=e,this.date=t,this.billPeriods=[],this.billTypes=[],this.isHide=!0,this.searchClicked=new m.o,this.billTypeChanged=new m.o,this.manageParams={},this.tenantId=0,this.fromDate="",this.toDate="",this.unitNumber="",this.billPeriodId=0,this.billTypeId=0,this.billType="",this.role="",this.ownerId=0}ngOnInit(){}onSearch(){this.fromDate&&this.toDate||this.billPeriodId||this.ownerId>0?(this.manageParams={fromDate:""+(""==this.fromDate?"":R(this.fromDate).format("YYYY-MM-DD")),toDate:""+(""==this.toDate?"":R(this.toDate).format("YYYY-MM-DD")),billPeriodId:""+this.billPeriodId},this.searchClicked.emit(this.manageParams)):this.snackbar.open("Invalid search parameters",null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:["yellow-snackbar"]})}onChangeBillPeriod(e){this.billPeriodId=e}}return e.\u0275fac=function(t){return new(t||e)(m.Nb(k.b),m.Nb(a.f))},e.\u0275cmp=m.Hb({type:e,selectors:[["fury-credit-note-history-toolbar"]],inputs:{billPeriods:"billPeriods",billTypes:"billTypes",isHide:"isHide"},outputs:{searchClicked:"searchClicked",billTypeChanged:"billTypeChanged"},decls:24,vars:8,consts:[[1,"person"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","8px"],["color","primary",1,"result"],["id","fromDate","name","fromDate","matInput","","readonly","",3,"ngModel","matDatepicker","click","ngModelChange","focus"],["matSuffix","",3,"for"],["formDatepickerRef1",""],["id","toDate","name","toDate","matInput","","readonly","",3,"ngModel","matDatepicker","click","ngModelChange","focus"],["formDatepickerRef2",""],["class","result","color","primary",4,"ngIf"],[1,"fury-flex-form-field"],["mat-icon-button","","aria-label","Example icon-button with menu icon",1,"example-icon",3,"click"],["type","text","id","unitNumber","name","unitNumber","matInput","",3,"ngModel","ngModelChange"],["id","billPeriod","name","billPeriod",3,"value","selectionChange","valueChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(e,t){if(1&e){const e=m.Ub();m.Tb(0,"mat-dialog-content"),m.Tb(1,"div",0),m.Tb(2,"form"),m.Tb(3,"div",1),m.Tb(4,"mat-form-field",2),m.Tb(5,"mat-label"),m.Rc(6,"From Date"),m.Sb(),m.Tb(7,"input",3),m.bc("click",(function(){return m.Ec(e),m.Ac(10).open()}))("ngModelChange",(function(e){return t.fromDate=e}))("focus",(function(){return m.Ec(e),m.Ac(10).open()})),m.Sb(),m.Ob(8,"mat-datepicker-toggle",4),m.Ob(9,"mat-datepicker",null,5),m.Sb(),m.Tb(11,"mat-form-field",2),m.Tb(12,"mat-label"),m.Rc(13,"To Date"),m.Sb(),m.Tb(14,"input",6),m.bc("click",(function(){return m.Ec(e),m.Ac(17).open()}))("ngModelChange",(function(e){return t.toDate=e}))("focus",(function(){return m.Ec(e),m.Ac(17).open()})),m.Sb(),m.Ob(15,"mat-datepicker-toggle",4),m.Ob(16,"mat-datepicker",null,7),m.Sb(),m.Pc(18,nn,4,1,"mat-form-field",8),m.Pc(19,an,7,2,"mat-form-field",8),m.Tb(20,"div",9),m.Tb(21,"button",10),m.bc("click",(function(){return t.onSearch()})),m.Tb(22,"mat-icon"),m.Rc(23,"search"),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb()}if(2&e){const e=m.Ac(10),i=m.Ac(17);m.Cb(7),m.mc("ngModel",t.fromDate)("matDatepicker",e),m.Cb(1),m.mc("for",e),m.Cb(6),m.mc("ngModel",t.toDate)("matDatepicker",i),m.Cb(1),m.mc("for",i),m.Cb(3),m.mc("ngIf",t.isHide),m.Cb(1),m.mc("ngIf","External"!=t.role)}},directives:[h.f,l.z,l.r,l.s,S.d,S.e,I.d,I.h,W.b,l.c,B.b,l.q,l.t,B.d,I.j,B.a,a.o,P.a,w.a,O.a,a.n,I.g,L.n],styles:[""]}),e})(),rn=(()=>{class e{constructor(e,t,i,l,n,o,a,s,r,c,u,d,m){var h,p,f;this.billService=e,this.billSettlementService=t,this.snackbar=i,this.decimalPipe=l,this.currencyPipe=n,this.datePipe=o,this.date=a,this.currency=s,this.dialog=r,this.cookieService=c,this.clientSelectionService=u,this.clientService=d,this.envService=m,this._gap=16,this.gap=this._gap+"px",this.col2=`1 1 calc(50% - ${this._gap/2}px)`,this.col3=`1 1 calc(33.3333% - ${this._gap/1.5}px)`,this.tableData=[],this.columns=[],this.innerColumns=[],this.columnNames=[],this.creditNotes=[],this.selectedRows=[],this.visibleButtons=[],this.billPeriods=[{label:"Select",value:0}],this.utilityTypes=[],this.creditNoteAmount="",this.billAmount="",this.message="",this.billPeriod="",this.imageProperties=[],this.isBillPeriodEnabled=!1,this.roundFormat="",this.currencyFormat="",this.dateFormat="",this.filePath="",this.creditNoteDateCoulmnName="Credit Note Date",this.billNumberCoulmnName="Bill No",this.billDateCoulmnName="Bill Date",this.accountNumberColumnName="Account No",this.ownerNameColumnName="Owner Name",this.creditNoteNumberCoulmnName="Credit Note No",this.billAmountLocalColumnName="Bill Amount",this.creditNoteAmountColumnName="Credit Note Amount",this.filePath=m.backendForFiles,this.roundFormat=null!==(h=Object(b.e)("RoundOff"))&&void 0!==h?h:m.roundOffFormat,this.currencyFormat=null!==(p=Object(b.e)("Currency"))&&void 0!==p?p:m.currencyFormat,this.dateFormat=null!==(f=Object(b.e)("DateFormat"))&&void 0!==f?f:m.dateFormat}ngOnInit(){this.clientSelectionService.setIsClientVisible(!0),this.clientId=parseInt(this.cookieService.get("globalClientId")),this.getBillPeriods(),this.getUtilities(),this.createGridColumns(),this.createColumnNames(),this.createInnerGridColumns(),this.addVisibleButtons()}createGridColumns(){this.columns=["select","creditNoteDateLocal","creditNoteNumber","billNumber","billDateLocal","accountNumber","ownerName","billAmountLocal","creditNoteAmountLocal","button","action"]}createInnerGridColumns(){this.innerColumns=[]}createColumnNames(){this.columnNames=[{name:this.creditNoteDateCoulmnName,property:"creditNoteDateLocal",visible:!0,isModelProperty:!0},{name:this.creditNoteNumberCoulmnName,property:"creditNoteNumber",visible:!0,isModelProperty:!0},{name:this.billNumberCoulmnName,property:"billNumber",visible:!0,isModelProperty:!0},{name:this.billDateCoulmnName,property:"billDateLocal",visible:!0,isModelProperty:!0},{name:this.accountNumberColumnName,property:"accountNumber",visible:!0,isModelProperty:!0},{name:this.ownerNameColumnName,property:"ownerName",visible:!0,isModelProperty:!0},{name:this.billAmountLocalColumnName,property:"billAmountLocal",visible:!0,isModelProperty:!0,columnAlign:{"text-align":"right"}},{name:this.creditNoteAmountColumnName,property:"creditNoteAmountLocal",visible:!0,isModelProperty:!0,columnAlign:{"text-align":"right"}}]}addVisibleButtons(){this.visibleButtons=[{property:"print"}]}onSearch(e){this.manageParams=e,this.manageParams.clientId=this.clientId,this.creditNotes=[];let t=0,i=0;this.message="",this.billSettlementService.getCreditNoteDetails(e).subscribe(l=>{l&&l.length?(this.dateFormat=Object(b.e)("DateFormat"),this.roundFormat=Object(b.e)("RoundOff"),this.currencyFormat=Object(b.e)("Currency"),l.forEach(e=>{e.billAmountLocal=this.currencyPipe.transform(e.billAmount,this.currencyFormat.toString(),!0,this.roundFormat),e.creditNoteAmountLocal=this.currencyPipe.transform(e.creditNoteAmount,this.currencyFormat.toString(),!0,this.roundFormat),e.billDateLocal=this.datePipe.transform(e.billDate,this.dateFormat),e.creditNoteDateLocal=this.datePipe.transform(e.creditNoteDate,this.dateFormat),t+=Number(e.creditNoteAmount),i+=Number(e.billAmount)}),l.sort((e,t)=>e.creditNoteDateLocal.localeCompare(t.creditNoteDateLocal)),this.creditNotes=l,this.billAmount=this.currencyPipe.transform(i,this.currencyFormat.toString(),!0,this.roundFormat),this.creditNoteAmount=this.currencyPipe.transform(t,this.currencyFormat.toString(),!0,this.roundFormat),""!=e.billPeriodId&&(this.billPeriods.find(t=>{t.value==e.billPeriodId&&0!=t.value&&(this.billPeriod=t.label)}),""!=this.billPeriod&&(this.billPeriod=" for "+this.billPeriod)),""!=e.fromDate&&""!=e.toDate&&(this.message="Period : "+this.datePipe.transform(e.fromDate,this.dateFormat)+" to "+this.datePipe.transform(e.toDate,this.dateFormat))):this.creditNotes=[]})}toggleBillPeriodEnabled(e){this.isBillPeriodEnabled=e.checked||!1}getBillPeriods(){this.billPeriods=[{label:"Select",value:0,fromDate:"",ToDate:""}],this.billService.getBillPeriods(this.clientId).subscribe(e=>{e.forEach(e=>{this.billPeriods.push({label:e.periodDescription,value:e.id,fromDate:e.periodStart,toDate:e.periodEnd})})})}getUtilities(){this.billService.getUtilities(this.clientId).subscribe(e=>{e&&e.forEach(e=>{this.utilityTypes.push({label:e.description,value:e.id})})})}onViewDataRow(e){if(e){let t=1;e.transactionMode="View",e.creditNoteTransactions.forEach(e=>{e.rowNumber=t,e.fixedAmountLocal=this.currencyPipe.transform(e.fixedAmount,this.currencyFormat.toString(),!0,this.roundFormat),e.creditNoteAmountLocal=this.currencyPipe.transform(e.creditNoteAmount,this.currencyFormat.toString(),!0,this.roundFormat),t+=1})}this.dialog.open(bt,{data:e}).afterClosed().subscribe()}onSelectedRows(e){this.selectedRows=[],this.selectedRows=e}getClientImageProperties(){this.imageProperties=[],this.clientService.getClientImageProperties(this.clientId).subscribe({next:e=>{e&&e.length&&(this.imageProperties=e,this.downloadSummary(this.creditNotes))},error(){this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","green-snackbar"),this.downloadSummary(this.consolidatedData)}})}creditNoteSummaryView(e){this.billSettlementService.creditNoteSummaryView(e).subscribe({next:e=>{e?this.downloadFile(e):this.notificationMessage("No data to print","red-snackbar")},error:e=>{this.notificationMessage("No data to print","red-snackbar")}})}creditNoteView(e){this.billSettlementService.creditNoteView(e).subscribe({next:e=>{e?this.downloadFile(e):this.notificationMessage("No data to print","red-snackbar")},error:e=>{this.notificationMessage("No data to print","red-snackbar")}})}downloadFile(e){return Object(r.a)(this,void 0,void 0,(function*(){const t=yield G.PDFDocument.create(),i=yield G.PDFDocument.load(e);(yield t.copyPages(i,i.getPageIndices())).forEach(e=>{t.addPage(e)});const l=yield t.save(),n=new Blob([l],{type:"application/pdf"}),o=window.URL.createObjectURL(n);window.open(o)}))}onPrintSummary(){this.selectedRows&&this.selectedRows.length?this.creditNoteSummaryView(this.selectedRows):this.notificationMessage("Please select Credit Notes.","red-snackbar")}downloadSummary(e){var t,i,l,n,o;let a=0,s=0,r=[],c=[],u=[];for(let d=0;d<e.length;d++)r.push(e[d].creditNoteDateLocal),r.push(e[d].creditNoteNumber),r.push(e[d].billNumber),r.push(e[d].billDateLocal),r.push(e[d].accountNumber),r.push(e[d].ownerName),r.push(e[d].billAmountLocal),r.push(e[d].creditNoteAmountLocal),c.push(r),s+=Number(null===(t=e[d])||void 0===t?void 0:t.creditNoteAmount),a+=Number(null===(i=e[d])||void 0===i?void 0:i.billAmount),r=[];u.push({label:"Total Amount",value0:a,value1:s});for(let d=0;d<u.length;d++)r.push(""),r.push(""),r.push(""),r.push(""),r.push(""),r.push(null===(l=u[d])||void 0===l?void 0:l.label),r.push(this.currency.transform(null===(n=u[d])||void 0===n?void 0:n.value0,this.currencyFormat.toString(),!0,this.roundFormat)),r.push(this.currency.transform(null===(o=u[d])||void 0===o?void 0:o.value1,this.currencyFormat.toString(),!0,this.roundFormat)),c.push(r),r=[];this.getSummaryReport(e,["Date","CreditNoteNo","BillNo","BillDate","AccountNo","OwnerName","BillAmount","CreditNoteAmount"],c,"Consumption Alert Report")}getSummaryReport(e,t,i,l){var n,o=new Image;o.src=this.filePath+"/uploads/"+(null===(n=this.imageProperties[0])||void 0===n?void 0:n.photo);let a=new fe.default({orientation:"landscape",unit:"pt",format:"letter"});const s=R().format("M/D/YYYY hh:mm:ss a");if(a.rect(5,5,a.internal.pageSize.width-10,a.internal.pageSize.height-10,"S"),a.setFontSize(30),o&&e&&this.imageProperties&&this.imageProperties.length){const e=this.imageProperties.find(e=>"landscape"===e.imageType.trim().toLowerCase());e&&(o.onload=function(){a.addImage(o,e.imgX,e.imgY,e.imgW,e.imgH)})}a.setTextColor(25,118,210),a.setFontSize(9),a.setFont("Cambria"),a.setTextColor(0,0,0),a.text("Print Date: "+s,a.internal.pageSize.width-150,20),a.setFontSize(14),a.text("Credit Note History "+this.billPeriod,a.internal.pageSize.width/2-120,100),a.text(this.message,a.internal.pageSize.width/2-120,120),a.setFontSize(9),Number(a.autoTable.previous.finalY),a.autoTable(t,i,{startX:10,startY:125,didDrawPage:function(e){var t="Page "+e.pageCount;"function"==typeof a.putTotalPages&&(t+=" of 1"),a.setFontSize(9);var i=a.internal.pageSize.height||a.internal.pageSize.getHeight();a.text(t,e.settings.margin.left,i-10)},styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:280,left:30},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:80,halign:"center"},1:{cellWidth:75,halign:"center"},2:{cellWidth:80,halign:"center"},3:{cellWidth:80,halign:"center"},4:{cellWidth:80,halign:"center"},5:{cellWidth:150,halign:"left"},6:{cellWidth:80,halign:"right"},7:{cellWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]}});var r=a.output("blob");window.open(URL.createObjectURL(r))}onPrintPdf(){this.selectedRows&&this.selectedRows.length?this.selectedRows.forEach(e=>{this.downloadReport(e)}):this.notificationMessage("Please select Bills.","red-snackbar")}downloadReport(e){let t=[],i=[],l=[],n=[],o=[],a=0,s=0;for(let r=0;r<e.creditNoteTransactions.length;r++)if(e.creditNoteTransactions[r]&&!e.creditNoteTransactions[r].taxId){const l=this.currencyPipe.transform(Number(e.creditNoteTransactions[r].creditNoteAmount),this.currencyFormat,!0,this.roundFormat);t.push(e.creditNoteTransactions[r].headDisplay),t.push(l),i.push(t),a+=Number(e.creditNoteTransactions[r].creditNoteAmount),t=[]}else s+=Number(e.creditNoteTransactions[r].creditNoteAmount);l.push({label:"Previous Balance:",value:this.currencyPipe.transform(Number(e.previousDueAmount),this.currencyFormat.toString(),!0,this.roundFormat)}),n.push({label:"Account Number:",value:e.accountNumber},{label:"Unit Number:",value:e.unitNumber},{label:"Billing Date:",value:e.creditNoteDateLocal},{label:"Invoice Number:",value:e.billNumber},{label:"Customer TRN:",value:e.trn}),o.push({label:"Credit Note Total:",value:this.currencyPipe.transform(a,this.currencyFormat.toString(),!0,this.roundFormat)},{label:"Tax:",value:this.currencyPipe.transform(s,this.currencyFormat.toString(),!0,this.roundFormat)},{label:"Credit Note Total + Tax:",value:this.currencyPipe.transform(Number(e.creditNoteAmount),this.currencyFormat.toString(),!0,this.roundFormat)},{label:"Previous Bill Outstanding Balance:",value:this.currencyPipe.transform(Number(e.previousDueAmount),this.currencyFormat.toString(),!0,this.roundFormat)},{label:"Total Due incl VAT:",value:this.currencyPipe.transform(Number(e.previousDueAmount)-Number(e.creditNoteAmount),this.currencyFormat.toString(),!0,this.roundFormat)}),this.getReport(e,["Services Description","Amount"],i,[],["Customer Id","Billing Period","Total for current period"],[],l,n,o,"Credit Note")}getReport(e,t,i,l,n,o,a,s,r,c){var u;(new Image).src=this.filePath+"/uploads/"+e.client.photo;var d=new Image;d.src="assets/img/lu.JPG";let m=new fe.default({orientation:"portrait",unit:"pt",format:"letter"});m.rect(5,5,m.internal.pageSize.width-10,m.internal.pageSize.height-10,"S"),m.setFontSize(30),m.addImage(d,"png",547,10,56,56),m.setTextColor(0,0,0),m.setFontSize(14),m.setFont("Cambria"),m.text("Tax Credit Note",260,30),m.setFontSize(9),m.setTextColor(25,118,210),m.setFont("Cambria","bold"),m.text(e.client.clientName,10,60),m.setFont("Cambria","normal"),m.text("TRN: "+e.client.trnNo,10,70),m.text("PO Box "+e.client.addresses[0].zipPostalCode,10,80),m.text(e.client.addresses[0].address1+","+e.client.addresses[0].country,10,90),m.text("Phone: "+e.client.phoneNo,10,100),m.text("Email: "+e.client.email+", Web: "+e.client.website,10,110),m.setFillColor(241,241,244),m.setDrawColor(206,203,203),m.rect(10,120,250,90,"FD"),m.setTextColor(0,0,0),m.setFontSize(12),m.text(null==e?void 0:e.ownerName.toUpperCase(),20,135),m.text("CUSTOMER TRN: "+e.trn,20,155),m.text("unit #"+e.unitNumber,20,170),m.setFontSize(10),m.text(e.client.clientName,20,185),m.text("Al Barsha 1, Dubai, UAE",20,200),m.setFontSize(9),m.setLineWidth(.1),m.line(5,265,607,265),m.setFontSize(10),m.setFont("bold"),m.text("Credit Note No#: ".toUpperCase(),400,110),m.setTextColor(25,118,210);const h=m.getTextWidth("Credit Note No#: ");let b="";(null==e?void 0:e.billNumber)&&(b=null===(u=e.creditNoteNumber)||void 0===u?void 0:u.toUpperCase()),m.text(b,418+h,110),m.setFont("none"),m.setTextColor(0,0,0),m.setFontSize(9),m.autoTable("",s,{startX:210,startY:120,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:400},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:100,halign:"left"},1:{cellWidth:100,halign:"right"}},didParseCell:function(e){const t=e.column.index;0!=t&&1!=t||(e.cell.styles.rowHeight=1)},headStyles:{lineWidth:.1,lineColor:[0,0,0]}}),m.autoTable("",a,{startX:10,startY:220,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:220,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:515,fontStyle:"bold"},1:{cellWidth:75,fontStyle:"bold",halign:"right"}},didParseCell:function(e){const t=e.column.index;0!=t&&1!=t||(e.cell.styles.rowHeight=1)},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});const p=Number(this.decimalPipe.transform(m.autoTable.previous.finalY,"1.0-0"));m.autoTable(t,i,{startX:10,startY:p,didDrawPage:function(e){var t="Page "+e.pageCount;"function"==typeof m.putTotalPages&&(t+=" of 1",m.rect(5,5,m.internal.pageSize.width-10,m.internal.pageSize.height-10,"S")),m.setFontSize(9);var i=m.internal.pageSize.height||m.internal.pageSize.getHeight();m.text(t,e.settings.margin.left,i-10)},styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:p,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:t.length>2?100:515,halign:"left"},1:{cellWidth:t.length>2?80:75,halign:t.length>2?"center":"right"},2:{cellWidth:80,halign:"center"},3:{cellWidth:60,halign:"center"},4:{cellWidth:60,halign:"center"},5:{cellWidth:75,halign:"center"},6:{cellWidth:60,halign:"right"},7:{cellWidth:75,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]}}),m.setTextColor(0,0,0);const f=Number(this.decimalPipe.transform(m.autoTable.previous.finalY,"1.0-0"));m.setTextColor(25,118,210),m.setFontSize(12),m.text("Bank Payment Account Details",10,f+20),m.setTextColor(0,0,0),m.setFontSize(9),m.text("Account Title: LOGIC UTILITIES DISTRICT COOLING SERVICES L.L.C",10,f+40),m.text("Account #: 019100074892",10,f+50),m.text("IBAN #: AE54 0330 0000 1910 0074 892",10,f+60),m.text("Bank Name: MASHREQ BANK - DUBAI MALL BRANCH",10,f+70),m.text("Swift Code: BOMLAEAD",10,f+80),m.setFontSize(9),m.autoTable("",r,{startX:300,startY:f+20,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:320},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:180,halign:"left"},1:{cellWidth:100,halign:"right"}},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center"}});const g=Number(this.decimalPipe.transform(m.autoTable.previous.finalY,"1.0-0"));m.setTextColor(255,0,0),m.text("Note: A Late Fee will be applied after the due date. A Default Payment \nPenalty will be added to any unit that is 45 days or more in arrears.",320,g+10),m.setTextColor(25,118,210),m.setFontSize(12),m.text("USAGE TIPS to reduce consumption:",10,g+10),m.text("Please Try to:",10,g+30),m.setTextColor(0,0,0),m.setFontSize(9),m.text("- Keep filters clean",30,g+40),m.text("- Set thermostats between 23C and 25C",30,g+50),m.text("- Keep vents unblocked",30,g+60),m.text("- Keep doors and windows closed",30,g+70),m.text("- Undertake regular maintenance of the system",30,g+80),m.setTextColor(25,118,210),m.setFontSize(12),m.text("Please Do Not:",10,g+100),m.setTextColor(0,0,0),m.setFontSize(9),m.text("- Set thermostats to 20C or lower",30,g+110),m.text("- Block vents",30,g+120),m.text("- Leave doors and windows open",30,g+130),m.text("- Leave heat producing appliances near thermostats",30,g+140),m.setFillColor(119,183,11);var v=m.internal.pageSize.height||m.internal.pageSize.getHeight();m.rect(320,g+30,280,v-80-(g+30),"FD"),m.setFont("Comic Sans"),m.setTextColor(255,255,255),m.setFontSize(16),m.text("ADVERTISE WITH US",360,g+50);const y=m.getTextWidth("ADVERTISE WITH US");m.setLineWidth(.1),m.line(360,g+55,360+y,g+55),m.setFontSize(9),m.text("For advertisement, contact at",390,g+65),m.text("800 Logic (56442)",390,g+75),m.text("enquiry@logicutilities.com",390,g+85),m.text("www.logicutilities.com",390,g+95),m.setTextColor(0,0,0),m.setLineWidth(.1),m.line(5,v-70,607,v-70),m.text("For any enquiries, write to us enquiry@logicutilities.com \nor Logon to www.logicutilites.com",10,v-60),m.setTextColor(255,0,0),m.setFont("bold");const C=m.getTextWidth("Notice:");m.text("Notice:",340,v-60),m.setFont("none"),m.setTextColor(0,0,0),m.text("Pay your bills before due date to avoid late payment surcharge",340+C,v-60),m.text("and disconnection.",340,v-50),m.text("You can log onto www.logicutilites.com to pay your invoices \nTerms & Conditions for Supply of Utility Services",340,v-40),"function"==typeof m.putTotalPages&&m.putTotalPages("1");var S=m.output("blob");window.open(URL.createObjectURL(S))}notificationMessage(e,t){this.snackbar.open(e,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[t]})}getJsonData(){this.tableData=[],null==this.creditNotes&&null==this.creditNotes||this.creditNotes.forEach(e=>{let t={Date:this.date.transform(e.creditNoteDate,"yyyy-MM-dd"),CreditNoteNumber:e.creditNoteNumber,BillNumber:e.billNumber,BillDate:this.date.transform(e.billDate,"yyyy-MM-dd"),AccountNumber:e.accountNumber,OwnerName:e.ownerName,BillAmount:e.billAmountLocal,CreditNoteAmount:e.creditNoteAmountLocal};this.tableData.push(t)})}onExport(){if(this.creditNotes&&this.creditNotes.length>0){if(this.getJsonData(),null!=this.tableData||null!=this.tableData){const e=vt.utils.json_to_sheet(this.tableData),t=vt.utils.book_new();vt.utils.book_append_sheet(t,e,"Sheet1"),vt.writeFile(t,"Credit Note History.xlsx")}}else this.notificationMessage("No Data to Export","yellow-snackbar")}}return e.\u0275fac=function(t){return new(t||e)(m.Nb(c.a),m.Nb(F.a),m.Nb(k.b),m.Nb(a.g),m.Nb(a.d),m.Nb(a.f),m.Nb(a.f),m.Nb(a.d),m.Nb(h.b),m.Nb(C.a),m.Nb(_.a),m.Nb(Ml.a),m.Nb(p.a))},e.\u0275cmp=m.Hb({type:e,selectors:[["fury-credit-note-history"]],viewQuery:function(e,t){var i;1&e&&(m.Jc(ln,!0),m.Jc(sn,!0)),2&e&&(m.zc(i=m.cc())&&(t.creditNoteHistoryDetailsComponent=i.first),m.zc(i=m.cc())&&(t.creditNoteHistoryToolbarComponent=i.first))},decls:25,vars:13,consts:[["mode","card",2,"margin-top","27px"],["fxLayout","column",1,"content"],["color","primary",1,"position-fixed"],["src","assets/img/fav-icon.png",1,"img-style"],[1,"toolbar-spacer"],[3,"printClicked","exportClicked"],["fxFlex","noshrink","fxLayout","column","fxLayout.gt-sm","row","fxLayoutAlign.gt-sm","start stretch",3,"fxLayoutGap"],["fxFlex","grow",1,"basic-forms","route-animations-elements",3,"fxFlex.gt-sm"],["fxLayout","column"],["fxLayout","column",1,"result"],[3,"billPeriods","isHide","searchClicked"],[1,"padding-top",3,"tableData","columnsToDisplay","innerDisplayedColumns","columnNames","hideHeader","visibleButtons","selectedRows","viewDataRow","printDataRow"],["fxLayout","column",1,"padding"],["fxLayout.gt-sm","row","fxLayout","column","fxLayoutAlign","end end","fxLayoutGap.gt-sm","12px",1,"result"],["color","primary",1,"result"],["type","text","id","billAmount","name","billAmount","matInput","",2,"text-align","right",3,"ngModel","ngModelChange"],["type","textbox","id","creditNoteAmount","name","creditNoteAmount","matInput","",2,"text-align","right",3,"ngModel","ngModelChange"]],template:function(e,t){1&e&&(m.Tb(0,"fury-page-layout",0),m.Tb(1,"fury-page-layout-content",1),m.Tb(2,"mat-toolbar",2),m.Ob(3,"img",3),m.Tb(4,"span"),m.Rc(5,"Credit Note History"),m.Sb(),m.Ob(6,"span",4),m.Tb(7,"fury-credit-note-history-details",5),m.bc("printClicked",(function(){return t.onPrintSummary()}))("exportClicked",(function(){return t.onExport()})),m.Sb(),m.Sb(),m.Tb(8,"div",6),m.Tb(9,"fury-card",7),m.Ob(10,"fury-card-header"),m.Tb(11,"fury-card-content",8),m.Tb(12,"div",9),m.Tb(13,"fury-credit-note-history-toolbar",10),m.bc("searchClicked",(function(e){return t.onSearch(e)})),m.Sb(),m.Tb(14,"fury-expandable-table-structure",11),m.bc("selectedRows",(function(e){return t.onSelectedRows(e)}))("viewDataRow",(function(e){return t.onViewDataRow(e)}))("printDataRow",(function(e){return t.creditNoteView(e)})),m.Sb(),m.Sb(),m.Ob(15,"div",12),m.Tb(16,"div",13),m.Tb(17,"mat-form-field",14),m.Tb(18,"mat-label"),m.Rc(19,"Bill Amount"),m.Sb(),m.Tb(20,"input",15),m.bc("ngModelChange",(function(e){return t.billAmount=e})),m.Sb(),m.Sb(),m.Tb(21,"mat-form-field",14),m.Tb(22,"mat-label"),m.Rc(23,"Credit Note Amount"),m.Sb(),m.Tb(24,"input",16),m.bc("ngModelChange",(function(e){return t.creditNoteAmount=e})),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb()),2&e&&(m.Cb(8),m.mc("fxLayoutGap",t.gap),m.Cb(1),m.mc("fxFlex.gt-sm",t.col2)("@fadeInUp",void 0),m.Cb(4),m.mc("billPeriods",t.billPeriods)("isHide",!1),m.Cb(1),m.mc("tableData",t.creditNotes)("columnsToDisplay",t.columns)("innerDisplayedColumns",t.innerColumns)("columnNames",t.columnNames)("hideHeader",!1)("visibleButtons",t.visibleButtons),m.Cb(6),m.mc("ngModel",t.billAmount),m.Cb(4),m.mc("ngModel",t.creditNoteAmount))},directives:[X.a,$.a,S.d,q.a,ln,S.b,S.c,S.e,f.a,f.d,f.c,sn,T.a,I.d,I.h,W.b,l.c,l.q,l.t],styles:[".toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.img-style[_ngcontent-%COMP%]{width:32px}.position-fixed[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;top:0;z-index:5}"],data:{animation:[d.a,u.a]}}),e})();const cn=["allSelected"];function un(e,t){if(1&e){const e=m.Ub();m.Tb(0,"div",13),m.Tb(1,"mat-checkbox",14),m.bc("change",(function(){m.Ec(e);const t=m.fc();return t.showMovedOutTenants(t.isMovedOutTenant)})),m.Rc(2," Show only Moved Out Tenants "),m.Sb(),m.Sb()}}function dn(e,t){if(1&e){const e=m.Ub();m.Tb(0,"mat-option",22),m.bc("click",(function(){m.Ec(e),m.fc();const t=m.Ac(8);return m.fc().togglePerOne(t.viewValue)})),m.Rc(1),m.Sb()}if(2&e){const e=t.$implicit;m.mc("optionSelected",e.selected)("value",e.id),m.Cb(1),m.Tc(" ",e.ownerName," ")}}function mn(e,t){if(1&e){const e=m.Ub();m.Tb(0,"mat-form-field",15),m.Tb(1,"mat-label"),m.Rc(2,"Tenant Name"),m.Sb(),m.Tb(3,"mat-select",16),m.bc("ngModelChange",(function(t){return m.Ec(e),m.fc().selectedTenants=t})),m.Tb(4,"input",17,18),m.bc("keydown",(function(t){return m.Ec(e),m.fc().handleInput(t)}))("keyup",(function(t){return m.Ec(e),m.fc().searchTenant(t.target.value)})),m.Sb(),m.Ob(6,"mat-divider"),m.Tb(7,"mat-option",19,20),m.bc("click",(function(){return m.Ec(e),m.fc().toggleAllSelection()})),m.Rc(9,"Select All"),m.Sb(),m.Pc(10,dn,2,3,"mat-option",21),m.Sb(),m.Tb(11,"mat-hint"),m.Rc(12,"Please select a tenant name"),m.Sb(),m.Sb()}if(2&e){const e=m.fc();m.Cb(3),m.mc("ngModel",e.selectedTenants),m.Cb(4),m.mc("value",0),m.Cb(3),m.mc("ngForOf",e.filteredTenants)}}let hn=(()=>{class e{constructor(e,t,i,l,n){this.snackbar=e,this.date=t,this.fb=i,this.jwtHelperService=l,this.cookieService=n,this.billPeriods=[],this.billTypes=[],this.isHide=!0,this.searchClicked=new m.o,this.billTypeChanged=new m.o,this.tenantChanged=new m.o,this.manageParams={},this.tenantId=0,this.fromDate="",this.toDate="",this.unitNumber="",this.billPeriodId=0,this.billTypeId=0,this.billType="",this.role="",this.filteredTenants=[],this.data=[],this.tenantName="",this.ownerId=0,this.selectedTenants=[],this.isMovedOutTenant=!1}get tenants(){return this.data}set tenants(e){this.filteredTenants=this.data=e}ngOnInit(){var e,t;let i=this.cookieService.get("access_token");const l=this.jwtHelperService.decodeToken(i);l&&(this.role=l["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"]),this.ownerId=parseInt(this.cookieService.get("ownerId")),this.tenantId=null!==(e=this.ownerId)&&void 0!==e?e:0,this.tenantId>0&&this.selectedTenants.push(null!==(t=this.ownerId)&&void 0!==t?t:0),this.form=this.fb.group({movedOutTenant:[""],fromDate:[""],toDate:[""],tenant:[""]})}onSearch(){let e=this.selectedTenants.findIndex(e=>0==e);e>=0&&this.selectedTenants.splice(e,1),this.fromDate&&this.toDate&&this.selectedTenants&&this.selectedTenants.length>0?(this.manageParams={fromDate:""+(""==this.fromDate?"":R(this.fromDate).format("YYYY-MM-DD")),toDate:""+(""==this.toDate?"":R(this.toDate).format("YYYY-MM-DD")),tenantId:this.selectedTenants.join(","),tenantName:""+this.tenantName},this.searchClicked.emit(this.manageParams)):this.snackbar.open("Invalid search parameters",null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:["yellow-snackbar"]})}selectTenant(e){this.tenants.forEach(t=>{t.ownerName===e.option.value&&(this.tenantId=t.id)})}filterTenant(e){""!=e&&(this.filteredTenants=this.data.filter(t=>0===t.ownerName.toLowerCase().indexOf(e.toLowerCase())))}toggleAllSelection(){this.form.controls.tenant.patchValue(this.allSelected.selected?[...this.filteredTenants.map(e=>e.id),0]:[])}togglePerOne(e){if(this.allSelected.selected)return this.allSelected.deselect(),!1;this.form.controls.tenant.value.length==this.filteredTenants.length&&this.allSelected.select()}searchTenant(e){let t=this.selectOwnerTenant(e.toLowerCase());this.filteredTenants=t}selectOwnerTenant(e){let t=[];if(!e)return this.data;for(let i of this.data)i.ownerName.toLowerCase().indexOf(e)>-1&&t.push(i);return t}showMovedOutTenants(e){this.isMovedOutTenant=!e,this.form.controls.tenant.setValue(""),this.selectedTenants=[],this.tenantChanged.emit(this.isMovedOutTenant)}handleInput(e){e.stopPropagation()}}return e.\u0275fac=function(t){return new(t||e)(m.Nb(k.b),m.Nb(a.f),m.Nb(l.f),m.Nb(y.a),m.Nb(C.a))},e.\u0275cmp=m.Hb({type:e,selectors:[["app-account-statement-toolbar"]],viewQuery:function(e,t){var i;1&e&&m.Vc(cn,!0),2&e&&m.zc(i=m.cc())&&(t.allSelected=i.first)},inputs:{billPeriods:"billPeriods",billTypes:"billTypes",isHide:"isHide",tenants:"tenants"},outputs:{searchClicked:"searchClicked",billTypeChanged:"billTypeChanged",tenantChanged:"tenantChanged"},decls:24,vars:9,consts:[[1,"person","padding-bottom"],[3,"formGroup"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","8px","style","padding-bottom: 20px;",4,"ngIf"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","8px"],["color","primary",1,"result"],["id","fromDate","name","fromDate","formControlName","fromDate","matInput","","readonly","",3,"ngModel","matDatepicker","click","ngModelChange","focus"],["matSuffix","",3,"for"],["formDatepickerRef1",""],["id","toDate","name","toDate","formControlName","toDate","matInput","","readonly","",3,"ngModel","matDatepicker","click","ngModelChange","focus"],["formDatepickerRef2",""],["class","result","color","primary","style","width: 400px;",4,"ngIf"],[1,"fury-flex-form-field"],["mat-icon-button","",3,"click"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutGap.gt-sm","8px",2,"padding-bottom","20px"],["color","primary","formControlName","movedOutTenant",1,"formulaLabel",3,"change"],["color","primary",1,"result",2,"width","400px"],["multiple","","formControlName","tenant",3,"ngModel","ngModelChange"],["matInput","","focused","'true'","type","text","autocomplete","off","placeholder","search",1,"myInput",3,"keydown","keyup"],["myInput",""],[3,"value","click"],["allSelected",""],[3,"optionSelected","value","click",4,"ngFor","ngForOf"],[3,"optionSelected","value","click"]],template:function(e,t){if(1&e){const e=m.Ub();m.Tb(0,"mat-dialog-content"),m.Tb(1,"div",0),m.Tb(2,"form",1),m.Pc(3,un,3,0,"div",2),m.Tb(4,"div",3),m.Tb(5,"mat-form-field",4),m.Tb(6,"mat-label"),m.Rc(7,"From Date"),m.Sb(),m.Tb(8,"input",5),m.bc("click",(function(){return m.Ec(e),m.Ac(11).open()}))("ngModelChange",(function(e){return t.fromDate=e}))("focus",(function(){return m.Ec(e),m.Ac(11).open()})),m.Sb(),m.Ob(9,"mat-datepicker-toggle",6),m.Ob(10,"mat-datepicker",null,7),m.Sb(),m.Tb(12,"mat-form-field",4),m.Tb(13,"mat-label"),m.Rc(14,"To Date"),m.Sb(),m.Tb(15,"input",8),m.bc("click",(function(){return m.Ec(e),m.Ac(18).open()}))("ngModelChange",(function(e){return t.toDate=e}))("focus",(function(){return m.Ec(e),m.Ac(18).open()})),m.Sb(),m.Ob(16,"mat-datepicker-toggle",6),m.Ob(17,"mat-datepicker",null,9),m.Sb(),m.Pc(19,mn,13,3,"mat-form-field",10),m.Tb(20,"div",11),m.Tb(21,"button",12),m.bc("click",(function(){return t.onSearch()})),m.Tb(22,"mat-icon"),m.Rc(23,"search"),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb()}if(2&e){const e=m.Ac(11),i=m.Ac(18);m.Cb(2),m.mc("formGroup",t.form),m.Cb(1),m.mc("ngIf",0==t.tenantId),m.Cb(5),m.mc("ngModel",t.fromDate)("matDatepicker",e),m.Cb(1),m.mc("for",e),m.Cb(6),m.mc("ngModel",t.toDate)("matDatepicker",i),m.Cb(1),m.mc("for",i),m.Cb(3),m.mc("ngIf",0==t.ownerId)}},directives:[h.f,l.z,l.r,l.k,a.o,S.d,S.e,I.d,I.h,l.c,W.b,B.b,l.q,l.i,B.d,I.j,B.a,P.a,w.a,Gt.a,O.a,M.a,L.n,a.n,I.g],styles:[".button[_ngcontent-%COMP%]{line-height:50px}.myInput[_ngcontent-%COMP%]{height:50px!important;padding:10px!important}"]}),e})(),bn=(()=>{class e{constructor(e,t){this.jwtHelperService=e,this.cookieService=t,this.role="",this.showAprrovedButton=!1,this.actions=[],this.billType="",this.sendInvoiceClicked=new m.o,this.printClicked=new m.o,this.sendSMSClicked=new m.o,this.printSummaryClicked=new m.o,this.approveClickedClicked=new m.o,this.regenerateClicked=new m.o,this.exportClicked=new m.o}get userActions(){return this.actions}set userActions(e){if(this.actions=e,this.actions&&this.actions.length){const e=this.actions.find(e=>"Bill Approval"===e.actionName);this.showAprrovedButton=!!e}}ngOnInit(){let e=this.cookieService.get("access_token");const t=this.jwtHelperService.decodeToken(e);t&&(this.role=t["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"])}onPrint(e){this.printClicked.emit(e)}onExport(){this.exportClicked.emit()}onSendSMS(){this.sendSMSClicked.emit()}}return e.\u0275fac=function(t){return new(t||e)(m.Nb(y.a),m.Nb(C.a))},e.\u0275cmp=m.Hb({type:e,selectors:[["fury-account-statement-footer-toolbar"]],inputs:{disable:"disable",userActions:"userActions"},outputs:{sendInvoiceClicked:"sendInvoiceClicked",printClicked:"printClicked",sendSMSClicked:"sendSMSClicked",printSummaryClicked:"printSummaryClicked",approveClickedClicked:"approveClickedClicked",regenerateClicked:"regenerateClicked",exportClicked:"exportClicked"},decls:11,vars:0,consts:[[1,"person"],["fxLayout","column","fxLayout.gt-sm","row","fxLayoutAlign","end end","fxLayoutGap.gt-sm","24px"],[1,"fury-flex-form-field"],["matTooltip","Print","mat-icon-button","",1,"example-icon",3,"click"],["matTooltip","Export","mat-icon-button","","aria-label","Example icon-button with menu icon",1,"example-icon",3,"click"]],template:function(e,t){1&e&&(m.Tb(0,"mat-dialog-content"),m.Tb(1,"div",0),m.Tb(2,"form"),m.Tb(3,"div",1),m.Tb(4,"div",2),m.Tb(5,"button",3),m.bc("click",(function(){return t.onPrint("Normal")})),m.Tb(6,"mat-icon"),m.Rc(7,"print"),m.Sb(),m.Sb(),m.Tb(8,"button",4),m.bc("click",(function(){return t.onExport()})),m.Tb(9,"mat-icon"),m.Rc(10,"import_export"),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb())},directives:[h.f,l.z,l.r,l.s,S.d,S.c,S.e,P.a,D.a,w.a],styles:[".button[_ngcontent-%COMP%]{line-height:50px}"]}),e})();var pn=i("Vvus");const fn=["htmlData"];function gn(e,t){1&e&&(m.Tb(0,"div",14),m.Ob(1,"mat-progress-spinner",15),m.Sb())}function vn(e,t){1&e&&(m.Tb(0,"div",16),m.Rc(1," Click the Print button to view the Account Statement. "),m.Sb())}function yn(e,t){if(1&e){const e=m.Ub();m.Tb(0,"div",16),m.Tb(1,"fury-expandable-table-structure",17),m.bc("selectedRows",(function(t){return m.Ec(e),m.fc().onSelectedRows(t)})),m.Sb(),m.Sb()}if(2&e){const e=m.fc();m.Cb(1),m.mc("tableData",e.billMasterDetails)("columnsToDisplay",e.columns)("innerDisplayedColumns",e.innerColumns)("columnNames",e.columnNames)("hideHeader",!1)("cssStyledColumn",e.cssStyledColumn)("visibleButtons",e.visibleButtons)("role",e.role)("buttonName",e.buttonName)("disableColumn",e.disableColumn)}}function Cn(e,t){if(1&e){const e=m.Ub();m.Tb(0,"div",18),m.Tb(1,"mat-form-field",19),m.Tb(2,"mat-label"),m.Rc(3,"Bill Amount"),m.Sb(),m.Tb(4,"input",20),m.bc("ngModelChange",(function(t){return m.Ec(e),m.fc().billAmount=t})),m.Sb(),m.Sb(),m.Tb(5,"mat-form-field",19),m.Tb(6,"mat-label"),m.Rc(7,"Credit Note Amount"),m.Sb(),m.Tb(8,"input",21),m.bc("ngModelChange",(function(t){return m.Ec(e),m.fc().creditNoteAmount=t})),m.Sb(),m.Sb(),m.Tb(9,"mat-form-field",19),m.Tb(10,"mat-label"),m.Rc(11,"Paid Amount"),m.Sb(),m.Tb(12,"input",22),m.bc("ngModelChange",(function(t){return m.Ec(e),m.fc().receivedAmount=t})),m.Sb(),m.Sb(),m.Tb(13,"mat-form-field",19),m.Tb(14,"mat-label"),m.Rc(15,"Balance Due"),m.Sb(),m.Tb(16,"input",23),m.bc("ngModelChange",(function(t){return m.Ec(e),m.fc().previousDueAmount=t})),m.Sb(),m.Sb(),m.Sb()}if(2&e){const e=m.fc();m.Cb(4),m.mc("ngModel",e.billAmount),m.Cb(4),m.mc("ngModel",e.creditNoteAmount),m.Cb(4),m.mc("ngModel",e.receivedAmount),m.Cb(4),m.mc("ngModel",e.previousDueAmount)}}const Sn=[{path:"create-bill",component:Z},{path:"create-bill-payment",component:ze},{path:"final-bill-settlement",component:Be},{path:"bill-history",component:Vt},{path:"approve-bills",component:Vt},{path:"rejected-bills",component:Vt},{path:"bill-history-cancel",component:Si},{path:"payment-history",component:gi},{path:"payment-history-cancel",component:Ti},{path:"email-pdf-report/:type/:id",component:yi},{path:"bill-consumption",component:Vi},{path:"failed-bills",component:Ki},{path:"create-paymentdue",component:vl},{path:"create-refund",component:Il},{path:"tenant-payment",component:Wl},{path:"invoice-aging-report",component:Ul},{path:"create-consolidated",component:tn},{path:"credit-note-history",component:rn},{path:"account-statement",component:(()=>{class e{constructor(e,t,i,l,n,o,a,s,r,c,u,d){var m,h,p;this.billService=e,this.billSettlementService=t,this.ownerService=i,this.date=l,this.currencyPipe=n,this.decimalPipe=o,this.jwtHelperService=a,this.snackbar=s,this.registerService=r,this.clientSelectionService=c,this.cookieService=u,this.showSpinner=!1,this.role="",this._gap=16,this.gap=this._gap+"px",this.col2=`1 1 calc(50% - ${this._gap/2}px)`,this.col3=`1 1 calc(33.3333% - ${this._gap/1.5}px)`,this.tenants=[],this.billPeriods=[],this.billTypes=[],this.selectedRows=[],this.visibleButtons=[],this.columns=[],this.innerColumns=[],this.columnNames=[],this.billMasterDetails=[],this.availableBillMasterDetails=[],this.manageParams={},this.userActions=[],this.billType="",this.billAmount="",this.creditNoteAmount="",this.receivedAmount="",this.previousDueAmount="",this.userId="",this.disable=!1,this.disableColumn="paid",this.isMultipleTenant=!1,this.isMovedOutTenant=!1,this.dateFormat="",this.currency="",this.roundFormat="",this.filePath="",this.billNumberColumnName="Bill Number",this.tenantNameColumnName="Tenant Name",this.entityTypeColumnName="Transactions",this.detailsColumnName="Details",this.billDateColumnName="Bill Date",this.billAmountColumnName="Bill Amount",this.creditNoteAmountColumnName="Credit Note Amount",this.paidColumnName="Payment Amount",this.previousDueAmountColumnName="Balance",this.cssStyledColumn="status",this.buttonName="Credit Note",this.pdfsToMerge=[],this.filePath=d.backendForFiles,this.dateFormat=null!==(m=Object(b.e)("DateFormat"))&&void 0!==m?m:d.dateFormat,this.currency=null!==(h=Object(b.e)("Currency"))&&void 0!==h?h:d.currencyFormat,this.roundFormat=null!==(p=Object(b.e)("RoundOff"))&&void 0!==p?p:d.roundOffFormat}ngOnInit(){this.clientSelectionService.setIsClientVisible(!0);let e=this.cookieService.get("access_token");const t=this.jwtHelperService.decodeToken(e);t&&(this.role=t["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"],this.userId=t["http://schemas.xmlsoap.org/ws/2005/05/identity/claims/sid"],this.getUserEnabledActions()),this.ownerId=parseInt(this.cookieService.get("ownerId")),this.getTenants(),this.createColumnNames(),this.createGridColumns(),this.createInnerGridColumns(),this.addVisibleButtons()}createGridColumns(){this.columns=["billDateLocal","entityType","status","ownerName","billAmountLocal","creditNoteAmountLocal","paidLocal","previousDueAmountLocal"]}createInnerGridColumns(){this.innerColumns=[]}createColumnNames(){this.columnNames=[{name:this.billNumberColumnName,property:"billNumber",visible:!0,isModelProperty:!0},{name:this.tenantNameColumnName,property:"ownerName",visible:!0,isModelProperty:!0},{name:this.entityTypeColumnName,property:"entityType",visible:!0,isModelProperty:!0},{name:this.billDateColumnName,property:"billDateLocal",visible:!0,isModelProperty:!0},{name:this.billAmountColumnName,property:"billAmountLocal",visible:!0,isModelProperty:!0,columnAlign:{"text-align":"right"}},{name:this.paidColumnName,property:"paidLocal",visible:!0,isModelProperty:!0,columnAlign:{"text-align":"right"}},{name:this.detailsColumnName,property:"status",visible:!0,isModelProperty:!0},{name:this.creditNoteAmountColumnName,property:"creditNoteAmountLocal",visible:!0,isModelProperty:!0,columnAlign:{"text-align":"right"}},{name:this.previousDueAmountColumnName,property:"previousDueAmountLocal",visible:!0,isModelProperty:!0,columnAlign:{"text-align":"right"}}]}addVisibleButtons(){this.visibleButtons=[{property:"modify"},{property:"print"},{property:"reject"},{property:"cancel"}]}getTenants(){this.tenants=[],this.clientId=parseInt(this.cookieService.get("globalClientId")),this.isMovedOutTenant?this.ownerService.getMovedOutTenants(this.clientId).subscribe(e=>{this.tenants=e.filter((e,t,i)=>i.findIndex(t=>t.Id===e.Id)===t),this.tenants=e}):this.billSettlementService.getTenantsDetails(this.clientId).subscribe(e=>{this.tenants=e})}getUserEnabledActions(){this.userActions=[],this.registerService.getUserEnabledActions(this.userId).subscribe({next:e=>{this.userActions=e},error:()=>{this.notificationMessage("User Actions not found","red-snackbar")}})}onGetAccountStatement(e){this.showSpinner=!0,this.manageParams=e,this.billMasterDetails=[],this.billAmount="",this.receivedAmount="",this.previousDueAmount="";let t=0,i=0,l=0;this.lstTenant=[],e.fromDate=""==e.fromDate?"":R(e.fromDate).format("YYYY-MM-DD"),e.toDate=""==e.toDate?"":R(e.toDate).format("YYYY-MM-DD"),this.lstTenant=this.manageParams.tenantId.split(","),this.isMultipleTenant=this.lstTenant.length>1,e.clientId=this.clientId,this.availableBillMasterDetails=this.billMasterDetails=[],this.billService.getAccountStatement(e).subscribe({next:n=>{if(n&&n.length){const o=n.filter(e=>!1===e.isBillFailed&&"SecurityDeposit"==e.entityType),a=n.filter(e=>!1===e.isBillFailed&&"SecurityDeposit"!=e.entityType);if(a&&a.length){let s=null;this.dateFormat=Object(b.e)("DateFormat"),this.roundFormat=Object(b.e)("RoundOff"),this.currency=Object(b.e)("Currency"),a.forEach(n=>{n.billDateLocal=this.date.transform(n.billDate.toString(),this.dateFormat.toString()),n.billAmountLocal=this.currencyPipe.transform(n.billAmount,this.currency.toString(),!0,this.roundFormat),n.creditNoteAmountLocal=this.currencyPipe.transform(n.creditNoteAmount,this.currency.toString(),!0,this.roundFormat),n.paidLocal=this.currencyPipe.transform(Number(n.paid),this.currency.toString(),!0,this.roundFormat),null!=s&&"Invoice"===n.entityType||"CreditNote"===n.entityType?n.previousDueAmount=Number(s)+Number(n.billAmount)-Number(n.paid)-Number(n.creditNoteAmount):null!=s&&"Payment"===n.entityType&&(n.previousDueAmount=Number(s)-Number(n.billAmount)-Number(n.paid)-Number(n.creditNoteAmount)),n.previousDueAmountLocal=this.currencyPipe.transform(n.previousDueAmount,this.currency.toString(),!0,this.roundFormat),t+=Number(n.billAmount),l+=Number(n.creditNoteAmount),i+=Number(n.paid),s=Number(n.previousDueAmount),n.fromDate=new Date(e.fromDate),n.toDate=new Date(e.toDate)}),this.billMasterDetails=a,this.billAmount=this.currencyPipe.transform(t,this.currency.toString(),!0,this.roundFormat),this.creditNoteAmount=this.currencyPipe.transform(l,this.currency.toString(),!0,this.roundFormat),this.receivedAmount=this.currencyPipe.transform(i,this.currency.toString(),!0,this.roundFormat),this.previousDueAmount=this.currencyPipe.transform(n[n.length-1].previousDueAmount,this.currency.toString(),!0,this.roundFormat),this.availableBillMasterDetails=a.map(e=>e),o&&o.length&&o.forEach(e=>this.availableBillMasterDetails.push(e))}else this.notificationMessage("No data found.","yellow-snackbar")}else this.notificationMessage("No data found.","yellow-snackbar");this.showSpinner=!1},error:()=>{this.showSpinner=!1}})}onSelectedRows(e){this.selectedRows=[],this.selectedRows=e,this.disable=!1,this.selectedRows&&this.selectedRows.length&&this.selectedRows.find(e=>1==e.isApproved)&&(this.disable=!0)}onPrintPdf(e){return Object(r.a)(this,void 0,void 0,(function*(){this.pdfsToMerge=[],this.availableBillMasterDetails&&this.availableBillMasterDetails.length?(this.availableBillMasterDetails[0].fromDate=new Date(this.manageParams.fromDate),this.availableBillMasterDetails[0].toDate=new Date(this.manageParams.toDate),"Normal"===e?this.accountStatementView(this.availableBillMasterDetails):this.downloadDetailReport(this.availableBillMasterDetails)):this.notificationMessage("Account statement not available.","red-snackbar")}))}downloadAllTenantsFiles(e){return Object(r.a)(this,void 0,void 0,(function*(){const t=yield G.PDFDocument.create();for(const o of e){const e=yield G.PDFDocument.load(o);(yield t.copyPages(e,e.getPageIndices())).forEach(e=>{t.addPage(e)})}const i=yield t.save(),l=new Blob([i],{type:"application/pdf"}),n=window.URL.createObjectURL(l);window.open(n)}))}downloadFile(e){return Object(r.a)(this,void 0,void 0,(function*(){const t=yield G.PDFDocument.create(),i=yield G.PDFDocument.load(e);(yield t.copyPages(i,i.getPageIndices())).forEach(e=>{t.addPage(e)});const l=yield t.save(),n=new Blob([l],{type:"application/pdf"}),o=window.URL.createObjectURL(n);window.open(o)}))}downloadReport(e){let t=[],i=[],l=[],n=0,o=0;e.forEach(e=>{n+=Number(e.billAmount),"Opening Balance"!==e.entityType&&(o+=Number(e.paid))});for(let a=0;a<e.length;a++)t.push(e[a].billDateLocal),t.push(e[a].entityType),t.push(e[a].status),t.push(e[a].billAmountLocal),t.push(e[a].paidLocal),t.push(e[a].previousDueAmountLocal),l.push(t),t=[];t.push(""),t.push(""),t.push(""),t.push(""),t.push("Balance Due"),t.push(e[e.length-1].previousDueAmountLocal),l.push(t),i.push({label:"Opening Balance",value:e[0].previousDueAmountLocal},{label:"Invoiced Amount",value:this.currencyPipe.transform(n,this.currency.toString(),!0,this.roundFormat)},{label:"Amount Paid",value:this.currencyPipe.transform(o,this.currency.toString(),!0,this.roundFormat)},{label:"Balance Due",value:e[e.length-1].previousDueAmountLocal}),this.getReport(e,i,["Date","Transactions","Details","Amount","Payments","Balance"],l)}addImage(e,t,i){var l;try{if(t&&t.length&&t[0]&&t[0].client&&t[0].client.imageProperties&&t[0].client.imageProperties.length){const o=t[0].client.imageProperties.find(e=>e.imageType.trim().toLowerCase()===i.toLowerCase());if(o){var n=new Image;n.src=this.filePath+"/uploads/"+(null===(l=t[0].client)||void 0===l?void 0:l.photo),n.onload=function(){e.addImage(n,o.imgX,o.imgY,o.imgW,o.imgH)}}else this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar")}else this.notificationMessage("Image properties not found. To see image on print, please configure image properties ","red-snackbar")}catch(o){this.notificationMessage("Image not found.","red-snackbar")}return e}accountStatementView(e){this.lstTenant.length>1?this.billService.accountStatementSummaryView(e).subscribe({next:e=>{e?this.downloadAllTenantsFiles(e):this.notificationMessage("No data to print","red-snackbar")},error:()=>{this.notificationMessage("No data to print","red-snackbar")}}):this.billService.accountStatementView(e).subscribe({next:e=>{e?this.downloadFile(e):this.notificationMessage("No data to print","red-snackbar")},error:()=>{this.notificationMessage("No data to print","red-snackbar")}})}getReport(e,t,i,l){var n,o,a,s;let r=new fe.default({orientation:"portrait",unit:"pt",format:"letter"});r.rect(5,5,r.internal.pageSize.width-10,r.internal.pageSize.height-10,"S"),this.addImage(r,e,"Account Statement"),r.setFontSize(30),r.setTextColor(0,0,0),r.setFontSize(14),r.setFont("Cambria"),r.text(Object(b.f)(e[0].client.clientName).toUpperCase(),r.internal.pageSize.width-600,50),r.setFontSize(10),r.text("TRN: "+e[0].client.trnNo,r.internal.pageSize.width-600,60),r.text("PO Box "+e[0].client.addresses[0].zipPostalCode,r.internal.pageSize.width-600,70),r.text(e[0].client.addresses[0].address1+","+e[0].client.addresses[0].country,r.internal.pageSize.width-600,80),r.text("Phone: "+e[0].client.phoneNo,r.internal.pageSize.width-600,90),r.text("Email: "+e[0].client.email+", Web: "+e[0].client.website,r.internal.pageSize.width-600,100),r.setTextColor(0,0,0),r.setFontSize(10),r.text("Customer Details",10,120),r.setFillColor(241,241,244),r.setDrawColor(206,203,203),r.rect(10,130,250,75,"FD"),r.setTextColor(0,0,0),r.setFontSize(10),r.text(null===(n=e[0])||void 0===n?void 0:n.ownerName.toUpperCase(),20,145),r.text("CUSTOMER TRN: "+(null===(o=e[0])||void 0===o?void 0:o.trn),20,160),r.text("unit #"+(null===(a=e[1])||void 0===a?void 0:a.unitNumber),20,175),r.text("Account Number: "+(null===(s=e[0])||void 0===s?void 0:s.accountNumber),20,190),r.setFontSize(9),r.setFontSize(11),r.setFont("Cambria","bold"),r.text("Statement of Accounts".toUpperCase(),r.internal.pageSize.width-250,70),r.setFont("Cambria","normal"),r.setTextColor(0,0,0),r.setFontSize(9),r.line(r.internal.pageSize.width-250,80,607,80);let c=this.date.transform(this.manageParams.fromDate.toString(),this.dateFormat.toString()),u=this.date.transform(this.manageParams.toDate.toString(),this.dateFormat.toString());r.text((c+" - "+u).toString(),r.internal.pageSize.width-250,90),r.line(r.internal.pageSize.width-250,100,607,100),r.setFontSize(10),r.text("Account Summary",r.internal.pageSize.width-250,120),r.setFontSize(9),r.autoTable("",t,{startX:r.internal.pageSize.width-250,startY:130,styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:4,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{left:r.internal.pageSize.width-250},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:135,halign:"left"},1:{cellWidth:100,halign:"right"}},didParseCell:function(e){const t=e.column.index;0!=t&&1!=t||(e.cell.styles.rowHeight=1)},headStyles:{lineWidth:.1,lineColor:[0,0,0]}});const d=Number(this.decimalPipe.transform(r.autoTable.previous.finalY,"1.0-0"));r.setLineWidth(.1),r.line(5,d+10,607,d+10),r.autoTable(i,l,{startX:10,startY:d+20,didDrawPage:function(e){var t="Page "+e.pageCount;"function"==typeof r.putTotalPages&&(t+=" of 1",r.rect(5,5,r.internal.pageSize.width-10,r.internal.pageSize.height-10,"S")),r.setFontSize(9);var i=r.internal.pageSize.height||r.internal.pageSize.getHeight();r.text(t,e.settings.margin.left,i-10)},styles:{overflow:"linebreak",cellWidth:"wrap",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:d+20,left:10},theme:"grid",tableWidth:"auto",cellWidth:"wrap",columnStyles:{0:{cellWidth:70,halign:"center"},1:{cellWidth:100,halign:"center"},2:{cellWidth:180,halign:"center"},3:{cellWidth:80,halign:"right"},4:{cellWidth:80,halign:"right"},5:{cellWidth:80,halign:"right"}},didParseCell:function(e){"Balance Due"===e.cell.raw&&(e.cell.styles.fontStyle="bold")},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]}}),r.setTextColor(0,0,0),"function"==typeof r.putTotalPages&&r.putTotalPages("1");var m=r.output("datauristring");this.pdfsToMerge.push(m)}notificationMessage(e,t){this.snackbar.open(e,null,{duration:5e3,verticalPosition:"top",horizontalPosition:"end",panelClass:[t]})}downloadDetailReport(e){let t=[],i=[];e.forEach(e=>{});let l=[],n=[];e.forEach(e=>{e.bills&&e.bills.length&&e.bills.forEach(e=>{e.billTransactions&&e.billTransactions.length&&e.billTransactions.forEach(e=>{l.includes(e.headDisplay)||l.push(e.headDisplay)})}),e.billCharges&&e.billCharges.length&&e.billCharges.forEach(e=>{n.includes(e.headDisplay)||n.push(e.headDisplay)})});let o=["Date","Transactions","Details"];l.forEach(e=>{o.push(e)}),n.forEach(e=>{o.push(e)}),o.push("Amount","Payments","Balance");const a=this.currencyPipe.transform(0,this.currency.toString(),!0,this.roundFormat);for(let s=0;s<e.length;s++)t.push(e[s].billDateLocal),t.push(e[s].entityType),t.push(e[s].status),l.forEach(i=>{if(e[s].bills&&e[s].bills.length){const l=e[s].bills.filter(e=>1==e.isDifferentiateBill);if(l&&l.length&&e[s].bills.length==l.length)if(l[l.length-1].billTransactions&&l[l.length-1].billTransactions.length){const e=l[l.length-1].billTransactions.find(e=>e.headDisplay.toLowerCase()===i.toLowerCase());t.push(e?this.currencyPipe.transform(e.headAmount,this.currency.toString(),!0,this.roundFormat):a)}else t.push(a);else e[s].bills.forEach(e=>{if(e.billTransactions&&e.billTransactions.length){const l=e.billTransactions.find(e=>e.headDisplay.toLowerCase()===i.toLowerCase());t.push(l?this.currencyPipe.transform(l.headAmount,this.currency.toString(),!0,this.roundFormat):a)}else t.push(a)})}else t.push(a)}),n.forEach(i=>{if(e[s].billCharges&&e[s].billCharges.length){const l=e[s].billCharges.find(e=>e.headDisplay.toLowerCase()===i.toLowerCase());t.push(l?this.currencyPipe.transform(l.headAmount,this.currency.toString(),!0,this.roundFormat):a)}else t.push(a)}),t.push(this.currencyPipe.transform(e[s].billAmount,this.currency.toString(),!0,this.roundFormat)),t.push(this.currencyPipe.transform(e[s].paid,this.currency.toString(),!0,this.roundFormat)),t.push(this.currencyPipe.transform(e[s].previousDueAmount,this.currency.toString(),!0,this.roundFormat)),i.push(t),t=[];t=[];for(let s=0;s<o.length;s++)s<o.length-2?t.push(""):(t.push("Balance Due"),t.push(e[e.length-1].previousDueAmountLocal));i.push(t),this.getDetailReport(e,o,i)}getDetailReport(e,t,i){var l,n,o,a,s;let r=new fe.default({orientation:"landscape",unit:"pt",format:"letter"});r.rect(5,5,r.internal.pageSize.width-10,r.internal.pageSize.height-10,"S"),r.setFontSize(30),this.addImage(r,e,"Landscape"),r.setTextColor(0,0,0),r.setFontSize(12),r.setFont("Cambria","bold");let c=this.date.transform((new Date).toString(),this.dateFormat.toString());const u=R().format("M/D/YYYY hh:mm:ss a");r.text("Statement of Accounts As "+c,310,30),r.setFont("Cambria","normal"),r.setFontSize(9),r.text("Print Date:"+u,r.internal.pageSize.width-150,20),r.setTextColor(0,0,0),r.setFontSize(10),r.text(null===(l=e[0])||void 0===l?void 0:l.ownerName.toUpperCase(),340,50),r.text("Unit #"+(null===(n=e[1])||void 0===n?void 0:n.unitNumber),340,65),r.text("Tower Name: "+(null===(a=null===(o=e[0])||void 0===o?void 0:o.client)||void 0===a?void 0:a.clientName),340,80),r.text("Account Number: "+(null===(s=e[0])||void 0===s?void 0:s.accountNumber),340,95),r.setFontSize(9);let d=this.date.transform(this.manageParams.fromDate.toString(),this.dateFormat.toString()),m=this.date.transform(this.manageParams.toDate.toString(),this.dateFormat.toString());r.text((d+" - "+m).toString(),340,110),r.setFontSize(10),r.autoTable(t,i,{startX:10,startY:120,didDrawPage:function(e){var t="Page "+e.pageCount;"function"==typeof r.putTotalPages&&(t+=" of 1",r.rect(5,5,r.internal.pageSize.width-10,r.internal.pageSize.height-10,"S")),r.setFontSize(9);var i=r.internal.pageSize.height||r.internal.pageSize.getHeight();r.text(t,e.settings.margin.left,i-10)},styles:{overflow:"linebreak",fontSize:9,cellPadding:6,overflowColumns:"linebreak",lineColor:[0,0,0]},margin:{top:120,left:10},theme:"grid",tableWidth:"auto",columnStyles:{0:{cellWidth:t.length>4?"40":"wrap",halign:"center"},1:{cellWidth:t.length>4?"40":"wrap",halign:"center"},2:{cellWidth:t.length>4?"60":"wrap",halign:"center"},3:{cellWidth:"wrap",halign:"right"},4:{cellWidth:"wrap",halign:"right"},5:{cellWidth:"wrap",halign:"right"},6:{cellWidth:"wrap",halign:"right"},7:{cellWidth:"wrap",halign:"right"},8:{cellWidth:"wrap",halign:"right"},9:{cellWidth:"wrap",halign:"right"},10:{cellWidth:"wrap",halign:"right"}},didParseCell:function(e){"Balance Due"===e.cell.raw&&(e.cell.styles.fontStyle="bold")},headStyles:{lineWidth:.1,lineColor:[0,0,0],halign:"center",fillColor:[25,118,210]}}),r.setTextColor(0,0,0),"function"==typeof r.putTotalPages&&r.putTotalPages("1");var h=r.output("datauristring");this.pdfsToMerge.push(h)}getJsonData(){let e=[],t=[];this.tableData=[];let i=[],l=[];this.billMasterDetails.forEach(e=>{e.bills&&e.bills.length&&e.bills.forEach(e=>{e.billTransactions&&e.billTransactions.length&&e.billTransactions.forEach(e=>{i.includes(e.headDisplay)||i.push(e.headDisplay)})}),e.billCharges&&e.billCharges.length&&e.billCharges.forEach(e=>{l.includes(e.headDisplay)||l.push(e.headDisplay)})});let n=["Date","Transactions","Details"];i.forEach(e=>{n.push(e)}),l.forEach(e=>{n.push(e)}),n.push("Amount","Payments","Balance"),this.tableData.push(n);const o=this.currencyPipe.transform(0,this.currency.toString(),!0,this.roundFormat);for(let a=0;a<this.billMasterDetails.length;a++)e.push(this.billMasterDetails[a].billDateLocal),e.push(this.billMasterDetails[a].entityType),e.push(this.billMasterDetails[a].status),i.forEach(t=>{let i=0;if(this.billMasterDetails[a].bills&&this.billMasterDetails[a].bills.length){const l=this.billMasterDetails[a].bills.filter(e=>1==e.isDifferentiateBill);if(l&&l.length&&this.billMasterDetails[a].bills.length==l.length)if(l[l.length-1].billTransactions&&l[l.length-1].billTransactions.length){const e=l[l.length-1].billTransactions.find(e=>e.headDisplay.toLowerCase()===t.toLowerCase());e&&(i=e.headAmount)}else e.push(o);else this.billMasterDetails[a].bills.forEach(e=>{if(e.billTransactions&&e.billTransactions.length){const l=e.billTransactions.find(e=>e.headDisplay.toLowerCase()===t.toLowerCase());l&&(i+=l.headAmount)}}),e.push(i>0?this.currencyPipe.transform(i,this.currency.toString(),!0,this.roundFormat):o)}else e.push(o)}),l.forEach(t=>{if(this.billMasterDetails[a].billCharges&&this.billMasterDetails[a].billCharges.length){const i=this.billMasterDetails[a].billCharges.find(e=>e.headDisplay.toLowerCase()===t.toLowerCase());e.push(i?this.currencyPipe.transform(i.headAmount,this.currency.toString(),!0,this.roundFormat):o)}else e.push(o)}),e.push(this.currencyPipe.transform(this.billMasterDetails[a].billAmount,this.currency.toString(),!0,this.roundFormat)),e.push(this.currencyPipe.transform(this.billMasterDetails[a].paid,this.currency.toString(),!0,this.roundFormat)),e.push(this.currencyPipe.transform(this.billMasterDetails[a].previousDueAmount,this.currency.toString(),!0,this.roundFormat)),t.push(e),this.tableData.push(e),e=[];e=[];for(let a=0;a<n.length;a++)a<n.length-2?e.push(""):e.includes("Balance Due")||(e.push("Balance Due"),e.push(this.billMasterDetails[this.billMasterDetails.length-1].previousDueAmountLocal));this.tableData.push(e)}getAllTenantsJsonData(){this.tableData=[];let e=this.currencyPipe.transform(0,this.currency.toString(),!0,this.roundFormat.toString());null!=this.billMasterDetails&&this.billMasterDetails.forEach(t=>{var i=[];i=this.billMasterDetails.filter(e=>e.ownerName==t.ownerName);var l=this.tableData.filter(e=>e.TenantName==t.ownerName);l&&0==l.length&&(i.forEach(t=>{let i={BillDate:this.date.transform(t.billDate,"yyyy-MM-dd"),Transactions:t.entityType,Details:t.status,TenantName:t.ownerName,BillAmount:t.billAmountLocal,CreditNoteAmount:t.creditNoteAmountLocal,PaymentAmount:t.paidLocal,Balance:t.previousDueAmountLocal};e=t.previousDueAmountLocal,this.tableData.push(i)}),this.tableData.push({BillDate:"",Transactions:"",Details:"",TenantName:"",BillAmount:"",CreditNoteAmount:"",PaymentAmount:"Balance Due",Balance:e}))})}onExport(){if(this.billMasterDetails&&this.billMasterDetails.length>0){if(this.lstTenant.length>1?this.getAllTenantsJsonData():this.getJsonData(),null!=this.tableData){const e=this.lstTenant.length>1?vt.utils.json_to_sheet(this.tableData):vt.utils.aoa_to_sheet(this.tableData),t=vt.utils.book_new();vt.utils.book_append_sheet(t,e,"Sheet1"),vt.writeFile(t,"AccountStatement.xlsx")}}else this.notificationMessage("No Data to Export","yellow-snackbar")}showMovedOutTenants(e){this.isMovedOutTenant=e,this.getTenants()}}return e.\u0275fac=function(t){return new(t||e)(m.Nb(c.a),m.Nb(F.a),m.Nb(pn.a),m.Nb(a.f),m.Nb(a.d),m.Nb(a.g),m.Nb(y.a),m.Nb(k.b),m.Nb(ot.a),m.Nb(_.a),m.Nb(C.a),m.Nb(p.a))},e.\u0275cmp=m.Hb({type:e,selectors:[["app-account-statement"]],viewQuery:function(e,t){var i;1&e&&(m.Vc(fn,!0),m.Jc(hn,!0),m.Jc(bn,!0)),2&e&&(m.zc(i=m.cc())&&(t.htmlData=i.first),m.zc(i=m.cc())&&(t.accountStatementToolbarComponent=i.first),m.zc(i=m.cc())&&(t.accountStatementFooterToolbarComponent=i.first))},decls:18,vars:13,consts:[["mode","card"],["class","loading-indicator",4,"ngIf"],["fxLayout","column",1,"content"],["color","primary",1,"position-fixed"],["src","assets/img/fav-icon.png",1,"img-style"],[1,"example-spacer"],[3,"userActions","disable","printClicked","exportClicked"],["fxFlex","noshrink","fxLayout","column","fxLayout.gt-sm","row","fxLayoutAlign.gt-sm","start stretch",3,"fxLayoutGap"],["fxFlex","grow",1,"basic-forms","route-animations-elements",3,"fxFlex.gt-sm"],["fxLayout","column"],["fxLayout","column",1,"result"],[3,"tenants","billPeriods","isHide","billTypes","searchClicked","tenantChanged"],["class","padding","fxLayout","column",4,"ngIf"],["class","result","fxLayout.gt-sm","row","fxLayout","column","fxLayoutAlign","end end","fxLayoutGap.gt-sm","12px",4,"ngIf"],[1,"loading-indicator"],["mode","indeterminate","color","accent"],["fxLayout","column",1,"padding"],[3,"tableData","columnsToDisplay","innerDisplayedColumns","columnNames","hideHeader","cssStyledColumn","visibleButtons","role","buttonName","disableColumn","selectedRows"],["fxLayout.gt-sm","row","fxLayout","column","fxLayoutAlign","end end","fxLayoutGap.gt-sm","12px",1,"result"],["color","primary",1,"result"],["type","text","id","billAmount","name","billAmount","matInput","",2,"text-align","right",3,"ngModel","ngModelChange"],["type","text","id","creditNoteAmount","name","creditNoteAmount","matInput","",2,"text-align","right",3,"ngModel","ngModelChange"],["type","text","id","receivedAmount","name","receivedAmount","matInput","",2,"text-align","right",3,"ngModel","ngModelChange"],["type","text","id","previousDueAmount","name","previousDueAmount","matInput","",2,"text-align","right",3,"ngModel","ngModelChange"]],template:function(e,t){1&e&&(m.Tb(0,"fury-page-layout",0),m.Pc(1,gn,2,0,"div",1),m.Tb(2,"fury-page-layout-content",2),m.Tb(3,"mat-toolbar",3),m.Ob(4,"img",4),m.Tb(5,"span"),m.Rc(6,"Account Statement"),m.Sb(),m.Ob(7,"span",5),m.Tb(8,"fury-account-statement-footer-toolbar",6),m.bc("printClicked",(function(e){return t.onPrintPdf(e)}))("exportClicked",(function(){return t.onExport()})),m.Sb(),m.Sb(),m.Tb(9,"div",7),m.Tb(10,"fury-card",8),m.Ob(11,"fury-card-header"),m.Tb(12,"fury-card-content",9),m.Tb(13,"div",10),m.Tb(14,"app-account-statement-toolbar",11),m.bc("searchClicked",(function(e){return t.onGetAccountStatement(e)}))("tenantChanged",(function(e){return t.showMovedOutTenants(e)})),m.Sb(),m.Sb(),m.Pc(15,vn,2,0,"div",12),m.Pc(16,yn,2,10,"div",12),m.Pc(17,Cn,17,4,"div",13),m.Sb(),m.Sb(),m.Sb(),m.Sb(),m.Sb()),2&e&&(m.Cb(1),m.mc("ngIf",t.showSpinner),m.Cb(7),m.mc("userActions",t.userActions)("disable",t.disable),m.Cb(1),m.mc("fxLayoutGap",t.gap),m.Cb(1),m.mc("fxFlex.gt-sm",t.col2)("@fadeInUp",void 0),m.Cb(4),m.mc("tenants",t.tenants)("billPeriods",t.billPeriods)("isHide",!1)("billTypes",t.billTypes),m.Cb(1),m.mc("ngIf",1==t.isMultipleTenant),m.Cb(1),m.mc("ngIf",0==t.isMultipleTenant),m.Cb(1),m.mc("ngIf",!1))},directives:[X.a,a.o,$.a,S.d,q.a,bn,S.b,S.c,S.e,f.a,f.d,f.c,hn,Q.a,T.a,I.d,I.h,W.b,l.c,l.q,l.t],styles:['.padding[_ngcontent-%COMP%]{padding:0 0 24px}.example-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.content[_ngcontent-%COMP%]{margin-top:2%}.img-style[_ngcontent-%COMP%]{width:32px}ul[_ngcontent-%COMP%]{margin:20px}.label-color[_ngcontent-%COMP%]{position:relative}.label-color[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{padding-left:20px}.label-color[_ngcontent-%COMP%]   .color-box[_ngcontent-%COMP%]{width:10px;height:10px;display:inline-block;background-color:#ccc;position:absolute;left:5px;top:5px}.position-fixed[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;top:0;z-index:5}.loading-indicator[_ngcontent-%COMP%]{position:fixed;z-index:999;height:2em;width:2em;overflow:show;margin:auto;top:0;left:0;bottom:0;right:0}.loading-indicator[_ngcontent-%COMP%]:before{content:"";display:block;position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.3)}'],data:{animation:[d.a,u.a]}}),e})()}];let Tn=(()=>{class e{}return e.\u0275mod=m.Lb({type:e}),e.\u0275inj=m.Kb({factory:function(t){return new(t||e)},imports:[[s.j.forChild(Sn)],s.j]}),e})();var Pn=i("KthW"),Dn=i("WCGO"),wn=i("QMK6"),Nn=i("VE2z"),xn=i("q8Jb"),An=i("jaxi"),Fn=i("0jmt"),Rn=i("qnpF");let kn=(()=>{class e{}return e.\u0275mod=m.Lb({type:e}),e.\u0275inj=m.Kb({factory:function(t){return new(t||e)},imports:[[a.c,l.l,Pn.a,Dn.a,Fn.a,re.l]]}),e})();var In=i("zWnM"),On=i("zeEN");let Wn=(()=>{class e{}return e.\u0275mod=m.Lb({type:e}),e.\u0275inj=m.Kb({factory:function(t){return new(t||e)},providers:[a.f,a.g],imports:[[a.c,Tn,l.l,n.a,o.a,Rn.a,Pn.a,Dn.a,l.w,wn.a,Nn.a,Fn.a,xn.a,I.f,W.c,An.c,w.b,yl.c,q.b,D.b,h.g,kn,In.a,On.a]]}),e})()}}]);